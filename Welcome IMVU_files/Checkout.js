module({"json!/common/withme/i18n/settings.json":"json!/asset/6de7917171955166/common/withme/i18n/settings.json","@UiCore":"@UiCore","@WAFWidgets":"@WAFWidgets","@Dialogs":"@Dialogs","json!/common/js/JSON/Countries.json":"json!/asset/82bbf3f0be07c92d/common/js/JSON/Countries.json","json!/common/js/JSON/States.json":"json!/asset/581385bf78983508/common/js/JSON/States.json","@NextUtil":"@NextUtil","json!/common/js/JSON/Provinces.json":"json!/asset/1e80a06c565197b7/common/js/JSON/Provinces.json","json!@StoreModeDictionary":"json!@StoreModeDictionary","@moment":"@moment","@Model":"@Model","css!/build/withme/Checkout.css":"css!/asset/04271237e9e5f749/build/withme/Checkout.css"},function(m){var L=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b;d=a.helperMissing;var g='\n            <div class="order-row order-subtotal">',f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Subtotal",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+=' <div class="order-row-credits credits-value"></div></div>\n            <div class="order-row vip-discount">5% ';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"VIP Discount",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+' <div class="order-row-credits">-<span class="credits-value"></span></div></div>\n        '},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=a.helperMissing;var g=this.escapeExpression,f='<div class="inner-dialog-body">\n    <div class="product gifting-section"></div>\n    <div class="failed-recipients gifting-section hidden">\n        <div class="gifting-title"></div>\n\n        <div class="recipient-info">\n        <div class="recipients-message"></div>\n        <div class="recipients-removed-message">',k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"gifting_recipient_removed",{name:"i18n-g",hash:{},data:e}));if(k||0===k)f+=k;f+='</div>\n        </div>\n    </div>\n    <div class="recipient gifting-section">\n        <div class="gifting-title">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"gifting_dialog_title_recipient",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</div>\n\n        <div class="recipient-info hidden">\n        <div class="recipients-count"></div>\n        <div class="recipients-message"></div>\n        </div>\n    </div>\n    <div class="add-message gifting-section">\n        <div class="gifting-title">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"gifting_dialog_title_add_message",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</div>\n        <textarea id="message" class="message" type="text" placeholder="'+g((b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Say something...",{name:"i18n-g",hash:{},data:e})))+'"></textarea>\n    </div>\n    <div class="order-totals gifting-section">\n        ';if((k=a["if"].call(c,c&&c.isVip,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===k)f+=k;f+='\n        <div class="order-row order-total">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Total",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+' (<span class=\'item-count\'></span>) <div class="order-row-credits credits-value"></div></div>\n    </div>\n    <div class="spacer'+g((b=a.spaceHackClass||c&&c.spaceHackClass,"function"===typeof b?b.call(c,{name:"spaceHackClass",hash:{},data:e}):b))+'"></div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary send-gift"></button>\n<\/script>'},useData:!0})}({}),M=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=this.escapeExpression;return'<span class="credits-value">'+d((b=a.totalCredits||c&&c.totalCredits,"function"===typeof b?b.call(c,{name:"totalCredits",hash:{},data:e}):b))+"</span>"},useData:!0})}({}),D=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){return'<span class="by-line-text">\n    <span class="username"></span>\n</span>\n'},useData:!0})}({}),x=function(h){var c=h.UiCore.UiContext;return c.extend("ByLineWidget",{className:"by-line-widget",uiContextName:"bylinewidget",tagName:"div",dependencies:["model","verbBy"],initialize:function(a){c.prototype.initialize.call(this,a);this.__hideOnlineStatus=!!a.hideOnlineStatus;this.__ignoreClicks=!!a.ignoreClicks;this.__hideUsername=a.hasOwnProperty("hideUsername")?a.hideUsername:!0;this.__verbBy=IMVU.optionalProperty(a,"verbBy",null);this.addToDOM()},render:function(){this.$el.html(h.template());this.__dualName=this.createChildContext(h.WAFWidgets.DualName,{$replaceElement:this.$(".username"),user:this.model,hideIcon:!1,size:"medium",hideDisplay:!1,displayArgs:{size:"small",color:"dark",prefix:this.__verbBy},hideAtAvatar:this.__hideUsername,atAvatarArgs:{size:"small",color:"medium"}})}})}({UiCore:m["@UiCore"],WAFWidgets:m["@WAFWidgets"],template:D}),A=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){return'<div class="back-button"></div>\n'},useData:!0})}({}),v=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){return'<button class="btn ap ap-badge"></button>'},3:function(c,a,d,e){var b;d=this.escapeExpression;return"\n        <div class='name is-truncated'>"+d((b=a.name||c&&c.name,"function"===typeof b?b.call(c,{name:"name",hash:{},data:e}):b))+"</div>\n    "},5:function(c,a,d,e){return"\n        <div class='creator'></div>\n    "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=this.escapeExpression;var g=a.helperMissing,f="<div class='product-image placeholder-container' data-product-id="+d((b=a.product_id||c&&c.product_id,"function"===typeof b?b.call(c,{name:"product_id",hash:{},data:e}):b))+'>\n    <img>\n    <div class="cover-image-placeholder hidden"></div>\n    ',k=a["if"].call(c,c&&c.isAp,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+="\n</div>\n\n<div class='product-details'>\n    ";if((k=a["if"].call(c,c&&c.name,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n    ";if((k=a["if"].call(c,c&&c.creator,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n    <div class='price-credits font-medium text-12 flex'>\n        <div class=\"wh-15 mr-5\">";if((k=(b=a.icon||c&&c.icon||g,b.call(c,"icon-credits",{name:"icon",hash:{class:"wh-full"},data:e})))||0===k)f+=k;return f+'</div>\n        <div class="credits-value">'+d((b=a.price||c&&c.price,"function"===typeof b?b.call(c,{name:"price",hash:{},data:e}):b))+"</div>\n    </div>\n</div>\n"},useData:!0})}({});D=function(h){var c=function(f){var k=Math.round(f/1e6*10)/10;if(1<=k)return k+"M views";k=Math.round(f/1e3);return 1<=k?k+"K views":f+" views"},a=function(f){var k=$jscomp.makeIterator(f.match(/((\d+)H)?((\d+)M)?((\d+)S)?$/));k.next();k.next();f=k.next().value;k.next();var l=k.next().value;k.next();k=k.next().value;var n="";f&&(n=""+f);n=l?(n?n+":":"")+l.padStart(2,"0"):n?n+":00":"00";return n=k?n+":"+k.padStart(2,"0"):n+":00"},d=function(f){return function(k){return f.reduce(function(l,n){return n(l)},k)}},e=function(f){f=f.toString().split(".");f[0]=f[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");return f.join(".")},b=function(f){return isNaN(f)||Math.floor(f)===f?0:f.toString().split(".")[1].length||0},g=function(f,k){if(b(f)<=k)return parseFloat(f).toFixed(k);var l=Math.pow(10,k);return(Math.trunc(f*l)/l).toFixed(k)};return{getTimeFormat:function(f,k){var l=Math.floor(f/3600),n=Math.floor(f/60)-60*l;f%=60;k&&(f=f.toFixed(k));k=10>f?"0":"";return l?l+":"+(10>n?"0":"")+n+":"+k+f:n+":"+k+f},formatCredits:function(f){return f.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},zeroPad:function(f,k){return(Array(k).join("0")+f).substr(-k,k)},formatMini:function(f,k){var l=[{base:1e3,letter:"K"},{base:1e6,letter:"M"},{base:1e9,letter:"B"}];if(f<(k?k:1e3))return e(f);for(var n=l.length-1;0<=n;n--){k=l[n];var q=k.base;if(f>=q)return l=Math.floor(f/q),f=Math.floor((f-q*l)/(q/10)),l+(f?"."+f:"")+k.letter}return""+f},addComma:e,formatDecimal:g,formatVCOIN:function(f){return e(g(f,2))},countDecimals:b,durationParser:a,viewFormatter:c,formatYouTubeVideoMetaData:function(f){return f.items.map(function(k){var l=k.snippet,n=k.contentDetails,q=k.id,r=k.status;return{imageUrl:l.thumbnails.medium.url,videoTitle:l.title,videoAuthor:l.channelTitle,videoDescription:l.description,totalViews:c(k.statistics.viewCount),duration:a(n.duration),isoDuration:n.duration,published:h.moment(l.publishedAt).fromNow(),videoId:q,embeddable:r.embeddable}})},getSuggestionsFromResponse:function(f){return d([function(k){return JSON.parse(k.match(/\((.*)\)/)[1])},function(k){return k[1]},function(k){return k.map(function(l){return l[0]})}])(f)},getTokenFromResponse:function(f){return d([function(k){return JSON.parse(k.match(/\((.*)\)/)[1])},function(k){return k[2]},function(k){return k.q}])(f)}}}({moment:m["@moment"]});v=function(h){var c=h.UiCore.UiContext;return c.extend("GiftingProduct",{tagName:"div",className:"gifting-product",uiContextName:"item",dependencies:["globalStringManager","loginManager","model","productImageManager"],initialize:function(a){c.prototype.initialize.call(this,a);this.model=a.model;this.loginManager=a.loginManager;this.myself=a.loginManager.getCurrentUser();this.imageHeight=a.imageHeight?a.imageHeight:null;this.imageWidth=a.imageWidth?a.imageWidth:null;this.__formatNumber=h.FormatNumber;this.__filterModel=this.__serviceProvider.create(h.Model.FilterModel,[],{});this.__filterModel.setCategoryByProduct(this.model);this.__productImageManager=a.productImageManager;this.model.populated().then(function(){this.__creatorModel=this.model.getSingleEdge("creator");this.__creatorModel.populated().then(function(){this.addToDOM()}.bind(this))}.bind(this))},render:function(){this.__getDetails();this.$el.html(h.template(this.__getDetails()));this.$(".product-select").prop("checked",this.model.get("is_selected"));var a=this.model.get("preview_image");this.imageHeight&&this.imageWidth&&(a=IMVU.URI.build(a,{width:this.imageWidth,height:this.imageHeight}));this.setImage(a);"undefined"!==typeof this.__creatorModel&&(this._displayName=this.createChildContext(h.WAFWidgets.DisplayName,{$replaceElement:this.$(".creator"),user:this.__creatorModel,size:"tiny",color:"dark",showVipBadge:!1,prefix:this.__globalStringManager.get("created_by")}))},__getDetails:function(){return{name:this.model.get("product_name"),price:this.__formatNumber.formatCredits(Number(this.model.get("product_price"))),product_id:this.model.get("product_id"),creator:!0,isAp:"AP"===this.model.get("rating")}},setImage:function(a){this.__category=this.__filterModel.get("category");this.imageHeight&&this.imageWidth&&(a=IMVU.URI.build(a,{width:this.imageWidth,height:this.imageHeight}));this.__productImageManager.getProductImage(this.$("img"),a,this.__category,this.$el,this.$(".cover-image-placeholder"))}})}({Model:m["@Model"],UiCore:m["@UiCore"],WAFWidgets:m["@WAFWidgets"],FormatNumber:D,template:v});var N=function(h){function c(d,e){var b=d.get("bootstrapParams").is_app;d.get("window").open(e,b?"_system":"_blank")}function a(d){return-1!==d.indexOf("iPad")||-1!==d.indexOf("iPhone")||-1!==d.indexOf("iPod")}return{openExternal:c,externalizeA:function(d,e){e=$(e);var b=e.attr("href");e.attr("href","");e.click(function(){c(d,b);return!1})},isAndroid:function(d){return-1!==d.get("window").navigator.userAgent.indexOf("Android")},isAndroidChrome:function(d){d=d.get("window").navigator.userAgent;return-1!==d.indexOf("Android")&&-1!==d.indexOf("Chrome/")&&-1===d.indexOf("Version/")},isAndroidWebApp:function(d){d=d.get("window");return-1!==d.navigator.userAgent.indexOf("Android")&&d.navigator.standalone?!0:!1},isIOS:function(d){d=d.get("window").navigator.userAgent;return a(d)},isIOSSafari:function(d){d=d.get("window").navigator.userAgent;return a(d)&&-1===d.indexOf("CriOS/")?-1!==d.indexOf("Safari/")?!0:-1!==d.indexOf("AppleWebKit/")&&-1===d.indexOf("Chrome/"):!1},getVersionIOS:function(d){d=d.get("window").navigator.userAgent;return a(d)?(d=/(iphone|ipad)(; CPU)? OS ((\d+)_(\d+)(_(\d+))?)/i.exec(d),null===d?null:{raw:d[3],major:parseInt(d[4],10),minor:parseInt(d[5],10),revision:d[7]?parseInt(d[7],10):null}):null}}}({}),O=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b,g=a.helperMissing;d='<div class="available-credits">\n    <div class=\'price-credits font-medium text-12 flex\'>\n        <div class="wh-15 mr-5">';if((a=(b=a.icon||c&&c.icon||g,b.call(c,"icon-credits",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)d+=a;return d+"</div>\n        <div class='credits-value'></div>\n    </div>\n</div>\n"},useData:!0})}({});L=function(h){var c=h.Dialogs.AlloyModalDialog;return c.extend("GiftingDialog",{uiContextName:"gifting_dialog",className:"gifting-dialog dialog-type-B userpicker-dialog",dependencies:"dialogManager featureAccessManager globalStartupModel globalStringManager googleAnalytics loginManager product Promise restModelFactory window".split(" "),trackedEvents:function(){return[{type:"click",selector:".send-gift",name:"send_gift",handler:this.__sendGift},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(a){c.prototype.initialize.call(this,a);this.Promise=a.Promise;this.__serviceProvider=a.serviceProvider;this.__window=a.window;this.__googleAnalytics=a.googleAnalytics;this.__dialogManager=a.dialogManager;this.__stringManager=a.globalStringManager;this.__restModelFactory=a.restModelFactory;this.__featureAccessManager=a.featureAccessManager;this.__product=a.product;if(a.hasOwnProperty("recipient"))this.__recipient=a.recipient;else if(a.hasOwnProperty("userPicker"))this.__userPicker=a.userPicker;else throw Error("Either recipient or userPicker is required");this.__giftUrl=a.globalStartupModel.get("giftUrl");this.__myself=a.loginManager.getCurrentUser();this.__isVip=!!this.__myself.get("is_vip");this.__formatNumber=h.FormatNumber;this.__itemsPurchased=this.__orderTotal=0;this.title=this.__stringManager.get("checkout_title");this.addToDOM()},__destroy:function(){this.hide();this.delete()},postRender:function(){this.__myself.populated().then(function(){this.__wallet=this.__myself.getSingleEdge("wallet");return this.__wallet.populated()}.bind(this)).then(function(){this.setContent("body",h.template,{isVip:this.__isVip,spaceHackClass:h.MobileBrowser.isAndroid(this.__serviceProvider)?" is-android":""});this.$(".dialog-header").prepend(h.backButtonTemplate({}));this.setContent("auxHeader",h.headerCreditsTemplate,{});this.setContent("footer",this.$(".dialog-footer-template").text());h.NextUtil.DomHelper.enhanceTextarea(this.$("#message"),500,44);this.__productDisplay=this.createChildContext(h.GiftingProduct,{$parentElement:this.$(".product"),imageWidth:150,imageHeight:150,model:this.__product});this.__recipient?this.__recipientDisplay=this.createChildContext(h.ByLineWidget,{$parentElement:this.$(".recipient"),model:this.__recipient,verbBy:"",hideUsername:!0,ignoreClicks:!0}):(this.__failedRecipients=new Backbone.Collection,this.$(".failed-recipients").addClass("hidden"),this.__checkRecipients());this.__updateCreditsDisplay();this.__updateCartTotals();this.listenTo(this.__wallet,"change",this.__updateCreditsDisplay);this.$(".inner-dialog-body").scrollbar()}.bind(this))},__updateRecipientsInfo:function(){var a=this.__userPicker.userCollection.models.length;this.$(".recipient .recipient-info .recipients-count").text(a);this.$(".recipient .recipient-info").toggleClass("hidden",1===a);this.__recipientDisplay&&this.__recipientDisplay.$el.toggleClass("hidden",1!==a);if(1<a){--a;var d=this.__userPicker.userCollection.at(0);this.$(".recipient .recipient-info .recipients-message").text(this.__stringManager.getPluralized("gifting_recipient",{howMany:a,name:d.get("display_name")}))}else 1===a?(a=this.__userPicker.userCollection.at(0),this.__recipientDisplay=this.createChildContext(h.ByLineWidget,{$parentElement:this.$(".recipient"),model:a,verbBy:"",hideUsername:!0,ignoreClicks:!0}),this.__recipientDisplay.$el.removeClass("hidden")):this.$(".recipient .recipient-info .recipients-message").text(this.__stringManager.get("gifting_recipient_no_recipients"));this.__updateCreditsDisplay();this.__updateCartTotals()},__checkRecipients:function(){return new this.Promise(function(a){this.__checkPurchase().then(function(){this.__updateRecipientsInfo();a.resolve()}.bind(this)).catch(function(d){if("GIFT-003"===d.data.error_id)this.__updateRecipientsInfo(),this.__showTooFewCreditsDialog(),a.reject();else{var e=[];_.each(d.data.failed_recipients,function(g){var f=this.__userPicker.userCollection.find(function(k){return k.get("legacy_cid")===g.recipient_id});e.push(f);this.__userPicker.toggleUserInCollection(f);this.__failedRecipients.add({name:f.get("display_name")})}.bind(this));if(0<e.length){d=e.length-1;var b=e[0];this.$(".failed-recipients .recipient-info .recipients-message").text(this.__stringManager.getPluralized("gifting_recipient_already_owns",{howMany:d,name:b.get("display_name")}))}this.$(".failed-recipients").toggleClass("hidden",0===this.__failedRecipients.models.length);this.__updateRecipientsInfo();a.resolve()}}.bind(this))}.bind(this))},__currentWealth:function(){return parseInt(this.__wallet.get("credits"),10)},__updateCreditsDisplay:function(){this.$(".available-credits .credits-value").text(this.__formatNumber.formatCredits(this.__currentWealth()))},__updateCartTotals:function(){var a=this.__userPicker?this.__userPicker.userCollection.models.length:1,d=this.__product.get("product_price")*a,e=this.__isVip?(this.__product.get("product_price")-this.__product.get("discount_price"))*a:0;this.__orderTotal=d-e;this.$(".order-subtotal .credits-value").text(this.__formatNumber.formatCredits(d));this.$(".vip-discount .credits-value").text(this.__formatNumber.formatCredits(e));this.$(".order-total .credits-value").text(this.__formatNumber.formatCredits(this.__orderTotal));this.$(".item-count").text(a);this.$("button.send-gift").prop("disabled",0===a);this.$("button.send-gift").text(this.__stringManager.getPluralized("gifting_dialog_send_gift",{howMany:a,totalCredits:""}));this.$("button.send-gift").append(h.creditsValueTemplate({totalCredits:this.__formatNumber.formatCredits(this.__orderTotal)}))},__showTooFewCreditsDialog:function(){this.$(".send-gift").removeAttr("disabled");this.$(".send-gift").removeClass("processing");this.$(".dialog-x").removeAttr("disabled");this.__displayBuyCreditDialog()},__displayBuyCreditDialog:function(){var a=this.__orderTotal-this.__currentWealth();return this.dialogManager.showDollarStoreDialog({totalAmount:0<a?a:0}).finished.then(function(){}.bind(this)).catch(function(){}.bind(this))},__sendGift:function(){this.$(".send-gift").prop("disabled",!0);this.$(".send-gift").addClass("processing");this.$(".dialog-x").prop("disabled",!0);this.__orderTotal>this.__currentWealth()?this.__showTooFewCreditsDialog():this.__checkPurchase().then(function(){return this.__purchaseProducts().then(function(){this.__googleAnalytics.recordBuyAnItem("purchased");var a=this.__userPicker?this.__userPicker.userCollection.models:[this.__recipient];return this.__dialogManager.alert({title:this.__stringManager.get("gifting_dialog_success_title"),text:this.__stringManager.getPluralized("gifting_dialog_success_text",{howMany:a.length-1,name:a[0].get("display_name")}),ok:this.__stringManager.get("gifting_dialog_success_ok")}).finished.catch(function(){return this.Promise.resolve()}.bind(this))}.bind(this)).then(function(){this.promiseResolver.resolve()}.bind(this)).catch(function(a){this.$(".send-gift").removeAttr("disabled");this.$(".send-gift").removeClass("processing");this.$(".dialog-x").removeAttr("disabled");return this.__dialogManager.alert({title:this.__stringManager.get("checkout_error_title"),text:this.__stringManager.get("checkout_error_text"),ok:this.__stringManager.get("checkout_error_button")}).finished.then(function(){this.promiseResolver.reject()}.bind(this))}.bind(this))}.bind(this)).catch(function(a){this.$(".send-gift").removeAttr("disabled");this.$(".send-gift").removeClass("processing");this.$(".dialog-x").removeAttr("disabled");a=this.__recipient?this.__getErrorText(a.data.failed_recipients[0],this.__recipient):this.__stringManager.getPluralized("gifting_dialog_failed_recipients",{howMany:0});this.__dialogManager.alert({title:this.__stringManager.get("checkout_error_title"),text:a,ok:this.__stringManager.get("checkout_error_button")}).finished.then(this.__failedPurchaseContinue.bind(this),this.__failedPurchaseContinue.bind(this));return this.Promise.reject()}.bind(this))},__failedPurchaseContinue:function(){this.__recipient?this.promiseResolver.resolve(!0):this.__checkRecipients()},__buyCreditsClicked:function(){this.__recordEvent("buy_credits",{record:!0},"not_enough_credits_dialog");this.__window.open("/store?platform="+this.__serviceProvider.get("storePlatform"))},__checkPurchase:function(){var a=this.__recipient?[this.__recipient.get("legacy_cid")]:this.__userPicker.userCollection.map(function(d){return d.get("legacy_cid")}.bind(this));return this.__myself.populated().then(function(){return this.__restModelFactory.simplePOST(this.__giftUrl+"?check",{sender_id:this.__myself.get("legacy_cid"),type_id:"product",item_id:this.__product.get("product_id"),giftwrap_id:0,recipients:a})}.bind(this)).then(function(d){return"failure"===d.data.result?this.Promise.reject(d):this.Promise.accept()}.bind(this))},__purchaseProducts:function(){var a;return this.__myself.populated().then(function(){a=this.__myself.searchEdgeCollection("conversations",{limit:0},h.Model.ConversationCollection);return a.populated()}.bind(this)).then(function(){var d={participants:this.__recipient?[this.__recipient.id]:this.__userPicker.userCollection.map(function(b){return b.id}.bind(this)),payloads:[{type:"gift",giftwrap:0,giftType:"product",giftId:this.__product.id}]},e=this.$(".add-message .message")[0].value;e&&0<e.length&&d.payloads.push({type:"text",content:e});return a.create(d)}.bind(this))},__goBack:function(){this.promiseResolver.resolve(!0)},__getErrorText:function(a,d){var e={"GIFT-005":"gifting_recipient_no_ap","GIFT-006":"gifting_recipient_already_owns_none"}[a.reason_code];return e?this.__stringManager.get(e,{name:d.get("display_name")}):a.reason}})}({Dialogs:m["@Dialogs"],Model:m["@Model"],NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],ByLineWidget:x,FormatNumber:D,GiftingProduct:v,MobileBrowser:N,backButtonTemplate:A,creditsValueTemplate:M,headerCreditsTemplate:O,template:L});M=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){return"\n            <figure class='vip-upsell-banner-wrapper'>\n                <img src='https://static-akm.imvu.com/imvufiles/5_percent_banner.svg' alt='Save 5% with diamond or platinum VIP'/>\n            </figure>\n        "},3:function(c,a,d,e){var b;d=a.helperMissing;var g='\n            <div class="order-row order-subtotal">\n                ',f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Subtotal",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='\n                <div class="order-row-credits credits-value"></div>\n            </div>\n            <div class="order-row vip-discount">\n                ';if((f=(b=a.icon||c&&c.icon||d,b.call(c,"icon-vip_cart_discount_upsell_diamond",{name:"icon",hash:{class:"vip-discount-icon"},data:e})))||0===f)g+=f;g+="\n                5% ";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"VIP Discount",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+'\n                <div class="order-row-credits">-<span class="credits-value"></span></div>\n            </div>\n            '},5:function(c,a,d,e){var b,g=a.helperMissing;d='\n                <div class="order-row-vcoin vcoin-value"><div class="flex wh-15 mr-5">';if((a=(b=a.icon||c&&c.icon||g,b.call(c,"icon-vcoin",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)d+=a;return d+"</div></div>\n                "},7:function(c,a,d,e){return'\n                <div class="order-row-credits credits-value"></div>\n                '},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=a.helperMissing;var g='<div class="checkout-container">\n    <div class="cart-list-container">\n        <div class="cart-list"></div>\n        ',f=a["if"].call(c,c&&c.showUpsellBanner,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)g+=f;g+="\n        <p class='distinguish-cart-blurb'>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Distinguish_Cart_Blurb",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</p>\n    </div>\n    <div class="checkout-bottom-container checkout-bottom-container--vip-upsell">\n        <div class="order-totals">\n            ';if((f=a["if"].call(c,c&&c.showSavings,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)g+=f;g+='\n            <div class="order-row order-total">';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Total",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n                (<span class='item-count'></span>)\n                ";if((f=a["if"].call(c,c&&c.isNFT,{name:"if",hash:{},fn:this.program(5,e),inverse:this.program(7,e),data:e}))||0===f)g+=f;g+='\n            </div>\n        </div>\n        <div class="vip-upsell purchase-free">\n            <span class="icon icon-vip-crown"></span>\n            ';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_upsell_get_purchase_free",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+'\n            <span class="icon icon-vip-crown"></span>\n        </div>\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary buy-now flex justify-center items-center">\n        <div class="buy-now-text"></div>\n        <div class="buy-now-amount"></div>\n    </button>\n<\/script>\n'},useData:!0})}({});x=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b,g=a.helperMissing;d='<div class="distinguish-border"></div>\n<div class="distinguish-status">';if((a=(b=a.icon||c&&c.icon||g,b.call(c,"icon-distinguish_badge",{name:"icon",hash:{},data:e})))||0===a)d+=a;return d+"</div>"},useData:!0})}({});x=function(h){var c=h.UiCore.UiContext;return c.extend("DistinguishStatus",{className:"distinguish-status-shields",uiContextName:"distinguish_status",dependencies:["featureAccessManager","model"],initialize:function(a){c.prototype.initialize.call(this,a);this.__position=a.position?a.position:"start-start";this.addToDOM()},render:function(){var a=this;this.__model&&this.doWork([function(){return a.__model.populated()},function(){var d=a.__model.node?a.__model.node:a.__model;if(d.get("has_plus_badge")||d.get("is_plus_badge_compatible"))a.$el.html(h.template({})),a.$el.addClass(a.__position);a.__setAsRendered()}])}})}({Model:m["@Model"],UiCore:m["@UiCore"],template:x});A=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b,g=a.helperMissing;d='<div class="nft-status-badge-container">';if((a=(b=a.icon||c&&c.icon||g,b.call(c,"icon-nft",{name:"icon",hash:{},data:e})))||0===a)d+=a;return d+"</div>"},useData:!0})}({});A=function(h){var c=h.UiCore.UiContext;return c.extend("NFTStatusBadge",{className:"nft-status-badge",uiContextName:"nft_status_badge",dependencies:["featureAccessManager","model"],initialize:function(a){c.prototype.initialize.call(this,a);this.__position=a.position?a.position:"offset-10";this.addToDOM()},render:function(){var a=this;this.__model&&this.doWork([function(){return a.__model.populated()},function(){var d=a.__model.node?a.__model.node:a.__model,e=a.__featureAccessManager.canSeeNFT();d=d.get("is_nft");e&&d&&(a.$el.html(h.template({})),a.$(".nft-status-badge-container").addClass(a.__position))}])}})}({Model:m["@Model"],UiCore:m["@UiCore"],template:A});v=function(h){return{render:function(c,a){c.html(h.template(a));c.find(".product-select").prop("checked",a.checked);if(a.preview_image){var d=a.preview_image;a.imageHeight&&a.imageWidth&&(d=IMVU.URI.build(d,{width:a.imageWidth,height:a.imageHeight}));c.find("img").attr({src:d})}a.creator&&(c.addClass("has-creator"),c.find(".creator-name").text(a.creator.display_name))}}}({template:function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){return"\n    <div class='also-tried-on'>YOU ALSO TRIED ON</div>\n"},3:function(c,a,d,e){return'<button class="btn ap ap-badge"></button>'},5:function(c,a,d,e){var b;d=this.escapeExpression;return"\n        <div class='name'>"+d((b=a.name||c&&c.name,"function"===typeof b?b.call(c,{name:"name",hash:{},data:e}):b))+"</div>\n    "},7:function(c,a,d,e){var b,g=a.helperMissing;d=this.escapeExpression;var f="\n    <div class='price-vcoin font-medium text-12 flex'>\n        <div class=\"wh-15 mr-5\">";if((g=(b=a.icon||c&&c.icon||g,b.call(c,"icon-vcoin",{name:"icon",hash:{class:"wh-full"},data:e})))||0===g)f+=g;return f+'</div>\n        <div class="vcoin-value">'+d((b=a.price||c&&c.price,"function"===typeof b?b.call(c,{name:"price",hash:{},data:e}):b))+"</div>\n    </div>\n    "},9:function(c,a,d,e){var b,g=a.helperMissing;d=this.escapeExpression;var f="\n    <div class='price-credits font-medium text-12 flex'>\n        <div class=\"wh-15 mr-5\">";if((g=(b=a.icon||c&&c.icon||g,b.call(c,"icon-credits",{name:"icon",hash:{class:"wh-full"},data:e})))||0===g)f+=g;return f+'</div>\n        <div class="credits-value">'+d((b=a.price||c&&c.price,"function"===typeof b?b.call(c,{name:"price",hash:{},data:e}):b))+"</div>\n    </div>\n    "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=this.escapeExpression;var g="",f=a["if"].call(c,c&&c.also_tried_on,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)g+=f;g+="\n<input id='cart-item-"+d((b=a.product_id||c&&c.product_id,"function"===typeof b?b.call(c,{name:"product_id",hash:{},data:e}):b))+"' class='checkbox product-select' "+d((b=a.checked||c&&c.checked,"function"===typeof b?b.call(c,{name:"checked",hash:{},data:e}):b))+" type='checkbox'>\n<label class='product-info' for='cart-item-"+d((b=a.product_id||c&&c.product_id,"function"===typeof b?b.call(c,{name:"product_id",hash:{},data:e}):b))+"'>\n    <div class='cart-image placeholder-container'>\n        <img>\n        <div class=\"cover-image-placeholder hidden\"></div>\n        ";if((f=a["if"].call(c,c&&c.isAp,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n    </div>\n    ";if((f=a["if"].call(c,c&&c.name,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n    <div class='creator'></div>\n    ";if((f=a["if"].call(c,c&&c.isNFT,{name:"if",hash:{},fn:this.program(7,e),inverse:this.program(9,e),data:e}))||0===f)g+=f;return g+"\n</label>\n"},useData:!0})}({})});x=function(h){var c=h.UiCore.UiContext;return c.extend("CartListItem",{tagName:"li",className:"cart-list-item",uiContextName:"item",dependencies:["featureAccessManager","globalStringManager","loginManager","productImageManager","Promise"],trackedEvents:function(){return[{type:"click",selector:".product-select",name:"change_product_select",handler:this.__changeProductSelect.bind(this)}]},initialize:function(a){c.prototype.initialize.call(this,a);this.loginManager=a.loginManager;this.__myself=a.loginManager.getCurrentUser();this.imageHeight=a.imageHeight?a.imageHeight:null;this.imageWidth=a.imageWidth?a.imageWidth:null;this.__formatNumber=h.FormatNumber;this.__priceResolver=null;this.__pricePromise=new this.__Promise(function(d){this.__priceResolver=d}.bind(this));this.__filterModel=this.__serviceProvider.create(h.Model.FilterModel,[],{});this.__filterModel.setCategoryByProduct(this.model);this.__productImageManager=a.productImageManager;this.addToDOM()},render:function(){this.model.populated().then(function(){var a=this.__getDetails();h.CartListItemUi.render(this.$el,a);a=this.model.get("preview_image");this.__setImage(a,this.imageWidth,this.imageHeight);this.model.getSingleEdge("creator").populated().then(function(d){this.__displayName=this.createChildContext(h.WAFWidgets.DisplayName,{$parentElement:this.$(".creator"),user:d,size:"tiny",color:"dark",showVipBadge:!1,ignoreClicks:!0,prefix:this.__globalStringManager.get("By")})}.bind(this));this.createChildContext(h.DistinguishStatus,{$parentElement:this.$(".cart-image"),model:this.model,position:"small end-start"});this.__featureAccessManager.canSeeNFT()&&this.createChildContext(h.NFTStatusBadge,{$parentElement:this.$(".cart-image"),model:this.model,position:"offset-5"})}.bind(this))},__getDetails:function(){this.__getPrice();return this.__pricePromise.then(function(a){return{name:this.model.get("product_name"),price:this.__formatNumber.formatCredits(Number(a)),checked:this.model.get("is_selected"),product_id:this.model.get("product_id"),also_tried_on:this.model.get("also_tried_on"),isAp:"AP"===this.model.get("rating"),preview_image:this.model.get("preview_image"),imageWidth:this.imageWidth,imageHeight:this.imageHeight,isNFT:this.__featureAccessManager.canSeeNFT()&&this.model.get("is_nft")}}.bind(this)).result},__getPrice:function(){var a=this.model.get("product_price");this.model.get("is_nft")&&(a=this.model.get("vcoin_price"));if(this.model.get("is_bundle")){var d=this.model.getEdgeCollection("subproducts",h.Model.ProductEdgeCollection);d.populated().then(function(){d.map(function(e){e.node.get("is_owned")&&80!=e.node.get("product_id")&&191!=e.node.get("product_id")&&(a-=e.node.get("product_price"))}.bind(this));this.__priceResolver.accept(a)}.bind(this))}else this.__priceResolver.accept(a)},__changeProductSelect:function(a){this.model.set("is_selected",!!$(a.target).prop("checked"))},__setImage:function(a,d,e){d&&e&&(a=IMVU.URI.build(this.model.get("preview_image"),{width:this.imageWidth,height:this.imageHeight}));this.__productImageManager.getProductImage(this.$("img"),a,this.__filterModel.get("category"),this.$el,this.$(".cover-image-placeholder"))}})}({Model:m["@Model"],UiCore:m["@UiCore"],WAFWidgets:m["@WAFWidgets"],CartListItemUi:v,DistinguishStatus:x,FormatNumber:D,NFTStatusBadge:A});x=function(h){var c=h.UiCore.ListPresenter;return c.extend("CartList",{uiContextName:"cart_list",className:"cart-list",initialize:function(a){a.imageWidth=80;a.imageHeight=80;this.itemFactory=a.itemFactory||h.CartListItem;c.prototype.initialize.call(this,a)}})}({UiCore:m["@UiCore"],CartListItem:x});A=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b,g=a.helperMissing;d=this.escapeExpression;var f="<div class='credits-value-wrapper font-medium text-12 flex items-center'>\n    <div class=\"flex wh-15 mr-5\">";if((g=(b=a.icon||c&&c.icon||g,b.call(c,"icon-credits",{name:"icon",hash:{class:"wh-full"},data:e})))||0===g)f+=g;return f+'</div>\n    <div class="credits-value">'+d((b=a.totalCredits||c&&c.totalCredits,"function"===typeof b?b.call(c,{name:"totalCredits",hash:{},data:e}):b))+"</div>\n</div>\n"},useData:!0})}({});v=function(h){var c=h.Dialogs.AlloyModalDialog;return c.extend("TooltipDialog",{uiContextName:"tooltip_dialog",className:"tooltip-dialog dialog-type-B text-close",trackedEvents:function(){return this.__customTrackedEvents},initialize:function(a){this.__customTrackedEvents=a.trackedEvents||[];c.prototype.initialize.call(this,a);this.title=a.title;this.__tooltipContent=a.tooltipContent;this.addToDOM()},postRender:function(){this.setContent("body",this.__tooltipContent)}})}({Dialogs:m["@Dialogs"]});v=function(h){var c=h.UiCore.UiContext;return c.extend("Tooltip",{className:"tooltip",uiContextName:"tooltip",dependencies:["dialogManager","timer","tooltipLayer","window"],trackedEvents:function(){return[{type:"click",selector:"a",name:"link_click",handler:"__clickedLink",allowBubble:!0}].concat(this.__customTrackedEvents)},__installTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.on("mouseenter.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.$target.off("mouseleave.tooltip")}.bind(this));this.__tooltipLayer.$el.on("mouseleave.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__tooltipTimeout);this.__tooltipTimeout=this.__timer.setTimeout(function(){this.setVisible(!1);this.__timer.clearTimeout(this.__tooltipTimeout);this.__tooltipTimeout=this.__timer.setTimeout(function(){this.__hide();this.__installTargetMouseleave()}.bind(this),125)}.bind(this),250)}.bind(this))},__removeTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.off(".tooltip")},initialize:function(a){this.$tooltip=IMVU.requireProperty(a,"$replaceElement");this.$target=IMVU.requireProperty(a,"$tooltipTarget");this.tooltipTitle=IMVU.optionalProperty(a,"title",!1);this.__tooltipStyle=IMVU.optionalProperty(a,"tooltipStyle","default");this.__tooltipPosition=IMVU.optionalProperty(a,"tooltipPosition","default");this.__positionDelta=IMVU.optionalProperty(a,"positionDelta",0);this.__forceTargetToUseOuterWidth=IMVU.optionalProperty(a,"forceTargetToUseOuterWidth",!1);this.__customTrackedEvents=a.trackedEvents||[];c.prototype.initialize.call(this,a);this.$body=$("body");this.$globalNav=$("nav.global-nav:visible");if("mobile"===this.__serviceProvider.get("platform"))this.$target.on("click.tooltip",function(d){d.stopPropagation();this.__openTooltipDialog()}.bind(this));else this.$target.on("mouseenter.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.__timer.clearTimeout(this.__targetFadeinTimeout);this.__installTargetMouseleave();this.__targetFadeinTimeout=this.__timer.setTimeout(function(){this.setVisible(!0);this.__show()}.bind(this),250)}.bind(this));"snug"===this.__tooltipStyle&&this.$el.addClass("tooltip-snug");this.$el.append(this.$tooltip);this.setParentUiContext(this.__tooltipLayer);this.__tooltipLayer.$el.append(this.$el);this.__setAsRendered()},setVisible:function(a){this.$el.toggleClass("tooltip-open",!!a)},__installTargetMouseleave:function(){this.$target.on("mouseleave.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__targetTimeout=this.__timer.setTimeout(function(){this.setVisible(!1);this.__timer.clearTimeout(this.__targetTimeout);this.__targetTimeout=this.__timer.setTimeout(function(){this.__hide()}.bind(this),125)}.bind(this),250)}.bind(this))},__show:function(){this.__installTooltipLayerEventHandlers();this.__trackTooltip();$(this.__window).on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this));this.$body.find(".transparent-overlay").on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this))},trackTooltip:function(){this.__trackTooltip()},__trackTooltip:function(){var a=this.$globalNav.height()||0,d=this.$target[0].getBoundingClientRect().top,e=this.$target[0].getBoundingClientRect().left,b=$(window).width()-(e+this.$target.outerWidth()/2),g=this.$el[0].offsetWidth;0<this.$target.parents(".dialog-manager").length&&(a=0);var f=this.$target.width();this.__forceTargetToUseOuterWidth&&(f=this.$target.outerWidth());b=b>g?e+f/2:e+f/2-g;"bottom"===this.__tooltipPosition?(b=e-this.$tooltip.outerWidth()/2,d=this.$target[0].getBoundingClientRect().bottom-this.__positionDelta):"above"===this.__tooltipPosition?(b=e+f/2-g,d=this.$target[0].getBoundingClientRect().top-this.$el[0].offsetHeight):"left"===this.__tooltipPosition?(b=e-f-g-this.__positionDelta,d=this.$target[0].getBoundingClientRect().top):"bottom-left-edge"===this.__tooltipPosition&&(b=e,d=0);this.$el.css({"margin-top":Math.max(d,a),"margin-left":b})},__hide:function(){this.__removeTooltipLayerEventHandlers();this.setVisible(!1)},__openTooltipDialog:function(){return this.__dialogManager.showDialog(h.TooltipDialog,{title:this.tooltipTitle||this.$target.text(),tooltipContent:this.$tooltip.html(),trackedEvents:this.__customTrackedEvents})},delete:function(){this.$el.removeAttr("style");this.__timer.clearTimeout(this.__targetFadeinTimeout);this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.$target.off(".tooltip");this.__removeTooltipLayerEventHandlers();$(this.__window).off("scroll.tooltip");this.$body.find(".transparent-overlay").off("scroll.tooltip");c.prototype.delete.call(this)},__clickedLink:function(a){this.__hide()}})}({UiCore:m["@UiCore"],TooltipDialog:v});N=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b,g=a.helperMissing;d=this.escapeExpression;var f="<div class='vcoin-value-wrapper font-medium text-12 flex items-center'>\n    <div class=\"flex wh-15 mr-5\">";if((g=(b=a.icon||c&&c.icon||g,b.call(c,"icon-vcoin",{name:"icon",hash:{class:"wh-full"},data:e})))||0===g)f+=g;return f+'</div>\n    <div class="vcoin-value">'+d((b=a.totalVcoin||c&&c.totalVcoin,"function"===typeof b?b.call(c,{name:"totalVcoin",hash:{},data:e}):b))+"</div>\n</div>\n"},useData:!0})}({});O=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){return'<div class="back-button"></div>'},useData:!0})}({});var P=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b;d=this.escapeExpression;var g=a.helperMissing,f='\n            <img class="upsell_after_gift_product-ad" src="'+d((b=a.product_ad_url||c&&c.product_ad_url,"function"===typeof b?b.call(c,{name:"product_ad_url",hash:{},data:e}):b))+'">\n            <div class="upsell_after_gift_recipient_received">'+d((b=a.giftRecipient||c&&c.giftRecipient,"function"===typeof b?b.call(c,{name:"giftRecipient",hash:{},data:e}):b))+" ";if((g=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"received_your_gift",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+'</div><br/>\n            <div class="upsell_after_gift_title">'+d((b=a.subtitle||c&&c.subtitle,"function"===typeof b?b.call(c,{name:"subtitle",hash:{},data:e}):b))+"</div>\n        "},3:function(c,a,d,e){var b;d=this.escapeExpression;return'\n            <img class="product-ad" src="'+d((b=a.product_ad_url||c&&c.product_ad_url,"function"===typeof b?b.call(c,{name:"product_ad_url",hash:{},data:e}):b))+'">\n            <div class="title">'+d((b=a.subtitle||c&&c.subtitle,"function"===typeof b?b.call(c,{name:"subtitle",hash:{},data:e}):b))+"</div>\n        "},5:function(c,a,d,e){var b;d=a.helperMissing;var g='\n        <div class="vcoin-bullet-wrapper">\n            <div>',f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vcoin_upsell_bullet_intro",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='</div>\n            <ul class="vcoin-upsell-points">\n                <li>';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vcoin_upsell_bullet_point_1",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n                <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vcoin_upsell_bullet_point_2",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n                <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vcoin_upsell_bullet_point_3",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n            </ul>\n            <div>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vcoin_upsell_description_2",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</div>\n            \n        </div>\n        "},7:function(c,a,d,e){var b,g=a.helperMissing;d='\n    <button class="btn btn-primary btn-dark greeter-cta">';if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"JOIN NOW",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</button>\n"},9:function(c,a,d,e){d='\n    <button class="btn btn-primary checkout-cta disabled">\n        ';if((c=a["if"].call(c,c&&c.simulated,{name:"if",hash:{},fn:this.program(10,e),inverse:this.program(12,e),data:e}))||0===c)d+=c;return d+"\n    </button>\n"},10:function(c,a,d,e){var b,g=a.helperMissing;d="\n            ";if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"buy_now",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n        "},12:function(c,a,d,e){d="\n            ";if((c=a["if"].call(c,c&&c.upsellAfterGift,{name:"if",hash:{},fn:this.program(13,e),inverse:this.program(15,e),data:e}))||0===c)d+=c;return d+"\n        "},13:function(c,a,d,e){var b,g=a.helperMissing;d="\n                ";if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"upsell_after_gift_cta",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n            "},15:function(c,a,d,e){var b,g=a.helperMissing;d=this.escapeExpression;var f="\n                ";if((g=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"buy_now_for",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+" "+d((b=a.sale_price||c&&c.sale_price,"function"===typeof b?b.call(c,{name:"sale_price",hash:{},data:e}):b))+"\n            "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){d='<div class="dialog-body-scroller">\n    <div class="multicart-upsell-panel">\n        ';var b=a["if"].call(c,c&&c.upsellAfterGift,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(b||0===b)d+=b;d+='\n        <div class="description"></div>\n        ';if((b=a["if"].call(c,c&&c.vcoinUpsell,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===b)d+=b;d+='\n        <div class="product-selectors"></div>\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n';if((b=a["if"].call(c,c&&c.greeter,{name:"if",hash:{},fn:this.program(7,e),inverse:this.program(9,e),data:e}))||0===b)d+=b;return d+"\n<\/script>\n"},useData:!0})}({}),G=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b;d=a.helperMissing;var g='\n<div class="vip_web_tier_1-description">\n    <p>',f=a["if"].call(c,c&&c.isCreatorLanding,{name:"if",hash:{},fn:this.program(2,e),inverse:this.program(4,e),data:e});if(f||0===f)g+=f;g+="</p>\n    <ul>\n        <li><strong>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_host_shields",{name:"i18n-g",hash:{tier:"Gold"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_credits_per_month",{name:"i18n-g",hash:{credits:"2,000"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_live",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+=" or ";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_chat",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_hours",{name:"i18n-g",hash:{hours:"2"},data:e})))||0===f)g+=f;g+=" ";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_broadcasting",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n    </ul>\n    <ul>\n        ";if((f=a["if"].call(c,c&&c.canSeeYouTube,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_tips",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_support",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_gifts",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</li>\n    </ul>\n</div>\n"},2:function(c,a,d,e){var b,g=a.helperMissing;d="\n        ";if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"vip_upsell_creator_landing_body",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n    "},4:function(c,a,d,e){var b,g=a.helperMissing;d="\n        ";if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"vip_product_prop_description",{name:"i18n-g",hash:{tier:"Gold"},data:e})))||0===a)d+=a;return d+"\n    "},6:function(c,a,d,e){var b,g=a.helperMissing;d="\n        <li>";if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"vip_product_prop_streaming",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</li>\n        "},8:function(c,a,d,e){var b;d=a.helperMissing;var g='\n<div class="vip_web_tier_2-description active">\n    <p>',f=a["if"].call(c,c&&c.isCreatorLanding,{name:"if",hash:{},fn:this.program(2,e),inverse:this.program(9,e),data:e});if(f||0===f)g+=f;g+="</p>\n    <ul>\n        <li><strong>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_host_shields",{name:"i18n-g",hash:{tier:"Platinum"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_credits_per_month",{name:"i18n-g",hash:{credits:"5,000 - 7,400"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_rooms_and_live",{name:"i18n-g",hash:{live:"2",rooms:"5"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_hours",{name:"i18n-g",hash:{hours:"6"},data:e})))||0===f)g+=f;g+=" ";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_broadcasting",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n    </ul>\n    <ul>\n        ";if((f=a["if"].call(c,c&&c.canSeeYouTube,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_loyalty_credits",{name:"i18n-g",hash:{url:"https://help.imvu.com/s/article/How-do-the-VIP-5000-Credits-Work?language=en_US",credits:"200"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_tips",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_support",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_gifts",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_whisper",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_no_ads",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_creator",{name:"i18n-g",hash:{url:"https://www.imvu.com/creatorlanding/explore"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_dressup",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_avatar_actions",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_percent_off_everything",{name:"i18n-g",hash:{percent:"5"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_percent_off_badges",{name:"i18n-g",hash:{percent:"10"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_shop_together",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</li>\n    </ul>\n</div>\n"},9:function(c,a,d,e){var b,g=a.helperMissing;d="\n        ";if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"vip_product_prop_description",{name:"i18n-g",hash:{tier:"Platinum"},data:e})))||0===a)d+=a;return d+"\n    "},11:function(c,a,d,e){var b;d=a.helperMissing;var g='\n<div class="vip_web_tier_3-description">\n    <p>',f=a["if"].call(c,c&&c.isCreatorLanding,{name:"if",hash:{},fn:this.program(2,e),inverse:this.program(12,e),data:e});if(f||0===f)g+=f;g+="</p>\n    <ul>\n        <li><strong>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_host_shields",{name:"i18n-g",hash:{tier:"Diamond"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_credits_per_month",{name:"i18n-g",hash:{credits:"6,000 - 8,400"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_rooms_and_live",{name:"i18n-g",hash:{live:"3",rooms:"10"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_unlimited",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+=" ";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_broadcasting",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_unlimited",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+=" ";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_friend_matches",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n    </ul>\n    <ul>\n        ";if((f=a["if"].call(c,c&&c.canSeeYouTube,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_loyalty_credits",{name:"i18n-g",hash:{url:"https://help.imvu.com/s/article/How-do-the-VIP-5000-Credits-Work?language=en_US",credits:"200"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_tips",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_support",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_gifts",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_whisper",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_no_ads",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_creator",{name:"i18n-g",hash:{url:"https://www.imvu.com/creatorlanding/explore"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_dressup",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_avatar_actions",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_percent_off_everything",{name:"i18n-g",hash:{percent:"5"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_percent_off_badges",{name:"i18n-g",hash:{percent:"10"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_shop_together",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_product_prop_daily_spin",{name:"i18n-g",hash:{spins:"2"},data:e})))||0===f)g+=f;return g+"</li>\n    </ul>\n</div>\n"},12:function(c,a,d,e){var b,g=a.helperMissing;d="\n        ";if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"vip_product_prop_description",{name:"i18n-g",hash:{tier:"Diamond"},data:e})))||0===a)d+=a;return d+"\n    "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){d="";var b=a["if"].call(c,c&&c.vip_web_tier_1,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(b||0===b)d+=b;d+="\n\n";if((b=a["if"].call(c,c&&c.vip_web_tier_2,{name:"if",hash:{},fn:this.program(8,e),inverse:this.noop,data:e}))||0===b)d+=b;d+="\n\n";if((b=a["if"].call(c,c&&c.vip_web_tier_3,{name:"if",hash:{},fn:this.program(11,e),inverse:this.noop,data:e}))||0===b)d+=b;return d},useData:!0})}({}),H=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b;d=this.escapeExpression;return"\n        "+d((b=a.header_text||c&&c.header_text,"function"===typeof b?b.call(c,{name:"header_text",hash:{},data:e}):b))+"\n    "},3:function(c,a,d,e){var b;d=this.escapeExpression;return"\n        "+d((b=a.category||c&&c.category,"function"===typeof b?b.call(c,{name:"category",hash:{},data:e}):b))+"\n    "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){d='\n<legend class="system-info-header">\n    ';if((c=a["if"].call(c,c&&c.header_text,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===c)d+=c;return d+"\n    <span class='more-items hidden'>\n        <span class='indicator'>+&nbsp;</span><span class='description'></span>\n    </span>\n</legend>\n"},useData:!0})}({}),B=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b;d=this.escapeExpression;var g=a.helperMissing,f="\n        ",k=a["if"].call(c,c&&c.is_popular,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+='\n\n        <div class="left">\n            <div class="icon icon-wrapper"><img src="'+d((b=a.image||c&&c.image,"function"===typeof b?b.call(c,{name:"image",hash:{},data:e}):b))+'"></div>\n        </div>\n        <div class="middle">\n            <div class="line1">'+d((b=a.title||c&&c.title,"function"===typeof b?b.call(c,{name:"title",hash:{},data:e}):b))+'</div>\n            <div class="line2">'+d((b=a.line2_text||c&&c.line2_text,"function"===typeof b?b.call(c,{name:"line2_text",hash:{},data:e}):b))+'</div>\n            <div class="line3">\n                ';if((k=a["if"].call(c,c&&c.has_discount,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===k)f+=k;f+='\n                <span class="sale-price">'+d((b=a.sale_price||c&&c.sale_price,"function"===typeof b?b.call(c,{name:"sale_price",hash:{},data:e}):b))+'</span>\n            </div>\n        </div>\n        <div class="right">\n            <div class="inner">\n                <span class="label-active hidden">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"ACTIVE",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+"</span>\n            </div>\n        </div>\n    "},2:function(c,a,d,e){var b,g=a.helperMissing;d='\n            <div class="promo-banner most-popular"><span>';if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"MOST POPULAR",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+'</span><div class="triangle"></div></div>\n        '},4:function(c,a,d,e){var b;d=this.escapeExpression;return'\n                    <span class="original-price">'+d((b=a.price||c&&c.price,"function"===typeof b?b.call(c,{name:"price",hash:{},data:e}):b))+"</span>\n                "},6:function(c,a,d,e){var b;d=a.helperMissing;var g=this.escapeExpression,f="\n\n        ",k=a["if"].call(c,c&&c.has_discount,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+="\n\n        <span class='pend-multiplier hidden' pend-count='0'>\n            <div class=\"pend-tooltip\">\n                <div class=\"tooltip-header\">";if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"PENDING_TOOLTIP_TITLE",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</div>\n                <div class="tooltip-body">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"PENDING_TOOLTIP_DESC",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</div>\n            </div>\n        </span>\n        <span class='multiplier' cart-count='0'></span>\n\n        ";if((k=a["if"].call(c,c&&c.is_popular,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n\n        ";if((k=a["if"].call(c,c&&c.is_best,{name:"if",hash:{},fn:this.program(9,e),inverse:this.noop,data:e}))||0===k)f+=k;f+='\n        <div class="item-info">\n            <div class="image-container icon-wrapper"><span class="helper"></span><img src="'+g((b=a.image||c&&c.image,"function"===typeof b?b.call(c,{name:"image",hash:{},data:e}):b))+'"></div>\n            <div class="title">'+g((b=a.title||c&&c.title,"function"===typeof b?b.call(c,{name:"title",hash:{},data:e}):b))+'</div>\n            <div class="title2">'+g((b=a.title2||c&&c.title2,"function"===typeof b?b.call(c,{name:"title2",hash:{},data:e}):b))+'</div>\n            <div class="title3">'+g((b=a.title3||c&&c.title3,"function"===typeof b?b.call(c,{name:"title3",hash:{},data:e}):b))+'</div>\n            <div class="icon icon-ok"></div>\n        </div>\n        <div class="item-price">\n            ';if((k=a["if"].call(c,c&&c.isActive,{name:"if",hash:{},fn:this.program(11,e),inverse:this.program(13,e),data:e}))||0===k)f+=k;return f+"\n        </div>\n    "},7:function(c,a,d,e){var b;d=this.escapeExpression;return'\n            <div class="promo-banner sale">'+d((b=a.sale_copy||c&&c.sale_copy,"function"===typeof b?b.call(c,{name:"sale_copy",hash:{},data:e}):b))+'<div class="triangle"></div></div>\n        '},9:function(c,a,d,e){var b,g=a.helperMissing;d='\n            <div class="promo-banner best-value"><span>';if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"BEST VALUE",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+'</span><div class="triangle"></div></div>\n        '},11:function(c,a,d,e){var b,g=a.helperMissing;d="\n                <span>";if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"ACTIVE",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</span>\n            "},13:function(c,a,d,e){var b;d=this.escapeExpression;var g="\n                \x3c!-- sales_price is source of truth, if discount show original price with sales price --\x3e\n                ",f=a["if"].call(c,c&&c.has_discount,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e});if(f||0===f)g+=f;return g+'\n                <span class="sale-price">'+d((b=a.sale_price||c&&c.sale_price,"function"===typeof b?b.call(c,{name:"sale_price",hash:{},data:e}):b))+"</span>\n            "},15:function(c,a,d,e){return'\n    <div class="separator"></div>\n'},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){d='<div class="wrapper">\n    ';var b=a["if"].call(c,c&&c.isMobileAndUpsell,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(6,e),data:e});if(b||0===b)d+=b;d+="\n</div>\n";if((b=a["if"].call(c,c&&c.isMobileAndUpsell,{name:"if",hash:{},fn:this.program(15,e),inverse:this.noop,data:e}))||0===b)d+=b;return d+"\n"},useData:!0})}({}),p=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=this.escapeExpression;return'<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-ghost btn-dark" data-confirm="no">'+d((b=a.no||c&&c.no,"function"===typeof b?b.call(c,{name:"no",hash:{},data:e}):b))+'</button>\n    <button class="btn btn-primary btn-dark" data-confirm="yes">'+d((b=a.yes||c&&c.yes,"function"===typeof b?b.call(c,{name:"yes",hash:{},data:e}):b))+"</button>\n<\/script>\n"},useData:!0})}({}),y=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b;d='\n<div class="id-body-contents">';if((a=(b=a.html||c&&c.html,"function"===typeof b?b.call(c,{name:"html",hash:{},data:e}):b))||0===a)d+=a;return d+"</div>\n"},3:function(c,a,d,e){var b;d=this.escapeExpression;return'\n<p class="id-body-contents">'+d((b=a.text||c&&c.text,"function"===typeof b?b.call(c,{name:"text",hash:{},data:e}):b))+"</p>\n"},5:function(c,a,d,e){var b;d=a.helperMissing;var g=this.escapeExpression,f='\n<p class="terms-of-service">\n    <span>',k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"dialog_for_your_reference_terms_of_service",{name:"i18n-g",hash:{},data:e}));if(k||0===k)f+=k;f+=' <a data-external href="'+g((b=a.policyHubUrl||c&&c.policyHubUrl,"function"===typeof b?b.call(c,{name:"policyHubUrl",hash:{},data:e}):b))+'" target="_blank">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Terms of Service",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+"</a>.</span>\n</p>\n"},7:function(c,a,d,e){var b;d=this.escapeExpression;var g='\n<div class="dialog-checkbox-container">\n    <input id="dialog-checkbox" type="checkbox" class="checkbox" ',f=a["if"].call(c,c&&c.checkedByDefault,{name:"if",hash:{},fn:this.program(8,e),inverse:this.noop,data:e});if(f||0===f)g+=f;return g+'><label for="dialog-checkbox">'+d((b=a.checkbox||c&&c.checkbox,"function"===typeof b?b.call(c,{name:"checkbox",hash:{},data:e}):b))+"</label>\n</div>\n"},8:function(c,a,d,e){return"checked"},10:function(c,a,d,e){d='\n<div class="dialog-dropdown-container">\n    <select id="dialog-dropdown">\n        ';var b=a["if"].call(c,(b=c&&c.dropdown,null==b||!1===b?b:b.placeholder),{name:"if",hash:{},fn:this.program(11,e),inverse:this.noop,data:e});if(b||0===b)d+=b;return d+"\n    </select>\n</div>\n"},11:function(c,a,d,e){var b;a=this.escapeExpression;return'\n        <option class="dropdown-placeholder" value="" disabled selected>'+a((b=(b=c&&c.dropdown,null==b||!1===b?b:b.placeholder),"function"===typeof b?b.apply(c):b))+"</option>\n        "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=this.escapeExpression;var g="",f=a["if"].call(c,c&&c.html,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(f||0===f)g+=f;g+="\n\n";if((f=a["if"].call(c,c&&c.termsOfService,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n\n";if((f=a["if"].call(c,c&&c.checkbox,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n\n";if((f=a["if"].call(c,c&&c.dropdown,{name:"if",hash:{},fn:this.program(10,e),inverse:this.noop,data:e}))||0===f)g+=f;return g+'\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary btn-dark" data-confirm="ok" disabled>'+d((b=a.ok||c&&c.ok,"function"===typeof b?b.call(c,{name:"ok",hash:{},data:e}):b))+"</button>\n<\/script>\n"},useData:!0})}({}),w=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){return'<div class="dropdown-label is-truncated"><span>&nbsp;</span></div>\n<div class="dropdown-option-list-container">\n    <div class="dropdown-scroll-up"></div>\n    <div class="dropdown-scroll-down"></div>\n    <ul class="dropdown-option-list">\n        <li class="dropdown-option is-truncated" data-value="" tabindex="-1"></li>\n    </ul>\n</div>\n'},useData:!0})}({});w=function(h){function c(e){e=$(e.target).closest(".dropdown");$(".dropdown").not(e).each(function(b,g){$(g).data("dropdown-instance").__hide()})}var a=h.UiCore.UiContext,d=h.NextUtil.Keys;return a.extend("Dropdown",{globalSetup:function(){document.addEventListener("click",c,!0);document.addEventListener("touchend",c,!0)},globalTearDown:function(){document.removeEventListener("click",c,!0);document.removeEventListener("touchend",c,!0)},uiContextName:"dropdown",className:"dropdown disable-text-selection",ITEM_HEIGHT:40,AUTO_SCROLL_BY:2,dependencies:["timer","window"],trackedEvents:function(){return[{type:"click",selector:".dropdown-label",name:"dropdown_label_click",handler:"toggleOpen"},{type:"click",selector:".dropdown-option",name:"dropdown_option_click",handler:"clickOption"},{type:"keydown",selector:"",name:"dropdown_keydown",handler:this.__onKeydown.bind(this,[])},{type:"mousemove",selector:".dropdown-option",name:"dropdown_option_mouseenter",handler:this.__onMousemove.bind(this,{x:0,y:0})},{type:"mouseenter",selector:".dropdown-label",name:"dropdown_label_mouseenter",handler:"__onMouseenterLabel"},{type:"mouseenter",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseenter",handler:"__onScrollUpMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseleave",handler:"__onScrollUpMouseleave"},{type:"mouseenter",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseenter",handler:"__onScrollDownMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseleave",handler:"__onScrollDownMouseleave"}]},__onMousemove:function(e,b){if(e.x!=b.screenX||e.y!=b.screenY)e.x=b.screenX,e.y=b.screenY,this.$el.focus(),this.setActiveElement($(b.target))},__onBlur:function(e){this.$el.removeClass("is-open")},__onMouseenterLabel:function(e){this.$(".is-selected").removeClass("is-selected")},initialize:function(e){this.$select=IMVU.requireProperty(e,"$replaceElement");if(!this.$select.is("select"))throw Error("$replaceElement must be a <select> element. got: "+this.$select[0].tagName);if(this.$select.closest("label").length)throw Error("do not wrap custom dropdowns with <label> tags; it disrupts event handling");a.prototype.initialize.call(this,e);this.window=e.window;this.timer=e.timer;this.boundingBox=e.boundingBox||this.getDefaultBoundingBox();this.document=e.document||document;this.__keyArray=[];if(this.dismissOnScroll=e.dismissOnScroll)$(e.dismissOnScroll).on("scroll.dropdown",function(){this.__hide()}.bind(this));$(".dropdown-layer").length||$("body").append('<div class="dropdown-layer"/>');this.$dropdownLayer=$(".dropdown-layer");e.dimNoValue&&this.$el.addClass("dim-no-value");e.lightText&&this.$el.addClass("light-text");e.hideArrow&&this.$el.addClass("hide-arrow");this.$el.data("dropdown-instance",this);this.addToDOM()},delete:function(){this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray);this.dismissOnScroll&&$(this.dismissOnScroll).off("scroll.dropdown");$(this.window).off("resize.dropdown");a.prototype.delete.call(this)},__onHidden:function(){this.$el.is(":visible")&&this.remove();a.prototype.__onHidden.apply(this,arguments)},getDefaultBoundingBox:function(){var e=this.$el.position().top-5*this.ITEM_HEIGHT,b=e+11*this.ITEM_HEIGHT;0>e&&(e=0);b>$(this.window).height()&&(b=$(this.window).height());return{x:0,y:e,w:$(this.window).width(),h:b-e}},render:function(){this.$placeholder=$("<div/>");this.$el.html(h.template);this.$label=this.$(".dropdown-label");this.$optionList=this.$(".dropdown-option-list");this.$optionListContainer=this.$(".dropdown-option-list-container");var e=this.$optionList.find(".dropdown-option");this.$select.addClass("is-enhanced");this.refreshLabel(this.$select.find(":selected"));e.remove();this.$select.children().each(function(b,g){b=e.clone(!0);b.text($(g).text());b.attr("data-text",$(g).text().toLowerCase());b.attr("data-value",$(g).val());this.$optionList.append(b)}.bind(this));this.$el.addClass(this.$select[0].className).removeClass("dropdown-template").addClass("dropdown");this.$label.append(this.$select);this.$el.attr("tabindex",this.$select.attr("tabindex")||"0");this.$select.attr("tabindex",-1);this.$optionList.on("scroll",this.__onScroll.bind(this));this.$select.on("change",this.__changedOption.bind(this));this.$el.addClass("is-ready")},__fullHeight:function(){return this.$select.children().length*this.ITEM_HEIGHT},__getSelectedIndex:function(){return this.$select[0].selectedIndex},__getTopEdgeInViewport:function(e){return e.offset().top-$(this.document).scrollTop()},__getComputedInfo:function(){var e=this.__getTopEdgeInViewport(this.$el),b=this.__fullHeight(),g=this.__getSelectedIndex()*this.ITEM_HEIGHT,f=this.getDefaultBoundingBox().y,k=this.getDefaultBoundingBox().y+this.getDefaultBoundingBox().h,l=e-g,n=l+b;l<f&&(l=f);if(n>k){var q=n-k;n=k;l>f&&(l-=Math.min(l-f,q))}return{projectedTopDiff:l-e,computedHeight:n-l,selectedTop:g,maxTop:f,maxBottom:k,fullHeight:b}},__refreshScrollers:function(){var e=this.$optionList[0].scrollHeight-this.$optionList.innerHeight(),b=0<this.$optionList.scrollTop();e=Math.round(this.$optionList.scrollTop())<e;this.$el.toggleClass("can-scroll-up",b).toggleClass("can-scroll-down",e)},isOpen:function(){return this.$el.hasClass("is-open")},__hide:function(){this.isOpen()&&($(this.window).off("resize.dropdown"),this.$el.removeClass("is-open"),this.$placeholder.before(this.$el).detach(),this.$el.removeAttr("style"))},__show:function(){if(!this.isOpen()){$(this.window).on("resize.dropdown",c);var e=this.$el.offset(),b=this.$el.width(),g=this.$el.height(),f=this.$el.css("margin-left"),k=this.$el.css("margin-right"),l=this.$el.css("margin-top"),n=this.$el.css("margin-bottom"),q=this.$el.css("float");this.$placeholder.css({width:b,height:g,"margin-left":f,"margin-right":k,"margin-top":l,"margin-bottom":n,float:q});this.$el.addClass("is-open").css({top:this.__getTopEdgeInViewport(this.$el),left:e.left,width:b,height:g,"margin-left":0,"margin-right":0,"margin-top":0,"margin-bottom":0});this.$el=this.$el.before(this.$placeholder).detach();this.$dropdownLayer.append(this.$el)}},toggleOpen:function(e){this.isOpen()?this.__hide():(this.__show(),e=this.__getComputedInfo(),this.$optionListContainer.css({top:e.projectedTopDiff,height:e.computedHeight}),this.$el.focus(),e=e.selectedTop+e.projectedTopDiff,this.$optionList.scrollTop(e),this.__lastScrollTop=e,this.setActiveElement(this.$(".dropdown-option").eq(this.__getSelectedIndex())),this.__refreshScrollers());return!1},refreshLabel:function(e){this.$label.find("> span").text(e.text()).toggleClass("no-value",""===e.val())},clickOption:function(e){this.__hide();this.$select.val($(e.target).attr("data-value"));this.$select.trigger("change");c(e)},selectByValue:function(e){this.$(".is-selected").removeClass("is-selected");this.$('.dropdown-option[data-value="'+e+'"]').addClass("is-selected");this.$("select").val(e);e=this.$("select").find(":selected");this.refreshLabel(e)},val:function(){return this.$("select").val()},__changedOption:function(e){e=$(e.target).find(":selected");this.refreshLabel(e)},__maybeScrollOptionIntoView:function(e,b){if(e[0]){var g=this.$el.hasClass("can-scroll-up"),f=this.$el.hasClass("can-scroll-down"),k=this.$optionList,l=k.height(),n=k.offset().top,q=n+l,r=e.outerHeight();e=e.offset().top;var S=e+r,I=e-n+k.scrollTop(),R=l/2-r/2*3;e<n+(g?r:0)?(b&&(I-=R),k.scrollTop(I-(g?this.ITEM_HEIGHT:0))):S>q-(f?r:0)&&(b&&(I+=R),k.scrollTop(I-(l-r)+(f?r:0)))}},__open:function(e){this.isOpen()&&this.$select.val(this.$optionList.find(".is-selected").attr("data-value")).change();this.toggleOpen(e);e=this.$optionList.children().eq(this.$select[0].selectedIndex);h.NextUtil.DomHelper.radioClass(e,"is-selected");return e},__moveSelection:function(e){e=this.$optionList.children().index(this.$optionList.find(".is-selected"))+e;0>e?e=0:e>this.$select.children().length-1&&(e=this.$select.children().length-1);e=this.$optionList.children().eq(e);h.NextUtil.DomHelper.radioClass(e,"is-selected");return e},setActiveElement:function(e){this.__activeElement=e;h.NextUtil.DomHelper.radioClass(e,"is-selected")},__onKeydown:function(e,b){if(!this.isOpen()&&d.is(b,"VK_ENTER")||!this.isOpen()&&d.is(b,"VK_DOWN"))c(this.$el),this.__open(b);else{var g=this.__activeElement&&this.__activeElement.parent()[0]===this.$optionList[0]?this.__activeElement:this.$(".dropdown-option").first();if(d.is(b,"VK_DOWN"))this.__maybeScrollOptionIntoView(g.next()),g.next()[0]&&this.setActiveElement(g.next());else if(d.is(b,"VK_UP"))this.__maybeScrollOptionIntoView(g.prev()),g.prev()[0]&&this.setActiveElement(g.prev());else if(d.is(b,"VK_ENTER"))this.__hide(),this.$select.val(this.__activeElement.attr("data-value")),this.$select.trigger("change"),c(b);else if(d.is(b,"VK_ESC"))c(this.$el);else{var f=d.getAlphaNumericChar(b);if(!1!==f){var k=g[0];this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray);e.push(f);f=e.join("").toLowerCase();for(this.__keyValueArray=this.timer.setTimeout(function(){e.length=0}.bind(this),1e3);k.nextSibling;){k=k.nextSibling;var l=$(k);if(l.attr("data-text")[0]&&h.NextUtil.string.startsWith(l.attr("data-text"),f)){this.isOpen()||this.toggleOpen(b);this.setActiveElement(l);this.__maybeScrollOptionIntoView(l,l[0]!=g[0].nextSibling&&l[0]!=g[0].prevSibling);return}}for(k=this.$(".dropdown-option")[0];k&&k!=g[0];){l=$(k);if(l.attr("data-text")[0]&&h.NextUtil.string.startsWith(l.attr("data-text"),f)){this.isOpen()||this.toggleOpen(b);this.setActiveElement(l);this.__maybeScrollOptionIntoView(l,l[0]!=g[0].nextSibling&&l[0]!=g[0].prevSibling);break}k=k.nextSibling}}}}},__onScroll:function(e){e=this.$optionList.scrollTop();this.__refreshScrollers();this.__lastScrollTop=e},__doScrollUp:function(e,b){e=this.__getComputedInfo();var g=void 0===b?this.AUTO_SCROLL_BY:b;this.$optionListContainer.offset().top+this.$optionListContainer.height()+g<e.maxBottom?(b=this.$optionListContainer.height()+g,b>e.fullHeight&&(b=e.fullHeight),this.$optionListContainer.css({height:b}),this.$optionList[0].scrollTop-=g,this.__refreshScrollers(this.$dropdown)):void 0===b&&(this.$optionList[0].scrollTop-=this.AUTO_SCROLL_BY)},__onScrollUpMouseenter:function(e){this.timer.clearInterval(this.__autoScrollInterval);this.__autoScrollIntervalCounter=0;this.__autoScrollInterval=this.timer.setInterval(function(){this.__doScrollUp(e)}.bind(this),1)},__onScrollUpMouseleave:function(e){this.timer.clearInterval(this.__autoScrollInterval)},__doScrollDown:function(e,b){e=this.__getComputedInfo();var g=void 0===b?this.AUTO_SCROLL_BY:b;if(this.$optionListContainer.offset().top-g>e.maxTop){var f=this.$optionListContainer.height()+g;b=this.$optionListContainer.position().top-g;f>e.fullHeight?f=e.fullHeight:this.$optionListContainer.css({top:b});this.$optionListContainer.css({height:f});this.$optionList[0].scrollTop+=g;this.__refreshScrollers(this.$dropdown)}else void 0===b&&(this.$optionList[0].scrollTop+=this.AUTO_SCROLL_BY)},__onScrollDownMouseenter:function(e){this.timer.clearInterval(this.__autoScrollDownInterval);this.__autoScrollDownIntervalCounter=0;this.__autoScrollDownInterval=this.timer.setInterval(function(){this.__doScrollDown(e)}.bind(this),1)},__onScrollDownMouseleave:function(e){this.timer.clearInterval(this.__autoScrollDownInterval)}})}({NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],template:w});var t=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){return""},3:function(c,a,d,e){return" no-header"},5:function(c,a,d,e){var b,g=a.helperMissing;d='\n            <div class="wh-20">';if((a=(b=a.icon||c&&c.icon||g,b.call(c,"icon-chatwindow_close",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)d+=a;return d+"</div>\n        "},7:function(c,a,d,e){var b,g=a.helperMissing;d='\n            <div class="wh-20">';if((a=(b=a.icon||c&&c.icon||g,b.call(c,"icon-dialog_close",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)d+=a;return d+"</div>\n        "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=a.helperMissing;var g=this.escapeExpression,f='<div class="dialog-container ',k=a["if"].call(c,c&&c.headerIsVisible,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(k||0===k)f+=k;f+='">\n    <a href="#" class="dialog-x">\n        ';if((k=(b=a.platform||c&&c.platform||d,b.call(c,"mobile",{name:"platform",hash:{},fn:this.program(5,e),inverse:this.program(7,e),data:e})))||0===k)f+=k;return f+'\n    </a>\n    <header class="dialog-header">\n        <h3 class="dialog-title nowrap">'+g((b=a.title||c&&c.title,"function"===typeof b?b.call(c,{name:"title",hash:{},data:e}):b))+'</h3>\n    </header>\n    <div class="aux-header"></div>\n    <section class="dialog-body"></section>\n    <footer class="dialog-footer"></footer>\n</div>\n'},useData:!0})}({}),C=function(h){var c=h.UiCore.UiContext;return c.extend("UIContextExtension",{dependencies:"browserInfo currentLocale featureAccessManager loginManager timestampHelper window".split(" "),initialize:function(a){c.prototype.initialize.call(this,a);this.__appMonitor=null;this.__browserInfo=a.browserInfo;this.__featureAccessManager=a.featureAccessManager;this.__loginManager=a.loginManager;this.__timestampHelper=a.timestampHelper;this.__currentLocale=this.__currentLocale||"en";this.__currentLocale="www"===this.__currentLocale?"en":this.__currentLocale;this.serviceProvider=a.serviceProvider;this.__userIsLoggedIn=this.__loginManager.isLoggedIn();this.__myCid=0;this.__userIsLoggedIn&&(this.__myself=this.__loginManager.getCurrentUser(),this.__loginType=this.__loginManager.getLoginType(),this.__myself.populated().then(function(){this.__myCid=this.__myself.get("legacy_cid");if("string"===typeof this.__myCid)if(/^\d+$/.test(this.__myCid))this.__myCid=parseInt(this.__myCid);else{if(!this.__appMonitor&&this.serviceProvider.has("appMonitor")){var d=this.serviceProvider.get("appMonitor");d&&(this.__appMonitor=d)}this.__appMonitor?this.__appMonitor.reportCustomError("UIContextExtension","initialize","web_perm_0017","Bad CID detected",["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]):this.__window.appMonitorPending.push(["UIContextExtension","initialize","web_perm_0017","Bad CID detected",["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]]);this.__myCid=0}this.__myCid=this.__myCid?this.__myCid:0;this.__myCountry=this.__myself.get("country")}.bind(this)));this.__perfReportManager=this.serviceProvider.get("perfReportManager");this.__perfReportManager.setUIContext(this)},getActivityGroupID:function(){return this.__activityGroup.id},getClientSessionID:function(){},packageAppDeviceData:function(){var a=this.__browserInfo.getPlatformData();return{is_test_data:String(this.__window.location).includes("localhost")?"test":"production",app_instance_id:a.appInstanceID,device_platform:a.devicePlatform,device_model:a.deviceModel,app_version:a.appVersion,customer_id:this.__myCid}},__packageEventData:function(a,d){var e=this.__timestampHelper.now().unix().toString();return _.extend({event:null,event_class:null,event_transaction_id:d,event_timestamp:e,event_source:"user",event_reason:null,location:null},a)},__packageTaxonomyData:function(a,d){return{payload_format:"taxonomy",taxonomy:{tenant_id:"IMVU",schema_version:1,app_device_data:this.packageAppDeviceData(),event_data:this.__packageEventData(a,d)}}},__recordTaxonomyEvent:function(a,d){var e=h.NextUtil.DomHelper.createGUID();a=this.__packageTaxonomyData(a,e);this.__recordEvent("taxonomy",a,d||"","soma_taxonomy");return e},recordSentWhisper:function(a){return this.__recordTaxonomyEvent({event:"whisper_sent",event_class:"chat",event_reason:"click",string_one:navigator.language,integer_one:a.receiverCid,integer_two:a.senderVipStatus,integer_three:a.receiverVipStatus,location:a.location,level_one:a.roomType,level_two:a.roomId,level_three:a.startOrReply,client_ip:a.clientIp})},recordShowTieredVipUpsell:function(a){return this.__recordTaxonomyEvent({event:"vip_upsell",event_class:"vip",event_reason:"click",string_one:navigator.language,string_two:a.vipTriggerLocation,event_source:"user",location:a.vipTrigger,user_agent:navigator.userAgent,client_ip:a.clientIp})},recordYouTubePlaylistClick:function(a){var d=a.playlistId;d.includes("list=")&&(d=d.split("list=")[1]);return this.__recordTaxonomyEvent({event:"youtube_imvu_curated_playlist_started",event_class:"youtube",event_reason:"click",string_one:d,client_ip:a.clientIp})},recordYouTubeSearch:function(a){return this.__recordTaxonomyEvent({event:"youtube_video_search",event_class:"youtube",event_reason:"click",string_one:a.searchString,client_ip:a.clientIp})},recordGuestExperiencesYouTube:function(a){var d=parseInt(a.hostCid.match(/\d+$/)[0],10);return this.__recordTaxonomyEvent({event:"youtube_video_viewed_by_non_host",event_class:"youtube",event_reason:a.alreadyPlaying?"playing":"started",integer_one:d,level_one:a.roomId,client_ip:a.clientIp})},recordProductTaxonomyEvent:function(a,d){a=a.get("product_id");if("number"!==typeof a||0>=a)return null;d.systemError=""===d.systemError?null:d.systemError;var e=a.toString(),b={event:IMVU.requireProperty(d,"event"),event_class:IMVU.requireProperty(d,"eventClass"),event_reason:IMVU.requireProperty(d,"eventReason"),location:IMVU.requireProperty(d,"location"),string_one:IMVU.requireProperty(d,"status")};"product_purchased"===d.event?(b.string_two=IMVU.requireProperty(d,"currencyType"),b.string_three=IMVU.requireProperty(d,"systemError"),b.string_four=this.__loginType,b.string_five=this.__getLanguangeSetting()):(b.string_two=IMVU.requireProperty(d,"systemError"),b.integer_one=a);return this.__recordTaxonomyEvent(b,e)},recordPerformanceTaxonomyEvent:function(a,d,e){if(-1===this.__perfReportManager.getBudget(a))return this.__window.console.error("UIContextExtension::recordPerformanceTaxonomyEvent - tage("+String(a)+") not recognized"),null;var b=this.__perfReportManager.getBudget(a);e=e||{};e.submode="__default__"===e.submode?"default":e.submode;var g=IMVU.optionalProperty(e,"northstar",null);g=g?JSON.stringify(g):"";var f=this.__serviceProvider.get("systemMetrics");f=f?JSON.stringify(f):"";var k=this.__featureAccessManager.getMarketingPlatform(),l=this.__serviceProvider.get("appVersion"),n=0,q=0,r=0;"@DEV"===l?k="desktop-client-dev":l&&(k="desktop-client-"+l,r=l.split("."),n=parseInt(r[0]),q=parseInt(r[1]),r=parseInt(r[2]));l=this.__serviceProvider.get("appName");a=a+"__"+k+"__"+l+"__"+(e.type+"_Mode-"+e.mode+"_Submode-"+e.submode);k=-1;"undefined"===typeof e.sessionDuration?this.__window.console.error("UiContextExtension::recordPerformanceTaxonomyEvent - Event data missing sessionDuration"):k=e.sessionDuration;return this.__recordTaxonomyEvent({event:"performance",event_class:"measurement",event_reason:"dna",location:"dna",decimal_one:b,decimal_two:d,string_one:a,string_two:g,string_three:f,integer_one:n,integer_two:q,integer_three:r,integer_four:k},"")},__getLanguangeSetting:function(){return this.__currentLocale+"-"+this.__myCountry}})}({NextUtil:m["@NextUtil"],UiCore:m["@UiCore"]});t=function(h){var c=h.AlloyAlertDialog;return c.extend("AlloyConfirmDialog",{uiContextName:"confirm_dialog_alloy",className:"confirm-dialog-alloy",trackedEvents:function(){return[{type:"click",selector:'[data-confirm="yes"]',name:"confirm",handler:"__onConfirm",attributes:{which:this.__confirmDialogType}},{type:"click",selector:'[data-confirm="no"]',name:"deny",handler:"__onDeny",attributes:{which:this.__confirmDialogType}}]},initialize:function(a){a.title=a.title;a.text=a.text;this.yes=a.yes;this.no=a.no;this.__confirmDialogType=a.confirmDialogType;this.darkText=IMVU.optionalProperty(a,"dark_text",!1);this.eventAttributes=IMVU.optionalProperty(a,"eventAttributes",{});c.prototype.initialize.call(this,a)},postRender:function(){c.prototype.postRender.call(this);this.$el.attr("data-type","confirm");this.setContent("body",h.template,{yes:this.yes,no:this.no});var a=this.$(".dialog-footer-template");this.$(".dialog-footer").html("");this.setContent("footer",a.last().text());this.darkText&&this.$el.addClass("dark-text")},__onConfirm:function(){var a=_.extend(this.getResult(),{confirm:"yes"});this.promiseResolver.resolve(a);this.hide()},__onDeny:function(){var a=_.extend(this.getResult(),{confirm:"no"});this.promiseResolver.reject(a);this.hide()},__getUiAttributes:function(a){return _.extend(this.eventAttributes,c.prototype.__getUiAttributes.call(this,a))}})}({AlloyAlertDialog:function(h){var c=h.AlloyModalDialog;return c.extend("AlloyAlertDialog",{uiContextName:"alert_dialog_alloy",className:"alert-dialog-alloy",dependencies:["externalNextRoot"],trackedEvents:function(){return[{type:"click",selector:'[data-confirm="ok"]',name:"confirm",handler:"__onConfirm"},{type:"change",selector:"#dialog-dropdown",name:"option",handler:"__toggleConfirmButton"}]},initialize:function(a){this.title=a.title;this.text=a.text;this.html=a.html;this.darkText=IMVU.optionalProperty(a,"dark_text",!1);c.prototype.initialize.call(this,a);this.ok=a.ok||this.__stringManager.get("OK");this.checkbox=a.checkbox;this.dropdown=a.dropdown;this.termsOfService=a.termsOfService;this.checkedByDefault=_.isUndefined(a.checkedByDefault)?!0:a.checkedByDefault;this.addToDOM()},postRender:function(){this.setContent("body",h.template,{text:this.text,html:this.html,ok:this.ok,checkbox:this.checkbox,dropdown:this.dropdown,termsOfService:this.termsOfService,checkedByDefault:this.checkedByDefault,policyHubUrl:this.__externalNextRoot+"policyhub/"});this.setContent("footer",this.$(".dialog-footer-template").last().text());this.$("#dialog-dropdown").length&&(_.each(this.dropdown.options,function(a){this.$("#dialog-dropdown").append('<option value="'+a.value+'">'+a.label+"</option>")}.bind(this)),this.reasonDropDown=this.createChildContext(h.Dropdown,{$replaceElement:this.$("#dialog-dropdown")}));this.$(".dialog-title").toggleClass("long-title",this.title&&19<this.title.length);this.darkText&&this.$el.addClass("dark-text");this.__toggleConfirmButton()},getResult:function(){var a={},d=this.$("#dialog-checkbox"),e=this.$("#dialog-dropdown");d.length&&(a.checked=d.is(":checked"));e.length&&(a.dropdown=e.val());return a},__onConfirm:function(){this.$(".btn-primary").prop("disabled",!0);this.promiseResolver.resolve(this.getResult());this.hide()},__toggleConfirmButton:function(){this.$("#dialog-dropdown").length?this.$(".btn-primary").prop("disabled",!this.$("#dialog-dropdown").val()):this.$(".btn-primary").prop("disabled",!1)}})}({AlloyModalDialog:function(h){var c=h.UIContextExtension;return c.extend("AlloyModalDialog",{uiContextName:"modal_dialog_alloy",className:"alloy-modal-dialog",dependencies:["appMonitor","globalStringManager","nextRoot","Promise","window"],hasCloseButton:!0,headerIsVisible:!0,contentAreas:{header:".dialog-header",auxHeader:".aux-header",body:".dialog-body",footer:".dialog-footer"},initialize:function(a){c.prototype.initialize.call(this,a);"undefined"!==typeof a.hasCloseButton&&(this.hasCloseButton=a.hasCloseButton);"undefined"!==typeof a.headerIsVisible&&(this.headerIsVisible=a.headerIsVisible);this.serviceProvider=a.serviceProvider;this.__appMonitor=a.appMonitor;this.dialogManager=a.dialogManager;this.__stringManager=a.globalStringManager;this.__nextRootBase=this.__nextRoot.replace("/next/","");this.__postToParent="undefined"===typeof a.postToParent?!0:a.postToParent;this.canCloseWithOverlayClick=IMVU.optionalProperty(a,"canCloseWithOverlayClick",!0);this.__appMonitor.waypoint("AlloyModalDialog::initialize:"+this.constructor.name);this.finished=new a.Promise(function(d){this.promiseResolver=d}.bind(this));this.shouldFocusOnPrimaryButton=!0;a=this.delete.bind(this);this.finished.then(a,a);this.$el.attr("data-ui-role","modal-dialog");this.$el.on("focusin",function(d){this.$el.closest("html").addClass("dialog-focused")}.bind(this));this.$el.on("focusout",function(d){this.$(d.target).closest(".dropdown").length||this.$el.closest("html").removeClass("dialog-focused")}.bind(this));this.$el.trigger("focusout");this.__postToParent&&this.__window.parent&&this.__window.parent.postMessage&&this.__window.parent.postMessage({message:"opening_modal_dialog",type:this.uiContextName},"*")},render:function(){var a=this;this.doWork([function(){a.$el.html(h.template({title:a.title||"",headerIsVisible:a.headerIsVisible}));a.$(".dialog-x").on("click",a.__onClose.bind(a));a.$el.toggleClass("can-dismiss",a.hasCloseButton);a.postRender();a.$el.closest("html").attr("data-dialog",a.uiContextName);a.__focusPrimaryButton();a.$el.is(".dialog-type-B, .dialog-type-B-flexible")&&a.$el.closest("body").is(".mobile")&&470>a.$el.width()&&(a.$el.is(".text-close")?a.$(".dialog-x").text("Close"):a.$el.is(".text-done")?a.$(".dialog-x").text("Done"):a.$el.is(".text-none")?a.$(".dialog-x").text(""):a.$(".dialog-x").text("Cancel"),a.__adjustTitlePosition())}])},__adjustTitlePosition:function(){this.$(".dialog-title").removeClass("overflowed");var a=this.$(".dialog-title").width(),d=this.$(".dialog-header").width();a<=d-160?this.$(".dialog-title").toggleClass("overflowed",!1):this.$(".dialog-title").toggleClass("overflowed",!0)},linkToDetailsSubmode:function(a,d){this.serviceProvider.get("historyManager").setState({fragment:this.__urlId(d.id),mode:{id:a},submode:{id:d.id,summary:{model:d}}})&&(a=function(){this.serviceProvider.get("historyManager").silentMoveHistory(-1)}.bind(this),this.finished.then(a,a))},show:function(){this.__appMonitor.waypoint("AlloyModalDialog::show:"+this.constructor.name);c.prototype.show.call(this);this.__focusPrimaryButton()},hide:function(){this.__appMonitor.waypoint("AlloyModalDialog::hide:"+this.constructor.name);c.prototype.hide.call(this);this.$el.closest("html").removeAttr("data-dialog")},close:function(){this.__appMonitor.waypoint("AlloyModalDialog::close:"+this.constructor.name);this.hide();this.promiseResolver.reject()},closeAll:function(a){a.preventDefault();this.__recordEvent("click",{name:"dialog_close"});this.__dialogManager.closeAll()},showHeader:function(){this.headerIsVisible=!0;this.$(".dialog-container").removeClass("no-header")},hideHeader:function(){this.headerIsVisible=!1;this.$(".dialog-container").addClass("no-header")},toggleHeader:function(){this.headerIsVisible?this.hideHeader():this.showHeader()},__onClose:function(a){a.preventDefault();this.__recordEvent("click",{name:"dialog_close"});this.close()},__focusPrimaryButton:function(){if(this.shouldFocusOnPrimaryButton){var a=this.$(".btn-primary");1<a.length?a.trigger("blur"):a.first().focus()}},updateDialogTitle:function(a){this.$(".dialog-header .dialog-title").text(a);this.__adjustTitlePosition()},delete:function(){this.__appMonitor.waypoint("AlloyModalDialog::delete:"+this.constructor.name);this.__postToParent&&this.__window.parent&&this.__window.parent.postMessage&&this.__window.parent.postMessage({message:"deleting_modal_dialog",type:this.uiContextName},"*");c.prototype.delete.call(this)}})}({UiCore:m["@UiCore"],UIContextExtension:C,template:t}),Dropdown:w,template:y}),template:p});p=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b,g=a.helperMissing;d='\n        <button class="btn btn-primary btn-dark disabled">\n            ';if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"IN CART",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n        </button>\n    "},3:function(c,a,d,e){var b,g=a.helperMissing;d=this.escapeExpression;var f='\n        <button class="btn btn-primary btn-dark">\n            ';if((g=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"ADD TO CART FOR",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+"&nbsp;<span>"+d((b=a.sale_price||c&&c.sale_price,"function"===typeof b?b.call(c,{name:"sale_price",hash:{},data:e}):b))+"</span>\n        </button>\n    "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b,g=this.escapeExpression;d='<div class="multicart-upgrade-panel">\n    <img class="product-ad" src="'+g((b=a.product_ad_url||c&&c.product_ad_url,"function"===typeof b?b.call(c,{name:"product_ad_url",hash:{},data:e}):b))+'">\n    <div class="title">\n        '+g((b=a.subtitle||c&&c.subtitle,"function"===typeof b?b.call(c,{name:"subtitle",hash:{},data:e}):b))+'\n    </div>\n    <div class="description"></div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    ';if((c=a["if"].call(c,c&&c.in_cart,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===c)d+=c;return d+"\n<\/script>\n"},useData:!0})}({});C=function(h){var c=h.Dialogs.AlloyModalDialog;return c.extend("MultiCartUpgrade",{className:"multicart-upgrade-dialog dialog-type-B",uiContextName:"multicart_upgrade_dialog",dependencies:["dollarStoreManager","featureAccessManager","globalStringManager","model"],trackedEvents:function(){return[{type:"click",selector:".btn-primary",name:"add_to_cart",handler:"__addToCart"}]},initialize:function(a){c.prototype.initialize.call(this,a);this.title=this.__model.node.attributes.name;this.__cartCollection=IMVU.optionalProperty(a,"cartCollection",null);this.__inCart=!1;this.__package_map={};this.__package_map.dlg_namechange={subtitle_key:"UPGRADE_NAME_CHANGE_TOKEN_TITLE",desc_key:"UPGRADE_NAME_CHANGE_TOKEN_DESC"};this.__package_map.dlg_accesspass={subtitle_key:"UPGRADE_ACCESS_PASS_TITLE",desc_key:"UPGRADE_ACCESS_PASS_DESC"};this.__package_map.dlg_namereg={subtitle_key:"UPGRADE_NAME_REGISTRATION_TITLE",desc_key:"UPGRADE_NAME_REGISTRATION_DESC"};this.__package_map.dlg_ageverify={subtitle_key:"UPGRADE_AGE_VERIFICATION_TITLE",desc_key:"UPGRADE_AGE_VERIFICATION_DESC"};this.__package_map.dlg_sharedroom={subtitle_key:"UPGRADE_SHARED_ROOM_TITLE",desc_key:"UPGRADE_SHARED_ROOM_DESC"};this.__package_map.dlg_chatroomslot={subtitle_key:"UPGRADE_CHATROOM_SLOT_TITLE",desc_key:"UPGRADE_CHATROOM_SLOT_DESC"};this.__package_map.dlg_marriagepackage={subtitle_key:"UPGRADE_MARRIAGE_LICENSE_TITLE",desc_key:"UPGRADE_MARRIAGE_LICENSE_DESC"};this.__package_map.dlg_vip={subtitle_key:"UPGRADE_VIP_TITLE",desc_key:"UPGRADE_VIP_DESC"};this.__package_map.dlg_tiered_vip={subtitle_key:"UPGRADE_VIP_TITLE",desc_key:"UPGRADE_"+this.__model.node.get("code_name")};this.__package_map.dlg_host_subscription={subtitle_key:"UPGRADE_HOST_SUB_TITLE",desc_key:"UPGRADE_HOST_SUB_DESC",dlg_title:"UPGRADE_HOST_SUB_DLG_TITLE"};this.__package_map.dlg_credits={subtitle_key:"UPGRADE_CREDITS_TITLE",desc_key:"UPGRADE_CREDITS_DESC"};this.__package_map.vcoin={subtitle_key:"UPGRADE_VCOIN_TITLE",desc_key:"UPGRADE_VCOIN_DESC",dlg_title:"UPGRADE_VCOIN_DLG_TITLE"};this.__package_map.dlg_badge_canvas={subtitle_key:"UPGRADE_BADGE_CANVAS_SUBTITLE",desc_key:"UPGRADE_BADGE_CANVAS_DESC"};this.__dlgName=this.__model.node.get("dlg_name");(a=this.__package_map[this.__dlgName])?(this.__subtitle=this.__globalStringManager.get(a.subtitle_key),this.__description=this.__globalStringManager.get(a.desc_key),a.dlg_title&&(this.title=this.__globalStringManager.get(a.dlg_title))):(this.__subtitle=this.__globalStringManager.get("UPGRADE_CREDITS_TITLE"),this.__description=this.__globalStringManager.get("UPGRADE_CREDITS_DESC"));"dlg_tiered_vip"==this.__model.node.get("dlg_name")&&(a={},this.__description=h.multiProductUpsellVipTiers((a[this.__model.node.get("code_name")]=1,a.canSeeYouTube=this.__featureAccessManager.canSeeYouTubePreRecorded(),a)));this.addToDOM();this.$(".dialog-container").addClass(this.__dlgName)},postRender:function(){this.__cartCollection&&this.__package_map[this.__dlgName]&&("vip"===this.__model.node.attributes.category||"hosting"===this.__model.node.attributes.category)&&(this.__inCart=this.__isMatchingProductId());this.setContent("body",h.template,{product_ad_url:this.__model.node.get("dlg_background_url"),subtitle:this.__subtitle,sale_price:this.__model.edge.attributes.sale_price_formatted,in_cart:this.__inCart});this.$(".description").html(this.__description);this.setContent("footer",this.$(".dialog-footer-template").text())},__addToCart:function(){this.close();this.__model.trigger("select_and_add_item_to_cart")},__isMatchingProductId:function(){return!_.isEmpty(_.filter(this.__cartCollection.models,function(a){if(void 0!==this.__model.node.attributes.id&&void 0!==a.attributes.node.id)return this.__model.node.attributes.id===a.attributes.node.id}.bind(this)))}})}({Dialogs:m["@Dialogs"],Model:m["@Model"],UiCore:m["@UiCore"],multiProductUpsellVipTiers:G,template:p});p=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b;d=this.escapeExpression;return"\n            <p class='desc'>"+d((b=a.email_msg||c&&c.email_msg,"function"===typeof b?b.call(c,{name:"email_msg",hash:{},data:e}):b))+"</p>\n        "},3:function(c,a,d,e){var b;d=a.helperMissing;var g=this.escapeExpression;return"\n            <p class='desc'>"+g((b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"TwoFactorChallenge.desc",{name:"i18n-g",hash:{},data:e})))+"</p>\n        "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=this.escapeExpression;var g=a.helperMissing,f='<div class="content-container">\n    <div class="content-block">\n        ',k=a["if"].call(c,c&&c.email_msg,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(k||0===k)f+=k;return f+"\n        <div class='input-panel'>\n            <input class='two-factor-code' required maxlength='6' placeholder=\""+d((b=a.placeholder||c&&c.placeholder,"function"===typeof b?b.call(c,{name:"placeholder",hash:{},data:e}):b))+"\">\n            <div class='enrollment-error'></div>\n        </div>\n\n        <div class='link-panel'>\n            <p class='change-email'>\n                "+d((b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"TwoFactorEnrollment.cant_access_email",{name:"i18n-g",hash:{},data:e})))+"\n                <span class='change-email'>"+d((b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"TwoFactorEnrollment.change_email",{name:"i18n-g",hash:{},data:e})))+"</span>\n            </p>\n            <p class='new-code'>\n                "+d((b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"TwoFactorEnrollment.need_another_code",{name:"i18n-g",hash:{},data:e})))+"\n                <span class='new-code'>"+d((b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"TwoFactorEnrollment.send_a_new_code",{name:"i18n-g",hash:{},data:e})))+'</span>\n            </p>\n        </div>\n\n    </div>\n</div>\n\n<footer class="dialog-footer">\n    <button class="btn btn-primary disabled submit">'+d((b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"Continue",{name:"i18n-g",hash:{},data:e})))+"</button>\n</footer>\n"},useData:!0})}({});var u=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=a.helperMissing;var g='<div class="content-container">\n    <div class="content-block">\n        <legend class="system-info-header">\n            ',f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"email address",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='\n        </legend>\n\n        <div class=\'input-panel\'>\n            <input class=\'two-factor-email\' required placeholder="Email">\n            <ul class=\'email-error\'>\n                <li class="error-message hidden"></li>\n            </ul>\n            <input class=\'two-factor-password\' type="password" required placeholder="Password">\n            <ul class=\'password-error\'>\n                <li class="error-message hidden"></li>\n            </ul>\n        </div>\n\n    </div>\n</div>\n\n<footer class="dialog-footer">\n    <button class="btn btn-primary send-code disabled">\n        ';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"TwoFactorChangeEmail.button",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"\n    </button>\n</footer>\n"},useData:!0})}({});y=function(h){return IMVU.BaseClass.extend("StringManager",{dependencies:["cookieManager","dictionary","window"],initialize:function(c){this.__cookieManager=c.cookieManager;this.__dictionary=c.dictionary;this.__window=c.window;if(!this.__dictionary)throw Error("StringManager requires a dictionary");this.__appMonitor=null;this.serviceProvider=c.serviceProvider},__getAppMonitor:function(){if(!this.__appMonitor&&this.serviceProvider.has("appMonitor")){var c=this.serviceProvider.get("appMonitor");c&&(this.__appMonitor=c)}return this.__appMonitor},__process_placeholders:function(c,a){_.each(a,function(d,e){c=c.replace(new RegExp("{{\\s*"+e+"\\s*}}","g"),d)});return c},isImvuese:function(){return"1"===this.__cookieManager.get("imvuese")},get:function(c,a){if(this.isImvuese())return"{"+c+"}";var d=this.__dictionary[c];if(!_.isString(d))throw a='Unable to find text: "'+c+'" in translation dictionary. Use getWithDefault to set default value.',this.__getAppMonitor()?this.__appMonitor.reportCustomError("StringManager","get","web_perm_0018",a,["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]):this.__window.appMonitorPending.push(["UIContextExtension","initialize","web_perm_0018",a,["Bad key["+c+"]"]]),Error(a);return this.__process_placeholders(d,a)},getWithDefault:function(c,a,d){if(this.isImvuese())return"{"+c+"}";if("string"!==typeof a)throw Error("defaultText must be a string, but got "+IMVU.repr(a));c=this.__dictionary[c];return _.isString(c)?this.__process_placeholders(c,d):a},getPluralized:function(c,a){if(this.isImvuese())return"{"+c+"}";var d=parseInt(a.howMany,10);return 0===d?this.get(c+"_none",a):this.get(c+(2>d?"_singular":"_plural"),a)},handlebarsHelper:function(c,a){return this.get(c,a.hash)},handlebarsHelperWithDefault:function(c,a,d){return this.getWithDefault(c,a,d)}})}({});u=function(h){var c=h.Dialogs.AlloyModalDialog;return c.extend("TwoFactorChangeEmail",{uiContextName:"two_factor_change_email_dialog",className:"two-factor-change-email-dialog dialog-type-B",dependencies:"dialogManager globalStartupModel globalStringManager loginManager rest serviceProvider".split(" "),trackedEvents:function(){return[{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack},{type:"keyup",selector:".two-factor-email",name:"typing_email",handler:this.__onTypingEmail},{type:"click",selector:".btn-primary",name:"send_code",handler:this.__sendCode}]},initialize:function(a){c.prototype.initialize.call(this,a);this.shouldFocusOnPrimaryButton=!1;this.title=this.__globalStringManager.get("TwoFactorChangeEmail.title");this.__myself=a.loginManager.getCurrentUser();this.__settingsDict=this.__serviceProvider.create(h.StringManager,{dictionary:h.settingsDict});this.addToDOM()},delete:function(){c.prototype.delete.call(this)},close:function(){this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.setContent("body",h.template,{});this.$("input.two-factor-email").focus()},__goBack:function(){this.hide();this.promiseResolver.reject()},__onTypingEmail:function(){var a=this.$("input.two-factor-email").val();/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,3}$/.test(String(a).toLowerCase())?this.$(".btn-primary").removeClass("disabled"):this.$(".btn-primary").hasClass("disabled")||this.$(".btn-primary").addClass("disabled")},__sendCode:function(){var a=this.__globalStartupModel.get("changeEmailUrl");this.$(".error-message").addClass("hidden");this.__rest.post(a,{new_email:this.$("input.two-factor-email").val(),password:this.$("input.two-factor-password").val()}).then(function(d){202===d.xhr.status?this.promiseResolver.resolve({code:"change_email_challenge",new_email:this.$("input.two-factor-email").val(),password:this.$("input.two-factor-password").val(),email_url:this.__globalStartupModel.get("changeEmailUrl")}):(this.trigger("new_email_address_saved"),this.promiseResolver.resolve({code:"new_email_saved",new_email:this.$("input.two-factor-email").val()}))}.bind(this)).catch(function(d){var e="",b=!1;switch(d.error.error){case"CHANGE_EMAIL-001":d=this.__settingsDict.get("CHANGE_EMAIL_SAME_AS_OLD");e=".email-error";break;case"CHANGE_EMAIL-002":d=this.__settingsDict.get("CHANGE_EMAIL_ALREADY_IN_USE");e=".email-error";break;case"CHANGE_EMAIL-003":d=this.__settingsDict.get("CHANGE_EMAIL_INVALID_FORMAT");e=".email-error";break;case"CHANGE_EMAIL-004":d=this.__settingsDict.get("CHANGE_EMAIL_WRONG_PASSWORD");e=".password-error";break;case"CHANGE_EMAIL-005":d=this.__settingsDict.get("CHANGE_EMAIL_CHANGED_RECENTLY");b=!0;break;case"CHANGE_EMAIL-006":d=this.__settingsDict.get("CHANGE_EMAIL_ACCOUNT_ON_HOLD");e=".email-error";break;default:d=d.error.message}b?this.__dialogManager.alert({title:this.__globalStringManager.get("oops"),text:d,ok:this.__globalStringManager.get("OK")}):(this.$(e+" .error-message").text(d),this.$(e+" .error-message").removeClass("hidden"))}.bind(this))}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],settingsDict:m["json!/common/withme/i18n/settings.json"],StringManager:y,template:u});p=function(h){var c=h.Dialogs.AlloyModalDialog;return c.extend("TwoFactorEnrollment",{uiContextName:"two_factor_enrollment_dialog",className:"two-factor-enrollment-dialog dialog-type-B",dependencies:["dialogManager","globalStringManager","loginManager","securitySettingsManager","window"],trackedEvents:function(){return[{type:"click",selector:".btn-primary",name:"continue",handler:this.__clickContinue},{type:"input",selector:".two-factor-code",name:"typing_code",handler:this.__onTypingCode},{type:"keyup",selector:".two-factor-code",name:"typing_code",handler:this.__onKeyUp},{type:"click",selector:"span.change-email",name:"change_email",handler:this.__clickChangeEmail},{type:"click",selector:"span.new-code",name:"new_code",handler:this.__clickSendNewCode}]},initialize:function(a){c.prototype.initialize.call(this,a);this.shouldFocusOnPrimaryButton=!1;this.title=this.__globalStringManager.get("TwoFactorEnrollment.title");this.__myself=this.__loginManager.getCurrentUser();this.__isEnabling=IMVU.optionalProperty(a,"isEnabling",!0);this.__regex_not_allowed=/[ ]/gi;this.__securitySettingsManager.toggle2FA({enabling:this.__isEnabling}).then(function(d){if(d.error&&"failure"===d.error.status||d.error&&"NetworkFailure"===d.error.error){var e=d.error.message;"SECURITY_SETTINGS-003"===d.error.error&&(e=this.__globalStringManager.get("TwoFactorEnrollment.apple_signed_in"));this.__dialogManager.showDialog(h.Dialogs.AlloyAlertDialog,{title:this.__globalStringManager.get("Error"),text:e,ok:this.__globalStringManager.get("OKAY")}).finished.then(function(){this.addToDOM()}.bind(this)).catch(function(){this.close()}.bind(this))}else{this.__email_msg=null;if(d.response&&d.response.message&&d.response.details)try{this.__email_addr=d.response.details.email_address,this.__email_msg=d.response.message.replace("%email_address",this.__email_addr)}catch(b){this.__window.console.error(b)}this.addToDOM()}}.bind(this))},close:function(){this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},postRender:function(){this.setContent("body",h.template,{email_msg:this.__email_msg,placeholder:this.__globalStringManager.get("TwoFactorEnrollment.code_placeholder")});!1===this.__isEnabling&&this.$(".change-email").addClass("hidden")},__onKeyUp:function(a){a.keyCode===h.NextUtil.Keys.VK_ENTER&&(this.$(".btn-primary").hasClass("disabled")||this.__clickContinue())},__onTypingCode:function(){var a=this.$("input.two-factor-code").val();-1<a.search(this.__regex_not_allowed)&&(a=a.replace(this.__regex_not_allowed,""),this.$("input.two-factor-code").val(a));a&&a.length===this.$("input.two-factor-code")[0].maxLength?this.$(".btn-primary").removeClass("disabled"):this.$(".btn-primary").hasClass("disabled")||(this.$(".btn-primary").addClass("disabled"),this.$(".enrollment-error").removeClass("error-visible"),this.$(".two-factor-code").removeClass("error-visible"))},__clickContinue:function(){this.__securitySettingsManager.toggle2FA({enabling:this.__isEnabling,code:this.$("input.two-factor-code").val()}).then(function(a){200===a.xhr.status?this.promiseResolver.resolve("valid_code"):(a&&a.error?(this.$(".enrollment-error").addClass("error-visible"),"SECURITY_SETTINGS-002"===a.error.error?this.$(".enrollment-error").text(this.__globalStringManager.get("TwoFactorEnrollment.incorrect_code")):this.$(".enrollment-error").text(a.error.message)):(this.$(".enrollment-error").addClass("error-visible"),this.$(".enrollment-error").text(this.__globalStringManager.get("message_error.generic_title"))),this.$(".two-factor-code").addClass("error-visible"))}.bind(this)).catch(function(){this.$(".enrollment-error").addClass("error-visible");this.$(".enrollment-error").text(this.__globalStringManager.get("message_error.generic_title"))}.bind(this))},__clickChangeEmail:function(){this.__dialogManager.showDialog(h.TwoFactorChangeEmail,{}).finished.then(function(a){"new_email_saved"===a.code?(a=this.__obfuscateEmail(a.new_email),this.__email_msg=this.__email_msg.replace(this.__email_addr,a),this.__email_addr=a,this.$(".content-block p.desc").text(this.__email_msg)):this.__window.console.log("Unexpected error, resp:",a)}.bind(this)).catch(function(){}.bind(this))},__obfuscateEmail:function(a){a=a.split("@");var d=a[0].length,e=3<d?a[0].substr(d-3):"";e=e.padStart(d,"*");return[e,"@",a[1]].join("")},__clickSendNewCode:function(){this.__securitySettingsManager.toggle2FA({enabling:this.__isEnabling}).then(function(a){var d=this.__globalStringManager.get("message_error.generic_title"),e=this.__globalStringManager.get("TwoFactorNewCode.title");a.response?d="SECURITY_SETTINGS-001"===a.response.error?this.__globalStringManager.get("TwoFactorNewCode.desc"):a.response.message:a.error&&(d=a.error.message,e=this.__globalStringManager.get("oops"));this.__dialogManager.showDialog(h.Dialogs.AlloyAlertDialog,{title:e,text:d,ok:this.__globalStringManager.get("OKAY"),postToParent:!1})}.bind(this))}})}({Dialogs:m["@Dialogs"],NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],TwoFactorChangeEmail:u,template:p});p=function(h){var c=h.Dialogs.AlloyConfirmDialog;return c.extend("TwoFactorSetupAlert",{uiContextName:"two_factor_setup_alert_dialog",className:"two-factor-setup-alert-dialog",dependencies:["dialogManager","globalStringManager","loginManager","securitySettingsManager"],initialize:function(a){this.__dialogManager=a.dialogManager;this.__stringManager=a.globalStringManager;this.__requireSetup=IMVU.optionalProperty(a,"requireSetup",!0);var d=a.text?a.text:this.__requireSetup?this.__stringManager.get("TwoFactorSetupAlert.text"):this.__stringManager.get("TwoFactorSetupAlert.optional_text");a=_.extend({title:this.__stringManager.get("TwoFactorSetupAlert.title"),html:d,yes:this.__stringManager.get("TwoFactorSetupAlert.setup"),no:this.__requireSetup?this.__stringManager.get("CANCEL"):this.__stringManager.get("TwoFactorSetupAlert.skip")},a);c.prototype.initialize.call(this,a);this.$el.removeClass("can-dismiss")},__onConfirm:function(){this.__dialogManager.showDialog(h.TwoFactorEnrollment,{isEnabling:!0}).finished.then(function(){this.promiseResolver.resolve()}.bind(this)).catch(function(){this.promiseResolver.reject()}.bind(this))}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],TwoFactorEnrollment:p});u=function(h){var c=h.Dialogs.AlloyConfirmDialog;return c.extend("LinkUpholdDialog",{uiContextName:"link_uphold_dialog",className:"link-uphold-dialog",dependencies:["globalStringManager","loginManager"],trackedEvents:function(){return[{type:"click",name:"link_uphold_account",selector:"[data-confirm=yes]",handler:this.__onLink},{type:"click",name:"cancel_linking_uphold_account",selector:"[data-confirm=no]",handler:this.__onCancel}]},initialize:function(a){this.__globalStringManager=a.globalStringManager;this.__loginManager=a.loginManager;this.__wallet=IMVU.optionalProperty(a,"wallet",null);null===this.__wallet&&(this.__myself=this.__loginManager.getCurrentUser(),this.__myself.populated().then(function(){this.__wallet=this.__myself.getSingleEdge("wallet")}.bind(this)));a.title=this.__globalStringManager.get("vcoin_link_uphold_account");a.text=this.__globalStringManager.get("vcoin_link_uphold_text");a.yes=this.__globalStringManager.get("Continue");a.no=this.__globalStringManager.get("Cancel");this.hasCloseButton=!1;c.prototype.initialize.call(this,a)},postRender:function(){c.prototype.postRender.call(this)},__onCancel:function(){this.close()},__onLink:function(){this.__wallet.populated().then(function(){this.__upholdLink=this.__wallet.get("uphold_url");this.__window.open(this.__upholdLink,"_blank");this.close()}.bind(this))}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"]});B=function(h){var c=h.UiCore.UiContext;return c.extend("MultiProductItem",{uiContextName:"multi_product_item",tagName:"article",className:"multi-product-item",dependencies:"dialogManager dollarStoreManager featureAccessManager globalStringManager googleAnalytics iconManager imageManager leanplum loginManager model securitySettingsManager urlManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".wrapper:not(.is-active) .item-info",name:"choose_product_item",handler:"__userClickedUpper"},{type:"click",selector:".wrapper:not(.is-active) .item-price",name:"choose_product_item",handler:"__userClickedLower"},{type:"click",selector:".wrapper:not(.is-active).upsell",name:"choose_product_item",handler:"__userClickedLower"}]},initialize:function(a){c.prototype.initialize.call(this,a);this.__viewType=IMVU.optionalProperty(a,"viewType","row");this.__category=IMVU.optionalProperty(a,"category",null);this.__cartCollection=this.__parentUiContext.getCartCollection?this.__parentUiContext.getCartCollection():null;this.__isMobile=this.__featureAccessManager.isMobile();this.__isUpsell=IMVU.optionalProperty(a,"isUpsell",!1);this.__specialCase=null;this.__userClicked=!1;this.__upsellDialog=IMVU.optionalProperty(a,"upsellDialog",null);this.addToDOM()},render:function(){c.prototype.render.call(this);this.__model.populated().then(function(){this.__category=this.__model.node.get("category");this.__isTieredVIP="vip"===this.__category&&"dlg_tiered_vip"===this.__model.node.get("dlg_name");this.__isActive=-1!==this.__model.edge.get("rules").indexOf("active");this.__renderTemplate();this.$el.data("id",this.__model.node.get("product_packages_id"));this.__isActive?(this.__isTieredVIP&&this.__upsellDialog&&this.__upsellDialog.switchDescription&&this.__upsellDialog.switchDescription(this.__model.node.get("code_name")),this.$el.addClass("is-active"),this.$(".wrapper").addClass("is-active")):(this.listenTo(this.__model,"removed_from_cart",this.__onRemoveFromCart),this.listenTo(this.__model,"select_and_add_item_to_cart",this.__selectAndAddItemToCart),this.listenTo(this.__model,"add_pending_item_to_cart",this.__addPendingItemToCart));this.createChildContext(h.Tooltip,{$replaceElement:this.$(".pend-tooltip"),$tooltipTarget:this.$(".pend-multiplier"),tooltipPosition:"bottom"});this.__isUpsell&&(this.$el.addClass("upsell"),this.$(".wrapper").addClass("upsell"),this.__isActive&&this.$(".label-active").removeClass("hidden"));this.__window.addEventListener("message",this.__receiveMessage.bind(this),!0);this.$el.addClass(this.__viewType+"-view");this.$el.addClass("category-"+this.__category);"vip"===this.__category&&"dlg_tiered_vip"===this.__model.node.get("dlg_name")&&(this.$el.addClass(this.__model.node.get("code_name")),this.$el.addClass("tiered_vip"))}.bind(this))},__selectAndAddItemToCart:function(){this.__selectItem()},__addPendingItemToCart:function(){this.__selectItem({pended:!0})},__confirmVIPDowngrade:function(a){var d=["","gold","platinum","diamond"],e=this.__model.edge.get("metadata.tier"),b=this.__model.node.get("code_name").substr(-1);d=this.__globalStringManager.get("vip_downgrade_"+d[e]+"_to_"+d[b]+"_body");this.__dialogManager.confirm({title:this.__globalStringManager.get("common_subscription_cancel_confirm_dialog_title"),text:d,no:this.__globalStringManager.get("CANCEL"),yes:this.__globalStringManager.get("OKAY")}).finished.then(function(){a()})},__vcoinErrorCheck:function(a,d){d=void 0===d?{}:d;d=d.rules_hit?d.rules_hit:this.__dollarStoreManager.validateMultiCartShoppingRules(this.__model,this.__cartCollection);var e=this.__model.edge.get("metadata.available_for_purchase"),b=this.__dollarStoreManager.getCartVcoinTotal(),g=this.__model.node.attributes.vcoin;if(d.includes("region_blocked")&&!this.__ignoreRegionBlockedRule)this.__upsellDialog?(this.__upsellDialog.trigger("vcoin_product_selected_in_blocked_region"),a()):this.__showVcoinUnavailableDialog(a);else if(d.includes("purchase_limit")&&d.includes("unavailable")||b+g>e)d='<a href="'+this.__urlManager.get("vcoin_limits")+'" target="_blank">'+this.__globalStringManager.get("vcoin_unavailable_limit_reached_error_message_link")+"</a>",d="<p>"+this.__globalStringManager.get("vcoin_unavailable_limit_reached_error_message")+" "+d+".</p>",this.__dialogManager.alert({title:this.__globalStringManager.get("vcoin_unavailable_limit_reached_error_title"),html:d,ok:this.__globalStringManager.get("OKAY"),dark_text:!0}).finished.then(function(){this.__upsellDialog&&this.__upsellDialog.upsellAfterGift&&this.__dialogManager.closeAll()}.bind(this));else{if(d.includes("requires_kyc")&&d.includes("unavailable"))return this.__dialogManager.showDialog(h.LinkUpholdDialog,{}).finished.then(function(){this.$el.removeClass("is-selected")}.bind(this));d.includes("require_2FA")?this.__dollarStoreManager.userHasTwoFactorAuth()?(this.__canBuyVcoinWithRules=!0,a()):this.__securitySettingsManager.get("2fa_enabled").then(function(f){this.__dollarStoreManager.setUserTwoFactorAuthStatus(f["2fa_enabled"]);if(f["2fa_enabled"])this.__canBuyVcoinWithRules=!0,a();else return this.__dialogManager.showDialog(h.TwoFactorSetupAlertDialog,{requireSetup:!0}).finished.then(function(){this.__dollarStoreManager.setUserTwoFactorAuthStatus(!0);this.__canBuyVcoinWithRules=!0;a()}.bind(this))}.bind(this)):a()}},__showVcoinUnavailableDialog:function(a){var d='<a href="'+this.__urlManager.get("unavailable_vcoin")+'" target="_blank">'+this.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_link")+"</a>";d="<p>"+this.__globalStringManager.get("vcoin_unavailable_error_text")+" "+d+"</p>";this.__dialogManager.showDialog(h.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("vcoin_unavailable_error_title"),text:this.__globalStringManager.get("vcoin_unavailable_error_text"),html:d,yes:this.__globalStringManager.get("Continue"),no:this.__globalStringManager.get("CANCEL"),dark_text:!0}).finished.then(function(){this.__ignoreRegionBlockedRule=!0;this.__vcoinErrorCheck(a)}.bind(this))},__userClickedUpper:function(){if(this.__upsellDialog)this.__userClickedLower();else{this.__userClicked=!0;var a=function(){this.__dollarStoreManager.validateAccountStatus(this.__model).then(function(){return this.__dialogManager.showDialog(h.MultiCartUpgrade,{model:this.__model,cartCollection:this.__cartCollection}).finished.then(function(){}.bind(this))}.bind(this))}.bind(this);"vcoin"===this.__category?this.__vcoinErrorCheck(a):a()}},__selectItem:function(a){var d=this;a=void 0===a?{pended:!1}:a;"vip"===this.__category&&this.__productSwap(this.__model,this.__category);var e=this.__dollarStoreManager.validateMultiCartShoppingRules(this.__model,this.__cartCollection);-1!==e.indexOf("require_2FA")&&"vcoin"!==this.__category?this.__dollarStoreManager.userHasTwoFactorAuth()?(e=_.without(e,"require_2FA"),this.__handleSelection(a,e)):this.__securitySettingsManager.get("2fa_enabled").then(function(b){d.__dollarStoreManager.setUserTwoFactorAuthStatus(b["2fa_enabled"]);if(b["2fa_enabled"])e=_.without(e,"require_2FA"),d.__handleSelection(a,e);else return d.__dialogManager.showDialog(h.TwoFactorSetupAlertDialog,{requireSetup:!0}).finished.then(function(){d.__dollarStoreManager.setUserTwoFactorAuthStatus(!0);e=_.without(e,"require_2FA");d.__handleSelection(a,e)})}):"vcoin"===this.__category?e.includes("purchase_limit")||(e=_.without(e,"region_blocked"),this.__vcoinErrorCheck(function(){return d.__handleSelection(a,e)},{rules_hit:e})):-1!==e.indexOf("downgrade")&&"vip"===this.__category?(e=_.without(e,"downgrade"),this.__userClicked?this.__confirmVIPDowngrade(function(){return d.__handleSelection(a,e)}):this.__handleSelection(a,e)):this.__handleSelection(a,e)},__handleSelection:function(a,d){if(_.isEmpty(d)||"vcoin"===this.__category&&this.__canBuyVcoinWithRules){d=parseInt(this.$(".multiplier").attr("cart-count"),10);var e=parseInt(this.$(".pend-multiplier").attr("pend-count"),10);a.pended?this.$(".pend-multiplier").attr("pend-count",++e):(this.__dollarStoreManager.trigger("select_multicart_item",this.__model),this.$el.hasClass("is-selected")||this.$el.addClass("is-selected"),this.$(".multiplier").attr("cart-count",++d));!this.__dollarStoreManager.isLoading()&&this.__userClicked&&this.__dollarStoreManager.trigger("update_persistent_cart",this.__model,d)}else if(this.__userClicked){var b=[];a="";_.each(d,function(g){try{b.push(this.__globalStringManager.get(g))}catch(f){b.push(g)}}.bind(this));b=b.join(" ");a=this.__globalStringManager.get("rules_dialog_title");["apple","google_play"].includes(this.__model.edge.attributes["metadata.provider"])?(b=this.__globalStringManager.get("vip_upsell_previous_subscription_mobile_body",{company:this.__globalStringManager.get("vip_upsell_company_3"),platform:this.__globalStringManager.get("vip_upsell_platform_3")}),a=this.__globalStringManager.get("vip_upsell_previous_subscription_title")):"unavailable"===b&&(b=this.__globalStringManager.get("add_to_cart_error_unavailable_text"));return this.__dialogManager.showDialog(h.Dialogs.AlloyAlertDialog,{title:a,text:b,ok:this.__globalStringManager.get("add_to_cart_error_ok")})}this.__userClicked=!1},__userClickedLower:function(){var a=this,d=null;this.__wasSelected=this.$el.hasClass("is-selected");this.__upsellDialog?d=function(){a.__isTieredVIP&&a.__upsellDialog&&a.__upsellDialog.switchDescription&&a.__upsellDialog.switchDescription(a.__model.node.get("code_name"));a.$el.siblings().removeClass("is-selected");a.$el.toggleClass("is-selected",!a.__wasSelected);a.__upsellDialog.aProductClicked(a.__wasSelected?null:a.__model,a.__category)}:(this.__userClicked=!0,d=function(){this.__selectItem()}.bind(this));"vcoin"===this.__category?this.__vcoinErrorCheck(d):d()},__receiveMessage:function(a){a.data.showDialog&&(this.codeName=a.data.showDialog,this.codeName===this.__model.node.attributes.code_name&&this.__userClickedLower())},__refreshProduct:function(){this.__model.invalidate();this.render()},__renderTemplate:function(){var a=this.__model.edge.get("normal_price")>this.__model.edge.get("sale_price"),d="1"===this.__model.node.get("most_popular"),e=this.__model.node.get("is_best"),b=this.__model.node.get("name"),g=this.__model.node.get("initial_selection");"vip"===this.__category&&(b=this.__model.node.get("name"));this.$el.html(h.template({image:this.__model.node.get("img160x160"),price:this.__model.edge.get("normal_price_formatted"),sale_price:this.__model.edge.get("sale_price_formatted"),title:b,title2:"",title3:"",has_discount:a,is_popular:d,is_best:e,sale_copy:this.__globalStringManager.get("SALE"),isRow:"row"===this.__viewType,isActive:this.__isActive,isMobileAndUpsell:this.__isMobile&&this.__isUpsell,line2_text:"",isVIP:"vip"===this.__category}));""!==this.__model.node.get("svgicon")&&(a=this.__model.node.get("svgicon"),this.$(".icon-wrapper").html(this.__iconManager.iconHtml(a)));this.__isMobile&&this.__isUpsell&&"vip"===this.__category&&this.$(".line2").addClass("hidden");!this.__isUpsell||this.__upsellDialog&&this.__upsellDialog.upsellAfterGift||g&&this.__userClickedLower();g=this.__model.node.get("should_disable");a=this.__model.node.get("disabled");!0===g?(this.$el.addClass("disabled"),this.__model.node.set("should_disable",null)):this.$el.toggleClass("disabled",void 0===a?!1:a)},__onRemoveFromCart:function(a,d){d=void 0!==d?d:!0;a=_.map(a.models,function(e){return e.attributes.node.product_packages_id});-1===_.indexOf(a,this.__model.node.attributes.product_packages_id)?(this.$el.removeClass("is-selected"),a=0):a=this.$(".multiplier").attr("cart-count")-1;this.$(".multiplier").attr("cart-count",a);d&&this.__dollarStoreManager.trigger("update_persistent_cart",this.__model,a)},__productSwap:function(a,d){_.each(this.__cartCollection.models,function(e){if(e&&e.attributes.node.category===d&&a.node.attributes.product_packages_id!==e.attributes.node.product_packages_id)return this.__cartCollection.remove(e),0===this.__cartCollection.length&&this.__dollarStoreManager.trigger("empty_multi_cart"),this.__dollarStoreManager.trigger("update_cart_total_price"),e.attributes.productModel.trigger("removed_from_cart",this.__cartCollection),!1}.bind(this))},_setCartCollection:function(a){this.__cartCollection=a}})}({Dialogs:m["@Dialogs"],NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],AlloyConfirmDialog:t,LinkUpholdDialog:u,MultiCartUpgrade:C,Tooltip:v,TwoFactorSetupAlertDialog:p,template:B});B=function(h){var c=h.UiCore.ListPresenter;return c.extend("MultiProductList",{className:"multi-product-list",uiContextName:"multi_product_list",tagName:"section",dependencies:["category","featureAccessManager","globalStringManager","platform"],trackedEvents:function(){return[{type:"click",selector:".more-items",name:"more_items",handler:"__onToggleMoreItems"}]},initialize:function(a){this.itemFactory=a.itemFactory||h.MultiProductItem;var d=!a.collection||0===a.collection.length;this.__cartCollection=IMVU.optionalProperty(a,"cartCollection",null);this.__isUpsell=IMVU.optionalProperty(a,"isUpsell",!1);this.__noInitialUpsellSelection=IMVU.optionalProperty(a,"noInitialUpsellSelection",!1);this.__headerText=IMVU.optionalProperty(a,"headerText","");this.__disabledProducts=IMVU.optionalProperty(a,"disabledProducts",[]);this.__selectedProduct=IMVU.optionalProperty(a,"selectedProduct",!1);this.__featureAccessManager=a.featureAccessManager;this.__isUpsell&&!d&&(this.__noInitialUpsellSelection?this.__unsetInitialUpsellSelection(a.collection.models):this.__setInitialUpsellSelection(a.collection.models));c.prototype.initialize.call(this,a);this.__isMobile=this.__featureAccessManager.isMobile();this.$el.prepend(h.template({category:this.__globalStringManager.get(this.__category),header_text:this.__headerText,no_products:d}));this.__isUpsell&&(this.$el.addClass("upsell"),this.__headerText||this.$(".system-info-header").remove());if("credits"===this.__category||"vcoin"===this.__category)"credits"===this.__category?(this.__moreOptionsText=this.__globalStringManager.get("MORE CREDIT OPTIONS"),this.__lessOptionsText=this.__globalStringManager.get("Less Credit Options")):"vcoin"===this.__category&&(this.__moreOptionsText=this.__globalStringManager.get("More VCOIN Options"),this.__lessOptionsText=this.__globalStringManager.get("Less VCOIN Options")),this.$(".system-info-header .more-items .description").text(this.__moreOptionsText),this.$(".system-info-header .more-items").removeClass("hidden"),this.__childSelector="article:nth-of-type(n+4)",this.__isUpsell||this.$(this.__childSelector).addClass("is-collapsed")},getCartCollection:function(){return this.__cartCollection},__setInitialUpsellSelection:function(a){var d=this;if(void 0!==a&&0!==a.length){var e=-1,b=-1;e=a.findIndex(function(g){return"1"===g.node.get("most_popular")});b=a.findIndex(function(g){return(g=g.edge.get("rules"))&&-1!==g.indexOf("active")});a.forEach(function(g,f){g.node.set("should_disable",d.__disabledProducts.includes(f))});!1!==this.__selectedProduct?a[Math.max(0,Math.min(a.length-1,this.__selectedProduct))].node.set("initial_selection",!0):-1!==e&&e>b?a[e].node.set("initial_selection",!0):this.__unsetInitialUpsellSelection(a)}},__unsetInitialUpsellSelection:function(a){void 0!==a&&0!==a.length&&a.forEach(function(d){d.node&&d.node.get("initial_selection")&&d.node.set("initial_selection",!1)})},__onToggleMoreItems:function(){this.$(this.__childSelector).toggleClass("is-collapsed");this.$(this.__childSelector).hasClass("is-collapsed")?(this.$(".more-items .indicator").text("+ "),this.$(".system-info-header .more-items .description").text(this.__moreOptionsText)):(this.$(this.__childSelector).css({transition:"height 0.25s ease"}),this.$(".more-items .indicator").text("- "),this.$(".system-info-header .more-items .description").text(this.__lessOptionsText))}})}({UiCore:m["@UiCore"],MultiProductItem:B,template:H});H=function(h){return IMVU.NamedCollection.extend("CartCollection",{markSelectedProducts:function(){this.each(function(c){c.set("is_selected",!0)}.bind(this))}})}({});t=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b,g=a.helperMissing;d="\n    <div class='alert-message title'>";if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"payment_processing_error_text_2",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</div>\n"},3:function(c,a,d,e){a=this.escapeExpression;return"\n        <div class='alert-message'>"+a("function"===typeof c?c.apply(c):c)+"</div>\n    "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=a.helperMissing;var g='<div class="content-container">\n\n',f=a.unless.call(c,c&&c.isNoHope,{name:"unless",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)g+=f;g+="\n\n    ";if((f=a.each.call(c,c&&c.messages,{name:"each",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n\n    <div class='alert-message summary'>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"payment_processing_error_text_3",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"\n        <a target='_blank' href='https://help.imvu.com/'>help.imvu.com</a>.\n    </div>\n</div>\n"},useData:!0})}({});y=function(h){var c=h.Dialogs.AlloyAlertDialog;return c.extend("MultiCartErrorDialog",{uiContextName:"multicart_error_dialog",className:"multicart-error-dialog dialog-type-B",dependencies:["globalStringManager","window"],initialize:function(a){this.__stringManager=a.globalStringManager;this.__keys=IMVU.requireProperty(a,"keys");a.title=this.__stringManager.get("payment_processing_status_title");a.ok=this.__stringManager.get("payment_processing_error_button");this.__storeDictionary=a.serviceProvider.create(h.StringManager,{dictionary:h.storeDictionary});a.serviceProvider.register("storeDictionary",this.__storeDictionary);Handlebars.registerHelper("storeDict_i18n",this.__storeDictionary.handlebarsHelper.bind(this.__storeDictionary));c.prototype.initialize.call(this,a)},postRender:function(){c.prototype.postRender.call(this);var a=[],d=!1,e=!1;_.each(this.__keys,function(b,g,f){try{a.push(this.__storeDictionary.get(b))}catch(k){this.__window.console.error("Error key not found in dict: %s\n%s",b,k),d||(a.push(this.__storeDictionary.get("FCM_default")),d=!0)}"co_blocked"===b&&(e=!0)}.bind(this));this.$(".id-body-contents").html(h.template({messages:a,isNoHope:e}));this.$(".content-container").scrollbar()}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],storeDictionary:m["json!@StoreModeDictionary"],StringManager:y,template:t});t=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=this.escapeExpression;return"<iframe class='frame-base' src='"+d((b=a.src||c&&c.src,"function"===typeof b?b.call(c,{name:"src",hash:{},data:e}):b))+"'></iframe>\n"},useData:!0})}({});t=function(h){var c=h.Dialogs.AlloyModalDialog;return c.extend("IframeDialog",{uiContextName:"iframe_dialog",className:"iframe-dialog dialog-type-B",dependencies:"dialogManager globalStartupModel globalStringManager platform rest window".split(" "),initialize:function(a){c.prototype.initialize.call(this,a);this.__platform=a.platform;this.title="undefined"===typeof a.titleID?"":this.__globalStringManager.get(a.titleID);this.__src=a.src;this.__hideHeader="undefined"===typeof a.hideHeader?!0:!0===a.hideHeader;this.__hideFooter="undefined"===typeof a.hideFooter?!0:!0===a.hideFooter;this.addToDOM();a.isCreatorLanding||this.__window.addEventListener("message",this.__receiveMessage.bind(this),!0)},makeSeamless:function(){this.$(".frame-base").hasClass("seamless")||this.$(".frame-base").addClass("seamless")},postRender:function(){this.setContent("body",h.template,{src:this.__src});this.makeSeamless();this.__hideHeader&&(this.$(".dialog-header").addClass("hide"),this.$(".aux-header").addClass("hide"));this.__hideFooter&&this.$(".dialog-footer").addClass("hide")},setClasses:function(a,d){a.removeClass("dialog-type-B");a.removeClass("can-dismiss");a.removeClass("iframe-dialog");a.removeClass(d);a.addClass("iframe-dialog");a.addClass(d);a.addClass("dialog-type-B");a.addClass("can-dismiss")},close:function(){this.__window.removeEventListener("message",this.__receiveMessage.bind(this),!0);c.prototype.close.call(this)},__receiveMessage:function(a){"no_dialog_in_iframe"===a.data.message?c.prototype.close.call(this):"close_iframe_dialog"===a.data.message?c.prototype.close.call(this):("opening_modal_dialog"===a.data.message&&("alert_dialog_alloy"===a.data.type||"confirm_dialog_alloy"===a.data.type||"two_factor_setup_alert_dialog"===a.data.type||"link_uphold_dialog"===a.data.type?this.$(".dialog-x").addClass("hidden"):"payment_wall_dialog"===a.data.type?(this.isUncancellableDialog=!0,this.$el.addClass("payment-wall-open")):this.$(".dialog-x").removeClass("hidden")),"deleting_modal_dialog"===a.data.message?"confirm_dialog_alloy"===a.data.type?this.$(".dialog-x").removeClass("hidden"):"alert_dialog_alloy"===a.data.type?(this.$(".dialog-x").removeClass("hidden"),this.close()):"payment_wall_dialog"===a.data.type&&(this.isUncancellableDialog=!1,this.$el.removeClass("payment-wall-open")):"iframe_open_new_window"===a.data.message&&this.__window.open(a.data.params.url,a.data.params.name?a.data.params.name:"_blank"))},delete:function(){this.__window.removeEventListener("message",this.__receiveMessage.bind(this),!0);c.prototype.delete.call(this)}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],template:t});t=function(h){var c=h.IframeBase;return c.extend("PaymentWallDialog",{uiContextName:"payment_wall_dialog",className:"payment-wall-dialog text-close",dependencies:["dialogManager"],trackedEvents:function(){return[]},initialize:function(a){a=_.extend({titleID:"payment_dialog_title",hideHeader:!1,hideFooter:!0},a);c.prototype.initialize.call(this,a);this.makeSeamless();this.addToDOM();this.$el.addClass(a.paymentWallChan)},postRender:function(){c.prototype.postRender.call(this);c.prototype.setClasses(this.$el,this.className);this.__contextualClassRemoved=this.__dialogManager.toggleTransparentOverlaySize(!1)},hide:function(){this.__contextualClassRemoved&&this.__dialogManager.toggleTransparentOverlaySize(!0);c.prototype.hide.call(this)}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],IframeBase:t});C=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b;d=this.escapeExpression;return'\n        <div class="title">'+d((b=a.status_prompt||c&&c.status_prompt,"function"===typeof b?b.call(c,{name:"status_prompt",hash:{},data:e}):b))+"</div>\n        "},3:function(c,a,d,e){return"\n            <div class='other-payment-channel-list'>\n                <span class='name'>PAY WITH VCOIN</span>\n                <img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'>\n            </div>            \n    "},5:function(c,a,d,e){d="\n        ";if((c=a["if"].call(c,c&&c.billingInfo,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"            \n    "},6:function(c,a,d,e){var b,g=a.helperMissing;d='\n            <legend class="system-info-header">\n                ';if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"BILLED TO",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+'\n            </legend>\n            <div class="billing-info"></div>\n        '},8:function(c,a,d,e){d="\n        ";if((c=a["if"].call(c,c&&c.isCheckedoutModel,{name:"if",hash:{},fn:this.program(9,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"\n        "},9:function(c,a,d,e){var b;d=this.escapeExpression;var g='\n            <div class="order-row">\n                <div class="order-item">\n                    <div class="image-container"><img src="'+d((b=(b=(b=c&&c.attributes,null==b||!1===b?b:b.node),null==b||!1===b?b:b.img160x160),"function"===typeof b?b.apply(c):b))+'"></div>\n                    <div class="item-info">\n                        <div class="item-name">'+d((b=(b=(b=c&&c.attributes,null==b||!1===b?b:b.node),null==b||!1===b?b:b.name),"function"===typeof b?b.apply(c):b))+"</div>\n                        ";if((b=a["if"].call(c,c&&c.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(10,e),inverse:this.program(12,e),data:e}))||0===b)g+=b;return g+"\n                    </div>\n                </div>\n            </div>\n        "},10:function(c,a,d,e){var b;a=this.escapeExpression;return'\n                            <div class="product-price"><img src=\'https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg\'><span class="item-info-price">'+a((b=(b=(b=c&&c.attributes,null==b||!1===b?b:b.edge),null==b||!1===b?b:b.vcoin_sale_price_formatted),"function"===typeof b?b.apply(c):b))+"</span></div>\n                        "},12:function(c,a,d,e){var b;a=this.escapeExpression;return'\n                            <div class="product-price">'+a((b=(b=(b=c&&c.attributes,null==b||!1===b?b:b.edge),null==b||!1===b?b:b.sale_price_formatted),"function"===typeof b?b.apply(c):b))+"</div>\n                        "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=this.escapeExpression;var g=a.helperMissing,f='<div class="payment-content-container">\n    <div class="info-block message">\n        ',k=a["if"].call(c,c&&c.notPaymentWall,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+='\n        <div class="text">'+d((b=a.status_message||c&&c.status_message,"function"===typeof b?b.call(c,{name:"status_message",hash:{},data:e}):b))+"</div>\n    </div>\n    ";if((k=a["if"].call(c,c&&c.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(3,e),inverse:this.program(5,e),data:e}))||0===k)f+=k;f+='\n    <legend class="system-info-header">\n        ';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"YOUR ORDER",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='\n    </legend>\n    <div class="order-block">\n        ';if((k=a.each.call(c,c&&c.cart,{name:"each",hash:{},fn:this.program(8,e),inverse:this.noop,data:e}))||0===k)f+=k;f+='\n    </div>\n    <div class="summary-block">\n        <div>';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"Order",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=" #"+d((b=a.order_id||c&&c.order_id,"function"===typeof b?b.call(c,{name:"order_id",hash:{},data:e}):b))+"</div>\n        <div>";if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"Purchase date",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=": "+d((b=a.order_date||c&&c.order_date,"function"===typeof b?b.call(c,{name:"order_date",hash:{},data:e}):b))+'</div>\n\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-dark btn-primary">\n        ';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"payment_success_button",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+"\n    </button>\n<\/script>\n"},useData:!0})}({});u=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b;d=this.escapeExpression;var g='\n<div class="info-line address">'+d((b=a.address||c&&c.address,"function"===typeof b?b.call(c,{name:"address",hash:{},data:e}):b))+'</div>\n<div class="info-line">'+d((b=a.city||c&&c.city,"function"===typeof b?b.call(c,{name:"city",hash:{},data:e}):b))+", ",f=a["if"].call(c,c&&c.state,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e});if(f||0===f)g+=f;g+=" ";if((f=a["if"].call(c,c&&c.postal_code,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===f)g+=f;return g+d((b=a.country||c&&c.country,"function"===typeof b?b.call(c,{name:"country",hash:{},data:e}):b))+"</div>\n"},2:function(c,a,d,e){var b;d=this.escapeExpression;return" "+d((b=a.state||c&&c.state,"function"===typeof b?b.call(c,{name:"state",hash:{},data:e}):b))+" "},4:function(c,a,d,e){var b;d=this.escapeExpression;return" "+d((b=a.postal_code||c&&c.postal_code,"function"===typeof b?b.call(c,{name:"postal_code",hash:{},data:e}):b))+", "},6:function(c,a,d,e){var b;d=this.escapeExpression;var g=a.helperMissing,f='\n<div class="info-line card-type">'+d((b=a.card_type||c&&c.card_type,"function"===typeof b?b.call(c,{name:"card_type",hash:{},data:e}):b))+" ";if((g=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"ending in",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+" -"+d((b=a.last_four_digits||c&&c.last_four_digits,"function"===typeof b?b.call(c,{name:"last_four_digits",hash:{},data:e}):b))+"</div>\n"},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=this.escapeExpression;d='<div class="info-line name-on-card">'+d((b=a.name||c&&c.name,"function"===typeof b?b.call(c,{name:"name",hash:{},data:e}):b))+"</div>\n";if((b=a["if"].call(c,c&&c.address,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)d+=b;d+="\n";if((b=a["if"].call(c,c&&c.last_four_digits,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===b)d+=b;return d},useData:!0})}({});var J=function(h){var c=[{name:"americanexpress",pattern:/^3[47]/},{name:"jcb",pattern:/^35(2[89]|[3-8][0-9])/},{name:"visa",pattern:/^4/},{name:"mastercard",pattern:/^5[1-5]/},{name:"discover",pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/}];return{getType:function(a){for(var d=$jscomp.makeIterator(c),e=d.next();!e.done;e=d.next())if(e=e.value,a.match(e.pattern))return e.name;return null},passesChecksum:function(a){for(var d=0,e=!1,b=a.length-1;0<=b;b--){var g=a.charAt(b);g=parseInt(g,10);e&&(g*=2,9<g&&(g-=9));d+=g;e=!e}return 0===d%10}}}({}),z=function(h){var c=h.UiCore.UiContext;return c.extend("BillingInfo",{className:"billing-info",uiContextName:"billing_info",dependencies:["globalStringManager"],initialize:function(a){c.prototype.initialize.call(this,a);this.__billingInfo=IMVU.requireProperty(a,"billingInfo");this.__CCValidator=h.CCValidator;this.addToDOM()},render:function(){var a="",d="";this.__billingInfo.credit_card&&(a=this.__CCValidator.getType(this.__billingInfo.credit_card),d=this.__billingInfo.credit_card.substring(this.__billingInfo.credit_card.length-4));this.$el.html(h.template({name:this.__billingInfo.name,address:this.__billingInfo.address,city:this.__billingInfo.city,state:this.__billingInfo.state,postal_code:this.__billingInfo.postal_code,country:this.__billingInfo.country,card_type:this.__globalStringManager.get("card_type_"+(a?a:"other")),last_four_digits:d}))}})}({UiCore:m["@UiCore"],CCValidator:J,template:u});p=function(h){var c=h.Dialogs.AlloyModalDialog;return c.extend("MultiCartSuccessDialog",{uiContextName:"multicart_success_dialog",className:"multicart-success-dialog dialog-type-B text-none",dependencies:"cart dialogManager dollarStoreManager featureAccessManager globalStartupModel globalStringManager loginManager modeManager onboardingGamificationManager orderResponse prefsManager securitySettingsManager timestampHelper window".split(" "),trackedEvents:function(){return[{type:"click",selector:".btn.btn-primary",name:"multicart_success_done",handler:"__done"}]},initialize:function(a){c.prototype.initialize.call(this,a);this.__coreDollarstoreProductOfferingData=IMVU.optionalProperty(a,"coreDollarstoreProductOfferingData",null);this.$el.removeClass("can-dismiss");this.__prefsManager=a.prefsManager;this.__hideCalled=!1;this.__origin=IMVU.optionalProperty(a,"origin",null);this.__billingInfo=IMVU.optionalProperty(a,"billingInfo",null);this.__altTitle=IMVU.optionalProperty(a,"altTitle",null);this.__vipModel=IMVU.optionalProperty(a,"vipModel",null);this.__channel=IMVU.optionalProperty(a,"channel",null);this.isVcoinAsAPaymentMethod=!1;this.title=this.__altTitle?this.__altTitle:this.__globalStringManager.get("payment_success_title");this.ok=this.__globalStringManager.get("payment_success_button");this.__creditsPurchased=this.__vipSubscriptionPurchased=!1;a=IMVU.optionalProperty(a,"cart",[]);this.isVcoinAsAPaymentMethod=a.isVcoinAsAPaymentMethod?!0:!1;for(var d=0;d<a.length;d++){var e=a[d].get("node");var b=e.category;var g=e.code_name;this.__setBadgeLocalStorage(b,g);"credits"===b?this.__creditsPurchased=e.credits:"vip"===b?(this.__vipSubscriptionPurchased=!0,["vip_web_tier_1","vip_web_tier_2","vip_web_tier_3"].includes(g)?this.__vipTierPurchased=g:this.__vipTierPurchased="legacy"):"vcoin"===b&&(this.__vcoinPurchased=!0)}this.addToDOM()},postRender:function(){var a=!1,d=this.__timestampHelper.orderDate(this.__orderResponse.get("order_date")),e=this.__globalStringManager.get("order_thankyou");this.__billingInfo&&(a=this.__billingInfo.name?!0:!1);var b=this.__globalStringManager.get("order_status_message");null!==this.__coreDollarstoreProductOfferingData&&this.__coreDollarstoreProductOfferingData.isAGift&&(e=this.__globalStringManager.get("order_thankyou_gifting"),b=this.__globalStringManager.get("order_status_message_gifting_1")+" "+this.__coreDollarstoreProductOfferingData.recipientDisplayName+" "+this.__globalStringManager.get("order_status_message_gifting_2"));"paypal"===this.__channel?null===this.__vipModel&&(b=this.__globalStringManager.get("paypal_order_status_message")):"paymentwall"===this.__channel&&(b=this.__globalStringManager.get("paymentwall_order_status_message"));var g=parseFloat(this.__orderResponse.attributes["order.price"]).toFixed(2);this.setContent("body",h.template({status_prompt:e,cart:this.__cart,has_name:a,billingInfo:this.__billingInfo,order_date:d,order_id:this.__orderResponse.attributes["order.cash_orders_id"],order_total:g,status_message:b,notPaymentWall:"paymentwall"!==this.__channel}));a?this.createChildContext(h.BillingInfo,{$replaceElement:this.$(".billing-info"),billingInfo:this.__billingInfo}):this.__billingInfo&&!0===this.__billingInfo.saved_card&&this.$(".billing-info").html(h.billingTemplate({last_four_digits:this.__billingInfo.last_four_digits,card_type:this.__globalStringManager.get("card_type_"+this.__billingInfo.card_type)}));this.setContent("footer",this.$(".dialog-footer-template").text());if(this.__window._qevents)for(a=0;a<this.__cart.length;a++)d={qacct:"p-EAkvGxbXCcR77",uid:this.__myCid.toString(),orderid:this.__orderResponse.attributes["order.cash_orders_id"],revenue:this.__cart[a].attributes.edge.sale_price.toString(),event:"refresh"},"vip"==this.__cart[a].attributes.node.category?(d.labels="_fp.event.VIP Confirmation Page,_fp.pcat.vip",this.__window._qevents.push(d)):"upgrade"==this.__cart[a].attributes.node.category&&"access_pass"==this.__cart[a].attributes.node.code_name&&(d.labels="_fp.event.AP Confirmation Page,_fp.pcat.upgrade",this.__window._qevents.push(d));if("creatorlanding"===this.__modeManager.uiApplication){var f=[],k=0;_.each(this.__cart,function(l){f.push({product_name:l.attributes.node.code_name,product_id:l.attributes.node.product_packages_id.toString(),product_category:l.attributes.node.category,product_price:l.attributes.edge.sale_price,product_quantity:1});k+=l.attributes.edge.sale_price});try{k=parseFloat(k.toFixed(2)),this.__window.pintrk("track","checkout",{value:k,order_quantity:this.__cart.length,currency:"USD",order_id:this.__orderResponse.attributes["order.cash_orders_id"],line_items:f},function(l,n){l||this.__appMonitor.reportCustomError("MultiCartSuccess","postRender","web_perm_0005l","Error returned from pintrk callback",["Reported Error: "+n])}.bind(this))}catch(l){this.__appMonitor.reportCustomError("MultiCartSuccess","postRender","web_perm_0005e","Error thrown in call to window.pintrk",["Reported Error: "+l.message])}}},__onClose:function(a){a.preventDefault();this.__done();this.hide()},__done:function(){var a=this;this.__recordEvent("click",{name:"dialog_close"});!1===this.__creditsPurchased||this.__myself.get("is_vip")?this.__vipSubscriptionPurchased?(this.__prefsManager.setBool("next.subscriptions.has_active_vip",!0),this.__prefsManager.set("next.subscriptions.active_tier_vip",this.__vipTierPurchased),this.promiseResolver.resolve("clear_cart"),this.hide(),"store"===this.__modeManager.getCurrentMode().id&&(this.__window.location="/next/store/cart")):this.__vcoinPurchased?(this.__featureAccessManager.canSeeOnboardingGamification()&&this.__recordEvent("onboarding",{name:"grant_reward",event_type:"vcoin_purchase",cid:this.__myself.get("legacy_cid"),record:!0}),this.hide(),this.__securitySettingsManager.get("2fa_enabled").then(function(d){d["2fa_enabled"]?a.promiseResolver.resolve():a.__dialogManager.showDialog(h.TwoFactorSetupAlertDialog,{requireSetup:!1}).finished.then(function(){return a.promiseResolver.resolve()}).catch(function(){return a.promiseResolver.resolve()})}).catch(function(d){a.__window.console.log("Something went wrong:",d);a.promiseResolver.resolve()})):(this.promiseResolver.resolve("clear_cart"),this.hide(),this.__modeManager.getCurrentMode()&&"store"===this.__modeManager.getCurrentMode().id&&(this.__window.location="/next/store/cart")):this.__dialogManager.confirm({title:this.__globalStringManager.get("vip_credit_upsell_title"),text:this.__globalStringManager.get("vip_credit_upsell_body",{credits:this.__creditsPurchased}),yes:this.__globalStringManager.get("vip_credit_upsell_yes"),no:this.__globalStringManager.get("vip_credit_upsell_no")}).finished.then(function(){a.__dialogManager.closeAll();a.__dollarStoreManager.makeVIPUpsell()}).catch(function(){a.promiseResolver.resolve("clear_cart");a.hide();a.__dialogManager.closeAll();"store"===a.__modeManager.getCurrentMode().id&&(a.__window.location="/next/store/cart")})},__handleHostSubRedirectMessageLinkClick:function(){this.__modeManager.openMode({mode:{id:"chat"},submode:{id:"my_rooms"}})},__setBadgeLocalStorage:function(a,d){"vip"===a?this.__setBadgeLocalStorageHelper("is_vip"):"upgrade"===a&&"access_pass"===d&&this.__setBadgeLocalStorageHelper("is_ap")},__setBadgeLocalStorageHelper:function(a){var d={value:!0,expiry:(new Date).getTime()+3e5};localStorage.setItem(a,JSON.stringify(d))},hide:function(){this.__hideCalled||(this.__hideCalled=!0,c.prototype.hide.call(this))}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],BillingInfo:z,TwoFactorSetupAlertDialog:p,billingTemplate:u,template:C});y=function(h){var c=h.Dialogs.AlloyModalDialog;return c.extend("MultiCartAbstractBaseDialog",{dependencies:"dollarStoreManager featureAccessManager loginManager Promise rest restModelFactory".split(" "),initialize:function(a){c.prototype.initialize.call(this,a);this.restModelFactory=a.restModelFactory;this.__eProtectResponse=null},_test_getPoid:function(){return this.__productOfferingID},_testSetBillingInfo:function(a){this.__billingInfo=a},__processingOldDollarstoreProductOffering:function(){return this.__window.location.href.includes("/checkout/")},__getCoreDollarstoreProductOfferingUrlAndId:function(){if(!this.__processingOldDollarstoreProductOffering())return{url:null,id:null};var a=this.__globalStartupModel.get("oldDollarstoreBypassProductOfferingUrl"),d=null;a&&(d=a.split("-"),d=d[d.length-1]);return{url:a,id:d}},__getProductOfferingDataFromCoreDS:function(){var a=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=a.url;this.__coreDollarstoreProductOfferingId=a.id;this.__coreDollarstoreProductOfferingPromise=this.__coreDollarstoreProductOfferingRecipient=this.__coreDollarstoreProductOfferingPurchaser=this.__coreDollarstoreProductOfferingData=null;null!==this.__coreDollarstoreProductOfferingUrl&&(this.__coreDollarstoreProductOfferingPromise=this.__rest.get(this.__coreDollarstoreProductOfferingUrl),this.__coreDollarstoreProductOfferingPromise.then(function(d){this.__coreDollarstoreProductOfferingResponse=d.response;this.__coreDollarstoreProductOfferingPurchaser=this.track(this.restModelFactory.readModel(this.__coreDollarstoreProductOfferingResponse.relations.purchaser,h.UiCore.NodeModel));this.__coreDollarstoreProductOfferingRecipient=this.track(this.restModelFactory.readModel(this.__coreDollarstoreProductOfferingResponse.relations.recipient,h.UiCore.NodeModel));this.__coreDollarstoreProductOfferingPurchaserPromise=this.__coreDollarstoreProductOfferingPurchaser.populated();this.__coreDollarstoreProductOfferingRecipientPromise=this.__coreDollarstoreProductOfferingRecipient.populated();this.__Promise.every([this.__coreDollarstoreProductOfferingPurchaserPromise,this.__coreDollarstoreProductOfferingRecipientPromise]).then(function(){this.__purchaserID=this.__coreDollarstoreProductOfferingPurchaser.get("legacy_cid");this.__purchaserDisplayName=this.__coreDollarstoreProductOfferingPurchaser.get("display_name");this.__recipientID=this.__coreDollarstoreProductOfferingRecipient.get("legacy_cid");this.__recipientDisplayName=this.__coreDollarstoreProductOfferingRecipient.get("display_name");this.__coreDollarstoreProductOfferingData={isAGift:this.__purchaserID!==this.__recipientID,purchaserID:this.__purchaserID,purchaserDisplayName:this.__purchaserDisplayName,recipientID:this.__recipientID,recipientDisplayName:this.__recipientDisplayName}}.bind(this))}.bind(this)).catch(function(d){this.__window.console.error("MultiCartAbstractDialog::__getProductOfferingDataFromCoreDS - error - failed to get product offering",d)}.bind(this)));return this.__coreDollarstoreProductOfferingPromise},creditCardCheckout:function(a){this.__productOfferingID=null;return new this.__Promise(function(d){var e={cart:a.models,cc_payment:this.__billingInfo};!0===this.__billingInfo.saved_card?(e.payment_method="saved_cc_payment",e.card_id=this.__billingInfo.card_id):(e.eprotect=this.__eProtectResponse,e.payment_method="cc_payment");this.__productOfferingID=a.models[0].attributes.edge.product_offering_id;var b=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=b.url;this.__coreDollarstoreProductOfferingId=b.id;this.__coreDollarstoreProductOfferingUrl&&(this.__productOfferingID=this.__coreDollarstoreProductOfferingId);this.__submitVantivOrder(e,this.__productOfferingID).then(function(g){this.__setProcessing(!1);if("delivered"===g.attributes["order.status"]&&"success"===g.attributes["transaction.status"]){var f={expiry:(new Date).getTime()+3e5};localStorage.setItem("successfulVantivOrder",JSON.stringify(f));this.__hostSubscriptionChanged&&(f=parseInt(g.get("order.date_purchased").substring(8,10)),this.__hostSubscriptionChangedText=this.__globalStringManager.get("subscription_changed_text_part_1")+String(f),this.__hostSubscriptionChangedText=1===f||21===f||31===f?this.__hostSubscriptionChangedText+"st, ":2===f||22===f?this.__hostSubscriptionChangedText+"nd, ":3===f||23===f?this.__hostSubscriptionChangedText+"rd, ":this.__hostSubscriptionChangedText+"th, ",this.__hostSubscriptionChangedText+=this.__globalStringManager.get("subscription_changed_text_part_2"));g={billingInfo:this.__billingInfo,cart:a.models,orderResponse:g,channel:"vantiv"};this.__hostSubscriptionChanged&&(g.hostSubscriptionChangedText=this.__hostSubscriptionChangedText);this.__origin&&(g.origin=this.__origin);g.coreDollarstoreProductOfferingData=this.__coreDollarstoreProductOfferingData;this.__dialogManager.showDialog(h.MultiCartSuccess,g).finished.then(function(){return d.accept()}.bind(this)).catch(function(){return d.reject()}.bind(this))}else this.__dialogManager.showDialog(h.MultiCartError,{response:g,keys:g.attributes["transaction.customer_messages"]}).finished.then(function(k){return d.reject("order_fail")}.bind(this)).catch(function(){return d.reject("order_fail")}.bind(this))}.bind(this)).catch(function(g){this.__setProcessing(!1);return this.__displayExceptionDialog(g)}.bind(this))}.bind(this))},vcoinCheckout:function(a){this.__productOfferingID=null;return new this.__Promise(function(d){var e={cart:a.models};this.__productOfferingID=a.models[0].attributes.edge.product_offering_id;var b=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=b.url;this.__coreDollarstoreProductOfferingId=b.id;this.__coreDollarstoreProductOfferingUrl&&(this.__productOfferingID=this.__coreDollarstoreProductOfferingId);this.__submitVcoinOrder(e,this.__productOfferingID).then(function(g){this.__setProcessing(!1);if("delivered"===g.attributes["order.status"]&&"success"===g.attributes["transaction.status"]){var f={value:!0,expiry:(new Date).getTime()+3e5};localStorage.setItem("successfulVcoinOrder",JSON.stringify(f));this.__hostSubscriptionChanged&&(f=parseInt(g.get("order.date_purchased").substring(8,10)),this.__hostSubscriptionChangedText=this.__globalStringManager.get("subscription_changed_text_part_1")+String(f),this.__hostSubscriptionChangedText=1===f||21===f||31===f?this.__hostSubscriptionChangedText+"st, ":2===f||22===f?this.__hostSubscriptionChangedText+"nd, ":3===f||23===f?this.__hostSubscriptionChangedText+"rd, ":this.__hostSubscriptionChangedText+"th, ",this.__hostSubscriptionChangedText+=this.__globalStringManager.get("subscription_changed_text_part_2"));g={cart:a.models,orderResponse:g,channel:"vcoin"};this.__hostSubscriptionChanged&&(g.hostSubscriptionChangedText=this.__hostSubscriptionChangedText);this.__origin&&(g.origin=this.__origin);g.coreDollarstoreProductOfferingData=this.__coreDollarstoreProductOfferingData;this.__dialogManager.showDialog(h.MultiCartSuccess,g).finished.then(function(){return d.accept()}.bind(this)).catch(function(){return d.reject()}.bind(this))}else this.__dialogManager.showDialog(h.MultiCartError,{response:g,keys:g.attributes["transaction.customer_messages"]}).finished.then(function(k){this.promiseResolver.resolve("clear_cart");return d.reject("order_fail")}.bind(this)).catch(function(){this.promiseResolver.resolve("clear_cart");return d.reject("order_fail")}.bind(this))}.bind(this)).catch(function(g){this.__setProcessing(!1);return this.__displayExceptionDialog(g)}.bind(this))}.bind(this))},__setProcessing:function(a){this.$el.toggleClass("loading",a);a?(this.$el.removeClass("can-dismiss"),this.isUncancellableDialog=!0,this.__window.$("body").addClass("waiting")):(this.$el.addClass("can-dismiss"),this.isUncancellableDialog=!1,this.__window.$("body").removeClass("waiting"));this.$(".payment-input").prop("disabled",a);this.$(".dialog-x").prop("disabled",a);this.$("button.checkout").prop("disabled",a)},__openPaypalWindow:function(){var a=!0;this.__closePaypalWindow();this.__paypalUrl=this.__externalNextRoot.replace("next/","paypal/loading/");this.__paypalWindow=this.__window.open(this.__paypalUrl,"_blank");if(!this.__paypalWindow||this.__paypalWindow.closed||"undefined"===typeof this.__paypalWindow.closed)a=!1;return a},__closePaypalWindow:function(){this.__paypalWindow&&(this.__paypalWindow.close(),this.__paypalWindow=null)},__calculateTotal:function(a){var d=0;_.each(a,function(e){e.isCheckedoutModel&&(d+=parseFloat(e.attributes.edge.sale_price))}.bind(this));return d.toFixed(2)},__displayExceptionDialog:function(a){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_failed_title"),text:this.__globalStringManager.get("payment_failed_text"),ok:this.__globalStringManager.get("payment_failed_button")}).finished.then(function(d){this.promiseResolver.resolve("clear_cart")}.bind(this)).catch(function(d){this.promiseResolver.resolve("clear_cart")}.bind(this))},__displayMultiErrorDialog:function(a,d){return this.__dialogManager.showDialog(h.MultiCartError,{response:a,keys:d}).finished.then(function(e){this.promiseResolver.resolve("clear_cart")}.bind(this)).catch(function(e){this.promiseResolver.resolve("clear_cart")}.bind(this))},__displayPaypalWindowErrorDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("Error"),text:this.__globalStringManager.get("PAYPAL ERROR OPENING WINDOW"),ok:this.__globalStringManager.get("checkout_error_button")}).finished.then(function(a){this.promiseResolver.reject()}.bind(this))},__buildOrderSelection:function(a){var d=[];_.each(a,function(e){if(e.isCheckedoutModel){var b=_.indexOf(_.pluck(d,"product_packages_id"),e.attributes.node.product_packages_id);-1===b?d.push({product_packages_id:e.attributes.node.product_packages_id,count:e.attributes.edge.selected_count?e.attributes.edge.selected_count:1}):d[b].count+=1}}.bind(this));return d},_testSetChannel:function(a){this.__channel=a},__submitVantivOrder:function(a,d){var e=this.serviceProvider.get("vantiv_threat_metrics_id"),b=this.__globalStartupModel.get("cashOrderTrans"),g=this.__calculateTotal(a.cart),f=this.__buildOrderSelection(a.cart);d={total:g,product_offering_id:d,selected:f};d.payment_authorization_info={tmxsid:e,payment_method:this.__channel.attributes.payment_method,channel:this.__channel.attributes.channel_key,eprotect:a.eprotect};"cc_payment"===a.payment_method?(d.payment_authorization_info.card_name=a.cc_payment.name,d.payment_authorization_info.card_address=a.cc_payment.address,d.payment_authorization_info.card_city=a.cc_payment.city,d.payment_authorization_info.card_state=a.cc_payment.state,d.payment_authorization_info.card_country=a.cc_payment.country,d.payment_authorization_info.card_zipcode=a.cc_payment.postal_code,d.payment_authorization_info.save_card=!0===a.cc_payment.save_card?1:0):"saved_cc_payment"===a.payment_method&&(d.payment_authorization_info.use_saved_card=1,d.payment_authorization_info.saved_card_id=a.card_id);return this.__restModelFactory.createModel(b,h.UiCore.NodeModel,d)},__submitVcoinOrder:function(a,d){var e=this.__globalStartupModel.get("cashOrderTrans"),b=this.__calculateTotal(a.cart);a=this.__buildOrderSelection(a.cart);d={total:b,product_offering_id:d,selected:a};d.payment_authorization_info={payment_method:this.__channel.attributes.payment_method,channel:this.__channel.attributes.channel_key};return this.__restModelFactory.createModel(e,h.UiCore.NodeModel,d)},__paypalCheckout:function(a,d){return new this.__Promise(function(e){if(this.__openPaypalWindow()){this.__setProcessing(!0);var b=d.models[0].attributes.edge.product_offering_id,g=this.__globalStartupModel.get("cashOrderTrans"),f=this.__buildOrderSelection(d.models);b={total:this.__calculateTotal(d.models),product_offering_id:b,selected:f};b.payment_authorization_info={payment_method:a.attributes.payment_method,channel:a.attributes.channel_key};this.__restModelFactory.createModel(g,h.UiCore.NodeModel,b).then(function(k){this.__paypalWindow&&!this.__paypalWindow.closed?(this.__paypalWindow.location=k.get("transaction.auth_url"),this.__showWaitStatusForPaypal(),this.__waitForPaypalResponse(k).then(function(){this.__setProcessing(!1);this.__dialogManager.showDialog(h.MultiCartSuccess,{cart:d.models,vipModel:this.__vipModel,orderResponse:k,altTitle:this.__globalStringManager.get("PAYPAL PROCESS PENDING TITLE"),channel:"paypal",origin:this.__origin}).finished.then(function(l){return e.accept("finished_order_success")}.bind(this)).catch(function(l){return e.accept("finished_order_fail")}.bind(this))}.bind(this)).catch(function(l){this.__displayMultiErrorDialog(k,["paypal_tab_pending"]);return e.accept("finished_order_fail")}.bind(this))):(this.__displayMultiErrorDialog(k,["paypal_tab_error"]),this.__closePaypalWindow())}.bind(this)).catch(function(k){this.__setProcessing(!1);return this.__displayExceptionDialog(k)}.bind(this))}else this.__displayPaypalWindowErrorDialog().then(function(){return e.reject("fail to load paypal window tab")}.bind(this))}.bind(this))},__showWaitStatusForPaypal:function(){this.$(".dialog-container .dialog-header .dialog-title").text(this.__globalStringManager.get("PayPal"));this.$(".checkout-container").addClass("hidden");this.$(".other-checkout-container").addClass("hidden");this.$(".pending-panel").removeClass("hidden");this.$(".dialog-footer .checkout").prop("disabled",!1);this.$(".dialog-footer .checkout").addClass("paypalpending");this.$(".dialog-footer .checkout.paypalpending").text(this.__globalStringManager.get("CANCEL"));this.$(".dialog-footer .checkout.paypalpending").on("click",function(){this.__setProcessing(!1);this.__closePaypalWindow();this.close()}.bind(this))},__waitForPaypalResponse:function(a){this.__response=a;return new this.__Promise(function(d){this.track(this.__response);return this.listenTo(this.__response,"change",function(){this.untrack(this.__response);this.stopListening(this.__response,"change");this.__response.populated().then(function(e){return"delivered"===e.get("order.status")||"need_ipn"===e.get("order.status")||"authorized"===e.get("order.status")||"pended"===e.get("order.status")||"paid"===e.get("order.status")?d.accept("delivered"):d.reject("failed")}.bind(this))}.bind(this))}.bind(this))},__paymentWallCheckout:function(a,d){return new this.__Promise(function(e){var b=d.models[0].attributes.edge.product_offering_id,g=this.__buildOrderSelection(d.models);b={total:this.__calculateTotal(d.models),product_offering_id:b,selected:g};b.payment_authorization_info={payment_method:a.attributes.payment_method,channel:a.attributes.channel_key};g=this.__globalStartupModel.get("cashOrderTrans");this.__restModelFactory.createModel(g,h.UiCore.NodeModel,b).then(function(f){"need_auth"===f.attributes["transaction.status"]?this.__dialogManager.showDialog(h.PaymentWallDialog,{src:f.attributes["transaction.auth_url"],paymentWallChan:a.attributes.channel_key}).finished.then(function(){this.__paymentWallPendingDialog(d,f).then(function(k){return e.accept("delivered")}.bind(this))}.bind(this)).catch(function(){this.__paymentWallPendingDialog(d,f).then(function(k){return e.accept("delivered")}.bind(this))}.bind(this)):this.__displayMultiErrorDialog(f,f.attributes["transaction.customer_messages"])}.bind(this)).catch(function(f){this.__displayExceptionDialog(f)}.bind(this))}.bind(this))},__paymentWallPendingDialog:function(a,d){return new this.__Promise(function(e){this.__dialogManager.showDialog(h.MultiCartSuccess,{cart:a.models,orderResponse:d,altTitle:this.__globalStringManager.get("PAYMENTWALL_PURCHASE_INFO_TITLE"),channel:"paymentwall"}).finished.then(function(){return e.accept("finished_order_success")}.bind(this)).catch(function(){return e.accept("finished_order_success")}.bind(this))}.bind(this))}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],MultiCartError:y,MultiCartSuccess:p,PaymentWallDialog:t});t=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){d="\n        ";var b=a.unless.call(c,(b=c&&c.attributes,null==b||!1===b?b:b.saved_card),{name:"unless",hash:{},fn:this.program(2,e),inverse:this.program(4,e),data:e});if(b||0===b)d+=b;return d+"\n    "},2:function(c,a,d,e){var b;a=this.escapeExpression;return"\n            <li id='"+a((b=c&&c.id,"function"===typeof b?b.apply(c):b))+"'>\n                    <span class='name'>\n                        "+a((b=(b=c&&c.attributes,null==b||!1===b?b:b.display_name),"function"===typeof b?b.apply(c):b))+"\n                    </span>\n                <img src='"+a((b=(b=c&&c.attributes,null==b||!1===b?b:b.icon_url),"function"===typeof b?b.apply(c):b))+"'>\n            </li>\n        "},4:function(c,a,d,e){var b,g;d=this.escapeExpression;var f=a.helperMissing,k="\n            <li id='"+d((b=c&&c.id,"function"===typeof b?b.apply(c):b))+"'>\n                <div class='card-info'>\n                    <p class='card-num'>\n                        XXXX-XXXX-XXXX-"+d((b=(b=c&&c.attributes,null==b||!1===b?b:b.card_last_digits),"function"===typeof b?b.apply(c):b))+"\n                    </p>\n                    <p class='expires'>\n                        <span class='card-type'>"+d((b=(b=c&&c.attributes,null==b||!1===b?b:b.card_type),"function"===typeof b?b.apply(c):b))+"</span>\n                        <span class='card-expire'>";if((b=(g=a["i18n-g"]||c&&c["i18n-g"]||f,g.call(c,"CARD EXPIRY",{name:"i18n-g",hash:{},data:e})))||0===b)k+=b;return k+" "+d((b=(b=c&&c.attributes,null==b||!1===b?b:b.expiry),"function"===typeof b?b.apply(c):b))+"</span>\n                    </p>\n                </div>\n            </li>\n        "},6:function(c,a,d,e){var b,g=a.helperMissing;d="\n        <li id='other-payment-type'>\n            <span class='name'>";if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"OTHER PAYMENT TYPE PLURAL",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n                <span class='right-arrow'></span>\n            </span>\n        </li>\n    "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){d="<ul class='payment-channel-list'>\n    ";var b=a.each.call(c,c&&c.channels,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(b||0===b)d+=b;d+="\n    ";if((b=a["if"].call(c,c&&c.hasOtherChannels,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===b)d+=b;return d+"\n</ul>"},useData:!0})}({});t=function(h){var c=h.UiCore.UiContext;return c.extend("PaymentChannels",{className:"payment-channels",uiContextName:"payment_channels",dependencies:[],initialize:function(a){c.prototype.initialize.call(this,a);this.__channels=IMVU.requireProperty(a,"channels");this.__hasOtherChannels=IMVU.requireProperty(a,"hasOtherChannels");this.addToDOM()},delete:function(){c.prototype.delete.call(this)},render:function(){this.$el.html(h.template({channels:this.__channels,hasOtherChannels:this.__hasOtherChannels}))}})}({UiCore:m["@UiCore"],template:t});C=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b;d=a.helperMissing;var g='\n            <div class=\'vcoin-terms-and-conditions\'>\n                <input type="checkbox" class="checkbox vcoin-checkbox" data-name="has_accepted_vcoin_terms_and_conditions" id=\'vcoin_terms_and_conditions_checkbox\'>\n                <label class="toggle-label" for=\'vcoin_terms_and_conditions_checkbox\'>\n                    <span class="vcoin_terms_and_conditions_checkbox_text">',f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vcoin_terms_and_conditions_text",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+=' </span><a class="vcoin-terms-and-conditions-link">';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vcoin_terms_and_conditions_link",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</a>\n                </label>\n            </div>\n            "},3:function(c,a,d,e){var b;d=a.helperMissing;var g='\n                <p><a href="https://help.imvu.com/s/article/How-do-the-VIP-5000-Credits-Work" target="_blank">',f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_terms_and_conditions_loyalty_credits_link_title",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+="</a> ";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_terms_and_conditions_loyalty_credits_text",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</p>\n            "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=a.helperMissing;var g=this.escapeExpression,f='\n<div class="status-block">\n    <ul>\n        <li class="error-message vip-checkbox-missing">',k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"error_vip_checkbox_unchecked",{name:"i18n-g",hash:{},data:e}));if(k||0===k)f+=k;f+='</li>\n        <li class="error-message vcoin-checkbox-missing">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"error_vcoin_checkbox_unchecked",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</li>\n        <li class="error-message vcoin-no-payment-methods">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"VCOIN NO PAYMENT METHODS NOTICE",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</li>\n        <li class="error-message items-unavailable-for-purchase">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"ITEMS UNAVAILBLE FOR PURCHASE",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</li>\n        <li class="notice-message notice-subscription-message hidden">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"SUBSCRIPTION ORDERS PROCESSED SEPARATELY",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</li>\n        <li class="notice-message notice-vcoin-in-cart-message hidden">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"VCOIN PAYMENT METHODS NOTICE",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</li>\n        <li class="notice-message notice-credit-card-only-message hidden">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"CREDIT CARD ONLY PAYMENT METHODS NOTICE",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</li>\n    </ul>\n</div>\n<div class=\"checkout-container\">\n    <p class='title'>";if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"CART",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</p>\n    <div class="multi-cart-list-placehoder">\n        <div class="cart-list"></div>\n    </div>\n    <div class="checkout-bottom-container">\n        <div class=\'vip-status-widget\'></div>\n        <div class=\'price-summary\'>\n            <span>';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"TODAYS TOTAL",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="&nbsp;</span><span class='price'>"+g((b=a.total||c&&c.total,"function"===typeof b?b.call(c,{name:"total",hash:{},data:e}):b))+"</span>\n        </div>\n    </div>\n\n    <div class='agreement'>\n        <div class='vip-panel hidden'>\n            <input type=\"checkbox\" class=\"checkbox\" data-name=\"has_accepted_vip_agreement\" id='vip_checkbox'>\n            <label class=\"toggle-label\" for='vip_checkbox'>\n                <span>";if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"VIP_AGREEMENT",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</span>\n                <span class="vip-terms-link vip-toc-link tooltip-target bold">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"VIP_AGREEMENT_LINK",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</span>\n            </label>\n            <div class="vip-toc-tooltip">\n                <div class="tooltip-header"><a class="vip-terms-and-conditions-link" href="'+g((b=a.vipTermsURL||c&&c.vipTermsURL,"function"===typeof b?b.call(c,{name:"vipTermsURL",hash:{},data:e}):b))+'" target="_blank">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_dialog_title",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</a></div>\n                <div class="tooltip-body">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_tool_tip_text_part_1",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=' <a class="vip-terms-and-conditions-link" href="'+g((b=a.subscriptionURL||c&&c.subscriptionURL,"function"===typeof b?b.call(c,{name:"subscriptionURL",hash:{},data:e}):b))+'" target="_blank">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_tool_tip_subscription_label",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</a>";if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_tool_tip_text_part_2",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=' <a class="vip-terms-and-conditions-link" href="'+g((b=a.helpCenterURL||c&&c.helpCenterURL,"function"===typeof b?b.call(c,{name:"helpCenterURL",hash:{},data:e}):b))+'" target="_blank">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_tool_tip_help_center_label",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</a>";if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"vip_tool_tip_text_part_3",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</div>\n            </div>\n        </div>\n        <div class='terms'>\n            ";if((k=a["if"].call(c,c&&c.vcoinInCart,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n            ";if((k=a["if"].call(c,c&&c.tieredVIPInCart,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n            <p class='imvu-terms-and-conditions'>\n                ";if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Clicking Checkout",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=" <span class='bold link'>";if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"IMVU TERMS AND CONDITIONS",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</span>\n            </p>\n        </div>\n    </div>\n    <p class='title payment-method'>";if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"CHOOSE PAYMENT METHOD",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</p>\n    <div class="payment-channels-wrapper"></div>\n</div>\n\n<div class="other-checkout-container"></div>\n\n<div class=\'pending-panel hidden\'>\n    <h2>\n        ';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"PAYPAL STATUS MESG",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='\n    </h2>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary checkout">';if((k=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"CHECKOUT",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+"</button>\n<\/script>\n"},useData:!0})}({});var E=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b,g;d=this.escapeExpression;var f=a.helperMissing,k="\n            <li class='saved-card-item' id='"+d((b=(b=c&&c.attributes,null==b||!1===b?b:b.id),"function"===typeof b?b.apply(c):b))+"'>\n                <div class='card-info'>\n                    <p class='card-num'>\n                        XXXX-XXXX-XXXX-"+d((b=(b=c&&c.attributes,null==b||!1===b?b:b.card_last_digits),"function"===typeof b?b.apply(c):b))+"\n                    </p>\n                    <p class='expires'>\n                        <span class='card-type'>"+d((b=(b=c&&c.attributes,null==b||!1===b?b:b.card_type),"function"===typeof b?b.apply(c):b))+"</span>\n                        <span class='card-expire'>";if((b=(g=a["i18n-g"]||c&&c["i18n-g"]||f,g.call(c,"CARD EXPIRY",{name:"i18n-g",hash:{},data:e})))||0===b)k+=b;k+=" "+d((b=(b=c&&c.attributes,null==b||!1===b?b:b.expiry),"function"===typeof b?b.apply(c):b))+"</span>\n                    </p>\n                    ";if((b=a["if"].call(c,(b=c&&c.attributes,null==b||!1===b?b:b.is_primary),{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===b)k+=b;return k+"\n                </div>\n            </li>\n        "},2:function(c,a,d,e){var b,g=a.helperMissing;d="\n                        <span class='primary'>";if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"Primary",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</span>\n                    "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=a.helperMissing;var g="\n<div class=\"credit-card-container\">\n    <p class='title saved-cards'>",f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"NEW CREDIT CARD",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+="</p>\n    <li class='add-new-credit-card'>\n        <span class='name'>\n            ";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Add a New Credit Card",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n        </span>\n        <img src='/common/withme/img/store/payment/payment-creditcard.png'>\n    </li>\n\n    <p class='title saved-cards'>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"SAVED CREDIT CARDS",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</p>\n    <ul class='saved-card-list'>\n        ";if((f=a.each.call(c,c&&c.saved_cards,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===f)g+=f;g+='\n    </ul>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary use">';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"USE THIS CARD",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</button>\n<\/script>\n"},useData:!0})}({}),F=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){return"\n                    <div class='other-payment-channel-list'>\n                        <span class='name'>PAY WITH VCOIN</span>\n                        <img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'>\n                    </div>\n                "},3:function(c,a,d,e){d="\n            ";if((c=a["if"].call(c,c&&c.isCheckedoutModel,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"\n            "},4:function(c,a,d,e){var b;d=this.escapeExpression;var g='\n                <div class="order-row">\n                    <div class="order-item">\n                        <div class="image-container"><img src="'+d((b=(b=(b=c&&c.attributes,null==b||!1===b?b:b.node),null==b||!1===b?b:b.img160x160),"function"===typeof b?b.apply(c):b))+'"></div>\n                        <div class="item-info">\n                            <div class="item-name">'+d((b=(b=(b=c&&c.attributes,null==b||!1===b?b:b.node),null==b||!1===b?b:b.name),"function"===typeof b?b.apply(c):b))+"</div>\n                            ";if((b=a["if"].call(c,c&&c.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(5,e),inverse:this.program(10,e),data:e}))||0===b)g+=b;g+="\n                        </div>\n                        ";if((b=a["if"].call(c,c&&c.hasDiscount,{name:"if",hash:{},fn:this.program(15,e),inverse:this.noop,data:e}))||0===b)g+=b;g+="\n                    </div>\n                </div>\n                ";if((b=a["if"].call(c,c&&c.hasSupportingText,{name:"if",hash:{},fn:this.program(17,e),inverse:this.noop,data:e}))||0===b)g+=b;return g+"\n            "},5:function(c,a,d,e){d="\n                                ";if((c=a["if"].call(c,c&&c.hasDiscount,{name:"if",hash:{},fn:this.program(6,e),inverse:this.program(8,e),data:e}))||0===c)d+=c;return d+"\n                            "},6:function(c,a,d,e){var b;a=this.escapeExpression;return"\n                                    <div class=\"product-price\">\n                                        <span class='normal-price img-position'><img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'><span class=\"item-info-price\">"+a((b=(b=(b=c&&c.attributes,null==b||!1===b?b:b.edge),null==b||!1===b?b:b.vcoin_normal_price_formatted),"function"===typeof b?b.apply(c):b))+"</span></span>\n                                        <span class='sale-price' img-position><img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'><span class=\"item-info-price\">"+a((b=(b=(b=c&&c.attributes,null==b||!1===b?b:b.edge),null==b||!1===b?b:b.vcoin_sale_price_formatted),"function"===typeof b?b.apply(c):b))+"</span></span>\n                                    </div>\n                                "},8:function(c,a,d,e){var b;a=this.escapeExpression;return"\n                                    <div class='product-price img-position'><img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'><span class=\"item-info-price\">"+a((b=(b=(b=c&&c.attributes,null==b||!1===b?b:b.edge),null==b||!1===b?b:b.vcoin_sale_price_formatted),"function"===typeof b?b.apply(c):b))+"</span></div>\n                                "},10:function(c,a,d,e){d="\n                                ";if((c=a["if"].call(c,c&&c.hasDiscount,{name:"if",hash:{},fn:this.program(11,e),inverse:this.program(13,e),data:e}))||0===c)d+=c;return d+"\n                            "},11:function(c,a,d,e){var b;a=this.escapeExpression;return"\n                                    <div class=\"product-price\">\n                                        <span class='normal-price'>"+a((b=(b=(b=c&&c.attributes,null==b||!1===b?b:b.edge),null==b||!1===b?b:b.normal_price_formatted),"function"===typeof b?b.apply(c):b))+"</span>\n                                        <span class='sale-price'>"+a((b=(b=(b=c&&c.attributes,null==b||!1===b?b:b.edge),null==b||!1===b?b:b.sale_price_formatted),"function"===typeof b?b.apply(c):b))+"</span>\n                                    </div>\n                                "},13:function(c,a,d,e){var b;a=this.escapeExpression;return'\n                                    <div class="product-price">'+a((b=(b=(b=c&&c.attributes,null==b||!1===b?b:b.edge),null==b||!1===b?b:b.sale_price_formatted),"function"===typeof b?b.apply(c):b))+"</div>\n                                "},15:function(c,a,d,e){var b,g=a.helperMissing;d="\n                            <div class='product-sale'>\n                                <span>";if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"SALE",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"4</span>\n                            </div>\n                        "},17:function(c,a,d,e){var b;a=this.escapeExpression;return'\n                    <div class="supporting-text">\n                        '+a((b=c&&c.supportingText,"function"===typeof b?b.apply(c):b))+"\n                    </div>\n                "},19:function(c,a,d,e){return"\n            <img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'>\n            <span class=\"order-total-converted\"></span>\n        "},21:function(c,a,d,e){return'\n            <span class="order-total"></span>\n        '},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=a.helperMissing;var g='<div class="content-container">\n    <div class="content-container-content">\n        <legend class="system-info-header">\n            ',f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Payment Method",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='\n        </legend>\n            <div class="info-block">\n                ';if((f=a["if"].call(c,c&&c.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===f)g+=f;g+='\n                <div class="billing-info"></div>\n            </div>\n\n        <legend class="system-info-header">\n            ';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Cart",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='\n        </legend>\n        <div class="multicart-order-list">\n            ';if((f=a.each.call(c,c&&c.cart,{name:"each",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)g+=f;g+='\n        </div>\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary buy-now">';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"BUY",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n        <span class=\"item-count\"></span>\n        <span class='items-for'></span>\n        ";if((f=a["if"].call(c,c&&c.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(19,e),inverse:this.program(21,e),data:e}))||0===f)g+=f;return g+"\n    </button>\n<\/script>\n"},useData:!0})}({});u=function(h){var c=h.MultiCartAbstractDialog;return c.extend("MultiCartCreditReviewDialog",{uiContextName:"multicart_credit_card_review_dialog",className:"multicart-credit-card-review-dialog dialog-type-B",dependencies:"cart channel dialogManager featureAccessManager globalStartupModel globalStringManager loginManager restModelFactory serviceProvider window".split(" "),trackedEvents:function(){return[{type:"click",selector:".buy-now.standard-purchase",name:"buy_now",handler:this.__onCheckout},{type:"click",selector:".buy-now.in-bypass-experiment",name:"buy_now_bypass_experiment",handler:this.__onCheckout},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(a){c.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.__isCoreDollarStoreBypassPurchase=null!==this.__getCoreDollarstoreProductOfferingUrlAndId().url;this.__getProductOfferingDataFromCoreDS();this.__eProtectResponse=IMVU.optionalProperty(a,"eProtectResponse",null);this.$el.removeClass("can-dismiss");this.__origin=IMVU.optionalProperty(a,"origin",null);this.__channel=IMVU.optionalProperty(a,"channel",null);this.__source=IMVU.optionalProperty(a,"source",null);this.__billingInfo=IMVU.optionalProperty(a,"billingInfo",null);this.title=this.__globalStringManager.get("credit_card_review_title");this.isVcoinAsAPaymentMethod=!1;this.__myself=this.__loginManager.getCurrentUser();this.addToDOM()},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&"pay_with_vcoin_cta"!==this.__source&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.__hostSubscriptionChanged=!1;var a=0,d=0;_.each(this.__cart.models,function(b){b.isCheckedoutModel&&(a+=b.attributes.edge.sale_price,b.hasDiscount=b.attributes.edge.normal_price>b.attributes.edge.sale_price,d++)}.bind(this));"vcoin"===this.__channel.attributes.channel_key?(a=parseFloat(250*a).toFixed(2),this.isVcoinAsAPaymentMethod=!0,this.setContent("body",h.template({cart:this.__cart.models,channel:this.__channel,isVcoinAsAPaymentMethod:this.isVcoinAsAPaymentMethod}))):(a="$"+parseFloat(a).toFixed(2),this.setContent("body",h.template({cart:this.__cart.models})),this.$(".billing-info").html(h.billingTemplate({last_four_digits:this.__billingInfo.last_four_digits,card_type:this.__globalStringManager.get("card_type_"+this.__billingInfo.card_type)})));var e=1===d?this.__stringManager.get("BUY FOR SINGULAR"):this.__stringManager.get("BUY FOR PLURAL");this.setContent("footer",this.$(".dialog-footer-template").text());this.$(".items-for").text(e);this.$(".item-count").text(d);"vcoin"===this.__channel.attributes.channel_key?this.$(".order-total-converted").text(a):this.$(".order-total").text(a);this.__isCoreDollarStoreBypassPurchase?this.$(".buy-now").addClass("in-bypass-experiment"):this.$(".buy-now").addClass("standard-purchase")},__onCheckout:function(){this.__channel.attributes.channel_key&&"vcoin"===this.__channel.attributes.channel_key?(this.__cart.isVcoinAsAPaymentMethod=!0,this.$(".buy-now").addClass("disabled"),this.vcoinCheckout(this.__cart).then(function(){this.promiseResolver.resolve();this.close()}.bind(this)).catch(function(){this.promiseResolver.resolve();this.close()}.bind(this))):(this.$(".buy-now").addClass("disabled"),this.creditCardCheckout(this.__cart).then(function(){this.promiseResolver.resolve();this.close()}.bind(this)).catch(function(){this.promiseResolver.resolve();this.close()}.bind(this)))},__goBack:function(){this.hide();this.promiseResolver.reject()}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],BillingInfo:z,MultiCartAbstractDialog:y,billingTemplate:u,template:F});z=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){return'\n            <iframe id="eProtect-iframe" name="eProtect-iframe" frameborder="0" src="https://localhost.imvu.com/third_party/worldpay/eProtect_iframe/nextBig.html" height="150" width="100%"></iframe>\n        '},3:function(c,a,d,e){return'\n            <div class="input-row worldpay-eprotect-iframe" id="eProtectiframe"></div>\n        '},5:function(c,a,d,e){return' checked="checked" '},7:function(c,a,d,e){var b;a=this.escapeExpression;return'\n                    <option value="'+a((b=null==e||!1===e?e:e.key,"function"===typeof b?b.apply(c):b))+'">'+a("function"===typeof c?c.apply(c):c)+"</option>\n                    "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=a.helperMissing;var g='<div class="content-container">\n    <div class="error-block">\n        <ul>\n            <li class="error-message field-missing">',f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"error_field_missing",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='</li>\n            <li class="error-message cardnumber-invalid">';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"error_card_number_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message exp-date-expired">';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"error_exp_date_expired",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message security-code-invalid">';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"error_security_code_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message zip-invalid">';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"error_zip_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message postal-invalid">';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"error_postal_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message vip-checkbox-missing">';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"error_vip_checkbox_unchecked",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message cardname-invalid">';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"error_invalid_cc_name",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n        </ul>\n    </div>\n    <div class="payment-block">\n        <legend class="system-info-header">\n            ';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Payment Method",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n        </legend>\n\n        ";if((f=a["if"].call(c,c&&c.canSeeEprotectCss,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===f)g+=f;g+='\n\n        <div class="input-row save-cc-for-later">\n            <input id=\'save-for-later-checkbox\' class="save-for-later checkbox" tabindex=\'13\' type="checkbox"\n                ';if((f=a["if"].call(c,c&&c.saveCard,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===f)g+=f;g+=">\n            <label for='save-for-later-checkbox'>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Save For Later",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</label>\n        </div>\n    </div>\n    <div class="billing-address-block">\n        <legend class="system-info-header">\n            ';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Billing Information",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n        </legend>\n        <div class=\"input-row\">\n            <input class='name-on-card' maxlength='50' tabindex='5' required placeholder='";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Name on Card",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n        </div>\n        <div class=\"input-row\">\n            <input class='address' maxlength='50' tabindex='6' required placeholder='";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Address",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n        </div>\n        <div class=\"input-row\">\n            <input class='city' maxlength='20' tabindex='7' required placeholder='";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"City",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n            <div class='us-fields state-province-container input-container'>\n                <select class='state' tabindex='8' >\n                    <option selected value=\"\">";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"State",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</option>\n                    ";if((f=a.each.call(c,c&&c.states,{name:"each",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n                </select>\n            </div>\n            <div class='non-us-fields ca-province state-province-container input-container'>\n                <select class='province' tabindex='10'>\n                    <option selected value=\"\">";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Province",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</option>\n                    ";if((f=a.each.call(c,c&&c.provinces,{name:"each",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n                </select>\n            </div>\n            <input class='us-fields zip' maxlength='5' tabindex='9' placeholder='";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Zipcode",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n            <input class='non-us-fields postal' maxlength='12' tabindex='11' placeholder='";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Postal Code",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n            <div class='country-container input-container us'>\n                <select class='country' tabindex='12' required>\n                    <option value=''>";if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Country",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</option>\n                    ";if((f=a.each.call(c,c&&c.countries,{name:"each",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)g+=f;g+='\n                </select>\n            </div>\n        </div>\n    </div>\n</div>\n\n<footer class="dialog-footer">\n    <button class="btn btn-primary continue-checkout">';if((f=(b=a["i18n-g"]||c&&c["i18n-g"]||d,b.call(c,"Continue to Checkout",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</button>\n</footer>\n"},useData:!0})}({});w=function(h){var c=h.Dialogs.AlloyModalDialog;return c.extend("MultiCartAddCreditCard",{uiContextName:"multicart_add_credit_card_dialog",className:"multicart-add-credit-card-dialog dialog-type-B",dependencies:"appMonitor cart channel currentLocale dialogManager featureAccessManager globalStringManager loginManager moment orderTotal prefsManager timer window".split(" "),trackedEvents:function(){return[{type:"click",selector:".continue-checkout",name:"continue_checkout",handler:this.__continueCheckout},{type:"keyup",selector:".name-on-card",name:"changing_name",handler:this.__isBlankNameOnCard},{type:"blur",selector:".name-on-card",name:"changed_name",handler:this.__validateNameOnCard},{type:"keyup",selector:".address",name:"changing_address",handler:this.__isBlankAddress},{type:"blur",selector:".address",name:"changed_address",handler:this.__validateAddress},{type:"keyup",selector:".city",name:"change_city",handler:this.__isBlankCity},{type:"blur",selector:".city",name:"change_city",handler:this.__validateCity},{type:"change",selector:".state",name:"change_state_select",handler:this.__validateState},{type:"keyup",selector:".zip",name:"changing_zip",handler:this.__isBlankZip},{type:"blur",selector:".zip",name:"changed_zip",handler:this.__validateZip},{type:"change",selector:".province",name:"change_province_select",handler:this.__validateProvince},{type:"keyup",selector:".postal",name:"changing_postal",handler:this.__isBlankPostal},{type:"blur",selector:".postal",name:"changed_postal",handler:this.__validatePostal},{type:"change",selector:".country",name:"change_country_select",handler:this.__validateCountry},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(a){c.prototype.initialize.call(this,a);this.shouldFocusOnPrimaryButton=!1;a.loginManager.isLoggedIn()||(this.__window.onbeforeunload=null,this.__window.location.href=this.__siteRoot);this.title=this.__globalStringManager.get("Add New Credit Card");this.__monthRange="01 02 03 04 05 06 07 08 09 10 11 12".split(" ");this.__getYearRange();this.__states=h.StateMap;this.__provinces=h.ProvinceMap;this.__countries=h.CountryMap;this.__CCValidator=h.CCValidator;this.__missingFields=[];this.__myself=a.loginManager.getCurrentUser();this.__origin=IMVU.optionalProperty(a,"origin",null);this.__isMobile=this.__featureAccessManager.isMobile();this.__eProtectData=this.__serviceProvider.get("worldpayEprotectData");this.__eProtectFailureCodesAccountNumber=this.__eProtectData.eProtectFailureCodesAccountNumber;this.__eProtectFailureCodesCCV=this.__eProtectData.eProtectFailureCodesCCV;this.__canSeeEprotectCss=!1;this.__currentLocale=this.__currentLocale||"en";this.__currentLocale="www"===this.__currentLocale?"en":this.__currentLocale;this.addToDOM()},delete:function(){c.prototype.delete.call(this);this.__tooltip&&this.__tooltip.delete()},close:function(){this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.__prefsManager.populated().then(function(){this.setContent("body",h.template,{monthRange:this.__monthRange,yearRange:this.__yearRange,states:this.__states,provinces:this.__provinces,countries:this.__countries,saveCard:!this.__prefsManager.getBool("next.payment.creditcard.save_card.disable"),canSeeEprotectCss:this.__canSeeEprotectCss});this.$(".non-us-fields").hide();this.$('.country option[value="US"]').prop("selected",!0);this.__stateWidget=this.createChildContext(h.Dropdown,{$replaceElement:this.$(".state")});this.createChildContext(h.Dropdown,{$replaceElement:this.$(".province")});this.createChildContext(h.Dropdown,{$replaceElement:this.$(".country")});this.$(".content-container").scrollbar();this.__tooltip=this.serviceProvider.create(h.Tooltip,{$replaceElement:this.$(".security-code-tooltip"),$tooltipTarget:this.$(".security-code-help-link")});this.__myself.get("is_adult")||this.$(".content-container .save-cc-for-later").addClass("hidden");try{$(document).ready(function(){var a=this.__currentLocale+"NextBig20201012b",d=this.__currentLocale+"NextSmall20201012b";a={paypageId:this.__eProtectData.payPageID,style:this.__isMobile?d:a,reportGroup:this.__eProtectData.reportGroup,timeout:this.__eProtectData.timeout,div:"eProtectiframe",callback:this.__eProtectIframeClientCallback.bind(this),checkoutIdMode:!0,showCvv:!0,months:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},numYears:20,tooltipText:this.__globalStringManager.get("worldpay_eProtext_ccv_tool_tip"),tabIndex:{cvv:1,accountNumber:2,expMonth:3,expYear:4},placeholderText:{cvv:this.__globalStringManager.get("worldpay_eProtext_ccv_text"),accountNumber:this.__globalStringManager.get("worldpay_eProtext_ccv_acc_num")},inputsEmptyCallback:this.__eProtectInputsEmptyCallback.bind(this),enhancedUxFeatures:{inlineFieldValidations:!0}};"undefined"===typeof EprotectIframeClient?(this.__eProtectIframeClient=null,this.__dialogManager.showDialog(h.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("worldpay_eProtext_alert_title"),text:this.__stringManager.get("worldpay_eProtext_alert_text"),ok:this.__stringManager.get("OK")}).finished.then(function(){this.close()}.bind(this)).catch(function(){this.close()}.bind(this))):(this.__eProtectIframeClient=new EprotectIframeClient(a),this.__isMobile?this.$("#eProtect-iframe").attr("height","195"):this.__eProtectIframeClient.autoAdjustHeight())}.bind(this))}catch(a){this.__window.console.error("MultiCartAddCreditCard::postRender - Failed to initialize eprotect",a),this.__appMonitor.reportCustomError("MultiCartAddCreditCard","postRender","web_perm_0011","MultiCartAddCreditCard::postRender - Failed to initialize eprotect",this.__appMonitor.buildErrorArray(a))}}.bind(this))},_test_getEProtectIframeClient:function(){return this.__eProtectIframeClient},__eProtectIframeClientCallback:function(a){var d=parseInt(a.response),e=!1;870!=d&&(this.__eProtectFailureCodesAccountNumber.includes(d)||this.__eProtectFailureCodesCCV.includes(d)||this.__window.console.error("MultiCartAddCreditCard::__eProtectIframeClientCallback - Unrecognized response code ("+String(d)+")"));this.$(".cardnumber-invalid").removeClass("error-visible");this.__eProtectFailureCodesAccountNumber.includes(d)&&(this.$(".cardnumber-invalid").addClass("error-visible"),e=!0);this.$(".security-code-invalid").removeClass("error-visible");this.__eProtectFailureCodesCCV.includes(d)&&(this.$(".security-code-invalid").addClass("error-visible"),e=!0);this.__updateErrorStatus();this.__ccLastFour=a.lastFour;this.__ccType=a.type;this.__eProtectResponse=JSON.stringify(a);0!==this.$(".error-visible").length||e||this.__dialogManager.showDialog(h.MultiCartReview,{billingInfo:this.__getBillingInfo(),channel:this.__channel,cart:this.__cart,origin:this.__origin,eProtectResponse:this.__eProtectResponse}).finished.then(function(b){this.promiseResolver.resolve(b);this.close()}.bind(this)).catch(function(b){"closing_all"===b&&this.close()}.bind(this))},__eProtectInputsEmptyCallback:function(a){this.$(".cardnumber-invalid").addClass("error-visible");this.$(".security-code-invalid").addClass("error-visible");this.$(".exp-date-expired").addClass("error-visible")},__getYearRange:function(){this.__yearRange=[];for(var a=this.__timer.getDate().getFullYear(),d=0;20>d;d++)this.__yearRange.push(d+a)},__validateInputs:function(){this.__billingInfoErrorDetected=!1;this.__validateNameOnCard();this.__validateCardName();this.__validateAddress();this.__validateCity();this.__validateCountry();"US"===this.$(".country select").val()?(this.__validateZip(),this.__validateState()):"CA"===this.$(".country select").val()&&(this.__validatePostal(),this.__validateProvince())},__errorIfBlank:function(a,d){d=d?""===this.$("."+a+" select").val():""===this.$("."+a).val().trim();this.__updateMissingFields(a,d);d&&(this.__billingInfoErrorDetected=!0);return d},__updateMissingFields:function(a,d){this.$("."+a).toggleClass("payment-error",d);var e=this.__missingFields.indexOf(a);d&&0>e?this.__missingFields.push(a):!d&&-1<e&&this.__missingFields.splice(e,1);this.$(".field-missing").toggleClass("error-visible",0!==this.__missingFields.length)},__validateCardName:function(){var a=this.$(".name-on-card").val().trim(),d=a.trim().split(/\s+/).length;/\d/.test(a)||2>d?(this.$(".cardname-invalid").addClass("error-visible"),this.$(".name-on-card").addClass("payment-error")):(this.$(".cardname-invalid").removeClass("error-visible"),this.$(".name-on-card").removeClass("payment-error"));this.__updateErrorStatus()},__isBlankNameOnCard:function(){-1<this.__missingFields.indexOf("name-on-card")&&this.__errorIfBlank("name-on-card");this.__updateErrorStatus()},__validateNameOnCard:function(){this.__errorIfBlank("name-on-card");this.__updateErrorStatus()},__isBlankAddress:function(){-1<this.__missingFields.indexOf("address")&&this.__errorIfBlank("address");this.__updateErrorStatus()},__validateAddress:function(){this.__errorIfBlank("address");this.__updateErrorStatus()},__isBlankCity:function(){-1<this.__missingFields.indexOf("city")&&this.__errorIfBlank("city");this.__updateErrorStatus()},__validateCity:function(){this.__errorIfBlank("city");this.__updateErrorStatus()},__validateState:function(){this.__errorIfBlank("state",!0);this.__updateErrorStatus()},__validateProvince:function(){this.__errorIfBlank("province",!0);this.__updateErrorStatus()},__isBlankZip:function(){-1<this.__missingFields.indexOf("zip")&&this.__errorIfBlank("zip");this.__updateErrorStatus()},__validateZip:function(){this.__errorIfBlank("zip")?this.$(".zip-invalid").removeClass("error-visible"):this.$(".zip").val().trim().match(/^\d\d\d\d\d$/)?(this.$(".zip-invalid").removeClass("error-visible"),this.$(".zip").removeClass("payment-error")):(this.$(".zip-invalid").addClass("error-visible"),this.$(".zip").addClass("payment-error"),this.__billingInfoErrorDetected=!0);this.__updateErrorStatus()},__isBlankPostal:function(){"CA"===this.$(".country select").val()&&-1<this.__missingFields.indexOf("postal")&&this.__errorIfBlank("postal");this.__updateErrorStatus()},__validatePostal:function(){"CA"===this.$(".country select").val()&&(this.__errorIfBlank("postal")?this.$(".postal-invalid").removeClass("error-visible"):this.$(".postal").val().trim().match(/^[A-Za-z]\d[A-Za-z]\s*\d[A-Za-z]\d$/)?(this.$(".postal-invalid").removeClass("error-visible"),this.$(".postal").removeClass("payment-error")):(this.$(".postal-invalid").addClass("error-visible"),this.$(".postal").addClass("payment-error"),this.__billingInfoErrorDetected=!0));this.__updateErrorStatus()},__validateCountry:function(){this.$(".zip-invalid").removeClass("error-visible");this.$(".postal-invalid").removeClass("error-visible");this.__updateMissingFields("zip",!1);this.__updateMissingFields("state",!1);this.__updateMissingFields("postal",!1);this.__updateMissingFields("province",!1);this.__errorIfBlank("country",!0);"US"===this.$(".country select").val()?(this.$(".us-fields").show(),this.$(".non-us-fields").hide(),this.$(".country-container").addClass("us"),this.$(".postal").val(""),this.$('.ca-province option[value=""]').prop("selected",!0)):(this.$(".country-container").removeClass("us"),this.$(".us-fields").hide(),this.$(".zip").val(""),this.$('.state option[value=""]').prop("selected",!0),this.$(".non-us-fields").show(),"CA"===this.$(".country select").val()?(this.$(".ca-province").show(),this.$(".country-container").addClass("canada"),this.$(".postal").removeClass("intl")):(this.$(".postal").addClass("intl"),this.$(".ca-province").hide(),this.$('.ca-province option[value=""]').prop("selected",!0),this.$(".country-container").removeClass("canada")));this.__updateErrorStatus()},__updateErrorStatus:function(){this.$(".error-block").toggleClass("has-error",0<this.$(".error-visible").length)},__continueCheckout:function(){this.__validateInputs();if(!this.__billingInfoErrorDetected&&!this.__missingFields.length){var a=this.__moment(new Date).format("YYYYMMDDhhmmss");a={id:String(this.__myself.get("legacy_cid"))+"e"+a,pciNonSensitive:!1};this.__eProtectIframeClient.getPaypageRegistrationId(a)}},__getBillingInfo:function(){var a=this.$(".country select").val(),d=this.$(".state select").val(),e=this.$(".zip").val().trim();"CA"===a?(d=this.$(".province select").val(),e=this.$(".postal").val().trim()):"US"!==a&&(d="",e=this.$(".postal").val().trim());var b=this.__eProtectResponse,g=this.__ccLastFour,f=this.__ccType;return{name:this.$(".name-on-card").val().trim(),address:this.$(".address").val().trim(),city:this.$(".city").val().trim(),state:d,postal_code:e,country:a,save_card:this.$("#save-for-later-checkbox").prop("checked"),eProtectResponse:b,last_four_digits:g,card_type:f}},__goBack:function(){this.hide();this.promiseResolver.reject()},__destroy:function(){this.hide();this.delete()}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],CCValidator:J,CountryMap:m["json!/common/js/JSON/Countries.json"],Dropdown:w,MultiCartReview:u,ProvinceMap:m["json!/common/js/JSON/Provinces.json"],StateMap:m["json!/common/js/JSON/States.json"],Tooltip:v,template:z});J=function(h){var c=h.Dialogs.AlloyModalDialog;return c.extend("MultiCartSavedCardsDialog",{uiContextName:"multicart_saved_cards_dialog",className:"multicart-saved-cards-dialog dialog-type-B",dependencies:"cart channel dialogManager globalStartupModel globalStringManager restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:".back-button",name:"back_button",handler:"__goBack"},{type:"click",selector:".add-new-credit-card",name:"add_new",handler:"__addNewCard"},{type:"click",selector:"li.saved-card-item",name:"select_saved_card",handler:"__selectSavedCard"},{type:"click",selector:".btn.btn-primary",name:"use_card",handler:"__useThisCard"}]},initialize:function(a){c.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.$el.removeClass("can-dismiss");this.title=this.__globalStringManager.get("SAVED CREDIT CARDS");this.__origin=IMVU.optionalProperty(a,"origin",null);a=this.__globalStartupModel.get("savedCreditCardUrl");this.__saved_cards=this.track(this.__restModelFactory.readCollection(a,h.UiCore.NodeCollection));this.__saved_cards.populated().then(function(){this.addToDOM()}.bind(this))},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.setContent("body",h.template,{saved_cards:this.__saved_cards.models});this.$(".saved-card-list li:nth-of-type(1)").addClass("is-selected");this.__selectedCard=this.$(".saved-card-list li:nth-of-type(1)").prop("id");this.setContent("footer",this.$(".dialog-footer-template").text())},__addNewCard:function(){this.__dialogManager.showDialog(h.MultiCartAddCreditCard,{cart:this.__cart,channel:this.__channel,itemCount:this.__cart.length,orderTotal:this.__total,origin:this.__origin}).finished.then(function(a){"clear_cart"===a&&this.__window.location.reload();this.promiseResolver.resolve(a);this.close()}.bind(this)).catch(function(a){"closing_all"===a&&this.close()}.bind(this))},__useThisCard:function(){var a=this.__getCardFromId(this.__selectedCard);this.__dialogManager.showDialog(h.MultiCartReview,{billingInfo:{card_type:a.attributes.card_type,name:a.attributes.name,last_four_digits:a.attributes.card_last_digits,card_id:a.attributes.id,saved_card:!0},channel:this.__channel,cart:this.__cart,origin:this.__origin}).finished.then(function(d){"clear_cart"===d&&this.__window.location.reload();this.promiseResolver.resolve(d);this.close()}.bind(this)).catch(function(d){"closing_all"===d&&this.close()}.bind(this))},__onClose:function(a){a.preventDefault();this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},__goBack:function(){this.hide();this.promiseResolver.reject()},__selectSavedCard:function(a){this.__selectedCard=a.target.id;this.$(".saved-card-list li").removeClass("is-selected");this.$('.saved-card-list li[id="'+this.__selectedCard+'"]').addClass("is-selected")},__getCardFromId:function(a){return _.find(this.__saved_cards.models,function(d){if(a===d.attributes.id)return d})}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],MultiCartAddCreditCard:w,MultiCartReview:u,template:E});z=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b,g=a.helperMissing;d=this.escapeExpression;var f="\r\n";if((g=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"VIP RENEWS ON",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+"&nbsp;<span class='date'>"+d((b=a.renew_date||c&&c.renew_date,"function"===typeof b?b.call(c,{name:"renew_date",hash:{},data:e}):b))+"</span><span class='price'>"+d((b=a.price||c&&c.price,"function"===typeof b?b.call(c,{name:"price",hash:{},data:e}):b))+"</span>\r\n"},useData:!0})}({});z=function(h){var c=h.UiCore.UiContext;return c.extend("MultiCartVipStatus",{className:"multi-cart-vip-status",uiContextName:"multi_cart_vip_status",tagName:"p",dependencies:["globalStringManager","loginManager","model"],trackedEvents:function(){return[]},VIP_ONE_MONTH:12,VIP_THREE_MONTHS:13,VIP_ONE_YEAR:14,initialize:function(a){c.prototype.initialize.call(this,a);this.__myself=this.__loginManager.getCurrentUser();this.__months_to_add={};this.__months_to_add[this.VIP_ONE_MONTH]=1;this.__months_to_add[this.VIP_THREE_MONTHS]=3;this.__months_to_add[this.VIP_ONE_YEAR]=12;this.addToDOM()},render:function(){c.prototype.render.call(this);var a=this.__months_to_add[this.__model.attributes.node.product_packages_id];a||(a=1);a=(this.__myself.get("is_vip")?h.moment(this.__myself.get("vip_expires")):h.moment()).add("months",a);this.$el.html(h.template({price:this.__model.attributes.edge.sale_price_formatted,renew_date:a.format("MM/DD/YYYY")}))}})}({moment:m["@moment"],UiCore:m["@UiCore"],template:z});E=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){return"disabled"},3:function(c,a,d,e){var b,g;d=this.escapeExpression;return"\r\n            <div class='product-price'>\r\n                <span class='normal-price'>"+d((b=(b=(b=(b=c&&c.model,null==b||!1===b?b:b.attributes),null==b||!1===b?b:b.edge),null==b||!1===b?b:b.normal_price_formatted),"function"===typeof b?b.apply(c):b))+"</span>\r\n                <span class='sale-price'>"+d((b=(b=(b=(b=c&&c.model,null==b||!1===b?b:b.attributes),null==b||!1===b?b:b.edge),null==b||!1===b?b:b.sale_price_formatted),"function"===typeof b?b.apply(c):b))+"</span>\r\n                <span class='renewal-period'> "+d((g=a.renewalPeriodText||c&&c.renewalPeriodText,"function"===typeof g?g.call(c,{name:"renewalPeriodText",hash:{},data:e}):g))+"</span>\r\n            </div>\r\n        "},5:function(c,a,d,e){var b,g;d=this.escapeExpression;return"\r\n            <div class='product-price'>\r\n                "+d((b=(b=(b=(b=c&&c.model,null==b||!1===b?b:b.attributes),null==b||!1===b?b:b.edge),null==b||!1===b?b:b.sale_price_formatted),"function"===typeof b?b.apply(c):b))+"<span class='renews-monthly'> "+d((g=a.renewalPeriodText||c&&c.renewalPeriodText,"function"===typeof g?g.call(c,{name:"renewalPeriodText",hash:{},data:e}):g))+"</span>\r\n            </div>\r\n        "},7:function(c,a,d,e){var b,g=a.helperMissing;d="\r\n        <div class='product-sale'>\r\n            ";if((a=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"SALE",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\r\n        </div>\r\n    "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b;d=this.escapeExpression;var g="<div class='multi-cart-item-info'>\r\n\r\n    <input id='multi-cart-item-"+d((b=(b=c&&c.model,null==b||!1===b?b:b.cid),"function"===typeof b?b.apply(c):b))+"' class='checkbox product-select' type='checkbox' ";if((b=a["if"].call(c,(b=c&&c.model,null==b||!1===b?b:b.isDisabledModel),{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)g+=b;g+="/>\r\n    <label class='product-label' for='multi-cart-item-"+d((b=(b=c&&c.model,null==b||!1===b?b:b.cid),"function"===typeof b?b.apply(c):b))+"'>\r\n    </label>\r\n\r\n    <div class='product-img'>\r\n        <img src='"+d((b=(b=(b=(b=c&&c.model,null==b||!1===b?b:b.attributes),null==b||!1===b?b:b.node),null==b||!1===b?b:b.img160x160),"function"===typeof b?b.apply(c):b))+"'>\r\n    </div>\r\n    <div class='product-info'>\r\n        <div class='product-name'>"+d((b=(b=(b=(b=c&&c.model,null==b||!1===b?b:b.attributes),null==b||!1===b?b:b.node),null==b||!1===b?b:b.name),"function"===typeof b?b.apply(c):b))+"</div>\r\n        ";if((b=a["if"].call(c,c&&c.hasDiscount,{name:"if",hash:{},fn:this.program(3,e),inverse:this.program(5,e),data:e}))||0===b)g+=b;g+="\r\n\r\n    </div>\r\n    ";if((b=a["if"].call(c,c&&c.hasDiscount,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===b)g+=b;return g+"\r\n</div>\r\n"},useData:!0})}({});E=function(h){var c=h.UiCore.UiContext;return h.UiCore.UiContext.extend("MultiCartCheckoutItem",{className:"multi-cart-checkout-item",uiContextName:"multi_cart_checkout_item",tagName:"li",dependencies:["contextMenuManager","dollarStoreManager","globalStringManager","window"],trackedEvents:function(){return[{type:"click",selector:".checkbox.product-select",name:"product_toggle",handler:"__productToggle"}]},initialize:function(a){c.prototype.initialize.call(this,a);this.model.isCheckedoutModel=!0;this.model.isDisabledModel=!1;this.model.listenTo(this.model,"cart_model_price_update",this.__updatePrice.bind(this));this.addToDOM()},render:function(){c.prototype.render.call(this);var a="",d=this.model.get("node");if(d){var e=d.category;e&&"hosting"===e?a=this.__globalStringManager.get("renews_monthly"):e&&"vip"===e&&(d=d.code_name,"vip_1_month_subscription"===d?a=this.__globalStringManager.get("renews_monthly"):"vip_3_month_subscription"===d?a=this.__globalStringManager.get("renews_quarterly"):"vip_1_year_subscription"===d&&(a=this.__globalStringManager.get("renews_yearly")))}this.$el.html(h.template({model:this.model,hasDiscount:this.model.attributes.edge.normal_price>this.model.attributes.edge.sale_price,renewalPeriodText:a}));this.$(".multi-cart-item-info").addClass(this.model.attributes.node.category);this.model.isCheckedoutModel?this.$(".product-select").attr("checked","checked"):this.$(".product-select").removeAttr("checked");this.model.get("node").disableCheckbox&&this.$(".product-label").expect(1).attr("disabled","disabled")},__productToggle:function(a){this.model.isCheckedoutModel=this.$(a.target).prop("checked");this.__dollarStoreManager.trigger("update_checkout_total_price")},__updatePrice:function(){this.render()}})}({Model:m["@Model"],UiCore:m["@UiCore"],template:E});F=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b;a=this.escapeExpression;return"\n        <li id='"+a((b=c&&c.id,"function"===typeof b?b.apply(c):b))+"'>\n        <span class='name'>\n            "+a((b=(b=c&&c.attributes,null==b||!1===b?b:b.display_name),"function"===typeof b?b.apply(c):b))+"\n        </span>\n            <img src='"+a((b=(b=c&&c.attributes,null==b||!1===b?b:b.icon_url),"function"===typeof b?b.apply(c):b))+"'>\n        </li>\n    "},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b,g=a.helperMissing;d="<ul class='other-payment-channel-list'>\n    <li id='other-payment-type'>\n    <span class='name'>";if((g=(b=a["i18n-g"]||c&&c["i18n-g"]||g,b.call(c,"OTHER PAYMENT TYPE PLURAL",{name:"i18n-g",hash:{},data:e})))||0===g)d+=g;d+="\n        <span class='down-arrow'></span>\n    </span>\n    </li>\n    ";if((g=a.each.call(c,c&&c.otherChannels,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===g)d+=g;return d+"\n</ul>\n\n"},useData:!0})}({});F=function(h){var c=h.UiCore.UiContext;return c.extend("OtherPaymentChannels",{className:"other-payment-channels",uiContextName:"other_payment_channels",dependencies:[],trackedEvents:function(){return[]},initialize:function(a){c.prototype.initialize.call(this,a);this.__otherChannels=IMVU.requireProperty(a,"otherChannels");this.addToDOM()},delete:function(){c.prototype.delete.call(this)},render:function(){this.$el.html(h.template({otherChannels:this.__otherChannels}))}})}({UiCore:m["@UiCore"],template:F});var K=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){return"\r\n"},useData:!0})}({}),Q=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(c,a,d,e){var b;d=this.escapeExpression;var g="\r\n        <div class=\"product-price\">\r\n            <span class='normal-price'>"+d((b=(b=(b=(b=c&&c.model,null==b||!1===b?b:b.attributes),null==b||!1===b?b:b.edge),null==b||!1===b?b:b.normal_price_formatted),"function"===typeof b?b.apply(c):b))+"</span>\r\n            <span class='sale-price'>"+d((b=(b=(b=(b=c&&c.model,null==b||!1===b?b:b.attributes),null==b||!1===b?b:b.edge),null==b||!1===b?b:b.sale_price_formatted),"function"===typeof b?b.apply(c):b))+"</span>\r\n            ";if((b=a["if"].call(c,c&&c.hasRenews,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===b)g+=b;return g+"\r\n    </div>\r\n    "},2:function(c,a,d,e){var b;d=this.escapeExpression;return"\r\n            <span class='renews-text'> "+d((b=a.renewsText||c&&c.renewsText,"function"===typeof b?b.call(c,{name:"renewsText",hash:{},data:e}):b))+"</div>\r\n        "},4:function(c,a,d,e){var b;d=this.escapeExpression;d="\r\n    <div class='product-price'>"+d((b=(b=(b=(b=c&&c.model,null==b||!1===b?b:b.attributes),null==b||!1===b?b:b.edge),null==b||!1===b?b:b.sale_price_formatted),"function"===typeof b?b.apply(c):b));if((b=a["if"].call(c,c&&c.hasRenews,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===b)d+=b;return d+"</div>\r\n    "},5:function(c,a,d,e){var b;d=this.escapeExpression;return"<span class='renews-text'> "+d((b=a.renewsText||c&&c.renewsText,"function"===typeof b?b.call(c,{name:"renewsText",hash:{},data:e}):b))+"</span>"},compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b,g;d=this.escapeExpression;var f=a.helperMissing,k="<div class='multi-cart-item-info'>\r\n    <div class='product-img'>\r\n        <img src='"+d((b=(b=(b=(b=c&&c.model,null==b||!1===b?b:b.attributes),null==b||!1===b?b:b.node),null==b||!1===b?b:b.img160x160),"function"===typeof b?b.apply(c):b))+"'>\r\n    </div>\r\n    <div class='product-info'>\r\n        <div class='product-name'>\r\n            "+d((b=(b=(b=(b=c&&c.model,null==b||!1===b?b:b.attributes),null==b||!1===b?b:b.node),null==b||!1===b?b:b.name),"function"===typeof b?b.apply(c):b))+"\r\n        </div>\r\n\r\n        ";if((b=a["if"].call(c,c&&c.hasDiscount,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(4,e),data:e}))||0===b)k+=b;k+="\r\n</div>\r\n<div class='product-remove'>\r\n    ";if((b=(g=a.icon||c&&c.icon||f,g.call(c,"icon-trash2",{name:"icon",hash:{},data:e})))||0===b)k+=b;return k+"\r\n</div>\r\n</div>"},useData:!0})}({});Q=function(h){var c=h.UiCore.UiContext;return h.UiCore.UiContext.extend("MultiCartItem",{className:"multi-cart-item",uiContextName:"multi_cart_item",tagName:"li",dependencies:"contextMenuManager dialogManager dollarStoreManager featureAccessManager globalStringManager Promise".split(" "),trackedEvents:function(){return[{type:"click",selector:".product-remove",name:"multi_cart_remove",handler:"__onRemoveItem"}]},initialize:function(a){c.prototype.initialize.call(this,a);this.model.listenTo(this.model,"cart_model_price_update",this.__updatePrice.bind(this));this.addToDOM()},render:function(){c.prototype.render.call(this);var a=this.model.attributes.edge.normal_price>this.model.attributes.edge.sale_price,d=this.model.get("node").category,e="hosting"===d||"vip"===d;a={model:this.model,hasDiscount:a,hasRenews:e};e&&(e=this.__globalStringManager.get("renews_monthly"),"vip"===d&&(d=this.model.get("node").code_name,"vip_3_month_subscription"===d?e=this.__globalStringManager.get("renews_quarterly"):"vip_1_year_subscription"===d&&(e=this.__globalStringManager.get("renews_yearly"))),a.renewsText=e);this.$el.html(h.template(a));this.$(".product-info").addClass(this.model.attributes.node.category)},__onRemoveItem:function(){this.collection.remove(this.model);0===this.collection.length&&this.__dollarStoreManager.trigger("empty_multi_cart");this.__dollarStoreManager.trigger("update_cart_total_price");this.model.attributes.productModel.trigger("removed_from_cart",this.collection);this.model.get("edge").rules.includes("is_vcoin")&&this.__dollarStoreManager.trigger("update_cart_vcoin_total")},__updatePrice:function(){this.render()}})}({Model:m["@Model"],UiCore:m["@UiCore"],template:Q});K=function(h){var c=h.UiCore.ListPresenter;return c.extend("MultiCartList",{className:"multi-cart-list",uiContextName:"multi_cart_list",tagName:"ul",dependencies:["dollarStoreManager","globalStringManager","modeManager"],trackedEvents:function(){return[]},initialize:function(a){this.itemFactory=a.itemFactory||h.MultiCartItem;c.prototype.initialize.call(this,a)},render:function(){c.prototype.render.call(this);this.$el.html(h.template())}})}({UiCore:m["@UiCore"],MultiCartItem:Q,template:K});w=function(h){var c=h.MultiCartAbstractDialog;return c.extend("MultiCartCheckout",{uiContextName:"multicart_checkout_dialog",className:"multicart-checkout-dialog dialog-type-B",dependencies:"cart defaultChannel dialogManager dollarStoreManager externalNextRoot featureAccessManager globalStartupModel globalStringManager loginManager modeManager nextRoot paymentChannels prefsManager Promise restModelFactory urlManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".btn-primary.checkout",name:"checkout",handler:"__checkout",attributes:this.__getAttributes.bind(this)},{type:"click",selector:"input[id=vip_checkbox]",name:"vip_checkbox",handler:"__vipCheckbox"},{type:"click",selector:".terms .link",name:"general_tos",handler:"__generalTOS"},{type:"click",selector:".payment-channel-list li",name:"select_payment",handler:"__selectPayment"},{type:"click",selector:".other-checkout-container.active .other-payment-channel-list li",name:"select_extended_payment",handler:"__selectPaymentExtended"},{type:"click",selector:".back-button",name:"back_to_primary_channels",handler:this.__backToPrimaries},{type:"click",selector:".vcoin-terms-and-conditions-link",name:"vcoin_terms_and_conditions_link",handler:"__vcoinTOS"},{type:"click",selector:"input[id=vcoin_terms_and_conditions_checkbox]",name:"vcoin_terms_and_conditions_checkbox",handler:"__vcoinTermsCheckbox"}]},initialize:function(a){c.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.restModelFactory=a.restModelFactory;var d=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=d.url;this.__coreDollarstoreProductOfferingId=d.id;this.__getProductOfferingDataFromCoreDS();this.__prefsManager=a.prefsManager;this.__featureAccessManager=a.featureAccessManager;this.__paymentChannels=IMVU.requireProperty(a,"paymentChannels");this.__origin=IMVU.optionalProperty(a,"origin",null);this.__afterAction=IMVU.optionalProperty(a,"afterAction",null);this.title=this.__globalStringManager.get("CART SUMMARY");this.__vipModel=IMVU.optionalProperty(a,"vipModel",null);this.__hostModel=IMVU.optionalProperty(a,"hostModel",null);this.__which=IMVU.optionalProperty(a,"which",null);this.__hostModel&&(this.__afterAction="close");this.__addRoomTile=a.addRoomTile;this.__hostingSelfCancel=this.__hasTieredVipInCart=this.__hasVIPInCart=!1;this.__total=0;_.each(this.__cart.models,function(e){this.__total+=e.attributes.edge.sale_price;e.attributes.edge.rules.includes("is_vcoin")&&(this.__hasVcoinInCart=!0);e.attributes.edge.rules.includes("hosting_self_cancel")&&(this.__hostingSelfCancel=!0);"vip"==e.attributes.node.category&&(this.__vipModel=e,this.__hasVIPInCart=!0,e=this.__vipModel.get("node"),this.__hasTieredVipInCart=["vip_web_tier_1","vip_web_tier_2","vip_web_tier_3"].includes(e.code_name))}.bind(this));this.__cartTotalInVcoin=(250*this.__total).toFixed(2);this.__total="$"+parseFloat(this.__total).toFixed(2);this.listenTo(this.__dollarStoreManager,"update_checkout_total_price",this.__updateCheckoutTotal);d=[];this.__defaultChannel&&d.push(this.__defaultChannel.populated());d.push(this.__paymentChannels.populated());this.__Promise.every(d).then(function(){this.addToDOM()}.bind(this));this.__autoLaunchReview=IMVU.optionalProperty(a,"autoLaunchReview",!1)},postRender:function(){var a=this;this.__saved_card=null;this.$(".dialog-header").prepend('<div class="back-button hidden"></div>');this.__vantiv_ch=this.__getVantivChannel();var d=this.__globalStartupModel.get("savedCreditCardUrl"),e=this.track(this.__restModelFactory.readCollection(d,h.UiCore.NodeCollection));e.invalidate();e.populated().then(function(){a.__hasVIPInCart&&4===a.__myself.get("vip_platform")&&a.__dialogManager.confirm({title:a.__globalStringManager.get("vip_upsell_previous_subscription_title"),text:a.__globalStringManager.get("vip_upsell_previous_subscription_body"),no:a.__globalStringManager.get("CANCEL"),yes:a.__globalStringManager.get("OKAY")}).finished.catch(function(){a.close()})}).then(function(){if(a.__hasVIPInCart&&[2,3].includes(a.__myself.get("vip_platform"))){var b=[a.__globalStringManager.get("vip_upsell_company_1"),a.__globalStringManager.get("vip_upsell_company_2")][a.__myself.get("vip_platform")],g=[a.__globalStringManager.get("vip_upsell_platform_1"),a.__globalStringManager.get("vip_upsell_platform_2")][a.__myself.get("vip_platform")];b=a.__globalStringManager.get("vip_upsell_previous_subscription_mobile_body",{company:b?b:a.__globalStringManager.get("vip_upsell_company_3"),platform:g?g:a.__globalStringManager.get("vip_upsell_platform_3")});a.__dialogManager.alert({title:a.__globalStringManager.get("vip_upsell_previous_subscription_title"),text:b,ok:a.__globalStringManager.get("OKAY")}).finished.then(function(){a.__dialogManager.closeAll()}).catch(function(){a.__dialogManager.closeAll()})}}).then(function(){a.__hasVIPInCart&&a.__myself.get("is_host")&&(a.__hostingSelfCancel?a.__dialogManager.alert({title:a.__globalStringManager.get("vip_upsell_previous_host_subscription_title"),text:a.__globalStringManager.get("vip_upsell_previous_host_subscription_mobile_body"),ok:a.__globalStringManager.get("OKAY")}):a.__dialogManager.confirm({title:a.__globalStringManager.get("vip_upsell_previous_host_subscription_title"),html:a.__globalStringManager.get("vip_upsell_previous_host_subscription_desktop_body"),yes:a.__globalStringManager.get("OKAY"),no:a.__globalStringManager.get("CANCEL")}).finished.catch(function(){a.close()}))}).then(function(){var b=_.filter(e.models,function(k){return!0===k.attributes.is_primary&&"co"===k.attributes.system}.bind(this));_.isEmpty(b)&&(b=_.filter(e.models,function(k){return"co"===k.attributes.system}.bind(this)));!_.isEmpty(b)&&this.__vantiv_ch&&(this.__saved_card=b[0]);if(this.__saved_card){this.__saved_card.attributes.saved_card=!0;this.__saved_card.attributes.channel_key="saved_card";this.__saved_card.attributes.payment_method="vantiv";this.__saved_card.attributes["metadata.credit_card"]=1;b={id:"different_card",attributes:{display_name:this.__globalStringManager.get("USE DIFFERENT CARD"),icon_url:"/common/withme/img/store/payment/payment-creditcard.png",channel_key:"different_card",payment_method:"vantiv"},populated:function(){return new this.__Promise(function(k){k.accept(!0)}.bind(this))}.bind(this)};b.attributes["metadata.credit_card"]=1;var g=_.filter(this.__paymentChannels.models,function(k){return"saved_card"===k.attributes.channel_key});_.isEmpty(g)?(this.__paymentChannels.models.splice(0,0,b),this.__paymentChannels.models.splice(0,0,this.__saved_card)):this.__paymentChannels.models.splice(0,1,this.__saved_card)}b={total:this.__total,vcoinInCart:this.__hasVcoinInCart,tieredVIPInCart:this.__hasTieredVipInCart,helpCenterURL:this.__urlManager.get("imvu_help_privacy_policy"),subscriptionURL:this.__urlManager.get("manage_subscription"),vipTermsURL:this.__urlManager.get("policy_hub_vip")};this.setContent("body",h.template,b);var f=!1;_.each(this.__cart.models,function(k){0===k.get("edge").normal_price&&"credits"===k.get("node").code_name&&1===k.get("node").credits&&(f=!0)}.bind(this));_.each(this.__cart.models,function(k){k.attributes.node.disableCheckbox=f}.bind(this));this.__cartList=this.createChildContext(h.MultiCartList,{$replaceElement:this.$(".multi-cart-list-placehoder"),itemFactory:h.MultiCartCheckoutItem,collection:this.__cart});this.__updateAvailablePaymentMethods();this.setContent("footer",this.$(".dialog-footer-template").text());this.__vipModel&&(this.__vipWidget=this.createChildContext(h.MultiCartVipStatus,{$parentElement:this.$(".vip-status-widget"),model:this.__vipModel}),this.$(".agreement .vip-panel").removeClass("hidden"),this.$(".btn-primary.checkout").addClass("disabled"),this.createChildContext(h.Tooltip,{$replaceElement:this.$(".vip-toc-tooltip"),$tooltipTarget:this.$(".vip-toc-link"),tooltipPosition:"bottom"}));this.__hasVcoinInCart&&this.__availablePaymentChannels.length&&(b=1===this.__prefsManager.getInt("next.user_accepted_vcoin_tc"),this.$(".btn-primary.checkout").prop("disabled",!b),b&&this.$(".vcoin-checkbox").attr("checked","checked"));this.__selectPayment({target:{id:this.__availablePaymentChannels[0].id}});this.__autoLaunchReview&&this.__validateChannelPayoutPromise.then(function(){this.__checkout()}.bind(this))}.bind(this))},__destroy:function(){this.hide();this.delete()},__getAttributes:function(){return{which:this.__which}},__updateAvailablePaymentMethods:function(){var a=this;this.__availablePaymentChannels=this.__paymentChannels.models;var d=!1;_.each(this.__cart.models,function(e){e.attributes.edge.rules.includes("credit_card_only")&&e.isCheckedoutModel&&(d=!0)});d?(this.__creditCardPayemntChannels=_.filter(this.__availablePaymentChannels,function(e){if(1===e.attributes["metadata.credit_card"])return e}),this.__creditCardPayemntChannels.length?(this.$(".notice-credit-card-only-message").removeClass("hidden"),this.__availablePaymentChannels=this.__creditCardPayemntChannels):(this.$(".notice-credit-card-only-message").addClass("hidden"),this.$(".items-unavailable-for-purchase").addClass("error-visible"),_.each(this.__cartList.collection.models,function(e){e.attributes.edge.rules.includes("credit_card_only")&&(e.isCheckedoutModel=!1,e.isDisabledModel=!0,a.$(".multi-cart-item-info input[id=multi-cart-item-"+e.cid+"].checkbox").prop({checked:!1,disabled:!0}));e.isCheckedoutModel&&(a.__total+=e.attributes.edge.sale_price)}))):this.$(".notice-credit-card-only-message").addClass("hidden");this.__hasVcoinInCart&&(this.__vcoinPayemntChannels=_.filter(this.__availablePaymentChannels,function(e){if(1===e.attributes["metadata.sells_vcoin"])return e}),this.__vcoinPayemntChannels.length?(this.__availablePaymentChannels=this.__vcoinPayemntChannels,this.$(".notice-credit-card-only-message").removeClass("hidden")):(this.$(".notice-credit-card-only-message").addClass("hidden"),this.$(".items-unavailable-for-purchase").addClass("error-visible"),_.each(this.__cartList.collection.models,function(e){e.attributes.edge.rules.includes("is_vcoin")&&(e.isCheckedoutModel=!1,e.isDisabledModel=!0,a.$(".multi-cart-item-info input[id=multi-cart-item-"+e.cid+"].checkbox").prop({checked:!1,disabled:!0}));e.isCheckedoutModel&&(a.__total+=e.attributes.edge.sale_price)})));this.__checkForPaymentsOverride().then(function(e){a.$(".payment-channels-wrapper").empty();a.$(".other-checkout-container").empty();a.__paymentChannelsList=a.createChildContext(h.PaymentChannels,{$parentElement:a.$(".payment-channels-wrapper"),channels:e.slice(0,3),otherchannels:e.slice(3),hasOtherChannels:0<e.slice(3).length});0<e.slice(3).length&&(a.__otherPaymentChannelsList=a.createChildContext(h.OtherPaymentChannels,{$parentElement:a.$(".other-checkout-container"),otherChannels:e.slice(3)}));a.$('.payment-channel-list li[id="'+e[0].id+'"]').addClass("is-selected");a._currentPaymentChannels=e})},__updateCheckoutTotal:function(){var a=this;this.__total=0;this.__hostModel=this.__vipModel=null;this.__hasAtLeastOneSubscription=this.__hasVcoinInCart=!1;_.each(this.__cartList.collection.models,function(d){d.isCheckedoutModel&&("vip"===d.attributes.node.category?this.__vipModel=d:"hosting"===d.attributes.node.category&&(this.__hostModel=d),!0===d.attributes.edge.rules.includes("is_subscription")&&1<this.__cartList.collection.models.length&&!1===this.__hasAtLeastOneSubscription&&(this.__hasAtLeastOneSubscription=!0),d.attributes.edge.rules.includes("is_vcoin")&&(this.__hasVcoinInCart=!0))}.bind(this));this.__total=0;this.$("notice-credit-card-only-message").addClass("hidden");this.$(".notice-subscription-message").addClass("hidden");this.__hasVcoinInCart&&this.$(".notice-credit-card-only-message").removeClass("hidden");this.__hasVcoinInCart?_.each(this.__cartList.collection.models,function(d){d.isDisabledModel=!1;a.$(".multi-cart-item-info input[id=multi-cart-item-"+d.cid+"].checkbox").prop({disabled:!1});d.isCheckedoutModel&&(a.__total+=d.attributes.edge.sale_price)}):!1===this.__hasAtLeastOneSubscription?(_.each(this.__cartList.collection.models,function(d){!0!==d.attributes.edge.rules.includes("is_subscription")&&(!d.attributes.edge.rules.includes("is_vcoin")||d.attributes.edge.rules.includes("is_vcoin")&&1<=a.__vcoinPayemntChannels.length)&&(!d.attributes.edge.rules.includes("credit_card_only")||d.attributes.edge.rules.includes("credit_card_only")&&1<=a.__creditCardPayemntChannels.length)&&(d.isDisabledModel=!1,a.$(".multi-cart-item-info input[id=multi-cart-item-"+d.cid+"].checkbox").prop({disabled:!1}));d.isCheckedoutModel&&(a.__total+=d.attributes.edge.sale_price)}),this.$(".notice-subscription-message").addClass("hidden")):(this.__hasAtLeastOneSubscription=!1,_.each(this.__cart.models,function(d){!0===d.attributes.edge.rules.includes("is_subscription")&&!1===a.__hasAtLeastOneSubscription?(a.__hasAtLeastOneSubscription=!0,a.$(".notice-subscription-message").removeClass("hidden")):d.attributes.edge.rules.includes("is_vcoin")?d.isCheckedoutModel=!1:(d.isCheckedoutModel=!1,d.isDisabledModel=!0,a.$(".multi-cart-item-info input[id=multi-cart-item-"+d.cid+"].checkbox").prop({checked:!1,disabled:!0}));d.isCheckedoutModel&&(a.__total+=d.attributes.edge.sale_price)}));this.__updateAvailablePaymentMethods();0===this.__total?this.$(".btn.btn-primary.checkout").addClass("disabled"):this.$(".btn.btn-primary.checkout").removeClass("disabled");this.__vipWidget&&this.__vipWidget.delete();this.__vipModel?(this.__vipWidget=this.createChildContext(h.MultiCartVipStatus,{$parentElement:this.$(".vip-status-widget"),model:this.__vipModel}),this.$(".agreement .vip-panel").removeClass("hidden"),this.$("input[id=vip_checkbox]").prop("checked")?this.$(".btn-primary.checkout").removeClass("disabled"):this.$(".btn-primary.checkout").addClass("disabled")):this.$(".agreement .vip-panel").addClass("hidden");this.__cartTotalInVcoin=(250*this.__total).toFixed(2);this.__total="$"+parseFloat(this.__total).toFixed(2);this.$(".checkout-bottom-container .price-summary .price").text(this.__total)},__selectPayment:function(a){var d=a.target.id;"other-payment-type"===d?this.__vipModel&&!this.$("input[id=vip_checkbox]").prop("checked")?this.$(".vip-checkbox-missing").addClass("error-visible"):this.__hasVcoinInCart&&!this.$("input[id=vcoin_terms_and_conditions_checkbox]").prop("checked")?this.$(".vcoin-checkbox-missing").addClass("error-visible"):this.__showExtendedPaymentOptions():this.__validateChannelPayoutPromise=this.__validateChannelPayout(this.__getChannel(d),this.__defaultChannel,this.__vantiv_ch).then(function(){this.$(".other-payment-channel-list li").removeClass("is-selected");this.__updateCheckoutTotal();this.$(".payment-channel-list li").removeClass("is-selected");this.$('.payment-channel-list li[id="'+d+'"]').addClass("is-selected")}.bind(this))},__showExtendedPaymentOptions:function(){this.$(".vip-checkbox-missing").removeClass("error-visible");this.$(".vcoin-checkbox-missing").removeClass("error-visible");this.$(".checkout-container").addClass("hidden");this.$(".other-checkout-container").addClass("active");this.$(".dialog-header .back-button").removeClass("hidden")},__showPrimaryPaymentOptions:function(){this.$(".checkout-container").removeClass("hidden");this.$(".other-checkout-container").removeClass("active");this.$(".dialog-header .back-button").addClass("hidden")},__selectPaymentExtended:function(a){var d=a.target.id;"other-payment-type"===d?this.__showPrimaryPaymentOptions():this.__validateChannelPayout(this.__getChannel(d),this.__defaultChannel,this.__vantiv_ch).then(function(){this.__updateCheckoutTotal();this.$(".payment-channel-list li").removeClass("is-selected");this.$(".other-payment-channel-list li").removeClass("is-selected");this.$('.other-payment-channel-list li[id="'+d+'"]').addClass("is-selected")}.bind(this))},__backToPrimaries:function(){this.__showPrimaryPaymentOptions()},__generalTOS:function(){var a=this.__urlManager.get("policy_hub_terms");this.__featureAccessManager.isElectronClient()?(this.__electron=this.__window.electronRequire("electron"),this.__electron.shell.openExternal(a)):this.__window.open(a,"_blank")},__vcoinTOS:function(a){this.__generalTOS();a.stopImmediatePropagation()},__vipCheckbox:function(){this.$("input[id=vip_checkbox]").prop("checked")?(this.$(".vip-checkbox-missing").removeClass("error-visible"),this.$(".btn-primary.checkout").removeClass("disabled")):this.$(".btn-primary.checkout").addClass("disabled")},__vcoinTermsCheckbox:function(){this.$("input[id=vcoin_terms_and_conditions_checkbox]").prop("checked")?(this.__prefsManager.setInt("next.user_accepted_vcoin_tc",1),this.$(".vcoin-checkbox-missing").removeClass("error-visible"),this.$(".btn-primary.checkout").prop("disabled",!1)):(this.__prefsManager.setInt("next.user_accepted_vcoin_tc",0),this.$(".btn-primary.checkout").prop("disabled",!0))},__getVantivChannel:function(){return _.find(this.__paymentChannels.models,function(a){if("vantiv"===a.attributes.channel_key)return a})},__getChannel:function(a){return _.find(this.__paymentChannels.models,function(d){if(a===d.id)return d})},__checkout:function(){var a=".checkout-container";this.$(".vip-checkbox-missing").removeClass("error-visible");this.$(".vcoin-checkbox-missing").removeClass("error-visible");this.$(".checkout-container").hasClass("hidden")&&(a=".other-checkout-container");var d=this.$(a+" li.is-selected").prop("id");d||(".other-checkout-container"===a?d=this.$(".checkout-container li.is-selected").prop("id"):".checkout-container"===a&&(d=this.$(".other-checkout-container li.is-selected").prop("id")));d=this.__getChannel(d);var e=this.__dollarStoreManager.validateMultiCartCheckoutRules(d,this.__cart);if(_.isEmpty(e))this.__checkoutValidCart(d);else{var b=_.filter(e,function(g){return"credit_card_only"===g.type});_.isEmpty(b)||this.__dialogManager.showDialog(h.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("CART CONTENTS WILL CHANGE"),text:this.__globalStringManager.get("CART CONTENTS WILL CHANGE DESC"),yes:this.__globalStringManager.get("OK"),no:this.__globalStringManager.get("CANCEL")}).finished.then(function(){_.each(b,function(g){var f="multi-cart-item-"+g.target.cid;this.$("input[id="+f+"]").prop("checked",!1);g.target.isCheckedoutModel=!1;this.__dollarStoreManager.trigger("update_checkout_total_price");this.$('label[for="'+f+'"]').addClass("removed")}.bind(this));".other-checkout-container"===a&&this.__showPrimaryPaymentOptions()}.bind(this)).catch(function(){}.bind(this))}},__checkoutValidCart:function(a){"vantiv"===a.attributes.payment_method?"vantiv"===a.attributes.channel_key?this.__checkoutVantivNewCard(a):"saved_card"===a.attributes.channel_key?this.__checkoutVantivSavedCard(a):"different_card"===a.attributes.channel_key&&this.__checkoutVantivManageCards(a):"paypal"===a.attributes.payment_method?this.__checkoutPaypal(a):"paymentwall"===a.attributes.payment_method?this.__checkoutPaymentWall(a):"test"===a.attributes.payment_method?this.__checkoutTestChannel(a,this.__cart):"vcoin"===a.attributes.payment_method&&(this.__wallet=this.track(this.__myself.getSingleEdge("wallet")),this.__dollarStoreManager.storeCheckoutWithVcoin({cartCollection:this.__cart,cartTotalInVcoin:this.__cartTotalInVcoin,paymentChannels:this.__paymentChannels,source:"multicart_checkout",wallet:this.__wallet}))},__validateChannelPayout:function(a,d,e){return new this.__Promise(function(b){var g=!1,f=a.attributes.payout,k=d.attributes.payout,l=this.__dollarStoreManager.getDefaultCategories();f||(f=e.attributes.payout,g=!0);k||(k=e.attributes.payout);f<k&&70>f?this.__dialogManager.showDialog(h.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("PRICE ADJUSTMENT TITLE"),text:this.__globalStringManager.get("PRICE ADJUSTMENT DESC"),yes:this.__globalStringManager.get("OK"),no:this.__globalStringManager.get("CANCEL")}).finished.then(function(){this.__window.$("body").addClass("waiting");this.__dollarStoreManager.getProductsOffered(l,a).then(function(n){this.__updateCartModels(this.__cart.models,n.models);this.__window.$("body").removeClass("waiting");return b.accept()}.bind(this))}.bind(this)).catch(function(){return b.reject()}.bind(this)):f>k&&70>k?this.__dialogManager.showDialog(h.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("PRICE ADJUSTMENT TITLE"),text:this.__globalStringManager.get("PRICE ADJUSTMENT LOWER DESC"),yes:this.__globalStringManager.get("OK"),no:this.__globalStringManager.get("CANCEL")}).finished.then(function(){this.__window.$("body").addClass("waiting");g&&(a=e);this.__dollarStoreManager.getProductsOffered(l,a).then(function(n){this.__updateCartModels(this.__cart.models,n.models);this.__window.$("body").removeClass("waiting");return b.accept()}.bind(this))}.bind(this)).catch(function(){return b.reject()}.bind(this)):(this.__window.$("body").addClass("waiting"),g&&(a=e),this.__dollarStoreManager.getProductsOffered(l,a).then(function(n){this.__updateCartModels(this.__cart.models,n.models);this.__window.$("body").removeClass("waiting");return b.accept()}.bind(this)))}.bind(this))},__updateCartModels:function(a,d){_.each(a,function(e){_.each(d,function(b){var g=this.__coreDollarstoreProductOfferingId?this.__coreDollarstoreProductOfferingId:b.edge.attributes.product_offering_id,f=b.edge.attributes.sale_price,k=b.edge.attributes.sale_price_formatted;this.__oldDollarstoreProductOfferingUrl&&(e.attributes.edge.normal_price<b.edge.attributes.normal_price||e.attributes.edge.normal_price<e.attributes.edge.sale_price)&&(f=e.attributes.edge.normal_price,k=e.attributes.edge.normal_price_formatted);e.attributes.node.id===b.node.id&&(e.productModel=b,e.attributes.edge.normal_price=b.edge.attributes.normal_price,e.attributes.edge.normal_price_formatted=b.edge.attributes.normal_price_formatted,e.attributes.edge.product_offering_id=g,e.attributes.edge.sale_price=f,e.attributes.edge.sale_price_formatted=k,e.trigger("cart_model_price_update"))}.bind(this))}.bind(this))},__getReloadURL:function(){for(var a=this.__window.location.href,d=this.__serviceProvider.get("acceptedDollarStorePermaLinkProducts"),e=0;e<d.length;e++)if(a.endsWith("/store/"+d[e]+"/")){a=this.__window.location.origin+"/next/store/";break}return a},__handleAfterAction:function(a){"close"===this.__afterAction?this.close():"closeAll"===this.__afterAction?this.__dialogManager.closeAll():"reload"===this.__afterAction?this.__window.location=this.__getReloadURL():"closeToEditRoomSettings"===this.__afterAction?this.__dialogManager.closeTo("edit-room-settings"):"restWebGiftingDialog"===this.__afterAction?this.__dialogManager.closeTo("rest-web-gifting-dialog"):"upsellShell"===this.__afterAction?this.__modeManager.openMode({mode:{id:"shop"},submode:{id:"rooms"}}):"selectPrivateRoom"===this.__afterAction?this.__addRoomTile&&this.__addRoomTile.callOpenSelectRoomDialog({isPublicOverride:!0}):"clear_cart"===a?this.__window.location.reload():this.close()},__checkoutVantivNewCard:function(a){this.__dialogManager.showDialog(h.MultiCartAddCreditCard,{cart:this.__cart,channel:a,orderTotal:this.__total,origin:this.__origin}).finished.then(function(d){this.promiseResolver.resolve();this.__handleAfterAction(d)}.bind(this)).catch(function(d){"closing_all"===d&&this.close()}.bind(this))},__checkoutVantivSavedCard:function(a){this.__dialogManager.showDialog(h.MultiCartReview,{billingInfo:{card_type:this.__saved_card.attributes.card_type,name:this.__saved_card.attributes.name,last_four_digits:this.__saved_card.attributes.card_last_digits,card_id:this.__saved_card.id,saved_card:!0},channel:this.__vantiv_ch,cart:this.__cart,origin:this.__origin}).finished.then(function(d){this.promiseResolver.resolve();this.__handleAfterAction(d)}.bind(this)).catch(function(d){"closing_all"===d&&(this.promiseResolver.resolve(d),this.close())}.bind(this))},__checkoutVantivManageCards:function(a){this.__dialogManager.showDialog(h.MultiCartSavedCards,{billingInfo:{card_type:this.__saved_card.attributes.card_type,name:this.__saved_card.attributes.name,last_four_digits:this.__saved_card.attributes.card_last_digits,card_id:this.__saved_card.id,saved_card:!0},channel:this.__vantiv_ch,cart:this.__cart,origin:this.__origin}).finished.then(function(d){this.promiseResolver.resolve();this.__handleAfterAction(d)}.bind(this)).catch(function(d){"closing_all"===d&&this.close()}.bind(this))},__checkoutPaypal:function(a){this.__paypalCheckout(a,this.__cart).then(function(d){"finished_order_success"===d?this.promiseResolver.resolve("clear_cart"):this.promiseResolver.reject("clear_cart")}.bind(this)).catch(function(d){this.close()}.bind(this))},__checkoutPaymentWall:function(a){this.__paymentWallCheckout(a,this.__cart).then(function(d){this.close()}.bind(this))},__checkoutTestChannel:function(a,d){a=this.__buildOrderSelection(d.models);a={total:this.__calculateTotal(d.models),product_offering_id:d.models[0].attributes.edge.product_offering_id,selected:a};var e=this.__globalStartupModel.get("cashOrderTrans");this.__restModelFactory.createModel(e,h.UiCore.NodeModel,a).then(function(b){this.__dialogManager.showDialog(h.MultiCartSuccess,{cart:d.models,orderResponse:b,channel:"test",origin:this.__origin}).finished.then(function(g){this.promiseResolver.resolve("clear_cart")}.bind(this))}.bind(this)).catch(function(b){this.promiseResolver.reject()}.bind(this))},__checkForPaymentsOverride:function(){var a=this;return new this.__Promise(function(d){d.resolve(_.reject(a.__availablePaymentChannels,function(e,b){var g=e.attributes.override_with;return void 0!==g&&_.find(a.__availablePaymentChannels,function(f){return f.attributes.channel_key===g})?!0:!1}))})}})}({Dialogs:m["@Dialogs"],Model:m["@Model"],UiCore:m["@UiCore"],MultiCartAbstractDialog:y,MultiCartAddCreditCard:w,MultiCartCheckoutItem:E,MultiCartList:K,MultiCartReview:u,MultiCartSavedCards:J,MultiCartSuccess:p,MultiCartVipStatus:z,OtherPaymentChannels:F,PaymentChannels:t,Tooltip:v,template:C});P=function(h){var c=h.Dialogs.AlloyModalDialog;return c.extend("MultiCartUpsellDialog",{className:"multicart-upsell-dialog dialog-type-B",uiContextName:"multicart_upsell_dialog",dependencies:"dialogManager featureAccessManager globalStartupModel globalStringManager loginManager urlManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".checkout-cta:not(.disabled)",name:"add_to_cart",handler:"__handleCheckout"},{type:"click",selector:".greeter-cta",name:"greeter_cta",handler:"__handleGreeterCTA"},{type:"click",selector:".learn",name:"learn_more",handler:this.__handleLearnMore}]},initialize:function(a){c.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.__singleItemCart=new h.CartCollection([]);if(this.__isLoggedIn=this.__loginManager.isLoggedIn())this.__dollarStoreManager=this.__serviceProvider.get("dollarStoreManager"),this.__myself=this.__loginManager.getCurrentUser();this.__upsellProduct=IMVU.requireProperty(a,"upsellProduct","credits");this.__isCreatorLanding=IMVU.optionalProperty(a,"isCreatorLanding",!1);this.__customSubtitle=IMVU.optionalProperty(a,"customSubtitle",!1);this.__customDlg_name=IMVU.optionalProperty(a,"customDlg_name",!1);this.__customDescription=IMVU.optionalProperty(a,"customDescription",!1);this.upsellAfterGift=IMVU.optionalProperty(a,"upsellAfterGift",!1);this.__customProductAdUrl=IMVU.optionalProperty(a,"customProductAdUrl",!1);this.__giftRecipient=IMVU.optionalProperty(a,"giftRecipient",!1);this.__isContextual=IMVU.optionalProperty(a,"contextual",!1);this.__afterAction=IMVU.optionalProperty(a,"afterAction",null);this.__vipForWhisper=IMVU.optionalProperty(a,"vipForWhisper",!1);this.__vipTrigger=IMVU.optionalProperty(a,"vipTrigger",null);this.__vipTriggerLocation=IMVU.optionalProperty(a,"vipTriggerLocation",null);this.__model=null;this.__simulated=!1;this.__packageMap=this.__getPackageMap();this.__categories=this.__getCategories().categories;this.__storeType=this.__getCategories().storeType;this.__disabledProducts=IMVU.optionalProperty(a,"disabledProducts",[]);this.__selectedProduct=IMVU.optionalProperty(a,"selectedProduct",!1);this.__isTieredVIP="vip"===this.__upsellProduct;this.addToDOM()},postRender:function(){var a=this;this.$el.addClass("product-"+this.__upsellProduct);if(this.__isLoggedIn&&"greeter"!==this.__upsellProduct)this.__dollarStoreManager.getPaymentChannels(this.__categories,this.__storeType).then(function(e){a.__paymentChannels=e;if(e.at(0)&&"vantiv"===e.at(0).attributes.payment_method){var b=_.find(e.models,function(g){if("vantiv"===g.attributes.channel_key)return g});a.__defaultPaymentChannel=b?b:e.at(0)}else a.__defaultPaymentChannel=e.at(0)}).then(function(){"vcoin"===a.__upsellProduct&&a.listenTo(a,"vcoin_product_selected_in_blocked_region",function(){this.__showVcoinUnavailableOnCheckout=!0});if(void 0===a.__defaultPaymentChannel&&"vcoin"==a.__upsellProduct){var e='<a href="'+a.__urlManager.get("unavailable_vcoin")+'" target="_blank">'+a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_link")+"</a>";e="<p>"+a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_part1")+" "+e+". "+a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_part2")+"</p>";a.__dialogManager.alert({title:a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_title"),html:e,ok:a.__globalStringManager.get("OKAY"),dark_text:!0}).finished.then(function(){a.hide()})}else a.__dollarStoreManager.getProductsOffered(a.__categories,a.__defaultPaymentChannel,void 0,!0).then(function(b){var g=!1;a.__upsellProductModel=null;a.__upsellProductCollection=b;for(var f=b.models,k=f.length,l,n=0;n<k;n++)if(l=f[n],"access_pass"===l.node.get("code_name")&&"ap"===a.__upsellProduct||"marriage_license"===l.node.get("code_name")&&"marriage_package"===a.__upsellProduct||"age_verification"===l.node.get("code_name")&&"age_verification"===a.__upsellProduct||"shared_room"===l.node.get("code_name")&&"shared_room"===a.__upsellProduct||"name_change_tokens"===l.node.get("code_name")&&"name_change"===a.__upsellProduct||"name_change_and_registration"===l.node.get("code_name")&&"name_change"===a.__upsellProduct||"chat_room_slot"===l.node.get("code_name")&&"room_slot"===a.__upsellProduct){a.__upsellProductModel=l;break}a.__upsellProductModel?g=!0:("host_subscription"===a.__upsellProduct||"credits"===a.__upsellProduct||"vcoin"===a.__upsellProduct)&&0<f.length?(a.__upsellProductModel=b.models[0],g=!0):"vip"===a.__upsellProduct&&0<f.length?(a.__upsellProductModel=b.models[0],g=!0):"vip"===a.__upsellProduct&&0===f.length&&(g=!1);a.__model=a.__upsellProductModel;a.__model&&g?a.__getPackageMapOverrides():a.__getSimulatedModel()}).catch(function(b){}).then(function(){a.title=a.__model.node.attributes.name;a.__getPackageMapOverrides();a.__isTieredVIP&&(a.__isCreatorLanding?(a.title=a.__globalStringManager.get("vip_upsell_creator_landing_title"),a.__subtitle=a.__globalStringManager.get("vip_upsell_creator_landing_subtitle")):(a.title=a.__globalStringManager.get("vip_upsell_title"),a.__subtitle=a.__globalStringManager.get("vip_upsell_subtitle")));a.__renderTitle();a.upsellAfterGift&&a.__adjustDialogSize();a.setContent("body",h.template,{product_ad_url:a.__customProductAdUrl?a.__customProductAdUrl:a.__model.node.attributes.dlg_background_url,subtitle:a.__subtitle,loggedIn:a.__isLoggedIn,greeter:"greeter"===a.__upsellProduct,sale_price:a.__model.edge.attributes.sale_price_formatted,upsellAfterGift:a.upsellAfterGift,giftRecipient:a.__giftRecipient,simulated:a.__simulated});if("vip"===a.__upsellProduct&&a.__vipTrigger&&a.__vipTriggerLocation){var b={vipTriggerLocation:a.__vipTriggerLocation,vipTrigger:a.__vipTrigger,clientIp:a.__globalStartupModel.get("clientIPAddress")};a.recordShowTieredVipUpsell(b)}a.$(".description").html(a.__isTieredVIP?h.multiProductUpsellVipTiers({vip_web_tier_1:1,vip_web_tier_2:1,vip_web_tier_3:1,isCreatorLanding:a.__isCreatorLanding,canSeeYouTube:a.__featureAccessManager.canSeeYouTubePreRecorded()}):a.__description);a.setContent("footer",a.$(".dialog-footer-template").text());a.__isLoggedIn&&("credits"===a.__upsellProduct||"host_subscription"===a.__upsellProduct||"vip"===a.__upsellProduct)||"vcoin"===a.__upsellProduct?(a.__disableCheckoutButton(),a.upsellAfterGift&&a.__enableCheckoutButton(),b=a.$(".product-selectors").expect(1),b.addClass("go-link"),b.html(""),a.__simulated?a.__enableSimulatedCheckoutButton():a.productsList=a.createChildContext(h.MultiProductList,{$parentElement:b,collection:a.__upsellProductCollection,cartCollection:a.__singleItemCart,category:a.__upsellProduct,upsellDialog:a,isUpsell:!0,disabledProducts:a.__disabledProducts,selectedProduct:a.__selectedProduct})):a.__simulated?a.__enableSimulatedCheckoutButton():a.__enableCheckoutButton();a.$el.is(".dialog-type-B, .dialog-type-B-flexible")&&a.$el.closest("body").is(".mobile")&&a.__adjustTitlePosition();a.$(".dialog-body-scroller").scrollbar()}).catch(function(b){a.__window.console.error("HostSubUpsellDialog::render - Failed to render BuyUpgradeHostSubList",b)})}).catch(function(){a.__window.console.error("HostSubUpsellDialog::render - Failed to get payment channels")});else{var d="vcoin"===this.__upsellProduct;this.__getSimulatedModel();this.setContent("body",h.template,{product_ad_url:this.__customProductAdUrl?this.__customProductAdUrl:this.__model.node.attributes.dlg_background_url,subtitle:this.__subtitle,loggedIn:this.__isLoggedIn,greeter:"greeter"===this.__upsellProduct,sale_price:this.__model.edge.attributes.sale_price_formatted,simulated:!0,vcoinUpsell:d,upsellAfterGift:this.upsellAfterGift,giftRecipient:this.__giftRecipient});d&&this.$(".dialog-body").addClass("vcoin-logged-out");"vip"===this.__upsellProduct&&(!1===this.__selectedProduct&&(this.__selectedProduct=1),d={},this.__description=h.multiProductUpsellVipTiers((d["vip_web_tier_"+(1+this.__selectedProduct)]=1,d.canSeeYouTube=this.__featureAccessManager.canSeeYouTubePreRecorded(),d)));this.$(".description").html(this.__description);this.setContent("footer",this.$(".dialog-footer-template").text());this.__enableSimulatedCheckoutButton();this.$(".dialog-body-scroller").scrollbar()}},__directToLogin:function(){this.__loginManager.setLoginDestination(this.__nextRoot+"store/"+this.__upsellProduct);this.__window.location="/welcome/login/";this.forwardedToLogin=!0},aProductClicked:function(a){this.__model=a;null===a?this.__disableCheckoutButton():(this.__enableCheckoutButton(),this.upsellAfterGift&&this.__addToCart(!0))},switchDescription:function(a){this.$("."+a+"-description").show().siblings().hide()},__getErrorString:function(){var a="",d=!1===this.__myself.get("is_adult");switch(this.__upsellProduct){case"ap":a=d?this.__globalStringManager.get("oops_minor_ap"):this.__globalStringManager.get("oops_already_have_ap");break;case"marriage_package":a=d?this.__globalStringManager.get("oops_minor_marriage_package"):this.__globalStringManager.get("oops_already_have_this_upgrade");break;case"age_verification":a=d?this.__globalStringManager.get("oops_minor_age_verification"):this.__globalStringManager.get("oops_already_have_this_upgrade");break;case"vip":a=this.__globalStringManager.get("oops_already_have_vip");break;default:this.__window.console.error("MultiCartUpsellDialog::__getErrorString - __upsellProduct not accepted",this.__upsellProduct)}return a},__handleCheckout:function(){this.__isLoggedIn&&"vcoin"===this.__upsellProduct&&this.__showVcoinUnavailableOnCheckout?this.__showVcoinUnavailableDialog():this.__addToCart()},__showVcoinUnavailableDialog:function(){var a=this,d='<a href="'+this.__urlManager.get("unavailable_vcoin")+'" target="_blank">'+this.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_link")+"</a>";d="<p>"+this.__globalStringManager.get("vcoin_unavailable_error_text")+" "+d+"</p>";this.__dialogManager.showDialog(h.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("vcoin_unavailable_error_title"),text:this.__globalStringManager.get("vcoin_unavailable_error_text"),html:d,yes:this.__globalStringManager.get("Continue"),no:this.__globalStringManager.get("CANCEL"),dark_text:!0}).finished.then(function(){a.__addToCart()}).catch(function(e){})},__determineAfterAction:function(){var a=this.__afterAction;if(null===a)switch(this.__upsellProduct){case"ap":case"marriage_package":case"age_verification":case"vip":a=this.__isContextual?this.__vipForWhisper?"close":"closeAll":"reload";break;default:a="closeAll"}return a},__addToCart:function(a){var d=this;if(this.__isLoggedIn)if(!this.__simulated||"ap"!==this.__upsellProduct&&"marriage_package"!==this.__upsellProduct&&"age_verification"!==this.__upsellProduct&&"vip"!==this.__upsellProduct)if(this.__upsellProduct){this.$(".checkout-cta").addClass("disabled");var e=new IMVU.NamedModel({node:this.__model.node.attributes,edge:this.__model.edge.attributes,productModel:this.__model});this.__singleItemCart.add(e);if(this.__isCreatorLanding){e=[];e.push({product_name:this.__model.node.attributes.code_name,product_id:this.__model.node.attributes.product_packages_id.toString(),product_category:this.__model.node.attributes.category,product_price:this.__model.edge.attributes.sale_price,product_quantity:1});try{this.__window.pintrk("track","AddToCart",{value:this.__model.edge.attributes.sale_price,order_quantity:1,currency:"USD",line_items:e},function(b,g){b||this.__appMonitor.reportCustomError("MultiCartUpsellDialog","__addToCart","web_perm_0005k","Error returned from pintrk callback",["Reported Error: "+g])}.bind(this))}catch(b){this.__appMonitor.reportCustomError("MultiCartUpsellDialog","__addToCart","web_perm_0005d","Error thrown in call to window.pintrk",["Reported Error: "+b.message])}}this.__dollarStoreManager.validateAccountStatus().then(function(){this.__dialogManager.showDialog(h.MultiCartCheckout,{cart:this.__singleItemCart,paymentChannels:this.__paymentChannels,defaultChannel:this.__defaultPaymentChannel,origin:"dollar",which:this.__vipTrigger,afterAction:this.__determineAfterAction()}).finished.then(function(){this.close()}.bind(this)).catch(function(){this.close()}.bind(this))}.bind(this)).then(function(){this.$(".checkout-cta").removeClass("disabled");this.upsellAfterGift&&!a&&this.__dialogManager.closeAll()}.bind(this))}else this.close();else this.__myself.populated().then(function(){var b=d.__getErrorString();d.__dialogManager.showDialog(h.Dialogs.AlloyAlertDialog,{title:d.__globalStringManager.get("oops"),text:b,ok:d.__globalStringManager.get("OKAY")}).finished.then(function(){d.__dialogManager.closeAll()})});else this.__directToLogin()},__enableCheckoutButton:function(){this.$(".checkout-cta").removeClass("disabled");this.upsellAfterGift?this.$(".checkout-cta").html(this.__globalStringManager.get("upsell_after_gift_cta")):this.$(".checkout-cta").html(this.__globalStringManager.get("buy_now_for")+" "+this.__model.edge.attributes.sale_price_formatted)},__enableSimulatedCheckoutButton:function(){this.$(".checkout-cta").removeClass("disabled");this.$(".checkout-cta").html(this.__globalStringManager.get("buy_now"))},__disableCheckoutButton:function(){this.$(".checkout-cta").addClass("disabled");this.$(".checkout-cta").html(this.__globalStringManager.get("buy_now"))},__clearCart:function(){this.__singleItemCart=new h.CartCollection([])},show:function(){this.__clearCart();c.prototype.show.call(this)},hide:function(){if(this.__isLoggedIn){c.prototype.hide.call(this);var a=new CustomEvent("multiCartUpsellDialog:closed");this.__window.dispatchEvent(a)}else this.__directToLogin()},close:function(){if(this.__isLoggedIn){var a=new CustomEvent("multiCartUpsellDialog:clickedCancel");this.__window.dispatchEvent(a);c.prototype.close.call(this)}else this.__directToLogin()},__handleLearnMore:function(){this.$(".description-short").addClass("hidden");this.$(".learn").addClass("hidden");this.$(".description-long").removeClass("hidden");this.$(".lines").removeClass("hidden")},__handleGreeterCTA:function(){this.__featureAccessManager.isElectronClient()?this.__serviceProvider.get("externalWindow").open(this.__urlManager.get("greeter_program_info")):this.__window.location=this.__urlManager.get("greeter_program_info")},__renderTitle:function(){this.$(".dialog-header .dialog-title").text(this.title)},__adjustDialogSize:function(){this.$(".dialog-container").removeClass(this.title);this.$(".dialog-container").addClass("upsell_after_gift_"+this.__upsellProduct)},__getSimulatedModel:function(){this.__simulated=!0;var a={node:{}};a.node.attributes={dlg_name:"",name:"",dlg_background_url:"",sale_price_formatted:""};a.edge={};a.edge.attributes={sale_price_formatted:null};switch(this.__upsellProduct){case"ap":a.node.attributes.dlg_name="dlg_accesspass";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_ap");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-access-pass-2021-01-15.jpg";break;case"marriage_package":a.node.attributes.dlg_name="dlg_marriagepackage";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_marriage_package");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-marriage-package-2021-01-15.jpg";break;case"age_verification":a.node.attributes.dlg_name="dlg_ageverify";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_age_verification");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-age-verification-2021-01-15.jpg";break;case"shared_room":a.node.attributes.dlg_name="dlg_sharedroom";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_shared_room");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-shared-room-2021-01-15.jpg";break;case"name_change":a.node.attributes.dlg_name="dlg_namechange";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_name_change");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-name-change-token-2021-01-15.jpg";break;case"room_slot":a.node.attributes.dlg_name="dlg_chatroomslot";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_room_slot");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-chat-room-slot-2021-01-15.jpg";break;case"credits":a.node.attributes.dlg_name="dlg_credits";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_credits");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-buy-credits-2021-01-15.jpg";break;case"vip":a.node.attributes.dlg_name="dlg_vip";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_vip");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/vip/products/upsell_large_art.png";break;case"host_subscription":a.node.attributes.dlg_name="dlg_host_subscription";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_host_subscription");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-become-a-host-2021-01-15.jpg";break;case"greeter":a.node.attributes.dlg_name="dlg_greeter";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_greeter");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-greeter-program-2021-01-15.jpg";break;case"vcoin":a.node.attributes.dlg_name="vcoin";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_vcoin");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-buy-vcoin-2021-01-15.jpg";break;default:a=null,this.__window.console.error("MultiCartSubmode::__getSimulatedModel - Unknown product",this.__upsellProduct)}a.on=function(){};this.__model=a;this.title=this.__model.node.attributes.name;this.__getPackageMapOverrides();this.__renderTitle();this.upsellAfterGift&&this.__adjustDialogSize()},__getPackageMap:function(){return{dlg_namechange:{subtitle_key:"UPGRADE_NAME_CHANGE_TOKEN_TITLE",desc_key:"UPGRADE_NAME_CHANGE_TOKEN_DESC",dlg_title:"MCS_Simulated_Model_Name_name_change"},dlg_accesspass:{subtitle_key:"UPGRADE_ACCESS_PASS_TITLE",desc_key:"UPGRADE_ACCESS_PASS_DESC"},dlg_namereg:{subtitle_key:"UPGRADE_NAME_REGISTRATION_TITLE",desc_key:"UPGRADE_NAME_REGISTRATION_DESC"},dlg_ageverify:{subtitle_key:"UPGRADE_AGE_VERIFICATION_TITLE",desc_key:"UPGRADE_AGE_VERIFICATION_DESC"},dlg_sharedroom:{subtitle_key:"UPGRADE_SHARED_ROOM_TITLE",desc_key:"UPGRADE_SHARED_ROOM_DESC"},dlg_chatroomslot:{subtitle_key:"UPGRADE_CHATROOM_SLOT_TITLE",desc_key:"UPGRADE_CHATROOM_SLOT_DESC"},dlg_marriagepackage:{subtitle_key:"UPGRADE_MARRIAGE_LICENSE_TITLE",desc_key:"UPGRADE_MARRIAGE_LICENSE_DESC"},dlg_vip:{subtitle_key:"UPGRADE_VIP_TITLE",desc_key:"UPGRADE_VIP_DESC",dlg_title:"MCS_Simulated_Model_Name_vip"},dlg_host_subscription:{subtitle_key:"UPGRADE_HOST_SUB_TITLE",desc_key:"UPGRADE_HOST_SUB_DESC",dlg_title:"UPGRADE_HOST_SUB_DLG_TITLE"},dlg_credits:{subtitle_key:"UPGRADE_CREDITS_TITLE",desc_key:"UPGRADE_CREDITS_DESC",dlg_title:"MCS_Simulated_Model_Name_credits"},dlg_greeter:{subtitle_key:"UPGRADE_GREETER_TITLE",desc_key:"UPGRADE_GREETER_DESC",dlg_title:"MCS_Simulated_Model_Name_greeter"},vcoin:{subtitle_key:"UPGRADE_VCOIN_TITLE",desc_key:"UPGRADE_VCOIN_DESC",dlg_title:"MCS_Simulated_Model_Name_vcoin"},upsell_after_gift_subtitle_credits:{subtitle_key:"upsell_after_gift_subtitle_credits",desc_key:"UPGRADE_CREDITS_DESC",dlg_title:"upsell_after_gift_title"},upsell_after_gift_subtitle_vcoin:{subtitle_key:"upsell_after_gift_subtitle_vcoin",desc_key:"UPGRADE_VCOIN_DESC",dlg_title:"upsell_after_gift_title"},upsell_after_gift_subtitle_product:{subtitle_key:"upsell_after_gift_subtitle_product",desc_key:"UPGRADE_CREDITS_DESC",dlg_title:"upsell_after_gift_title"}}},__getCategories:function(){switch(this.__upsellProduct){case"ap":case"marriage_package":case"age_verification":case"shared_room":case"name_change":case"room_slot":var a=["upgrade"],d="next";break;case"credits":a=["credits"];d="next";break;case"vip":a=["vip"];d="next";break;case"host_subscription":a=["hosting"];d="next";break;case"greeter":break;case"vcoin":a=["vcoin"];d="vcoin";break;case"product":this.__upsellProduct="credits";a=["credits"];d="next";break;default:this.__window.console.error("MultiCartUpsellDialog::getCategories - Unknown product",this.__upsellProduct,". Setting default to credits."),this.__upsellProduct="credits",a=["credits"],d="next"}return{categories:a,storeType:d}},__setDialogText:function(a){this.__subtitle=this.__isCreatorLanding||this.__customDlg_name?this.__customSubtitle:this.__globalStringManager.get(a.subtitle_key);this.__description=this.__isCreatorLanding?this.__customDescription:this.__globalStringManager.get(a.desc_key)},__getPackageMapOverrides:function(){this.__dlgName=this.__model.node.attributes.dlg_name;this.$(".dialog-container").addClass(this.__dlgName);this.__customDlg_name&&(this.__dlgName=this.__customDlg_name);var a=this.__packageMap[this.__dlgName];a?(this.__setDialogText(a),this.__isLoggedIn?"host_subscription"===this.__upsellProduct&&(this.__description='<p class="description">'+this.__globalStringManager.get("host_subscription_upsell_dialog_description")+'</p><ul class="lines"><li class="line1 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line1")+'</li><li class="line2 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line2")+'</li><li class="line3 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line3")+'</li><li class="line4 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line4")+"</li></ul>"):"host_subscription"===this.__upsellProduct?this.__description+='<div class="spacer"></div><div class="spacer"></div>'+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_prompt")+'<br><div class="spacer"></div><ul><li>'+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_line1")+"</li><li>"+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_line2")+"</li><li>"+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_line3")+"</li></ul>":"vip"===this.__upsellProduct&&(this.__description+='<div class="spacer"></div><div class="spacer"></div>'+this.__globalStringManager.get("vip_upsell_dialog_extension_prompt")+'<br><div class="spacer"></div><ul><li>'+this.__globalStringManager.get("vip_upsell_dialog_extension_line1")+"</li><li>"+this.__globalStringManager.get("vip_upsell_dialog_extension_line2")+"</li><li>"+this.__globalStringManager.get("vip_upsell_dialog_extension_line3")+"</li></ul>"),a.dlg_title&&(this.title=this.__isCreatorLanding?this.__globalStringManager.get("buyupgrade_creator_title"):this.__globalStringManager.get(a.dlg_title))):(this.__subtitle=this.__globalStringManager.get("UPGRADE_CREDITS_TITLE"),this.__description=this.__globalStringManager.get("UPGRADE_CREDITS_DESC"))},_testGetCart:function(){return this.__singleItemCart},_testGetErrorString:function(){return this.__getErrorString()},_testGetDeterminedAfterAction:function(){return this.__determineAfterAction()}})}({Dialogs:m["@Dialogs"],Model:m["@Model"],UiCore:m["@UiCore"],CartCollection:H,MultiCartCheckout:w,MultiCartList:K,MultiProductList:B,multiProductUpsellVipTiers:G,template:P});G=function(h){var c=h.UiCore.NodeModel;return c.extend("VirtualCartNode",{save:function(a,d){return c.prototype.save.call(this,{data:a},d)}})}({UiCore:m["@UiCore"]});w=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b,g=a.helperMissing;d=this.escapeExpression;var f='<div class="available-credits font-medium text-12 flex items-center">\n    <div class="flex wh-15 mr-5">';if((g=(b=a.icon||c&&c.icon||g,b.call(c,"icon-credits",{name:"icon",hash:{class:"wh-full"},data:e})))||0===g)f+=g;return f+'</div>\n    <div class="credits-value">'+d((b=a.price||c&&c.price,"function"===typeof b?b.call(c,{name:"price",hash:{},data:e}):b))+"</div>\n</div>\n"},useData:!0})}({});B=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){var b,g=a.helperMissing;d=this.escapeExpression;var f='<div class="available-vcoin font-medium text-12 flex items-center">\n    <div class="flex wh-15 mr-5">';if((g=(b=a.icon||c&&c.icon||g,b.call(c,"icon-vcoin",{name:"icon",hash:{class:"wh-full"},data:e})))||0===g)f+=g;return f+'</div>\n    <div class="vcoin-value">'+d((b=a.price||c&&c.price,"function"===typeof b?b.call(c,{name:"price",hash:{},data:e}):b))+"</div>\n</div>\n"},useData:!0})}({});p=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(c,a,d,e){return'<p class="items-purchased"></p>\n'},useData:!0})}({});p=function(h){var c=h.Dialogs.AlloyAlertDialog;return c.extend("SuccessDialog",{uiContextName:"checkout_success_dialog",className:"success-dialog",dependencies:["globalStringManager","Promise"],initialize:function(a){this.__globalStringManager=a.globalStringManager;a.title=a.globalStringManager.get("checkout_success_title");a.ok=a.ok||a.globalStringManager.get("Continue Shopping");a.checkbox=a.saveOutfit?a.globalStringManager.get("Save current outfit as Look"):void 0;c.prototype.initialize.call(this,a);this.Promise=a.Promise;this.__window=a.window;this.__itemsPurchased=a.itemsPurchased;this.__isStickerCheckout=IMVU.optionalProperty(a,"isStickerCheckout",!1);this.__stickerPackName=IMVU.optionalProperty(a,"stickerPackName",null);this.dialogManager=a.dialogManager;this.addToDOM()},postRender:function(){c.prototype.postRender.call(this);this.$(".dialog-body p").replaceWith(h.template);this.__isStickerCheckout?(this.$(".dialog-checkbox-container").hide(),this.$(".items-purchased").text(this.__globalStringManager.get("checkout_sticker_success_message",{stickerPackName:this.__stickerPackName}))):this.$(".items-purchased").text(this.__globalStringManager.getPluralized("checkout_success_message",{howMany:this.__itemsPurchased}))}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],template:p});m=function(h){var c=h.Dialogs.AlloyModalDialog;return c.extend("CheckoutDialog",{uiContextName:"checkout_dialog",className:"checkout-dialog dialog-type-B",dependencies:"cart dialogManager featureAccessManager globalStartupModel globalStringManager googleAnalytics loginManager onboardingGamificationManager Promise rest restModelFactory securitySettingsManager window".split(" "),trackedEvents:function(){var a=this;return[{type:"click",selector:".buy-now",name:"buy_now",handler:this.__buyNow,attributes:function(){return{productId:a.__productId}}},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack},{type:"click",selector:".vip-upsell.purchase-free",name:"vip_upsell",handler:this.__openVIPDialog},{type:"click",selector:".vip-upsell-banner-wrapper",name:"vip_upsell",handler:this.__openVIPDialog}]},initialize:function(a){c.prototype.initialize.call(this,a);this.__cartListFactory=a.cartListFactory||h.CartList;this.__successOk=IMVU.optionalProperty(a,"successOk",null);this.__productTaxonomyOrigin=IMVU.optionalProperty(a,"productTaxonomyOrigin",null);this.__taxonomyCredsPreds=null;this.__myself=a.loginManager.getCurrentUser();if(this.__dressUpAvatarManager=IMVU.optionalProperty(a,"dressUpAvatarManager",null))this.__lookModel=this.__dressUpAvatarManager.getLookModel();this.__isStickerCheckout=IMVU.optionalProperty(a,"isStickerCheckout",!1);this.__stickerPackName=IMVU.optionalProperty(a,"stickerPackName",null);this.__useBackButton=IMVU.optionalProperty(a,"useBackButton",!1);this.__cart=a.cart;this.__itemsPurchased=this.__itemCount=this.__orderTotal=0;this.__virtualCartUrl=a.globalStartupModel.get("virtualCartUrl");this.__cartOrderUrl=a.globalStartupModel.get("cartOrderUrl");this.__googleAnalytics=a.googleAnalytics;this.__formatNumber=h.FormatNumber;this.title=this.__globalStringManager.get("checkout_title");this.__hasDistinguish=this.__vipDiscountAmount=0;this.__hasLegacyVip=this.__hasVipForDiscount=!1;this.addToDOM()},delete:function(){this.__subscriptions&&this.__subscriptions.invalidate();this.__cart&&this.__cart.each(function(a){a.set("also_tried_on",!1);a.set("is_worn_in_shop",!1)});this.__tooltip&&this.__tooltip.delete();c.prototype.delete.call(this)},__destroy:function(){this.hide();this.delete()},postRender:function(){var a=this;this.__isStickerCheckout&&this.$el.addClass("sticker-pack-checkout-dialog");this.__myself.populated().then(function(){a.__subscriptions=a.__myself.getEdgeCollection("subscriptions",h.UiCore.EdgeCollection);return a.__subscriptions.populated()}).then(function(d){d=d.models;for(var e=0;e<d.length;e++){var b=d[e].node;if("vip"===b.get("category")&&1<b.get("tier")){a.__hasVipForDiscount=!0;break}else if(4===a.__myself.get("vip_platform")&&"vip"===b.get("category")&&2===b.get("tier")){a.__hasLegacyVip=!0;break}}}).then(function(){a.__wallet=a.__myself.getSingleEdge("wallet");return a.__wallet.populated()}).then(function(){a.__useBackButton&&(a.$(".dialog-header").prepend(h.backButtonTemplate({})),"mobile"===a.__serviceProvider.get("platform")&&a.$(".dialog-x").remove());return a.__lookModel?a.__lookModel.getChangePromise():a.__Promise.accept()}).then(function(){a.__cartItemIsNFT=a.__featureAccessManager.canSeeNFT()&&a.__cart.models[0].get("is_nft");a.__productId=a.__featureAccessManager.canSeeNFT()&&a.__cart.models[0].get("product_id");a.__setBodyContent();a.__cartItemIsNFT?a.setContent("auxHeader",h.headerVcoinTemplate,{}):a.setContent("auxHeader",h.headerCreditsTemplate,{});a.setContent("footer",a.$(".dialog-footer-template").text());a.__cart.markSelectedProducts();a.__cart.comparator=function(e){return!e.get("is_selected")};a.__cart.sort();var d=!1;a.__cart.each(function(e){d||e.get("is_selected")||(d=!0,e.set("also_tried_on",!0))});a.$(".cart-list-container").scrollbar();a.__addCartList();a.__cartItemIsNFT?a.__updateVcoinDisplay():a.__updateCreditsDisplay();a.__updateCartTotals();a.__cart.each(function(e){a.listenTo(e,"change:is_selected",a.__updateCartTotals)});a.listenTo(a.__wallet,"change",a.__onWalletChange);a.listenTo(a.__myself,"change:is_vip change:vip_tier",a.__onVipStatusChange)})},__addCartList:function(){this.__cartList=this.createChildContext(this.__cartListFactory,{$replaceElement:this.$(".cart-list"),collection:this.__cart})},__currentWealth:function(){return this.__wallet.get("credits")+this.__wallet.get("promo_credits")},__updateCreditsDisplay:function(){this.$(".available-credits .credits-value").text(this.__formatNumber.formatCredits(Number(this.__currentWealth())))},__updateVcoinDisplay:function(){this.$(".available-vcoin .vcoin-value").text(this.__formatNumber.addComma(this.__formatNumber.formatDecimal(this.__wallet.get("vcoin_total"),2)))},__onWalletChange:function(){this.__hasVipForDiscount||this.__subscriptions.invalidate();this.__updateCreditsDisplay();this.__updateVIPUpsellDisplay();this.$("button.buy-now").prop("disabled",0===this.__itemCount)},__updateCartTotals:function(){var a=this,d=0;this.__vipDiscountAmount=this.__itemCount=0;this.__cart.models&&this.__Promise.every(this.__cart.models.map(function(e){if(e.get("is_selected"))if(a.__itemCount++,e.get("is_bundle")){d+=e.get("product_price");a.__vipDiscountAmount+=e.get("product_price")-e.get("discount_price");var b=e.getEdgeCollection("subproducts",h.Model.ProductEdgeCollection);b.populated().then(function(){b.map(function(g){a.__hasDistinguish+=g.node.get("has_plus_badge")||g.node.get("is_plus_badge_compatible")?1:0;g.node.get("is_owned")&&80!=g.node.get("product_id")&&191!=g.node.get("product_id")&&(d-=g.node.get("product_price"),a.__vipDiscountAmount-=g.node.get("product_price")-g.node.get("discount_price"))});a.__Promise.accept()})}else a.__hasDistinguish+=e.get("has_plus_badge")||e.get("is_plus_badge_compatible")?1:0,d=a.__cartItemIsNFT?d+e.get("vcoin_price"):d+e.get("product_price"),a.__vipDiscountAmount+=e.get("product_price")-e.get("discount_price"),a.__Promise.accept()})).then(function(){a.__orderTotal=d;!a.__hasVipForDiscount&&!a.__hasLegacyVip||a.__cartItemIsNFT||(a.__orderTotal-=a.__vipDiscountAmount);a.$(".order-subtotal .credits-value").text(a.__formatNumber.formatCredits(Number(d)));a.$(".vip-discount .credits-value").text(a.__formatNumber.formatCredits(Number(a.__vipDiscountAmount)));a.__cartItemIsNFT?(a.$(".vip-discount").css("display","none"),a.$(".price-off").css("display","none"),a.$(".order-total .vcoin-value").text(a.__formatNumber.formatCredits(Number(a.__orderTotal)))):a.$(".order-total .credits-value").text(a.__formatNumber.formatCredits(Number(a.__orderTotal)));a.$(".item-count").text(a.__itemCount);a.$("button.buy-now").prop("disabled",0===a.__itemCount);a.$(".vip-upsell .price-off-amount").text(a.__formatNumber.formatCredits(Number(a.__vipDiscountAmount)));a.__orderTotal||!a.__isStickerCheckout?(a.$("button.buy-now .buy-now-text").text(a.__globalStringManager.getPluralized("checkout_dialog_buy_now_message",{howMany:a.__itemCount,totalCredits:""})),a.__cartItemIsNFT?(a.__orderTotal=a.__formatNumber.formatCredits(Number(a.__orderTotal)),a.$("button.buy-now .buy-now-amount").html(h.vcoinValueTemplate({totalVcoin:a.__orderTotal}))):a.$("button.buy-now .buy-now-amount").html(h.creditsValueTemplate({totalCredits:a.__formatNumber.formatCredits(Number(a.__orderTotal))}))):a.$("button.buy-now .buy-now-text").text(a.__globalStringManager.get("GET IT FOR FREE"));a.$(".distinguish-cart-blurb").toggleClass("hidden",0===a.__hasDistinguish);a.__updateVIPUpsellDisplay()})},__updateVIPUpsellDisplay:function(){var a=Number(this.__wallet.get("promo_credits"));this.__orderTotal-this.__vipDiscountAmount<=5e3+a&&a<this.__orderTotal?(this.$(".vip-upsell.show-discount").hide(),this.$(".vip-upsell.purchase-free").show()):(this.$(".vip-upsell.show-discount").show(),this.$(".vip-upsell.purchase-free").hide())},__buyNow:function(){var a=this;this.$(".buy-now").prop("disabled",!0);this.$(".buy-now").addClass("processing");this.$(".dialog-x").prop("disabled",!0);if(this.__cartItemIsNFT)this.__purchaseNFTProducts();else if(this.__orderTotal>this.__currentWealth())this.$(".buy-now").prop("disabled",!1),this.$(".buy-now").removeClass("processing"),this.$(".dialog-x").removeAttr("disabled"),this.__displayBuyCreditDialog();else{this.__googleAnalytics.recordBuyAnItem("purchased");var d=this.__wallet.get("credits"),e=this.__wallet.get("promo_credits");this.__taxonomyCredsPreds=d>this.__orderTotal?"credits":0===d&&e>this.__orderTotal?"predits":"credits_and_predits";this.__purchaseProducts().then(function(){a.__productTaxonomyOrigin&&a.__cart.models.forEach(function(b){a.recordProductTaxonomyEvent(b,{event:"product_purchased",eventClass:"shop",eventReason:"tap",location:a.__productTaxonomyOrigin,status:"success",currencyType:a.__taxonomyCredsPreds,systemError:null})});a.__featureAccessManager.canSeeOnboardingGamification()&&(a.__onboardingGamificationManager.handleTaskCompletion("store_purchase"),function(){return a.__recordEvent("onboarding",{name:"grant_reward",event_type:"store_purchase",cid:a.__myself.get("legacy_cid"),record:!0})});a.__displaySuccessDialog()}).catch(function(){a.$(".buy-now").prop("disabled",!1);a.$(".buy-now").removeClass("processing");a.$(".dialog-x").removeAttr("disabled");return a.__dialogManager.alert({title:a.__globalStringManager.get("checkout_error_title"),text:a.__globalStringManager.get("checkout_error_text"),ok:a.__globalStringManager.get("checkout_error_button")}).finished})}},__buyCreditsClicked:function(){this.__window.open("/store?platform="+this.__serviceProvider.get("storePlatform"))},__purchaseNFTProducts:function(){var a=this;if(this.__wallet.get("vcoin_total")<this.__orderTotal)this.$(".buy-now").prop("disabled",!1),this.$(".buy-now").removeClass("processing"),this.$(".dialog-x").removeAttr("disabled"),this.__dialogManager.showDialog(h.Dialogs.AlloyConfirmationDialog,{title:this.__globalStringManager.get("nft_purchase_need_vcoin_title"),text:this.__globalStringManager.get("nft_purchase_need_vcoin_text"),yes:this.__globalStringManager.get("nft_purchase_need_vcoin_confirm"),no:this.__globalStringManager.get("nft_purchase_need_vcoin_cancel")}).finished.then(function(){a.__securitySettingsManager.requireVcoin2FACheck(a.__wallet).then(function(){a.__upsellDialog=a.__dialogManager.showDialog(h.MultiCartUpsellDialog,{upsellProduct:"vcoin",contextual:!0});return a.__upsellDialog})});else{var d=this.__getSelectedItems();d={action:2,amount:parseFloat(this.__orderTotal),txn_id:this.__generateTxnId(),nft_data:{nft_id:parseInt(d.models[0].get("nft_id")),seller_cid:d.models[0].get("creator_cid")}};this.__vcoinTransactionsUrl=this.__myself.relations.vcoin_transactions;return this.__rest.post(this.__vcoinTransactionsUrl,d).then(function(){a.__dialogManager.alert({title:a.__globalStringManager.get("checkout_success_title"),text:a.__globalStringManager.get("nft_purchase_successful_text"),ok:a.__globalStringManager.get("nft_purchase_successful_confirmation")})}).catch(function(){a.$(".buy-now").prop("disabled",!1);a.$(".buy-now").removeClass("processing");a.$(".dialog-x").removeAttr("disabled");return a.__dialogManager.alert({title:a.__globalStringManager.get("checkout_error_title"),text:a.__globalStringManager.get("checkout_error_text"),ok:a.__globalStringManager.get("checkout_error_button")}).finished})}},__purchaseProducts:function(){var a=this,d=this.__getSelectedItems();return this.__restModelFactory.createModel(this.__cartOrderUrl,h.UiCore.NodeModel,{platform:"mobile"===this.__serviceProvider.get("platform")?"NEXT_SMALL":"NEXT_BIG",relations:{products:d.models.map(function(e){return e.id})}}).then(function(){a.__itemsPurchased=d.models.length})},__getSelectedItems:function(){var a=new Backbone.Collection;this.__cart.each(function(d){d.get("is_selected")&&a.add(d)});return a},__commitCartPurchase:function(a){var d=this;return a.populated().then(function(){return a.save({status:"COMMITTED",platform:"mobile"===d.__serviceProvider.get("platform")?"NEXT_SMALL":"NEXT_BIG"},{wait:!0})}).then(function(){var e=a.get("status");if("COMMITTED"===e)return d.__Promise.resolve();if("FAILED"===e)return d.__Promise.reject({error:"cart commit failed"})})},__boughtAllWornProducts:function(){if(!this.__dressUpAvatarManager)return!1;var a=!0,d=this.__cart.models.filter(function(b){return!!b.get("is_worn_in_shop")});if(0===d.length)return!1;var e=this.__getSelectedItems().models.map(function(b){return b.id});d.forEach(function(b){-1===e.indexOf(b.id)&&(a=!1)});return a},__displaySuccessDialog:function(){var a=this;return this.__dialogManager.showDialog(h.SuccessDialog,{itemsPurchased:this.__itemsPurchased,saveOutfit:this.__boughtAllWornProducts(),isStickerCheckout:this.__isStickerCheckout,stickerPackName:this.__stickerPackName,ok:this.__successOk}).finished.then(function(d){d&&d.checked&&(a.__dressUpAvatarManager.saveCurrentOutfit(),a.__myself.populated().then(function(){a.__myself.getEdgeCollection("outfits",h.Model.OutfitCollection).invalidate()}));a.promiseResolver.resolve();a.__destroy()}).catch(function(){a.promiseResolver.resolve();a.__destroy()})},__displayBuyCreditDialog:function(){var a=this.__orderTotal-this.__currentWealth();this.__dialogManager.showDollarStoreDialog({totalAmount:0<a?a:0})},__goBack:function(){this.promiseResolver.resolve(!0)},__openVIPDialog:function(){var a=this;this.$(".available-credits .credits-value").text(this.__globalStringManager.get("UPDATING"));this.$("button.buy-now").prop("disabled",!0);this.__dialogManager.showDialog(h.MultiCartUpsellDialog,{upsellProduct:"vip",vipTrigger:"checkout_dialog",vipTriggerLocation:"unknown",contextual:!0,disabledProducts:[0],selectedProduct:1}).finished.then(function(){}).catch(function(){a.__updateCreditsDisplay();a.$("button.buy-now").prop("disabled",0===a.__itemCount)})},__setBodyContent:function(){this.setContent("body",h.template,{showSavings:this.__determineSavings(),showUpsellBanner:!this.__hasVipForDiscount&&!this.__hasLegacyVip,isNFT:this.__cartItemIsNFT})},__determineSavings:function(){return this.__cartItemIsNFT?!1:this.__hasVipForDiscount||this.__hasLegacyVip},__onVipStatusChange:function(){this.__hasVipForDiscount=this.__myself.get("is_vip")&&1!==this.__myself.get("vip_tier");this.$(".checkout-container").remove();this.__setBodyContent();this.$(".cart-list-container").scrollbar();this.__addCartList();this.__updateCartTotals()},__closeCheckout:function(){this.trigger("change:closeCheckout")},__generateTxnId:function(){var a=function(){return Math.random().toString(16).slice(-4)};return this.__myself.get("legacy_cid")+a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}})}({Dialogs:m["@Dialogs"],Model:m["@Model"],UiCore:m["@UiCore"],CartList:x,FormatNumber:D,MultiCartUpsellDialog:P,SuccessDialog:p,Tooltip:v,VirtualCartNode:G,backButtonTemplate:O,creditsValueTemplate:A,headerCreditsTemplate:w,headerVcoinTemplate:B,template:M,vcoinValueTemplate:N});return{CartCollection:H,CheckoutDialog:m,GiftingDialog:L}});