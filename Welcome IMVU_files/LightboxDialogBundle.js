module({"json!/common/withme/i18n/settings.json":"json!/asset/6de7917171955166/common/withme/i18n/settings.json","@Dialogs":"@Dialogs","@WAFWidgets":"@WAFWidgets","json!/common/js/JSON/States.json":"json!/asset/581385bf78983508/common/js/JSON/States.json","@NextUtil":"@NextUtil","json!/common/js/JSON/LanguageMap.json":"json!/asset/58eb7a4b19ab9746/common/js/JSON/LanguageMap.json","json!/common/js/JSON/Provinces.json":"json!/asset/1e80a06c565197b7/common/js/JSON/Provinces.json","json!/common/withme/js/mode/friends/profile.json":"json!/asset/8196a1066d1f2551/common/withme/js/mode/friends/profile.json","json!@StoreModeDictionary":"json!@StoreModeDictionary","json!/common/pure/util/profile.json":"json!/asset/996b43a0c80f13b9/common/pure/util/profile.json","@Model":"@Model","@UiCore":"@UiCore","json!/common/js/JSON/Countries.json":"json!/asset/82bbf3f0be07c92d/common/js/JSON/Countries.json","@WithmeWidgets":"@WithmeWidgets","@Linkify":"@Linkify","@Checkout":"@Checkout","@moment":"@moment","css!/build/withme/LightboxDialogBundle.css":"css!/asset/f6ae86a9850e96b6/build/withme/LightboxDialogBundle.css"},function(l){var r=function(g){var b=function(f){var k=Math.round(f/1e6*10)/10;if(1<=k)return k+"M views";k=Math.round(f/1e3);return 1<=k?k+"K views":f+" views"},a=function(f){var k=$jscomp.makeIterator(f.match(/((\d+)H)?((\d+)M)?((\d+)S)?$/));k.next();k.next();f=k.next().value;k.next();var m=k.next().value;k.next();k=k.next().value;var n="";f&&(n=""+f);n=m?(n?n+":":"")+m.padStart(2,"0"):n?n+":00":"00";return n=k?n+":"+k.padStart(2,"0"):n+":00"},c=function(f){return function(k){return f.reduce(function(m,n){return n(m)},k)}},e=function(f){f=f.toString().split(".");f[0]=f[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");return f.join(".")},d=function(f){return isNaN(f)||Math.floor(f)===f?0:f.toString().split(".")[1].length||0},h=function(f,k){if(d(f)<=k)return parseFloat(f).toFixed(k);var m=Math.pow(10,k);return(Math.trunc(f*m)/m).toFixed(k)};return{getTimeFormat:function(f,k){var m=Math.floor(f/3600),n=Math.floor(f/60)-60*m;f%=60;k&&(f=f.toFixed(k));k=10>f?"0":"";return m?m+":"+(10>n?"0":"")+n+":"+k+f:n+":"+k+f},formatCredits:function(f){return f.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},zeroPad:function(f,k){return(Array(k).join("0")+f).substr(-k,k)},formatMini:function(f,k){var m=[{base:1e3,letter:"K"},{base:1e6,letter:"M"},{base:1e9,letter:"B"}];if(f<(k?k:1e3))return e(f);for(var n=m.length-1;0<=n;n--){k=m[n];var q=k.base;if(f>=q)return m=Math.floor(f/q),f=Math.floor((f-q*m)/(q/10)),m+(f?"."+f:"")+k.letter}return""+f},addComma:e,formatDecimal:h,formatVCOIN:function(f){return e(h(f,2))},countDecimals:d,durationParser:a,viewFormatter:b,formatYouTubeVideoMetaData:function(f){return f.items.map(function(k){var m=k.snippet,n=k.contentDetails,q=k.id,p=k.status;return{imageUrl:m.thumbnails.medium.url,videoTitle:m.title,videoAuthor:m.channelTitle,videoDescription:m.description,totalViews:b(k.statistics.viewCount),duration:a(n.duration),isoDuration:n.duration,published:g.moment(m.publishedAt).fromNow(),videoId:q,embeddable:p.embeddable}})},getSuggestionsFromResponse:function(f){return c([function(k){return JSON.parse(k.match(/\((.*)\)/)[1])},function(k){return k[1]},function(k){return k.map(function(m){return m[0]})}])(f)},getTokenFromResponse:function(f){return c([function(k){return JSON.parse(k.match(/\((.*)\)/)[1])},function(k){return k[2]},function(k){return k.q}])(f)}}}({moment:l["@moment"]}),eb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'<button class="btn remove-button"></button>'},3:function(b,a,c,e){return'<button class="btn id-info info-button"></button>'},5:function(b,a,c,e){return'<button class="btn ap ap-badge"></button>'},7:function(b,a,c,e){var d;c=a.helperMissing;var h='<button class="btn ',f=a["if"].call(b,b&&b.isNFTAndAP,{name:"if",hash:{},fn:this.program(8,e),inverse:this.program(10,e),data:e});if(f||0===f)h+=f;h+=' nft-badge">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"nft_logo_text",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-nft",{name:"icon",hash:{},data:e})))||0===f)h+=f;return h+"</button>"},8:function(b,a,c,e){return" nftAndAP "},10:function(b,a,c,e){return" nft "},12:function(b,a,c,e){var d;c=a.helperMissing;var h='\n        <div class="unselected-icon">',f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-check_mark_unchecked",{name:"icon",hash:{},data:e}));if(f||0===f)h+=f;h+='</div>\n        <div class="selected-icon">';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-check_mark",{name:"icon",hash:{},data:e})))||0===f)h+=f;return h+"</div>\n    "},14:function(b,a,c,e){c='\n    <div class="product-info">\n        ';var d=a["if"].call(b,b&&b.showName,{name:"if",hash:{},fn:this.program(15,e),inverse:this.noop,data:e});if(d||0===d)c+=d;c+="\n        ";if((d=a["if"].call(b,b&&b.showPriceInfo,{name:"if",hash:{},fn:this.program(17,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n        ";if((d=a["if"].call(b,b&&b.showCart,{name:"if",hash:{},fn:this.program(22,e),inverse:this.program(24,e),data:e}))||0===d)c+=d;c+="\n    </div>\n    ";if((d=a["if"].call(b,b&&b.showInstanceCount,{name:"if",hash:{},fn:this.program(26,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n    ";if((d=a["if"].call(b,b&&b.showInstancePicker,{name:"if",hash:{},fn:this.program(28,e),inverse:this.noop,data:e}))||0===d)c+=d;return c+"\n"},15:function(b,a,c,e){var d;c=this.escapeExpression;return'<div class="product-name">'+c((d=a.name||b&&b.name,"function"===typeof d?d.call(b,{name:"name",hash:{},data:e}):d))+"</div>"},17:function(b,a,c,e){var d;c=a.helperMissing;var h='\n            <div class="price-info">\n                ',f=a["if"].call(b,b&&b.isNFT,{name:"if",hash:{},fn:this.program(18,e),inverse:this.program(20,e),data:e});if(f||0===f)h+=f;h+='\n                <div class="owned-label">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"IN INVENTORY",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</div>\n                <div class="displayonly-label">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"DISPLAY ONLY",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</div>\n            </div>\n        "},18:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f="\n                <div class='price-vcoin font-medium text-12 line-height-13 flex items-center'>\n                    <div class=\"flex wh-15 mr-5 relative\">";if((h=(d=a.icon||b&&b.icon||h,d.call(b,"icon-vcoin",{name:"icon",hash:{class:"wh-full"},data:e})))||0===h)f+=h;return f+'</div>\n                    <div class="vcoin-value">'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</div>\n                </div>\n                "},20:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f="\n                <div class='price-credits font-medium text-12 line-height-13 flex items-center'>\n                    <div class=\"flex wh-15 mr-5 relative\">";if((h=(d=a.icon||b&&b.icon||h,d.call(b,"icon-credits",{name:"icon",hash:{class:"wh-full"},data:e})))||0===h)f+=h;return f+'</div>\n                    <div class="credits-value">'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</div>\n                </div>\n                "},22:function(b,a,c,e){var d;c=a.helperMissing;var h='\n            <div class="cart-button add-to-cart-btn" title="',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Add to Cart",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='">';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-add-to-cart",{name:"icon",hash:{},data:e})))||0===f)h+=f;h+='</div>\n            <div class="cart-button in-cart-btn" title="';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"In Cart",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='">';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-in-cart",{name:"icon",hash:{},data:e})))||0===f)h+=f;return h+"</div>\n        "},24:function(b,a,c,e){return'\n            <span class="id-info more-info"></span>\n        '},26:function(b,a,c,e){return'<div class="instance-count"></div>'},28:function(b,a,c,e){var d;c=a.helperMissing;var h='\n        <div class="roomdeco2-replace tool hidden">',f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-furniture_edit_replace",{name:"icon",hash:{},data:e}));if(f||0===f)h+=f;h+='</div>\n        <div class="roomdeco2-trash hidden">';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-trash",{name:"icon",hash:{},data:e})))||0===f)h+=f;h+='</div>\n        <div class="roomdeco2-trash-all hidden">';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-trash-all",{name:"icon",hash:{},data:e})))||0===f)h+=f;return h+'</div>\n        <div class="instance-picker"></div>\n    '},30:function(b,a,c,e){return'<div class="is-wearing-icon icon icon-ok"></div>'},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c='<div class="tile-body placeholder-container">\n    <img class="cover-image">\n    <div class="cover-image-placeholder hidden"></div>\n    <div class="shields-placeholder"></div>\n    ';var d=a["if"].call(b,b&&b.removeButton,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(d||0===d)c+=d;c+="\n    ";if((d=a["if"].call(b,b&&b.infoButton,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n    ";if((d=a["if"].call(b,b&&b.isAp,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===d)c+=d;c+='\n    <div class="distinguish-placeholder"></div>\n    ';if((d=a["if"].call(b,b&&b.isNFT,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n    ";if((d=a["if"].call(b,b&&b.showAdminToolsSelection,{name:"if",hash:{},fn:this.program(12,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n</div>\n";if((d=a["if"].call(b,b&&b.showProductInfo,{name:"if",hash:{},fn:this.program(14,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n";if((d=a.unless.call(b,b&&b.inRoomDeco,{name:"unless",hash:{},fn:this.program(30,e),inverse:this.noop,data:e}))||0===d)c+=d;return c+'\n<div class="shimmer-container"><div class="shimmer"></div></div>\n'},useData:!0})}({}),fb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'<div class="product-status-back"></div>'},3:function(b,a,c,e){return'<div class="product-status-icon-row status-greylisted">\n        <div class="product-status-icon">üëéüèª</div>\n        <div class="product-status-label">Greylisted</div>\n    </div>'},5:function(b,a,c,e){return'<div class="product-status-icon-row status-hidden">\n        <div class="product-status-icon">üôà</div>\n        <div class="product-status-label">Hidden</div>\n    </div>'},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c='<div class="product-status-icon-group">\n    ';var d=a["if"].call(b,b&&b.showBack,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(d||0===d)c+=d;c+="\n    ";if((d=a["if"].call(b,b&&b.greylisted,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n    ";if((d=a["if"].call(b,b&&b.hidden,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===d)c+=d;return c+"\n</div>"},useData:!0})}({}),da=function(g){var b=g.UiCore.UiContext;return b.extend("ProductStatusShields",{className:"product-status-shields",uiContextName:"product_status_shields",dependencies:["featureAccessManager","loginManager","model","restModelFactory"],initialize:function(a){var c=this;b.prototype.initialize.call(this,a);this.showBack=a.showBack;if(a.loginManager.isLoggedIn()){if(this.__myself=this.track(a.loginManager.getCurrentUser()),this.__myself.relations.user_permissions){var e=this.__myself.getSingleEdge("user_permissions");e.populated().then(function(){var d=e.get("permissions");c.__isProductAdmin=d.includes("manage_cis_products");c.__isEmployee=d.includes("is_employee");c.__model.node&&(c.__model=c.__model.node);c.__isProductAdmin?(c.__model.relations.moderation_history||(c.__model=c.__restModelFactory.readModel(c.__model.id+"?show_moderation=true",g.Model.ProductNode)),c.__model.populated().then(function(){if(c.__model.relations.moderation_history){var h=c.__model.getSingleEdge("moderation_history");h.invalidate();h.populated().then(function(){c.__isGreyListed=h.get("is_greylisted");c.addToDOM()})}})):c.addToDOM()})}}else this.__setAsRendered()},render:function(){var a={greylisted:this.__isGreyListed,hidden:this.__isEmployee&&"undefined"!==typeof this.__model.get("is_visible")&&!this.__model.get("is_visible")},c=Object.entries(a).some(function(e){e=$jscomp.makeIterator(e);e.next();return e.next().value});c&&this.$el.html(g.template(Object.assign({},a,{showBack:this.showBack&&c})));this.__setAsRendered()}})}({Model:l["@Model"],UiCore:l["@UiCore"],template:fb}),Q=function(g){var b=g.UiCore.UiContext;return b.extend("UIContextExtension",{dependencies:"browserInfo currentLocale featureAccessManager loginManager timestampHelper window".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__appMonitor=null;this.__browserInfo=a.browserInfo;this.__featureAccessManager=a.featureAccessManager;this.__loginManager=a.loginManager;this.__timestampHelper=a.timestampHelper;this.__currentLocale=this.__currentLocale||"en";this.__currentLocale="www"===this.__currentLocale?"en":this.__currentLocale;this.serviceProvider=a.serviceProvider;this.__userIsLoggedIn=this.__loginManager.isLoggedIn();this.__myCid=0;this.__userIsLoggedIn&&(this.__myself=this.__loginManager.getCurrentUser(),this.__loginType=this.__loginManager.getLoginType(),this.__myself.populated().then(function(){this.__myCid=this.__myself.get("legacy_cid");if("string"===typeof this.__myCid)if(/^\d+$/.test(this.__myCid))this.__myCid=parseInt(this.__myCid);else{if(!this.__appMonitor&&this.serviceProvider.has("appMonitor")){var c=this.serviceProvider.get("appMonitor");c&&(this.__appMonitor=c)}this.__appMonitor?this.__appMonitor.reportCustomError("UIContextExtension","initialize","web_perm_0017","Bad CID detected",["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]):this.__window.appMonitorPending.push(["UIContextExtension","initialize","web_perm_0017","Bad CID detected",["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]]);this.__myCid=0}this.__myCid=this.__myCid?this.__myCid:0;this.__myCountry=this.__myself.get("country")}.bind(this)));this.__perfReportManager=this.serviceProvider.get("perfReportManager");this.__perfReportManager.setUIContext(this)},getActivityGroupID:function(){return this.__activityGroup.id},getClientSessionID:function(){},packageAppDeviceData:function(){var a=this.__browserInfo.getPlatformData();return{is_test_data:String(this.__window.location).includes("localhost")?"test":"production",app_instance_id:a.appInstanceID,device_platform:a.devicePlatform,device_model:a.deviceModel,app_version:a.appVersion,customer_id:this.__myCid}},__packageEventData:function(a,c){var e=this.__timestampHelper.now().unix().toString();return _.extend({event:null,event_class:null,event_transaction_id:c,event_timestamp:e,event_source:"user",event_reason:null,location:null},a)},__packageTaxonomyData:function(a,c){return{payload_format:"taxonomy",taxonomy:{tenant_id:"IMVU",schema_version:1,app_device_data:this.packageAppDeviceData(),event_data:this.__packageEventData(a,c)}}},__recordTaxonomyEvent:function(a,c){var e=g.NextUtil.DomHelper.createGUID();a=this.__packageTaxonomyData(a,e);this.__recordEvent("taxonomy",a,c||"","soma_taxonomy");return e},recordSentWhisper:function(a){return this.__recordTaxonomyEvent({event:"whisper_sent",event_class:"chat",event_reason:"click",string_one:navigator.language,integer_one:a.receiverCid,integer_two:a.senderVipStatus,integer_three:a.receiverVipStatus,location:a.location,level_one:a.roomType,level_two:a.roomId,level_three:a.startOrReply,client_ip:a.clientIp})},recordShowTieredVipUpsell:function(a){return this.__recordTaxonomyEvent({event:"vip_upsell",event_class:"vip",event_reason:"click",string_one:navigator.language,string_two:a.vipTriggerLocation,event_source:"user",location:a.vipTrigger,user_agent:navigator.userAgent,client_ip:a.clientIp})},recordYouTubePlaylistClick:function(a){var c=a.playlistId;c.includes("list=")&&(c=c.split("list=")[1]);return this.__recordTaxonomyEvent({event:"youtube_imvu_curated_playlist_started",event_class:"youtube",event_reason:"click",string_one:c,client_ip:a.clientIp})},recordYouTubeSearch:function(a){return this.__recordTaxonomyEvent({event:"youtube_video_search",event_class:"youtube",event_reason:"click",string_one:a.searchString,client_ip:a.clientIp})},recordGuestExperiencesYouTube:function(a){var c=parseInt(a.hostCid.match(/\d+$/)[0],10);return this.__recordTaxonomyEvent({event:"youtube_video_viewed_by_non_host",event_class:"youtube",event_reason:a.alreadyPlaying?"playing":"started",integer_one:c,level_one:a.roomId,client_ip:a.clientIp})},recordProductTaxonomyEvent:function(a,c){a=a.get("product_id");if("number"!==typeof a||0>=a)return null;c.systemError=""===c.systemError?null:c.systemError;var e=a.toString(),d={event:IMVU.requireProperty(c,"event"),event_class:IMVU.requireProperty(c,"eventClass"),event_reason:IMVU.requireProperty(c,"eventReason"),location:IMVU.requireProperty(c,"location"),string_one:IMVU.requireProperty(c,"status")};"product_purchased"===c.event?(d.string_two=IMVU.requireProperty(c,"currencyType"),d.string_three=IMVU.requireProperty(c,"systemError"),d.string_four=this.__loginType,d.string_five=this.__getLanguangeSetting()):(d.string_two=IMVU.requireProperty(c,"systemError"),d.integer_one=a);return this.__recordTaxonomyEvent(d,e)},recordPerformanceTaxonomyEvent:function(a,c,e){if(-1===this.__perfReportManager.getBudget(a))return this.__window.console.error("UIContextExtension::recordPerformanceTaxonomyEvent - tage("+String(a)+") not recognized"),null;var d=this.__perfReportManager.getBudget(a);e=e||{};e.submode="__default__"===e.submode?"default":e.submode;var h=IMVU.optionalProperty(e,"northstar",null);h=h?JSON.stringify(h):"";var f=this.__serviceProvider.get("systemMetrics");f=f?JSON.stringify(f):"";var k=this.__featureAccessManager.getMarketingPlatform(),m=this.__serviceProvider.get("appVersion"),n=0,q=0,p=0;"@DEV"===m?k="desktop-client-dev":m&&(k="desktop-client-"+m,p=m.split("."),n=parseInt(p[0]),q=parseInt(p[1]),p=parseInt(p[2]));m=this.__serviceProvider.get("appName");a=a+"__"+k+"__"+m+"__"+(e.type+"_Mode-"+e.mode+"_Submode-"+e.submode);k=-1;"undefined"===typeof e.sessionDuration?this.__window.console.error("UiContextExtension::recordPerformanceTaxonomyEvent - Event data missing sessionDuration"):k=e.sessionDuration;return this.__recordTaxonomyEvent({event:"performance",event_class:"measurement",event_reason:"dna",location:"dna",decimal_one:d,decimal_two:c,string_one:a,string_two:h,string_three:f,integer_one:n,integer_two:q,integer_three:p,integer_four:k},"")},__getLanguangeSetting:function(){return this.__currentLocale+"-"+this.__myCountry}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"]}),gb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<div class="distinguish-border"></div>\n<div class="distinguish-status">';if((a=(d=a.icon||b&&b.icon||h,d.call(b,"icon-distinguish_badge",{name:"icon",hash:{},data:e})))||0===a)c+=a;return c+"</div>"},useData:!0})}({}),w=function(g){var b=g.UiCore.UiContext;return b.extend("DistinguishStatus",{className:"distinguish-status-shields",uiContextName:"distinguish_status",dependencies:["featureAccessManager","model"],initialize:function(a){b.prototype.initialize.call(this,a);this.__position=a.position?a.position:"start-start";this.addToDOM()},render:function(){var a=this;this.__model&&this.doWork([function(){return a.__model.populated()},function(){var c=a.__model.node?a.__model.node:a.__model;if(c.get("has_plus_badge")||c.get("is_plus_badge_compatible"))a.$el.html(g.template({})),a.$el.addClass(a.__position);a.__setAsRendered()}])}})}({Model:l["@Model"],UiCore:l["@UiCore"],template:gb}),hb=function(g){var b=g.UIContextExtension;return b.extend("ProductTile",{className:"tile product-tile disable-text-selection",uiContextName:"product_tile",tagName:"article",dependencies:"appMonitor dialogManager featureAccessManager globalStringManager iconManager loginManager productImageManager Promise touchEventHelper window".split(" "),trackedEvents:function(){return[{type:"click",name:"change_wearing",handler:this.__onTileClick.bind(this)},{type:"click",selector:".id-info",name:"more_details",handler:this.__moreDetails.bind(this)},{type:"click",selector:".remove-button",name:"remove_button_clicked",handler:this.__handleRemoveButton.bind(this)},{type:"click",selector:".product-info",name:"more_details",handler:this.__moreDetails.bind(this)},{type:"click",selector:".add-to-cart-btn",name:"add_to_cart",handler:this.__addToCart.bind(this)},{type:"click",selector:".in-cart-btn",name:"in_cart_button",handler:function(a){a.preventDefault()}}]},initialize:function(a){var c=this;this.__loginManager=a.loginManager;var e=!!this.__loginManager.getCurrent();this.__myCID=0;e&&(this.__myself=this.__loginManager.getCurrentUser(),this.__myCID=this.__myself.get("legacy_cid"));this.template=a.template||g.template;this.uiAttributes={repeats:1};this.__touchEventHelper=a.touchEventHelper;b.prototype.initialize.call(this,a);this.__serviceProvider=a.serviceProvider;this.dressUpAvatarManager=IMVU.optionalProperty(a,"dressUpAvatarManager",null);this.__category=IMVU.optionalProperty(a,"category",!1);this.__filterModel=this.__serviceProvider.create(g.Model.FilterModel,[],{});this.__cardManager=a.cardManager;this.__globalStringManager=a.globalStringManager;this.undoRedo=a.undoRedo;this.imageHeight=a.imageHeight?a.imageHeight:null;this.imageWidth=a.imageWidth?a.imageWidth:null;this.__productImageManager=a.productImageManager;this.__model=a.model;this.__hideMoreInforCTA=a.hideMoreInforCTA;this.__window=a.window;this.__taxonomyLocation=this.__taxonomyEventClass=this.__taxonomyEvent=null;try{this.__mode=this.__serviceProvider.get("mode")}catch(d){}this.addToDOM();this.__featureAccessManager.canSeeRoomDeco2()&&this.$el.attr("draggable",!0);this.__addRenderGatingPromise(this.__model.populated());this.__model.populated().then(function(){void 0!==c.__model.node?(c.productNode=c.__model.node,c.__loadLook()):c.productNode=c.__model;if(c.__isHiddenBundle())c.$el.addClass("hidden");else{var d=c.__getDetails(),h=!1,f=c.__myself&&c.__myself.get("is_ap");if(void 0!==d.category_path)for(var k=0;k<d.category_path.length;k++)h=3102===d.category_path[k].id&&f?!0:!1;h=h?d.product_image:d.previewImage;c.$el.html(c.template(d));c.setImage(h);c.$el.attr("product-id",c.productId);c.$el.attr("cid",c.productNode.cid);c.$el.toggleClass("cannot-remove",!c.__isRemovable());c.$el.removeClass("sorting");c.dressUpAvatarManager&&(c.__updateWearingStatus(),c.dressUpAvatarManager.getLookModel().on("change",c.__updateWearingStatus,c));c.__hideMoreInforCTA&&c.$(".more-info").hide();d=c.createChildContext(g.ProductStatusShields,{$replaceElement:c.$el.find(".shields-placeholder"),model:c.model,showBack:!0});c.__addRenderGatingPromise(d.getHasRenderedPromise());d=c.createChildContext(g.DistinguishStatus,{$replaceElement:c.$el.find(".distinguish-placeholder"),model:c.model,position:"end-start small"});c.__addRenderGatingPromise(d.getHasRenderedPromise());c.__waitOnRenderGatingPromises()}}).catch(function(d){c.$el.hide()});void 0!==this.__model.sorted&&(this.__model.sorted()||this.$el.addClass("sorting"));this.$el.addClass("loading")},__stopObserving:function(){this.__productTileObserver&&(this.__productTileObserver.unobserve(this.$el[0]),this.__productTileObserver.disconnect(),this.__productTileObserver=null)},delete:function(){this.dressUpAvatarManager&&this.dressUpAvatarManager.getLookModel().off(null,null,this);this.__stopObserving();b.prototype.delete.call(this)},__isHiddenBundle:function(){return this.productNode.get("is_bundle")&&this.__hideBundles&&!this.productNode.get("look_url")},__loadLook:function(){this.dressUpAvatarManager&&this.productNode.populated().then(function(){this.priorLook=this.dressUpAvatarManager.getOriginalLook();this.outfitLookUrl=this.__getDetails().lookUrl}.bind(this)).catch(this.__kill.bind(this))},__kill:function(){this.collection.remove(this.productNode)},__reportObserved:function(){null!==this.__taxonomyEvent&&null!==this.__taxonomyEventClass&&null!==this.__taxonomyLocation&&this.recordProductTaxonomyEvent(this.__model,{event:this.__taxonomyEvent,eventClass:this.__taxonomyEventClass,eventReason:"show",location:this.__taxonomyLocation,status:"success",systemError:null});this.__stopObserving()},__handleIntersection:function(a){var c=this;a.map(function(e){e.isIntersecting&&c.__reportObserved()})},render:function(){this.$el.html(this.template);this.__productTileObserver=new IntersectionObserver(this.__handleIntersection.bind(this),{threshold:1,trackVisibility:!0,delay:100});this.__productTileObserver.observe(this.$el[0]);var a=this.__productTileObserver.takeRecords();0<a.length&&a[0].isIntersecting&&this.__reportObserved()},__isRemovable:function(){return"outfits"!==this.__category},__handleRemoveButton:function(){this.isWearing()&&this.__toggleProduct(!1);this.__kill()},tuneFidelity:function(a){if(a.endsWith("?height=150&width=150")){var c=150*window.devicePixelRatio;a=a.substring(0,a.length-21)+("?height="+c+"&width="+c)}return a},setImage:function(a){"wishlist"!==this.__category&&"wearing"!==this.__category||!this.model.node||(this.__filterModel.setCategoryByProduct(this.model.node),this.__category=this.__filterModel.get("category"));var c=this.__serviceProvider.get("rest");this.__category&&this.__category.includes("all")&&this.productNode&&(this.__filterModel.setCategoryByProduct(this.productNode),this.__category=this.__filterModel.get("category"));if(this.imageHeight&&this.imageWidth){var e=this.imageWidth*window.devicePixelRatio,d=this.imageHeight*window.devicePixelRatio;a=IMVU.URI.build(a,{width:e,height:d});this.__category.includes("furniture")&&this.productNode.get("preview_image_supports_no_redirect")?(a=IMVU.URI.build(a,{width:e,height:d,no_redirect:1}),c.get(a).then(function(h){h=this.__productImageManager.getProductImage(this.$("img"),h.response.data.ssr_url,this.__category,this.$el,this.$(".cover-image-placeholder"));this.__addRenderGatingPromise(h)}.bind(this))):(a=this.__productImageManager.getProductImage(this.$("img"),this.tuneFidelity(a),this.__category,this.$el,this.$(".cover-image-placeholder")),this.__addRenderGatingPromise(a))}else a=this.__productImageManager.getProductImage(this.$("img"),this.tuneFidelity(a),this.__category,this.$el,this.$(".cover-image-placeholder")),this.__addRenderGatingPromise(a)},isWearing:function(){return this.dressUpAvatarManager.isWearing(this.productNode.id)?!0:this.outfitLookUrl?this.dressUpAvatarManager.getCurrentLookUrl()===this.outfitLookUrl:!1},__updateWearingStatus:function(){this.$el.toggleClass("is-wearing",this.isWearing())},__onTileClick:function(){if(!this.dressUpAvatarManager)this.__moreDetails();else if(this.$el.hasClass("loaded")||this.$el.hasClass("error"))this.isWearing()?this.__isRemovable()&&this.__toggleProduct(!1):this.__toggleProduct(!0)},__moreDetails:function(a){this.productNode.isPopulated()&&!this.__getDetails().is_bundle&&(this.__serviceProvider.has("mode")&&"__id__"===this.__mode.getCurrentSubmode().subId()?(a=this.__mode.getSubmodeUrl(this.__urlId(this.model.id)),this.__window.open(a,a)):this.__dialogManager.showLightbox("ProductLightbox",{model:this.productNode}))},toggleProduct:function(a){this.__toggleProduct(a)},__toggleProduct:function(a){this.$el.addClass("applying");this.trigger("startWearing");this.trigger(a?"applyProduct":"removeProduct",this.productNode.id);var c=function(){f&&f!=this.dressUpAvatarManager.getLookModel().get("look_url")&&this.undoRedo.add({look:f});this.$el.removeClass("applying");this.trigger("doneWearing")}.bind(this),e=function(){this.outfitLookUrl=this.dressUpAvatarManager.getCurrentLookUrl();d();this.trigger("doneWearing",this.productNode)}.bind(this),d=function(){f&&f!=this.dressUpAvatarManager.getLookModel().get("look_url")&&this.undoRedo.add({look:f});this.__updateWearingStatus();this.$el.removeClass("applying")}.bind(this),h=function(){this.$el.removeClass("applying");this.trigger("abortWearing")}.bind(this),f=this.dressUpAvatarManager.getLookModel().get("look_url");!0===this.__getDetails().is_bundle?a?(this.priorLook=this.dressUpAvatarManager.getCurrentLookUrl(),this.dressUpAvatarManager.putOnOutfit(this.productNode.id,this.outfitLookUrl).then(e).catch(h)):this.dressUpAvatarManager.putOnOutfit(null,this.dressUpAvatarManager.getOriginalLook()).then(d).catch(h):this.dressUpAvatarManager[a?"add":"remove"].bind(this.dressUpAvatarManager)(this.productNode.id).then(c).catch(h)},__getDetails:function(){return{name:this.productNode.get("product_name"),creatorName:this.productNode.get("creator_name"),previewImage:this.productNode.get("preview_image"),isAp:"AP"===this.productNode.get("rating"),isNFT:this.__featureAccessManager.canSeeNFT()&&this.productNode.get("is_nft"),isNFTAndAP:this.__featureAccessManager.canSeeNFT()&&this.productNode.get("is_nft")&&"AP"===this.productNode.get("rating"),lookUrl:this.productNode.get("look_url"),showInfo:!0,showProductInfo:!1,removeButton:!1,category_path:this.productNode.get("category_path"),product_image:this.productNode.get("product_image")}},__addToCart:function(){this.$el.hasClass("in-cart")||(this.$el.addClass("in-cart"),this.__serviceProvider.get("globalNav").addProductsToCart([this.productNode]).catch(function(){this.$el.removeClass("in-cart")}.bind(this)))}})}({Model:l["@Model"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],DistinguishStatus:w,ProductStatusShields:da,UIContextExtension:Q,template:eb}),ib=function(g){var b=g.ProductTile;return b.extend("ShoppingTile",{className:"tile product-tile shopping-tile",dependencies:["featureAccessManager","loginManager","onboardingGamificationManager"],initialize:function(a){a.productNode=a.model;a.inView=!0;a.loginManager.isLoggedIn()&&(this.__myself=a.loginManager.getCurrentUser(),this.__isVip=!!this.__myself.get("is_vip"));this.__formatNumber=g.FormatNumber;this.__hideBundles=IMVU.optionalProperty(a,"hideBundles",!0);this.__showAdminToolsSelection=IMVU.optionalProperty(a,"showAdminToolsSelection",!1);b.prototype.initialize.call(this,a);this.__model.populated().then(function(){!this.productNode.get("is_bundle")||this.__isHiddenBundle()||this.productNode.get("is_owned")?this.__updateOwnedOrPurchasableDisplay():(this.__subproducts=this.productNode.getEdgeCollection("subproducts",g.Model.ProductEdgeCollection),this.__subproducts.populated().then(function(){this.__updateOwnedOrPurchasableDisplay();this.listenTo(this.__subproducts,"change:is_owned",this.__updateOwnedOrPurchasableDisplay.bind(this))}.bind(this)).catch(this.__updateOwnedOrPurchasableDisplay.bind(this)));this.listenTo(this.productNode,"change:is_owned",this.__updateOwnedOrPurchasableDisplay,this);this.listenTo(this.productNode,"change:is_purchasable",this.__updateOwnedOrPurchasableDisplay,this)}.bind(this));a.loginManager.isLoggedIn()&&(this.__cartModel=this.track(this.__myself.getSingleEdge("cart")),this.__cartModel.populated().then(function(){this.__cartProducts=this.__cartModel.getEdgeCollection("products",g.Model.CartProductCollection);return this.__cartProducts.enumerated()}.bind(this)).then(function(c){this.__cartAvailable=!0;this.__updateCartButton();this.listenTo(this.__cartProducts,"add remove",this.__updateCartButton.bind(this))}.bind(this)));this.__taxonomyEvent="product_tile_view";this.__taxonomyLocation=this.__taxonomyEventClass="shop"},render:function(){b.prototype.render.call(this);this.__showAdminToolsSelection&&this.$el.addClass("admin-select-view")},delete:function(){this.productNode&&this.productNode.off(null,null,this);b.prototype.delete.call(this)},__onTileClick:function(){this.__showAdminToolsSelection?(this.$el.toggleClass("is-selected"),this.trigger("selectProduct",this.productNode)):b.prototype.__onTileClick.call(this)},__moreDetails:function(){this.__featureAccessManager.canSeeOnboardingGamification()&&1===this.__onboardingGamificationManager.getModeStep("shop")&&!this.__featureAccessManager.isMobile()&&this.__onboardingGamificationManager.setModeStep("shop",2);b.prototype.__moreDetails.call(this)},__updateOwnedOrPurchasableDisplay:function(){this.$el.toggleClass("owned",this.productNode.get("is_owned")||!(!this.__subproducts||!this.__subproducts.get("is_owned")));this.$el.toggleClass("displayonly",!this.productNode.get("is_purchasable"));this.__cartAvailable&&this.__updateCartButton()},__updateCartButton:function(){this.model.populated().then(function(){return this.__cartProducts.checkCartContains(this.productNode.id)}.bind(this)).then(function(a){this.$el.toggleClass("in-cart",a)}.bind(this))},__getDetails:function(){var a=this.__isVip?this.productNode.get("discount_price"):this.productNode.get("product_price");return _.extend(b.prototype.__getDetails.call(this),{showProductInfo:!0,showName:!0,showPriceInfo:!0,showCart:!0,originalPrice:this.productNode.get("product_price"),discountPrice:this.productNode.get("discount_price"),price:this.__formatNumber.formatCredits(Number(a)),isOutfit:this.productNode.get("is_bundle"),isVisible:this.productNode.get("is_visible"),gender:this.productNode.get("gender"),showAdminToolsSelection:this.__showAdminToolsSelection})}})}({Model:l["@Model"],UiCore:l["@UiCore"],FormatNumber:r,ProductTile:hb}),R=function(g){var b=g.UiCore.UiContext;return b.extend("SubproductList",{className:"subproduct-list",uiContextName:"subproduct_list",dependencies:[],CATEGORY_ORDER:"tops bottoms shoes accessories hairstyles eyes skins skin heads avatars".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){var a=this.__serviceProvider.create(g.Model.FilterModel,[],{}),c=_.sortBy(this.collection.models,function(e){if(e.node&&e.node.isPopulated())return a.setCategoryByProduct(e.node),this.CATEGORY_ORDER.indexOf(a.get("category"))}.bind(this));_.each(c,function(e,d){this.createChildContext(g.ShoppingTile,{model:e,$parentElement:this.$el})}.bind(this))}})}({Model:l["@Model"],UiCore:l["@UiCore"],ShoppingTile:ib}),jb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=this.escapeExpression;c=a.helperMissing;h="<div class='title'>\n    <h2 class='body-heading'>"+h((d=a.title||b&&b.title,"function"===typeof d?d.call(b,{name:"title",hash:{},data:e}):d))+"</h2>\n    <div class='toggle'>\n        ";if((a=(d=a.icon||b&&b.icon||c,d.call(b,"icon-page-right",{name:"icon",hash:{class:"wh-15 block"},data:e})))||0===a)h+=a;return h+"\n    </div>\n</div>\n<div class='content-wrapper'>\n    <div class='content'></div>\n</div>"},useData:!0})}({}),B=function(g){var b=g.UiCore.UiContext;return b.extend("AccordionSection",{className:"accordion-section",uiContextName:"accordion_section",trackedEvents:function(){return[{type:"click",selector:".title",name:"toggle",handler:"__toggle"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__title=IMVU.requireProperty(a,"title");this.__dynamicHeight=IMVU.optionalProperty(a,"dynamicHeight",!1);a.specialClass&&this.$el.addClass(a.specialClass);a.startOpen&&this.$el.addClass("open");this.addToDOM()},render:function(){this.$el.html(g.template({title:this.__title}));this.__setAsRendered()},__expandForContent:function(){this.__dynamicHeight||this.$(".content-wrapper").height(this.$(".content").outerHeight(!0))},__collapseContent:function(){this.__dynamicHeight||this.$(".content-wrapper").height(0)},__toggle:function(){this.$el.hasClass("open")?(this.__collapseContent(),this.$el.removeClass("open")):(this.__expandForContent(),this.$el.addClass("open"))},addWidget:function(a,c){this.__widget=this.createChildContext(a,_.extend({$parentElement:this.$(".content")},c));this.$el.hasClass("open")&&this.__expandForContent();return this.__widget},updateTitle:function(a){this.$(".title .body-heading").text(a)},setLockedRoomsList:function(a){this.__widget.setLockedRoomsList(a)}})}({UiCore:l["@UiCore"],template:jb}),kb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="lightbox">\n    <div class="main-container"></div>\n    <div class="lightbox-sidebar">\n        <div class="sidebar-content">\n            <div class="shields-placeholder"></div>\n            <div class="headpiece">\n                <div class="widgets"></div>\n                <div class="sticky-container-wrap"></div>\n            </div>\n            <div class="sidebar-panels"></div>\n            <div class="panel-footers"></div>\n        </div>\n    </div>\n    <div class=\'mobile-overlay\'>\n        <div class=\'panel-footers\'></div>\n    </div>\n</div>\n'},useData:!0})}({}),lb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'\n            <button class="btn ap ap-badge"></button>\n        '},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h="<div class=\"main-info\">\n    <div class='picture tile-body placeholder-container'>\n        ",f=a["if"].call(b,b&&b.isAP,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)h+=f;return h+"\n        <img/>\n        <div class=\"cover-image-placeholder hidden\"></div>\n    </div>\n    <div class='text'>\n        <div class='primary-text'>"+c((d=a.headerText||b&&b.headerText,"function"===typeof d?d.call(b,{name:"headerText",hash:{},data:e}):d))+"</div>\n        <div class='secondary-text is-truncated'>"+c((d=a.secondaryText||b&&b.secondaryText,"function"===typeof d?d.call(b,{name:"secondaryText",hash:{},data:e}):d))+"<span class='name'>"+c((d=a.secondaryUsername||b&&b.secondaryUsername,"function"===typeof d?d.call(b,{name:"secondaryUsername",hash:{},data:e}):d))+"</span></div>\n    </div>\n</div>\n"},useData:!0})}({}),mb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<div class="nft-status-badge-container">';if((a=(d=a.icon||b&&b.icon||h,d.call(b,"icon-nft",{name:"icon",hash:{},data:e})))||0===a)c+=a;return c+"</div>"},useData:!0})}({}),ea=function(g){var b=g.UiCore.UiContext;return b.extend("NFTStatusBadge",{className:"nft-status-badge",uiContextName:"nft_status_badge",dependencies:["featureAccessManager","model"],initialize:function(a){b.prototype.initialize.call(this,a);this.__position=a.position?a.position:"offset-10";this.addToDOM()},render:function(){var a=this;this.__model&&this.doWork([function(){return a.__model.populated()},function(){var c=a.__model.node?a.__model.node:a.__model,e=a.__featureAccessManager.canSeeNFT();c=c.get("is_nft");e&&c&&(a.$el.html(g.template({})),a.$(".nft-status-badge-container").addClass(a.__position))}])}})}({Model:l["@Model"],UiCore:l["@UiCore"],template:mb}),z=function(g){var b=g.UiCore.UiContext;return b.extend("StandardHeadpiece",{className:"standard-headpiece",uiContextName:"standard_headpiece",dependencies:["featureAccessManager","iconManager","imageManager","productImageManager"],initialize:function(a){b.prototype.initialize.call(this,a);this.__info=a.info;this.__category=a.category;this.__productImageManager=a.productImageManager;this.__model=a.model;this.addToDOM()},render:function(){var a=this;this.doWork([function(){a.$el.html(g.template(a.__info));a.__productImageManager.getProductImage(a.$(".picture img"),a.__info.imageUrl,a.__category,a.$el,a.$(".cover-image-placeholder"))},function(){return a.__model?a.__model.populated():new Promise(function(c){return c.resolve(!1)})},function(){a.createChildContext(g.DistinguishStatus,{$parentElement:a.$(".picture"),model:a.__model,position:"small start-end"});a.__featureAccessManager.canSeeNFT()&&a.createChildContext(g.NFTStatusBadge,{$parentElement:a.$(".picture"),model:a.__model,position:"offset-5"})}])}})}({UiCore:l["@UiCore"],DistinguishStatus:w,NFTStatusBadge:ea,template:lb}),nb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'<div class="scroller"></div>'},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;c='<div class="panel-container" data-panel="'+c((d=a.panelName||b&&b.panelName,"function"===typeof d?d.call(b,{name:"panelName",hash:{},data:e}):d))+'">';if((b=a.unless.call(b,b&&b.isFooter,{name:"unless",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)c+=b;return c+"</div>\n"},useData:!0})}({}),ob=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=this.escapeExpression;c='\n    <button class="btn btn-ghost btn-dark main">'+c((d=a.ctaSecondary||b&&b.ctaSecondary,"function"===typeof d?d.call(b,{name:"ctaSecondary",hash:{},data:e}):d))+"</button>\n    ";if((b=a["if"].call(b,b&&b.shopLightbox,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===b)c+=b;return c+"\n"},2:function(b,a,c,e){var d,h=a.helperMissing;c='\n        <button class="btn btn-ghost btn-dark in-cart disabled hidden">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"in_cart",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</button>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h="",f=a["if"].call(b,b&&b.ctaSecondary,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)h+=f;return h+'\n<button class="btn btn-primary btn-dark">'+c((d=a.ctaPrimary||b&&b.ctaPrimary,"function"===typeof d?d.call(b,{name:"ctaPrimary",hash:{},data:e}):d))+"</button>\n"},useData:!0})}({}),fa=function(g){var b=g.UiCore.UiContext;return b.extend("LightboxButtons",{className:"buttons lightbox-buttons",uiContextName:"lightbox_buttons",dependencies:[],trackedEvents:function(){return[{type:"click",selector:".btn-ghost:not(.in-cart)",name:"cta_secondary",handler:this.__onclickSecondary.bind(this)},{type:"click",selector:".btn-primary",name:"cta_primary",handler:this.__onclickPrimary.bind(this)}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__buttons=IMVU.requireProperty(a,"buttons");this.addToDOM()},render:function(){this.$el.html(g.template(this.__buttons))},__onclickPrimary:function(){this.trigger("lightboxButton:ctaPrimary")},__onclickSecondary:function(){this.trigger("lightboxButton:ctaSecondary")},_triggerButton:function(a){a?this.__onclickPrimary():this.__onclickSecondary()}})}({UiCore:l["@UiCore"],template:ob}),pb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="sticky-content disable-text-selection">\n    <div class="buttons" />\n    <div class="nav-container">\n       <ul class="nav center-nav" />\n       <div class="magic-line" />\n    </div>\n    <div class="simple-scroller-placeholder"></div>\n</div>\n'},useData:!0})}({}),ha=function(g){var b=g.UiCore.UiContext;return b.extend("StickyContainer",{uiContextName:"sticky_container",className:"sticky-container",dependencies:[],trackedEvents:function(){return[{type:"click",selector:".center-nav > li",name:"panel",handler:this.__onclickPanelNav.bind(this),attributes:function(a){return{which:a.attr("data-btn")}}}]},initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){this.$el.html(g.template);this.__setAsRendered()},addElementToCenterNav:function(a){this.$(".center-nav").append(a)},setMagicLine:function(a){(a=a||this.$(".center-nav li:first"))&&a.position()&&this.$(".nav-container .magic-line").show().css({"margin-left":a.position().left+"px",width:a.outerWidth()})},__onclickPanelNav:function(a){(a=$(a.currentTarget).attr("data-btn"))&&this.trigger("panelclick",a)}})}({UiCore:l["@UiCore"],template:pb}),v=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("LightboxDialog",{uiContextName:"lightbox_dialog",className:"lightbox-dialog",dependencies:["featureAccessManager","globalStringManager","platform","window"],initialize:function(a){b.prototype.initialize.call(this,a);("desktop"===this.__platform||this.__featureAccessManager.isElectronClient())&&this.hideHeader();this.__panels={};this.addToDOM()},postRender:function(){var a=this;this.doWork([function(){a.setContent("body",g.template);a.__addStickyContainer();a.refreshSize();$(a.__window).on("resize.lightboxDialog"+a.cid,a.refreshSize.bind(a));"mobile"===a.__platform&&(a.$(".sidebar-content").scroll(a.__onMobileScroll.bind(a)),a.$(".lightbox-sidebar").scroll(a.__onMobileScroll.bind(a)),a.$(".lightbox-sidebar").on("click",a.__onMobileSidebarClick.bind(a)))}])},delete:function(){$(this.__window).off("resize.lightboxDialog"+this.cid);b.prototype.delete.call(this)},addWidgetToMainContainer:function(a,c){this.hideHeader();a=this.createChildContext(a,_.extend({$parentElement:this.$(".main-container")},c||{}));this.refreshSize();return a},addStandardHeadpiece:function(a){this.hideHeader();this.createChildContext(g.StandardHeadpiece,{$prependElement:this.$(".headpiece .widgets"),info:a});this.refreshSize()},setHeadpieceButtons:function(a){this.hideHeader();this.__ctaButtons=this.createChildContext(g.LightboxButtons,{$replaceElement:this.__stickyContainer.$(".buttons"),buttons:a});this.listenTo(this.__ctaButtons,"lightboxButton:ctaPrimary",this.__onclickPrimary.bind(this));this.listenTo(this.__ctaButtons,"lightboxButton:ctaSecondary",this.__onclickSecondary.bind(this));this.$(".headpiece").addClass("has-buttons")},removeHeadpieceButtons:function(){this.__ctaButtons&&(this.stopListening(this.__ctaButtons),this.__ctaButtons.delete(),delete this.__ctaButtons,this.$(".headpiece").removeClass("has-buttons"))},addWidgetToHeadpiece:function(a,c,e){this.hideHeader();a=this.createChildContext(a,_.extend({$parentElement:this.$(".headpiece .widgets")},c||{}));this.refreshSize();return a},__addStickyContainer:function(){_.has(this,"__stickyContainer")||(this.__stickyContainer=this.createChildContext(g.StickyContainer,{$parentElement:this.$(".headpiece .sticky-container-wrap")}),this.listenTo(this.__stickyContainer,"panelclick",this.__selectPanel.bind(this)),this.refreshSize());return this.__stickyContainer},addFooterToSidebarPanel:function(a,c,e){e=this.__getPanel(e);a=this.createChildContext(a,_.extend({$parentElement:e.$footers},c||{}));"mobile"===this.__platform&&e.$widgets.css({"margin-bottom":e.$footers.height()});this.refreshSize();return a},addWidgetToSidebarPanel:function(a,c,e){c=c||{};e=this.__getPanel(e,c.addCounter||!1).$widgets.find(".scroller:not(.scroll-wrapper)");a=this.createChildContext(a,_.extend({$parentElement:e,scroller:e},c||{}));"mobile"!==this.__platform&&e.scrollbar();this.refreshSize();return a},__getPanel:function(a,c){a=a||"default";return this.__panels[a]||this.__createPanel(a,c)},setSidebarPanelLoading:function(a,c){c=this.__getPanel(c);c.$widgets.toggleClass("loading",a);c.$footers.toggleClass("loading",a)},__createPanel:function(a,c){var e=0===_.keys(this.__panels).length,d="default"===a?"":this.__globalStringManager.get("lightbox_panel_title_"+a);d=d.substring(0,1).toUpperCase()+d.substring(1);var h="";c&&(h="<span class='counter counter-"+a+"'>0</span> ");switch(a){case"likes":c="<span class='counter-likes-text'>"+d+"</span>";break;case"tags":c="<span class='counter-tags-text'>"+d+"</span>";break;default:c="<span class='counter-comments-text'>"+d+"</span>"}this.__stickyContainer.addElementToCenterNav("<li class='"+(e?"selected active":"")+"' data-btn='"+a+"'>"+h+c+"</li>");this.$(".sidebar-panels").append(g.PanelTemplate({panelName:a}));this.$(("mobile"===this.__platform?".mobile-overlay":".lightbox-sidebar")+" .panel-footers").append(g.PanelTemplate({panelName:a,isFooter:!0}));h=this.$('.sidebar-panels [data-panel="'+a+'"]');c=this.$('.panel-footers [data-panel="'+a+'"]');e?(h.addClass("selected"),c.addClass("selected")):(this.__showPanelNav(),this.__stickyContainer.setMagicLine());this.__panels[a]={$widgets:h,$footers:c};return this.__panels[a]},__showPanelNav:function(){this.hideHeader();this.$(".headpiece").addClass("has-nav");this.$(".nav-container").show()},__selectPanel:function(a){var c=this.$('.nav-container [data-btn="'+a+'"]');g.NextUtil.DomHelper.radioClass(c,"selected active");this.__stickyContainer.setMagicLine(c);this.$(".panel-container").removeClass("selected");a=this.$(".panel-container[data-panel="+a+"]");a.addClass("selected");"mobile"!==this.__platform&&a.find(".scroller").scrollbar()},__sidebarWidth:function(){return"block"===this.$(".lightbox").css("display")?0:this.$(".lightbox-sidebar").width()},__squareSize:function(a){var c=$(this.__window),e=parseInt(this.$(".main-container").css("min-width"),10),d="100%"===this.$el.css("max-width")?c.width():parseInt(this.$el.css("max-width"),10),h=parseInt(this.$(".main-container > :first-child").css("max-width"),10),f=parseInt(this.$el.css("padding-left"),10)+parseInt(this.$el.css("padding-right"),10),k=parseInt(this.$el.css("padding-top"),10)+parseInt(this.$el.css("padding-bottom"),10);k=c.height()-k;a=c.width()-f-a;d&&(a=Math.min(d-f,a));d=Math.max(e,Math.min(k,a));h&&(d=Math.min(Math.max(e,h),d));return d},refreshSize:function(){var a=this.__sidebarWidth();a=this.__squareSize(a);this.$(".main-container").css({width:a,height:this.headerIsVisible?0:a})},__onMobileScroll:function(){var a=this.$(".headpiece .sticky-container-wrap"),c=this.$(".sticky-container"),e=a.offset().top<=this.$(".lightbox").offset().top+this.$(".dialog-header").height();this.$(".dialog-header").toggleClass("non-transparent",e);this.$(".dialog-title").toggleClass("hidden",!e);this.__stickyHeadpieceEnabled?e||(c.detach().appendTo(a),a.css({height:"auto"}),this.__stickyHeadpieceEnabled=!1):e&&(a.css({height:a.height()}),c.detach().appendTo(this.$(".mobile-overlay")),this.__stickyHeadpieceEnabled=!0)},__onMobileSidebarClick:function(a){a=a.pageY-this.$(".lightbox-sidebar").offset().top;var c=this.$(".lightbox-sidebar").scrollTop(),e=parseInt(this.$(".lightbox-sidebar").css("padding-top"),10);a<e-c&&this.$(".main-container > *").trigger("click")},__onclickPrimary:function(a){},__onclickSecondary:function(a){}})}({Dialogs:l["@Dialogs"],NextUtil:l["@NextUtil"],LightboxButtons:fa,StandardHeadpiece:z,StickyContainer:ha,PanelTemplate:nb,template:kb}),qb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="price-info">\n    <div class="owned-label">',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"IN INVENTORY",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='</div>\n</div>\n<div class="icons">\n    <span class="icon more-info" title="';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"more_options",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+'"></span>\n    </div>\n</div>\n'},useData:!0})}({}),t=function(g){var b=g.UiCore.UiContext;return b.extend("ContextMenu",{uiContextName:"context_menu",tagName:"ul",className:"context-menu",trackedEvents:function(){return[{type:"click",selector:"li",name:"context_menu_item",handler:"__chooseMenuItem",attributes:function(a){return{which:a.attr("data-menu-item")}}}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__items=IMVU.requireProperty(a,"items");this.location=IMVU.requireProperty(a,"location");this.mouseMargin=IMVU.optionalProperty(a,"mouseMargin","");this.__showCaret=IMVU.optionalProperty(a,"showCaret",!1);this.__isChatStreamProfileMenu=IMVU.optionalProperty(a,"chatStreamProfile",null);this.__closeOnScroll=void 0!==a.closeOnScroll?a.closeOnScroll:!0;this.addToDOM()},render:function(){_.each(this.__items,function(a){var c=$("<li />");c.attr("data-menu-item",a.name).text(a.text).addClass(a.classNames).toggleClass("divider",!!a.divider);_.has(a,"title")&&_.isString(a.title)&&c.attr("title",a.title);this.$el.append(c)}.bind(this));this.__showCaret&&(this.__isChatStreamProfileMenu?($('<div class="caret"></div>').insertAfter(".context-menu li:first-of-type"),this.$(".caret").css({bottom:82,left:-16})):this.$el.append('<div class="caret"></div>'))},__chooseMenuItem:function(a){var c=$(a.currentTarget).data("menu-item"),e=_.find(this.__items,function(d){return d.name===c}).handler;e&&e.call(this,a);this.trigger("item-chosen")},shouldCloseOnScroll:function(){return!this.__closeOnScroll}})}({UiCore:l["@UiCore"]}),rb=function(g){var b=g.UiCore.UiContext;return b.extend("InventoryOutfitActionBar",{uiContextName:"inventory_outfit_action_bar",className:"inventory-outfit-action-bar",dependencies:["contextMenuManager","dialogManager","globalStringManager","loginManager","restModelFactory"],trackedEvents:function(){return[{type:"click",selector:".more-info",name:"more_info",handler:"__showMoreInfo"}]},initialize:function(a){this.__model=IMVU.requireProperty(a,"model");this.__myself=a.loginManager.getCurrentUser();b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){this.$el.html(g.template({}))},__showMoreInfo:function(a){var c=[{name:"delete_outfit",text:this.__globalStringManager.get("inventory_outfit_lightbox_context_menu_delete_outfit"),handler:this.__deleteOutfit.bind(this)}];this.__contextMenuManager.showMenu(a,g.ContextMenu,{items:c,displayOptions:{right:!0,above:!0}})},__deleteOutfit:function(){this.__model.trigger("delete_outfit")}})}({Model:l["@Model"],UiCore:l["@UiCore"],ContextMenu:t,template:qb}),sb=function(g){var b=IMVU.NamedModel;return b.extend("TriggerListItem",{dependencies:["Promise","rest"],initialize:function(a,c){var e=a.Promise;delete a.Promise;this.__rest=a.rest;delete a.Rest;this.url=a.productId;this.collection=c.collection;b.prototype.initialize.call(this,a);this.__populated=new e(function(d){this.fetch({update:!0,error:d.reject.bind(d)}).then(d.resolve.bind(d),d.resolve.bind(d))}.bind(this))},populated:function(){return this.__populated},sync:function(a,c,e){var d=this;IMVU.requireProperty(e,"success");IMVU.requireProperty(e,"error");return this.__rest.get(this.url,e).then(function(h){e.success(c,h.response,e)}).catch(function(h){d.collection.remove(c);e.error(c,h,e)})},url:function(){return this.url},parse:function(a){return{product_name:a.data.product_name,is_ap:"AP"===a.data.rating}}})}({UiCore:l["@UiCore"]}),C=function(g){var b=IMVU.NamedCollection;return b.extend("TriggerList",{dependencies:["Promise","rest","restModelFactory"],model:g.TriggerListItem,initialize:function(a){b.prototype.initialize.call(this);this.__serviceProvider=a.serviceProvider;this.__rest=a.rest;this.__Promise=a.Promise;this.__products={};this.__tagPromises={};this.__populated=new this.__Promise(function(c){c.resolve()}.bind(this))},populated:function(){return this.__populated},loadTriggers:function(a){var c=null;this.__populated=new this.__Promise(function(e){c=e}.bind(this));this.fetch({url:a,reset:!0,success:function(){this.__Promise.every(_.map(this.models,function(e){return e.populated})).then(c.resolve.bind(c),c.reject.bind(c))}.bind(this),error:c.reject.bind(c)});return this.__populated},sync:function(a,c,e){IMVU.requireProperty(e,"success");IMVU.requireProperty(e,"error");e.withCredentials=!1;return this.__rest.get(e.url,e).then(function(d){e.success(c,d.response,e)}).catch(function(d){e.error(c,d,e)})},triggersForProduct:function(a){return new Backbone.Collection(this.filter(function(c){return a.id===c.get("productId")&&c.get("trigger_name").length}.bind(this)))},parse:function(a,c){var e=this.__Promise,d=this.__rest,h=[],f=this.__serviceProvider.get("root")+"/product/product-";_.each(a.objects,function(k){_.each(k.actions,function(m,n){if("trigger"===m.type&&(n=n.match(/imvu-pid-([0-9]*)(-([0-9]*))*/))&&!(2>n.length)){var q=n[1];q&&_.each(m.description.split(/\s*,\s*/),function(p){if(q!==p){var u=f+q;h.push({id:u+":"+p,productId:u,trigger_name:p,Promise:e,rest:d})}})}})});return h}})}({Model:l["@Model"],UiCore:l["@UiCore"],TriggerListItem:sb}),tb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f="";if((h=(d=a.icon||b&&b.icon||h,d.call(b,"icon-bundle",{name:"icon",hash:{},data:e})))||0===h)f+=h;return f+"\r\n<div class='count'>"+c((d=a.count||b&&b.count,"function"===typeof d?d.call(b,{name:"count",hash:{},data:e}):d))+"</div>"},useData:!0})}({}),A=function(g){var b=g.UiCore.UiContext;return b.extend("BundleCount",{className:"bundle-count",uiContextName:"bundle_count",dependencies:["model"],initialize:function(a){b.prototype.initialize.call(this,a);this.__bundleType=a.bundleType||"subproducts";this.__forceCount=a.forceCount||-1;this.addToDOM()},render:function(){var a=this;0<=this.__forceCount?this.$el.html(g.template({count:this.__forceCount})):this.doWork([function(){return a.__model.populated()},function(){return a.__model.getEdgeCollection(a.__bundleType,g.Model.ProductEdgeCollection).enumerated()},function(c){a.$el.html(g.template({count:c.length}));a.__setAsRendered()}])}})}({Model:l["@Model"],UiCore:l["@UiCore"],template:tb}),ub=function(g){var b=g.StandardHeadpiece;return b.extend("InventoryOutfitHeadpiece",{className:"inventory-outfit-headpiece standard-headpiece",uiContextName:"inventory_outfit_headpiece",dependencies:["globalStringManager","loginManager","model"],initialize:function(a){this.__myself=a.loginManager.getCurrentUser();this.model=a.model;this.model.populated().then(function(){a.info={imageUrl:this.model.get("outfit_image"),headerText:this.model.get("outfit_name"),isAP:"AP"===this.model.get("rating")};b.prototype.initialize.call(this,a);this.createChildContext(g.BundleCount,{model:this.model,bundleType:"products",$parentElement:this.$(".tile-body")})}.bind(this)).then(function(){this.createChildContext(g.WAFWidgets.DisplayName,{$replaceElement:this.$(".secondary-text"),user:this.__myself,showVipBadge:!1,size:"small",color:"medium",prefix:this.__globalStringManager.get("by")})}.bind(this))}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],BundleCount:A,StandardHeadpiece:z}),vb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'<button class="btn ap ap-badge"></button>'},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f="<div class='tile-body placeholder-container'>\n    <img class='tile-image' src='"+c((d=a.preview_image||b&&b.preview_image,"function"===typeof d?d.call(b,{name:"preview_image",hash:{},data:e}):d))+'\' />\n    <div class="cover-image-placeholder"></div>\n    ',k=a["if"].call(b,b&&b.is_ap,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+="\n    <div class='name-overlay'>\n        <div class='trigger-name is-truncated'>"+c((d=a.trigger_name||b&&b.trigger_name,"function"===typeof d?d.call(b,{name:"trigger_name",hash:{},data:e}):d))+"</div>\n        ";if((k=(d=a.icon||b&&b.icon||h,d.call(b,"icon-triggers",{name:"icon",hash:{},data:e})))||0===k)f+=k;return f+"\n    </div>\n</div>\n"},useData:!0})}({}),wb=function(g){var b=g.UiCore.UiContext;return b.extend("ActionTile",{className:"lightbox-tile action-tile",uiContextName:"action_tile",dependencies:["productImageManager","restModelFactory","webGL"],trackedEvents:function(){return[{type:"click",selector:".tile-body.playable",name:"play_action",handler:"__playAction"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__imageSize=a.imageSize||140;this.__productNode=a.restModelFactory.readModel(this.model.get("productId"),g.Model.ProductNode);this.__productImageManager=a.productImageManager;this.__filterModel=this.__serviceProvider.create(g.Model.FilterModel,[],{});this.__filterModel.setCategoryByProduct(this.__productNode);this.addToDOM()},render:function(){this.__productNode.populated().then(function(){this.$el.html(g.template({trigger_name:this.model.get("trigger_name"),preview_image:IMVU.URI.build(this.__productNode.get("preview_image"),{width:this.__imageSize,height:this.__imageSize}),is_ap:"GA"!==this.__productNode.get("rating")}));this.__updatePlayable()}.bind(this));this.__productImageManager.getProductImage(this.$("img"),IMVU.URI.build(this.__productNode.get("preview_image"),{width:this.__imageSize,height:this.__imageSize}),this.__filterModel.get("category"),this.$el,this.$(".cover-image-placeholder"))},__updatePlayable:function(){this.$(".tile-body").toggleClass("playable",this.__webGL.use3d())},__playAction:function(){this.trigger("playAction",this.model.get("trigger_name"),this.__productNode)}})}({Model:l["@Model"],UiCore:l["@UiCore"],template:vb}),xb=function(g){var b=g.UiCore.ListPresenter;return b.extend("ActionProduct",{className:"lightbox-tile-list action-product",uiContextName:"action_product",itemFactory:g.ActionTile,dependencies:[],initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){b.prototype.render.call(this)}})}({Model:l["@Model"],UiCore:l["@UiCore"],ActionTile:wb}),D=function(g){var b=g.UiCore.UiContext;return b.extend("ActionProduct",{className:"action-list",uiContextName:"action_list",dependencies:[],initialize:function(a){b.prototype.initialize.call(this,a);this.__productTriggers=a.productTriggers;this.addToDOM()},render:function(){_.each(this.__productTriggers,function(a,c){a.length&&(a=this.createChildContext(g.ActionProduct,{$parentElement:this.$el,collection:a}),this.listenTo(a,"playAction",this.trigger.bind(this,"playAction")))}.bind(this))}})}({UiCore:l["@UiCore"],ActionProduct:xb}),x=function(g){return IMVU.BaseClass.extend("DressUpAvatarManager",_.extend({dependencies:"dialogManager globalStartupModel globalStringManager loginManager Promise rest restModelFactory window".split(" "),initialize:function(b){this.__serviceProvider=b.serviceProvider;this.__Promise=b.Promise;this.dialogManager=b.dialogManager;this.__deleteOnError="undefined"!==typeof b.deleteOnError?b.deleteOnError:null;b.loginManager.isLoggedIn()&&(this.__myself=b.loginManager.getCurrentUser());this.__restModelFactory=b.restModelFactory;this.__lookModelFactory=IMVU.optionalProperty(b,"lookModelFactory",g.Model.LookModel);this.__globalStringManager=b.globalStringManager;this.__globalStartupModel=b.globalStartupModel;this.__rest=b.rest;this.__window=b.window;this.__femalePid=b.femalePid||"80";this.__malePid=b.malePid||"191";this.__persistLooks=IMVU.requireProperty(b,"persistLooks");this.__confirmGenderChange=IMVU.optionalProperty(b,"confirmGenderChange",b.loginManager.isLoggedIn());this.persistentAvatar=null;this.__trackedAdds=[];this.__outfitData={};this.__loadedResolver=null;this.__loadedPromise=new this.__Promise(function(a){this.__loadedResolver=a}.bind(this));this.__globalStartupModel.populated().then(function(){this.outfitUrl=this.__globalStartupModel.get("outfitUrl");this.__baseBodyPatterns={female:this.__globalStartupModel.get("femaleBodyPatternUrl"),male:this.__globalStartupModel.get("maleBodyPatternUrl")}}.bind(this));this.__defaultLooks={};this.__defaultOwnedProducts={};_.has(this,"__myself")?this.__myself.populated().then(function(){return this.__initializeLookModel()}.bind(this)).then(function(){this.__originalLook=this.getCurrentLookUrl();this.__loadedResolver.accept()}.bind(this)).catch(function(a){this.__window.console.log(a);this.__loadedResolver.reject();null!==this.__deleteOnError&&this.__deleteOnError.delete();return this.__getCurrentLookAlert()}.bind(this)):this.__globalStartupModel.populated().then(function(){return this.__initializeLogoutLookModel()}.bind(this)).then(function(){this.__originalLook=this.getCurrentLookUrl();this.__loadedResolver.accept()}.bind(this)).catch(function(a){this.__window.console.log(a);this.__loadedResolver.reject();null!==this.__deleteOnError&&this.__deleteOnError.delete();return this.__getCurrentLookAlert()}.bind(this))},__initializeLogoutLookModel:function(){this.__createLookModel("female");return this.__lookModel.populated()},delete:function(){this.stopListening();this.__lookModel&&this.__lookModel.off(void 0,void 0,this);this.persistentAvatar&&this.persistentAvatar.off(void 0,void 0,this)},populated:function(){return this.__loadedPromise},setChatParticipant:function(b,a){this.chatParticipant=a;this.__lookModel.setChatTypeId(b,this.chatParticipant.deref());return this.__lookModel.fetch()},setShopTogetherParticipant:function(b,a){this.chatParticipant=a;this.__lookModel.setShopTogetherTypeId(b,this.chatParticipant.deref());return this.__lookModel.fetch()},getLiveChatPresenterLookModel:function(b,a){return new this.__Promise(function(c){var e=this.__serviceProvider.create(this.__lookModelFactory,{typeId:"avatar-"+a.userId,persistLooks:!1});e.fetch({add:a.look_products}).then(function(){return c.resolve(e)}.bind(this)).catch(function(d){this.__window.console.log(d);return c.reject()}.bind(this))}.bind(this))},getLookModel:function(){return this.__lookModel},getOriginalLook:function(){return this.__originalLook},addProps:function(b){this.__props=b;return this.populated().then(function(){return this.__updateLookModel([],[],!0)}.bind(this))},__initializeLookModel:function(){return new this.__Promise(function(b){this.persistentAvatar=this.__myself.getSingleEdge("avatar");this.persistentAvatar.populated().then(function(){this.__createLookModel(this.persistentAvatar.id);this.persistentAvatar.on("change",this.__onPersistentAvatarChange,this);return this.__lookModel.populated()}.bind(this)).then(function(){b.resolve()}.bind(this)).catch(function(a){b.reject(a)}.bind(this))}.bind(this))},__createLookModel:function(b){this.__lookModel=this.__serviceProvider.create(this.__lookModelFactory,{typeId:b})},__compareLookURLs:function(b,a){return decodeURIComponent(b.get("look_url"))===decodeURIComponent(a.get("look_url"))},__onPersistentAvatarChange:function(){this.updateOutfitData();if(this.chatParticipant)return this.__Promise.accept();var b=!0;b&&!this.__lookModel&&(b=!1);b&&this.__lookModel.isSyncing()&&(b=!1);b&&!this.persistentAvatar.changed.look_url&&(b=!1);b&&this.__compareLookURLs(this.__lookModel,this.persistentAvatar)&&(b=!1);return(b?this.replaceAllProducts(this.persistentAvatar.get("look_url")):this.__Promise.resolve()).then(function(){return this.__props?this.__updateLookModel([],[],!0):this.__Promise.accept()}.bind(this)).then(function(){this.trigger("change:look_url",this.__lookModel.getLookUrl())}.bind(this))},__persistAvatar:function(){if(!this.__persistLooks)return this.persistentAvatar?this.persistentAvatar.populated():this.__Promise.resolve();if(this.chatParticipant)return this.__persistChatParticipant();var b=this.__lookModel.getLookUrl();return decodeURIComponent(this.persistentAvatar.get("look_url"))===b?this.__Promise.accept():this.persistentAvatar.save({look_url:b})},__persistChatParticipant:function(){var b=this.__lookModel.getLookUrl();return decodeURIComponent(this.chatParticipant.get("look_url"))===b?this.__Promise.accept():this.chatParticipant.save({look_url:b})},__getProductFromPid:function(b){var a=this.__globalStartupModel.get("productEndpoint");return this.__restModelFactory.readModel(a+"/product-"+b,g.Model.ProductNode)},__searchCompatibleModelList:function(b,a,c){var e=this;c=void 0===c?[]:c;if(_.some(b,function(d){return _.contains(a,d.node.get("product_id"))},!1))return this.__Promise.accept(!0);b=_.map(b,function(d){return e.__searchCompatibleModel(a,d.node,c)});return this.__Promise.every(b).then(function(d){d=_.some(d,function(h){return h});return e.__Promise.accept(d)})},__checkParentCompatibility:function(b,a){var c=this;if(_.has(a.relations,"parent")){var e=a.getSingleEdge("parent");return e.populated().then(function(){return c.__Promise.accept(_.contains(b,e.get("product_id")))})}return this.__Promise.accept(!1)},__searchCompatibleModel:function(b,a,c){var e=this;c=void 0===c?[]:c;return _.contains(c,a.get("product_id"))?this.__Promise.accept(!1):a.populated().then(function(){c.push(a.get("product_id"));if(_.has(a.relations,"ancestor_products")){var d=a.getEdgeCollection("ancestor_products",g.Model.ProductEdgeCollection);return d.populated().then(function(){return 0===d.length?e.__checkParentCompatibility(b,a):e.__searchCompatibleModelList(d.models,b,c)})}return e.__checkParentCompatibility(b,a)})},searchCompatibility:function(b,a,c){var e=this;a=void 0===a?null:a;c=void 0===c?null:c;a=a||this.__lookModel.get("products")[0].product_id;var d=this.__getProductFromPid(a);return d.populated().then(function(){if(_.contains(d.get("is"),"avatar")){if(c){var h=_.map(b,function(f){return e.__getProductFromPid(f).populated()});return e.__Promise.every(h).then(function(f){f=_.filter(f,function(k){return k.get("gender")===c});return e.__Promise.accept(_.map(f,function(k){return k.get("product_id")}))})}return e.__Promise.accept(b)}return e.__Promise.reject()}).then(function(h){return _.contains(h,a)||0===b.length?e.__Promise.accept(!0):e.__searchCompatibleModel(h,d,[])},function(){return e.__Promise.accept(!1)})},checkCompatibility:function(b,a){return this.searchCompatibility(b,null,void 0===a?null:a)},checkCompatibilityForPid:function(b,a){var c=this,e=this.__getProductFromPid(b);return e.populated().then(function(){return c.checkCompatibility(e.get("compatible_body_patterns"),a)})},checkOutfitCompatibility:function(b,a,c){var e=this;c=void 0===c?null:c;var d=this.__restModelFactory.readModel(this.outfitUrl+"/outfit-"+b,g.UiCore.NodeModel);return d.populated().then(function(){return d.getEdgeCollection("products",g.Model.ProductEdgeCollection).populated()}).then(function(h){h=h.find(function(f){return _.contains(f.node.get("is"),"avatar")});return e.searchCompatibility(a,h.node.get("product_id"),c)})},checkOutfitCompatibilityForPid:function(b,a,c){a=this.__getProductFromPid(a);return this.checkOutfitCompatibility(b,a.get("compatible_body_patterns"),c)},changeAvatarAndAdd:function(b,a){var c=this;a=void 0===a?null:a;var e=this.__getProductFromPid(b),d;return e.populated().then(function(){if(!a){var h=e.get("compatible_body_patterns");if(0<h.length)a=h[0];else return c.__Promise.reject(Error(c.__globalStringManager.get("DressUpAvatarManager.compatibility.no_compatibility",{newProduct:e.get("product_name")})))}d=c.__getProductFromPid(a);return d.populated()}).then(function(){return c.searchCompatibility(e.get("compatible_body_patterns"),a)}).then(function(h){return h?(c.__myself?h=c.__getDefaultOwnedProducts(d.get("gender")).then(function(f){f[0]=a;f=c.__buildChangeQuery([b],[],f);return c.__lookModel.fetch(f)}):(h=c.__buildChangeQuery([b],[],[a]),h=c.__lookModel.fetch(h)),h.then(function(){c.__setTrackedPids([b],[]);return c.__persistAvatar()}).then(function(){return c.__updateLookModel([],[],!0)})):c.__Promise.reject(Error(c.__globalStringManager.get("DressUpAvatarManager.compatibility.not_compatible",{newProduct:e.get("product_name"),bodyProduct:d.get("product_name")})))})},changeAvatar:function(b){var a=this,c=this.__getProductFromPid(b);return c.populated().then(function(){if(a.__myself)var e=a.__getDefaultOwnedProducts(c.get("gender")).then(function(d){d[0]=b;d=a.__buildChangeQuery([],[],d);return a.__lookModel.fetch(d)});else e=a.__buildChangeQuery([],[],[b]),e=a.__lookModel.fetch(e);return e}).then(function(){a.__setTrackedPids([],[]);return a.__persistAvatar()}).then(function(){return a.__updateLookModel([],[],!0)})},getGender:function(b){return this.__loadedPromise.then(function(){if(this.__lookModel.get("products")&&0!==this.__lookModel.get("products").length)return this.__restModelFactory.readModel(this.__lookModel.get("products")[0].id,g.Model.ProductNode).populated()}.bind(this)).then(function(a){return a?a.get("gender"):a}.bind(this))},getGenderFromPersistentAvatar:function(){return this.persistentAvatar.isPopulated()?this.persistentAvatar.attributes.gender:null},checkGenderMatches:function(b){if(!this.__lookModel.get("products")||!this.__lookModel.get("products").length)return this.__Promise.resolve(!0);var a=this.__restModelFactory.readModel(b,g.Model.ProductNode),c=this.getGender();return this.__Promise.every([a.populated(),c]).then(function(){var e=a.get("gender"),d=a.get("compatible_body_patterns"),h;d&&1<d.length&&this.searchCompatibility(d).then(function(f){h=f}.bind(this));return e?this.__Promise.resolve(h||a.get("gender")===c.result||_.contains(a.get("categories"),"Avatars")):this.__Promise.resolve(!0)}.bind(this))},__getDefaultOwnedProducts:function(b){if(this.__defaultOwnedProducts[b])return this.__Promise.accept(this.__defaultOwnedProducts[b]);this.__defaultLooks[b]=this.__serviceProvider.create(this.__lookModelFactory,{typeId:b});return this.__defaultLooks[b].populated().then(function(){var a=this.__defaultLooks[b].get("products"),c=_.every(a,function(e){return e.owned}.bind(this));this.__defaultOwnedProducts[b]=c?_.pluck(a,"id"):[this.__baseBodyPatterns[b]];return this.__defaultOwnedProducts[b]}.bind(this))},__maybeChangeGenderAndAdd:function(b){var a=this.__restModelFactory.readModel(b,g.Model.ProductNode),c="female"===a.get("gender")?"female":"male";return a.populated().then(function(){return this.__confirmGenderChange?this.dialogManager.confirm({title:this.__globalStringManager.get("dialog_wrong_gender_title"),text:this.__globalStringManager.get("dialog_wrong_gender_text"),yes:this.__globalStringManager.get("dialog_wrong_gender_yes"),no:this.__globalStringManager.get("dialog_wrong_gender_no")}).finished:this.__Promise.accept()}.bind(this)).then(function(){return this.changeGenderAndAdd(c,[b])}.bind(this))},__setTrackedPids:function(b,a){this.__isLiveRoomDressupAvatarManager&&(this.__trackedAdds=this.getCurrentProductsWorn())},__buildChangeQuery:function(b,a,c){var e={};b&&0<b.length&&(c&&0<c.length&&(b=_.difference(b,c)),e.add=b);a&&0<a.length&&(e.remove=a);c&&0<c.length&&(e.baseProductList=c);return e},__updateLookModel:function(b,a,c){b=b||[];a=a||[];this.__props&&(c?b=b.concat(this.__props):a=a.concat(this.__props));if(0===b.length&&0===a.length&&c)return this.__Promise.accept();var e=this.__isLiveRoomDressupAvatarManager?this.__buildChangeQuery(b,a,this.__trackedAdds):this.__buildChangeQuery(b,a);return _.isEmpty(e)?this.__Promise.accept():this.__lookModel.fetch(e).then(function(){c||this.__setTrackedPids(b,a);return this.__Promise.accept()}.bind(this)).catch(function(d){this.__window.console.log(d);this.__setCurrentLookAlert();return this.__Promise.reject(d)}.bind(this))},__addToAvatar:function(b){return this.__updateLookModel(b,[],!1).then(function(){return this.__persistAvatar()}.bind(this)).then(function(){return this.__updateLookModel([],[],!0)}.bind(this))},__removeFromAvatar:function(b){return this.__updateLookModel([],b,!1).then(function(){return this.__persistAvatar()}.bind(this)).then(function(){return this.__updateLookModel([],[],!0)}.bind(this))},changeGenderAndAdd:function(b,a){if(this.__myself)return this.__getDefaultOwnedProducts(b).then(function(c){c=this.__buildChangeGenderQuery(c,a);return this.__lookModel.fetch(c).then(function(){this.__setTrackedPids([],[]);return this.__persistAvatar()}.bind(this)).then(function(){return this.__updateLookModel([],[],!0)}.bind(this)).catch(function(e){this.__window.console.log(e);this.__setCurrentLookAlert();return this.__Promise.reject(e)}.bind(this))}.bind(this));this.__createLookModel(b);return this.__lookModel.populated().then(function(){return this.__addToAvatar(a)}.bind(this))},__buildChangeGenderQuery:function(b,a){this.chatParticipant?(b=b.concat(a),a=this.getCurrentProductsWorn(),b=this.__buildChangeQuery(b,a,[])):b=this.__buildChangeQuery(a,[],b);return b},addProducts:function(b){return this.__addToAvatar(b)},add:function(b){return this.checkGenderMatches(b).then(function(a){return a?this.__addToAvatar([b]):this.__maybeChangeGenderAndAdd(b)}.bind(this)).catch(function(a){return this.__Promise.reject(a)}.bind(this))},addAllSubproducts:function(b){var a=b.getEdgeCollection("subproducts",g.Model.ProductEdgeCollection),c;return a.populated().then(function(){c=a.at(0).node;return this.checkGenderMatches(c.id)}.bind(this)).then(function(e){var d=a.map(function(h){return h.node.id});return e?this.addProducts(d):this.changeGenderAndAdd(c.get("gender"),d)}.bind(this))},remove:function(b){var a=_.isArray(b)?b:[b];this.__lookModel.get("look_url");_.contains(a,this.getCurrentBodyPatternWorn())?(b=_.map(this.persistentAvatar.get("products"),function(c){return this.__restModelFactory.readModel(c.id,g.Model.ProductNode).populated()}.bind(this)),b=this.__Promise.every(b).then(function(c){return(c=_.find(c,function(e){return _.contains(e.get("is"),"body_pattern")}))?1===a.length&&c.id===a[0]?this.__Promise.accept():this.__updateLookModel([c.id],a,!1):this.__removeFromAvatar(a)}.bind(this))):b=this.__removeFromAvatar(a);return b.catch(function(c){return this.__Promise.reject(c)}.bind(this))},removeAllSubproducts:function(b){var a=b.getEdgeCollection("subproducts",g.Model.ProductEdgeCollection);return a.populated().catch(function(){}).then(function(){this.remove(a.map(function(c){return c.node.id}))}.bind(this))},toggleSubproducts:function(b){var a=b.getEdgeCollection("subproducts",g.Model.ProductEdgeCollection);return a.populated().then(function(){var c=a.map(function(e){return e.node.id});_.find(c,function(e){return!this.isWearing(e)}.bind(this))?this.addAllSubproducts(b):this.removeAllSubproducts(b)}.bind(this))},isWearing:function(b){b=b.replace(/\/(\d+)$/,"/product-$1");var a=parseInt(b.match(/\d+$/)[0],10);this.enforceOutfitState();return a===this.__outfitData.id||_.contains(this.getCurrentProductsWorn(!0),b)},getUnowned:function(){var b,a=[];return this.persistentAvatar.populated().then(function(){var c=this.__lookModel.get("products"),e=[];_.each(c,function(d){a.push(d);e.push(d.product_id)}.bind(this));e=e.join();this.__wornOwnedProducts&&this.stopListening(this.__wornOwnedProducts);b=this.__wornOwnedProducts=this.__myself.searchEdgeCollection("inventory",{pids:e},g.Model.ProductEdgeCollection);this.listenTo(this.__wornOwnedProducts,"change:relations",function(){this.trigger("change:ownedWornProducts")});return b.populated()}.bind(this)).then(function(){return _.pluck(_.filter(a,function(c){var e=!1;_.each(b.models,function(d){d=d.node.get("id");d===c.id&&d!==this.__femalePid&&d!==this.__malePid&&(e=!0)}.bind(this));return!e}.bind(this)),"id")}.bind(this))},containsUnowned:function(){return this.persistentAvatar.populated().then(function(){var b=this.__lookModel.get("products");_.each(b,function(a){if(!0!==a.owned)return!1}.bind(this));return!0}.bind(this))},replaceAllProducts:function(b){b=this.__lookModel.getLookPids(b);b=this.__buildChangeQuery([],[],b);return this.__lookModel.fetch(b).then(function(){this.__setTrackedPids([],[]);return this.__Promise.accept()}.bind(this)).catch(function(a){this.__window.console.log("Error updating look",a);this.__setCurrentLookAlert();return this.__Promise.reject(a)}.bind(this))},forceChangeToLookUrl:function(b,a){return a&&this.__persistLooks?this.__lookModel.save({look_url:b}).then(function(){this.updateOutfitData();return this.__Promise.resolve()}.bind(this)).catch(function(c){this.__window.console.log("Error updating look",c);this.__setCurrentLookAlert();return this.__Promise.reject(c)}.bind(this)):this.replaceAllProducts(b)},getOutfitData:function(){return this.__outfitData},updateOutfitData:function(){this.__outfitData!=={}&&this.__outfitData.products&&0!==this.__outfitData.products.length&&!this.isWearingFullOutfit()&&(this.__outfitData={})},isWearingFullOutfit:function(){var b=this.getCurrentProductsWorn(),a=this.__outfitData.products;return _.intersection(b,a).length===b.length&&_.intersection(b,a).length===a.length},enforceOutfitState:function(){this.__outfitData.id&&!this.isWearingFullOutfit()&&(this.__outfitData={})},isWearingOutfit:function(b){return"string"===typeof b&&"string"===typeof this.__outfitData.id&&this.__outfitData.id===b},putOnOutfit:function(b,a){var c=this.__outfitData;return this.forceChangeToLookUrl(a,this.__isLiveRoomDressupAvatarManager?!1:!0).then(function(){this.__outfitData={id:_.isNull(b)?void 0:b,look:a,products:this.getCurrentProductsWorn()};c.look!=a&&this.trigger("change:look_url",a,b);if(!c)this.trigger("change:outfitId",b,null);else if(c.id!=b&&c.products){var e=_.pluck(c.products,"product_id"),d=_.pluck(this.__outfitData.products,"product_id");this.arraysEqual([e,d])&&this.trigger("change:outfitId",b,c.id)}}.bind(this)).catch(function(e){this.__outfitData=c;return this.__Promise.reject(e)}.bind(this))},arraysEqual:function(b){return _.all(b,function(a){return a.length===b[0].length&&0===_.difference(a,b[0]).length})},getCurrentLookUrl:function(){return this.__lookModel.get("look_url")},getCurrentProductsWorn:function(b){b=!!b;return _.chain(this.__lookModel.get("products")).filter(function(a){return b||a.product_id!=this.__femalePid&&a.product_id!=this.__malePid}.bind(this)).pluck("id").value()},getCurrentBodyPatternWorn:function(){return this.getCurrentProductsWorn(!0)[0]},__saveDoneAlert:function(){this.dialogManager.alert({title:this.__globalStringManager.get("dialog_save_profile_done_title"),text:this.__globalStringManager.get("dialog_save_profile_done_text"),ok:this.__globalStringManager.get("dialog_save_profile_done_button")})},__saveErrorAlert:function(){this.dialogManager.alert({title:this.__globalStringManager.get("dialog_save_profile_error_title"),text:this.__globalStringManager.get("dialog_save_profile_error_text"),ok:this.__globalStringManager.get("dialog_save_profile_error_button")})},__setCurrentLookAlert:function(){this.dialogManager.alert({title:this.__globalStringManager.get("dialog_set_current_look_error_title"),text:this.__globalStringManager.get("dialog_set_current_look_error_text"),ok:this.__globalStringManager.get("dialog_set_current_look_error_button")})},__getCurrentLookAlert:function(){this.dialogManager.alert({title:this.__globalStringManager.get("dialog_get_current_look_error_title"),text:this.__globalStringManager.get("dialog_get_current_look_error_text"),ok:this.__globalStringManager.get("dialog_get_current_look_error_button")})},saveCurrentOutfit:function(){return this.containsUnowned().then(function(b){b&&this.__restModelFactory.createModel(this.outfitUrl,g.UiCore.NodeModel,{look_url:this.__lookModel.get("look_url")}).then(function(a){this.putOnOutfit(a.get("id"),a.get("look_url"));this.trigger("change:saveOutfit")}.bind(this)).catch(function(){this.dialogManager.alert({title:this.__globalStringManager.get("dialog_save_outfit_error_title"),text:this.__globalStringManager.get("dialog_save_outfit_error_text"),ok:this.__globalStringManager.get("dialog_save_outfit_error_button")})}.bind(this))}.bind(this))},setProfileLook:function(b,a){var c=this.__restModelFactory.readModel(this.__myself.relations.profile_outfit,g.UiCore.NodeModel);a&&this.__restModelFactory.createModel(this.outfitUrl,g.UiCore.NodeModel,{look_url:this.__lookModel.get("look_url")}).then(function(e){this.trigger("change:saveOutfit")}.bind(this));return c.populated().then(function(){return c.save({look_url:this.__lookModel.get("look_url")})}.bind(this)).then(function(){b||this.__saveDoneAlert()}.bind(this)).catch(this.__saveErrorAlert.bind(this))},containsAPProduct:function(b){b||(b=this.__lookModel.get("products"));var a=!1;b.forEach(function(c){"AP"===c.rating&&(a=!0)});return a},setToLiveRoomDressUpAvatarManager:function(){this.__isLiveRoomDressupAvatarManager=!0;this.__persistLooks=!1}},Backbone.Events))}({Model:l["@Model"],UiCore:l["@UiCore"]}),yb=function(g){var b=g.LightboxDialog;return b.extend("InventoryOutfitLightbox",{uiContextName:"inventory_outfit_lightbox",className:"inventory-outfit-lightbox lightbox-dialog",dependencies:["globalStringManager","loginManager","Promise","sceneManager"],initialize:function(a){b.prototype.initialize.call(this,a);this.__dressUpAvatarManagerFactory=a.dressUpAvatarManagerFactory||g.DressUpAvatarManager;this.__myself=this.track(a.loginManager.getCurrentUser());this.__imageFactory=a.imageFactory;this.__triggerList=this.__serviceProvider.create(a.triggerListFactory||g.TriggerList);this.__dressUpAvatarManager=this.__serviceProvider.create(this.__dressUpAvatarManagerFactory,{persistLooks:!1,confirmGenderChange:!1});this.__sceneManager=a.sceneManager;this.__avCompleteResolver=null;this.__avCompletePromise=new this.__Promise(function(c){this.__avCompleteResolver=c}.bind(this));this.__sidebarCompleteResolver=null;this.__sidebarCompletePromise=new this.__Promise(function(c){this.__sidebarCompleteResolver=c}.bind(this));this.model.populated().then(function(){this.listenTo(this.model,"delete_outfit",this.hide);this.__subproductCollection=this.model.getEdgeCollection("products",g.Model.ProductEdgeCollection);this.__showAvatar()}.bind(this))},__setupHeadpiece:function(){this.addWidgetToHeadpiece(g.InventoryOutfitHeadpiece,{model:this.model});this.actionBar=this.addWidgetToHeadpiece(g.InventoryOutfitActionBar,{model:this.model})},__setupSidebar:function(){this.setSidebarPanelLoading(!0);this.__dressUpAvatarManager.populated().then(function(){return this.__Promise.every([this.__triggerList.loadTriggers(this.__dressUpAvatarManager.getLookModel().get("asset_url")),this.__subproductCollection?this.__subproductCollection.populated().catch(function(){}):this.__Promise.accept()])}.bind(this)).then(function(){var a=this.__subproductCollection?this.__subproductCollection.map(function(d){return this.__triggerList.triggersForProduct(d.node)}.bind(this)):[this.__triggerList.triggersForProduct(this.model)];this.__addAccordionSection(this.__globalStringManager.get("items_in_look",{count:this.__subproductCollection.length}),g.SubproductList,{collection:this.__subproductCollection},!0);var c=_.reduce(a,function(d,h){return d+h.length},0);if(0<c){var e="desktop"===this.__platform;a=this.__addAccordionSection(this.__globalStringManager.get("actions_with_count",{count:c}),g.ActionList,{productTriggers:a},e);this.listenTo(a,"playAction",this.__playAction.bind(this))}this.setSidebarPanelLoading(!1);this.__sidebarCompleteResolver.resolve()}.bind(this))},__addAccordionSection:function(a,c,e,d){return this.addWidgetToSidebarPanel(g.AccordionSection,{title:a,startOpen:!!d}).addWidget(c,e)},__showAvatar:function(){this.__dressUpAvatarManager.populated().then(function(){return this.__dressUpAvatarManager.forceChangeToLookUrl(this.model.get("look_url"))}.bind(this)).then(function(){this.__setupHeadpiece();this.__setupSidebar();this.__sceneArgs={model:this.__dressUpAvatarManager.getLookModel(),imageFactory:this.__imageFactory,sceneContext:"shop_clothing",view:"InventoryOutfitLightbox",context:this,$parentElement:this.$(".main-container")};this.__avatarWidget=this.__sceneManager.initProfileScene(this.__sceneArgs);this.__sceneLoadedPromise=this.__avatarWidget.getSceneLoadedPromise();this.__sceneLoadedPromise.then(function(){this.__avCompleteResolver.resolve()}.bind(this))}.bind(this))},setSidebarPanelLoading:function(a,c){c=this.__getPanel(c);c.$widgets.toggleClass("loading",a);c.$footers.toggleClass("loading",a)},hide:function(){this.__avatarWidget&&this.__avatarWidget.toggleRendering(!1,this.__sceneArgs);b.prototype.hide.call(this)},show:function(){this.__avatarWidget&&this.__avatarWidget.toggleRendering(!0,this.__sceneArgs);b.prototype.show.call(this);this.__Promise.every([this.__avCompletePromise,this.__sidebarCompletePromise]).then(function(){}.bind(this))},delete:function(){this.__dressUpAvatarManager.delete();b.prototype.delete.call(this)},__playAction:function(a){this.__avatarWidget&&this.__avatarWidget.playTriggeredAction(a,this.__sceneArgs)}})}({Model:l["@Model"],AccordionSection:B,ActionList:D,DressUpAvatarManager:x,InventoryOutfitActionBar:rb,InventoryOutfitHeadpiece:ub,LightboxDialog:v,SubproductList:R,TriggerList:C}),zb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h="<div class='cart-empty-content cart-notification'>\r\n    ",f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-empty_cart",{name:"icon",hash:{},data:e}));if(f||0===f)h+=f;h+='\r\n    <span class="description">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"shopping_cart_empty",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</span>\r\n    <button class='btn go-to-shop btn-ghost full-width'>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"go_to_shop",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</button>\r\n</div>\r\n<div class='cart-unavailable-content cart-notification'>\r\n    ";if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-cart_items_unavailable",{name:"icon",hash:{},data:e})))||0===f)h+=f;h+="\r\n    <span class=\"description\"></span>\r\n    <button class='btn dismiss btn-ghost full-width'>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"OK",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</button>\r\n</div>\r\n<div class='cart-error-content cart-notification'>\r\n    ";if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-cart_items_error",{name:"icon",hash:{},data:e})))||0===f)h+=f;h+='\r\n    <span class="description">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"shopping_cart_errors",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</span>\r\n</div>\r\n<ul class='items'>\r\n</ul>"},useData:!0})}({}),Ab=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="cart-item-info">\r\n    <div class="product-placeholder"></div>\r\n    <div class="buttons">\r\n        <div class="more"></div>\r\n        <div class="remove">',f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-trash2",{name:"icon",hash:{},data:e}));if(f||0===f)h+=f;h+='</div>\r\n    </div>\r\n</div>\r\n<div class="expanding-section subproducts">\r\n    <div class="list-container"></div>\r\n    <div class="show">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Show items",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='&nbsp;(<span class="count"></span>)</div>\r\n    <div class="hide">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Hide items",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</div>\r\n</div>\r\n<div class="expanding-section actions">\r\n    <div class="list-container"></div>\r\n    <div class="show">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Show actions",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='&nbsp;(<span class="count"></span>)</div>\r\n    <div class="hide">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Hide actions",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</div>\r\n</div>"},useData:!0})}({}),Bb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'<button class="btn ap ap-badge"></button>'},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c="<div class='tile-body placeholder-container'>\n    <img class='tile-image'/>\n    <div class=\"cover-image-placeholder hidden\"></div>\n    ";if((b=a["if"].call(b,b&&b.is_ap,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)c+=b;return c+"\n    <div class='wearing-indicator'></div>\n</div>\n"},useData:!0})}({}),Cb=function(g){var b=g.UiCore.UiContext;return b.extend("LightboxProductTile",{className:"tile lightbox-tile product-tile lightbox-product-tile",uiContextName:"lightbox_product_tile",dependencies:["dialogManager","featureAccessManager","imageManager","productImageManager","window"],trackedEvents:function(){return[{type:"click",name:"click_tile",handler:"__onClick"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__imageSize=a.imageSize||150;this.__dressUpAvatarManager=IMVU.optionalProperty(a,"dressUpAvatarManager");this.__productImageManager=a.productImageManager;this.__filterModel=this.__serviceProvider.create(g.Model.FilterModel,[],{});this.__filterModel.setCategoryByProduct(this.model);this.__serviceProvider.has("mode")&&(this.__mode=this.__serviceProvider.get("mode"));this.addToDOM()},render:function(){this.model.populated().then(function(){this.$el.addClass("loaded").attr("data-id",this.model.id).html(g.template({is_ap:"GA"!==this.model.get("rating")}));this.__category=this.__filterModel.get("category");this.__productImageManager.getProductImage(this.$(".tile-image"),IMVU.URI.build(this.model.get("preview_image"),{width:this.__imageSize,height:this.__imageSize}),this.__category,this.$el,this.$(".cover-image-placeholder"));this.model.get("is_bundle")&&this.createChildContext(g.BundleCount,{model:this.model,$parentElement:this.$(".tile-body")});this.__dressUpAvatarManager&&this.__dressUpAvatarManager.populated().then(function(){this.__updateWearingStatus();this.listenTo(this.__dressUpAvatarManager.getLookModel(),"change",this.__updateWearingStatus.bind(this))}.bind(this))}.bind(this))},__toggleProduct:function(){this.__dressUpAvatarManager.isWearing(this.model.id)?this.__dressUpAvatarManager.remove(this.model.id):this.__dressUpAvatarManager.add(this.model.id)},__updateWearingStatus:function(){this.$el.toggleClass("is-wearing",this.__dressUpAvatarManager.isWearing(this.model.id))},__onClick:function(){if(this.__dressUpAvatarManager)this.__toggleProduct();else if(this.__serviceProvider.has("mode")){var a=this.__mode.getSubmodeUrl(this.__urlId(this.model.id));this.__window.open(a,a)}else this.__dialogManager.showLightbox("ProductLightbox",{model:this.model})}})}({Model:l["@Model"],UiCore:l["@UiCore"],BundleCount:A,template:Bb}),ia=function(g){var b=g.UiCore.ListPresenter;return b.extend("LightboxProductList",{className:"lightbox-tile-list lightbox-product-list",uiContextName:"lightbox_product_list",itemFactory:g.LightboxProductTile,initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()}})}({Model:l["@Model"],UiCore:l["@UiCore"],LightboxProductTile:Cb}),Db=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'<button class="btn ap ap-badge"></button>'},3:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f='\n        <div class="price-info">\n            <div class=\'price-credits font-medium text-12 flex\'>\n                <div class="wh-15 mr-5">';if((h=(d=a.icon||b&&b.icon||h,d.call(b,"icon-credits",{name:"icon",hash:{class:"wh-full"},data:e})))||0===h)f+=h;return f+'</div>\n                <div class="credits-value">'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</div>\n            </div>\n        </div>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h='<div class="row">\n    <div class="product-img">\n        <img src="'+c((d=a.preview_image||b&&b.preview_image,"function"===typeof d?d.call(b,{name:"preview_image",hash:{},data:e}):d))+'">\n        <div class="cover-image-placeholder hidden"></div>\n        ',f=a["if"].call(b,b&&b.is_ap,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)h+=f;h+='\n        <div class="wearing-indicator"></div>\n    </div>\n    <div class="product-info">\n        <div class="product-name">'+c((d=a.product_name||b&&b.product_name,"function"===typeof d?d.call(b,{name:"product_name",hash:{},data:e}):d))+'</div>\n        <div class="created-by"></div>\n        ';if((f=a.unless.call(b,b&&b.is_owned,{name:"unless",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)h+=f;return h+"\n    </div>\n</div>\n"},useData:!0})}({}),ja=function(g){var b=g.UiCore.UiContext;return g.UiCore.UiContext.extend("ProductRow",{className:"product-row",uiContextName:"product_row",dependencies:["featureAccessManager","globalStringManager","loginManager","productImageManager","Promise"],trackedEvents:function(){return[{type:"click",selector:".row.can-toggle",name:"toggle_product",handler:"__toggleProduct"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__user=this.track(a.loginManager.getCurrentUser());this.__dressUpAvatarManager=IMVU.optionalProperty(a,"dressUpAvatarManager");this.__selectedFurnitureModel=IMVU.optionalProperty(a,"selectedFurnitureModel");this.__undoRedo=IMVU.optionalProperty(a,"undoRedo");this.__filterModel=this.__serviceProvider.create(g.Model.FilterModel,[],{});this.__filterModel.setCategoryByProduct(this.model);this.__productImageManager=a.productImageManager;this.imageWidth=this.imageHeight=75;this.addToDOM()},render:function(){this.model.populated().then(function(){var a=this.model.get("preview_image");this.$el.html(g.template({preview_image:IMVU.URI.build(a,{width:75,height:75}),product_name:this.model.get("product_name"),is_ap:"AP"===this.model.get("rating"),price:g.FormatNumber.formatCredits(this.model.get(this.__user.get("is_vip")?"discount_price":"product_price")),is_owned:!!this.model.get("is_owned")}));this.setImage(a);this.__dressUpAvatarManagerPopPromise=null;this.__dressUpAvatarManager?(this.__dressUpAvatarManagerPopPromise=this.__dressUpAvatarManager.populated(),this.__dressUpAvatarManagerPopPromise.then(function(){this.__updateWearingStatus();this.$(".row").addClass("can-toggle");this.__dressUpAvatarManager&&this.listenTo(this.__dressUpAvatarManager.getLookModel(),"change",this.__updateWearingStatus.bind(this))}.bind(this))):(this.__dressUpAvatarManagerPopResolver=null,this.__dressUpAvatarManagerPopPromise=new this.__Promise(function(c){this.__dressUpAvatarManagerPopResolver=c}.bind(this)),this.__dressUpAvatarManagerPopResolver.resolve());this.__selectedFurnitureModel&&(_.contains(this.model.get("is"),"furniture")||_.contains(this.model.get("is"),"locked_room"))&&this.listenTo(this.__selectedFurnitureModel,"change",this.__updateWearingStatus.bind(this));this.createChildContext(g.DistinguishStatus,{$parentElement:this.$(".product-img"),model:this.model,position:"small end-start"});return this.model.getSingleEdge("creator").populated()}.bind(this)).then(function(a){this.$(".created-by").show();this.__displayName=this.createChildContext(g.WAFWidgets.DisplayName,{$parentElement:this.$(".created-by"),user:a,size:"small",color:"medium",showVipBadge:!1,ignoreClicks:!0,prefix:this.__globalStringManager.get("By")})}.bind(this))},__updateWearingStatus:function(){var a=!1;if(this.__dressUpAvatarManager&&(this.__dressUpAvatarManager.isWearing(this.model.id)&&(a=!0),this.model.get("is_bundle"))){var c=this.model.getEdgeCollection("subproducts",g.Model.ProductEdgeCollection);c.populated().then(function(){var e=c.map(function(d){return d.node.id});_.find(e,function(d){return this.__dressUpAvatarManager.isWearing(d)}.bind(this))&&(a=!0)}.bind(this))}this.__selectedFurnitureModel&&this.model===this.__selectedFurnitureModel.get("product")&&(a=!0);this.$el.toggleClass("is-wearing",a)},__toggleProduct:function(){this.__dressUpAvatarManager&&(this.__undoRedo&&this.__undoRedo.add({look:this.__dressUpAvatarManager.getLookModel().get("look_url"),furniture:this.__selectedFurnitureModel?this.__selectedFurnitureModel.get("product"):null}),this.model.get("is_bundle")&&!_.contains(this.model.get("categories"),"Decorated Rooms")?this.__dressUpAvatarManager.toggleSubproducts(this.model):_.contains(this.model.get("categories"),"Decorated Rooms")||_.contains(this.model.get("is"),"furniture")||_.contains(this.model.get("is"),"locked_room")||_.contains(this.model.get("is"),"furniture_room")?this.__selectedFurnitureModel.get("product")===this.model?this.__selectedFurnitureModel.set("product",null):this.__selectedFurnitureModel.set("product",this.model):this.__dressUpAvatarManager.isWearing(this.model.id)?this.__dressUpAvatarManager.remove(this.model.id):this.__dressUpAvatarManager.add(this.model.id))},setImage:function(a){this.__category=this.__filterModel.get("category");this.imageHeight&&this.imageWidth&&(a=IMVU.URI.build(a,{width:this.imageWidth,height:this.imageHeight}));this.__productImageManager.getProductImage(this.$("img"),a,this.__category,this.$el,this.$(".cover-image-placeholder"))}})}({Model:l["@Model"],UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],DistinguishStatus:w,FormatNumber:r,template:Db}),E=function(g){var b=g.Dialogs.AlloyAlertDialog;return b.extend("ReportUserDialog",{uiContextName:"report_dialog",className:"report-dialog",dependencies:["dialogManager","globalStartupModel","globalStringManager","Promise","restModelFactory"],initialize:function(a){this.__model=a.model;this.__dialogManager=a.dialogManager;this.__restModelFactory=a.restModelFactory;this.__startupModel=a.globalStartupModel;this.__stringManager=a.globalStringManager;this.__promise=a.Promise;this.__safetyReportUrl=this.__startupModel.get("safetyReportUrl");a=_.extend({title:this.__stringManager.get(this.title),text:this.__stringManager.get(this.text),ok:this.__stringManager.get("report_ok_button"),termsOfService:!0,dropdown:{placeholder:this.__stringManager.get("report_reason_placeholder"),options:_.map(this.dropdownOptions,function(c){return{label:this.__stringManager.get(c.label),value:c.value}}.bind(this))}},a);b.prototype.initialize.call(this,a)},__onConfirm:function(){this.$(".btn-primary").prop("disabled",!0);this.hide();this.__confirmDialog();var a=this.getResult();if("audio"===a.dropdown||"youtube_prerecorded"===a.dropdown)this.__hangoutExperience=this.__model.getSingleEdge("hangout_experience"),this.__hangoutExperience.populated().then(function(e){e.getEdgeCollection("media_players",g.UiCore.EdgeCollection).populated().then(function(d){if("audio"===a.dropdown)var h=d.find(function(f){return"vivox"===f.node.attributes["type.provider"]});else"youtube_prerecorded"===a.dropdown&&(h=d.find(function(f){return"youtube"===f.node.attributes["type.provider"]}));c=h.node.id})});else var c=this.__model.id;this.__restModelFactory.createModel(this.__safetyReportUrl,g.UiCore.NodeModel,{reason:a.dropdown,pids:a.pids?a.pids:"",relations:{content:c}}).then(function(){this.promiseResolver.resolve()}.bind(this)).catch(function(e){this.__window.console.log("Something went wrong:",e);this.promiseResolver.resolve()}.bind(this))},hide:function(){this.reasonDropDown.__hide();b.prototype.hide.call(this)},__confirmDialog:function(){return new this.__promise(function(a){var c=this.__dialogManager.alert({title:this.__stringManager.get("report_confirm_title"),text:this.__stringManager.get("report_confirm_text"),ok:this.__stringManager.get("report_confirm_done")}).finished;c.then(function(){a.resolve()});c.catch(function(){a.resolve()})}.bind(this))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"]}),ka=function(g){var b=g.SafetyReportDialog;return b.extend("ReportProductDialog",{uiContextName:"report_product_dialog",className:"report-product-dialog",dependencies:["dialogManager","globalStartupModel","globalStringManager","restModelFactory"],title:"report_product_title",text:"report_product_text",dropdownOptions:[{label:"report_product_reason_inappropriate_content",value:"inappropriate_content"},{label:"report_product_reason_product_not_working",value:"product_not_working"}],postRender:function(){b.prototype.postRender.call(this)}})}({UiCore:l["@UiCore"],SafetyReportDialog:E}),Eb=function(g){var b=g.UiCore.UiContext;return g.UiCore.UiContext.extend("CartProductItem",{className:"cart-product-item",uiContextName:"cart_product_item",tagName:"article",dependencies:"contextMenuManager dialogManager featureAccessManager globalStringManager imageManager loginManager Promise rest".split(" "),trackedEvents:function(){return[{type:"click",selector:".remove",name:"remove_from_cart",handler:"__removeFromCart"},{type:"click",selector:".more",name:"more",handler:"__more"},{type:"click",selector:".actions .show",name:"show_actions",handler:this.__expandSection.bind(this,"actions")},{type:"click",selector:".actions .hide",name:"hide_actions",handler:this.__collapseSection.bind(this,"actions")},{type:"click",selector:".subproducts .show",name:"show_subproducts",handler:this.__expandSection.bind(this,"subproducts")},{type:"click",selector:".subproducts .hide",name:"hide_subproducts",handler:this.__collapseSection.bind(this,"subproducts")}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__myself=this.track(a.loginManager.getCurrentUser());this.__dressUpAvatarManager=IMVU.optionalProperty(a,"dressUpAvatarManager");this.__selectedFurnitureModel=IMVU.optionalProperty(a,"selectedFurnitureModel");this.__undoRedo=IMVU.optionalProperty(a,"undoRedo");this.__triggerListFactory=a.triggerListFactory||g.TriggerList;this.__showExpandingSections=!!a.showExpandingSections;this.__avatarNode=IMVU.optionalProperty(a,"avatarNode");this.addToDOM()},render:function(){this.model.populated().then(function(){this.model.node.get("is_bundle")&&(this.__subproducts=this.model.node.getEdgeCollection("subproducts",g.Model.ProductEdgeCollection));this.$el.attr("data-id",this.model.node.id).html(g.template);this.createChildContext(g.ProductRow,{model:this.model.node,dressUpAvatarManager:this.__dressUpAvatarManager,undoRedo:this.__undoRedo,selectedFurnitureModel:this.__selectedFurnitureModel,$replaceElement:this.$(".product-placeholder")});this.model.node.get("is_bundle")&&this.createChildContext(g.BundleCount,{model:this.model.node,$parentElement:this.$(".product-img")});this.__showExpandingSections&&(this.model.node.get("is_bundle")&&this.__buildSubproductsSection(),this.__buildActionsSection())}.bind(this))},__buildSubproductsSection:function(){this.__subproducts.populated().catch(function(){}).then(function(){this.$(".expanding-section.subproducts").addClass("shown");this.$(".expanding-section.subproducts .count").text(this.__subproducts.length);this.createChildContext(g.LightboxProductList,{collection:new Backbone.Collection(_.pluck(this.__subproducts.models,"node")),$parentElement:this.$(".expanding-section.subproducts .list-container"),dressUpAvatarManager:this.__dressUpAvatarManager})}.bind(this))},__getActionLookUrl:function(){if(this.model.node.get("look_url"))return this.model.node.get("look_url");var a=this.model.node.get("is_bundle")?this.__subproducts.map(function(c){return c.node.id}):[this.model.node.id];return IMVU.URI.build(this.__avatarNode.get("look_url"),{add:a.join(",")})},__buildActionsSection:function(){this.__avatarNode.populated().then(function(){return this.__subproducts?this.__subproducts.populated().catch(function(){}):this.__Promise.accept()}.bind(this)).then(function(){return this.__rest.get(this.__getActionLookUrl())}.bind(this)).then(function(a){a=a.response.data||a.response;this.__triggerList=this.__serviceProvider.create(this.__triggerListFactory);return this.__triggerList.loadTriggers(a.assetURL)}.bind(this)).then(function(){var a=this.__subproducts?_.compact(this.__subproducts.map(function(e){return e.node.isPopulated()?this.__triggerList.triggersForProduct(e.node):null}.bind(this))):[this.__triggerList.triggersForProduct(this.model.node)],c=_.reduce(a,function(e,d){return e+d.length},0);0<c&&(this.$(".expanding-section.actions").addClass("shown"),this.$(".expanding-section.actions .count").text(c),a=this.createChildContext(g.ActionList,{productTriggers:a,$parentElement:this.$(".expanding-section.actions .list-container")}),this.listenTo(a,"playAction",this.trigger.bind(this,"playAction")))}.bind(this))},__removeFromCart:function(){this.__undoRedo&&_.any(this.__subproducts?this.__subproducts.models:[this.model],function(a){if(!a.node)return!1;if(this.__dressUpAvatarManager.isWearing(a.node.id))return!0;if(_.contains(this.model.node.get("is"),"furniture")||_.contains(this.model.node.get("is"),"locked_room")||_.contains(this.model.node.get("is"),"furniture_room")){var c=function(e){if(e.furniture)return e.furniture.id===this.model.node.id}.bind(this);if(this.__undoRedo.historyFind(c))return!0}else if(c=function(e){e=_.last(e.look.split("/")).split(",");return _.contains(e,a.node.get("product_id").toString())}.bind(this),this.__undoRedo.historyFind(c))return!0}.bind(this))&&this.__undoRedo.clearHistory();this.trigger("takeOff",this.model.node);this.model.edge.destroy();this.delete()},__more:function(a){var c=this.model.node.get("is_wished");c=[{name:"buy",divider:!0,text:this.__globalStringManager.get("buy_now_cart"),handler:this.__buy.bind(this)},{name:"wishlist",classNames:c?"disabled":"",text:this.__globalStringManager.get("move_to_wishlist"),handler:this.__moveToWishlist.bind(this)},{name:"report",text:this.__globalStringManager.get("Report"),handler:this.__report.bind(this)}];this.__contextMenuManager.showMenu(a,g.ContextMenu,{items:c,displayOptions:{right:!0}})},__buy:function(){this.trigger("checkout",[this.model.node])},__report:function(){this.__dialogManager.showDialog(g.ReportProductDialog,{model:this.model.node}).finished.then(this.__removeFromCart.bind(this))},__moveToWishlist:function(){this.__myself.getSummaryCollection("wishlist",g.Model.ProductEdgeCollection).create({id:this.model.node.id});this.__removeFromCart()},__expandSection:function(a){this.$(".expanding-section."+a).addClass("expanded");this.__dressUpAvatarManager&&(this.model.node.get("is_bundle")?this.__dressUpAvatarManager.addAllSubproducts(this.model.node):this.__dressUpAvatarManager.add(this.model.node.id))},__collapseSection:function(a){this.$(".expanding-section."+a).removeClass("expanded")}})}({Model:l["@Model"],UiCore:l["@UiCore"],ActionList:D,BundleCount:A,ContextMenu:t,LightboxProductList:ia,ProductRow:ja,ReportProductDialog:ka,TriggerList:C,template:Ab}),Fb=function(g){var b=g.WAFWidgets.EdgeCollectionPresenter;return b.extend("CartProductList",{className:"cart-product-list",uiContextName:"cart_product_list",tagName:"section",itemFactory:g.CartProductItem,dependencies:["globalStringManager","modeManager"],trackedEvents:function(){return[{type:"click",selector:".btn.go-to-shop",name:"go_to_shop",handler:"__goToShop"},{type:"click",selector:".cart-unavailable-content .btn.dismiss",name:"dismiss_unavailable_notification",handler:"__dismissUnavailableNotification"}]},multiGetCollection:function(){this.__multiGetManager.queue(this.collection,this.__multiGetManager.autoRequestPlease);this.collection.hasNextPage()&&this.__multiGetManager.getReact(this.collection.relations.next)},initialize:function(a){a.reverse=!0;b.prototype.initialize.call(this,a)},render:function(){this.multiGetCollection();b.prototype.render.call(this)},renderTemplate:function(){this.$el.html(g.template);this.$itemContainer=this.$(".items");this.__handleAnyErrors();b.prototype.renderTemplate.call(this)},__handleAnyErrors:function(){var a=[],c=[];this.collection.each(function(d){if(d.node&&d.node.isError()){var h=d.node.getError().code;400<=h&&500>h?c.push(d):a.push(d)}else d.isError()&&a.push(d)});_.each(c,function(d){d.edge.destroy()}.bind(this));if(a.length)this.$el.addClass("has-errors");else if(c.length){this.$el.addClass("has-unavailables");var e=1<c.length?"shopping_cart_unavailable_products":"shopping_cart_unavailable_product";this.$(".cart-unavailable-content .description").text(this.__globalStringManager.get(e,{count:c.length}))}},__updateEmpty:function(){this.$el.toggleClass("is-empty",!this.collection.any(function(a){return a.isPopulated()}))},__goToShop:function(){var a=this.__modeManager.getCurrentMode();a&&"shop"===a.id||this.__modeManager.openMode({mode:{id:"shop"}});this.trigger("dismiss")},__dismissUnavailableNotification:function(){this.$el.removeClass("has-unavailables")}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],CartProductItem:Eb,template:zb}),Gb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="wipe-container">\n    <div class="above"></div>\n\n    <div class="wipe-trigger">\n        <div class="crown-icon-wrapper">\n            <svg class="crown-icon" width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M15 5.5a.86.86 0 1 0-1.5.6l-2.4 2.36a.16.16 0 0 1-.27-.05L8.48 3.1a.86.86 0 0 0-.46-1.6.86.86 0 0 0-.47 1.6L5.2 8.4a.16.16 0 0 1-.26.06L2.5 6.06A.86.86 0 1 0 1 5.5c0 .44.34.8.78.85l.76 6.3c.22.5 2.58.9 5.48.9 2.9 0 5.26-.4 5.47-.9l.76-6.3A.86.86 0 0 0 15 5.5"/></svg>\n        </div>\n    </div>\n\n    <div class="below-base">\n        <div class="below-wrapper">\n            <div class="below"></div>\n        </div>\n    </div>\n\n    <div class="wipe"></div>\n</div>'},useData:!0})}({}),Hb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='\n            <div class="needs-credit ',k=a["if"].call(b,b&&b.largeAmount,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+='">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"You need",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="<span>"+h((d=a.amount||b&&b.amount,"function"===typeof d?d.call(b,{name:"amount",hash:{},data:e}):d))+" ";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Credits",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</span>";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"complete_purchase",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+"</div>\n        "},2:function(b,a,c,e){return" large-amount "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c='<div class="products-container">\n    <div class="products">\n        ';if((b=a["if"].call(b,b&&b.showAmount,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)c+=b;return c+'\n    </div>\n    <div class="ppc-redeem-placeholder"></div>\n</div>\n<footer class="dialog-footer">\n</footer>\n'},useData:!0})}({}),Ib=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<legend class="system-info-header">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Credits",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</legend>\n"},useData:!0})}({}),Jb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=this.escapeExpression;return'\n        <div class="promo-banner sale">'+c((d=a.sale_copy||b&&b.sale_copy,"function"===typeof d?d.call(b,{name:"sale_copy",hash:{},data:e}):d))+'<div class="triangle"></div></div>\n    '},3:function(b,a,c,e){var d;c=this.escapeExpression;c='\n    <div class="item-info">\n        <div class="image-container"><span class="helper"></span><img></div>\n    </div>\n    <div class="item-price">\n        <div class="title">'+c((d=a.title||b&&b.title,"function"===typeof d?d.call(b,{name:"title",hash:{},data:e}):d))+"</div>\n        ";if((b=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(4,e),inverse:this.program(6,e),data:e}))||0===b)c+=b;return c+"\n    </div>\n    "},4:function(b,a,c,e){var d;c=this.escapeExpression;return'\n        <div class="prices has-discount">\n            <span class="original-price">$'+c((d=a.original_price||b&&b.original_price,"function"===typeof d?d.call(b,{name:"original_price",hash:{},data:e}):d))+'</span> \n            <span class="sale-price">$'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</span> \n        </div>\n        "},6:function(b,a,c,e){var d;c=this.escapeExpression;return'\n        <div class="prices">\n            $'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"\n        </div>\n        "},8:function(b,a,c,e){var d;c=this.escapeExpression;var h='\n    <div class="item-info">\n        <div class="image-container"><span class="helper"></span><img></div>\n        '+c((d=a.title||b&&b.title,"function"===typeof d?d.call(b,{name:"title",hash:{},data:e}):d))+'\n    </div>\n    <div class="item-price">\n        ',f=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(9,e),inverse:this.noop,data:e});if(f||0===f)h+=f;return h+'\n        <span class="sale-price">$'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</span>\n    </div>\n    "},9:function(b,a,c,e){var d;c=this.escapeExpression;return'\n            <span class="original-price">$'+c((d=a.original_price||b&&b.original_price,"function"===typeof d?d.call(b,{name:"original_price",hash:{},data:e}):d))+"</span> \n        "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c='<div class="wrapper">\n    ';var d=a["if"].call(b,b&&b.is_sale,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(d||0===d)c+=d;c+="\n\n    ";if((d=a["if"].call(b,b&&b.showInDialog,{name:"if",hash:{},fn:this.program(3,e),inverse:this.program(8,e),data:e}))||0===d)c+=d;return c+"\n</div>"},useData:!0})}({}),Kb=function(g){var b=g.UiCore.UiContext;return b.extend("BuyCreditListItem",{uiContextName:"buy_credit_list_item",tagName:"article",className:"buy-credit-list-item",dependencies:"featureAccessManager globalStringManager googleAnalytics imageManager leanplum loginManager model".split(" "),trackedEvents:function(){return[{type:"click",name:"choose_credit_item",handler:"__selectItem"}]},initialize:function(a){this.__selectedCredit=a.selectedCredit;this.__model=a.model;this.__imageManager=a.imageManager;this.__loginManager=a.loginManager;this.__featureAccessManager=a.featureAccessManager;this.__style=IMVU.optionalProperty(a,"style","");this.__bestOption=IMVU.optionalProperty(a,"bestOption",0);this.__isVip=this.__loginManager.getCurrentUser().get("is_vip");this.__isInDialog="in-dialog"===this.__style;this.__isInStore=IMVU.optionalProperty(a,"isInStore",!1);this.__context=IMVU.optionalProperty(a,"context",null);this.__checkedForSelectedItem=!1;this.__percentageOff=IMVU.optionalProperty(a,"percentageOff",void 0);b.prototype.initialize.call(this,a);this.__context&&this.listenTo(this.__context,"refresh_items",this.__refreshProduct);this.addToDOM()},render:function(){b.prototype.render.call(this);this.__model.populated().then(function(){this.__isVipSaleOn=this.__model.edge.get("normal_price")>this.__model.edge.get("sale_price");this.__price=this.__model.edge.get("sale_price");this.__renderTemplate();this.__checkedForSelectedItem=!0}.bind(this))},__selectItem:function(){this.__selectedCredit.set({model:this.__model,name:this.__model.node.get("name"),price:this.__model.edge.get("sale_price"),original_price:this.__model.edge.get("normal_price"),type:"credits",image:this.__model.node.get("img160x160")});this.__isInStore?(this.__leanplum.recordEvent("select_credit_in_store",{sku:this.__model.get("sku"),pid:this.__model.get("pid"),price:this.__price}),this.__googleAnalytics.recordDollarStore("view",this.__model.get("sku")),this.__selectedCredit.trigger("click")):(this.$el.toggleClass("selected-item"),this.$el.hasClass("selected-item")?(g.NextUtil.DomHelper.radioClass(this.$el,"selected-item"),this.__leanplum.recordEvent("select_credit_in_list",{sku:this.__model.get("sku"),pid:this.__model.get("pid"),price:this.__price})):this.__selectedCredit.set({price:0}))},__refreshProduct:function(){this.__model.invalidate();this.render()},__renderTemplate:function(){this.__hasDiscount=this.__model.edge.get("normal_price")>this.__model.edge.get("sale_price");this.$el.html(g.template({has_discount:this.__hasDiscount,original_price:this.__model.edge.get("normal_price").toFixed(2),price:this.__price.toFixed(2),title:this.__model.node.get("name"),sale_copy:this.__percentageOff?this.__percentageOff+"% "+this.__globalStringManager.get("OFF"):this.__globalStringManager.get("SALE"),is_sale:this.__hasDiscount,showInDialog:this.__isInDialog}));this.__imageManager.load(this.$(".image-container > img"),this.__model.node.get("img160x160"))}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:Jb}),Lb=function(g){var b=g.UiCore.ListPresenter;return b.extend("BuyCreditList",{uiContextName:"buy_credit_list",className:"buy-credit-list",tagName:"section",itemFactory:g.BuyCreditListItem,initialize:function(a){this.itemFactory=IMVU.optionalProperty(a,"itemFactory",this.itemFactory);b.prototype.initialize.call(this,a);this.$el.prepend(g.template())}})}({UiCore:l["@UiCore"],BuyCreditListItem:Kb,template:Ib}),Mb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d,h=a.helperMissing;c='\n<div class="redemption-gifts">\n    <legend class="system-info-header">\n        ';if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"ppc_redemption_choice_dialog_bonus",{name:"i18n-g",hash:{},data:e})))||0===h)c+=h;c+='\n    </legend>\n    <div class="bonus-items-list">\n    ';if((h=a.each.call(b,b&&b.bonusItems,{name:"each",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===h)c+=h;return c+"\n    </div>\n</div>\n"},2:function(b,a,c,e){var d,h;c=this.escapeExpression;var f=a.helperMissing,k='\n        <article class="bonus-item-tile product-tile tile">\n            <div class="tile-body">\n                <img src="'+c((h=a.thumbnail||b&&b.thumbnail,"function"===typeof h?h.call(b,{name:"thumbnail",hash:{},data:e}):h))+'">\n            </div>\n            <div class="product-info">\n                <div class="product-name">'+c((d=b&&b.name,"function"===typeof d?d.apply(b):d))+'</div>\n                <div class="free">';if((d=(h=a["i18n-g"]||b&&b["i18n-g"]||f,h.call(b,"FREE",{name:"i18n-g",hash:{},data:e})))||0===d)k+=d;return k+"</div>\n            </div>\n        </article>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="redemption-choices">\n    <legend class="system-info-header">\n        ',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"ppc_redemption_choice_dialog_package",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='\n    </legend>\n    <div class="redemption-choices-container">\n    </div>\n</div>\n';if((f=a["if"].call(b,b&&b.hasBonusItems,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===f)h+=f;h+='\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary redeem-ppc full-width disabled">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"ppc_redeem_button",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</button>\n<\/script>\n"},useData:!0})}({}),Nb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="celled-list-placeholder"></div>'},useData:!0})}({}),Ob=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return" disabled "},3:function(b,a,c,e){return" ignore-click "},5:function(b,a,c,e){return'\n        <div class="tooltip-target icon icon-tooltip-icon"></div>\n        <div class="tooltip-content">\n            <div class="tooltip-header"></div>\n            <div class="tooltip-body"></div>\n        </div>\n    '},7:function(b,a,c,e){return'\n        <span class="icon icon-action-more"></span>\n    '},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h='<div class="wrapper ',f=a["if"].call(b,b&&b.isDisabled,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)h+=f;h+=" ";if((f=a["if"].call(b,b&&b.ignoreClick,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)h+=f;h+='">\n    <div class="thumbnail">\n        <img src="'+c((d=a.thumbnail||b&&b.thumbnail,"function"===typeof d?d.call(b,{name:"thumbnail",hash:{},data:e}):d))+'">\n    </div>\n    <div class="description">\n        <div class="celled-item-title">'+c((d=a.title||b&&b.title,"function"===typeof d?d.call(b,{name:"title",hash:{},data:e}):d))+'</div>\n        <div class="celled-item-description">'+c((d=a.description||b&&b.description,"function"===typeof d?d.call(b,{name:"description",hash:{},data:e}):d))+'</div>\n        <div class="celled-item-info">'+c((d=a.info||b&&b.info,"function"===typeof d?d.call(b,{name:"info",hash:{},data:e}):d))+'</div>\n    </div>\n    <div class="extra">\n    ';if((f=a["if"].call(b,b&&b.tooltip,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===f)h+=f;h+="\n    ";if((f=a["if"].call(b,b&&b.actionMore,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)h+=f;return h+"\n    </div>\n</div>"},useData:!0})}({}),Pb=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("TooltipDialog",{uiContextName:"tooltip_dialog",className:"tooltip-dialog dialog-type-B text-close",trackedEvents:function(){return this.__customTrackedEvents},initialize:function(a){this.__customTrackedEvents=a.trackedEvents||[];b.prototype.initialize.call(this,a);this.title=a.title;this.__tooltipContent=a.tooltipContent;this.addToDOM()},postRender:function(){this.setContent("body",this.__tooltipContent)}})}({Dialogs:l["@Dialogs"]}),y=function(g){var b=g.UiCore.UiContext;return b.extend("Tooltip",{className:"tooltip",uiContextName:"tooltip",dependencies:["dialogManager","timer","tooltipLayer","window"],trackedEvents:function(){return[{type:"click",selector:"a",name:"link_click",handler:"__clickedLink",allowBubble:!0}].concat(this.__customTrackedEvents)},__installTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.on("mouseenter.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.$target.off("mouseleave.tooltip")}.bind(this));this.__tooltipLayer.$el.on("mouseleave.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__tooltipTimeout);this.__tooltipTimeout=this.__timer.setTimeout(function(){this.setVisible(!1);this.__timer.clearTimeout(this.__tooltipTimeout);this.__tooltipTimeout=this.__timer.setTimeout(function(){this.__hide();this.__installTargetMouseleave()}.bind(this),125)}.bind(this),250)}.bind(this))},__removeTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.off(".tooltip")},initialize:function(a){this.$tooltip=IMVU.requireProperty(a,"$replaceElement");this.$target=IMVU.requireProperty(a,"$tooltipTarget");this.tooltipTitle=IMVU.optionalProperty(a,"title",!1);this.__tooltipStyle=IMVU.optionalProperty(a,"tooltipStyle","default");this.__tooltipPosition=IMVU.optionalProperty(a,"tooltipPosition","default");this.__positionDelta=IMVU.optionalProperty(a,"positionDelta",0);this.__forceTargetToUseOuterWidth=IMVU.optionalProperty(a,"forceTargetToUseOuterWidth",!1);this.__customTrackedEvents=a.trackedEvents||[];b.prototype.initialize.call(this,a);this.$body=$("body");this.$globalNav=$("nav.global-nav:visible");if("mobile"===this.__serviceProvider.get("platform"))this.$target.on("click.tooltip",function(c){c.stopPropagation();this.__openTooltipDialog()}.bind(this));else this.$target.on("mouseenter.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.__timer.clearTimeout(this.__targetFadeinTimeout);this.__installTargetMouseleave();this.__targetFadeinTimeout=this.__timer.setTimeout(function(){this.setVisible(!0);this.__show()}.bind(this),250)}.bind(this));"snug"===this.__tooltipStyle&&this.$el.addClass("tooltip-snug");this.$el.append(this.$tooltip);this.setParentUiContext(this.__tooltipLayer);this.__tooltipLayer.$el.append(this.$el);this.__setAsRendered()},setVisible:function(a){this.$el.toggleClass("tooltip-open",!!a)},__installTargetMouseleave:function(){this.$target.on("mouseleave.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__targetTimeout=this.__timer.setTimeout(function(){this.setVisible(!1);this.__timer.clearTimeout(this.__targetTimeout);this.__targetTimeout=this.__timer.setTimeout(function(){this.__hide()}.bind(this),125)}.bind(this),250)}.bind(this))},__show:function(){this.__installTooltipLayerEventHandlers();this.__trackTooltip();$(this.__window).on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this));this.$body.find(".transparent-overlay").on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this))},trackTooltip:function(){this.__trackTooltip()},__trackTooltip:function(){var a=this.$globalNav.height()||0,c=this.$target[0].getBoundingClientRect().top,e=this.$target[0].getBoundingClientRect().left,d=$(window).width()-(e+this.$target.outerWidth()/2),h=this.$el[0].offsetWidth;0<this.$target.parents(".dialog-manager").length&&(a=0);var f=this.$target.width();this.__forceTargetToUseOuterWidth&&(f=this.$target.outerWidth());d=d>h?e+f/2:e+f/2-h;"bottom"===this.__tooltipPosition?(d=e-this.$tooltip.outerWidth()/2,c=this.$target[0].getBoundingClientRect().bottom-this.__positionDelta):"above"===this.__tooltipPosition?(d=e+f/2-h,c=this.$target[0].getBoundingClientRect().top-this.$el[0].offsetHeight):"left"===this.__tooltipPosition?(d=e-f-h-this.__positionDelta,c=this.$target[0].getBoundingClientRect().top):"bottom-left-edge"===this.__tooltipPosition&&(d=e,c=0);this.$el.css({"margin-top":Math.max(c,a),"margin-left":d})},__hide:function(){this.__removeTooltipLayerEventHandlers();this.setVisible(!1)},__openTooltipDialog:function(){return this.__dialogManager.showDialog(g.TooltipDialog,{title:this.tooltipTitle||this.$target.text(),tooltipContent:this.$tooltip.html(),trackedEvents:this.__customTrackedEvents})},delete:function(){this.$el.removeAttr("style");this.__timer.clearTimeout(this.__targetFadeinTimeout);this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.$target.off(".tooltip");this.__removeTooltipLayerEventHandlers();$(this.__window).off("scroll.tooltip");this.$body.find(".transparent-overlay").off("scroll.tooltip");b.prototype.delete.call(this)},__clickedLink:function(a){this.__hide()}})}({UiCore:l["@UiCore"],TooltipDialog:Pb}),Qb=function(g){var b=g.UiCore.UiContext;return b.extend("CelledListItem",{className:"celled-list-item",uiContextName:"celled_list_item",dependencies:["model"],trackedEvents:function(){return[{type:"click",selector:"",name:"celledlistitem_click",handler:this.__onClick.bind(this)},{type:"click",selector:"extra.action-more",name:"click_more_info",handler:this.__onClickMore.bind(this)}]},initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){var a=!1,c="",e="",d=this.__model.get("extra"),h=d&&"action_more"===d.type;d&&"tooltip"===d.type&&(a=!0,c=d.tooltip_header,e=d.tooltip_body);this.__ignoreClick=this.__model.get("isDisabled")||this.__model.get("ignoreItemClick");this.$el.html(g.template({thumbnail:this.__model.get("thumbnail"),title:this.__model.get("title"),description:this.__model.get("description"),info:this.__model.get("info"),tooltip:a,isDisabled:!!this.__model.get("isDisabled"),actionMore:h,ignoreClick:this.__ignoreClick}));a&&(this.$(".tooltip-header").html(c),this.$(".tooltip-body").html(e),this.createChildContext(g.Tooltip,{$replaceElement:this.$(".tooltip-content"),$tooltipTarget:this.$(".tooltip-target")}))},__onClick:function(a){this.__ignoreClick||(g.NextUtil.DomHelper.radioClass(this.$el,"is-selected"),this.trigger("select",this.__model))},__onClickMore:function(){this.trigger("action_more",this.__model)}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],Tooltip:y,template:Ob}),Rb=function(g){return g.UiCore.ListPresenter.extend("CelledList",{className:"celled-list",uiContextName:"celled_list",itemFactory:g.CelledListItem})}({UiCore:l["@UiCore"],CelledListItem:Qb}),Sb=function(g){var b=g.UiCore.UiContext;return b.extend("CelledListPresenter",{className:"celled-list-presenter",uiContextName:"celled_list_presenter",dependencies:["collection"],initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},render:function(a){this.$el.html(g.template());this.celledList=this.createChildContext(g.CelledList,{$replaceElement:this.$(".celled-list-placeholder"),collection:this.collection});this.celledList.on("select",function(c){this.__selectedItem=c;this.trigger("select")}.bind(this))},getSelectedItem:function(){return this.__selectedItem}})}({UiCore:l["@UiCore"],CelledList:Rb,template:Nb}),Tb=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("PPCRedemptionChoiceDialog",{uiContextName:"redemption_choice_dialog",className:"redemption-choice-dialog dialog-type-B",dependencies:"bonusItems dialogManager globalStartupModel globalStringManager ppcPin redemptionChoices rest siteRoot".split(" "),trackedEvents:function(){return[{type:"click",selector:"button.redeem-ppc",name:"redeem_ppc",handler:"__redeem"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("ppc_redemption_choice_dialog_title");this.__redeemUrl=this.__globalStartupModel.get("ppcRedeemUrl");this.addToDOM()},postRender:function(){this.setContent("body",g.template,{hasBonusItems:0<this.__bonusItems.length&&!1,bonusItems:this.__bonusItems});this.setContent("footer",this.$(".dialog-footer-template").text());this.__choiceList=this.createChildContext(g.CelledListPresenter,{$replaceElement:this.$(".redemption-choices-container"),collection:this.__redemptionChoices});this.__choiceList.on("select",this.__enableRedeemButton.bind(this))},__enableRedeemButton:function(){this.$(".redeem-ppc").toggleClass("disabled",!1)},__redeem:function(){if(this.__selectedItem=this.__choiceList.getSelectedItem()){this.__setLoading(!0);var a=this.__selectedItem.get("type");this.__rest.post(this.__redeemUrl+"/prepaid_card-"+this.__ppcPin,{choice:a}).then(function(){var c={};_.each(this.__bonusItems,function(d,h){c["gift_"+h]=d.name});var e=this.__globalStringManager.get("ppc_redemption_success_message_gift_num_0",_.extend({base_item:this.__selectedItem.get("title")},c));this.__dialogManager.alert({title:this.__globalStringManager.get("ppc_redemption_success_title"),text:e,ok:this.__globalStringManager.get("ppc_redemption_success_button")}).finished.then(function(){return this.promiseResolver.resolve()}.bind(this))}.bind(this)).catch(function(c){var e=this.__globalStringManager.get("ppc_redeem_error_unknown_3");switch(c.error.error){case"EMK_014":e=this.__globalStringManager.get("ppc_redeem_error_already_redeemed_2");break;case"PPC_001":e=this.__globalStringManager.get("ppc_redeem_error_invalid_code");break;case"PPC_002":e=this.__globalStringManager.get("ppc_redeem_error_inactive_card");break;case"PPC_003":e=this.__globalStringManager.get("ppc_redeem_error_already_redeemed_3");break;default:e=this.__globalStringManager.get("ppc_redeem_error_unknown_2")}switch(c.error.code){case"PPC_001":e=this.__globalStringManager.get("ppc_redeem_error_invalid_code");break;case"PPC_002":e=this.__globalStringManager.get("ppc_redeem_error_inactive_card");break;case"PPC_003":e=this.__globalStringManager.get("ppc_redeem_error_already_redeemed_1")}this.__dialogManager.alert({title:this.__globalStringManager.get("ppc_redemption_failed_title"),text:e,ok:this.__globalStringManager.get("ppc_redemption_failed_button")}).finished.then(function(){return this.promiseResolver.reject()}.bind(this))}.bind(this))}},__setLoading:function(a){this.$("button.redeem-ppc").prop("disabled",a)}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],CelledListPresenter:Sb,template:Mb}),Ub=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<legend class="redeem-title system-info-header">\n    ',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"ppc_redeem_title",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='\n    <span class="ppc-redeem-tooltip-target icon icon-tooltip-icon"></span>\n</legend>\n<div class="redeem-wrapper">\n    <div class="redeem-field">\n        <input type="text" class="ppc-code full-width" maxlength="16" placeholder="';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"ppc_redeem_input_placeholder",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='">\n        <div class="input-error"></div>\n    </div>\n    <div class="redeem-button">\n        <button class="ppc-redeem-btn btn disabled full-width">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"ppc_redeem_button",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</button>\n    </div>\n</div>\n<div class="ppc-redeem-tooltip">\n    <div class="tooltip-header">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"ppc_tooltip_header",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</div>\n    <div class="tooltip-body">\n        <div class="icon icon-ppc-tooltip"></div>\n        <div>';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"ppc_tooltip_body_line_1",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</div>\n        <div>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"ppc_tooltip_body_line_2",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</div>\n    </div>\n</div>\n\n<div class="vip-tooltip-body hidden">\n    ';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_description_title",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="\n    <ul>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_description_item_1",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_description_item_2",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_description_item_3",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_description_item_4",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</li>\n    </ul>\n</div>"},useData:!0})}({}),Vb=function(g){var b=g.UiCore.UiContext;return b.extend("PPCRedeem",{className:"ppc-redeem",uiContextName:"ppc_redeem",dependencies:"dialogManager featureAccessManager globalStartupModel globalStringManager googleAnalytics leanplum loginManager modelCache platform Promise restModelFactory".split(" "),trackedEvents:function(){return[{type:"keyup",selector:"input.ppc-code",name:"ppcredeem_keyup",handler:this.__onKeyup.bind(this)},{type:"click",selector:"button.ppc-redeem-btn",name:"ppcredeem_click",handler:this.__inquiryPin.bind(this)}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__redeemUrl=this.__globalStartupModel.get("ppcRedeemUrl");this.__formatNumber=g.FormatNumber;this.__myself=this.track(this.__loginManager.getCurrentUser());this.__isMobile="mobile"===this.__platform;this.addToDOM();this.listenTo(this,"clear_input",this.__clearInput);this.listenTo(this,"successfully_redeemed",this.__clearInput)},delete:function(){b.prototype.delete.call(this);this.__tooltip.delete()},render:function(){this.$el.html(g.template());this.__tooltip=this.__serviceProvider.create(g.Tooltip,{$replaceElement:this.$(".ppc-redeem-tooltip"),$tooltipTarget:this.$(".ppc-redeem-tooltip-target"),tooltipPosition:"above"});this.__$code=this.$(".ppc-code");this.__$error=this.$(".input-error");parseInt(this.__globalStartupModel.get("ppcDisabled"),10)&&(this.$(".ppc-code").prop("disabled",!0),this.$(".ppc-code").attr("placeholder","Temporarily Disabled"))},__validatePin:function(a){return this.__$code.val()?!0:(this.__updateError(this.__globalStringManager.get("ppc_redeem_error_empty_code")),!1)},__inquiryPin:function(a){this.__validatePin()?(this.__leanplum.recordEvent("next_ppc_redeem_click_success"),this.__googleAnalytics.recordDollarStore("redeem","ppc"),this.__clearErrors(),a=this.__redeemUrl+"/prepaid_card-"+this.__$code.val(),this.ppc&&this.__modelCache.invalidate(a),this.ppc=this.track(this.__restModelFactory.readModel(a,g.UiCore.NodeModel)),this.ppc.populated().then(function(c){if(c.get("redeemed")||!c.get("valid"))return new this.__Promise(function(h){h.reject({redeemed:!0})});var e=c.get("base_credits"),d=c.get("vip_months");this.__choices=new IMVU.NamedCollection;if(d){switch(d){case 12:d="1 "+this.__globalStringManager.get("Year")+" "+this.__globalStringManager.get("VIP_platinum_membership");break;case 1:d="1 "+this.__globalStringManager.get("Month")+" "+this.__globalStringManager.get("VIP_platinum_membership");break;default:d=d+" "+this.__globalStringManager.get("Months")+" "+this.__globalStringManager.get("VIP_platinum_membership")}d=new IMVU.NamedModel({type:"vip",thumbnail:"https://static-akm.imvu.com/imvufiles/vip/products/vip_badge_platinum_512.png",title:d,description:"",info:"",extra:{},isDisabled:!c.get("can_vip")});this.__choices.add(d)}if(e){switch(e){case 1e3>=e:d="credits-level-one.png";break;case 1e4>=e:d="credits-level-two.png";break;default:d="credits-level-three.png"}e=new IMVU.NamedModel({type:"credits",thumbnail:this.__getImageUrl(d),title:this.__formatNumber.formatCredits(e)+" "+this.__globalStringManager.get("Credits"),description:"",info:""});this.__choices.add(e)}return c.getEdgeCollection("bonus_products").populated()}.bind(this)).then(function(c){var e=[];_.each(c.models,function(d){e.push({name:d.node.get("product_name"),thumbnail:d.node.get("preview_image")+"?width=150&height=150"})}.bind(this));this.__dialogManager.showDialog(g.RedemptionChoiceDialog,{ppcPin:this.__$code.val(),bonusItems:e,redemptionChoices:this.__choices}).finished.then(function(){this.trigger("successfully_redeemed")}.bind(this))}.bind(this)).catch(function(c){c=c.redeemed?this.__globalStringManager.get("ppc_redeem_error_already_redeemed"):this.__globalStringManager.get("ppc_redeem_error_invalid_code");this.__updateError(c);this.trigger("redeem_failed")}.bind(this))):this.__leanplum.recordEvent("next_ppc_redeem_click_error")},__updateError:function(a){this.__$code.toggleClass("has-error",!0);this.__$error.text(a).toggleClass("error-visible",!0)},__onKeyup:function(a){a.keyCode===g.NextUtil.Keys.VK_ENTER?this.__inquiryPin():(this.$("button.ppc-redeem-btn").toggleClass("disabled",!this.__validatePin()),this.__clearErrors())},__clearErrors:function(){this.__$code.toggleClass("has-error",!1);this.__$error.text("").toggleClass("error-visible",!1)},__getImageUrl:function(a){return"/common/withme/img/store/"+a},__clearInput:function(){this.__$code.val("");this.__clearErrors()}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],FormatNumber:r,RedemptionChoiceDialog:Tb,Tooltip:y,template:Ub}),Wb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<button class="btn btn-primary buy-now" disabled>';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"CHECKOUT",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</button>"},useData:!0})}({}),Xb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="alert-message">\n',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"already_have_vip_subscription_text_before_link",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='\n<a href="https://help.imvu.com" target="_blank">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"already_have_vip_subscription_text_link",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</a>\n";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"already_have_vip_subscription_text_after_link",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"\n</div>"},useData:!0})}({}),Yb=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d,h=a.helperMissing;c="\n    <div class='alert-message title'>";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"payment_processing_error_text_2",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</div>\n"},3:function(b,a,c,e){a=this.escapeExpression;return"\n        <div class='alert-message'>"+a("function"===typeof b?b.apply(b):b)+"</div>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="content-container">\n\n',f=a.unless.call(b,b&&b.isNoHope,{name:"unless",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)h+=f;h+="\n\n    ";if((f=a.each.call(b,b&&b.messages,{name:"each",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)h+=f;h+="\n\n    <div class='alert-message summary'>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"payment_processing_error_text_3",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"\n        <a target='_blank' href='https://help.imvu.com/'>help.imvu.com</a>.\n    </div>\n</div>\n"},useData:!0})}({}),la=function(g){return IMVU.BaseClass.extend("StringManager",{dependencies:["cookieManager","dictionary","window"],initialize:function(b){this.__cookieManager=b.cookieManager;this.__dictionary=b.dictionary;this.__window=b.window;if(!this.__dictionary)throw Error("StringManager requires a dictionary");this.__appMonitor=null;this.serviceProvider=b.serviceProvider},__getAppMonitor:function(){if(!this.__appMonitor&&this.serviceProvider.has("appMonitor")){var b=this.serviceProvider.get("appMonitor");b&&(this.__appMonitor=b)}return this.__appMonitor},__process_placeholders:function(b,a){_.each(a,function(c,e){b=b.replace(new RegExp("{{\\s*"+e+"\\s*}}","g"),c)});return b},isImvuese:function(){return"1"===this.__cookieManager.get("imvuese")},get:function(b,a){if(this.isImvuese())return"{"+b+"}";var c=this.__dictionary[b];if(!_.isString(c))throw a='Unable to find text: "'+b+'" in translation dictionary. Use getWithDefault to set default value.',this.__getAppMonitor()?this.__appMonitor.reportCustomError("StringManager","get","web_perm_0018",a,["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]):this.__window.appMonitorPending.push(["UIContextExtension","initialize","web_perm_0018",a,["Bad key["+b+"]"]]),Error(a);return this.__process_placeholders(c,a)},getWithDefault:function(b,a,c){if(this.isImvuese())return"{"+b+"}";if("string"!==typeof a)throw Error("defaultText must be a string, but got "+IMVU.repr(a));b=this.__dictionary[b];return _.isString(b)?this.__process_placeholders(b,c):a},getPluralized:function(b,a){if(this.isImvuese())return"{"+b+"}";var c=parseInt(a.howMany,10);return 0===c?this.get(b+"_none",a):this.get(b+(2>c?"_singular":"_plural"),a)},handlebarsHelper:function(b,a){return this.get(b,a.hash)},handlebarsHelperWithDefault:function(b,a,c){return this.getWithDefault(b,a,c)}})}({}),Zb=function(g){var b=g.Dialogs.AlloyAlertDialog;return b.extend("MultiCartErrorDialog",{uiContextName:"multicart_error_dialog",className:"multicart-error-dialog dialog-type-B",dependencies:["globalStringManager","window"],initialize:function(a){this.__stringManager=a.globalStringManager;this.__keys=IMVU.requireProperty(a,"keys");a.title=this.__stringManager.get("payment_processing_status_title");a.ok=this.__stringManager.get("payment_processing_error_button");this.__storeDictionary=a.serviceProvider.create(g.StringManager,{dictionary:g.storeDictionary});a.serviceProvider.register("storeDictionary",this.__storeDictionary);Handlebars.registerHelper("storeDict_i18n",this.__storeDictionary.handlebarsHelper.bind(this.__storeDictionary));b.prototype.initialize.call(this,a)},postRender:function(){b.prototype.postRender.call(this);var a=[],c=!1,e=!1;_.each(this.__keys,function(d,h,f){try{a.push(this.__storeDictionary.get(d))}catch(k){this.__window.console.error("Error key not found in dict: %s\n%s",d,k),c||(a.push(this.__storeDictionary.get("FCM_default")),c=!0)}"co_blocked"===d&&(e=!0)}.bind(this));this.$(".id-body-contents").html(g.template({messages:a,isNoHope:e}));this.$(".content-container").scrollbar()}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],storeDictionary:l["json!@StoreModeDictionary"],StringManager:la,template:Yb}),$b=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;return"<iframe class='frame-base' src='"+c((d=a.src||b&&b.src,"function"===typeof d?d.call(b,{name:"src",hash:{},data:e}):d))+"'></iframe>\n"},useData:!0})}({}),ac=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("IframeDialog",{uiContextName:"iframe_dialog",className:"iframe-dialog dialog-type-B",dependencies:"dialogManager globalStartupModel globalStringManager platform rest window".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__platform=a.platform;this.title="undefined"===typeof a.titleID?"":this.__globalStringManager.get(a.titleID);this.__src=a.src;this.__hideHeader="undefined"===typeof a.hideHeader?!0:!0===a.hideHeader;this.__hideFooter="undefined"===typeof a.hideFooter?!0:!0===a.hideFooter;this.addToDOM();a.isCreatorLanding||this.__window.addEventListener("message",this.__receiveMessage.bind(this),!0)},makeSeamless:function(){this.$(".frame-base").hasClass("seamless")||this.$(".frame-base").addClass("seamless")},postRender:function(){this.setContent("body",g.template,{src:this.__src});this.makeSeamless();this.__hideHeader&&(this.$(".dialog-header").addClass("hide"),this.$(".aux-header").addClass("hide"));this.__hideFooter&&this.$(".dialog-footer").addClass("hide")},setClasses:function(a,c){a.removeClass("dialog-type-B");a.removeClass("can-dismiss");a.removeClass("iframe-dialog");a.removeClass(c);a.addClass("iframe-dialog");a.addClass(c);a.addClass("dialog-type-B");a.addClass("can-dismiss")},close:function(){this.__window.removeEventListener("message",this.__receiveMessage.bind(this),!0);b.prototype.close.call(this)},__receiveMessage:function(a){"no_dialog_in_iframe"===a.data.message?b.prototype.close.call(this):"close_iframe_dialog"===a.data.message?b.prototype.close.call(this):("opening_modal_dialog"===a.data.message&&("alert_dialog_alloy"===a.data.type||"confirm_dialog_alloy"===a.data.type||"two_factor_setup_alert_dialog"===a.data.type||"link_uphold_dialog"===a.data.type?this.$(".dialog-x").addClass("hidden"):"payment_wall_dialog"===a.data.type?(this.isUncancellableDialog=!0,this.$el.addClass("payment-wall-open")):this.$(".dialog-x").removeClass("hidden")),"deleting_modal_dialog"===a.data.message?"confirm_dialog_alloy"===a.data.type?this.$(".dialog-x").removeClass("hidden"):"alert_dialog_alloy"===a.data.type?(this.$(".dialog-x").removeClass("hidden"),this.close()):"payment_wall_dialog"===a.data.type&&(this.isUncancellableDialog=!1,this.$el.removeClass("payment-wall-open")):"iframe_open_new_window"===a.data.message&&this.__window.open(a.data.params.url,a.data.params.name?a.data.params.name:"_blank"))},delete:function(){this.__window.removeEventListener("message",this.__receiveMessage.bind(this),!0);b.prototype.delete.call(this)}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],template:$b}),bc=function(g){var b=g.IframeBase;return b.extend("PaymentWallDialog",{uiContextName:"payment_wall_dialog",className:"payment-wall-dialog text-close",dependencies:["dialogManager"],trackedEvents:function(){return[]},initialize:function(a){a=_.extend({titleID:"payment_dialog_title",hideHeader:!1,hideFooter:!0},a);b.prototype.initialize.call(this,a);this.makeSeamless();this.addToDOM();this.$el.addClass(a.paymentWallChan)},postRender:function(){b.prototype.postRender.call(this);b.prototype.setClasses(this.$el,this.className);this.__contextualClassRemoved=this.__dialogManager.toggleTransparentOverlaySize(!1)},hide:function(){this.__contextualClassRemoved&&this.__dialogManager.toggleTransparentOverlaySize(!0);b.prototype.hide.call(this)}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],IframeBase:ac}),cc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=this.escapeExpression;return'\n        <div class="title">'+c((d=a.status_prompt||b&&b.status_prompt,"function"===typeof d?d.call(b,{name:"status_prompt",hash:{},data:e}):d))+"</div>\n        "},3:function(b,a,c,e){return"\n            <div class='other-payment-channel-list'>\n                <span class='name'>PAY WITH VCOIN</span>\n                <img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'>\n            </div>            \n    "},5:function(b,a,c,e){c="\n        ";if((b=a["if"].call(b,b&&b.billingInfo,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===b)c+=b;return c+"            \n    "},6:function(b,a,c,e){var d,h=a.helperMissing;c='\n            <legend class="system-info-header">\n                ';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"BILLED TO",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+'\n            </legend>\n            <div class="billing-info"></div>\n        '},8:function(b,a,c,e){c="\n        ";if((b=a["if"].call(b,b&&b.isCheckedoutModel,{name:"if",hash:{},fn:this.program(9,e),inverse:this.noop,data:e}))||0===b)c+=b;return c+"\n        "},9:function(b,a,c,e){var d;c=this.escapeExpression;var h='\n            <div class="order-row">\n                <div class="order-item">\n                    <div class="image-container"><img src="'+c((d=(d=(d=b&&b.attributes,null==d||!1===d?d:d.node),null==d||!1===d?d:d.img160x160),"function"===typeof d?d.apply(b):d))+'"></div>\n                    <div class="item-info">\n                        <div class="item-name">'+c((d=(d=(d=b&&b.attributes,null==d||!1===d?d:d.node),null==d||!1===d?d:d.name),"function"===typeof d?d.apply(b):d))+"</div>\n                        ";if((d=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(10,e),inverse:this.program(12,e),data:e}))||0===d)h+=d;return h+"\n                    </div>\n                </div>\n            </div>\n        "},10:function(b,a,c,e){var d;a=this.escapeExpression;return'\n                            <div class="product-price"><img src=\'https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg\'><span class="item-info-price">'+a((d=(d=(d=b&&b.attributes,null==d||!1===d?d:d.edge),null==d||!1===d?d:d.vcoin_sale_price_formatted),"function"===typeof d?d.apply(b):d))+"</span></div>\n                        "},12:function(b,a,c,e){var d;a=this.escapeExpression;return'\n                            <div class="product-price">'+a((d=(d=(d=b&&b.attributes,null==d||!1===d?d:d.edge),null==d||!1===d?d:d.sale_price_formatted),"function"===typeof d?d.apply(b):d))+"</div>\n                        "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f='<div class="payment-content-container">\n    <div class="info-block message">\n        ',k=a["if"].call(b,b&&b.notPaymentWall,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+='\n        <div class="text">'+c((d=a.status_message||b&&b.status_message,"function"===typeof d?d.call(b,{name:"status_message",hash:{},data:e}):d))+"</div>\n    </div>\n    ";if((k=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(3,e),inverse:this.program(5,e),data:e}))||0===k)f+=k;f+='\n    <legend class="system-info-header">\n        ';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"YOUR ORDER",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='\n    </legend>\n    <div class="order-block">\n        ';if((k=a.each.call(b,b&&b.cart,{name:"each",hash:{},fn:this.program(8,e),inverse:this.noop,data:e}))||0===k)f+=k;f+='\n    </div>\n    <div class="summary-block">\n        <div>';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Order",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=" #"+c((d=a.order_id||b&&b.order_id,"function"===typeof d?d.call(b,{name:"order_id",hash:{},data:e}):d))+"</div>\n        <div>";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Purchase date",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=": "+c((d=a.order_date||b&&b.order_date,"function"===typeof d?d.call(b,{name:"order_date",hash:{},data:e}):d))+'</div>\n\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-dark btn-primary">\n        ';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"payment_success_button",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+"\n    </button>\n<\/script>\n"},useData:!0})}({}),dc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=this.escapeExpression;return"\n            <p class='desc'>"+c((d=a.email_msg||b&&b.email_msg,"function"===typeof d?d.call(b,{name:"email_msg",hash:{},data:e}):d))+"</p>\n        "},3:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression;return"\n            <p class='desc'>"+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"TwoFactorChallenge.desc",{name:"i18n-g",hash:{},data:e})))+"</p>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f='<div class="content-container">\n    <div class="content-block">\n        ',k=a["if"].call(b,b&&b.email_msg,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(k||0===k)f+=k;return f+"\n        <div class='input-panel'>\n            <input class='two-factor-code' required maxlength='6' placeholder=\""+c((d=a.placeholder||b&&b.placeholder,"function"===typeof d?d.call(b,{name:"placeholder",hash:{},data:e}):d))+"\">\n            <div class='enrollment-error'></div>\n        </div>\n\n        <div class='link-panel'>\n            <p class='change-email'>\n                "+c((d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"TwoFactorEnrollment.cant_access_email",{name:"i18n-g",hash:{},data:e})))+"\n                <span class='change-email'>"+c((d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"TwoFactorEnrollment.change_email",{name:"i18n-g",hash:{},data:e})))+"</span>\n            </p>\n            <p class='new-code'>\n                "+c((d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"TwoFactorEnrollment.need_another_code",{name:"i18n-g",hash:{},data:e})))+"\n                <span class='new-code'>"+c((d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"TwoFactorEnrollment.send_a_new_code",{name:"i18n-g",hash:{},data:e})))+'</span>\n            </p>\n        </div>\n\n    </div>\n</div>\n\n<footer class="dialog-footer">\n    <button class="btn btn-primary disabled submit">'+c((d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Continue",{name:"i18n-g",hash:{},data:e})))+"</button>\n</footer>\n"},useData:!0})}({}),ec=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="content-container">\n    <div class="content-block">\n        <legend class="system-info-header">\n            ',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"email address",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='\n        </legend>\n\n        <div class=\'input-panel\'>\n            <input class=\'two-factor-email\' required placeholder="Email">\n            <ul class=\'email-error\'>\n                <li class="error-message hidden"></li>\n            </ul>\n            <input class=\'two-factor-password\' type="password" required placeholder="Password">\n            <ul class=\'password-error\'>\n                <li class="error-message hidden"></li>\n            </ul>\n        </div>\n\n    </div>\n</div>\n\n<footer class="dialog-footer">\n    <button class="btn btn-primary send-code disabled">\n        ';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"TwoFactorChangeEmail.button",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"\n    </button>\n</footer>\n"},useData:!0})}({}),fc=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("TwoFactorChangeEmail",{uiContextName:"two_factor_change_email_dialog",className:"two-factor-change-email-dialog dialog-type-B",dependencies:"dialogManager globalStartupModel globalStringManager loginManager rest serviceProvider".split(" "),trackedEvents:function(){return[{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack},{type:"keyup",selector:".two-factor-email",name:"typing_email",handler:this.__onTypingEmail},{type:"click",selector:".btn-primary",name:"send_code",handler:this.__sendCode}]},initialize:function(a){b.prototype.initialize.call(this,a);this.shouldFocusOnPrimaryButton=!1;this.title=this.__globalStringManager.get("TwoFactorChangeEmail.title");this.__myself=a.loginManager.getCurrentUser();this.__settingsDict=this.__serviceProvider.create(g.StringManager,{dictionary:g.settingsDict});this.addToDOM()},delete:function(){b.prototype.delete.call(this)},close:function(){this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.setContent("body",g.template,{});this.$("input.two-factor-email").focus()},__goBack:function(){this.hide();this.promiseResolver.reject()},__onTypingEmail:function(){var a=this.$("input.two-factor-email").val();/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,3}$/.test(String(a).toLowerCase())?this.$(".btn-primary").removeClass("disabled"):this.$(".btn-primary").hasClass("disabled")||this.$(".btn-primary").addClass("disabled")},__sendCode:function(){var a=this.__globalStartupModel.get("changeEmailUrl");this.$(".error-message").addClass("hidden");this.__rest.post(a,{new_email:this.$("input.two-factor-email").val(),password:this.$("input.two-factor-password").val()}).then(function(c){202===c.xhr.status?this.promiseResolver.resolve({code:"change_email_challenge",new_email:this.$("input.two-factor-email").val(),password:this.$("input.two-factor-password").val(),email_url:this.__globalStartupModel.get("changeEmailUrl")}):(this.trigger("new_email_address_saved"),this.promiseResolver.resolve({code:"new_email_saved",new_email:this.$("input.two-factor-email").val()}))}.bind(this)).catch(function(c){var e="",d=!1;switch(c.error.error){case"CHANGE_EMAIL-001":c=this.__settingsDict.get("CHANGE_EMAIL_SAME_AS_OLD");e=".email-error";break;case"CHANGE_EMAIL-002":c=this.__settingsDict.get("CHANGE_EMAIL_ALREADY_IN_USE");e=".email-error";break;case"CHANGE_EMAIL-003":c=this.__settingsDict.get("CHANGE_EMAIL_INVALID_FORMAT");e=".email-error";break;case"CHANGE_EMAIL-004":c=this.__settingsDict.get("CHANGE_EMAIL_WRONG_PASSWORD");e=".password-error";break;case"CHANGE_EMAIL-005":c=this.__settingsDict.get("CHANGE_EMAIL_CHANGED_RECENTLY");d=!0;break;case"CHANGE_EMAIL-006":c=this.__settingsDict.get("CHANGE_EMAIL_ACCOUNT_ON_HOLD");e=".email-error";break;default:c=c.error.message}d?this.__dialogManager.alert({title:this.__globalStringManager.get("oops"),text:c,ok:this.__globalStringManager.get("OK")}):(this.$(e+" .error-message").text(c),this.$(e+" .error-message").removeClass("hidden"))}.bind(this))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],settingsDict:l["json!/common/withme/i18n/settings.json"],StringManager:la,template:ec}),gc=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("TwoFactorEnrollment",{uiContextName:"two_factor_enrollment_dialog",className:"two-factor-enrollment-dialog dialog-type-B",dependencies:["dialogManager","globalStringManager","loginManager","securitySettingsManager","window"],trackedEvents:function(){return[{type:"click",selector:".btn-primary",name:"continue",handler:this.__clickContinue},{type:"input",selector:".two-factor-code",name:"typing_code",handler:this.__onTypingCode},{type:"keyup",selector:".two-factor-code",name:"typing_code",handler:this.__onKeyUp},{type:"click",selector:"span.change-email",name:"change_email",handler:this.__clickChangeEmail},{type:"click",selector:"span.new-code",name:"new_code",handler:this.__clickSendNewCode}]},initialize:function(a){b.prototype.initialize.call(this,a);this.shouldFocusOnPrimaryButton=!1;this.title=this.__globalStringManager.get("TwoFactorEnrollment.title");this.__myself=this.__loginManager.getCurrentUser();this.__isEnabling=IMVU.optionalProperty(a,"isEnabling",!0);this.__regex_not_allowed=/[ ]/gi;this.__securitySettingsManager.toggle2FA({enabling:this.__isEnabling}).then(function(c){if(c.error&&"failure"===c.error.status||c.error&&"NetworkFailure"===c.error.error){var e=c.error.message;"SECURITY_SETTINGS-003"===c.error.error&&(e=this.__globalStringManager.get("TwoFactorEnrollment.apple_signed_in"));this.__dialogManager.showDialog(g.Dialogs.AlloyAlertDialog,{title:this.__globalStringManager.get("Error"),text:e,ok:this.__globalStringManager.get("OKAY")}).finished.then(function(){this.addToDOM()}.bind(this)).catch(function(){this.close()}.bind(this))}else{this.__email_msg=null;if(c.response&&c.response.message&&c.response.details)try{this.__email_addr=c.response.details.email_address,this.__email_msg=c.response.message.replace("%email_address",this.__email_addr)}catch(d){this.__window.console.error(d)}this.addToDOM()}}.bind(this))},close:function(){this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},postRender:function(){this.setContent("body",g.template,{email_msg:this.__email_msg,placeholder:this.__globalStringManager.get("TwoFactorEnrollment.code_placeholder")});!1===this.__isEnabling&&this.$(".change-email").addClass("hidden")},__onKeyUp:function(a){a.keyCode===g.NextUtil.Keys.VK_ENTER&&(this.$(".btn-primary").hasClass("disabled")||this.__clickContinue())},__onTypingCode:function(){var a=this.$("input.two-factor-code").val();-1<a.search(this.__regex_not_allowed)&&(a=a.replace(this.__regex_not_allowed,""),this.$("input.two-factor-code").val(a));a&&a.length===this.$("input.two-factor-code")[0].maxLength?this.$(".btn-primary").removeClass("disabled"):this.$(".btn-primary").hasClass("disabled")||(this.$(".btn-primary").addClass("disabled"),this.$(".enrollment-error").removeClass("error-visible"),this.$(".two-factor-code").removeClass("error-visible"))},__clickContinue:function(){this.__securitySettingsManager.toggle2FA({enabling:this.__isEnabling,code:this.$("input.two-factor-code").val()}).then(function(a){200===a.xhr.status?this.promiseResolver.resolve("valid_code"):(a&&a.error?(this.$(".enrollment-error").addClass("error-visible"),"SECURITY_SETTINGS-002"===a.error.error?this.$(".enrollment-error").text(this.__globalStringManager.get("TwoFactorEnrollment.incorrect_code")):this.$(".enrollment-error").text(a.error.message)):(this.$(".enrollment-error").addClass("error-visible"),this.$(".enrollment-error").text(this.__globalStringManager.get("message_error.generic_title"))),this.$(".two-factor-code").addClass("error-visible"))}.bind(this)).catch(function(){this.$(".enrollment-error").addClass("error-visible");this.$(".enrollment-error").text(this.__globalStringManager.get("message_error.generic_title"))}.bind(this))},__clickChangeEmail:function(){this.__dialogManager.showDialog(g.TwoFactorChangeEmail,{}).finished.then(function(a){"new_email_saved"===a.code?(a=this.__obfuscateEmail(a.new_email),this.__email_msg=this.__email_msg.replace(this.__email_addr,a),this.__email_addr=a,this.$(".content-block p.desc").text(this.__email_msg)):this.__window.console.log("Unexpected error, resp:",a)}.bind(this)).catch(function(){}.bind(this))},__obfuscateEmail:function(a){a=a.split("@");var c=a[0].length,e=3<c?a[0].substr(c-3):"";e=e.padStart(c,"*");return[e,"@",a[1]].join("")},__clickSendNewCode:function(){this.__securitySettingsManager.toggle2FA({enabling:this.__isEnabling}).then(function(a){var c=this.__globalStringManager.get("message_error.generic_title"),e=this.__globalStringManager.get("TwoFactorNewCode.title");a.response?c="SECURITY_SETTINGS-001"===a.response.error?this.__globalStringManager.get("TwoFactorNewCode.desc"):a.response.message:a.error&&(c=a.error.message,e=this.__globalStringManager.get("oops"));this.__dialogManager.showDialog(g.Dialogs.AlloyAlertDialog,{title:e,text:c,ok:this.__globalStringManager.get("OKAY"),postToParent:!1})}.bind(this))}})}({Dialogs:l["@Dialogs"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],TwoFactorChangeEmail:fc,template:dc}),ma=function(g){var b=g.Dialogs.AlloyConfirmDialog;return b.extend("TwoFactorSetupAlert",{uiContextName:"two_factor_setup_alert_dialog",className:"two-factor-setup-alert-dialog",dependencies:["dialogManager","globalStringManager","loginManager","securitySettingsManager"],initialize:function(a){this.__dialogManager=a.dialogManager;this.__stringManager=a.globalStringManager;this.__requireSetup=IMVU.optionalProperty(a,"requireSetup",!0);var c=a.text?a.text:this.__requireSetup?this.__stringManager.get("TwoFactorSetupAlert.text"):this.__stringManager.get("TwoFactorSetupAlert.optional_text");a=_.extend({title:this.__stringManager.get("TwoFactorSetupAlert.title"),html:c,yes:this.__stringManager.get("TwoFactorSetupAlert.setup"),no:this.__requireSetup?this.__stringManager.get("CANCEL"):this.__stringManager.get("TwoFactorSetupAlert.skip")},a);b.prototype.initialize.call(this,a);this.$el.removeClass("can-dismiss")},__onConfirm:function(){this.__dialogManager.showDialog(g.TwoFactorEnrollment,{isEnabling:!0}).finished.then(function(){this.promiseResolver.resolve()}.bind(this)).catch(function(){this.promiseResolver.reject()}.bind(this))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],TwoFactorEnrollment:gc}),S=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=this.escapeExpression;var h='\n<div class="info-line address">'+c((d=a.address||b&&b.address,"function"===typeof d?d.call(b,{name:"address",hash:{},data:e}):d))+'</div>\n<div class="info-line">'+c((d=a.city||b&&b.city,"function"===typeof d?d.call(b,{name:"city",hash:{},data:e}):d))+", ",f=a["if"].call(b,b&&b.state,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e});if(f||0===f)h+=f;h+=" ";if((f=a["if"].call(b,b&&b.postal_code,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===f)h+=f;return h+c((d=a.country||b&&b.country,"function"===typeof d?d.call(b,{name:"country",hash:{},data:e}):d))+"</div>\n"},2:function(b,a,c,e){var d;c=this.escapeExpression;return" "+c((d=a.state||b&&b.state,"function"===typeof d?d.call(b,{name:"state",hash:{},data:e}):d))+" "},4:function(b,a,c,e){var d;c=this.escapeExpression;return" "+c((d=a.postal_code||b&&b.postal_code,"function"===typeof d?d.call(b,{name:"postal_code",hash:{},data:e}):d))+", "},6:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f='\n<div class="info-line card-type">'+c((d=a.card_type||b&&b.card_type,"function"===typeof d?d.call(b,{name:"card_type",hash:{},data:e}):d))+" ";if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"ending in",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+" -"+c((d=a.last_four_digits||b&&b.last_four_digits,"function"===typeof d?d.call(b,{name:"last_four_digits",hash:{},data:e}):d))+"</div>\n"},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;c='<div class="info-line name-on-card">'+c((d=a.name||b&&b.name,"function"===typeof d?d.call(b,{name:"name",hash:{},data:e}):d))+"</div>\n";if((d=a["if"].call(b,b&&b.address,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n";if((d=a["if"].call(b,b&&b.last_four_digits,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===d)c+=d;return c},useData:!0})}({}),na=function(g){var b=[{name:"americanexpress",pattern:/^3[47]/},{name:"jcb",pattern:/^35(2[89]|[3-8][0-9])/},{name:"visa",pattern:/^4/},{name:"mastercard",pattern:/^5[1-5]/},{name:"discover",pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/}];return{getType:function(a){for(var c=$jscomp.makeIterator(b),e=c.next();!e.done;e=c.next())if(e=e.value,a.match(e.pattern))return e.name;return null},passesChecksum:function(a){for(var c=0,e=!1,d=a.length-1;0<=d;d--){var h=a.charAt(d);h=parseInt(h,10);e&&(h*=2,9<h&&(h-=9));c+=h;e=!e}return 0===c%10}}}({}),oa=function(g){var b=g.UiCore.UiContext;return b.extend("BillingInfo",{className:"billing-info",uiContextName:"billing_info",dependencies:["globalStringManager"],initialize:function(a){b.prototype.initialize.call(this,a);this.__billingInfo=IMVU.requireProperty(a,"billingInfo");this.__CCValidator=g.CCValidator;this.addToDOM()},render:function(){var a="",c="";this.__billingInfo.credit_card&&(a=this.__CCValidator.getType(this.__billingInfo.credit_card),c=this.__billingInfo.credit_card.substring(this.__billingInfo.credit_card.length-4));this.$el.html(g.template({name:this.__billingInfo.name,address:this.__billingInfo.address,city:this.__billingInfo.city,state:this.__billingInfo.state,postal_code:this.__billingInfo.postal_code,country:this.__billingInfo.country,card_type:this.__globalStringManager.get("card_type_"+(a?a:"other")),last_four_digits:c}))}})}({UiCore:l["@UiCore"],CCValidator:na,template:S}),pa=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("MultiCartSuccessDialog",{uiContextName:"multicart_success_dialog",className:"multicart-success-dialog dialog-type-B text-none",dependencies:"cart dialogManager dollarStoreManager featureAccessManager globalStartupModel globalStringManager loginManager modeManager onboardingGamificationManager orderResponse prefsManager securitySettingsManager timestampHelper window".split(" "),trackedEvents:function(){return[{type:"click",selector:".btn.btn-primary",name:"multicart_success_done",handler:"__done"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__coreDollarstoreProductOfferingData=IMVU.optionalProperty(a,"coreDollarstoreProductOfferingData",null);this.$el.removeClass("can-dismiss");this.__prefsManager=a.prefsManager;this.__hideCalled=!1;this.__origin=IMVU.optionalProperty(a,"origin",null);this.__billingInfo=IMVU.optionalProperty(a,"billingInfo",null);this.__altTitle=IMVU.optionalProperty(a,"altTitle",null);this.__vipModel=IMVU.optionalProperty(a,"vipModel",null);this.__channel=IMVU.optionalProperty(a,"channel",null);this.isVcoinAsAPaymentMethod=!1;this.title=this.__altTitle?this.__altTitle:this.__globalStringManager.get("payment_success_title");this.ok=this.__globalStringManager.get("payment_success_button");this.__creditsPurchased=this.__vipSubscriptionPurchased=!1;a=IMVU.optionalProperty(a,"cart",[]);this.isVcoinAsAPaymentMethod=a.isVcoinAsAPaymentMethod?!0:!1;for(var c=0;c<a.length;c++){var e=a[c].get("node");var d=e.category;var h=e.code_name;this.__setBadgeLocalStorage(d,h);"credits"===d?this.__creditsPurchased=e.credits:"vip"===d?(this.__vipSubscriptionPurchased=!0,["vip_web_tier_1","vip_web_tier_2","vip_web_tier_3"].includes(h)?this.__vipTierPurchased=h:this.__vipTierPurchased="legacy"):"vcoin"===d&&(this.__vcoinPurchased=!0)}this.addToDOM()},postRender:function(){var a=!1,c=this.__timestampHelper.orderDate(this.__orderResponse.get("order_date")),e=this.__globalStringManager.get("order_thankyou");this.__billingInfo&&(a=this.__billingInfo.name?!0:!1);var d=this.__globalStringManager.get("order_status_message");null!==this.__coreDollarstoreProductOfferingData&&this.__coreDollarstoreProductOfferingData.isAGift&&(e=this.__globalStringManager.get("order_thankyou_gifting"),d=this.__globalStringManager.get("order_status_message_gifting_1")+" "+this.__coreDollarstoreProductOfferingData.recipientDisplayName+" "+this.__globalStringManager.get("order_status_message_gifting_2"));"paypal"===this.__channel?null===this.__vipModel&&(d=this.__globalStringManager.get("paypal_order_status_message")):"paymentwall"===this.__channel&&(d=this.__globalStringManager.get("paymentwall_order_status_message"));var h=parseFloat(this.__orderResponse.attributes["order.price"]).toFixed(2);this.setContent("body",g.template({status_prompt:e,cart:this.__cart,has_name:a,billingInfo:this.__billingInfo,order_date:c,order_id:this.__orderResponse.attributes["order.cash_orders_id"],order_total:h,status_message:d,notPaymentWall:"paymentwall"!==this.__channel}));a?this.createChildContext(g.BillingInfo,{$replaceElement:this.$(".billing-info"),billingInfo:this.__billingInfo}):this.__billingInfo&&!0===this.__billingInfo.saved_card&&this.$(".billing-info").html(g.billingTemplate({last_four_digits:this.__billingInfo.last_four_digits,card_type:this.__globalStringManager.get("card_type_"+this.__billingInfo.card_type)}));this.setContent("footer",this.$(".dialog-footer-template").text());if(this.__window._qevents)for(a=0;a<this.__cart.length;a++)c={qacct:"p-EAkvGxbXCcR77",uid:this.__myCid.toString(),orderid:this.__orderResponse.attributes["order.cash_orders_id"],revenue:this.__cart[a].attributes.edge.sale_price.toString(),event:"refresh"},"vip"==this.__cart[a].attributes.node.category?(c.labels="_fp.event.VIP Confirmation Page,_fp.pcat.vip",this.__window._qevents.push(c)):"upgrade"==this.__cart[a].attributes.node.category&&"access_pass"==this.__cart[a].attributes.node.code_name&&(c.labels="_fp.event.AP Confirmation Page,_fp.pcat.upgrade",this.__window._qevents.push(c));if("creatorlanding"===this.__modeManager.uiApplication){var f=[],k=0;_.each(this.__cart,function(m){f.push({product_name:m.attributes.node.code_name,product_id:m.attributes.node.product_packages_id.toString(),product_category:m.attributes.node.category,product_price:m.attributes.edge.sale_price,product_quantity:1});k+=m.attributes.edge.sale_price});try{k=parseFloat(k.toFixed(2)),this.__window.pintrk("track","checkout",{value:k,order_quantity:this.__cart.length,currency:"USD",order_id:this.__orderResponse.attributes["order.cash_orders_id"],line_items:f},function(m,n){m||this.__appMonitor.reportCustomError("MultiCartSuccess","postRender","web_perm_0005l","Error returned from pintrk callback",["Reported Error: "+n])}.bind(this))}catch(m){this.__appMonitor.reportCustomError("MultiCartSuccess","postRender","web_perm_0005e","Error thrown in call to window.pintrk",["Reported Error: "+m.message])}}},__onClose:function(a){a.preventDefault();this.__done();this.hide()},__done:function(){var a=this;this.__recordEvent("click",{name:"dialog_close"});!1===this.__creditsPurchased||this.__myself.get("is_vip")?this.__vipSubscriptionPurchased?(this.__prefsManager.setBool("next.subscriptions.has_active_vip",!0),this.__prefsManager.set("next.subscriptions.active_tier_vip",this.__vipTierPurchased),this.promiseResolver.resolve("clear_cart"),this.hide(),"store"===this.__modeManager.getCurrentMode().id&&(this.__window.location="/next/store/cart")):this.__vcoinPurchased?(this.__featureAccessManager.canSeeOnboardingGamification()&&this.__recordEvent("onboarding",{name:"grant_reward",event_type:"vcoin_purchase",cid:this.__myself.get("legacy_cid"),record:!0}),this.hide(),this.__securitySettingsManager.get("2fa_enabled").then(function(c){c["2fa_enabled"]?a.promiseResolver.resolve():a.__dialogManager.showDialog(g.TwoFactorSetupAlertDialog,{requireSetup:!1}).finished.then(function(){return a.promiseResolver.resolve()}).catch(function(){return a.promiseResolver.resolve()})}).catch(function(c){a.__window.console.log("Something went wrong:",c);a.promiseResolver.resolve()})):(this.promiseResolver.resolve("clear_cart"),this.hide(),this.__modeManager.getCurrentMode()&&"store"===this.__modeManager.getCurrentMode().id&&(this.__window.location="/next/store/cart")):this.__dialogManager.confirm({title:this.__globalStringManager.get("vip_credit_upsell_title"),text:this.__globalStringManager.get("vip_credit_upsell_body",{credits:this.__creditsPurchased}),yes:this.__globalStringManager.get("vip_credit_upsell_yes"),no:this.__globalStringManager.get("vip_credit_upsell_no")}).finished.then(function(){a.__dialogManager.closeAll();a.__dollarStoreManager.makeVIPUpsell()}).catch(function(){a.promiseResolver.resolve("clear_cart");a.hide();a.__dialogManager.closeAll();"store"===a.__modeManager.getCurrentMode().id&&(a.__window.location="/next/store/cart")})},__handleHostSubRedirectMessageLinkClick:function(){this.__modeManager.openMode({mode:{id:"chat"},submode:{id:"my_rooms"}})},__setBadgeLocalStorage:function(a,c){"vip"===a?this.__setBadgeLocalStorageHelper("is_vip"):"upgrade"===a&&"access_pass"===c&&this.__setBadgeLocalStorageHelper("is_ap")},__setBadgeLocalStorageHelper:function(a){var c={value:!0,expiry:(new Date).getTime()+3e5};localStorage.setItem(a,JSON.stringify(c))},hide:function(){this.__hideCalled||(this.__hideCalled=!0,b.prototype.hide.call(this))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],BillingInfo:oa,TwoFactorSetupAlertDialog:ma,billingTemplate:S,template:cc}),qa=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("MultiCartAbstractBaseDialog",{dependencies:"dollarStoreManager featureAccessManager loginManager Promise rest restModelFactory".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.restModelFactory=a.restModelFactory;this.__eProtectResponse=null},_test_getPoid:function(){return this.__productOfferingID},_testSetBillingInfo:function(a){this.__billingInfo=a},__processingOldDollarstoreProductOffering:function(){return this.__window.location.href.includes("/checkout/")},__getCoreDollarstoreProductOfferingUrlAndId:function(){if(!this.__processingOldDollarstoreProductOffering())return{url:null,id:null};var a=this.__globalStartupModel.get("oldDollarstoreBypassProductOfferingUrl"),c=null;a&&(c=a.split("-"),c=c[c.length-1]);return{url:a,id:c}},__getProductOfferingDataFromCoreDS:function(){var a=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=a.url;this.__coreDollarstoreProductOfferingId=a.id;this.__coreDollarstoreProductOfferingPromise=this.__coreDollarstoreProductOfferingRecipient=this.__coreDollarstoreProductOfferingPurchaser=this.__coreDollarstoreProductOfferingData=null;null!==this.__coreDollarstoreProductOfferingUrl&&(this.__coreDollarstoreProductOfferingPromise=this.__rest.get(this.__coreDollarstoreProductOfferingUrl),this.__coreDollarstoreProductOfferingPromise.then(function(c){this.__coreDollarstoreProductOfferingResponse=c.response;this.__coreDollarstoreProductOfferingPurchaser=this.track(this.restModelFactory.readModel(this.__coreDollarstoreProductOfferingResponse.relations.purchaser,g.UiCore.NodeModel));this.__coreDollarstoreProductOfferingRecipient=this.track(this.restModelFactory.readModel(this.__coreDollarstoreProductOfferingResponse.relations.recipient,g.UiCore.NodeModel));this.__coreDollarstoreProductOfferingPurchaserPromise=this.__coreDollarstoreProductOfferingPurchaser.populated();this.__coreDollarstoreProductOfferingRecipientPromise=this.__coreDollarstoreProductOfferingRecipient.populated();this.__Promise.every([this.__coreDollarstoreProductOfferingPurchaserPromise,this.__coreDollarstoreProductOfferingRecipientPromise]).then(function(){this.__purchaserID=this.__coreDollarstoreProductOfferingPurchaser.get("legacy_cid");this.__purchaserDisplayName=this.__coreDollarstoreProductOfferingPurchaser.get("display_name");this.__recipientID=this.__coreDollarstoreProductOfferingRecipient.get("legacy_cid");this.__recipientDisplayName=this.__coreDollarstoreProductOfferingRecipient.get("display_name");this.__coreDollarstoreProductOfferingData={isAGift:this.__purchaserID!==this.__recipientID,purchaserID:this.__purchaserID,purchaserDisplayName:this.__purchaserDisplayName,recipientID:this.__recipientID,recipientDisplayName:this.__recipientDisplayName}}.bind(this))}.bind(this)).catch(function(c){this.__window.console.error("MultiCartAbstractDialog::__getProductOfferingDataFromCoreDS - error - failed to get product offering",c)}.bind(this)));return this.__coreDollarstoreProductOfferingPromise},creditCardCheckout:function(a){this.__productOfferingID=null;return new this.__Promise(function(c){var e={cart:a.models,cc_payment:this.__billingInfo};!0===this.__billingInfo.saved_card?(e.payment_method="saved_cc_payment",e.card_id=this.__billingInfo.card_id):(e.eprotect=this.__eProtectResponse,e.payment_method="cc_payment");this.__productOfferingID=a.models[0].attributes.edge.product_offering_id;var d=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=d.url;this.__coreDollarstoreProductOfferingId=d.id;this.__coreDollarstoreProductOfferingUrl&&(this.__productOfferingID=this.__coreDollarstoreProductOfferingId);this.__submitVantivOrder(e,this.__productOfferingID).then(function(h){this.__setProcessing(!1);if("delivered"===h.attributes["order.status"]&&"success"===h.attributes["transaction.status"]){var f={expiry:(new Date).getTime()+3e5};localStorage.setItem("successfulVantivOrder",JSON.stringify(f));this.__hostSubscriptionChanged&&(f=parseInt(h.get("order.date_purchased").substring(8,10)),this.__hostSubscriptionChangedText=this.__globalStringManager.get("subscription_changed_text_part_1")+String(f),this.__hostSubscriptionChangedText=1===f||21===f||31===f?this.__hostSubscriptionChangedText+"st, ":2===f||22===f?this.__hostSubscriptionChangedText+"nd, ":3===f||23===f?this.__hostSubscriptionChangedText+"rd, ":this.__hostSubscriptionChangedText+"th, ",this.__hostSubscriptionChangedText+=this.__globalStringManager.get("subscription_changed_text_part_2"));h={billingInfo:this.__billingInfo,cart:a.models,orderResponse:h,channel:"vantiv"};this.__hostSubscriptionChanged&&(h.hostSubscriptionChangedText=this.__hostSubscriptionChangedText);this.__origin&&(h.origin=this.__origin);h.coreDollarstoreProductOfferingData=this.__coreDollarstoreProductOfferingData;this.__dialogManager.showDialog(g.MultiCartSuccess,h).finished.then(function(){return c.accept()}.bind(this)).catch(function(){return c.reject()}.bind(this))}else this.__dialogManager.showDialog(g.MultiCartError,{response:h,keys:h.attributes["transaction.customer_messages"]}).finished.then(function(k){return c.reject("order_fail")}.bind(this)).catch(function(){return c.reject("order_fail")}.bind(this))}.bind(this)).catch(function(h){this.__setProcessing(!1);return this.__displayExceptionDialog(h)}.bind(this))}.bind(this))},vcoinCheckout:function(a){this.__productOfferingID=null;return new this.__Promise(function(c){var e={cart:a.models};this.__productOfferingID=a.models[0].attributes.edge.product_offering_id;var d=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=d.url;this.__coreDollarstoreProductOfferingId=d.id;this.__coreDollarstoreProductOfferingUrl&&(this.__productOfferingID=this.__coreDollarstoreProductOfferingId);this.__submitVcoinOrder(e,this.__productOfferingID).then(function(h){this.__setProcessing(!1);if("delivered"===h.attributes["order.status"]&&"success"===h.attributes["transaction.status"]){var f={value:!0,expiry:(new Date).getTime()+3e5};localStorage.setItem("successfulVcoinOrder",JSON.stringify(f));this.__hostSubscriptionChanged&&(f=parseInt(h.get("order.date_purchased").substring(8,10)),this.__hostSubscriptionChangedText=this.__globalStringManager.get("subscription_changed_text_part_1")+String(f),this.__hostSubscriptionChangedText=1===f||21===f||31===f?this.__hostSubscriptionChangedText+"st, ":2===f||22===f?this.__hostSubscriptionChangedText+"nd, ":3===f||23===f?this.__hostSubscriptionChangedText+"rd, ":this.__hostSubscriptionChangedText+"th, ",this.__hostSubscriptionChangedText+=this.__globalStringManager.get("subscription_changed_text_part_2"));h={cart:a.models,orderResponse:h,channel:"vcoin"};this.__hostSubscriptionChanged&&(h.hostSubscriptionChangedText=this.__hostSubscriptionChangedText);this.__origin&&(h.origin=this.__origin);h.coreDollarstoreProductOfferingData=this.__coreDollarstoreProductOfferingData;this.__dialogManager.showDialog(g.MultiCartSuccess,h).finished.then(function(){return c.accept()}.bind(this)).catch(function(){return c.reject()}.bind(this))}else this.__dialogManager.showDialog(g.MultiCartError,{response:h,keys:h.attributes["transaction.customer_messages"]}).finished.then(function(k){this.promiseResolver.resolve("clear_cart");return c.reject("order_fail")}.bind(this)).catch(function(){this.promiseResolver.resolve("clear_cart");return c.reject("order_fail")}.bind(this))}.bind(this)).catch(function(h){this.__setProcessing(!1);return this.__displayExceptionDialog(h)}.bind(this))}.bind(this))},__setProcessing:function(a){this.$el.toggleClass("loading",a);a?(this.$el.removeClass("can-dismiss"),this.isUncancellableDialog=!0,this.__window.$("body").addClass("waiting")):(this.$el.addClass("can-dismiss"),this.isUncancellableDialog=!1,this.__window.$("body").removeClass("waiting"));this.$(".payment-input").prop("disabled",a);this.$(".dialog-x").prop("disabled",a);this.$("button.checkout").prop("disabled",a)},__openPaypalWindow:function(){var a=!0;this.__closePaypalWindow();this.__paypalUrl=this.__externalNextRoot.replace("next/","paypal/loading/");this.__paypalWindow=this.__window.open(this.__paypalUrl,"_blank");if(!this.__paypalWindow||this.__paypalWindow.closed||"undefined"===typeof this.__paypalWindow.closed)a=!1;return a},__closePaypalWindow:function(){this.__paypalWindow&&(this.__paypalWindow.close(),this.__paypalWindow=null)},__calculateTotal:function(a){var c=0;_.each(a,function(e){e.isCheckedoutModel&&(c+=parseFloat(e.attributes.edge.sale_price))}.bind(this));return c.toFixed(2)},__displayExceptionDialog:function(a){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_failed_title"),text:this.__globalStringManager.get("payment_failed_text"),ok:this.__globalStringManager.get("payment_failed_button")}).finished.then(function(c){this.promiseResolver.resolve("clear_cart")}.bind(this)).catch(function(c){this.promiseResolver.resolve("clear_cart")}.bind(this))},__displayMultiErrorDialog:function(a,c){return this.__dialogManager.showDialog(g.MultiCartError,{response:a,keys:c}).finished.then(function(e){this.promiseResolver.resolve("clear_cart")}.bind(this)).catch(function(e){this.promiseResolver.resolve("clear_cart")}.bind(this))},__displayPaypalWindowErrorDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("Error"),text:this.__globalStringManager.get("PAYPAL ERROR OPENING WINDOW"),ok:this.__globalStringManager.get("checkout_error_button")}).finished.then(function(a){this.promiseResolver.reject()}.bind(this))},__buildOrderSelection:function(a){var c=[];_.each(a,function(e){if(e.isCheckedoutModel){var d=_.indexOf(_.pluck(c,"product_packages_id"),e.attributes.node.product_packages_id);-1===d?c.push({product_packages_id:e.attributes.node.product_packages_id,count:e.attributes.edge.selected_count?e.attributes.edge.selected_count:1}):c[d].count+=1}}.bind(this));return c},_testSetChannel:function(a){this.__channel=a},__submitVantivOrder:function(a,c){var e=this.serviceProvider.get("vantiv_threat_metrics_id"),d=this.__globalStartupModel.get("cashOrderTrans"),h=this.__calculateTotal(a.cart),f=this.__buildOrderSelection(a.cart);c={total:h,product_offering_id:c,selected:f};c.payment_authorization_info={tmxsid:e,payment_method:this.__channel.attributes.payment_method,channel:this.__channel.attributes.channel_key,eprotect:a.eprotect};"cc_payment"===a.payment_method?(c.payment_authorization_info.card_name=a.cc_payment.name,c.payment_authorization_info.card_address=a.cc_payment.address,c.payment_authorization_info.card_city=a.cc_payment.city,c.payment_authorization_info.card_state=a.cc_payment.state,c.payment_authorization_info.card_country=a.cc_payment.country,c.payment_authorization_info.card_zipcode=a.cc_payment.postal_code,c.payment_authorization_info.save_card=!0===a.cc_payment.save_card?1:0):"saved_cc_payment"===a.payment_method&&(c.payment_authorization_info.use_saved_card=1,c.payment_authorization_info.saved_card_id=a.card_id);return this.__restModelFactory.createModel(d,g.UiCore.NodeModel,c)},__submitVcoinOrder:function(a,c){var e=this.__globalStartupModel.get("cashOrderTrans"),d=this.__calculateTotal(a.cart);a=this.__buildOrderSelection(a.cart);c={total:d,product_offering_id:c,selected:a};c.payment_authorization_info={payment_method:this.__channel.attributes.payment_method,channel:this.__channel.attributes.channel_key};return this.__restModelFactory.createModel(e,g.UiCore.NodeModel,c)},__paypalCheckout:function(a,c){return new this.__Promise(function(e){if(this.__openPaypalWindow()){this.__setProcessing(!0);var d=c.models[0].attributes.edge.product_offering_id,h=this.__globalStartupModel.get("cashOrderTrans"),f=this.__buildOrderSelection(c.models);d={total:this.__calculateTotal(c.models),product_offering_id:d,selected:f};d.payment_authorization_info={payment_method:a.attributes.payment_method,channel:a.attributes.channel_key};this.__restModelFactory.createModel(h,g.UiCore.NodeModel,d).then(function(k){this.__paypalWindow&&!this.__paypalWindow.closed?(this.__paypalWindow.location=k.get("transaction.auth_url"),this.__showWaitStatusForPaypal(),this.__waitForPaypalResponse(k).then(function(){this.__setProcessing(!1);this.__dialogManager.showDialog(g.MultiCartSuccess,{cart:c.models,vipModel:this.__vipModel,orderResponse:k,altTitle:this.__globalStringManager.get("PAYPAL PROCESS PENDING TITLE"),channel:"paypal",origin:this.__origin}).finished.then(function(m){return e.accept("finished_order_success")}.bind(this)).catch(function(m){return e.accept("finished_order_fail")}.bind(this))}.bind(this)).catch(function(m){this.__displayMultiErrorDialog(k,["paypal_tab_pending"]);return e.accept("finished_order_fail")}.bind(this))):(this.__displayMultiErrorDialog(k,["paypal_tab_error"]),this.__closePaypalWindow())}.bind(this)).catch(function(k){this.__setProcessing(!1);return this.__displayExceptionDialog(k)}.bind(this))}else this.__displayPaypalWindowErrorDialog().then(function(){return e.reject("fail to load paypal window tab")}.bind(this))}.bind(this))},__showWaitStatusForPaypal:function(){this.$(".dialog-container .dialog-header .dialog-title").text(this.__globalStringManager.get("PayPal"));this.$(".checkout-container").addClass("hidden");this.$(".other-checkout-container").addClass("hidden");this.$(".pending-panel").removeClass("hidden");this.$(".dialog-footer .checkout").prop("disabled",!1);this.$(".dialog-footer .checkout").addClass("paypalpending");this.$(".dialog-footer .checkout.paypalpending").text(this.__globalStringManager.get("CANCEL"));this.$(".dialog-footer .checkout.paypalpending").on("click",function(){this.__setProcessing(!1);this.__closePaypalWindow();this.close()}.bind(this))},__waitForPaypalResponse:function(a){this.__response=a;return new this.__Promise(function(c){this.track(this.__response);return this.listenTo(this.__response,"change",function(){this.untrack(this.__response);this.stopListening(this.__response,"change");this.__response.populated().then(function(e){return"delivered"===e.get("order.status")||"need_ipn"===e.get("order.status")||"authorized"===e.get("order.status")||"pended"===e.get("order.status")||"paid"===e.get("order.status")?c.accept("delivered"):c.reject("failed")}.bind(this))}.bind(this))}.bind(this))},__paymentWallCheckout:function(a,c){return new this.__Promise(function(e){var d=c.models[0].attributes.edge.product_offering_id,h=this.__buildOrderSelection(c.models);d={total:this.__calculateTotal(c.models),product_offering_id:d,selected:h};d.payment_authorization_info={payment_method:a.attributes.payment_method,channel:a.attributes.channel_key};h=this.__globalStartupModel.get("cashOrderTrans");this.__restModelFactory.createModel(h,g.UiCore.NodeModel,d).then(function(f){"need_auth"===f.attributes["transaction.status"]?this.__dialogManager.showDialog(g.PaymentWallDialog,{src:f.attributes["transaction.auth_url"],paymentWallChan:a.attributes.channel_key}).finished.then(function(){this.__paymentWallPendingDialog(c,f).then(function(k){return e.accept("delivered")}.bind(this))}.bind(this)).catch(function(){this.__paymentWallPendingDialog(c,f).then(function(k){return e.accept("delivered")}.bind(this))}.bind(this)):this.__displayMultiErrorDialog(f,f.attributes["transaction.customer_messages"])}.bind(this)).catch(function(f){this.__displayExceptionDialog(f)}.bind(this))}.bind(this))},__paymentWallPendingDialog:function(a,c){return new this.__Promise(function(e){this.__dialogManager.showDialog(g.MultiCartSuccess,{cart:a.models,orderResponse:c,altTitle:this.__globalStringManager.get("PAYMENTWALL_PURCHASE_INFO_TITLE"),channel:"paymentwall"}).finished.then(function(){return e.accept("finished_order_success")}.bind(this)).catch(function(){return e.accept("finished_order_success")}.bind(this))}.bind(this))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],MultiCartError:Zb,MultiCartSuccess:pa,PaymentWallDialog:bc}),hc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){c="\n        ";var d=a.unless.call(b,(d=b&&b.attributes,null==d||!1===d?d:d.saved_card),{name:"unless",hash:{},fn:this.program(2,e),inverse:this.program(4,e),data:e});if(d||0===d)c+=d;return c+"\n    "},2:function(b,a,c,e){var d;a=this.escapeExpression;return"\n            <li id='"+a((d=b&&b.id,"function"===typeof d?d.apply(b):d))+"'>\n                    <span class='name'>\n                        "+a((d=(d=b&&b.attributes,null==d||!1===d?d:d.display_name),"function"===typeof d?d.apply(b):d))+"\n                    </span>\n                <img src='"+a((d=(d=b&&b.attributes,null==d||!1===d?d:d.icon_url),"function"===typeof d?d.apply(b):d))+"'>\n            </li>\n        "},4:function(b,a,c,e){var d,h;c=this.escapeExpression;var f=a.helperMissing,k="\n            <li id='"+c((d=b&&b.id,"function"===typeof d?d.apply(b):d))+"'>\n                <div class='card-info'>\n                    <p class='card-num'>\n                        XXXX-XXXX-XXXX-"+c((d=(d=b&&b.attributes,null==d||!1===d?d:d.card_last_digits),"function"===typeof d?d.apply(b):d))+"\n                    </p>\n                    <p class='expires'>\n                        <span class='card-type'>"+c((d=(d=b&&b.attributes,null==d||!1===d?d:d.card_type),"function"===typeof d?d.apply(b):d))+"</span>\n                        <span class='card-expire'>";if((d=(h=a["i18n-g"]||b&&b["i18n-g"]||f,h.call(b,"CARD EXPIRY",{name:"i18n-g",hash:{},data:e})))||0===d)k+=d;return k+" "+c((d=(d=b&&b.attributes,null==d||!1===d?d:d.expiry),"function"===typeof d?d.apply(b):d))+"</span>\n                    </p>\n                </div>\n            </li>\n        "},6:function(b,a,c,e){var d,h=a.helperMissing;c="\n        <li id='other-payment-type'>\n            <span class='name'>";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"OTHER PAYMENT TYPE PLURAL",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"\n                <span class='right-arrow'></span>\n            </span>\n        </li>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c="<ul class='payment-channel-list'>\n    ";var d=a.each.call(b,b&&b.channels,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(d||0===d)c+=d;c+="\n    ";if((d=a["if"].call(b,b&&b.hasOtherChannels,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===d)c+=d;return c+"\n</ul>"},useData:!0})}({}),ic=function(g){var b=g.UiCore.UiContext;return b.extend("PaymentChannels",{className:"payment-channels",uiContextName:"payment_channels",dependencies:[],initialize:function(a){b.prototype.initialize.call(this,a);this.__channels=IMVU.requireProperty(a,"channels");this.__hasOtherChannels=IMVU.requireProperty(a,"hasOtherChannels");this.addToDOM()},delete:function(){b.prototype.delete.call(this)},render:function(){this.$el.html(g.template({channels:this.__channels,hasOtherChannels:this.__hasOtherChannels}))}})}({UiCore:l["@UiCore"],template:hc}),jc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=a.helperMissing;var h='\n            <div class=\'vcoin-terms-and-conditions\'>\n                <input type="checkbox" class="checkbox vcoin-checkbox" data-name="has_accepted_vcoin_terms_and_conditions" id=\'vcoin_terms_and_conditions_checkbox\'>\n                <label class="toggle-label" for=\'vcoin_terms_and_conditions_checkbox\'>\n                    <span class="vcoin_terms_and_conditions_checkbox_text">',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vcoin_terms_and_conditions_text",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+=' </span><a class="vcoin-terms-and-conditions-link">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vcoin_terms_and_conditions_link",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</a>\n                </label>\n            </div>\n            "},3:function(b,a,c,e){var d;c=a.helperMissing;var h='\n                <p><a href="https://help.imvu.com/s/article/How-do-the-VIP-5000-Credits-Work" target="_blank">',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_terms_and_conditions_loyalty_credits_link_title",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+="</a> ";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_terms_and_conditions_loyalty_credits_text",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</p>\n            "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='\n<div class="status-block">\n    <ul>\n        <li class="error-message vip-checkbox-missing">',k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"error_vip_checkbox_unchecked",{name:"i18n-g",hash:{},data:e}));if(k||0===k)f+=k;f+='</li>\n        <li class="error-message vcoin-checkbox-missing">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"error_vcoin_checkbox_unchecked",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</li>\n        <li class="error-message vcoin-no-payment-methods">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"VCOIN NO PAYMENT METHODS NOTICE",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</li>\n        <li class="error-message items-unavailable-for-purchase">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"ITEMS UNAVAILBLE FOR PURCHASE",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</li>\n        <li class="notice-message notice-subscription-message hidden">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"SUBSCRIPTION ORDERS PROCESSED SEPARATELY",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</li>\n        <li class="notice-message notice-vcoin-in-cart-message hidden">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"VCOIN PAYMENT METHODS NOTICE",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</li>\n        <li class="notice-message notice-credit-card-only-message hidden">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"CREDIT CARD ONLY PAYMENT METHODS NOTICE",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</li>\n    </ul>\n</div>\n<div class=\"checkout-container\">\n    <p class='title'>";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"CART",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</p>\n    <div class="multi-cart-list-placehoder">\n        <div class="cart-list"></div>\n    </div>\n    <div class="checkout-bottom-container">\n        <div class=\'vip-status-widget\'></div>\n        <div class=\'price-summary\'>\n            <span>';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"TODAYS TOTAL",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="&nbsp;</span><span class='price'>"+h((d=a.total||b&&b.total,"function"===typeof d?d.call(b,{name:"total",hash:{},data:e}):d))+"</span>\n        </div>\n    </div>\n\n    <div class='agreement'>\n        <div class='vip-panel hidden'>\n            <input type=\"checkbox\" class=\"checkbox\" data-name=\"has_accepted_vip_agreement\" id='vip_checkbox'>\n            <label class=\"toggle-label\" for='vip_checkbox'>\n                <span>";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"VIP_AGREEMENT",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</span>\n                <span class="vip-terms-link vip-toc-link tooltip-target bold">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"VIP_AGREEMENT_LINK",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</span>\n            </label>\n            <div class="vip-toc-tooltip">\n                <div class="tooltip-header"><a class="vip-terms-and-conditions-link" href="'+h((d=a.vipTermsURL||b&&b.vipTermsURL,"function"===typeof d?d.call(b,{name:"vipTermsURL",hash:{},data:e}):d))+'" target="_blank">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_dialog_title",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</a></div>\n                <div class="tooltip-body">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_tool_tip_text_part_1",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=' <a class="vip-terms-and-conditions-link" href="'+h((d=a.subscriptionURL||b&&b.subscriptionURL,"function"===typeof d?d.call(b,{name:"subscriptionURL",hash:{},data:e}):d))+'" target="_blank">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_tool_tip_subscription_label",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</a>";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_tool_tip_text_part_2",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=' <a class="vip-terms-and-conditions-link" href="'+h((d=a.helpCenterURL||b&&b.helpCenterURL,"function"===typeof d?d.call(b,{name:"helpCenterURL",hash:{},data:e}):d))+'" target="_blank">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_tool_tip_help_center_label",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</a>";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_tool_tip_text_part_3",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</div>\n            </div>\n        </div>\n        <div class='terms'>\n            ";if((k=a["if"].call(b,b&&b.vcoinInCart,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n            ";if((k=a["if"].call(b,b&&b.tieredVIPInCart,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n            <p class='imvu-terms-and-conditions'>\n                ";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Clicking Checkout",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=" <span class='bold link'>";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"IMVU TERMS AND CONDITIONS",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</span>\n            </p>\n        </div>\n    </div>\n    <p class='title payment-method'>";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"CHOOSE PAYMENT METHOD",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</p>\n    <div class="payment-channels-wrapper"></div>\n</div>\n\n<div class="other-checkout-container"></div>\n\n<div class=\'pending-panel hidden\'>\n    <h2>\n        ';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"PAYPAL STATUS MESG",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='\n    </h2>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary checkout">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"CHECKOUT",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+"</button>\n<\/script>\n"},useData:!0})}({}),kc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d,h;c=this.escapeExpression;var f=a.helperMissing,k="\n            <li class='saved-card-item' id='"+c((d=(d=b&&b.attributes,null==d||!1===d?d:d.id),"function"===typeof d?d.apply(b):d))+"'>\n                <div class='card-info'>\n                    <p class='card-num'>\n                        XXXX-XXXX-XXXX-"+c((d=(d=b&&b.attributes,null==d||!1===d?d:d.card_last_digits),"function"===typeof d?d.apply(b):d))+"\n                    </p>\n                    <p class='expires'>\n                        <span class='card-type'>"+c((d=(d=b&&b.attributes,null==d||!1===d?d:d.card_type),"function"===typeof d?d.apply(b):d))+"</span>\n                        <span class='card-expire'>";if((d=(h=a["i18n-g"]||b&&b["i18n-g"]||f,h.call(b,"CARD EXPIRY",{name:"i18n-g",hash:{},data:e})))||0===d)k+=d;k+=" "+c((d=(d=b&&b.attributes,null==d||!1===d?d:d.expiry),"function"===typeof d?d.apply(b):d))+"</span>\n                    </p>\n                    ";if((d=a["if"].call(b,(d=b&&b.attributes,null==d||!1===d?d:d.is_primary),{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===d)k+=d;return k+"\n                </div>\n            </li>\n        "},2:function(b,a,c,e){var d,h=a.helperMissing;c="\n                        <span class='primary'>";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Primary",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</span>\n                    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h="\n<div class=\"credit-card-container\">\n    <p class='title saved-cards'>",f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"NEW CREDIT CARD",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+="</p>\n    <li class='add-new-credit-card'>\n        <span class='name'>\n            ";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Add a New Credit Card",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="\n        </span>\n        <img src='/common/withme/img/store/payment/payment-creditcard.png'>\n    </li>\n\n    <p class='title saved-cards'>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"SAVED CREDIT CARDS",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</p>\n    <ul class='saved-card-list'>\n        ";if((f=a.each.call(b,b&&b.saved_cards,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===f)h+=f;h+='\n    </ul>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary use">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"USE THIS CARD",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</button>\n<\/script>\n"},useData:!0})}({}),lc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return"\n                    <div class='other-payment-channel-list'>\n                        <span class='name'>PAY WITH VCOIN</span>\n                        <img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'>\n                    </div>\n                "},3:function(b,a,c,e){c="\n            ";if((b=a["if"].call(b,b&&b.isCheckedoutModel,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===b)c+=b;return c+"\n            "},4:function(b,a,c,e){var d;c=this.escapeExpression;var h='\n                <div class="order-row">\n                    <div class="order-item">\n                        <div class="image-container"><img src="'+c((d=(d=(d=b&&b.attributes,null==d||!1===d?d:d.node),null==d||!1===d?d:d.img160x160),"function"===typeof d?d.apply(b):d))+'"></div>\n                        <div class="item-info">\n                            <div class="item-name">'+c((d=(d=(d=b&&b.attributes,null==d||!1===d?d:d.node),null==d||!1===d?d:d.name),"function"===typeof d?d.apply(b):d))+"</div>\n                            ";if((d=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(5,e),inverse:this.program(10,e),data:e}))||0===d)h+=d;h+="\n                        </div>\n                        ";if((d=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(15,e),inverse:this.noop,data:e}))||0===d)h+=d;h+="\n                    </div>\n                </div>\n                ";if((d=a["if"].call(b,b&&b.hasSupportingText,{name:"if",hash:{},fn:this.program(17,e),inverse:this.noop,data:e}))||0===d)h+=d;return h+"\n            "},5:function(b,a,c,e){c="\n                                ";if((b=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(6,e),inverse:this.program(8,e),data:e}))||0===b)c+=b;return c+"\n                            "},6:function(b,a,c,e){var d;a=this.escapeExpression;return"\n                                    <div class=\"product-price\">\n                                        <span class='normal-price img-position'><img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'><span class=\"item-info-price\">"+a((d=(d=(d=b&&b.attributes,null==d||!1===d?d:d.edge),null==d||!1===d?d:d.vcoin_normal_price_formatted),"function"===typeof d?d.apply(b):d))+"</span></span>\n                                        <span class='sale-price' img-position><img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'><span class=\"item-info-price\">"+a((d=(d=(d=b&&b.attributes,null==d||!1===d?d:d.edge),null==d||!1===d?d:d.vcoin_sale_price_formatted),"function"===typeof d?d.apply(b):d))+"</span></span>\n                                    </div>\n                                "},8:function(b,a,c,e){var d;a=this.escapeExpression;return"\n                                    <div class='product-price img-position'><img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'><span class=\"item-info-price\">"+a((d=(d=(d=b&&b.attributes,null==d||!1===d?d:d.edge),null==d||!1===d?d:d.vcoin_sale_price_formatted),"function"===typeof d?d.apply(b):d))+"</span></div>\n                                "},10:function(b,a,c,e){c="\n                                ";if((b=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(11,e),inverse:this.program(13,e),data:e}))||0===b)c+=b;return c+"\n                            "},11:function(b,a,c,e){var d;a=this.escapeExpression;return"\n                                    <div class=\"product-price\">\n                                        <span class='normal-price'>"+a((d=(d=(d=b&&b.attributes,null==d||!1===d?d:d.edge),null==d||!1===d?d:d.normal_price_formatted),"function"===typeof d?d.apply(b):d))+"</span>\n                                        <span class='sale-price'>"+a((d=(d=(d=b&&b.attributes,null==d||!1===d?d:d.edge),null==d||!1===d?d:d.sale_price_formatted),"function"===typeof d?d.apply(b):d))+"</span>\n                                    </div>\n                                "},13:function(b,a,c,e){var d;a=this.escapeExpression;return'\n                                    <div class="product-price">'+a((d=(d=(d=b&&b.attributes,null==d||!1===d?d:d.edge),null==d||!1===d?d:d.sale_price_formatted),"function"===typeof d?d.apply(b):d))+"</div>\n                                "},15:function(b,a,c,e){var d,h=a.helperMissing;c="\n                            <div class='product-sale'>\n                                <span>";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"SALE",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"4</span>\n                            </div>\n                        "},17:function(b,a,c,e){var d;a=this.escapeExpression;return'\n                    <div class="supporting-text">\n                        '+a((d=b&&b.supportingText,"function"===typeof d?d.apply(b):d))+"\n                    </div>\n                "},19:function(b,a,c,e){return"\n            <img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'>\n            <span class=\"order-total-converted\"></span>\n        "},21:function(b,a,c,e){return'\n            <span class="order-total"></span>\n        '},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="content-container">\n    <div class="content-container-content">\n        <legend class="system-info-header">\n            ',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Payment Method",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='\n        </legend>\n            <div class="info-block">\n                ';if((f=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===f)h+=f;h+='\n                <div class="billing-info"></div>\n            </div>\n\n        <legend class="system-info-header">\n            ';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Cart",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='\n        </legend>\n        <div class="multicart-order-list">\n            ';if((f=a.each.call(b,b&&b.cart,{name:"each",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)h+=f;h+='\n        </div>\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary buy-now">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"BUY",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="\n        <span class=\"item-count\"></span>\n        <span class='items-for'></span>\n        ";if((f=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(19,e),inverse:this.program(21,e),data:e}))||0===f)h+=f;return h+"\n    </button>\n<\/script>\n"},useData:!0})}({}),T=function(g){var b=g.MultiCartAbstractDialog;return b.extend("MultiCartCreditReviewDialog",{uiContextName:"multicart_credit_card_review_dialog",className:"multicart-credit-card-review-dialog dialog-type-B",dependencies:"cart channel dialogManager featureAccessManager globalStartupModel globalStringManager loginManager restModelFactory serviceProvider window".split(" "),trackedEvents:function(){return[{type:"click",selector:".buy-now.standard-purchase",name:"buy_now",handler:this.__onCheckout},{type:"click",selector:".buy-now.in-bypass-experiment",name:"buy_now_bypass_experiment",handler:this.__onCheckout},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(a){b.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.__isCoreDollarStoreBypassPurchase=null!==this.__getCoreDollarstoreProductOfferingUrlAndId().url;this.__getProductOfferingDataFromCoreDS();this.__eProtectResponse=IMVU.optionalProperty(a,"eProtectResponse",null);this.$el.removeClass("can-dismiss");this.__origin=IMVU.optionalProperty(a,"origin",null);this.__channel=IMVU.optionalProperty(a,"channel",null);this.__source=IMVU.optionalProperty(a,"source",null);this.__billingInfo=IMVU.optionalProperty(a,"billingInfo",null);this.title=this.__globalStringManager.get("credit_card_review_title");this.isVcoinAsAPaymentMethod=!1;this.__myself=this.__loginManager.getCurrentUser();this.addToDOM()},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&"pay_with_vcoin_cta"!==this.__source&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.__hostSubscriptionChanged=!1;var a=0,c=0;_.each(this.__cart.models,function(d){d.isCheckedoutModel&&(a+=d.attributes.edge.sale_price,d.hasDiscount=d.attributes.edge.normal_price>d.attributes.edge.sale_price,c++)}.bind(this));"vcoin"===this.__channel.attributes.channel_key?(a=parseFloat(250*a).toFixed(2),this.isVcoinAsAPaymentMethod=!0,this.setContent("body",g.template({cart:this.__cart.models,channel:this.__channel,isVcoinAsAPaymentMethod:this.isVcoinAsAPaymentMethod}))):(a="$"+parseFloat(a).toFixed(2),this.setContent("body",g.template({cart:this.__cart.models})),this.$(".billing-info").html(g.billingTemplate({last_four_digits:this.__billingInfo.last_four_digits,card_type:this.__globalStringManager.get("card_type_"+this.__billingInfo.card_type)})));var e=1===c?this.__stringManager.get("BUY FOR SINGULAR"):this.__stringManager.get("BUY FOR PLURAL");this.setContent("footer",this.$(".dialog-footer-template").text());this.$(".items-for").text(e);this.$(".item-count").text(c);"vcoin"===this.__channel.attributes.channel_key?this.$(".order-total-converted").text(a):this.$(".order-total").text(a);this.__isCoreDollarStoreBypassPurchase?this.$(".buy-now").addClass("in-bypass-experiment"):this.$(".buy-now").addClass("standard-purchase")},__onCheckout:function(){this.__channel.attributes.channel_key&&"vcoin"===this.__channel.attributes.channel_key?(this.__cart.isVcoinAsAPaymentMethod=!0,this.$(".buy-now").addClass("disabled"),this.vcoinCheckout(this.__cart).then(function(){this.promiseResolver.resolve();this.close()}.bind(this)).catch(function(){this.promiseResolver.resolve();this.close()}.bind(this))):(this.$(".buy-now").addClass("disabled"),this.creditCardCheckout(this.__cart).then(function(){this.promiseResolver.resolve();this.close()}.bind(this)).catch(function(){this.promiseResolver.resolve();this.close()}.bind(this)))},__goBack:function(){this.hide();this.promiseResolver.reject()}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],BillingInfo:oa,MultiCartAbstractDialog:qa,billingTemplate:S,template:lc}),mc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'\n            <iframe id="eProtect-iframe" name="eProtect-iframe" frameborder="0" src="https://localhost.imvu.com/third_party/worldpay/eProtect_iframe/nextBig.html" height="150" width="100%"></iframe>\n        '},3:function(b,a,c,e){return'\n            <div class="input-row worldpay-eprotect-iframe" id="eProtectiframe"></div>\n        '},5:function(b,a,c,e){return' checked="checked" '},7:function(b,a,c,e){var d;a=this.escapeExpression;return'\n                    <option value="'+a((d=null==e||!1===e?e:e.key,"function"===typeof d?d.apply(b):d))+'">'+a("function"===typeof b?b.apply(b):b)+"</option>\n                    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="content-container">\n    <div class="error-block">\n        <ul>\n            <li class="error-message field-missing">',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"error_field_missing",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='</li>\n            <li class="error-message cardnumber-invalid">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"error_card_number_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</li>\n            <li class="error-message exp-date-expired">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"error_exp_date_expired",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</li>\n            <li class="error-message security-code-invalid">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"error_security_code_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</li>\n            <li class="error-message zip-invalid">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"error_zip_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</li>\n            <li class="error-message postal-invalid">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"error_postal_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</li>\n            <li class="error-message vip-checkbox-missing">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"error_vip_checkbox_unchecked",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</li>\n            <li class="error-message cardname-invalid">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"error_invalid_cc_name",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</li>\n        </ul>\n    </div>\n    <div class="payment-block">\n        <legend class="system-info-header">\n            ';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Payment Method",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="\n        </legend>\n\n        ";if((f=a["if"].call(b,b&&b.canSeeEprotectCss,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===f)h+=f;h+='\n\n        <div class="input-row save-cc-for-later">\n            <input id=\'save-for-later-checkbox\' class="save-for-later checkbox" tabindex=\'13\' type="checkbox"\n                ';if((f=a["if"].call(b,b&&b.saveCard,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===f)h+=f;h+=">\n            <label for='save-for-later-checkbox'>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Save For Later",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</label>\n        </div>\n    </div>\n    <div class="billing-address-block">\n        <legend class="system-info-header">\n            ';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Billing Information",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="\n        </legend>\n        <div class=\"input-row\">\n            <input class='name-on-card' maxlength='50' tabindex='5' required placeholder='";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Name on Card",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="'>\n        </div>\n        <div class=\"input-row\">\n            <input class='address' maxlength='50' tabindex='6' required placeholder='";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Address",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="'>\n        </div>\n        <div class=\"input-row\">\n            <input class='city' maxlength='20' tabindex='7' required placeholder='";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"City",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="'>\n            <div class='us-fields state-province-container input-container'>\n                <select class='state' tabindex='8' >\n                    <option selected value=\"\">";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"State",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</option>\n                    ";if((f=a.each.call(b,b&&b.states,{name:"each",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)h+=f;h+="\n                </select>\n            </div>\n            <div class='non-us-fields ca-province state-province-container input-container'>\n                <select class='province' tabindex='10'>\n                    <option selected value=\"\">";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Province",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</option>\n                    ";if((f=a.each.call(b,b&&b.provinces,{name:"each",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)h+=f;h+="\n                </select>\n            </div>\n            <input class='us-fields zip' maxlength='5' tabindex='9' placeholder='";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Zipcode",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="'>\n            <input class='non-us-fields postal' maxlength='12' tabindex='11' placeholder='";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Postal Code",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="'>\n            <div class='country-container input-container us'>\n                <select class='country' tabindex='12' required>\n                    <option value=''>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Country",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</option>\n                    ";if((f=a.each.call(b,b&&b.countries,{name:"each",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)h+=f;h+='\n                </select>\n            </div>\n        </div>\n    </div>\n</div>\n\n<footer class="dialog-footer">\n    <button class="btn btn-primary continue-checkout">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Continue to Checkout",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</button>\n</footer>\n"},useData:!0})}({}),nc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="dropdown-label is-truncated"><span>&nbsp;</span></div>\n<div class="dropdown-option-list-container">\n    <div class="dropdown-scroll-up"></div>\n    <div class="dropdown-scroll-down"></div>\n    <ul class="dropdown-option-list">\n        <li class="dropdown-option is-truncated" data-value="" tabindex="-1"></li>\n    </ul>\n</div>\n'},useData:!0})}({}),G=function(g){function b(e){e=$(e.target).closest(".dropdown");$(".dropdown").not(e).each(function(d,h){$(h).data("dropdown-instance").__hide()})}var a=g.UiCore.UiContext,c=g.NextUtil.Keys;return a.extend("Dropdown",{globalSetup:function(){document.addEventListener("click",b,!0);document.addEventListener("touchend",b,!0)},globalTearDown:function(){document.removeEventListener("click",b,!0);document.removeEventListener("touchend",b,!0)},uiContextName:"dropdown",className:"dropdown disable-text-selection",ITEM_HEIGHT:40,AUTO_SCROLL_BY:2,dependencies:["timer","window"],trackedEvents:function(){return[{type:"click",selector:".dropdown-label",name:"dropdown_label_click",handler:"toggleOpen"},{type:"click",selector:".dropdown-option",name:"dropdown_option_click",handler:"clickOption"},{type:"keydown",selector:"",name:"dropdown_keydown",handler:this.__onKeydown.bind(this,[])},{type:"mousemove",selector:".dropdown-option",name:"dropdown_option_mouseenter",handler:this.__onMousemove.bind(this,{x:0,y:0})},{type:"mouseenter",selector:".dropdown-label",name:"dropdown_label_mouseenter",handler:"__onMouseenterLabel"},{type:"mouseenter",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseenter",handler:"__onScrollUpMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseleave",handler:"__onScrollUpMouseleave"},{type:"mouseenter",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseenter",handler:"__onScrollDownMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseleave",handler:"__onScrollDownMouseleave"}]},__onMousemove:function(e,d){if(e.x!=d.screenX||e.y!=d.screenY)e.x=d.screenX,e.y=d.screenY,this.$el.focus(),this.setActiveElement($(d.target))},__onBlur:function(e){this.$el.removeClass("is-open")},__onMouseenterLabel:function(e){this.$(".is-selected").removeClass("is-selected")},initialize:function(e){this.$select=IMVU.requireProperty(e,"$replaceElement");if(!this.$select.is("select"))throw Error("$replaceElement must be a <select> element. got: "+this.$select[0].tagName);if(this.$select.closest("label").length)throw Error("do not wrap custom dropdowns with <label> tags; it disrupts event handling");a.prototype.initialize.call(this,e);this.window=e.window;this.timer=e.timer;this.boundingBox=e.boundingBox||this.getDefaultBoundingBox();this.document=e.document||document;this.__keyArray=[];if(this.dismissOnScroll=e.dismissOnScroll)$(e.dismissOnScroll).on("scroll.dropdown",function(){this.__hide()}.bind(this));$(".dropdown-layer").length||$("body").append('<div class="dropdown-layer"/>');this.$dropdownLayer=$(".dropdown-layer");e.dimNoValue&&this.$el.addClass("dim-no-value");e.lightText&&this.$el.addClass("light-text");e.hideArrow&&this.$el.addClass("hide-arrow");this.$el.data("dropdown-instance",this);this.addToDOM()},delete:function(){this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray);this.dismissOnScroll&&$(this.dismissOnScroll).off("scroll.dropdown");$(this.window).off("resize.dropdown");a.prototype.delete.call(this)},__onHidden:function(){this.$el.is(":visible")&&this.remove();a.prototype.__onHidden.apply(this,arguments)},getDefaultBoundingBox:function(){var e=this.$el.position().top-5*this.ITEM_HEIGHT,d=e+11*this.ITEM_HEIGHT;0>e&&(e=0);d>$(this.window).height()&&(d=$(this.window).height());return{x:0,y:e,w:$(this.window).width(),h:d-e}},render:function(){this.$placeholder=$("<div/>");this.$el.html(g.template);this.$label=this.$(".dropdown-label");this.$optionList=this.$(".dropdown-option-list");this.$optionListContainer=this.$(".dropdown-option-list-container");var e=this.$optionList.find(".dropdown-option");this.$select.addClass("is-enhanced");this.refreshLabel(this.$select.find(":selected"));e.remove();this.$select.children().each(function(d,h){d=e.clone(!0);d.text($(h).text());d.attr("data-text",$(h).text().toLowerCase());d.attr("data-value",$(h).val());this.$optionList.append(d)}.bind(this));this.$el.addClass(this.$select[0].className).removeClass("dropdown-template").addClass("dropdown");this.$label.append(this.$select);this.$el.attr("tabindex",this.$select.attr("tabindex")||"0");this.$select.attr("tabindex",-1);this.$optionList.on("scroll",this.__onScroll.bind(this));this.$select.on("change",this.__changedOption.bind(this));this.$el.addClass("is-ready")},__fullHeight:function(){return this.$select.children().length*this.ITEM_HEIGHT},__getSelectedIndex:function(){return this.$select[0].selectedIndex},__getTopEdgeInViewport:function(e){return e.offset().top-$(this.document).scrollTop()},__getComputedInfo:function(){var e=this.__getTopEdgeInViewport(this.$el),d=this.__fullHeight(),h=this.__getSelectedIndex()*this.ITEM_HEIGHT,f=this.getDefaultBoundingBox().y,k=this.getDefaultBoundingBox().y+this.getDefaultBoundingBox().h,m=e-h,n=m+d;m<f&&(m=f);if(n>k){var q=n-k;n=k;m>f&&(m-=Math.min(m-f,q))}return{projectedTopDiff:m-e,computedHeight:n-m,selectedTop:h,maxTop:f,maxBottom:k,fullHeight:d}},__refreshScrollers:function(){var e=this.$optionList[0].scrollHeight-this.$optionList.innerHeight(),d=0<this.$optionList.scrollTop();e=Math.round(this.$optionList.scrollTop())<e;this.$el.toggleClass("can-scroll-up",d).toggleClass("can-scroll-down",e)},isOpen:function(){return this.$el.hasClass("is-open")},__hide:function(){this.isOpen()&&($(this.window).off("resize.dropdown"),this.$el.removeClass("is-open"),this.$placeholder.before(this.$el).detach(),this.$el.removeAttr("style"))},__show:function(){if(!this.isOpen()){$(this.window).on("resize.dropdown",b);var e=this.$el.offset(),d=this.$el.width(),h=this.$el.height(),f=this.$el.css("margin-left"),k=this.$el.css("margin-right"),m=this.$el.css("margin-top"),n=this.$el.css("margin-bottom"),q=this.$el.css("float");this.$placeholder.css({width:d,height:h,"margin-left":f,"margin-right":k,"margin-top":m,"margin-bottom":n,float:q});this.$el.addClass("is-open").css({top:this.__getTopEdgeInViewport(this.$el),left:e.left,width:d,height:h,"margin-left":0,"margin-right":0,"margin-top":0,"margin-bottom":0});this.$el=this.$el.before(this.$placeholder).detach();this.$dropdownLayer.append(this.$el)}},toggleOpen:function(e){this.isOpen()?this.__hide():(this.__show(),e=this.__getComputedInfo(),this.$optionListContainer.css({top:e.projectedTopDiff,height:e.computedHeight}),this.$el.focus(),e=e.selectedTop+e.projectedTopDiff,this.$optionList.scrollTop(e),this.__lastScrollTop=e,this.setActiveElement(this.$(".dropdown-option").eq(this.__getSelectedIndex())),this.__refreshScrollers());return!1},refreshLabel:function(e){this.$label.find("> span").text(e.text()).toggleClass("no-value",""===e.val())},clickOption:function(e){this.__hide();this.$select.val($(e.target).attr("data-value"));this.$select.trigger("change");b(e)},selectByValue:function(e){this.$(".is-selected").removeClass("is-selected");this.$('.dropdown-option[data-value="'+e+'"]').addClass("is-selected");this.$("select").val(e);e=this.$("select").find(":selected");this.refreshLabel(e)},val:function(){return this.$("select").val()},__changedOption:function(e){e=$(e.target).find(":selected");this.refreshLabel(e)},__maybeScrollOptionIntoView:function(e,d){if(e[0]){var h=this.$el.hasClass("can-scroll-up"),f=this.$el.hasClass("can-scroll-down"),k=this.$optionList,m=k.height(),n=k.offset().top,q=n+m,p=e.outerHeight();e=e.offset().top;var u=e+p,F=e-n+k.scrollTop(),ra=m/2-p/2*3;e<n+(h?p:0)?(d&&(F-=ra),k.scrollTop(F-(h?this.ITEM_HEIGHT:0))):u>q-(f?p:0)&&(d&&(F+=ra),k.scrollTop(F-(m-p)+(f?p:0)))}},__open:function(e){this.isOpen()&&this.$select.val(this.$optionList.find(".is-selected").attr("data-value")).change();this.toggleOpen(e);e=this.$optionList.children().eq(this.$select[0].selectedIndex);g.NextUtil.DomHelper.radioClass(e,"is-selected");return e},__moveSelection:function(e){e=this.$optionList.children().index(this.$optionList.find(".is-selected"))+e;0>e?e=0:e>this.$select.children().length-1&&(e=this.$select.children().length-1);e=this.$optionList.children().eq(e);g.NextUtil.DomHelper.radioClass(e,"is-selected");return e},setActiveElement:function(e){this.__activeElement=e;g.NextUtil.DomHelper.radioClass(e,"is-selected")},__onKeydown:function(e,d){if(!this.isOpen()&&c.is(d,"VK_ENTER")||!this.isOpen()&&c.is(d,"VK_DOWN"))b(this.$el),this.__open(d);else{var h=this.__activeElement&&this.__activeElement.parent()[0]===this.$optionList[0]?this.__activeElement:this.$(".dropdown-option").first();if(c.is(d,"VK_DOWN"))this.__maybeScrollOptionIntoView(h.next()),h.next()[0]&&this.setActiveElement(h.next());else if(c.is(d,"VK_UP"))this.__maybeScrollOptionIntoView(h.prev()),h.prev()[0]&&this.setActiveElement(h.prev());else if(c.is(d,"VK_ENTER"))this.__hide(),this.$select.val(this.__activeElement.attr("data-value")),this.$select.trigger("change"),b(d);else if(c.is(d,"VK_ESC"))b(this.$el);else{var f=c.getAlphaNumericChar(d);if(!1!==f){var k=h[0];this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray);e.push(f);f=e.join("").toLowerCase();for(this.__keyValueArray=this.timer.setTimeout(function(){e.length=0}.bind(this),1e3);k.nextSibling;){k=k.nextSibling;var m=$(k);if(m.attr("data-text")[0]&&g.NextUtil.string.startsWith(m.attr("data-text"),f)){this.isOpen()||this.toggleOpen(d);this.setActiveElement(m);this.__maybeScrollOptionIntoView(m,m[0]!=h[0].nextSibling&&m[0]!=h[0].prevSibling);return}}for(k=this.$(".dropdown-option")[0];k&&k!=h[0];){m=$(k);if(m.attr("data-text")[0]&&g.NextUtil.string.startsWith(m.attr("data-text"),f)){this.isOpen()||this.toggleOpen(d);this.setActiveElement(m);this.__maybeScrollOptionIntoView(m,m[0]!=h[0].nextSibling&&m[0]!=h[0].prevSibling);break}k=k.nextSibling}}}}},__onScroll:function(e){e=this.$optionList.scrollTop();this.__refreshScrollers();this.__lastScrollTop=e},__doScrollUp:function(e,d){e=this.__getComputedInfo();var h=void 0===d?this.AUTO_SCROLL_BY:d;this.$optionListContainer.offset().top+this.$optionListContainer.height()+h<e.maxBottom?(d=this.$optionListContainer.height()+h,d>e.fullHeight&&(d=e.fullHeight),this.$optionListContainer.css({height:d}),this.$optionList[0].scrollTop-=h,this.__refreshScrollers(this.$dropdown)):void 0===d&&(this.$optionList[0].scrollTop-=this.AUTO_SCROLL_BY)},__onScrollUpMouseenter:function(e){this.timer.clearInterval(this.__autoScrollInterval);this.__autoScrollIntervalCounter=0;this.__autoScrollInterval=this.timer.setInterval(function(){this.__doScrollUp(e)}.bind(this),1)},__onScrollUpMouseleave:function(e){this.timer.clearInterval(this.__autoScrollInterval)},__doScrollDown:function(e,d){e=this.__getComputedInfo();var h=void 0===d?this.AUTO_SCROLL_BY:d;if(this.$optionListContainer.offset().top-h>e.maxTop){var f=this.$optionListContainer.height()+h;d=this.$optionListContainer.position().top-h;f>e.fullHeight?f=e.fullHeight:this.$optionListContainer.css({top:d});this.$optionListContainer.css({height:f});this.$optionList[0].scrollTop+=h;this.__refreshScrollers(this.$dropdown)}else void 0===d&&(this.$optionList[0].scrollTop+=this.AUTO_SCROLL_BY)},__onScrollDownMouseenter:function(e){this.timer.clearInterval(this.__autoScrollDownInterval);this.__autoScrollDownIntervalCounter=0;this.__autoScrollDownInterval=this.timer.setInterval(function(){this.__doScrollDown(e)}.bind(this),1)},__onScrollDownMouseleave:function(e){this.timer.clearInterval(this.__autoScrollDownInterval)}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:nc}),sa=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("MultiCartAddCreditCard",{uiContextName:"multicart_add_credit_card_dialog",className:"multicart-add-credit-card-dialog dialog-type-B",dependencies:"appMonitor cart channel currentLocale dialogManager featureAccessManager globalStringManager loginManager moment orderTotal prefsManager timer window".split(" "),trackedEvents:function(){return[{type:"click",selector:".continue-checkout",name:"continue_checkout",handler:this.__continueCheckout},{type:"keyup",selector:".name-on-card",name:"changing_name",handler:this.__isBlankNameOnCard},{type:"blur",selector:".name-on-card",name:"changed_name",handler:this.__validateNameOnCard},{type:"keyup",selector:".address",name:"changing_address",handler:this.__isBlankAddress},{type:"blur",selector:".address",name:"changed_address",handler:this.__validateAddress},{type:"keyup",selector:".city",name:"change_city",handler:this.__isBlankCity},{type:"blur",selector:".city",name:"change_city",handler:this.__validateCity},{type:"change",selector:".state",name:"change_state_select",handler:this.__validateState},{type:"keyup",selector:".zip",name:"changing_zip",handler:this.__isBlankZip},{type:"blur",selector:".zip",name:"changed_zip",handler:this.__validateZip},{type:"change",selector:".province",name:"change_province_select",handler:this.__validateProvince},{type:"keyup",selector:".postal",name:"changing_postal",handler:this.__isBlankPostal},{type:"blur",selector:".postal",name:"changed_postal",handler:this.__validatePostal},{type:"change",selector:".country",name:"change_country_select",handler:this.__validateCountry},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(a){b.prototype.initialize.call(this,a);this.shouldFocusOnPrimaryButton=!1;a.loginManager.isLoggedIn()||(this.__window.onbeforeunload=null,this.__window.location.href=this.__siteRoot);this.title=this.__globalStringManager.get("Add New Credit Card");this.__monthRange="01 02 03 04 05 06 07 08 09 10 11 12".split(" ");this.__getYearRange();this.__states=g.StateMap;this.__provinces=g.ProvinceMap;this.__countries=g.CountryMap;this.__CCValidator=g.CCValidator;this.__missingFields=[];this.__myself=a.loginManager.getCurrentUser();this.__origin=IMVU.optionalProperty(a,"origin",null);this.__isMobile=this.__featureAccessManager.isMobile();this.__eProtectData=this.__serviceProvider.get("worldpayEprotectData");this.__eProtectFailureCodesAccountNumber=this.__eProtectData.eProtectFailureCodesAccountNumber;this.__eProtectFailureCodesCCV=this.__eProtectData.eProtectFailureCodesCCV;this.__canSeeEprotectCss=!1;this.__currentLocale=this.__currentLocale||"en";this.__currentLocale="www"===this.__currentLocale?"en":this.__currentLocale;this.addToDOM()},delete:function(){b.prototype.delete.call(this);this.__tooltip&&this.__tooltip.delete()},close:function(){this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.__prefsManager.populated().then(function(){this.setContent("body",g.template,{monthRange:this.__monthRange,yearRange:this.__yearRange,states:this.__states,provinces:this.__provinces,countries:this.__countries,saveCard:!this.__prefsManager.getBool("next.payment.creditcard.save_card.disable"),canSeeEprotectCss:this.__canSeeEprotectCss});this.$(".non-us-fields").hide();this.$('.country option[value="US"]').prop("selected",!0);this.__stateWidget=this.createChildContext(g.Dropdown,{$replaceElement:this.$(".state")});this.createChildContext(g.Dropdown,{$replaceElement:this.$(".province")});this.createChildContext(g.Dropdown,{$replaceElement:this.$(".country")});this.$(".content-container").scrollbar();this.__tooltip=this.serviceProvider.create(g.Tooltip,{$replaceElement:this.$(".security-code-tooltip"),$tooltipTarget:this.$(".security-code-help-link")});this.__myself.get("is_adult")||this.$(".content-container .save-cc-for-later").addClass("hidden");try{$(document).ready(function(){var a=this.__currentLocale+"NextBig20201012b",c=this.__currentLocale+"NextSmall20201012b";a={paypageId:this.__eProtectData.payPageID,style:this.__isMobile?c:a,reportGroup:this.__eProtectData.reportGroup,timeout:this.__eProtectData.timeout,div:"eProtectiframe",callback:this.__eProtectIframeClientCallback.bind(this),checkoutIdMode:!0,showCvv:!0,months:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},numYears:20,tooltipText:this.__globalStringManager.get("worldpay_eProtext_ccv_tool_tip"),tabIndex:{cvv:1,accountNumber:2,expMonth:3,expYear:4},placeholderText:{cvv:this.__globalStringManager.get("worldpay_eProtext_ccv_text"),accountNumber:this.__globalStringManager.get("worldpay_eProtext_ccv_acc_num")},inputsEmptyCallback:this.__eProtectInputsEmptyCallback.bind(this),enhancedUxFeatures:{inlineFieldValidations:!0}};"undefined"===typeof EprotectIframeClient?(this.__eProtectIframeClient=null,this.__dialogManager.showDialog(g.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("worldpay_eProtext_alert_title"),text:this.__stringManager.get("worldpay_eProtext_alert_text"),ok:this.__stringManager.get("OK")}).finished.then(function(){this.close()}.bind(this)).catch(function(){this.close()}.bind(this))):(this.__eProtectIframeClient=new EprotectIframeClient(a),this.__isMobile?this.$("#eProtect-iframe").attr("height","195"):this.__eProtectIframeClient.autoAdjustHeight())}.bind(this))}catch(a){this.__window.console.error("MultiCartAddCreditCard::postRender - Failed to initialize eprotect",a),this.__appMonitor.reportCustomError("MultiCartAddCreditCard","postRender","web_perm_0011","MultiCartAddCreditCard::postRender - Failed to initialize eprotect",this.__appMonitor.buildErrorArray(a))}}.bind(this))},_test_getEProtectIframeClient:function(){return this.__eProtectIframeClient},__eProtectIframeClientCallback:function(a){var c=parseInt(a.response),e=!1;870!=c&&(this.__eProtectFailureCodesAccountNumber.includes(c)||this.__eProtectFailureCodesCCV.includes(c)||this.__window.console.error("MultiCartAddCreditCard::__eProtectIframeClientCallback - Unrecognized response code ("+String(c)+")"));this.$(".cardnumber-invalid").removeClass("error-visible");this.__eProtectFailureCodesAccountNumber.includes(c)&&(this.$(".cardnumber-invalid").addClass("error-visible"),e=!0);this.$(".security-code-invalid").removeClass("error-visible");this.__eProtectFailureCodesCCV.includes(c)&&(this.$(".security-code-invalid").addClass("error-visible"),e=!0);this.__updateErrorStatus();this.__ccLastFour=a.lastFour;this.__ccType=a.type;this.__eProtectResponse=JSON.stringify(a);0!==this.$(".error-visible").length||e||this.__dialogManager.showDialog(g.MultiCartReview,{billingInfo:this.__getBillingInfo(),channel:this.__channel,cart:this.__cart,origin:this.__origin,eProtectResponse:this.__eProtectResponse}).finished.then(function(d){this.promiseResolver.resolve(d);this.close()}.bind(this)).catch(function(d){"closing_all"===d&&this.close()}.bind(this))},__eProtectInputsEmptyCallback:function(a){this.$(".cardnumber-invalid").addClass("error-visible");this.$(".security-code-invalid").addClass("error-visible");this.$(".exp-date-expired").addClass("error-visible")},__getYearRange:function(){this.__yearRange=[];for(var a=this.__timer.getDate().getFullYear(),c=0;20>c;c++)this.__yearRange.push(c+a)},__validateInputs:function(){this.__billingInfoErrorDetected=!1;this.__validateNameOnCard();this.__validateCardName();this.__validateAddress();this.__validateCity();this.__validateCountry();"US"===this.$(".country select").val()?(this.__validateZip(),this.__validateState()):"CA"===this.$(".country select").val()&&(this.__validatePostal(),this.__validateProvince())},__errorIfBlank:function(a,c){c=c?""===this.$("."+a+" select").val():""===this.$("."+a).val().trim();this.__updateMissingFields(a,c);c&&(this.__billingInfoErrorDetected=!0);return c},__updateMissingFields:function(a,c){this.$("."+a).toggleClass("payment-error",c);var e=this.__missingFields.indexOf(a);c&&0>e?this.__missingFields.push(a):!c&&-1<e&&this.__missingFields.splice(e,1);this.$(".field-missing").toggleClass("error-visible",0!==this.__missingFields.length)},__validateCardName:function(){var a=this.$(".name-on-card").val().trim(),c=a.trim().split(/\s+/).length;/\d/.test(a)||2>c?(this.$(".cardname-invalid").addClass("error-visible"),this.$(".name-on-card").addClass("payment-error")):(this.$(".cardname-invalid").removeClass("error-visible"),this.$(".name-on-card").removeClass("payment-error"));this.__updateErrorStatus()},__isBlankNameOnCard:function(){-1<this.__missingFields.indexOf("name-on-card")&&this.__errorIfBlank("name-on-card");this.__updateErrorStatus()},__validateNameOnCard:function(){this.__errorIfBlank("name-on-card");this.__updateErrorStatus()},__isBlankAddress:function(){-1<this.__missingFields.indexOf("address")&&this.__errorIfBlank("address");this.__updateErrorStatus()},__validateAddress:function(){this.__errorIfBlank("address");this.__updateErrorStatus()},__isBlankCity:function(){-1<this.__missingFields.indexOf("city")&&this.__errorIfBlank("city");this.__updateErrorStatus()},__validateCity:function(){this.__errorIfBlank("city");this.__updateErrorStatus()},__validateState:function(){this.__errorIfBlank("state",!0);this.__updateErrorStatus()},__validateProvince:function(){this.__errorIfBlank("province",!0);this.__updateErrorStatus()},__isBlankZip:function(){-1<this.__missingFields.indexOf("zip")&&this.__errorIfBlank("zip");this.__updateErrorStatus()},__validateZip:function(){this.__errorIfBlank("zip")?this.$(".zip-invalid").removeClass("error-visible"):this.$(".zip").val().trim().match(/^\d\d\d\d\d$/)?(this.$(".zip-invalid").removeClass("error-visible"),this.$(".zip").removeClass("payment-error")):(this.$(".zip-invalid").addClass("error-visible"),this.$(".zip").addClass("payment-error"),this.__billingInfoErrorDetected=!0);this.__updateErrorStatus()},__isBlankPostal:function(){"CA"===this.$(".country select").val()&&-1<this.__missingFields.indexOf("postal")&&this.__errorIfBlank("postal");this.__updateErrorStatus()},__validatePostal:function(){"CA"===this.$(".country select").val()&&(this.__errorIfBlank("postal")?this.$(".postal-invalid").removeClass("error-visible"):this.$(".postal").val().trim().match(/^[A-Za-z]\d[A-Za-z]\s*\d[A-Za-z]\d$/)?(this.$(".postal-invalid").removeClass("error-visible"),this.$(".postal").removeClass("payment-error")):(this.$(".postal-invalid").addClass("error-visible"),this.$(".postal").addClass("payment-error"),this.__billingInfoErrorDetected=!0));this.__updateErrorStatus()},__validateCountry:function(){this.$(".zip-invalid").removeClass("error-visible");this.$(".postal-invalid").removeClass("error-visible");this.__updateMissingFields("zip",!1);this.__updateMissingFields("state",!1);this.__updateMissingFields("postal",!1);this.__updateMissingFields("province",!1);this.__errorIfBlank("country",!0);"US"===this.$(".country select").val()?(this.$(".us-fields").show(),this.$(".non-us-fields").hide(),this.$(".country-container").addClass("us"),this.$(".postal").val(""),this.$('.ca-province option[value=""]').prop("selected",!0)):(this.$(".country-container").removeClass("us"),this.$(".us-fields").hide(),this.$(".zip").val(""),this.$('.state option[value=""]').prop("selected",!0),this.$(".non-us-fields").show(),"CA"===this.$(".country select").val()?(this.$(".ca-province").show(),this.$(".country-container").addClass("canada"),this.$(".postal").removeClass("intl")):(this.$(".postal").addClass("intl"),this.$(".ca-province").hide(),this.$('.ca-province option[value=""]').prop("selected",!0),this.$(".country-container").removeClass("canada")));this.__updateErrorStatus()},__updateErrorStatus:function(){this.$(".error-block").toggleClass("has-error",0<this.$(".error-visible").length)},__continueCheckout:function(){this.__validateInputs();if(!this.__billingInfoErrorDetected&&!this.__missingFields.length){var a=this.__moment(new Date).format("YYYYMMDDhhmmss");a={id:String(this.__myself.get("legacy_cid"))+"e"+a,pciNonSensitive:!1};this.__eProtectIframeClient.getPaypageRegistrationId(a)}},__getBillingInfo:function(){var a=this.$(".country select").val(),c=this.$(".state select").val(),e=this.$(".zip").val().trim();"CA"===a?(c=this.$(".province select").val(),e=this.$(".postal").val().trim()):"US"!==a&&(c="",e=this.$(".postal").val().trim());var d=this.__eProtectResponse,h=this.__ccLastFour,f=this.__ccType;return{name:this.$(".name-on-card").val().trim(),address:this.$(".address").val().trim(),city:this.$(".city").val().trim(),state:c,postal_code:e,country:a,save_card:this.$("#save-for-later-checkbox").prop("checked"),eProtectResponse:d,last_four_digits:h,card_type:f}},__goBack:function(){this.hide();this.promiseResolver.reject()},__destroy:function(){this.hide();this.delete()}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],CCValidator:na,CountryMap:l["json!/common/js/JSON/Countries.json"],Dropdown:G,MultiCartReview:T,ProvinceMap:l["json!/common/js/JSON/Provinces.json"],StateMap:l["json!/common/js/JSON/States.json"],Tooltip:y,template:mc}),oc=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("MultiCartSavedCardsDialog",{uiContextName:"multicart_saved_cards_dialog",className:"multicart-saved-cards-dialog dialog-type-B",dependencies:"cart channel dialogManager globalStartupModel globalStringManager restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:".back-button",name:"back_button",handler:"__goBack"},{type:"click",selector:".add-new-credit-card",name:"add_new",handler:"__addNewCard"},{type:"click",selector:"li.saved-card-item",name:"select_saved_card",handler:"__selectSavedCard"},{type:"click",selector:".btn.btn-primary",name:"use_card",handler:"__useThisCard"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.$el.removeClass("can-dismiss");this.title=this.__globalStringManager.get("SAVED CREDIT CARDS");this.__origin=IMVU.optionalProperty(a,"origin",null);a=this.__globalStartupModel.get("savedCreditCardUrl");this.__saved_cards=this.track(this.__restModelFactory.readCollection(a,g.UiCore.NodeCollection));this.__saved_cards.populated().then(function(){this.addToDOM()}.bind(this))},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.setContent("body",g.template,{saved_cards:this.__saved_cards.models});this.$(".saved-card-list li:nth-of-type(1)").addClass("is-selected");this.__selectedCard=this.$(".saved-card-list li:nth-of-type(1)").prop("id");this.setContent("footer",this.$(".dialog-footer-template").text())},__addNewCard:function(){this.__dialogManager.showDialog(g.MultiCartAddCreditCard,{cart:this.__cart,channel:this.__channel,itemCount:this.__cart.length,orderTotal:this.__total,origin:this.__origin}).finished.then(function(a){"clear_cart"===a&&this.__window.location.reload();this.promiseResolver.resolve(a);this.close()}.bind(this)).catch(function(a){"closing_all"===a&&this.close()}.bind(this))},__useThisCard:function(){var a=this.__getCardFromId(this.__selectedCard);this.__dialogManager.showDialog(g.MultiCartReview,{billingInfo:{card_type:a.attributes.card_type,name:a.attributes.name,last_four_digits:a.attributes.card_last_digits,card_id:a.attributes.id,saved_card:!0},channel:this.__channel,cart:this.__cart,origin:this.__origin}).finished.then(function(c){"clear_cart"===c&&this.__window.location.reload();this.promiseResolver.resolve(c);this.close()}.bind(this)).catch(function(c){"closing_all"===c&&this.close()}.bind(this))},__onClose:function(a){a.preventDefault();this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},__goBack:function(){this.hide();this.promiseResolver.reject()},__selectSavedCard:function(a){this.__selectedCard=a.target.id;this.$(".saved-card-list li").removeClass("is-selected");this.$('.saved-card-list li[id="'+this.__selectedCard+'"]').addClass("is-selected")},__getCardFromId:function(a){return _.find(this.__saved_cards.models,function(c){if(a===c.attributes.id)return c})}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],MultiCartAddCreditCard:sa,MultiCartReview:T,template:kc}),pc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f="\r\n";if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"VIP RENEWS ON",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"&nbsp;<span class='date'>"+c((d=a.renew_date||b&&b.renew_date,"function"===typeof d?d.call(b,{name:"renew_date",hash:{},data:e}):d))+"</span><span class='price'>"+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</span>\r\n"},useData:!0})}({}),qc=function(g){var b=g.UiCore.UiContext;return b.extend("MultiCartVipStatus",{className:"multi-cart-vip-status",uiContextName:"multi_cart_vip_status",tagName:"p",dependencies:["globalStringManager","loginManager","model"],trackedEvents:function(){return[]},VIP_ONE_MONTH:12,VIP_THREE_MONTHS:13,VIP_ONE_YEAR:14,initialize:function(a){b.prototype.initialize.call(this,a);this.__myself=this.__loginManager.getCurrentUser();this.__months_to_add={};this.__months_to_add[this.VIP_ONE_MONTH]=1;this.__months_to_add[this.VIP_THREE_MONTHS]=3;this.__months_to_add[this.VIP_ONE_YEAR]=12;this.addToDOM()},render:function(){b.prototype.render.call(this);var a=this.__months_to_add[this.__model.attributes.node.product_packages_id];a||(a=1);a=(this.__myself.get("is_vip")?g.moment(this.__myself.get("vip_expires")):g.moment()).add("months",a);this.$el.html(g.template({price:this.__model.attributes.edge.sale_price_formatted,renew_date:a.format("MM/DD/YYYY")}))}})}({moment:l["@moment"],UiCore:l["@UiCore"],template:pc}),rc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return"disabled"},3:function(b,a,c,e){var d,h;c=this.escapeExpression;return"\r\n            <div class='product-price'>\r\n                <span class='normal-price'>"+c((d=(d=(d=(d=b&&b.model,null==d||!1===d?d:d.attributes),null==d||!1===d?d:d.edge),null==d||!1===d?d:d.normal_price_formatted),"function"===typeof d?d.apply(b):d))+"</span>\r\n                <span class='sale-price'>"+c((d=(d=(d=(d=b&&b.model,null==d||!1===d?d:d.attributes),null==d||!1===d?d:d.edge),null==d||!1===d?d:d.sale_price_formatted),"function"===typeof d?d.apply(b):d))+"</span>\r\n                <span class='renewal-period'> "+c((h=a.renewalPeriodText||b&&b.renewalPeriodText,"function"===typeof h?h.call(b,{name:"renewalPeriodText",hash:{},data:e}):h))+"</span>\r\n            </div>\r\n        "},5:function(b,a,c,e){var d,h;c=this.escapeExpression;return"\r\n            <div class='product-price'>\r\n                "+c((d=(d=(d=(d=b&&b.model,null==d||!1===d?d:d.attributes),null==d||!1===d?d:d.edge),null==d||!1===d?d:d.sale_price_formatted),"function"===typeof d?d.apply(b):d))+"<span class='renews-monthly'> "+c((h=a.renewalPeriodText||b&&b.renewalPeriodText,"function"===typeof h?h.call(b,{name:"renewalPeriodText",hash:{},data:e}):h))+"</span>\r\n            </div>\r\n        "},7:function(b,a,c,e){var d,h=a.helperMissing;c="\r\n        <div class='product-sale'>\r\n            ";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"SALE",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"\r\n        </div>\r\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h="<div class='multi-cart-item-info'>\r\n\r\n    <input id='multi-cart-item-"+c((d=(d=b&&b.model,null==d||!1===d?d:d.cid),"function"===typeof d?d.apply(b):d))+"' class='checkbox product-select' type='checkbox' ";if((d=a["if"].call(b,(d=b&&b.model,null==d||!1===d?d:d.isDisabledModel),{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===d)h+=d;h+="/>\r\n    <label class='product-label' for='multi-cart-item-"+c((d=(d=b&&b.model,null==d||!1===d?d:d.cid),"function"===typeof d?d.apply(b):d))+"'>\r\n    </label>\r\n\r\n    <div class='product-img'>\r\n        <img src='"+c((d=(d=(d=(d=b&&b.model,null==d||!1===d?d:d.attributes),null==d||!1===d?d:d.node),null==d||!1===d?d:d.img160x160),"function"===typeof d?d.apply(b):d))+"'>\r\n    </div>\r\n    <div class='product-info'>\r\n        <div class='product-name'>"+c((d=(d=(d=(d=b&&b.model,null==d||!1===d?d:d.attributes),null==d||!1===d?d:d.node),null==d||!1===d?d:d.name),"function"===typeof d?d.apply(b):d))+"</div>\r\n        ";if((d=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(3,e),inverse:this.program(5,e),data:e}))||0===d)h+=d;h+="\r\n\r\n    </div>\r\n    ";if((d=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===d)h+=d;return h+"\r\n</div>\r\n"},useData:!0})}({}),sc=function(g){var b=g.UiCore.UiContext;return g.UiCore.UiContext.extend("MultiCartCheckoutItem",{className:"multi-cart-checkout-item",uiContextName:"multi_cart_checkout_item",tagName:"li",dependencies:["contextMenuManager","dollarStoreManager","globalStringManager","window"],trackedEvents:function(){return[{type:"click",selector:".checkbox.product-select",name:"product_toggle",handler:"__productToggle"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.model.isCheckedoutModel=!0;this.model.isDisabledModel=!1;this.model.listenTo(this.model,"cart_model_price_update",this.__updatePrice.bind(this));this.addToDOM()},render:function(){b.prototype.render.call(this);var a="",c=this.model.get("node");if(c){var e=c.category;e&&"hosting"===e?a=this.__globalStringManager.get("renews_monthly"):e&&"vip"===e&&(c=c.code_name,"vip_1_month_subscription"===c?a=this.__globalStringManager.get("renews_monthly"):"vip_3_month_subscription"===c?a=this.__globalStringManager.get("renews_quarterly"):"vip_1_year_subscription"===c&&(a=this.__globalStringManager.get("renews_yearly")))}this.$el.html(g.template({model:this.model,hasDiscount:this.model.attributes.edge.normal_price>this.model.attributes.edge.sale_price,renewalPeriodText:a}));this.$(".multi-cart-item-info").addClass(this.model.attributes.node.category);this.model.isCheckedoutModel?this.$(".product-select").attr("checked","checked"):this.$(".product-select").removeAttr("checked");this.model.get("node").disableCheckbox&&this.$(".product-label").expect(1).attr("disabled","disabled")},__productToggle:function(a){this.model.isCheckedoutModel=this.$(a.target).prop("checked");this.__dollarStoreManager.trigger("update_checkout_total_price")},__updatePrice:function(){this.render()}})}({Model:l["@Model"],UiCore:l["@UiCore"],template:rc}),tc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;a=this.escapeExpression;return"\n        <li id='"+a((d=b&&b.id,"function"===typeof d?d.apply(b):d))+"'>\n        <span class='name'>\n            "+a((d=(d=b&&b.attributes,null==d||!1===d?d:d.display_name),"function"===typeof d?d.apply(b):d))+"\n        </span>\n            <img src='"+a((d=(d=b&&b.attributes,null==d||!1===d?d:d.icon_url),"function"===typeof d?d.apply(b):d))+"'>\n        </li>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c="<ul class='other-payment-channel-list'>\n    <li id='other-payment-type'>\n    <span class='name'>";if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"OTHER PAYMENT TYPE PLURAL",{name:"i18n-g",hash:{},data:e})))||0===h)c+=h;c+="\n        <span class='down-arrow'></span>\n    </span>\n    </li>\n    ";if((h=a.each.call(b,b&&b.otherChannels,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===h)c+=h;return c+"\n</ul>\n\n"},useData:!0})}({}),uc=function(g){var b=g.UiCore.UiContext;return b.extend("OtherPaymentChannels",{className:"other-payment-channels",uiContextName:"other_payment_channels",dependencies:[],trackedEvents:function(){return[]},initialize:function(a){b.prototype.initialize.call(this,a);this.__otherChannels=IMVU.requireProperty(a,"otherChannels");this.addToDOM()},delete:function(){b.prototype.delete.call(this)},render:function(){this.$el.html(g.template({otherChannels:this.__otherChannels}))}})}({UiCore:l["@UiCore"],template:tc}),vc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return"\r\n"},useData:!0})}({}),wc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=this.escapeExpression;var h="\r\n        <div class=\"product-price\">\r\n            <span class='normal-price'>"+c((d=(d=(d=(d=b&&b.model,null==d||!1===d?d:d.attributes),null==d||!1===d?d:d.edge),null==d||!1===d?d:d.normal_price_formatted),"function"===typeof d?d.apply(b):d))+"</span>\r\n            <span class='sale-price'>"+c((d=(d=(d=(d=b&&b.model,null==d||!1===d?d:d.attributes),null==d||!1===d?d:d.edge),null==d||!1===d?d:d.sale_price_formatted),"function"===typeof d?d.apply(b):d))+"</span>\r\n            ";if((d=a["if"].call(b,b&&b.hasRenews,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===d)h+=d;return h+"\r\n    </div>\r\n    "},2:function(b,a,c,e){var d;c=this.escapeExpression;return"\r\n            <span class='renews-text'> "+c((d=a.renewsText||b&&b.renewsText,"function"===typeof d?d.call(b,{name:"renewsText",hash:{},data:e}):d))+"</div>\r\n        "},4:function(b,a,c,e){var d;c=this.escapeExpression;c="\r\n    <div class='product-price'>"+c((d=(d=(d=(d=b&&b.model,null==d||!1===d?d:d.attributes),null==d||!1===d?d:d.edge),null==d||!1===d?d:d.sale_price_formatted),"function"===typeof d?d.apply(b):d));if((d=a["if"].call(b,b&&b.hasRenews,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===d)c+=d;return c+"</div>\r\n    "},5:function(b,a,c,e){var d;c=this.escapeExpression;return"<span class='renews-text'> "+c((d=a.renewsText||b&&b.renewsText,"function"===typeof d?d.call(b,{name:"renewsText",hash:{},data:e}):d))+"</span>"},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h;c=this.escapeExpression;var f=a.helperMissing,k="<div class='multi-cart-item-info'>\r\n    <div class='product-img'>\r\n        <img src='"+c((d=(d=(d=(d=b&&b.model,null==d||!1===d?d:d.attributes),null==d||!1===d?d:d.node),null==d||!1===d?d:d.img160x160),"function"===typeof d?d.apply(b):d))+"'>\r\n    </div>\r\n    <div class='product-info'>\r\n        <div class='product-name'>\r\n            "+c((d=(d=(d=(d=b&&b.model,null==d||!1===d?d:d.attributes),null==d||!1===d?d:d.node),null==d||!1===d?d:d.name),"function"===typeof d?d.apply(b):d))+"\r\n        </div>\r\n\r\n        ";if((d=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(4,e),data:e}))||0===d)k+=d;k+="\r\n</div>\r\n<div class='product-remove'>\r\n    ";if((d=(h=a.icon||b&&b.icon||f,h.call(b,"icon-trash2",{name:"icon",hash:{},data:e})))||0===d)k+=d;return k+"\r\n</div>\r\n</div>"},useData:!0})}({}),xc=function(g){var b=g.UiCore.UiContext;return g.UiCore.UiContext.extend("MultiCartItem",{className:"multi-cart-item",uiContextName:"multi_cart_item",tagName:"li",dependencies:"contextMenuManager dialogManager dollarStoreManager featureAccessManager globalStringManager Promise".split(" "),trackedEvents:function(){return[{type:"click",selector:".product-remove",name:"multi_cart_remove",handler:"__onRemoveItem"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.model.listenTo(this.model,"cart_model_price_update",this.__updatePrice.bind(this));this.addToDOM()},render:function(){b.prototype.render.call(this);var a=this.model.attributes.edge.normal_price>this.model.attributes.edge.sale_price,c=this.model.get("node").category,e="hosting"===c||"vip"===c;a={model:this.model,hasDiscount:a,hasRenews:e};e&&(e=this.__globalStringManager.get("renews_monthly"),"vip"===c&&(c=this.model.get("node").code_name,"vip_3_month_subscription"===c?e=this.__globalStringManager.get("renews_quarterly"):"vip_1_year_subscription"===c&&(e=this.__globalStringManager.get("renews_yearly"))),a.renewsText=e);this.$el.html(g.template(a));this.$(".product-info").addClass(this.model.attributes.node.category)},__onRemoveItem:function(){this.collection.remove(this.model);0===this.collection.length&&this.__dollarStoreManager.trigger("empty_multi_cart");this.__dollarStoreManager.trigger("update_cart_total_price");this.model.attributes.productModel.trigger("removed_from_cart",this.collection);this.model.get("edge").rules.includes("is_vcoin")&&this.__dollarStoreManager.trigger("update_cart_vcoin_total")},__updatePrice:function(){this.render()}})}({Model:l["@Model"],UiCore:l["@UiCore"],template:wc}),ta=function(g){var b=g.UiCore.ListPresenter;return b.extend("MultiCartList",{className:"multi-cart-list",uiContextName:"multi_cart_list",tagName:"ul",dependencies:["dollarStoreManager","globalStringManager","modeManager"],trackedEvents:function(){return[]},initialize:function(a){this.itemFactory=a.itemFactory||g.MultiCartItem;b.prototype.initialize.call(this,a)},render:function(){b.prototype.render.call(this);this.$el.html(g.template())}})}({UiCore:l["@UiCore"],MultiCartItem:xc,template:vc}),U=function(g){var b=g.MultiCartAbstractDialog;return b.extend("MultiCartCheckout",{uiContextName:"multicart_checkout_dialog",className:"multicart-checkout-dialog dialog-type-B",dependencies:"cart defaultChannel dialogManager dollarStoreManager externalNextRoot featureAccessManager globalStartupModel globalStringManager loginManager modeManager nextRoot paymentChannels prefsManager Promise restModelFactory urlManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".btn-primary.checkout",name:"checkout",handler:"__checkout",attributes:this.__getAttributes.bind(this)},{type:"click",selector:"input[id=vip_checkbox]",name:"vip_checkbox",handler:"__vipCheckbox"},{type:"click",selector:".terms .link",name:"general_tos",handler:"__generalTOS"},{type:"click",selector:".payment-channel-list li",name:"select_payment",handler:"__selectPayment"},{type:"click",selector:".other-checkout-container.active .other-payment-channel-list li",name:"select_extended_payment",handler:"__selectPaymentExtended"},{type:"click",selector:".back-button",name:"back_to_primary_channels",handler:this.__backToPrimaries},{type:"click",selector:".vcoin-terms-and-conditions-link",name:"vcoin_terms_and_conditions_link",handler:"__vcoinTOS"},{type:"click",selector:"input[id=vcoin_terms_and_conditions_checkbox]",name:"vcoin_terms_and_conditions_checkbox",handler:"__vcoinTermsCheckbox"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.restModelFactory=a.restModelFactory;var c=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=c.url;this.__coreDollarstoreProductOfferingId=c.id;this.__getProductOfferingDataFromCoreDS();this.__prefsManager=a.prefsManager;this.__featureAccessManager=a.featureAccessManager;this.__paymentChannels=IMVU.requireProperty(a,"paymentChannels");this.__origin=IMVU.optionalProperty(a,"origin",null);this.__afterAction=IMVU.optionalProperty(a,"afterAction",null);this.title=this.__globalStringManager.get("CART SUMMARY");this.__vipModel=IMVU.optionalProperty(a,"vipModel",null);this.__hostModel=IMVU.optionalProperty(a,"hostModel",null);this.__which=IMVU.optionalProperty(a,"which",null);this.__hostModel&&(this.__afterAction="close");this.__addRoomTile=a.addRoomTile;this.__hostingSelfCancel=this.__hasTieredVipInCart=this.__hasVIPInCart=!1;this.__total=0;_.each(this.__cart.models,function(e){this.__total+=e.attributes.edge.sale_price;e.attributes.edge.rules.includes("is_vcoin")&&(this.__hasVcoinInCart=!0);e.attributes.edge.rules.includes("hosting_self_cancel")&&(this.__hostingSelfCancel=!0);"vip"==e.attributes.node.category&&(this.__vipModel=e,this.__hasVIPInCart=!0,e=this.__vipModel.get("node"),this.__hasTieredVipInCart=["vip_web_tier_1","vip_web_tier_2","vip_web_tier_3"].includes(e.code_name))}.bind(this));this.__cartTotalInVcoin=(250*this.__total).toFixed(2);this.__total="$"+parseFloat(this.__total).toFixed(2);this.listenTo(this.__dollarStoreManager,"update_checkout_total_price",this.__updateCheckoutTotal);c=[];this.__defaultChannel&&c.push(this.__defaultChannel.populated());c.push(this.__paymentChannels.populated());this.__Promise.every(c).then(function(){this.addToDOM()}.bind(this));this.__autoLaunchReview=IMVU.optionalProperty(a,"autoLaunchReview",!1)},postRender:function(){var a=this;this.__saved_card=null;this.$(".dialog-header").prepend('<div class="back-button hidden"></div>');this.__vantiv_ch=this.__getVantivChannel();var c=this.__globalStartupModel.get("savedCreditCardUrl"),e=this.track(this.__restModelFactory.readCollection(c,g.UiCore.NodeCollection));e.invalidate();e.populated().then(function(){a.__hasVIPInCart&&4===a.__myself.get("vip_platform")&&a.__dialogManager.confirm({title:a.__globalStringManager.get("vip_upsell_previous_subscription_title"),text:a.__globalStringManager.get("vip_upsell_previous_subscription_body"),no:a.__globalStringManager.get("CANCEL"),yes:a.__globalStringManager.get("OKAY")}).finished.catch(function(){a.close()})}).then(function(){if(a.__hasVIPInCart&&[2,3].includes(a.__myself.get("vip_platform"))){var d=[a.__globalStringManager.get("vip_upsell_company_1"),a.__globalStringManager.get("vip_upsell_company_2")][a.__myself.get("vip_platform")],h=[a.__globalStringManager.get("vip_upsell_platform_1"),a.__globalStringManager.get("vip_upsell_platform_2")][a.__myself.get("vip_platform")];d=a.__globalStringManager.get("vip_upsell_previous_subscription_mobile_body",{company:d?d:a.__globalStringManager.get("vip_upsell_company_3"),platform:h?h:a.__globalStringManager.get("vip_upsell_platform_3")});a.__dialogManager.alert({title:a.__globalStringManager.get("vip_upsell_previous_subscription_title"),text:d,ok:a.__globalStringManager.get("OKAY")}).finished.then(function(){a.__dialogManager.closeAll()}).catch(function(){a.__dialogManager.closeAll()})}}).then(function(){a.__hasVIPInCart&&a.__myself.get("is_host")&&(a.__hostingSelfCancel?a.__dialogManager.alert({title:a.__globalStringManager.get("vip_upsell_previous_host_subscription_title"),text:a.__globalStringManager.get("vip_upsell_previous_host_subscription_mobile_body"),ok:a.__globalStringManager.get("OKAY")}):a.__dialogManager.confirm({title:a.__globalStringManager.get("vip_upsell_previous_host_subscription_title"),html:a.__globalStringManager.get("vip_upsell_previous_host_subscription_desktop_body"),yes:a.__globalStringManager.get("OKAY"),no:a.__globalStringManager.get("CANCEL")}).finished.catch(function(){a.close()}))}).then(function(){var d=_.filter(e.models,function(k){return!0===k.attributes.is_primary&&"co"===k.attributes.system}.bind(this));_.isEmpty(d)&&(d=_.filter(e.models,function(k){return"co"===k.attributes.system}.bind(this)));!_.isEmpty(d)&&this.__vantiv_ch&&(this.__saved_card=d[0]);if(this.__saved_card){this.__saved_card.attributes.saved_card=!0;this.__saved_card.attributes.channel_key="saved_card";this.__saved_card.attributes.payment_method="vantiv";this.__saved_card.attributes["metadata.credit_card"]=1;d={id:"different_card",attributes:{display_name:this.__globalStringManager.get("USE DIFFERENT CARD"),icon_url:"/common/withme/img/store/payment/payment-creditcard.png",channel_key:"different_card",payment_method:"vantiv"},populated:function(){return new this.__Promise(function(k){k.accept(!0)}.bind(this))}.bind(this)};d.attributes["metadata.credit_card"]=1;var h=_.filter(this.__paymentChannels.models,function(k){return"saved_card"===k.attributes.channel_key});_.isEmpty(h)?(this.__paymentChannels.models.splice(0,0,d),this.__paymentChannels.models.splice(0,0,this.__saved_card)):this.__paymentChannels.models.splice(0,1,this.__saved_card)}d={total:this.__total,vcoinInCart:this.__hasVcoinInCart,tieredVIPInCart:this.__hasTieredVipInCart,helpCenterURL:this.__urlManager.get("imvu_help_privacy_policy"),subscriptionURL:this.__urlManager.get("manage_subscription"),vipTermsURL:this.__urlManager.get("policy_hub_vip")};this.setContent("body",g.template,d);var f=!1;_.each(this.__cart.models,function(k){0===k.get("edge").normal_price&&"credits"===k.get("node").code_name&&1===k.get("node").credits&&(f=!0)}.bind(this));_.each(this.__cart.models,function(k){k.attributes.node.disableCheckbox=f}.bind(this));this.__cartList=this.createChildContext(g.MultiCartList,{$replaceElement:this.$(".multi-cart-list-placehoder"),itemFactory:g.MultiCartCheckoutItem,collection:this.__cart});this.__updateAvailablePaymentMethods();this.setContent("footer",this.$(".dialog-footer-template").text());this.__vipModel&&(this.__vipWidget=this.createChildContext(g.MultiCartVipStatus,{$parentElement:this.$(".vip-status-widget"),model:this.__vipModel}),this.$(".agreement .vip-panel").removeClass("hidden"),this.$(".btn-primary.checkout").addClass("disabled"),this.createChildContext(g.Tooltip,{$replaceElement:this.$(".vip-toc-tooltip"),$tooltipTarget:this.$(".vip-toc-link"),tooltipPosition:"bottom"}));this.__hasVcoinInCart&&this.__availablePaymentChannels.length&&(d=1===this.__prefsManager.getInt("next.user_accepted_vcoin_tc"),this.$(".btn-primary.checkout").prop("disabled",!d),d&&this.$(".vcoin-checkbox").attr("checked","checked"));this.__selectPayment({target:{id:this.__availablePaymentChannels[0].id}});this.__autoLaunchReview&&this.__validateChannelPayoutPromise.then(function(){this.__checkout()}.bind(this))}.bind(this))},__destroy:function(){this.hide();this.delete()},__getAttributes:function(){return{which:this.__which}},__updateAvailablePaymentMethods:function(){var a=this;this.__availablePaymentChannels=this.__paymentChannels.models;var c=!1;_.each(this.__cart.models,function(e){e.attributes.edge.rules.includes("credit_card_only")&&e.isCheckedoutModel&&(c=!0)});c?(this.__creditCardPayemntChannels=_.filter(this.__availablePaymentChannels,function(e){if(1===e.attributes["metadata.credit_card"])return e}),this.__creditCardPayemntChannels.length?(this.$(".notice-credit-card-only-message").removeClass("hidden"),this.__availablePaymentChannels=this.__creditCardPayemntChannels):(this.$(".notice-credit-card-only-message").addClass("hidden"),this.$(".items-unavailable-for-purchase").addClass("error-visible"),_.each(this.__cartList.collection.models,function(e){e.attributes.edge.rules.includes("credit_card_only")&&(e.isCheckedoutModel=!1,e.isDisabledModel=!0,a.$(".multi-cart-item-info input[id=multi-cart-item-"+e.cid+"].checkbox").prop({checked:!1,disabled:!0}));e.isCheckedoutModel&&(a.__total+=e.attributes.edge.sale_price)}))):this.$(".notice-credit-card-only-message").addClass("hidden");this.__hasVcoinInCart&&(this.__vcoinPayemntChannels=_.filter(this.__availablePaymentChannels,function(e){if(1===e.attributes["metadata.sells_vcoin"])return e}),this.__vcoinPayemntChannels.length?(this.__availablePaymentChannels=this.__vcoinPayemntChannels,this.$(".notice-credit-card-only-message").removeClass("hidden")):(this.$(".notice-credit-card-only-message").addClass("hidden"),this.$(".items-unavailable-for-purchase").addClass("error-visible"),_.each(this.__cartList.collection.models,function(e){e.attributes.edge.rules.includes("is_vcoin")&&(e.isCheckedoutModel=!1,e.isDisabledModel=!0,a.$(".multi-cart-item-info input[id=multi-cart-item-"+e.cid+"].checkbox").prop({checked:!1,disabled:!0}));e.isCheckedoutModel&&(a.__total+=e.attributes.edge.sale_price)})));this.__checkForPaymentsOverride().then(function(e){a.$(".payment-channels-wrapper").empty();a.$(".other-checkout-container").empty();a.__paymentChannelsList=a.createChildContext(g.PaymentChannels,{$parentElement:a.$(".payment-channels-wrapper"),channels:e.slice(0,3),otherchannels:e.slice(3),hasOtherChannels:0<e.slice(3).length});0<e.slice(3).length&&(a.__otherPaymentChannelsList=a.createChildContext(g.OtherPaymentChannels,{$parentElement:a.$(".other-checkout-container"),otherChannels:e.slice(3)}));a.$('.payment-channel-list li[id="'+e[0].id+'"]').addClass("is-selected");a._currentPaymentChannels=e})},__updateCheckoutTotal:function(){var a=this;this.__total=0;this.__hostModel=this.__vipModel=null;this.__hasAtLeastOneSubscription=this.__hasVcoinInCart=!1;_.each(this.__cartList.collection.models,function(c){c.isCheckedoutModel&&("vip"===c.attributes.node.category?this.__vipModel=c:"hosting"===c.attributes.node.category&&(this.__hostModel=c),!0===c.attributes.edge.rules.includes("is_subscription")&&1<this.__cartList.collection.models.length&&!1===this.__hasAtLeastOneSubscription&&(this.__hasAtLeastOneSubscription=!0),c.attributes.edge.rules.includes("is_vcoin")&&(this.__hasVcoinInCart=!0))}.bind(this));this.__total=0;this.$("notice-credit-card-only-message").addClass("hidden");this.$(".notice-subscription-message").addClass("hidden");this.__hasVcoinInCart&&this.$(".notice-credit-card-only-message").removeClass("hidden");this.__hasVcoinInCart?_.each(this.__cartList.collection.models,function(c){c.isDisabledModel=!1;a.$(".multi-cart-item-info input[id=multi-cart-item-"+c.cid+"].checkbox").prop({disabled:!1});c.isCheckedoutModel&&(a.__total+=c.attributes.edge.sale_price)}):!1===this.__hasAtLeastOneSubscription?(_.each(this.__cartList.collection.models,function(c){!0!==c.attributes.edge.rules.includes("is_subscription")&&(!c.attributes.edge.rules.includes("is_vcoin")||c.attributes.edge.rules.includes("is_vcoin")&&1<=a.__vcoinPayemntChannels.length)&&(!c.attributes.edge.rules.includes("credit_card_only")||c.attributes.edge.rules.includes("credit_card_only")&&1<=a.__creditCardPayemntChannels.length)&&(c.isDisabledModel=!1,a.$(".multi-cart-item-info input[id=multi-cart-item-"+c.cid+"].checkbox").prop({disabled:!1}));c.isCheckedoutModel&&(a.__total+=c.attributes.edge.sale_price)}),this.$(".notice-subscription-message").addClass("hidden")):(this.__hasAtLeastOneSubscription=!1,_.each(this.__cart.models,function(c){!0===c.attributes.edge.rules.includes("is_subscription")&&!1===a.__hasAtLeastOneSubscription?(a.__hasAtLeastOneSubscription=!0,a.$(".notice-subscription-message").removeClass("hidden")):c.attributes.edge.rules.includes("is_vcoin")?c.isCheckedoutModel=!1:(c.isCheckedoutModel=!1,c.isDisabledModel=!0,a.$(".multi-cart-item-info input[id=multi-cart-item-"+c.cid+"].checkbox").prop({checked:!1,disabled:!0}));c.isCheckedoutModel&&(a.__total+=c.attributes.edge.sale_price)}));this.__updateAvailablePaymentMethods();0===this.__total?this.$(".btn.btn-primary.checkout").addClass("disabled"):this.$(".btn.btn-primary.checkout").removeClass("disabled");this.__vipWidget&&this.__vipWidget.delete();this.__vipModel?(this.__vipWidget=this.createChildContext(g.MultiCartVipStatus,{$parentElement:this.$(".vip-status-widget"),model:this.__vipModel}),this.$(".agreement .vip-panel").removeClass("hidden"),this.$("input[id=vip_checkbox]").prop("checked")?this.$(".btn-primary.checkout").removeClass("disabled"):this.$(".btn-primary.checkout").addClass("disabled")):this.$(".agreement .vip-panel").addClass("hidden");this.__cartTotalInVcoin=(250*this.__total).toFixed(2);this.__total="$"+parseFloat(this.__total).toFixed(2);this.$(".checkout-bottom-container .price-summary .price").text(this.__total)},__selectPayment:function(a){var c=a.target.id;"other-payment-type"===c?this.__vipModel&&!this.$("input[id=vip_checkbox]").prop("checked")?this.$(".vip-checkbox-missing").addClass("error-visible"):this.__hasVcoinInCart&&!this.$("input[id=vcoin_terms_and_conditions_checkbox]").prop("checked")?this.$(".vcoin-checkbox-missing").addClass("error-visible"):this.__showExtendedPaymentOptions():this.__validateChannelPayoutPromise=this.__validateChannelPayout(this.__getChannel(c),this.__defaultChannel,this.__vantiv_ch).then(function(){this.$(".other-payment-channel-list li").removeClass("is-selected");this.__updateCheckoutTotal();this.$(".payment-channel-list li").removeClass("is-selected");this.$('.payment-channel-list li[id="'+c+'"]').addClass("is-selected")}.bind(this))},__showExtendedPaymentOptions:function(){this.$(".vip-checkbox-missing").removeClass("error-visible");this.$(".vcoin-checkbox-missing").removeClass("error-visible");this.$(".checkout-container").addClass("hidden");this.$(".other-checkout-container").addClass("active");this.$(".dialog-header .back-button").removeClass("hidden")},__showPrimaryPaymentOptions:function(){this.$(".checkout-container").removeClass("hidden");this.$(".other-checkout-container").removeClass("active");this.$(".dialog-header .back-button").addClass("hidden")},__selectPaymentExtended:function(a){var c=a.target.id;"other-payment-type"===c?this.__showPrimaryPaymentOptions():this.__validateChannelPayout(this.__getChannel(c),this.__defaultChannel,this.__vantiv_ch).then(function(){this.__updateCheckoutTotal();this.$(".payment-channel-list li").removeClass("is-selected");this.$(".other-payment-channel-list li").removeClass("is-selected");this.$('.other-payment-channel-list li[id="'+c+'"]').addClass("is-selected")}.bind(this))},__backToPrimaries:function(){this.__showPrimaryPaymentOptions()},__generalTOS:function(){var a=this.__urlManager.get("policy_hub_terms");this.__featureAccessManager.isElectronClient()?(this.__electron=this.__window.electronRequire("electron"),this.__electron.shell.openExternal(a)):this.__window.open(a,"_blank")},__vcoinTOS:function(a){this.__generalTOS();a.stopImmediatePropagation()},__vipCheckbox:function(){this.$("input[id=vip_checkbox]").prop("checked")?(this.$(".vip-checkbox-missing").removeClass("error-visible"),this.$(".btn-primary.checkout").removeClass("disabled")):this.$(".btn-primary.checkout").addClass("disabled")},__vcoinTermsCheckbox:function(){this.$("input[id=vcoin_terms_and_conditions_checkbox]").prop("checked")?(this.__prefsManager.setInt("next.user_accepted_vcoin_tc",1),this.$(".vcoin-checkbox-missing").removeClass("error-visible"),this.$(".btn-primary.checkout").prop("disabled",!1)):(this.__prefsManager.setInt("next.user_accepted_vcoin_tc",0),this.$(".btn-primary.checkout").prop("disabled",!0))},__getVantivChannel:function(){return _.find(this.__paymentChannels.models,function(a){if("vantiv"===a.attributes.channel_key)return a})},__getChannel:function(a){return _.find(this.__paymentChannels.models,function(c){if(a===c.id)return c})},__checkout:function(){var a=".checkout-container";this.$(".vip-checkbox-missing").removeClass("error-visible");this.$(".vcoin-checkbox-missing").removeClass("error-visible");this.$(".checkout-container").hasClass("hidden")&&(a=".other-checkout-container");var c=this.$(a+" li.is-selected").prop("id");c||(".other-checkout-container"===a?c=this.$(".checkout-container li.is-selected").prop("id"):".checkout-container"===a&&(c=this.$(".other-checkout-container li.is-selected").prop("id")));c=this.__getChannel(c);var e=this.__dollarStoreManager.validateMultiCartCheckoutRules(c,this.__cart);if(_.isEmpty(e))this.__checkoutValidCart(c);else{var d=_.filter(e,function(h){return"credit_card_only"===h.type});_.isEmpty(d)||this.__dialogManager.showDialog(g.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("CART CONTENTS WILL CHANGE"),text:this.__globalStringManager.get("CART CONTENTS WILL CHANGE DESC"),yes:this.__globalStringManager.get("OK"),no:this.__globalStringManager.get("CANCEL")}).finished.then(function(){_.each(d,function(h){var f="multi-cart-item-"+h.target.cid;this.$("input[id="+f+"]").prop("checked",!1);h.target.isCheckedoutModel=!1;this.__dollarStoreManager.trigger("update_checkout_total_price");this.$('label[for="'+f+'"]').addClass("removed")}.bind(this));".other-checkout-container"===a&&this.__showPrimaryPaymentOptions()}.bind(this)).catch(function(){}.bind(this))}},__checkoutValidCart:function(a){"vantiv"===a.attributes.payment_method?"vantiv"===a.attributes.channel_key?this.__checkoutVantivNewCard(a):"saved_card"===a.attributes.channel_key?this.__checkoutVantivSavedCard(a):"different_card"===a.attributes.channel_key&&this.__checkoutVantivManageCards(a):"paypal"===a.attributes.payment_method?this.__checkoutPaypal(a):"paymentwall"===a.attributes.payment_method?this.__checkoutPaymentWall(a):"test"===a.attributes.payment_method?this.__checkoutTestChannel(a,this.__cart):"vcoin"===a.attributes.payment_method&&(this.__wallet=this.track(this.__myself.getSingleEdge("wallet")),this.__dollarStoreManager.storeCheckoutWithVcoin({cartCollection:this.__cart,cartTotalInVcoin:this.__cartTotalInVcoin,paymentChannels:this.__paymentChannels,source:"multicart_checkout",wallet:this.__wallet}))},__validateChannelPayout:function(a,c,e){return new this.__Promise(function(d){var h=!1,f=a.attributes.payout,k=c.attributes.payout,m=this.__dollarStoreManager.getDefaultCategories();f||(f=e.attributes.payout,h=!0);k||(k=e.attributes.payout);f<k&&70>f?this.__dialogManager.showDialog(g.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("PRICE ADJUSTMENT TITLE"),text:this.__globalStringManager.get("PRICE ADJUSTMENT DESC"),yes:this.__globalStringManager.get("OK"),no:this.__globalStringManager.get("CANCEL")}).finished.then(function(){this.__window.$("body").addClass("waiting");this.__dollarStoreManager.getProductsOffered(m,a).then(function(n){this.__updateCartModels(this.__cart.models,n.models);this.__window.$("body").removeClass("waiting");return d.accept()}.bind(this))}.bind(this)).catch(function(){return d.reject()}.bind(this)):f>k&&70>k?this.__dialogManager.showDialog(g.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("PRICE ADJUSTMENT TITLE"),text:this.__globalStringManager.get("PRICE ADJUSTMENT LOWER DESC"),yes:this.__globalStringManager.get("OK"),no:this.__globalStringManager.get("CANCEL")}).finished.then(function(){this.__window.$("body").addClass("waiting");h&&(a=e);this.__dollarStoreManager.getProductsOffered(m,a).then(function(n){this.__updateCartModels(this.__cart.models,n.models);this.__window.$("body").removeClass("waiting");return d.accept()}.bind(this))}.bind(this)).catch(function(){return d.reject()}.bind(this)):(this.__window.$("body").addClass("waiting"),h&&(a=e),this.__dollarStoreManager.getProductsOffered(m,a).then(function(n){this.__updateCartModels(this.__cart.models,n.models);this.__window.$("body").removeClass("waiting");return d.accept()}.bind(this)))}.bind(this))},__updateCartModels:function(a,c){_.each(a,function(e){_.each(c,function(d){var h=this.__coreDollarstoreProductOfferingId?this.__coreDollarstoreProductOfferingId:d.edge.attributes.product_offering_id,f=d.edge.attributes.sale_price,k=d.edge.attributes.sale_price_formatted;this.__oldDollarstoreProductOfferingUrl&&(e.attributes.edge.normal_price<d.edge.attributes.normal_price||e.attributes.edge.normal_price<e.attributes.edge.sale_price)&&(f=e.attributes.edge.normal_price,k=e.attributes.edge.normal_price_formatted);e.attributes.node.id===d.node.id&&(e.productModel=d,e.attributes.edge.normal_price=d.edge.attributes.normal_price,e.attributes.edge.normal_price_formatted=d.edge.attributes.normal_price_formatted,e.attributes.edge.product_offering_id=h,e.attributes.edge.sale_price=f,e.attributes.edge.sale_price_formatted=k,e.trigger("cart_model_price_update"))}.bind(this))}.bind(this))},__getReloadURL:function(){for(var a=this.__window.location.href,c=this.__serviceProvider.get("acceptedDollarStorePermaLinkProducts"),e=0;e<c.length;e++)if(a.endsWith("/store/"+c[e]+"/")){a=this.__window.location.origin+"/next/store/";break}return a},__handleAfterAction:function(a){"close"===this.__afterAction?this.close():"closeAll"===this.__afterAction?this.__dialogManager.closeAll():"reload"===this.__afterAction?this.__window.location=this.__getReloadURL():"closeToEditRoomSettings"===this.__afterAction?this.__dialogManager.closeTo("edit-room-settings"):"restWebGiftingDialog"===this.__afterAction?this.__dialogManager.closeTo("rest-web-gifting-dialog"):"upsellShell"===this.__afterAction?this.__modeManager.openMode({mode:{id:"shop"},submode:{id:"rooms"}}):"selectPrivateRoom"===this.__afterAction?this.__addRoomTile&&this.__addRoomTile.callOpenSelectRoomDialog({isPublicOverride:!0}):"clear_cart"===a?this.__window.location.reload():this.close()},__checkoutVantivNewCard:function(a){this.__dialogManager.showDialog(g.MultiCartAddCreditCard,{cart:this.__cart,channel:a,orderTotal:this.__total,origin:this.__origin}).finished.then(function(c){this.promiseResolver.resolve();this.__handleAfterAction(c)}.bind(this)).catch(function(c){"closing_all"===c&&this.close()}.bind(this))},__checkoutVantivSavedCard:function(a){this.__dialogManager.showDialog(g.MultiCartReview,{billingInfo:{card_type:this.__saved_card.attributes.card_type,name:this.__saved_card.attributes.name,last_four_digits:this.__saved_card.attributes.card_last_digits,card_id:this.__saved_card.id,saved_card:!0},channel:this.__vantiv_ch,cart:this.__cart,origin:this.__origin}).finished.then(function(c){this.promiseResolver.resolve();this.__handleAfterAction(c)}.bind(this)).catch(function(c){"closing_all"===c&&(this.promiseResolver.resolve(c),this.close())}.bind(this))},__checkoutVantivManageCards:function(a){this.__dialogManager.showDialog(g.MultiCartSavedCards,{billingInfo:{card_type:this.__saved_card.attributes.card_type,name:this.__saved_card.attributes.name,last_four_digits:this.__saved_card.attributes.card_last_digits,card_id:this.__saved_card.id,saved_card:!0},channel:this.__vantiv_ch,cart:this.__cart,origin:this.__origin}).finished.then(function(c){this.promiseResolver.resolve();this.__handleAfterAction(c)}.bind(this)).catch(function(c){"closing_all"===c&&this.close()}.bind(this))},__checkoutPaypal:function(a){this.__paypalCheckout(a,this.__cart).then(function(c){"finished_order_success"===c?this.promiseResolver.resolve("clear_cart"):this.promiseResolver.reject("clear_cart")}.bind(this)).catch(function(c){this.close()}.bind(this))},__checkoutPaymentWall:function(a){this.__paymentWallCheckout(a,this.__cart).then(function(c){this.close()}.bind(this))},__checkoutTestChannel:function(a,c){a=this.__buildOrderSelection(c.models);a={total:this.__calculateTotal(c.models),product_offering_id:c.models[0].attributes.edge.product_offering_id,selected:a};var e=this.__globalStartupModel.get("cashOrderTrans");this.__restModelFactory.createModel(e,g.UiCore.NodeModel,a).then(function(d){this.__dialogManager.showDialog(g.MultiCartSuccess,{cart:c.models,orderResponse:d,channel:"test",origin:this.__origin}).finished.then(function(h){this.promiseResolver.resolve("clear_cart")}.bind(this))}.bind(this)).catch(function(d){this.promiseResolver.reject()}.bind(this))},__checkForPaymentsOverride:function(){var a=this;return new this.__Promise(function(c){c.resolve(_.reject(a.__availablePaymentChannels,function(e,d){var h=e.attributes.override_with;return void 0!==h&&_.find(a.__availablePaymentChannels,function(f){return f.attributes.channel_key===h})?!0:!1}))})}})}({Dialogs:l["@Dialogs"],Model:l["@Model"],UiCore:l["@UiCore"],MultiCartAbstractDialog:qa,MultiCartAddCreditCard:sa,MultiCartCheckoutItem:sc,MultiCartList:ta,MultiCartReview:T,MultiCartSavedCards:oc,MultiCartSuccess:pa,MultiCartVipStatus:qc,OtherPaymentChannels:uc,PaymentChannels:ic,Tooltip:y,template:jc}),ua=function(g){var b=g.UiCore.UiContext;return b.extend("CheckoutButton",{uiContextName:"checkout_button",className:"inline-purchase-checkout-button",dependencies:"dialogManager dollarStoreManager featureAccessManager globalStartupModel globalStringManager loginManager Promise restModelFactory window".split(" "),trackedEvents:function(){return[{type:"click",selector:".buy-now",name:"store_checkout",handler:this.__storeCheckout}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__stringManager=a.globalStringManager;this.__formatNumber=g.FormatNumber;this.dialogManager=a.dialogManager;this.__selectedCredit=IMVU.optionalProperty(a,"selectedCredit",new IMVU.NamedModel({price:0}));this.__selectedSlot=IMVU.optionalProperty(a,"selectedSlot",new IMVU.NamedModel({price:0}));this.__selectedVip=IMVU.optionalProperty(a,"selectedVip",new IMVU.NamedModel({price:0}));this.__selectedHost=IMVU.optionalProperty(a,"selectedHost",new IMVU.NamedModel({price:0}));this.__context=IMVU.optionalProperty(a,"context",null);this.__isCreatorLanding=IMVU.optionalProperty(a,"isCreatorLanding",!1);this.__origin=IMVU.optionalProperty(a,"origin",null);this.__afterAction=IMVU.optionalProperty(a,"afterAction",null);this.__addRoomTile=a.addRoomTile;this.listenTo(this.__selectedCredit,"change",this.__updateCheckoutButton);this.listenTo(this.__selectedSlot,"change",this.__updateCheckoutButton);this.listenTo(this.__selectedVip,"change",this.__updateCheckoutButton);this.listenTo(this.__selectedHost,"change",this.__updateCheckoutButton);this.addToDOM();this.__myself=this.track(a.loginManager.getCurrentUser());this.__updateCheckoutButton()},render:function(){this.$el.html(g.template())},__updateCheckoutButton:function(){if(this.__getNumber()){this.$("button.buy-now").prop("disabled",!1);var a=1===this.__getNumber()?this.__isCreatorLanding?this.__stringManager.get("checkout_creator_dialog_buy_now_message_singular",{totalCredits:"$"+this.__formatNumber.formatCredits(this.__getTotalPrice())}):this.__stringManager.get("checkout_dialog_buy_now_message_singular",{totalCredits:"$"+this.__formatNumber.formatCredits(this.__getTotalPrice())}):this.__stringManager.get("checkout_dialog_buy_now_message_plural",{howMany:this.__getNumber(),totalCredits:"$"+this.__formatNumber.formatCredits(this.__getTotalPrice())});this.$("button.buy-now").text(a)}else this.$("button.buy-now").prop("disabled",!0),this.$("button.buy-now").text(this.__stringManager.get("CHECKOUT"))},__getNumber:function(){var a=0;0<this.__selectedCredit.get("price")&&a++;0<this.__selectedSlot.get("price")&&a++;0<this.__selectedVip.get("price")&&a++;0<this.__selectedHost.get("price")&&a++;return a},__getTotalPrice:function(){return(this.__selectedCredit.get("price")+this.__selectedSlot.get("price")+this.__selectedVip.get("price")+this.__selectedHost.get("price")).toFixed(2)},__storeCheckout:function(){this.$("button.buy-now").prop("disabled",!0);this.__myself.populated().then(function(a){if(a.get("is_on_hold"))return this.dialogManager.showDialog(g.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("payment_failed_account_holdon_title"),text:this.__stringManager.get("payment_failed_account_holdon_text"),ok:this.__stringManager.get("payment_failed_account_holdon_button")}).finished.then(function(){this.__context&&this.__context.destroy()}.bind(this));0<this.__selectedVip.get("price")&&this.__myself.get("is_vip")?this.__myself.getEdgeCollection("vip_subscriptions").populated().then(function(c){for(var e=!1,d=0;d<c.models.length;d++){var h=c.models[d].node;h.get("date_stopped")||h.relations.buyer!==this.__myself.id||h.relations.recipient!==this.__myself.id||(e=!0)}if(e)return this.dialogManager.showDialog(g.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("already_have_vip_subscription_title"),html:g.AlreadyHaveVipDialog({}),ok:this.__stringManager.get("already_have_vip_subscription_button")}).finished.then(function(){this.__context&&this.__context.destroy()}.bind(this));this.__checkout()}.bind(this)):this.__checkout()}.bind(this))},__checkout:function(){this.__globalStartupModel.get("paymentChannelEndpoint");this.__dollarStoreManager.getPaymentChannels(["credits","vip","hosting"]).then(function(a){var c=a.models[0],e=new IMVU.NamedCollection,d=null;_.each([this.__selectedCredit,this.__selectedSlot,this.__selectedVip,this.__selectedHost],function(k){if(k.attributes.model&&0<k.attributes.price){var m=new IMVU.NamedModel({node:k.attributes.model.node.attributes,edge:k.attributes.model.edge.attributes,productModel:k.attributes.model});"vip"===k.attributes.type&&(d=m);e.add(m)}}.bind(this));if(this.__isCreatorLanding){var h=[],f=0;_.each(e.models,function(k){h.push({product_name:k.attributes.node.code_name,product_id:k.attributes.node.product_packages_id.toString(),product_category:k.attributes.node.category,product_price:k.attributes.edge.sale_price,product_quantity:1});f+=k.attributes.edge.sale_price});try{this.__window.pintrk("track","AddToCart",{value:f,order_quantity:e.length,currency:"USD",line_items:h},function(k,m){k||this.__appMonitor.reportCustomError("InlinePurchaseCheckoutButton","__checkout","web_perm_0005j","Error returned from pintrk callback",["Reported Error: "+m])}.bind(this))}catch(k){this.__appMonitor.reportCustomError("InlinePurchaseCheckoutButton","__checkout","web_perm_0005c","Error thrown in call to window.pintrk",["Reported Error: "+k.message])}}this.__dollarStoreManager.validateAccountStatus().then(function(){this.__dialogManager.showDialog(g.MultiCartCheckout,{cart:e,paymentChannels:a,defaultChannel:c,vipModel:d,origin:this.__origin,afterAction:this.__afterAction,addRoomTile:this.__addRoomTile}).finished.then(function(){this.__context&&this.__context.close()}.bind(this)).catch(function(){this.__context&&this.__context.close()}.bind(this))}.bind(this))}.bind(this))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],FormatNumber:r,MultiCartCheckout:U,AlreadyHaveVipDialog:Xb,template:Wb}),yc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f='<div class="available-credits font-medium text-12 flex items-center">\n    <div class="flex wh-15 mr-5">';if((h=(d=a.icon||b&&b.icon||h,d.call(b,"icon-credits",{name:"icon",hash:{class:"wh-full"},data:e})))||0===h)f+=h;return f+'</div>\n    <div class="credits-value">'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</div>\n</div>\n"},useData:!0})}({}),zc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=this.escapeExpression;return'\n    <legend class="system-info-header">'+c((d=a.titleText||b&&b.titleText,"function"===typeof d?d.call(b,{name:"titleText",hash:{},data:e}):d))+"</legend>\n"},3:function(b,a,c,e){c='\n    <div class="vip-description">\n        <div class="crown-icon">\n            <svg class="image" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 80 80" class="color-gold" fill-rule="evenodd"><path d="M58 17.272a2.218 2.218 0 0 0-4.434 0c0 .594.234 1.128.612 1.524l-6.216 6.108a.422.422 0 0 1-.681-.129l-6.033-13.698a2.212 2.212 0 0 0 1.017-1.86 2.218 2.218 0 0 0-4.437 0c0 .78.405 1.464 1.017 1.86l-6.033 13.698a.422.422 0 0 1-.681.129l-6.267-6.156c.351-.393.57-.906.57-1.476a2.218 2.218 0 0 0-4.434 0 2.21 2.21 0 0 0 1.992 2.196c.351 2.916 1.941 16.161 1.98 16.212.549 1.272 6.633 2.274 14.076 2.274 7.44 0 13.524-1.002 14.073-2.274.039-.051 1.632-13.326 1.98-16.224A2.208 2.208 0 0 0 58 17.272M24.71 70.81h-3.836L10.633 46h4.786l7.426 18.933L30.235 46h4.68L24.71 70.81zm14.674-.177V46h4.329v24.633h-4.329zm20.13-7.917h-4.892v7.918h-4.328V46h9.712c5.772 0 9.36 3.272 9.36 8.305 0 5.525-4.433 8.41-9.852 8.41zm.14-12.774h-5.032v8.868h5.033c3.272 0 5.313-1.83 5.313-4.4v-.07c0-2.885-2.076-4.398-5.313-4.398z"/></svg>\n        </div>\n        ';var d=a["if"].call(b,b&&b.isCreatorLanding,{name:"if",hash:{},fn:this.program(4,e),inverse:this.program(6,e),data:e});if(d||0===d)c+=d;c+="\n        ";if((d=a["if"].call(b,b&&b.showLearnLink,{name:"if",hash:{},fn:this.program(8,e),inverse:this.noop,data:e}))||0===d)c+=d;return c+"\n    </div>\n"},4:function(b,a,c,e){var d;c=a.helperMissing;var h='\n            <div class="title">',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_creator_description_title",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='</div>\n            <div class="sentence">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_creator_description_sentence",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</div>\n        "},6:function(b,a,c,e){var d;c=a.helperMissing;var h='\n            <div class="title">',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_description_title",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='</div>\n            <div class="sentence">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_description_sentence",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</div>\n        "},8:function(b,a,c,e){var d,h=a.helperMissing;c='\n            <div class="learn-link-outer">\n                <div class="learn-link-inner">\n                    ';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"vip_description_learn_link",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"\n                </div>\n            </div>\n        "},10:function(b,a,c,e){var d;c=a.helperMissing;var h='\n    <legend class="system-info-header">\n        ',f=a["if"].call(b,b&&b.isInCreditDialog,{name:"if",hash:{},fn:this.program(11,e),inverse:this.noop,data:e});if(f||0===f)h+=f;h+="\n        ";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"UPGRADES",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"\n    </legend>\n"},11:function(b,a,c,e){var d,h=a.helperMissing;c="\n            ";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"RECOMMENDED",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c="";var d=a["if"].call(b,b&&b.titleShow,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(d||0===d)c+=d;c+="\n";if((d=a["if"].call(b,b&&b.clubSubscriptionShow,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n";if((d=a.unless.call(b,b&&b.titleShow,{name:"unless",hash:{},fn:this.program(10,e),inverse:this.noop,data:e}))||0===d)c+=d;return c+"\n"},useData:!0})}({}),Ac=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d,h=a.helperMissing;c='\n    <div class="promo-banner sale">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"SALE",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+'<div class="triangle"></div></div>\n'},3:function(b,a,c,e){var d,h=a.helperMissing;c='\n    <div class="promo-banner most-popular">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"MOST POPULAR",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+'<div class="triangle"></div></div>\n'},5:function(b,a,c,e){var d,h=a.helperMissing;c='\n    <div class="promo-banner best-value">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"BEST VALUE",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+'<div class="triangle"></div></div>\n'},7:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f='\n    <div class="item-info">\n        <div class="image-container"><span class="helper"></span><img></div>\n    </div>\n    <div class="item-price">\n        <div class="subscription-title">'+c((d=a.description||b&&b.description,"function"===typeof d?d.call(b,{name:"description",hash:{},data:e}):d))+'</div>\n        <div class="prices">\n            <div class="show-price">\n            ',k=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(8,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+="\n            $"+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+'\n            </div>\n            <div class="show-active">\n                ';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"ACTIVE",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+"\n            </div>\n        </div>\n    </div>\n"},8:function(b,a,c,e){var d;c=this.escapeExpression;return'\n                <span class="original-price">$'+c((d=a.original_price||b&&b.original_price,"function"===typeof d?d.call(b,{name:"original_price",hash:{},data:e}):d))+"</span>\n            "},10:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f='\n    <div class="item-info">\n        <div class="image-container"><img></div>\n        '+c((d=a.itemLabels||b&&b.itemLabels,"function"===typeof d?d.call(b,{name:"itemLabels",hash:{},data:e}):d))+'\n        <div class="check-mark check-mark-hidden">\n            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25">\n                <path fill="#404040" fill-rule="evenodd" d="M11.082 15.579l-3.536-3.536-1.414 1.414 4.243 4.243.707.707 8.485-8.485-1.414-1.415-7.071 7.072zM12.5 22.5c-5.523 0-10-4.477-10-10s4.477-10 10-10 10 4.477 10 10-4.477 10-10 10z"/>\n            </svg>\n        </div>\n    </div>\n    <div class="item-price">\n        <div class="show-price">\n        ',k=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(11,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+="\n        $"+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+'\n        </div>\n        <div class="show-active">\n            ';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"ACTIVE",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+"\n        </div>\n    </div>\n"},11:function(b,a,c,e){var d;c=this.escapeExpression;return'\n            <span class="original-price">$'+c((d=a.original_price||b&&b.original_price,"function"===typeof d?d.call(b,{name:"original_price",hash:{},data:e}):d))+"</span>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c='<div class="wrapper">\n\n';var d=a["if"].call(b,b&&b.is_sale,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(d||0===d)c+=d;c+="\n\n";if((d=a["if"].call(b,b&&b.is_popular,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n\n";if((d=a["if"].call(b,b&&b.is_best,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n\n";if((d=a["if"].call(b,b&&b.showRows,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n\n";if((d=a.unless.call(b,b&&b.showRows,{name:"unless",hash:{},fn:this.program(10,e),inverse:this.noop,data:e}))||0===d)c+=d;return c+"\n</div>\n"},useData:!0})}({}),Bc=function(g){var b=g.UiCore.UiContext;return b.extend("BuyUpgradeListItem",{uiContextName:"buy_upgrade_list_item",tagName:"article",className:"buy-upgrade-list-item",dependencies:"globalStringManager googleAnalytics imageManager loginManager model window".split(" "),trackedEvents:function(){return[{type:"click",name:"choose_upgrade_item",handler:"__onClickItem"}]},initialize:function(a){this.__width=void 0===a.width?"":a.width;""!==this.__width&&(this.__width="width-"+this.__width);this.__selectedVip=IMVU.requireProperty(a,"selectedVip");this.__style=IMVU.optionalProperty(a,"style","");this.__model=a.model;this.__globalStringManager=a.globalStringManager;this.__imageManager=a.imageManager;this.__isInStore=IMVU.optionalProperty(a,"isInStore",!1);this.__context=IMVU.optionalProperty(a,"context",null);this.__isResponsive=IMVU.optionalProperty(a,"isResponsive",!1);b.prototype.initialize.call(this,a);this.__itemLabels=void 0===a.itemLabels?"SUBSCRIPTION":a.itemLabels;this.__itemLabels=this.__globalStringManager.get(this.__itemLabels);this.__scheme=void 0===a.scheme?"":a.scheme;this.__width=void 0===a.width?"":a.width;this.__platform=this.__serviceProvider.get("platform");this.__myself=this.__loginManager.getCurrentUser();this.__isActive=!1;this.$el.toggleClass("is-responsive-tile-list-item",this.__isResponsive);this.addToDOM()},render:function(){b.prototype.render.call(this);this.__myself.populated().then(function(){return this.__model.populated()}.bind(this)).then(function(){this.__hasDiscount=this.__model.edge.get("normal_price")>this.__model.edge.get("sale_price");var a=!1;"in-dialog"!==this.__style||"mobile"!==this.__platform||this.__isResponsive||(a=!0,this.__scheme="rows");this.$el.html(g.template({has_discount:this.__hasDiscount,original_price:this.__model.edge.get("normal_price").toFixed(2),price:this.__model.edge.get("sale_price").toFixed(2),is_sale:this.__hasDiscount,is_best:!1,is_popular:!1,showRows:a,description:this.__model.get("description"),itemLabels:this.__itemLabels}));this.__imageManager.load(this.$(".image-container > img"),this.__model.node.get("img160x160"));this.__hasDiscount&&this.$el.addClass("has-promo");this.__myself.get("is_vip")&&this.$el.addClass("clickblocked");this.__setChecked(!1);"width140"!==this.__width||this.__isResponsive||(this.$el.addClass("width140"),this.$el.addClass("height180"),this.$(".item-info").addClass("width140"),this.$(".item-info").addClass("height140"));this.__modelFrequency="";switch(this.__model.get("frequency_code")){case this.constructor.VIP_MONTHLY:this.__modelFrequency="monthly";break;case this.constructor.VIP_QUARTERLY:this.__modelFrequency="quarterly";break;case this.constructor.VIP_YEARLY:this.__modelFrequency="yearly"}this.__checkForActiveSubscription();this.listenTo(this.__myself,"change:vip_expires",this.__checkForActiveSubscription)}.bind(this))},__checkForActiveSubscription:function(){this.__myself.get("is_vip")?(this.__vipSubscriptions||(this.__vipSubscriptions=this.__myself.getEdgeCollection("vip_subscriptions")),this.__vipSubscriptions.populated().then(function(a){this.__vipNode=null;this.__isActive=!1;this.__subscriptionFrequency="";for(var c=0;c<a.models.length;c++){var e=a.models[c].node;e.get("date_stopped")||e.relations.buyer!==this.__myself.id||e.relations.recipient!==this.__myself.id||e.get("frequency")!==this.__modelFrequency||(this.__vipNode=e,this.__isActive=!0)}this.$el.toggleClass("active",this.__isActive);this.$el.removeClass("clickblocked");this.__vipNode&&this.listenTo(this.__vipNode,"change:date_stopped",this.__subscriptionCancelled)}.bind(this))):(this.$el.removeClass("active"),this.$el.removeClass("clickblocked"))},__subscriptionCancelled:function(){this.stopListening(this.__vipNode);this.__vipNode=null;this.__isActive=!1;this.$el.removeClass("active");this.$el.removeClass("clickblocked")},__setChecked:function(a){this.$el.toggleClass("selected-item",a);if("white_charcoal"===this.__scheme){this.$el.siblings().find(".check-mark").addClass("check-mark-hidden");this.$el.siblings().removeClass("selected-item");this.$el.siblings().find(".item-price").removeClass("item-price-charcoal");this.$el.siblings().find(".item-price").addClass("item-price-white");var c=this.$(".item-price");!0===a?(this.$(".check-mark").removeClass("check-mark-hidden"),c.hasClass("item-price-white")&&c.removeClass("item-price-white"),c.addClass("item-price-charcoal")):(this.$(".check-mark").addClass("check-mark-hidden"),c.hasClass("item-price-charcoal")&&c.removeClass("item-price-charcoal"),c.addClass("item-price-white"))}},__setSelectedVipPayloadToThisProduct:function(){var a=this.__model.node.get("product_packages_id");a=this.constructor.VIP_PRODUCT_PACKAGE_LOOKUP[a];this.__selectedVip.set({model:this.__model,name:this.__model.node.get("name"),price:this.__model.edge.get("sale_price"),original_price:this.__model.edge.get("normal_price"),sku:a.sku,pid:568046,frequency_code:a.frequency_code,type:"vip",image:this.__model.node.get("img160x160")})},__isVipProductPackage:function(){var a=this.__model.node.get("product_packages_id"),c=Object.keys(this.constructor.VIP_PRODUCT_PACKAGE_LOOKUP);c=c.map(function(e){return Number(e)});return _.contains(c,a)},__onClickItem:function(){this.__isActive||this.$el.hasClass("clickblocked")||!this.__isVipProductPackage()||(this.__isInStore?(this.__setSelectedVipPayloadToThisProduct(),this.__googleAnalytics.recordDollarStore("view",this.__model.get("sku")),this.__selectedVip.trigger("click")):(this.$el.toggleClass("selected-item"),this.$el.hasClass("selected-item")?(this.__setChecked(!0),g.NextUtil.DomHelper.radioClass(this.$el,"selected-item"),this.__setSelectedVipPayloadToThisProduct(),this.__context&&this.__context.trigger("add_vip_item",!0)):(this.__setChecked(!1),this.__selectedVip.set({price:0}),this.__context&&this.__context.trigger("add_vip_item",!1))))}},{VIP_PRODUCT_PACKAGE_LOOKUP:{12:{frequency_code:2,sku:"imvu.next.vip.vip.club.monthly"},13:{frequency_code:4,sku:"imvu.next.vip.vip.club.quarterly"},14:{frequency_code:5,sku:"imvu.next.vip.vip.club.annually"}},VIP_MONTHLY:2,VIP_QUARTERLY:4,VIP_YEARLY:5})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:Ac}),Cc=function(g){var b=g.UiCore.ListPresenter;return b.extend("BuyUpgradeList",{uiContextName:"buy_upgrade_list",className:"buy-upgrade-list",tagName:"section",dependencies:["featureAccessManager","globalStringManager","modeManager","nextRoot","window"],trackedEvents:function(){return[{type:"click",selector:".learn-link-inner",name:"vip_description_learn_link",handler:"__onClickLearnLink"}]},itemFactory:g.BuyUpgradeListItem,initialize:function(a){this.itemFactory=IMVU.optionalProperty(a,"itemFactory",this.itemFactory);b.prototype.initialize.call(this,a);this.__width=void 0===a.width?"":a.width;this.__style=IMVU.optionalProperty(a,"style","");this.__isResponsive=IMVU.optionalProperty(a,"isResponsive",!1);this.__isExternalApp=IMVU.optionalProperty(a,"isExternalApp",!1);this.__isCreatorLanding=IMVU.optionalProperty(a,"isCreatorLanding",!1);this.__titleShow=-1===["in-dialog","in-credit-dialog"].indexOf(this.__style)||void 0!==a.titleText;this.__titleText=void 0===a.titleText?"UPGRADE TO VIP":a.titleText;this.__titleText=this.__globalStringManager.get(this.__titleText);this.__clubSubscriptionShow=(-1===["in-dialog","in-credit-dialog"].indexOf(this.__style)||!0===a.clubSubscriptionShow)&&!1!==a.clubSubscriptionShow;this.__showLearnLink=!this.__isCreatorLanding;this.__scheme=void 0===a.scheme?"":a.scheme;this.__bottomPadding=!0===a.bottomPadding;this.$el.toggleClass("is-responsive-tile-list",this.__isResponsive);this.$el.prepend(g.template({width:this.__width,titleShow:this.__titleShow,titleText:this.__titleText,clubSubscriptionShow:this.__clubSubscriptionShow,showLearnLink:this.__showLearnLink,itemLabels:a.itemLabels,isInCreditDialog:"in-credit-dialog"===this.__style,scheme:this.__scheme,isCreatorLanding:"1"==this.__isCreatorLanding}));this.__bottomPadding&&this.$el.addClass("bottom-padding");"1"==this.__isCreatorLanding&&this.$(".crown-icon .image").addClass("for-creator-landing")},__onClickLearnLink:function(a){this.__window.open("https://help.imvu.com/s/article/FAQ-About-VIP","_blank")}})}({UiCore:l["@UiCore"],BuyUpgradeListItem:Bc,template:zc}),Dc=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("BuyCreditDialog",{uiContextName:"buycredit_dialog",className:"buycredit-dialog dialog-type-B",dependencies:"dialogManager dollarStoreManager featureAccessManager globalStartupModel globalStringManager loginManager Promise restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:".back-button",name:"back_to_checkout",handler:this.__backToCheckout}]},initialize:function(a){a=_.extend({includeBuyCredits:!0,includeBuyUpgrades:!1,includePromoCredits:!0},a);b.prototype.initialize.call(this,a);this.purchaseComplete=this.canCloseWithOverlayClick=!1;this.serviceProvider=a.serviceProvider;this.dialogManager=a.dialogManager;this.__stringManager=a.globalStringManager;this.restModelFactory=a.restModelFactory;this.__myself=a.loginManager.getCurrentUser();this.__totalAmount=IMVU.optionalProperty(a,"totalAmount",0);this.__showAmount=0<this.__totalAmount;this.__bestOption=IMVU.optionalProperty(a,"bestOption",0);this.__includePromoCredits=a.includePromoCredits;this.includeBuyCredits=a.includeBuyCredits;this.__includeBuyUpgrades=a.includeBuyUpgrades;this.__formatNumber=g.FormatNumber;this.title=this.__stringManager.get("buycredit_title");this.__selectedCredit=new IMVU.NamedModel({price:0});this.__selectedVip=new IMVU.NamedModel({price:0});this.addToDOM();this.listenTo(this,"add_vip_item",this.__toggleVIPPriceOnSelectedCredit)},destroy:function(){this.promiseResolver&&this.promiseResolver.resolve(this.purchaseComplete);this.hide();this.delete()},show:function(){this.ppcRedeem&&this.ppcRedeem.trigger("clear_input");b.prototype.show.call(this)},postRender:function(){this.__myself.populated().then(function(){this.__wallet=this.__myself.getSingleEdge("wallet");return this.__wallet.populated()}.bind(this)).then(function(){this.__postRenderStore()}.bind(this))},__postRenderStore:function(){this.setContent("body",g.template,{amount:this.__formatNumber.formatCredits(this.__totalAmount),largeAmount:999<this.__totalAmount,showAmount:this.__showAmount});this.$(".products-container").scrollbar();this.setContent("auxHeader",g.headerCreditsTemplate,{});this.createChildContext(g.CheckoutButton,{$parentElement:this.$(".dialog-footer"),selectedCredit:this.__selectedCredit,selectedVip:this.__selectedVip,globalStringManager:this.__stringManager,context:this});this.ppcRedeem=this.createChildContext(g.PPCRedeem,{$parentElement:this.$(".ppc-redeem-placeholder")});this.listenTo(this.ppcRedeem,"successfully_redeemed",this.destroy);this.listenTo(this.ppcRedeem,"redeem_failed",this.__onPPCRedeemFail);this.__updateCreditsDisplay();this.listenTo(this.__wallet,"change",this.__updateCreditsDisplay);var a=["credits","vip"];this.__dollarStoreManager.getPaymentChannels(a).then(function(c){return c.at(0)}.bind(this)).then(function(c){this.__dollarStoreManager.getProductsOffered(a,c).then(function(e){for(var d=new IMVU.NamedCollection,h=new IMVU.NamedCollection,f=0;f<e.models.length;f++){var k=e.models[f];"credits"===k.node.get("category")?d.add(k):"vip"===k.node.get("category")&&h.add(k)}this.includeBuyCredits&&this.createChildContext(g.BuyCreditList,{$parentElement:this.$(".products"),collection:d,selectedCredit:this.__selectedCredit,style:"in-dialog",bestOption:this.__bestOption,context:this});this.__includeBuyUpgrades&&!this.__myself.get("is_vip")&&this.createChildContext(g.BuyUpgradeList,{$parentElement:this.$(".products"),collection:h,selectedVip:this.__selectedVip,style:"in-credit-dialog",globalStringManager:this.__stringManager,context:this,isExternalApp:!1,isResponsive:!0,isCreatorLanding:!1})}.bind(this))}.bind(this))},__currentWealth:function(){return this.__includePromoCredits?parseInt(this.__wallet.get("credits"))+parseInt(this.__wallet.get("promo_credits")):parseInt(this.__wallet.get("credits"))},__updateCreditsDisplay:function(){this.$(".available-credits .credits-value").text(this.__formatNumber.formatCredits(this.__currentWealth()))},__backToCheckout:function(){this.destroy()},__toggleVIPPriceOnSelectedCredit:function(a){0<this.__selectedCredit.get("price")&&(a=a?this.__selectedCredit.get("vip_price"):this.__selectedCredit.get("sale_price"),a!=this.__selectedCredit.get("price")&&this.__selectedCredit.set({price:a}))},__onPPCRedeemFail:function(){this.$(".products-container").scrollTop(this.$(".products-container").height())}})}({Dialogs:l["@Dialogs"],Model:l["@Model"],UiCore:l["@UiCore"],BuyCreditList:Lb,BuyUpgradeList:Cc,CheckoutButton:ua,FormatNumber:r,PPCRedeem:Vb,headerCreditsTemplate:yc,template:Hb}),Ec=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f='\n            <img class="upsell_after_gift_product-ad" src="'+c((d=a.product_ad_url||b&&b.product_ad_url,"function"===typeof d?d.call(b,{name:"product_ad_url",hash:{},data:e}):d))+'">\n            <div class="upsell_after_gift_recipient_received">'+c((d=a.giftRecipient||b&&b.giftRecipient,"function"===typeof d?d.call(b,{name:"giftRecipient",hash:{},data:e}):d))+" ";if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"received_your_gift",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+'</div><br/>\n            <div class="upsell_after_gift_title">'+c((d=a.subtitle||b&&b.subtitle,"function"===typeof d?d.call(b,{name:"subtitle",hash:{},data:e}):d))+"</div>\n        "},3:function(b,a,c,e){var d;c=this.escapeExpression;return'\n            <img class="product-ad" src="'+c((d=a.product_ad_url||b&&b.product_ad_url,"function"===typeof d?d.call(b,{name:"product_ad_url",hash:{},data:e}):d))+'">\n            <div class="title">'+c((d=a.subtitle||b&&b.subtitle,"function"===typeof d?d.call(b,{name:"subtitle",hash:{},data:e}):d))+"</div>\n        "},5:function(b,a,c,e){var d;c=a.helperMissing;var h='\n        <div class="vcoin-bullet-wrapper">\n            <div>',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vcoin_upsell_bullet_intro",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='</div>\n            <ul class="vcoin-upsell-points">\n                <li>';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vcoin_upsell_bullet_point_1",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n                <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vcoin_upsell_bullet_point_2",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n                <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vcoin_upsell_bullet_point_3",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n            </ul>\n            <div>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vcoin_upsell_description_2",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</div>\n            \n        </div>\n        "},7:function(b,a,c,e){var d,h=a.helperMissing;c='\n    <button class="btn btn-primary btn-dark greeter-cta">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"JOIN NOW",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</button>\n"},9:function(b,a,c,e){c='\n    <button class="btn btn-primary checkout-cta disabled">\n        ';if((b=a["if"].call(b,b&&b.simulated,{name:"if",hash:{},fn:this.program(10,e),inverse:this.program(12,e),data:e}))||0===b)c+=b;return c+"\n    </button>\n"},10:function(b,a,c,e){var d,h=a.helperMissing;c="\n            ";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"buy_now",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"\n        "},12:function(b,a,c,e){c="\n            ";if((b=a["if"].call(b,b&&b.upsellAfterGift,{name:"if",hash:{},fn:this.program(13,e),inverse:this.program(15,e),data:e}))||0===b)c+=b;return c+"\n        "},13:function(b,a,c,e){var d,h=a.helperMissing;c="\n                ";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"upsell_after_gift_cta",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"\n            "},15:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f="\n                ";if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"buy_now_for",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+" "+c((d=a.sale_price||b&&b.sale_price,"function"===typeof d?d.call(b,{name:"sale_price",hash:{},data:e}):d))+"\n            "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c='<div class="dialog-body-scroller">\n    <div class="multicart-upsell-panel">\n        ';var d=a["if"].call(b,b&&b.upsellAfterGift,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(d||0===d)c+=d;c+='\n        <div class="description"></div>\n        ';if((d=a["if"].call(b,b&&b.vcoinUpsell,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===d)c+=d;c+='\n        <div class="product-selectors"></div>\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n';if((d=a["if"].call(b,b&&b.greeter,{name:"if",hash:{},fn:this.program(7,e),inverse:this.program(9,e),data:e}))||0===d)c+=d;return c+"\n<\/script>\n"},useData:!0})}({}),va=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=a.helperMissing;var h='\n<div class="vip_web_tier_1-description">\n    <p>',f=a["if"].call(b,b&&b.isCreatorLanding,{name:"if",hash:{},fn:this.program(2,e),inverse:this.program(4,e),data:e});if(f||0===f)h+=f;h+="</p>\n    <ul>\n        <li><strong>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_host_shields",{name:"i18n-g",hash:{tier:"Gold"},data:e})))||0===f)h+=f;h+="</strong></li>\n        <li><strong>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_credits_per_month",{name:"i18n-g",hash:{credits:"2,000"},data:e})))||0===f)h+=f;h+="</strong></li>\n        <li><strong>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_live",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+=" or ";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_chat",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</strong></li>\n        <li><strong>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_hours",{name:"i18n-g",hash:{hours:"2"},data:e})))||0===f)h+=f;h+=" ";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_broadcasting",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</strong></li>\n    </ul>\n    <ul>\n        ";if((f=a["if"].call(b,b&&b.canSeeYouTube,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===f)h+=f;h+="\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_tips",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_support",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_gifts",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</li>\n    </ul>\n</div>\n"},2:function(b,a,c,e){var d,h=a.helperMissing;c="\n        ";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"vip_upsell_creator_landing_body",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"\n    "},4:function(b,a,c,e){var d,h=a.helperMissing;c="\n        ";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"vip_product_prop_description",{name:"i18n-g",hash:{tier:"Gold"},data:e})))||0===a)c+=a;return c+"\n    "},6:function(b,a,c,e){var d,h=a.helperMissing;c="\n        <li>";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"vip_product_prop_streaming",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</li>\n        "},8:function(b,a,c,e){var d;c=a.helperMissing;var h='\n<div class="vip_web_tier_2-description active">\n    <p>',f=a["if"].call(b,b&&b.isCreatorLanding,{name:"if",hash:{},fn:this.program(2,e),inverse:this.program(9,e),data:e});if(f||0===f)h+=f;h+="</p>\n    <ul>\n        <li><strong>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_host_shields",{name:"i18n-g",hash:{tier:"Platinum"},data:e})))||0===f)h+=f;h+="</strong></li>\n        <li><strong>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_credits_per_month",{name:"i18n-g",hash:{credits:"5,000 - 7,400"},data:e})))||0===f)h+=f;h+="</strong></li>\n        <li><strong>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_rooms_and_live",{name:"i18n-g",hash:{live:"2",rooms:"5"},data:e})))||0===f)h+=f;h+="</strong></li>\n        <li><strong>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_hours",{name:"i18n-g",hash:{hours:"6"},data:e})))||0===f)h+=f;h+=" ";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_broadcasting",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</strong></li>\n    </ul>\n    <ul>\n        ";if((f=a["if"].call(b,b&&b.canSeeYouTube,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===f)h+=f;h+="\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_loyalty_credits",{name:"i18n-g",hash:{url:"https://help.imvu.com/s/article/How-do-the-VIP-5000-Credits-Work?language=en_US",credits:"200"},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_tips",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_support",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_gifts",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_whisper",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_no_ads",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_creator",{name:"i18n-g",hash:{url:"https://www.imvu.com/creatorlanding/explore"},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_dressup",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_avatar_actions",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_percent_off_everything",{name:"i18n-g",hash:{percent:"5"},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_percent_off_badges",{name:"i18n-g",hash:{percent:"10"},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_shop_together",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</li>\n    </ul>\n</div>\n"},9:function(b,a,c,e){var d,h=a.helperMissing;c="\n        ";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"vip_product_prop_description",{name:"i18n-g",hash:{tier:"Platinum"},data:e})))||0===a)c+=a;return c+"\n    "},11:function(b,a,c,e){var d;c=a.helperMissing;var h='\n<div class="vip_web_tier_3-description">\n    <p>',f=a["if"].call(b,b&&b.isCreatorLanding,{name:"if",hash:{},fn:this.program(2,e),inverse:this.program(12,e),data:e});if(f||0===f)h+=f;h+="</p>\n    <ul>\n        <li><strong>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_host_shields",{name:"i18n-g",hash:{tier:"Diamond"},data:e})))||0===f)h+=f;h+="</strong></li>\n        <li><strong>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_credits_per_month",{name:"i18n-g",hash:{credits:"6,000 - 8,400"},data:e})))||0===f)h+=f;h+="</strong></li>\n        <li><strong>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_rooms_and_live",{name:"i18n-g",hash:{live:"3",rooms:"10"},data:e})))||0===f)h+=f;h+="</strong></li>\n        <li><strong>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_unlimited",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+=" ";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_broadcasting",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</strong></li>\n        <li><strong>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_unlimited",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+=" ";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_friend_matches",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</strong></li>\n    </ul>\n    <ul>\n        ";if((f=a["if"].call(b,b&&b.canSeeYouTube,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===f)h+=f;h+="\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_loyalty_credits",{name:"i18n-g",hash:{url:"https://help.imvu.com/s/article/How-do-the-VIP-5000-Credits-Work?language=en_US",credits:"200"},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_tips",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_support",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_gifts",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_whisper",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_no_ads",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_creator",{name:"i18n-g",hash:{url:"https://www.imvu.com/creatorlanding/explore"},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_dressup",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_avatar_actions",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_percent_off_everything",{name:"i18n-g",hash:{percent:"5"},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_percent_off_badges",{name:"i18n-g",hash:{percent:"10"},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_shop_together",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</li>\n        <li>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"vip_product_prop_daily_spin",{name:"i18n-g",hash:{spins:"2"},data:e})))||0===f)h+=f;return h+"</li>\n    </ul>\n</div>\n"},12:function(b,a,c,e){var d,h=a.helperMissing;c="\n        ";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"vip_product_prop_description",{name:"i18n-g",hash:{tier:"Diamond"},data:e})))||0===a)c+=a;return c+"\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c="";var d=a["if"].call(b,b&&b.vip_web_tier_1,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(d||0===d)c+=d;c+="\n\n";if((d=a["if"].call(b,b&&b.vip_web_tier_2,{name:"if",hash:{},fn:this.program(8,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n\n";if((d=a["if"].call(b,b&&b.vip_web_tier_3,{name:"if",hash:{},fn:this.program(11,e),inverse:this.noop,data:e}))||0===d)c+=d;return c},useData:!0})}({}),Fc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=this.escapeExpression;return"\n        "+c((d=a.header_text||b&&b.header_text,"function"===typeof d?d.call(b,{name:"header_text",hash:{},data:e}):d))+"\n    "},3:function(b,a,c,e){var d;c=this.escapeExpression;return"\n        "+c((d=a.category||b&&b.category,"function"===typeof d?d.call(b,{name:"category",hash:{},data:e}):d))+"\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c='\n<legend class="system-info-header">\n    ';if((b=a["if"].call(b,b&&b.header_text,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===b)c+=b;return c+"\n    <span class='more-items hidden'>\n        <span class='indicator'>+&nbsp;</span><span class='description'></span>\n    </span>\n</legend>\n"},useData:!0})}({}),Gc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f="\n        ",k=a["if"].call(b,b&&b.is_popular,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+='\n\n        <div class="left">\n            <div class="icon icon-wrapper"><img src="'+c((d=a.image||b&&b.image,"function"===typeof d?d.call(b,{name:"image",hash:{},data:e}):d))+'"></div>\n        </div>\n        <div class="middle">\n            <div class="line1">'+c((d=a.title||b&&b.title,"function"===typeof d?d.call(b,{name:"title",hash:{},data:e}):d))+'</div>\n            <div class="line2">'+c((d=a.line2_text||b&&b.line2_text,"function"===typeof d?d.call(b,{name:"line2_text",hash:{},data:e}):d))+'</div>\n            <div class="line3">\n                ';if((k=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===k)f+=k;f+='\n                <span class="sale-price">'+c((d=a.sale_price||b&&b.sale_price,"function"===typeof d?d.call(b,{name:"sale_price",hash:{},data:e}):d))+'</span>\n            </div>\n        </div>\n        <div class="right">\n            <div class="inner">\n                <span class="label-active hidden">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"ACTIVE",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+"</span>\n            </div>\n        </div>\n    "},2:function(b,a,c,e){var d,h=a.helperMissing;c='\n            <div class="promo-banner most-popular"><span>';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"MOST POPULAR",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+'</span><div class="triangle"></div></div>\n        '},4:function(b,a,c,e){var d;c=this.escapeExpression;return'\n                    <span class="original-price">'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</span>\n                "},6:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f="\n\n        ",k=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+="\n\n        <span class='pend-multiplier hidden' pend-count='0'>\n            <div class=\"pend-tooltip\">\n                <div class=\"tooltip-header\">";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"PENDING_TOOLTIP_TITLE",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</div>\n                <div class="tooltip-body">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"PENDING_TOOLTIP_DESC",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</div>\n            </div>\n        </span>\n        <span class='multiplier' cart-count='0'></span>\n\n        ";if((k=a["if"].call(b,b&&b.is_popular,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n\n        ";if((k=a["if"].call(b,b&&b.is_best,{name:"if",hash:{},fn:this.program(9,e),inverse:this.noop,data:e}))||0===k)f+=k;f+='\n        <div class="item-info">\n            <div class="image-container icon-wrapper"><span class="helper"></span><img src="'+h((d=a.image||b&&b.image,"function"===typeof d?d.call(b,{name:"image",hash:{},data:e}):d))+'"></div>\n            <div class="title">'+h((d=a.title||b&&b.title,"function"===typeof d?d.call(b,{name:"title",hash:{},data:e}):d))+'</div>\n            <div class="title2">'+h((d=a.title2||b&&b.title2,"function"===typeof d?d.call(b,{name:"title2",hash:{},data:e}):d))+'</div>\n            <div class="title3">'+h((d=a.title3||b&&b.title3,"function"===typeof d?d.call(b,{name:"title3",hash:{},data:e}):d))+'</div>\n            <div class="icon icon-ok"></div>\n        </div>\n        <div class="item-price">\n            ';if((k=a["if"].call(b,b&&b.isActive,{name:"if",hash:{},fn:this.program(11,e),inverse:this.program(13,e),data:e}))||0===k)f+=k;return f+"\n        </div>\n    "},7:function(b,a,c,e){var d;c=this.escapeExpression;return'\n            <div class="promo-banner sale">'+c((d=a.sale_copy||b&&b.sale_copy,"function"===typeof d?d.call(b,{name:"sale_copy",hash:{},data:e}):d))+'<div class="triangle"></div></div>\n        '},9:function(b,a,c,e){var d,h=a.helperMissing;c='\n            <div class="promo-banner best-value"><span>';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"BEST VALUE",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+'</span><div class="triangle"></div></div>\n        '},11:function(b,a,c,e){var d,h=a.helperMissing;c="\n                <span>";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"ACTIVE",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</span>\n            "},13:function(b,a,c,e){var d;c=this.escapeExpression;var h="\n                \x3c!-- sales_price is source of truth, if discount show original price with sales price --\x3e\n                ",f=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e});if(f||0===f)h+=f;return h+'\n                <span class="sale-price">'+c((d=a.sale_price||b&&b.sale_price,"function"===typeof d?d.call(b,{name:"sale_price",hash:{},data:e}):d))+"</span>\n            "},15:function(b,a,c,e){return'\n    <div class="separator"></div>\n'},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c='<div class="wrapper">\n    ';var d=a["if"].call(b,b&&b.isMobileAndUpsell,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(6,e),data:e});if(d||0===d)c+=d;c+="\n</div>\n";if((d=a["if"].call(b,b&&b.isMobileAndUpsell,{name:"if",hash:{},fn:this.program(15,e),inverse:this.noop,data:e}))||0===d)c+=d;return c+"\n"},useData:!0})}({}),Hc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;return'<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-ghost btn-dark" data-confirm="no">'+c((d=a.no||b&&b.no,"function"===typeof d?d.call(b,{name:"no",hash:{},data:e}):d))+'</button>\n    <button class="btn btn-primary btn-dark" data-confirm="yes">'+c((d=a.yes||b&&b.yes,"function"===typeof d?d.call(b,{name:"yes",hash:{},data:e}):d))+"</button>\n<\/script>\n"},useData:!0})}({}),Ic=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c='\n<div class="id-body-contents">';if((a=(d=a.html||b&&b.html,"function"===typeof d?d.call(b,{name:"html",hash:{},data:e}):d))||0===a)c+=a;return c+"</div>\n"},3:function(b,a,c,e){var d;c=this.escapeExpression;return'\n<p class="id-body-contents">'+c((d=a.text||b&&b.text,"function"===typeof d?d.call(b,{name:"text",hash:{},data:e}):d))+"</p>\n"},5:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='\n<p class="terms-of-service">\n    <span>',k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"dialog_for_your_reference_terms_of_service",{name:"i18n-g",hash:{},data:e}));if(k||0===k)f+=k;f+=' <a data-external href="'+h((d=a.policyHubUrl||b&&b.policyHubUrl,"function"===typeof d?d.call(b,{name:"policyHubUrl",hash:{},data:e}):d))+'" target="_blank">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Terms of Service",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+"</a>.</span>\n</p>\n"},7:function(b,a,c,e){var d;c=this.escapeExpression;var h='\n<div class="dialog-checkbox-container">\n    <input id="dialog-checkbox" type="checkbox" class="checkbox" ',f=a["if"].call(b,b&&b.checkedByDefault,{name:"if",hash:{},fn:this.program(8,e),inverse:this.noop,data:e});if(f||0===f)h+=f;return h+'><label for="dialog-checkbox">'+c((d=a.checkbox||b&&b.checkbox,"function"===typeof d?d.call(b,{name:"checkbox",hash:{},data:e}):d))+"</label>\n</div>\n"},8:function(b,a,c,e){return"checked"},10:function(b,a,c,e){c='\n<div class="dialog-dropdown-container">\n    <select id="dialog-dropdown">\n        ';var d=a["if"].call(b,(d=b&&b.dropdown,null==d||!1===d?d:d.placeholder),{name:"if",hash:{},fn:this.program(11,e),inverse:this.noop,data:e});if(d||0===d)c+=d;return c+"\n    </select>\n</div>\n"},11:function(b,a,c,e){var d;a=this.escapeExpression;return'\n        <option class="dropdown-placeholder" value="" disabled selected>'+a((d=(d=b&&b.dropdown,null==d||!1===d?d:d.placeholder),"function"===typeof d?d.apply(b):d))+"</option>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h="",f=a["if"].call(b,b&&b.html,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(f||0===f)h+=f;h+="\n\n";if((f=a["if"].call(b,b&&b.termsOfService,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===f)h+=f;h+="\n\n";if((f=a["if"].call(b,b&&b.checkbox,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)h+=f;h+="\n\n";if((f=a["if"].call(b,b&&b.dropdown,{name:"if",hash:{},fn:this.program(10,e),inverse:this.noop,data:e}))||0===f)h+=f;return h+'\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary btn-dark" data-confirm="ok" disabled>'+c((d=a.ok||b&&b.ok,"function"===typeof d?d.call(b,{name:"ok",hash:{},data:e}):d))+"</button>\n<\/script>\n"},useData:!0})}({}),Jc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return""},3:function(b,a,c,e){return" no-header"},5:function(b,a,c,e){var d,h=a.helperMissing;c='\n            <div class="wh-20">';if((a=(d=a.icon||b&&b.icon||h,d.call(b,"icon-chatwindow_close",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)c+=a;return c+"</div>\n        "},7:function(b,a,c,e){var d,h=a.helperMissing;c='\n            <div class="wh-20">';if((a=(d=a.icon||b&&b.icon||h,d.call(b,"icon-dialog_close",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)c+=a;return c+"</div>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='<div class="dialog-container ',k=a["if"].call(b,b&&b.headerIsVisible,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(k||0===k)f+=k;f+='">\n    <a href="#" class="dialog-x">\n        ';if((k=(d=a.platform||b&&b.platform||c,d.call(b,"mobile",{name:"platform",hash:{},fn:this.program(5,e),inverse:this.program(7,e),data:e})))||0===k)f+=k;return f+'\n    </a>\n    <header class="dialog-header">\n        <h3 class="dialog-title nowrap">'+h((d=a.title||b&&b.title,"function"===typeof d?d.call(b,{name:"title",hash:{},data:e}):d))+'</h3>\n    </header>\n    <div class="aux-header"></div>\n    <section class="dialog-body"></section>\n    <footer class="dialog-footer"></footer>\n</div>\n'},useData:!0})}({}),Kc=function(g){var b=g.AlloyAlertDialog;return b.extend("AlloyConfirmDialog",{uiContextName:"confirm_dialog_alloy",className:"confirm-dialog-alloy",trackedEvents:function(){return[{type:"click",selector:'[data-confirm="yes"]',name:"confirm",handler:"__onConfirm",attributes:{which:this.__confirmDialogType}},{type:"click",selector:'[data-confirm="no"]',name:"deny",handler:"__onDeny",attributes:{which:this.__confirmDialogType}}]},initialize:function(a){a.title=a.title;a.text=a.text;this.yes=a.yes;this.no=a.no;this.__confirmDialogType=a.confirmDialogType;this.darkText=IMVU.optionalProperty(a,"dark_text",!1);this.eventAttributes=IMVU.optionalProperty(a,"eventAttributes",{});b.prototype.initialize.call(this,a)},postRender:function(){b.prototype.postRender.call(this);this.$el.attr("data-type","confirm");this.setContent("body",g.template,{yes:this.yes,no:this.no});var a=this.$(".dialog-footer-template");this.$(".dialog-footer").html("");this.setContent("footer",a.last().text());this.darkText&&this.$el.addClass("dark-text")},__onConfirm:function(){var a=_.extend(this.getResult(),{confirm:"yes"});this.promiseResolver.resolve(a);this.hide()},__onDeny:function(){var a=_.extend(this.getResult(),{confirm:"no"});this.promiseResolver.reject(a);this.hide()},__getUiAttributes:function(a){return _.extend(this.eventAttributes,b.prototype.__getUiAttributes.call(this,a))}})}({AlloyAlertDialog:function(g){var b=g.AlloyModalDialog;return b.extend("AlloyAlertDialog",{uiContextName:"alert_dialog_alloy",className:"alert-dialog-alloy",dependencies:["externalNextRoot"],trackedEvents:function(){return[{type:"click",selector:'[data-confirm="ok"]',name:"confirm",handler:"__onConfirm"},{type:"change",selector:"#dialog-dropdown",name:"option",handler:"__toggleConfirmButton"}]},initialize:function(a){this.title=a.title;this.text=a.text;this.html=a.html;this.darkText=IMVU.optionalProperty(a,"dark_text",!1);b.prototype.initialize.call(this,a);this.ok=a.ok||this.__stringManager.get("OK");this.checkbox=a.checkbox;this.dropdown=a.dropdown;this.termsOfService=a.termsOfService;this.checkedByDefault=_.isUndefined(a.checkedByDefault)?!0:a.checkedByDefault;this.addToDOM()},postRender:function(){this.setContent("body",g.template,{text:this.text,html:this.html,ok:this.ok,checkbox:this.checkbox,dropdown:this.dropdown,termsOfService:this.termsOfService,checkedByDefault:this.checkedByDefault,policyHubUrl:this.__externalNextRoot+"policyhub/"});this.setContent("footer",this.$(".dialog-footer-template").last().text());this.$("#dialog-dropdown").length&&(_.each(this.dropdown.options,function(a){this.$("#dialog-dropdown").append('<option value="'+a.value+'">'+a.label+"</option>")}.bind(this)),this.reasonDropDown=this.createChildContext(g.Dropdown,{$replaceElement:this.$("#dialog-dropdown")}));this.$(".dialog-title").toggleClass("long-title",this.title&&19<this.title.length);this.darkText&&this.$el.addClass("dark-text");this.__toggleConfirmButton()},getResult:function(){var a={},c=this.$("#dialog-checkbox"),e=this.$("#dialog-dropdown");c.length&&(a.checked=c.is(":checked"));e.length&&(a.dropdown=e.val());return a},__onConfirm:function(){this.$(".btn-primary").prop("disabled",!0);this.promiseResolver.resolve(this.getResult());this.hide()},__toggleConfirmButton:function(){this.$("#dialog-dropdown").length?this.$(".btn-primary").prop("disabled",!this.$("#dialog-dropdown").val()):this.$(".btn-primary").prop("disabled",!1)}})}({AlloyModalDialog:function(g){var b=g.UIContextExtension;return b.extend("AlloyModalDialog",{uiContextName:"modal_dialog_alloy",className:"alloy-modal-dialog",dependencies:["appMonitor","globalStringManager","nextRoot","Promise","window"],hasCloseButton:!0,headerIsVisible:!0,contentAreas:{header:".dialog-header",auxHeader:".aux-header",body:".dialog-body",footer:".dialog-footer"},initialize:function(a){b.prototype.initialize.call(this,a);"undefined"!==typeof a.hasCloseButton&&(this.hasCloseButton=a.hasCloseButton);"undefined"!==typeof a.headerIsVisible&&(this.headerIsVisible=a.headerIsVisible);this.serviceProvider=a.serviceProvider;this.__appMonitor=a.appMonitor;this.dialogManager=a.dialogManager;this.__stringManager=a.globalStringManager;this.__nextRootBase=this.__nextRoot.replace("/next/","");this.__postToParent="undefined"===typeof a.postToParent?!0:a.postToParent;this.canCloseWithOverlayClick=IMVU.optionalProperty(a,"canCloseWithOverlayClick",!0);this.__appMonitor.waypoint("AlloyModalDialog::initialize:"+this.constructor.name);this.finished=new a.Promise(function(c){this.promiseResolver=c}.bind(this));this.shouldFocusOnPrimaryButton=!0;a=this.delete.bind(this);this.finished.then(a,a);this.$el.attr("data-ui-role","modal-dialog");this.$el.on("focusin",function(c){this.$el.closest("html").addClass("dialog-focused")}.bind(this));this.$el.on("focusout",function(c){this.$(c.target).closest(".dropdown").length||this.$el.closest("html").removeClass("dialog-focused")}.bind(this));this.$el.trigger("focusout");this.__postToParent&&this.__window.parent&&this.__window.parent.postMessage&&this.__window.parent.postMessage({message:"opening_modal_dialog",type:this.uiContextName},"*")},render:function(){var a=this;this.doWork([function(){a.$el.html(g.template({title:a.title||"",headerIsVisible:a.headerIsVisible}));a.$(".dialog-x").on("click",a.__onClose.bind(a));a.$el.toggleClass("can-dismiss",a.hasCloseButton);a.postRender();a.$el.closest("html").attr("data-dialog",a.uiContextName);a.__focusPrimaryButton();a.$el.is(".dialog-type-B, .dialog-type-B-flexible")&&a.$el.closest("body").is(".mobile")&&470>a.$el.width()&&(a.$el.is(".text-close")?a.$(".dialog-x").text("Close"):a.$el.is(".text-done")?a.$(".dialog-x").text("Done"):a.$el.is(".text-none")?a.$(".dialog-x").text(""):a.$(".dialog-x").text("Cancel"),a.__adjustTitlePosition())}])},__adjustTitlePosition:function(){this.$(".dialog-title").removeClass("overflowed");var a=this.$(".dialog-title").width(),c=this.$(".dialog-header").width();a<=c-160?this.$(".dialog-title").toggleClass("overflowed",!1):this.$(".dialog-title").toggleClass("overflowed",!0)},linkToDetailsSubmode:function(a,c){this.serviceProvider.get("historyManager").setState({fragment:this.__urlId(c.id),mode:{id:a},submode:{id:c.id,summary:{model:c}}})&&(a=function(){this.serviceProvider.get("historyManager").silentMoveHistory(-1)}.bind(this),this.finished.then(a,a))},show:function(){this.__appMonitor.waypoint("AlloyModalDialog::show:"+this.constructor.name);b.prototype.show.call(this);this.__focusPrimaryButton()},hide:function(){this.__appMonitor.waypoint("AlloyModalDialog::hide:"+this.constructor.name);b.prototype.hide.call(this);this.$el.closest("html").removeAttr("data-dialog")},close:function(){this.__appMonitor.waypoint("AlloyModalDialog::close:"+this.constructor.name);this.hide();this.promiseResolver.reject()},closeAll:function(a){a.preventDefault();this.__recordEvent("click",{name:"dialog_close"});this.__dialogManager.closeAll()},showHeader:function(){this.headerIsVisible=!0;this.$(".dialog-container").removeClass("no-header")},hideHeader:function(){this.headerIsVisible=!1;this.$(".dialog-container").addClass("no-header")},toggleHeader:function(){this.headerIsVisible?this.hideHeader():this.showHeader()},__onClose:function(a){a.preventDefault();this.__recordEvent("click",{name:"dialog_close"});this.close()},__focusPrimaryButton:function(){if(this.shouldFocusOnPrimaryButton){var a=this.$(".btn-primary");1<a.length?a.trigger("blur"):a.first().focus()}},updateDialogTitle:function(a){this.$(".dialog-header .dialog-title").text(a);this.__adjustTitlePosition()},delete:function(){this.__appMonitor.waypoint("AlloyModalDialog::delete:"+this.constructor.name);this.__postToParent&&this.__window.parent&&this.__window.parent.postMessage&&this.__window.parent.postMessage({message:"deleting_modal_dialog",type:this.uiContextName},"*");b.prototype.delete.call(this)}})}({UiCore:l["@UiCore"],UIContextExtension:Q,template:Jc}),Dropdown:G,template:Ic}),template:Hc}),Lc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d,h=a.helperMissing;c='\n        <button class="btn btn-primary btn-dark disabled">\n            ';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"IN CART",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"\n        </button>\n    "},3:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f='\n        <button class="btn btn-primary btn-dark">\n            ';if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"ADD TO CART FOR",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"&nbsp;<span>"+c((d=a.sale_price||b&&b.sale_price,"function"===typeof d?d.call(b,{name:"sale_price",hash:{},data:e}):d))+"</span>\n        </button>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=this.escapeExpression;c='<div class="multicart-upgrade-panel">\n    <img class="product-ad" src="'+h((d=a.product_ad_url||b&&b.product_ad_url,"function"===typeof d?d.call(b,{name:"product_ad_url",hash:{},data:e}):d))+'">\n    <div class="title">\n        '+h((d=a.subtitle||b&&b.subtitle,"function"===typeof d?d.call(b,{name:"subtitle",hash:{},data:e}):d))+'\n    </div>\n    <div class="description"></div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    ';if((b=a["if"].call(b,b&&b.in_cart,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===b)c+=b;return c+"\n<\/script>\n"},useData:!0})}({}),Mc=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("MultiCartUpgrade",{className:"multicart-upgrade-dialog dialog-type-B",uiContextName:"multicart_upgrade_dialog",dependencies:["dollarStoreManager","featureAccessManager","globalStringManager","model"],trackedEvents:function(){return[{type:"click",selector:".btn-primary",name:"add_to_cart",handler:"__addToCart"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__model.node.attributes.name;this.__cartCollection=IMVU.optionalProperty(a,"cartCollection",null);this.__inCart=!1;this.__package_map={};this.__package_map.dlg_namechange={subtitle_key:"UPGRADE_NAME_CHANGE_TOKEN_TITLE",desc_key:"UPGRADE_NAME_CHANGE_TOKEN_DESC"};this.__package_map.dlg_accesspass={subtitle_key:"UPGRADE_ACCESS_PASS_TITLE",desc_key:"UPGRADE_ACCESS_PASS_DESC"};this.__package_map.dlg_namereg={subtitle_key:"UPGRADE_NAME_REGISTRATION_TITLE",desc_key:"UPGRADE_NAME_REGISTRATION_DESC"};this.__package_map.dlg_ageverify={subtitle_key:"UPGRADE_AGE_VERIFICATION_TITLE",desc_key:"UPGRADE_AGE_VERIFICATION_DESC"};this.__package_map.dlg_sharedroom={subtitle_key:"UPGRADE_SHARED_ROOM_TITLE",desc_key:"UPGRADE_SHARED_ROOM_DESC"};this.__package_map.dlg_chatroomslot={subtitle_key:"UPGRADE_CHATROOM_SLOT_TITLE",desc_key:"UPGRADE_CHATROOM_SLOT_DESC"};this.__package_map.dlg_marriagepackage={subtitle_key:"UPGRADE_MARRIAGE_LICENSE_TITLE",desc_key:"UPGRADE_MARRIAGE_LICENSE_DESC"};this.__package_map.dlg_vip={subtitle_key:"UPGRADE_VIP_TITLE",desc_key:"UPGRADE_VIP_DESC"};this.__package_map.dlg_tiered_vip={subtitle_key:"UPGRADE_VIP_TITLE",desc_key:"UPGRADE_"+this.__model.node.get("code_name")};this.__package_map.dlg_host_subscription={subtitle_key:"UPGRADE_HOST_SUB_TITLE",desc_key:"UPGRADE_HOST_SUB_DESC",dlg_title:"UPGRADE_HOST_SUB_DLG_TITLE"};this.__package_map.dlg_credits={subtitle_key:"UPGRADE_CREDITS_TITLE",desc_key:"UPGRADE_CREDITS_DESC"};this.__package_map.vcoin={subtitle_key:"UPGRADE_VCOIN_TITLE",desc_key:"UPGRADE_VCOIN_DESC",dlg_title:"UPGRADE_VCOIN_DLG_TITLE"};this.__package_map.dlg_badge_canvas={subtitle_key:"UPGRADE_BADGE_CANVAS_SUBTITLE",desc_key:"UPGRADE_BADGE_CANVAS_DESC"};this.__dlgName=this.__model.node.get("dlg_name");(a=this.__package_map[this.__dlgName])?(this.__subtitle=this.__globalStringManager.get(a.subtitle_key),this.__description=this.__globalStringManager.get(a.desc_key),a.dlg_title&&(this.title=this.__globalStringManager.get(a.dlg_title))):(this.__subtitle=this.__globalStringManager.get("UPGRADE_CREDITS_TITLE"),this.__description=this.__globalStringManager.get("UPGRADE_CREDITS_DESC"));"dlg_tiered_vip"==this.__model.node.get("dlg_name")&&(a={},this.__description=g.multiProductUpsellVipTiers((a[this.__model.node.get("code_name")]=1,a.canSeeYouTube=this.__featureAccessManager.canSeeYouTubePreRecorded(),a)));this.addToDOM();this.$(".dialog-container").addClass(this.__dlgName)},postRender:function(){this.__cartCollection&&this.__package_map[this.__dlgName]&&("vip"===this.__model.node.attributes.category||"hosting"===this.__model.node.attributes.category)&&(this.__inCart=this.__isMatchingProductId());this.setContent("body",g.template,{product_ad_url:this.__model.node.get("dlg_background_url"),subtitle:this.__subtitle,sale_price:this.__model.edge.attributes.sale_price_formatted,in_cart:this.__inCart});this.$(".description").html(this.__description);this.setContent("footer",this.$(".dialog-footer-template").text())},__addToCart:function(){this.close();this.__model.trigger("select_and_add_item_to_cart")},__isMatchingProductId:function(){return!_.isEmpty(_.filter(this.__cartCollection.models,function(a){if(void 0!==this.__model.node.attributes.id&&void 0!==a.attributes.node.id)return this.__model.node.attributes.id===a.attributes.node.id}.bind(this)))}})}({Dialogs:l["@Dialogs"],Model:l["@Model"],UiCore:l["@UiCore"],multiProductUpsellVipTiers:va,template:Lc}),Nc=function(g){var b=g.Dialogs.AlloyConfirmDialog;return b.extend("LinkUpholdDialog",{uiContextName:"link_uphold_dialog",className:"link-uphold-dialog",dependencies:["globalStringManager","loginManager"],trackedEvents:function(){return[{type:"click",name:"link_uphold_account",selector:"[data-confirm=yes]",handler:this.__onLink},{type:"click",name:"cancel_linking_uphold_account",selector:"[data-confirm=no]",handler:this.__onCancel}]},initialize:function(a){this.__globalStringManager=a.globalStringManager;this.__loginManager=a.loginManager;this.__wallet=IMVU.optionalProperty(a,"wallet",null);null===this.__wallet&&(this.__myself=this.__loginManager.getCurrentUser(),this.__myself.populated().then(function(){this.__wallet=this.__myself.getSingleEdge("wallet")}.bind(this)));a.title=this.__globalStringManager.get("vcoin_link_uphold_account");a.text=this.__globalStringManager.get("vcoin_link_uphold_text");a.yes=this.__globalStringManager.get("Continue");a.no=this.__globalStringManager.get("Cancel");this.hasCloseButton=!1;b.prototype.initialize.call(this,a)},postRender:function(){b.prototype.postRender.call(this)},__onCancel:function(){this.close()},__onLink:function(){this.__wallet.populated().then(function(){this.__upholdLink=this.__wallet.get("uphold_url");this.__window.open(this.__upholdLink,"_blank");this.close()}.bind(this))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"]}),Oc=function(g){var b=g.UiCore.UiContext;return b.extend("MultiProductItem",{uiContextName:"multi_product_item",tagName:"article",className:"multi-product-item",dependencies:"dialogManager dollarStoreManager featureAccessManager globalStringManager googleAnalytics iconManager imageManager leanplum loginManager model securitySettingsManager urlManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".wrapper:not(.is-active) .item-info",name:"choose_product_item",handler:"__userClickedUpper"},{type:"click",selector:".wrapper:not(.is-active) .item-price",name:"choose_product_item",handler:"__userClickedLower"},{type:"click",selector:".wrapper:not(.is-active).upsell",name:"choose_product_item",handler:"__userClickedLower"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__viewType=IMVU.optionalProperty(a,"viewType","row");this.__category=IMVU.optionalProperty(a,"category",null);this.__cartCollection=this.__parentUiContext.getCartCollection?this.__parentUiContext.getCartCollection():null;this.__isMobile=this.__featureAccessManager.isMobile();this.__isUpsell=IMVU.optionalProperty(a,"isUpsell",!1);this.__specialCase=null;this.__userClicked=!1;this.__upsellDialog=IMVU.optionalProperty(a,"upsellDialog",null);this.addToDOM()},render:function(){b.prototype.render.call(this);this.__model.populated().then(function(){this.__category=this.__model.node.get("category");this.__isTieredVIP="vip"===this.__category&&"dlg_tiered_vip"===this.__model.node.get("dlg_name");this.__isActive=-1!==this.__model.edge.get("rules").indexOf("active");this.__renderTemplate();this.$el.data("id",this.__model.node.get("product_packages_id"));this.__isActive?(this.__isTieredVIP&&this.__upsellDialog&&this.__upsellDialog.switchDescription&&this.__upsellDialog.switchDescription(this.__model.node.get("code_name")),this.$el.addClass("is-active"),this.$(".wrapper").addClass("is-active")):(this.listenTo(this.__model,"removed_from_cart",this.__onRemoveFromCart),this.listenTo(this.__model,"select_and_add_item_to_cart",this.__selectAndAddItemToCart),this.listenTo(this.__model,"add_pending_item_to_cart",this.__addPendingItemToCart));this.createChildContext(g.Tooltip,{$replaceElement:this.$(".pend-tooltip"),$tooltipTarget:this.$(".pend-multiplier"),tooltipPosition:"bottom"});this.__isUpsell&&(this.$el.addClass("upsell"),this.$(".wrapper").addClass("upsell"),this.__isActive&&this.$(".label-active").removeClass("hidden"));this.__window.addEventListener("message",this.__receiveMessage.bind(this),!0);this.$el.addClass(this.__viewType+"-view");this.$el.addClass("category-"+this.__category);"vip"===this.__category&&"dlg_tiered_vip"===this.__model.node.get("dlg_name")&&(this.$el.addClass(this.__model.node.get("code_name")),this.$el.addClass("tiered_vip"))}.bind(this))},__selectAndAddItemToCart:function(){this.__selectItem()},__addPendingItemToCart:function(){this.__selectItem({pended:!0})},__confirmVIPDowngrade:function(a){var c=["","gold","platinum","diamond"],e=this.__model.edge.get("metadata.tier"),d=this.__model.node.get("code_name").substr(-1);c=this.__globalStringManager.get("vip_downgrade_"+c[e]+"_to_"+c[d]+"_body");this.__dialogManager.confirm({title:this.__globalStringManager.get("common_subscription_cancel_confirm_dialog_title"),text:c,no:this.__globalStringManager.get("CANCEL"),yes:this.__globalStringManager.get("OKAY")}).finished.then(function(){a()})},__vcoinErrorCheck:function(a,c){c=void 0===c?{}:c;c=c.rules_hit?c.rules_hit:this.__dollarStoreManager.validateMultiCartShoppingRules(this.__model,this.__cartCollection);var e=this.__model.edge.get("metadata.available_for_purchase"),d=this.__dollarStoreManager.getCartVcoinTotal(),h=this.__model.node.attributes.vcoin;if(c.includes("region_blocked")&&!this.__ignoreRegionBlockedRule)this.__upsellDialog?(this.__upsellDialog.trigger("vcoin_product_selected_in_blocked_region"),a()):this.__showVcoinUnavailableDialog(a);else if(c.includes("purchase_limit")&&c.includes("unavailable")||d+h>e)c='<a href="'+this.__urlManager.get("vcoin_limits")+'" target="_blank">'+this.__globalStringManager.get("vcoin_unavailable_limit_reached_error_message_link")+"</a>",c="<p>"+this.__globalStringManager.get("vcoin_unavailable_limit_reached_error_message")+" "+c+".</p>",this.__dialogManager.alert({title:this.__globalStringManager.get("vcoin_unavailable_limit_reached_error_title"),html:c,ok:this.__globalStringManager.get("OKAY"),dark_text:!0}).finished.then(function(){this.__upsellDialog&&this.__upsellDialog.upsellAfterGift&&this.__dialogManager.closeAll()}.bind(this));else{if(c.includes("requires_kyc")&&c.includes("unavailable"))return this.__dialogManager.showDialog(g.LinkUpholdDialog,{}).finished.then(function(){this.$el.removeClass("is-selected")}.bind(this));c.includes("require_2FA")?this.__dollarStoreManager.userHasTwoFactorAuth()?(this.__canBuyVcoinWithRules=!0,a()):this.__securitySettingsManager.get("2fa_enabled").then(function(f){this.__dollarStoreManager.setUserTwoFactorAuthStatus(f["2fa_enabled"]);if(f["2fa_enabled"])this.__canBuyVcoinWithRules=!0,a();else return this.__dialogManager.showDialog(g.TwoFactorSetupAlertDialog,{requireSetup:!0}).finished.then(function(){this.__dollarStoreManager.setUserTwoFactorAuthStatus(!0);this.__canBuyVcoinWithRules=!0;a()}.bind(this))}.bind(this)):a()}},__showVcoinUnavailableDialog:function(a){var c='<a href="'+this.__urlManager.get("unavailable_vcoin")+'" target="_blank">'+this.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_link")+"</a>";c="<p>"+this.__globalStringManager.get("vcoin_unavailable_error_text")+" "+c+"</p>";this.__dialogManager.showDialog(g.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("vcoin_unavailable_error_title"),text:this.__globalStringManager.get("vcoin_unavailable_error_text"),html:c,yes:this.__globalStringManager.get("Continue"),no:this.__globalStringManager.get("CANCEL"),dark_text:!0}).finished.then(function(){this.__ignoreRegionBlockedRule=!0;this.__vcoinErrorCheck(a)}.bind(this))},__userClickedUpper:function(){if(this.__upsellDialog)this.__userClickedLower();else{this.__userClicked=!0;var a=function(){this.__dollarStoreManager.validateAccountStatus(this.__model).then(function(){return this.__dialogManager.showDialog(g.MultiCartUpgrade,{model:this.__model,cartCollection:this.__cartCollection}).finished.then(function(){}.bind(this))}.bind(this))}.bind(this);"vcoin"===this.__category?this.__vcoinErrorCheck(a):a()}},__selectItem:function(a){var c=this;a=void 0===a?{pended:!1}:a;"vip"===this.__category&&this.__productSwap(this.__model,this.__category);var e=this.__dollarStoreManager.validateMultiCartShoppingRules(this.__model,this.__cartCollection);-1!==e.indexOf("require_2FA")&&"vcoin"!==this.__category?this.__dollarStoreManager.userHasTwoFactorAuth()?(e=_.without(e,"require_2FA"),this.__handleSelection(a,e)):this.__securitySettingsManager.get("2fa_enabled").then(function(d){c.__dollarStoreManager.setUserTwoFactorAuthStatus(d["2fa_enabled"]);if(d["2fa_enabled"])e=_.without(e,"require_2FA"),c.__handleSelection(a,e);else return c.__dialogManager.showDialog(g.TwoFactorSetupAlertDialog,{requireSetup:!0}).finished.then(function(){c.__dollarStoreManager.setUserTwoFactorAuthStatus(!0);e=_.without(e,"require_2FA");c.__handleSelection(a,e)})}):"vcoin"===this.__category?e.includes("purchase_limit")||(e=_.without(e,"region_blocked"),this.__vcoinErrorCheck(function(){return c.__handleSelection(a,e)},{rules_hit:e})):-1!==e.indexOf("downgrade")&&"vip"===this.__category?(e=_.without(e,"downgrade"),this.__userClicked?this.__confirmVIPDowngrade(function(){return c.__handleSelection(a,e)}):this.__handleSelection(a,e)):this.__handleSelection(a,e)},__handleSelection:function(a,c){if(_.isEmpty(c)||"vcoin"===this.__category&&this.__canBuyVcoinWithRules){c=parseInt(this.$(".multiplier").attr("cart-count"),10);var e=parseInt(this.$(".pend-multiplier").attr("pend-count"),10);a.pended?this.$(".pend-multiplier").attr("pend-count",++e):(this.__dollarStoreManager.trigger("select_multicart_item",this.__model),this.$el.hasClass("is-selected")||this.$el.addClass("is-selected"),this.$(".multiplier").attr("cart-count",++c));!this.__dollarStoreManager.isLoading()&&this.__userClicked&&this.__dollarStoreManager.trigger("update_persistent_cart",this.__model,c)}else if(this.__userClicked){var d=[];a="";_.each(c,function(h){try{d.push(this.__globalStringManager.get(h))}catch(f){d.push(h)}}.bind(this));d=d.join(" ");a=this.__globalStringManager.get("rules_dialog_title");["apple","google_play"].includes(this.__model.edge.attributes["metadata.provider"])?(d=this.__globalStringManager.get("vip_upsell_previous_subscription_mobile_body",{company:this.__globalStringManager.get("vip_upsell_company_3"),platform:this.__globalStringManager.get("vip_upsell_platform_3")}),a=this.__globalStringManager.get("vip_upsell_previous_subscription_title")):"unavailable"===d&&(d=this.__globalStringManager.get("add_to_cart_error_unavailable_text"));return this.__dialogManager.showDialog(g.Dialogs.AlloyAlertDialog,{title:a,text:d,ok:this.__globalStringManager.get("add_to_cart_error_ok")})}this.__userClicked=!1},__userClickedLower:function(){var a=this,c=null;this.__wasSelected=this.$el.hasClass("is-selected");this.__upsellDialog?c=function(){a.__isTieredVIP&&a.__upsellDialog&&a.__upsellDialog.switchDescription&&a.__upsellDialog.switchDescription(a.__model.node.get("code_name"));a.$el.siblings().removeClass("is-selected");a.$el.toggleClass("is-selected",!a.__wasSelected);a.__upsellDialog.aProductClicked(a.__wasSelected?null:a.__model,a.__category)}:(this.__userClicked=!0,c=function(){this.__selectItem()}.bind(this));"vcoin"===this.__category?this.__vcoinErrorCheck(c):c()},__receiveMessage:function(a){a.data.showDialog&&(this.codeName=a.data.showDialog,this.codeName===this.__model.node.attributes.code_name&&this.__userClickedLower())},__refreshProduct:function(){this.__model.invalidate();this.render()},__renderTemplate:function(){var a=this.__model.edge.get("normal_price")>this.__model.edge.get("sale_price"),c="1"===this.__model.node.get("most_popular"),e=this.__model.node.get("is_best"),d=this.__model.node.get("name"),h=this.__model.node.get("initial_selection");"vip"===this.__category&&(d=this.__model.node.get("name"));this.$el.html(g.template({image:this.__model.node.get("img160x160"),price:this.__model.edge.get("normal_price_formatted"),sale_price:this.__model.edge.get("sale_price_formatted"),title:d,title2:"",title3:"",has_discount:a,is_popular:c,is_best:e,sale_copy:this.__globalStringManager.get("SALE"),isRow:"row"===this.__viewType,isActive:this.__isActive,isMobileAndUpsell:this.__isMobile&&this.__isUpsell,line2_text:"",isVIP:"vip"===this.__category}));""!==this.__model.node.get("svgicon")&&(a=this.__model.node.get("svgicon"),this.$(".icon-wrapper").html(this.__iconManager.iconHtml(a)));this.__isMobile&&this.__isUpsell&&"vip"===this.__category&&this.$(".line2").addClass("hidden");!this.__isUpsell||this.__upsellDialog&&this.__upsellDialog.upsellAfterGift||h&&this.__userClickedLower();h=this.__model.node.get("should_disable");a=this.__model.node.get("disabled");!0===h?(this.$el.addClass("disabled"),this.__model.node.set("should_disable",null)):this.$el.toggleClass("disabled",void 0===a?!1:a)},__onRemoveFromCart:function(a,c){c=void 0!==c?c:!0;a=_.map(a.models,function(e){return e.attributes.node.product_packages_id});-1===_.indexOf(a,this.__model.node.attributes.product_packages_id)?(this.$el.removeClass("is-selected"),a=0):a=this.$(".multiplier").attr("cart-count")-1;this.$(".multiplier").attr("cart-count",a);c&&this.__dollarStoreManager.trigger("update_persistent_cart",this.__model,a)},__productSwap:function(a,c){_.each(this.__cartCollection.models,function(e){if(e&&e.attributes.node.category===c&&a.node.attributes.product_packages_id!==e.attributes.node.product_packages_id)return this.__cartCollection.remove(e),0===this.__cartCollection.length&&this.__dollarStoreManager.trigger("empty_multi_cart"),this.__dollarStoreManager.trigger("update_cart_total_price"),e.attributes.productModel.trigger("removed_from_cart",this.__cartCollection),!1}.bind(this))},_setCartCollection:function(a){this.__cartCollection=a}})}({Dialogs:l["@Dialogs"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],AlloyConfirmDialog:Kc,LinkUpholdDialog:Nc,MultiCartUpgrade:Mc,Tooltip:y,TwoFactorSetupAlertDialog:ma,template:Gc}),wa=function(g){var b=g.UiCore.ListPresenter;return b.extend("MultiProductList",{className:"multi-product-list",uiContextName:"multi_product_list",tagName:"section",dependencies:["category","featureAccessManager","globalStringManager","platform"],trackedEvents:function(){return[{type:"click",selector:".more-items",name:"more_items",handler:"__onToggleMoreItems"}]},initialize:function(a){this.itemFactory=a.itemFactory||g.MultiProductItem;var c=!a.collection||0===a.collection.length;this.__cartCollection=IMVU.optionalProperty(a,"cartCollection",null);this.__isUpsell=IMVU.optionalProperty(a,"isUpsell",!1);this.__noInitialUpsellSelection=IMVU.optionalProperty(a,"noInitialUpsellSelection",!1);this.__headerText=IMVU.optionalProperty(a,"headerText","");this.__disabledProducts=IMVU.optionalProperty(a,"disabledProducts",[]);this.__selectedProduct=IMVU.optionalProperty(a,"selectedProduct",!1);this.__featureAccessManager=a.featureAccessManager;this.__isUpsell&&!c&&(this.__noInitialUpsellSelection?this.__unsetInitialUpsellSelection(a.collection.models):this.__setInitialUpsellSelection(a.collection.models));b.prototype.initialize.call(this,a);this.__isMobile=this.__featureAccessManager.isMobile();this.$el.prepend(g.template({category:this.__globalStringManager.get(this.__category),header_text:this.__headerText,no_products:c}));this.__isUpsell&&(this.$el.addClass("upsell"),this.__headerText||this.$(".system-info-header").remove());if("credits"===this.__category||"vcoin"===this.__category)"credits"===this.__category?(this.__moreOptionsText=this.__globalStringManager.get("MORE CREDIT OPTIONS"),this.__lessOptionsText=this.__globalStringManager.get("Less Credit Options")):"vcoin"===this.__category&&(this.__moreOptionsText=this.__globalStringManager.get("More VCOIN Options"),this.__lessOptionsText=this.__globalStringManager.get("Less VCOIN Options")),this.$(".system-info-header .more-items .description").text(this.__moreOptionsText),this.$(".system-info-header .more-items").removeClass("hidden"),this.__childSelector="article:nth-of-type(n+4)",this.__isUpsell||this.$(this.__childSelector).addClass("is-collapsed")},getCartCollection:function(){return this.__cartCollection},__setInitialUpsellSelection:function(a){var c=this;if(void 0!==a&&0!==a.length){var e=-1,d=-1;e=a.findIndex(function(h){return"1"===h.node.get("most_popular")});d=a.findIndex(function(h){return(h=h.edge.get("rules"))&&-1!==h.indexOf("active")});a.forEach(function(h,f){h.node.set("should_disable",c.__disabledProducts.includes(f))});!1!==this.__selectedProduct?a[Math.max(0,Math.min(a.length-1,this.__selectedProduct))].node.set("initial_selection",!0):-1!==e&&e>d?a[e].node.set("initial_selection",!0):this.__unsetInitialUpsellSelection(a)}},__unsetInitialUpsellSelection:function(a){void 0!==a&&0!==a.length&&a.forEach(function(c){c.node&&c.node.get("initial_selection")&&c.node.set("initial_selection",!1)})},__onToggleMoreItems:function(){this.$(this.__childSelector).toggleClass("is-collapsed");this.$(this.__childSelector).hasClass("is-collapsed")?(this.$(".more-items .indicator").text("+ "),this.$(".system-info-header .more-items .description").text(this.__moreOptionsText)):(this.$(this.__childSelector).css({transition:"height 0.25s ease"}),this.$(".more-items .indicator").text("- "),this.$(".system-info-header .more-items .description").text(this.__lessOptionsText))}})}({UiCore:l["@UiCore"],MultiProductItem:Oc,template:Fc}),xa=function(g){return IMVU.NamedCollection.extend("CartCollection",{markSelectedProducts:function(){this.each(function(b){b.set("is_selected",!0)}.bind(this))}})}({}),H=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("MultiCartUpsellDialog",{className:"multicart-upsell-dialog dialog-type-B",uiContextName:"multicart_upsell_dialog",dependencies:"dialogManager featureAccessManager globalStartupModel globalStringManager loginManager urlManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".checkout-cta:not(.disabled)",name:"add_to_cart",handler:"__handleCheckout"},{type:"click",selector:".greeter-cta",name:"greeter_cta",handler:"__handleGreeterCTA"},{type:"click",selector:".learn",name:"learn_more",handler:this.__handleLearnMore}]},initialize:function(a){b.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.__singleItemCart=new g.CartCollection([]);if(this.__isLoggedIn=this.__loginManager.isLoggedIn())this.__dollarStoreManager=this.__serviceProvider.get("dollarStoreManager"),this.__myself=this.__loginManager.getCurrentUser();this.__upsellProduct=IMVU.requireProperty(a,"upsellProduct","credits");this.__isCreatorLanding=IMVU.optionalProperty(a,"isCreatorLanding",!1);this.__customSubtitle=IMVU.optionalProperty(a,"customSubtitle",!1);this.__customDlg_name=IMVU.optionalProperty(a,"customDlg_name",!1);this.__customDescription=IMVU.optionalProperty(a,"customDescription",!1);this.upsellAfterGift=IMVU.optionalProperty(a,"upsellAfterGift",!1);this.__customProductAdUrl=IMVU.optionalProperty(a,"customProductAdUrl",!1);this.__giftRecipient=IMVU.optionalProperty(a,"giftRecipient",!1);this.__isContextual=IMVU.optionalProperty(a,"contextual",!1);this.__afterAction=IMVU.optionalProperty(a,"afterAction",null);this.__vipForWhisper=IMVU.optionalProperty(a,"vipForWhisper",!1);this.__vipTrigger=IMVU.optionalProperty(a,"vipTrigger",null);this.__vipTriggerLocation=IMVU.optionalProperty(a,"vipTriggerLocation",null);this.__model=null;this.__simulated=!1;this.__packageMap=this.__getPackageMap();this.__categories=this.__getCategories().categories;this.__storeType=this.__getCategories().storeType;this.__disabledProducts=IMVU.optionalProperty(a,"disabledProducts",[]);this.__selectedProduct=IMVU.optionalProperty(a,"selectedProduct",!1);this.__isTieredVIP="vip"===this.__upsellProduct;this.addToDOM()},postRender:function(){var a=this;this.$el.addClass("product-"+this.__upsellProduct);if(this.__isLoggedIn&&"greeter"!==this.__upsellProduct)this.__dollarStoreManager.getPaymentChannels(this.__categories,this.__storeType).then(function(e){a.__paymentChannels=e;if(e.at(0)&&"vantiv"===e.at(0).attributes.payment_method){var d=_.find(e.models,function(h){if("vantiv"===h.attributes.channel_key)return h});a.__defaultPaymentChannel=d?d:e.at(0)}else a.__defaultPaymentChannel=e.at(0)}).then(function(){"vcoin"===a.__upsellProduct&&a.listenTo(a,"vcoin_product_selected_in_blocked_region",function(){this.__showVcoinUnavailableOnCheckout=!0});if(void 0===a.__defaultPaymentChannel&&"vcoin"==a.__upsellProduct){var e='<a href="'+a.__urlManager.get("unavailable_vcoin")+'" target="_blank">'+a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_link")+"</a>";e="<p>"+a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_part1")+" "+e+". "+a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_part2")+"</p>";a.__dialogManager.alert({title:a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_title"),html:e,ok:a.__globalStringManager.get("OKAY"),dark_text:!0}).finished.then(function(){a.hide()})}else a.__dollarStoreManager.getProductsOffered(a.__categories,a.__defaultPaymentChannel,void 0,!0).then(function(d){var h=!1;a.__upsellProductModel=null;a.__upsellProductCollection=d;for(var f=d.models,k=f.length,m,n=0;n<k;n++)if(m=f[n],"access_pass"===m.node.get("code_name")&&"ap"===a.__upsellProduct||"marriage_license"===m.node.get("code_name")&&"marriage_package"===a.__upsellProduct||"age_verification"===m.node.get("code_name")&&"age_verification"===a.__upsellProduct||"shared_room"===m.node.get("code_name")&&"shared_room"===a.__upsellProduct||"name_change_tokens"===m.node.get("code_name")&&"name_change"===a.__upsellProduct||"name_change_and_registration"===m.node.get("code_name")&&"name_change"===a.__upsellProduct||"chat_room_slot"===m.node.get("code_name")&&"room_slot"===a.__upsellProduct){a.__upsellProductModel=m;break}a.__upsellProductModel?h=!0:("host_subscription"===a.__upsellProduct||"credits"===a.__upsellProduct||"vcoin"===a.__upsellProduct)&&0<f.length?(a.__upsellProductModel=d.models[0],h=!0):"vip"===a.__upsellProduct&&0<f.length?(a.__upsellProductModel=d.models[0],h=!0):"vip"===a.__upsellProduct&&0===f.length&&(h=!1);a.__model=a.__upsellProductModel;a.__model&&h?a.__getPackageMapOverrides():a.__getSimulatedModel()}).catch(function(d){}).then(function(){a.title=a.__model.node.attributes.name;a.__getPackageMapOverrides();a.__isTieredVIP&&(a.__isCreatorLanding?(a.title=a.__globalStringManager.get("vip_upsell_creator_landing_title"),a.__subtitle=a.__globalStringManager.get("vip_upsell_creator_landing_subtitle")):(a.title=a.__globalStringManager.get("vip_upsell_title"),a.__subtitle=a.__globalStringManager.get("vip_upsell_subtitle")));a.__renderTitle();a.upsellAfterGift&&a.__adjustDialogSize();a.setContent("body",g.template,{product_ad_url:a.__customProductAdUrl?a.__customProductAdUrl:a.__model.node.attributes.dlg_background_url,subtitle:a.__subtitle,loggedIn:a.__isLoggedIn,greeter:"greeter"===a.__upsellProduct,sale_price:a.__model.edge.attributes.sale_price_formatted,upsellAfterGift:a.upsellAfterGift,giftRecipient:a.__giftRecipient,simulated:a.__simulated});if("vip"===a.__upsellProduct&&a.__vipTrigger&&a.__vipTriggerLocation){var d={vipTriggerLocation:a.__vipTriggerLocation,vipTrigger:a.__vipTrigger,clientIp:a.__globalStartupModel.get("clientIPAddress")};a.recordShowTieredVipUpsell(d)}a.$(".description").html(a.__isTieredVIP?g.multiProductUpsellVipTiers({vip_web_tier_1:1,vip_web_tier_2:1,vip_web_tier_3:1,isCreatorLanding:a.__isCreatorLanding,canSeeYouTube:a.__featureAccessManager.canSeeYouTubePreRecorded()}):a.__description);a.setContent("footer",a.$(".dialog-footer-template").text());a.__isLoggedIn&&("credits"===a.__upsellProduct||"host_subscription"===a.__upsellProduct||"vip"===a.__upsellProduct)||"vcoin"===a.__upsellProduct?(a.__disableCheckoutButton(),a.upsellAfterGift&&a.__enableCheckoutButton(),d=a.$(".product-selectors").expect(1),d.addClass("go-link"),d.html(""),a.__simulated?a.__enableSimulatedCheckoutButton():a.productsList=a.createChildContext(g.MultiProductList,{$parentElement:d,collection:a.__upsellProductCollection,cartCollection:a.__singleItemCart,category:a.__upsellProduct,upsellDialog:a,isUpsell:!0,disabledProducts:a.__disabledProducts,selectedProduct:a.__selectedProduct})):a.__simulated?a.__enableSimulatedCheckoutButton():a.__enableCheckoutButton();a.$el.is(".dialog-type-B, .dialog-type-B-flexible")&&a.$el.closest("body").is(".mobile")&&a.__adjustTitlePosition();a.$(".dialog-body-scroller").scrollbar()}).catch(function(d){a.__window.console.error("HostSubUpsellDialog::render - Failed to render BuyUpgradeHostSubList",d)})}).catch(function(){a.__window.console.error("HostSubUpsellDialog::render - Failed to get payment channels")});else{var c="vcoin"===this.__upsellProduct;this.__getSimulatedModel();this.setContent("body",g.template,{product_ad_url:this.__customProductAdUrl?this.__customProductAdUrl:this.__model.node.attributes.dlg_background_url,subtitle:this.__subtitle,loggedIn:this.__isLoggedIn,greeter:"greeter"===this.__upsellProduct,sale_price:this.__model.edge.attributes.sale_price_formatted,simulated:!0,vcoinUpsell:c,upsellAfterGift:this.upsellAfterGift,giftRecipient:this.__giftRecipient});c&&this.$(".dialog-body").addClass("vcoin-logged-out");"vip"===this.__upsellProduct&&(!1===this.__selectedProduct&&(this.__selectedProduct=1),c={},this.__description=g.multiProductUpsellVipTiers((c["vip_web_tier_"+(1+this.__selectedProduct)]=1,c.canSeeYouTube=this.__featureAccessManager.canSeeYouTubePreRecorded(),c)));this.$(".description").html(this.__description);this.setContent("footer",this.$(".dialog-footer-template").text());this.__enableSimulatedCheckoutButton();this.$(".dialog-body-scroller").scrollbar()}},__directToLogin:function(){this.__loginManager.setLoginDestination(this.__nextRoot+"store/"+this.__upsellProduct);this.__window.location="/welcome/login/";this.forwardedToLogin=!0},aProductClicked:function(a){this.__model=a;null===a?this.__disableCheckoutButton():(this.__enableCheckoutButton(),this.upsellAfterGift&&this.__addToCart(!0))},switchDescription:function(a){this.$("."+a+"-description").show().siblings().hide()},__getErrorString:function(){var a="",c=!1===this.__myself.get("is_adult");switch(this.__upsellProduct){case"ap":a=c?this.__globalStringManager.get("oops_minor_ap"):this.__globalStringManager.get("oops_already_have_ap");break;case"marriage_package":a=c?this.__globalStringManager.get("oops_minor_marriage_package"):this.__globalStringManager.get("oops_already_have_this_upgrade");break;case"age_verification":a=c?this.__globalStringManager.get("oops_minor_age_verification"):this.__globalStringManager.get("oops_already_have_this_upgrade");break;case"vip":a=this.__globalStringManager.get("oops_already_have_vip");break;default:this.__window.console.error("MultiCartUpsellDialog::__getErrorString - __upsellProduct not accepted",this.__upsellProduct)}return a},__handleCheckout:function(){this.__isLoggedIn&&"vcoin"===this.__upsellProduct&&this.__showVcoinUnavailableOnCheckout?this.__showVcoinUnavailableDialog():this.__addToCart()},__showVcoinUnavailableDialog:function(){var a=this,c='<a href="'+this.__urlManager.get("unavailable_vcoin")+'" target="_blank">'+this.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_link")+"</a>";c="<p>"+this.__globalStringManager.get("vcoin_unavailable_error_text")+" "+c+"</p>";this.__dialogManager.showDialog(g.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("vcoin_unavailable_error_title"),text:this.__globalStringManager.get("vcoin_unavailable_error_text"),html:c,yes:this.__globalStringManager.get("Continue"),no:this.__globalStringManager.get("CANCEL"),dark_text:!0}).finished.then(function(){a.__addToCart()}).catch(function(e){})},__determineAfterAction:function(){var a=this.__afterAction;if(null===a)switch(this.__upsellProduct){case"ap":case"marriage_package":case"age_verification":case"vip":a=this.__isContextual?this.__vipForWhisper?"close":"closeAll":"reload";break;default:a="closeAll"}return a},__addToCart:function(a){var c=this;if(this.__isLoggedIn)if(!this.__simulated||"ap"!==this.__upsellProduct&&"marriage_package"!==this.__upsellProduct&&"age_verification"!==this.__upsellProduct&&"vip"!==this.__upsellProduct)if(this.__upsellProduct){this.$(".checkout-cta").addClass("disabled");var e=new IMVU.NamedModel({node:this.__model.node.attributes,edge:this.__model.edge.attributes,productModel:this.__model});this.__singleItemCart.add(e);if(this.__isCreatorLanding){e=[];e.push({product_name:this.__model.node.attributes.code_name,product_id:this.__model.node.attributes.product_packages_id.toString(),product_category:this.__model.node.attributes.category,product_price:this.__model.edge.attributes.sale_price,product_quantity:1});try{this.__window.pintrk("track","AddToCart",{value:this.__model.edge.attributes.sale_price,order_quantity:1,currency:"USD",line_items:e},function(d,h){d||this.__appMonitor.reportCustomError("MultiCartUpsellDialog","__addToCart","web_perm_0005k","Error returned from pintrk callback",["Reported Error: "+h])}.bind(this))}catch(d){this.__appMonitor.reportCustomError("MultiCartUpsellDialog","__addToCart","web_perm_0005d","Error thrown in call to window.pintrk",["Reported Error: "+d.message])}}this.__dollarStoreManager.validateAccountStatus().then(function(){this.__dialogManager.showDialog(g.MultiCartCheckout,{cart:this.__singleItemCart,paymentChannels:this.__paymentChannels,defaultChannel:this.__defaultPaymentChannel,origin:"dollar",which:this.__vipTrigger,afterAction:this.__determineAfterAction()}).finished.then(function(){this.close()}.bind(this)).catch(function(){this.close()}.bind(this))}.bind(this)).then(function(){this.$(".checkout-cta").removeClass("disabled");this.upsellAfterGift&&!a&&this.__dialogManager.closeAll()}.bind(this))}else this.close();else this.__myself.populated().then(function(){var d=c.__getErrorString();c.__dialogManager.showDialog(g.Dialogs.AlloyAlertDialog,{title:c.__globalStringManager.get("oops"),text:d,ok:c.__globalStringManager.get("OKAY")}).finished.then(function(){c.__dialogManager.closeAll()})});else this.__directToLogin()},__enableCheckoutButton:function(){this.$(".checkout-cta").removeClass("disabled");this.upsellAfterGift?this.$(".checkout-cta").html(this.__globalStringManager.get("upsell_after_gift_cta")):this.$(".checkout-cta").html(this.__globalStringManager.get("buy_now_for")+" "+this.__model.edge.attributes.sale_price_formatted)},__enableSimulatedCheckoutButton:function(){this.$(".checkout-cta").removeClass("disabled");this.$(".checkout-cta").html(this.__globalStringManager.get("buy_now"))},__disableCheckoutButton:function(){this.$(".checkout-cta").addClass("disabled");this.$(".checkout-cta").html(this.__globalStringManager.get("buy_now"))},__clearCart:function(){this.__singleItemCart=new g.CartCollection([])},show:function(){this.__clearCart();b.prototype.show.call(this)},hide:function(){if(this.__isLoggedIn){b.prototype.hide.call(this);var a=new CustomEvent("multiCartUpsellDialog:closed");this.__window.dispatchEvent(a)}else this.__directToLogin()},close:function(){if(this.__isLoggedIn){var a=new CustomEvent("multiCartUpsellDialog:clickedCancel");this.__window.dispatchEvent(a);b.prototype.close.call(this)}else this.__directToLogin()},__handleLearnMore:function(){this.$(".description-short").addClass("hidden");this.$(".learn").addClass("hidden");this.$(".description-long").removeClass("hidden");this.$(".lines").removeClass("hidden")},__handleGreeterCTA:function(){this.__featureAccessManager.isElectronClient()?this.__serviceProvider.get("externalWindow").open(this.__urlManager.get("greeter_program_info")):this.__window.location=this.__urlManager.get("greeter_program_info")},__renderTitle:function(){this.$(".dialog-header .dialog-title").text(this.title)},__adjustDialogSize:function(){this.$(".dialog-container").removeClass(this.title);this.$(".dialog-container").addClass("upsell_after_gift_"+this.__upsellProduct)},__getSimulatedModel:function(){this.__simulated=!0;var a={node:{}};a.node.attributes={dlg_name:"",name:"",dlg_background_url:"",sale_price_formatted:""};a.edge={};a.edge.attributes={sale_price_formatted:null};switch(this.__upsellProduct){case"ap":a.node.attributes.dlg_name="dlg_accesspass";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_ap");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-access-pass-2021-01-15.jpg";break;case"marriage_package":a.node.attributes.dlg_name="dlg_marriagepackage";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_marriage_package");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-marriage-package-2021-01-15.jpg";break;case"age_verification":a.node.attributes.dlg_name="dlg_ageverify";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_age_verification");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-age-verification-2021-01-15.jpg";break;case"shared_room":a.node.attributes.dlg_name="dlg_sharedroom";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_shared_room");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-shared-room-2021-01-15.jpg";break;case"name_change":a.node.attributes.dlg_name="dlg_namechange";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_name_change");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-name-change-token-2021-01-15.jpg";break;case"room_slot":a.node.attributes.dlg_name="dlg_chatroomslot";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_room_slot");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-chat-room-slot-2021-01-15.jpg";break;case"credits":a.node.attributes.dlg_name="dlg_credits";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_credits");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-buy-credits-2021-01-15.jpg";break;case"vip":a.node.attributes.dlg_name="dlg_vip";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_vip");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/vip/products/upsell_large_art.png";break;case"host_subscription":a.node.attributes.dlg_name="dlg_host_subscription";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_host_subscription");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-become-a-host-2021-01-15.jpg";break;case"greeter":a.node.attributes.dlg_name="dlg_greeter";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_greeter");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-greeter-program-2021-01-15.jpg";break;case"vcoin":a.node.attributes.dlg_name="vcoin";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_vcoin");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-buy-vcoin-2021-01-15.jpg";break;default:a=null,this.__window.console.error("MultiCartSubmode::__getSimulatedModel - Unknown product",this.__upsellProduct)}a.on=function(){};this.__model=a;this.title=this.__model.node.attributes.name;this.__getPackageMapOverrides();this.__renderTitle();this.upsellAfterGift&&this.__adjustDialogSize()},__getPackageMap:function(){return{dlg_namechange:{subtitle_key:"UPGRADE_NAME_CHANGE_TOKEN_TITLE",desc_key:"UPGRADE_NAME_CHANGE_TOKEN_DESC",dlg_title:"MCS_Simulated_Model_Name_name_change"},dlg_accesspass:{subtitle_key:"UPGRADE_ACCESS_PASS_TITLE",desc_key:"UPGRADE_ACCESS_PASS_DESC"},dlg_namereg:{subtitle_key:"UPGRADE_NAME_REGISTRATION_TITLE",desc_key:"UPGRADE_NAME_REGISTRATION_DESC"},dlg_ageverify:{subtitle_key:"UPGRADE_AGE_VERIFICATION_TITLE",desc_key:"UPGRADE_AGE_VERIFICATION_DESC"},dlg_sharedroom:{subtitle_key:"UPGRADE_SHARED_ROOM_TITLE",desc_key:"UPGRADE_SHARED_ROOM_DESC"},dlg_chatroomslot:{subtitle_key:"UPGRADE_CHATROOM_SLOT_TITLE",desc_key:"UPGRADE_CHATROOM_SLOT_DESC"},dlg_marriagepackage:{subtitle_key:"UPGRADE_MARRIAGE_LICENSE_TITLE",desc_key:"UPGRADE_MARRIAGE_LICENSE_DESC"},dlg_vip:{subtitle_key:"UPGRADE_VIP_TITLE",desc_key:"UPGRADE_VIP_DESC",dlg_title:"MCS_Simulated_Model_Name_vip"},dlg_host_subscription:{subtitle_key:"UPGRADE_HOST_SUB_TITLE",desc_key:"UPGRADE_HOST_SUB_DESC",dlg_title:"UPGRADE_HOST_SUB_DLG_TITLE"},dlg_credits:{subtitle_key:"UPGRADE_CREDITS_TITLE",desc_key:"UPGRADE_CREDITS_DESC",dlg_title:"MCS_Simulated_Model_Name_credits"},dlg_greeter:{subtitle_key:"UPGRADE_GREETER_TITLE",desc_key:"UPGRADE_GREETER_DESC",dlg_title:"MCS_Simulated_Model_Name_greeter"},vcoin:{subtitle_key:"UPGRADE_VCOIN_TITLE",desc_key:"UPGRADE_VCOIN_DESC",dlg_title:"MCS_Simulated_Model_Name_vcoin"},upsell_after_gift_subtitle_credits:{subtitle_key:"upsell_after_gift_subtitle_credits",desc_key:"UPGRADE_CREDITS_DESC",dlg_title:"upsell_after_gift_title"},upsell_after_gift_subtitle_vcoin:{subtitle_key:"upsell_after_gift_subtitle_vcoin",desc_key:"UPGRADE_VCOIN_DESC",dlg_title:"upsell_after_gift_title"},upsell_after_gift_subtitle_product:{subtitle_key:"upsell_after_gift_subtitle_product",desc_key:"UPGRADE_CREDITS_DESC",dlg_title:"upsell_after_gift_title"}}},__getCategories:function(){switch(this.__upsellProduct){case"ap":case"marriage_package":case"age_verification":case"shared_room":case"name_change":case"room_slot":var a=["upgrade"],c="next";break;case"credits":a=["credits"];c="next";break;case"vip":a=["vip"];c="next";break;case"host_subscription":a=["hosting"];c="next";break;case"greeter":break;case"vcoin":a=["vcoin"];c="vcoin";break;case"product":this.__upsellProduct="credits";a=["credits"];c="next";break;default:this.__window.console.error("MultiCartUpsellDialog::getCategories - Unknown product",this.__upsellProduct,". Setting default to credits."),this.__upsellProduct="credits",a=["credits"],c="next"}return{categories:a,storeType:c}},__setDialogText:function(a){this.__subtitle=this.__isCreatorLanding||this.__customDlg_name?this.__customSubtitle:this.__globalStringManager.get(a.subtitle_key);this.__description=this.__isCreatorLanding?this.__customDescription:this.__globalStringManager.get(a.desc_key)},__getPackageMapOverrides:function(){this.__dlgName=this.__model.node.attributes.dlg_name;this.$(".dialog-container").addClass(this.__dlgName);this.__customDlg_name&&(this.__dlgName=this.__customDlg_name);var a=this.__packageMap[this.__dlgName];a?(this.__setDialogText(a),this.__isLoggedIn?"host_subscription"===this.__upsellProduct&&(this.__description='<p class="description">'+this.__globalStringManager.get("host_subscription_upsell_dialog_description")+'</p><ul class="lines"><li class="line1 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line1")+'</li><li class="line2 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line2")+'</li><li class="line3 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line3")+'</li><li class="line4 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line4")+"</li></ul>"):"host_subscription"===this.__upsellProduct?this.__description+='<div class="spacer"></div><div class="spacer"></div>'+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_prompt")+'<br><div class="spacer"></div><ul><li>'+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_line1")+"</li><li>"+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_line2")+"</li><li>"+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_line3")+"</li></ul>":"vip"===this.__upsellProduct&&(this.__description+='<div class="spacer"></div><div class="spacer"></div>'+this.__globalStringManager.get("vip_upsell_dialog_extension_prompt")+'<br><div class="spacer"></div><ul><li>'+this.__globalStringManager.get("vip_upsell_dialog_extension_line1")+"</li><li>"+this.__globalStringManager.get("vip_upsell_dialog_extension_line2")+"</li><li>"+this.__globalStringManager.get("vip_upsell_dialog_extension_line3")+"</li></ul>"),a.dlg_title&&(this.title=this.__isCreatorLanding?this.__globalStringManager.get("buyupgrade_creator_title"):this.__globalStringManager.get(a.dlg_title))):(this.__subtitle=this.__globalStringManager.get("UPGRADE_CREDITS_TITLE"),this.__description=this.__globalStringManager.get("UPGRADE_CREDITS_DESC"))},_testGetCart:function(){return this.__singleItemCart},_testGetErrorString:function(){return this.__getErrorString()},_testGetDeterminedAfterAction:function(){return this.__determineAfterAction()}})}({Dialogs:l["@Dialogs"],Model:l["@Model"],UiCore:l["@UiCore"],CartCollection:xa,MultiCartCheckout:U,MultiCartList:ta,MultiProductList:wa,multiProductUpsellVipTiers:va,template:Ec}),Pc=function(g){var b=g.UiCore.UiContext;return b.extend("WipeReveal",{className:"Wipe-Reveal",uiContextName:"wipe_reveal",dependencies:["dialogManager","featureAccessManager","loginManager","window"],trackedEvents:function(){return[{type:"click",selector:".below-base",name:"wipe_reveal_above_click",handler:"__onClickAbove"},{type:"click",selector:".wipe-trigger",name:"wipe_reveal_below_click",handler:"__onClickBelow"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.aboveWidget=a.aboveWidget;this.belowWidget=a.belowWidget;this.addToDOM();this.__myself=this.__loginManager.getCurrentUser();this.listenTo(this.__myself,"change:is_vip",this.__hideUpsell)},__hideUpsell:function(){this.$el.toggleClass("hide-upsell",!!this.__myself.get("is_vip"))},render:function(){this.$el.html(g.template);"undefined"!==typeof this.aboveWidget&&(this.aboveWidgetChild=this.createChildContext(this.aboveWidget,{$parentElement:this.$(".above")}));"undefined"!==typeof this.belowWidget&&(this.belowWidgetChild=this.createChildContext(this.belowWidget,{$parentElement:this.$(".below")}));var a=this.$(".wipe-trigger");a.on("mouseover",function(){a.addClass("hover")});a.on("mouseout",function(){a.removeClass("hover")});a.on("click",function(c){if("mobile"===this.__serviceProvider.get("platform"))a.hasClass("peeled-back")||c.stopPropagation();else if(a.hasClass("hover"))return;a.toggleClass("peeled-back")}.bind(this));this.$(".Wipe-Reveal").on("click",function(){a.removeClass("peeled-back")})},__onClickAbove:function(a){this.__dialogManager.showDialog(g.BuyCreditDialog,{totalAmount:0})},__onClickBelow:function(a){return this.__dialogManager.showDialog(g.MultiCartUpsellDialog,{upsellProduct:"vip",contextual:!0,vipTriggerLocation:"unknown",vipTrigger:"wipe_reveal",disabledProducts:[],selectedProduct:1})}})}({UiCore:l["@UiCore"],BuyCreditDialog:Dc,MultiCartUpsellDialog:H,template:Gb}),Qc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='<div class="error-icon">',k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-cart-full",{name:"icon",hash:{},data:e}));if(k||0===k)f+=k;f+='</div>\n<div class="error-body">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"shopping_cart_full_error",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+'</div>\n<button class="btn btn-primary dismiss">'+h((d=a.ctaText||b&&b.ctaText,"function"===typeof d?d.call(b,{name:"ctaText",hash:{},data:e}):d))+"</button>\n"},useData:!0})}({}),Rc=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("CartFullErrorDialog",{uiContextName:"cart_full_error_dialog",className:"cart-full-error-dialog",dependencies:["dialogManager"],trackedEvents:function(){return[{type:"click",selector:".dismiss",name:"dismiss",handler:"__dismiss"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__ctaText=a.ctaText;this.addToDOM()},postRender:function(){this.hideHeader();this.$(".dialog-body").replaceWith(g.template({ctaText:this.__ctaText}))},__dismiss:function(){this.hide();this.promiseResolver.resolve()}})}({Dialogs:l["@Dialogs"],template:Qc}),Sc=function(g){var b=g.DressUpAvatarManager;return b.extend("CartDressUpAvatarManager",{dependencies:["loginManager","Promise","restModelFactory"],initialize:function(a){a.persistLooks=!1;b.prototype.initialize.call(this,a);this.__loginManager=a.loginManager;this.__productRoot=this.__serviceProvider.get("root")+"/product/product-";this.__cartPidsPromise=this.__Promise.accept([]);this.__clearTrackedPids()},__setCartPids:function(){return this.__cartPidsPromise=this.__Promise.every(this.__cartProducts.map(function(a){if(a.node){if(a.node.get("is_bundle")){var c=a.node.getEdgeCollection("subproducts",g.Model.ProductEdgeCollection);return c.populated().catch(function(){}.bind(this)).then(function(){return this.__Promise.accept(_.pluck(c.filter(function(e){return e.node&&e.node.isPopulated()}),"node"))}.bind(this))}if(_.contains(a.node.get("is"),"clothing_product"))return this.__Promise.accept(a.node)}return this.__Promise.accept()}.bind(this))).then(function(a){this.__clothingProducts=_.compact(_.flatten(a));this.__cartPids=_.map(this.__clothingProducts,function(c){return c.get("product_id")}.bind(this));return this.__Promise.accept(this.__cartPids)}.bind(this))},__addClothingToAvatar:function(a){var c=_.last(a);return c?this.checkGenderMatches(c.id).then(function(e){var d=_.pluck(a,"id");return e?this.addProducts(d):this.changeGenderAndAdd(c.get("gender"),d)}.bind(this)):this.__Promise.accept()},__refreshAvatarClothing:function(a){this.__clearTrackedPids();this.__setCartPids().then(function(){var c=this.__lookModel.get("products");this.__addClothingToAvatar(this.__clothingProducts.concat(c))}.bind(this))},setCartProducts:function(a){this.__cartProducts=a;return this.__cartProducts.populated({ignoreBadProducts:!0}).then(function(){return this.__setCartPids()}.bind(this)).then(function(c){return this.__addClothingToAvatar(this.__clothingProducts)}.bind(this)).then(function(){this.listenTo(this.__cartProducts,"add remove",this.__refreshAvatarClothing.bind(this))}.bind(this))},__clearTrackedPids:function(){this.__trackedAdds=[]},__setTrackedPids:function(a,c){var e=this.__lookModel.getLookPids();return this.__cartPidsPromise.then(function(d){d=_.intersection(e,d);this.__trackedAdds=_.intersection(d,a)}.bind(this))},__buildChangeQuery:function(a,c,e){_.each([a,c],function(h){_.each(h,function(f,k){_.isString(h[k])&&(h[k]=parseInt(h[k].replace(/^(.*\/product[\-\/])*(\d+)$/,"$2"),10))}.bind(this))}.bind(this));a=_.uniq(a.reverse()).reverse();c=_.uniq(c.reverse()).reverse();var d={};0<a.length&&(d.add=a);0<c.length&&(d.remove=c);this.__loginManager.isLoggedIn()&&(e&&0<e.length?d.baseProductList=e:this.__lookModel&&(d.baseProductList=_.pluck(this.__lookModel.get("products"),"product_id")));return d},replaceAllProducts:function(a){var c=this.__trackedAdds;return b.prototype.replaceAllProducts.call(this,a).then(function(){return c&&0<c.length?this.addProducts(c):this.__Promise.accept()}.bind(this))},forceChangeToLookUrl:function(a,c){this.__clearTrackedPids();return b.prototype.forceChangeToLookUrl.call(this,a,c)},__setCurrentLookAlert:function(){this.dialogManager.alert({title:this.__globalStringManager.get("dialog_get_current_look_error_title"),text:this.__globalStringManager.get("dialog_get_current_look_error_text"),ok:this.__globalStringManager.get("dialog_get_current_look_error_button")})}})}({Model:l["@Model"],UiCore:l["@UiCore"],DressUpAvatarManager:x}),Tc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h="<div class='cart-details'>\n    <div class='item-count'>\n        ",f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"cart_subtotal",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='&nbsp;(<span class="value"></span>)\n    </div>\n    <div class=\'total-price price-credits\'>\n        <span class="value"></span>\n    </div>\n</div>\n<button class="btn btn-primary full-width loading-placeholder disabled">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Loading",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</button>\n<button class="btn btn-primary full-width checkout disabled">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"CHECKOUT",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</button>"},useData:!0})}({}),Uc=function(g){var b=g.UiCore.UiContext;return g.UiCore.UiContext.extend("CartCheckout",{className:"cart-checkout",uiContextName:"cart_checkout",dependencies:["globalStringManager","loginManager","Promise"],trackedEvents:function(){return[{type:"click",selector:".btn.checkout",name:"checkout",handler:"__checkout"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__myself=this.track(a.loginManager.getCurrentUser());this.__cartModel=this.track(this.__myself.getSingleEdge("cart"));this.addToDOM()},render:function(){this.$el.html(g.template);this.__cartModel.populated().then(function(){this.__cartProducts=this.__cartModel.getEdgeCollection("products",g.Model.CartProductCollection);return this.__cartProducts.enumerated()}.bind(this)).then(function(){this.__updateItems("rendering");this.listenTo(this.__cartProducts,"add remove reset",this.__updateItems.bind(this))}.bind(this)).catch(this.__onCartError.bind(this))},__captureRenderTime:function(){this.__perfCaptureRenderTime&&this.__lastCartProduct&&this.__lastSubProduct&&(this.__perfCaptureRenderTime=!1)},__updateItems:function(a){this.__perfCaptureRenderTime="undefined"!==typeof a&&"rendering"===a;this.__lastSubProduct=this.__lastCartProduct=!1;this.__cartProducts.populated({ignoreBadProducts:!0}).then(function(){var c=0,e=0;this.__cartProducts.each(function(d,h){this.__lastCartProduct=this.__cartProducts.length-1===h;if(d.isPopulated())if(c++,e+=d.node.get(this.__myself.get("is_vip")?"discount_price":"product_price"),d.node.get("is_bundle")){var f=d.node.getEdgeCollection("subproducts",g.Model.ProductEdgeCollection);f.populated().then(function(){_.each(f,function(k,m){"undefined"!==typeof k&&k.node.get("is_owned")&&80!=k.node.get("product_id")&&191!=k.node.get("product_id")&&(e-=k.node.get(this.__myself.get("is_vip")?"discount_price":"product_price"),this.__updatePrice(e));this.__lastSubProduct=f.length-1===m;this.__captureRenderTime()}.bind(this))}.bind(this))}else this.__lastSubProduct=!0,this.__captureRenderTime();else this.__lastSubProduct=!0,this.__captureRenderTime()}.bind(this));this.__updatePrice(e);this.$(".item-count .value").text(this.__globalStringManager.get(1===c?"cart_items_single":"cart_items_plural",{count:c}));this.$(".btn.checkout").toggleClass("disabled",0===c)}.bind(this))},__updatePrice:function(a){this.$(".total-price .value").text(g.FormatNumber.formatCredits(a))},finishedLoading:function(){this.$el.addClass("loaded")},__checkout:function(){this.trigger("checkout")},__onCartError:function(){this.$(".cart-details").hide();this.$(".btn.checkout").addClass("disabled")}})}({Model:l["@Model"],UiCore:l["@UiCore"],FormatNumber:r,template:Tc}),Vc=function(g){var b=g.UiCore.UiContext;return b.extend("Product3dView",{uiContextName:"furniture_preview_3d",className:"furniture-preview-3d",dependencies:"contextMenuManager dressUpAvatarManager featureAccessManager loginManager sceneManager sceneModel screenshotHelper timer window".split(" "),trackedEvents:function(){return[{type:"mousedown",selector:'canvas[id^="northstar-canvas"]',name:"product_canvas_mousedown",handler:"onMouseDown",repeats:1},{type:"mouseup",selector:'canvas[id^="northstar-canvas"]',name:"product_canvas_mouseup",handler:"onMouseUp",repeats:1}]},onMouseDown:function(a){this.mouseDownX=a.screenX;this.mouseDownY=a.screenY},onMouseUp:function(a){var c=Math.abs(a.screenX-this.mouseDownX),e=Math.abs(a.screenY-this.mouseDownY);2==a.button&&10>c&&10>e&&this.__showScreenshotMenu(a)},initialize:function(a){b.prototype.initialize.call(this,a);this.__hideAvatar=!!a.hideAvatar;this.__screenshotHelper=a.screenshotHelper;this.__sceneContext;this.__loginManager.isLoggedIn()?this.__myself=this.__loginManager.getCurrentUser():this.__myself=null;this.__sceneModel=this.track(this.__sceneModel);this.__addRenderGatingPromise(this.__sceneModel.populated());this.__startingFurniture=a.startingFurniture||[];this.addToDOM();this.__sceneReady=this.__createScene();this.__addRenderGatingPromise(this.__sceneReady);this.__waitOnRenderGatingPromises()},delete:function(){this.__scenePresenter&&(this.__scenePresenter.delete(),this.__scenePresenter=null);b.prototype.delete.call(this)},sceneReady:function(){return this.__sceneReady},putFurniture:function(a,c){var e=this;void 0===c&&(c=a.get("default_orientation"),-1===["Floor","Wall","Ceiling"].indexOf(c)&&(c="Floor"));a=this.__scenePresenter.createPropFurniture(a,"furniture."+c+".01");a.then(function(){e.__scenePresenter.focusOnFurniture("1")});return a},toggleRendering:function(a){this.__scenePresenter&&!a?(this.__scenePresenter.delete(),this.__sceneReady=this.__scenePresenter=null):a&&!this.__sceneReady&&(this.__sceneReady=this.__createScene())},playTriggeredAction:function(a){this.__scenePresenter.triggerActionOnPropAvatar(a)},__createScene:function(){return this.__sceneModel.populated().then(function(){this.__sceneContext=this;return this.__sceneManager.initProductPreviewScene({context:this.__sceneContext,$parentElement:this.$el,sceneNode:this.__sceneModel})}.bind(this)).then(function(a){this.__scenePresenter=a;this.__hideAvatar||(this.__scenePresenter.createPropAvatar(this.__dressUpAvatarManager.getLookModel().get("asset_url")),this.listenTo(this.__dressUpAvatarManager.getLookModel(),"change:asset_url",function(c){this.__scenePresenter.createPropAvatar(this.__dressUpAvatarManager.getLookModel().get("asset_url"))}.bind(this)),this.listenTo(this.__scenePresenter,"propAvatarChanged",this.trigger.bind(this,"assetChanged")));return this.__scenePresenter.sceneReady()}.bind(this)).then(function(){this.setFurniture(this.__startingFurniture)}.bind(this))},setFurniture:function(a){this.__scenePresenter&&(this.__scenePresenter.removeAllPropFurniture(),_.each(a,function(c){this.__addRenderGatingPromise(this.putFurniture(c))}.bind(this)))},getSoloSceneId:function(){return this.__scenePresenter.cid},__showScreenshotMenu:function(a){var c=this;this.__featureAccessManager.canSeeQA()&&this.__timer.setTimeout(function(){c.__contextMenuManager.showMenu({clientX:a.clientX,clientY:a.clientY,target:c},g.ContextMenu,{items:[{name:"a",text:"Save image",handler:function(){return c.__takeScreenshot(!0)}},{name:"b",text:"Save image, no background",handler:function(){return c.__takeScreenshot(!1)}}],displayOptions:{above:!0,right:!1},mouseMargin:0,showCaret:!1,closeOnScroll:!1})},100)},__takeScreenshot:function(a){this.__screenshotHelper.saveScreenshot({session:this.__scenePresenter.getSession3DAggregate(),canvas:this.el.querySelector("canvas"),showBackground:a})}})}({UiCore:l["@UiCore"],ContextMenu:t}),ya=function(g){var b=IMVU.BaseClass;return b.extend("ProductView",{dependencies:["Promise","webGL"],initialize:function(a){var c=this;b.prototype.initialize.call(this,a);this.__Promise&&(this.__hasRenderedPromise=new this.__Promise(function(e){this.__hasRenderedResolver=e}.bind(this)));this.__serviceProvider=a.serviceProvider;this.__webGL=a.serviceProvider.get("webGL");this.__webGL.use3d()?this.__impl=this.__serviceProvider.create(g.Product3dView,a):this.__impl=this.__serviceProvider.create(g.Product2dView,a);_.each(["toggleRendering","playTriggeredAction","on","off"],function(e){this[e]=this.__impl[e].bind(this.__impl)}.bind(this));this.__impl.getHasRenderedPromise().then(function(){c.__hasRenderedResolver&&c.__hasRenderedResolver.resolve()})},getHasRenderedPromise:function(){return this.__hasRenderedPromise},delete:function(){this.__impl.isDeleted()||this.__impl.delete()},getSoloSceneId:function(){return this.__impl.getSoloSceneId()}})}({Product2dView:function(g){var b=g.UiCore.UiContext;return b.extend("Product2dView",{uiContextName:"furniture_preview_2d",className:"furniture-preview-2d",dependencies:["dressUpAvatarManager","imageManager","loginManager","Promise","sceneModel"],initialize:function(a){b.prototype.initialize.call(this,a);this.__previewModel=this.track(a.startingFurniture&&a.startingFurniture[0]?a.startingFurniture[0]:a.sceneModel);this.addToDOM()},render:function(){this.$el.html("");this.$el.addClass("loading");this.__previewModel&&(this.__addRenderGatingPromise(this.__previewModel.populated()),this.__previewModel.populated().then(function(){var a=this.__imageManager.loadAsBackgroundImage(this.$el,this.__previewModel.get("preview_image")+"?"+$.param({width:800,height:800}));this.__addRenderGatingPromise(a);return a}.bind(this),function(){return this.__Promise.reject()}.bind(this)).then(function(){this.$el.removeClass("loading");this.__waitOnRenderGatingPromises()}.bind(this),function(){return this.__Promise.reject()}.bind(this)))},toggleRendering:function(a){this.$el.toggle(a)},playTriggeredAction:function(){}})}({UiCore:l["@UiCore"]}),Product3dView:Vc}),Wc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<span class="become">Become<br/>a VIP Member</span><br/>\n<span class="free">Get Free Credits<br/>&amp; Discounts</span>\n'},useData:!0})}({}),Xc=function(g){var b=g.UiCore.UiContext;return b.extend("VIPUpsellReveal",{className:"VIP-Upsell-Reveal",uiContextName:"vip_upsell_reveal",dependencies:[],trackedEvents:function(){},initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){this.$el.html(g.template({}))}})}({UiCore:l["@UiCore"],template:Wc}),Yc=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h="<div class='undo'>",f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-undo",{name:"icon",hash:{},data:e}));if(f||0===f)h+=f;h+="</div>\r\n<div class='redo'>";if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-redo",{name:"icon",hash:{},data:e})))||0===f)h+=f;return h+"</div>"},useData:!0})}({}),Zc=function(g){var b=g.UiCore.UiContext;return g.UiCore.UiContext.extend("UndoWidget",{className:"undo-widget",uiContextName:"undo_widget",trackedEvents:function(){return[{type:"click",selector:".undo",name:"undo",handler:"__undo"},{type:"click",selector:".redo",name:"redo",handler:"__redo"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__dressUpAvatarManager=IMVU.requireProperty(a,"dressUpAvatarManager");this.__selectedFurnitureModel=IMVU.optionalProperty(a,"selectedFurnitureModel");this.__undoRedo=IMVU.requireProperty(a,"undoRedo");a.vertical&&this.$el.addClass("vertical");this.addToDOM()},render:function(){this.$el.html(g.template);this.__refreshButtons();this.listenTo(this.__undoRedo,"all",this.__refreshButtons)},__makeHistoryState:function(){var a={look:this.__dressUpAvatarManager.getLookModel().get("look_url")};this.__selectedFurnitureModel&&(a.furniture=this.__selectedFurnitureModel.get("product"));return a},__undo:function(){var a=this.__undoRedo.undo(this.__makeHistoryState());this.__dressUpAvatarManager.forceChangeToLookUrl(a.look,!0);this.__selectedFurnitureModel&&this.__selectedFurnitureModel.set("product",a.furniture)},__redo:function(){var a=this.__undoRedo.redo(this.__makeHistoryState());this.__dressUpAvatarManager.forceChangeToLookUrl(a.look,!0);this.__selectedFurnitureModel&&this.__selectedFurnitureModel.set("product",a.furniture)},__refreshButtons:function(){this.$(".undo").toggleClass("disabled",!this.__undoRedo.get("canUndo"));this.$(".redo").toggleClass("disabled",!this.__undoRedo.get("canRedo"))}})}({UiCore:l["@UiCore"],template:Yc}),$c=function(g){var b=IMVU.NamedModel;return b.extend("UndoRedoModel",{initialize:function(){b.prototype.initialize.apply(this,arguments);this.clearHistory()},add:function(a){0!==this.undoArr.length&&_.isEqual(this.undoArr[this.undoArr.length-1],a)||(this.undoArr.push(a),this.redoArr=[],this.trigger("add",a),this.__updateComputedAttributes())},undo:function(a){this.redoArr.push(a);a=this.undoArr.pop();this.trigger("undo",a);this.__updateComputedAttributes();return a},redo:function(a){this.undoArr.push(a);a=this.redoArr.pop();this.trigger("redo",a);this.__updateComputedAttributes();return a},clearHistory:function(){this.undoArr=[];this.redoArr=[];this.processBool=!0;this.__updateComputedAttributes()},historyFind:function(a){return _.find(this.undoArr,a)||_.find(this.redoArr,a)},isInHistory:function(a){var c=a.get("product_id").toString();a=function(e){e=_.last(e.split("/")).split(",");return _.contains(e,c)};return _.find(this.undoArr,a)||_.find(this.redoArr,a)},__updateComputedAttributes:function(){this.set({canUndo:!!this.undoArr.length,canRedo:!!this.redoArr.length,canProcess:this.processBool})},get:function(a){switch(a){case"lastUndo":return _.last(this.undoArr);default:return b.prototype.get.apply(this,arguments)}}})}({UiCore:l["@UiCore"]}),ad=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h="<div class='cart-notification'>\r\n    ",f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-cart_error",{name:"icon",hash:{},data:e}));if(f||0===f)h+=f;h+='\r\n    <span class="description">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"shopping_cart_error",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</span>\r\n</div>\r\n"},useData:!0})}({}),bd=function(g){var b=g.UiCore.UiContext;return g.UiCore.UiContext.extend("CartError",{className:"cart-error",uiContextName:"cart_error",initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){this.$el.html(g.template)}})}({UiCore:l["@UiCore"],template:ad}),cd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h="<div class='credits-widget-container'>\n    <div class='details'>\n        <div>",f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Available Credits",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+="</div>\n        <div class='font-medium text-12 flex items-center text-gold'>\n            <div class=\"wh-15 mr-5\">";if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-credits",{name:"icon",hash:{class:"wh-full"},data:e})))||0===f)h+=f;h+="</div>\n            <div class=\"available-credits\"></div>\n        </div>\n        <div class='credits-breakdown'><span class='credit-value'></span> ";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Credits",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+=" ‚Ä¢ <span class='promo-credit-value'></span> ";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Promo",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</div>\n    </div>\n</div>"},useData:!0})}({}),dd=function(g){var b=g.UiCore.UiContext;return b.extend("CreditsWidget",{uiContextName:"credits_widget",className:"credits-widget",dependencies:["dialogManager","featureAccessManager","leanplum","loginManager"],trackedEvents:function(){return[{type:"click",selector:".credits-widget-container",name:"credits_widget_click",handler:"__onClick"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM();this.__myself=this.track(a.loginManager.getCurrentUser());this.__formatNumber=g.FormatNumber;this.__wallet=this.track(this.__myself.getSingleEdge("wallet"));this.__wallet.populated().then(function(){this.$(".details").show();this.__updateWealth();this.__wallet.on("change",this.__updateWealth,this)}.bind(this))},__updateWealth:function(){this.$(".available-credits").text(this.__formatNumber.formatCredits(this.__wallet.get("credits")+this.__wallet.get("promo_credits")));this.$(".credit-value").text(this.__formatNumber.formatCredits(Number(this.__wallet.get("credits"))));this.$(".promo-credit-value").text(this.__formatNumber.formatCredits(Number(this.__wallet.get("promo_credits"))))},render:function(){this.$el.html(g.template())},delete:function(){this.__wallet.off(null,null,this);b.prototype.delete.call(this)},__onClick:function(a){this.__leanplum.recordEvent("credit_widget_click");this.__dialogManager.showDollarStoreDialog({totalAmount:0})}})}({UiCore:l["@UiCore"],FormatNumber:r,template:cd}),ed=function(g){var b=g.UiCore.ListPresenter;return b.extend("InventoryProductList",{uiContextName:"inventory_product_list",className:"inventory-product-list",dependencies:[],initialize:function(a){this.itemFactory=g.ProductRow;b.prototype.initialize.call(this,a)},render:function(){b.prototype.render.call(this)}})}({UiCore:l["@UiCore"],ProductRow:ja}),fd=function(g){var b=g.LightboxDialog;return b.extend("ShoppingCartLightbox",{uiContextName:"shopping_cart_lightbox",className:"shopping-cart-lightbox lightbox-dialog",dependencies:"dialogManager featureAccessManager globalStartupModel globalStringManager loginManager multiGetManager platform restModelFactory sceneManager".split(" "),initialize:function(a){this.title=a.globalStringManager.get("Shopping Cart");b.prototype.initialize.call(this,a);this.__dressUpAvatarManagerFactory=a.dressUpAvatarManagerFactory||g.DressUpAvatarManager;this.__triggerListFactory=a.triggerListFactory;this.__imageFactory=a.imageFactory;this.__productsToAdd=a.productsToAdd||[];this.__myself=this.track(a.loginManager.getCurrentUser());this.__restModelFactory=a.restModelFactory;this.__sceneManager=a.sceneManager;this.__undoRedo=a.serviceProvider.create(g.UndoRedo,{});this.__dressUpAvatarManager=this.__serviceProvider.create(this.__dressUpAvatarManagerFactory,{persistLooks:!1,confirmGenderChange:!1});this.__myself.get("is_vip")?this.addWidgetToSidebarPanel(g.CreditsWidget,{},"cart"):this.addWidgetToSidebarPanel(g.WipeReveal,{aboveWidget:g.CreditsWidget,belowWidget:g.VIPUpsellReveal},"cart");this.__loadingPlaceholder=this.addWidgetToSidebarPanel(g.WithmeWidgets.LoadingPlaceholderList,{useSquareThumbnail:!0},"cart");this.__cartCheckout=this.addFooterToSidebarPanel(g.CartCheckout,{},"cart");this.listenTo(this.__cartCheckout,"checkout",this.__checkout.bind(this));this.__cartModel=this.track(this.__myself.getSingleEdge("cart"));this.__avatarNode=this.__myself.getSingleEdge("avatar");this.__selectedFurnitureModel=a.selectedFurnitureModel?a.selectedFurnitureModel:this.__serviceProvider.create(g.UiCore.NodeModel,{},{product:null});this.__perfShowCollection=[];this.__perfCartProductsCollectionResolver=null;this.__perfCartProductsCollectionPromise=new this.__Promise(function(c){this.__perfCartProductsCollectionResolver=c}.bind(this));this.__perfShowCollection.push(this.__perfCartProductsCollectionPromise);this.__perfDisplayProductsResolver=null;this.__perfDisplayProductsPromise=new this.__Promise(function(c){this.__perfDisplayProductsResolver=c}.bind(this));this.__perfShowCollection.push(this.__perfDisplayProductsPromise);this.__perfWidgetsCompleteResolver=null;this.__perfWidgetsCompletePromise=new this.__Promise(function(c){this.__perfWidgetsCompleteResolver=c}.bind(this));this.__perfShowCollection.push(this.__perfWidgetsCompletePromise);this.__cartModelPromise=this.__Promise.every([this.__cartModel.populated(),this.__avatarNode.populated()]);this.__perfShowCollection.push(this.__cartModelPromise);this.__cartModelPromise.then(function(){this.__cartProducts=this.__cartModel.getEdgeCollection("products",g.Model.CartProductCollection);return this.__cartProducts.enumerated()}.bind(this)).then(this.__addProductsToCart.bind(this)).then(function(){return this.__cartProducts.populated({ignoreBadProducts:!0})}.bind(this)).then(function(){this.__multiGetManager.queue(this.__cartProducts);this.__multiGetManager.requestReact(this.__multiGetManager.PRODUCT_END_POINT);this.__multiGetManager.request();this.__loadingPlaceholder.delete();this.__cartCheckout.finishedLoading();this.__cartProductList=this.addWidgetToSidebarPanel(g.CartProductList,{dressUpAvatarManager:this.__dressUpAvatarManager,selectedFurnitureModel:this.__selectedFurnitureModel,undoRedo:this.__undoRedo,collection:this.__cartProducts,showExpandingSections:!0,avatarNode:this.__avatarNode,triggerListFactory:this.__triggerListFactory},"cart");this.listenTo(this.__cartProductList,"checkout",this.__checkout.bind(this));this.listenTo(this.__cartProductList,"takeOff",this.__onCartProductRemove.bind(this));this.listenTo(this.__cartProductList,"playAction",this.__playAction.bind(this));this.listenTo(this.__cartProductList,"dismiss",this.delete.bind(this));this.listenTo(this.__selectedFurnitureModel,"change",this.__updateScene.bind(this));"mobile"!==this.__platform&&this.__perfShowCollection.push(this.__addAvatar());this.__perfCartProductsCollectionResolver.resolve()}.bind(this)).catch(function(){this.__loadingPlaceholder.delete();this.__cartCheckout.finishedLoading();this.addWidgetToSidebarPanel(g.CartError,{},"cart")}.bind(this));"desktop"===this.__platform||this.__featureAccessManager.isElectronClient()?this.__avatarNode.populated().then(function(){this.__multiGetManager.queue(this.__avatarNode,this.__multiGetManager.autoRequestPlease);var c=_.map(this.__avatarNode.get("products"),function(e){return e.id});this.products=new IMVU.NamedCollection;this.__productSize=c.length;_.each(c,function(e,d){e=this.__restModelFactory.readModel(e,g.Model.ProductNode).populated();this.__productIndex=d;this.__perfShowCollection.push(e);e.then(function(h){this.products.add(h);this.__productSize-1===this.__productIndex&&this.__perfDisplayProductsResolver.resolve()}.bind(this)).catch(function(){return this.__Promise.accept()}.bind(this))}.bind(this));0===this.__productSize&&this.__perfDisplayProductsResolver.resolve();this.addWidgetToSidebarPanel(g.Inventory,{collection:this.products,dressUpAvatarManager:this.__dressUpAvatarManager,undoRedo:this.__undoRedo},"inventory");this.__perfWidgetsCompleteResolver.resolve()}.bind(this)):(this.__perfDisplayProductsResolver.resolve(),this.__perfWidgetsCompleteResolver.resolve());"mobile"===this.__platform&&(this.__toasterWidget=this.__serviceProvider.get("toasterWidget"));this.__perfDisplayProductsPromise.then(function(){this.__Promise.every(this.__perfShowCollection).then(function(){}.bind(this))}.bind(this))},__playAction:function(a,c){if(this.__previewWidget)if(this.__dressUpAvatarManager.isWearing(c.id))this.__previewWidget.playTriggeredAction(a,this.__sceneArgs,this.__sceneArgs);else{var e=function(){this.__previewWidget.playTriggeredAction(a,this.__sceneArgs);this.__previewWidget.off("assetChanged",e)}.bind(this);this.__previewWidget.on("assetChanged",e);this.__dressUpAvatarManager.add(c.id)}},__addProductsToCart:function(){return this.__Promise.every(_.map(this.__productsToAdd,function(a){return this.__cartProducts.create({id:a.id})}.bind(this))).catch(this.__onCartAddFailure.bind(this))},__onCartAddFailure:function(a){"CART_PRODUCT-005"===a.error.error?this.__dialogManager.showDialog(g.CartFullErrorDialog,{ctaText:this.__globalStringManager.get("OK")}):this.__dialogManager.standardAlert(a.error.error)},__addAvatar:function(){this.__filterModel=this.__serviceProvider.create(g.Model.FilterModel,[],{});this.__filterModel.set("category","all");this.__addAvatarResolver=null;this.__addAvatarPromise=new this.__Promise(function(a){this.__addAvatarResolver=a}.bind(this));this.__dressUpAvatarManager.populated().then(function(){return this.__dressUpAvatarManager.setCartProducts(this.__cartProducts)}.bind(this)).then(function(){this.__sceneArgs={model:this.__dressUpAvatarManager.getLookModel(),filterModel:this.__filterModel,imageFactory:this.__imageFactory,sceneContext:"shop_clothing",context:this,$parentElement:this.$(".main-container")};this.__previewWidget=this.__sceneManager.initProfileScene(this.__sceneArgs);this.__undoWidget=this.addWidgetToMainContainer(g.UndoWidget,{dressUpAvatarManager:this.__dressUpAvatarManager,selectedFurnitureModel:this.__selectedFurnitureModel,undoRedo:this.__undoRedo,vertical:!0});this.__previewWidget.getSceneLoadedPromise().then(function(){this.__addAvatarResolver.resolve()}.bind(this))}.bind(this));return this.__addAvatarPromise},__updateScene:function(a){a=a.get("product");this.__previewWidget&&(this.__previewWidget.toggleRendering(!1,this.__sceneArgs),this.__previewWidget.delete());if(a){var c={sceneModel:_.contains(a.get("is"),"locked_room")||_.contains(a.get("is"),"furniture_room")||_.contains(a.get("categories"),"Decorated Rooms")?this.__serviceProvider.get("restModelFactory").readModel(a.get("scene_url"),g.UiCore.NodeModel):this.__serviceProvider.get("restModelFactory").readModel(this.__globalStartupModel.get("furniturePreviewScene"),g.UiCore.NodeModel),dressUpAvatarManager:this.__dressUpAvatarManager};_.contains(a.get("is"),"furniture")&&(c.startingFurniture=[this.__selectedFurnitureModel.get("product")]);this.__previewWidget=this.addWidgetToMainContainer(g.ProductView,c,!0)}else this.__sceneArgs.model=this.__dressUpAvatarManager.getLookModel(),this.__sceneArgs.filterModel=this.__filterModel,this.__sceneArgs.imageFactory=this.__imageFactory,this.__previewWidget=this.__sceneManager.initProfileScene(this.__sceneArgs);this.__undoWidget&&this.$(".main-container").append(this.__undoWidget.$el)},__onCartProductRemove:function(a){_.contains(a.get("is"),"furniture")||_.contains(a.get("is"),"locked_room")||_.contains(a.get("is"),"furniture_room")?this.__selectedFurnitureModel.get("product")===a&&this.__selectedFurnitureModel.set("product",null):a.get("is_bundle")?this.__dressUpAvatarManager.removeAllSubproducts(a):this.__dressUpAvatarManager.remove(a.id)},hide:function(){this.__previewWidget&&this.__previewWidget.toggleRendering(!1,this.__sceneArgs);b.prototype.hide.call(this)},show:function(){this.__previewWidget&&this.__previewWidget.toggleRendering(!0,this.__sceneArgs);b.prototype.show.call(this)},__checkout:function(a){a=new g.Checkout.CartCollection(a||_.pluck(this.__cartProducts.filter(function(c){return c.isPopulated()}),"node"));this.__markSelectedProducts(a);this.__dialogManager.showDialog(g.Checkout.CheckoutDialog,{cart:a,successOk:this.__globalStringManager.get("OK"),dressUpAvatarManager:this.__dressUpAvatarManager,productTaxonomyOrigin:"global_cart"}).finished.then(function(){this.delete()}.bind(this))},__markSelectedProducts:function(a){_.each(a.models,function(c){this.__dressUpAvatarManager.isWearing(c.id)?c.set("is_worn_in_shop",!0):c.set("is_worn_in_shop",!1)}.bind(this))},delete:function(){this.__dressUpAvatarManager.delete();this.__previewWidget&&this.__previewWidget.delete();b.prototype.delete.call(this)},_test_getCartProductList:function(){return this.__cartProductList}})}({Checkout:l["@Checkout"],Model:l["@Model"],UiCore:l["@UiCore"],WithmeWidgets:l["@WithmeWidgets"],CartCheckout:Uc,CartError:bd,CartFullErrorDialog:Rc,CartProductList:Fb,CreditsWidget:dd,DressUpAvatarManager:Sc,Inventory:ed,LightboxDialog:v,ProductView:ya,UndoRedo:$c,UndoWidget:Zc,VIPUpsellReveal:Xc,WipeReveal:Pc}),gd=function(g){var b=g.DressUpAvatarManager;return b.extend("CartDressUpAvatarManager",{dependencies:["photoDetails","photoUser","Promise","restModelFactory"],initialize:function(a){a.persistLooks=!1;this.__photoDetails=a.photoDetails;this.__photoUser=a.photoUser;b.prototype.initialize.call(this,a)},__initializeLookModel:function(){var a=this.__photoDetails.id.split("/").pop(),c=this.__photoUser.id.split("/").pop();this.__createLookModel(a+":users:"+c);return this.__lookModel.populated()},forceChangeToLookUrl:function(a,c){return this.__Promise.accept()},__getCurrentLookAlert:function(){this.dialogManager.alert({title:this.__globalStringManager.get("dialog_get_tag_look_error_title"),text:this.__globalStringManager.get("dialog_get_tag_look_error_text"),ok:this.__globalStringManager.get("dialog_get_tag_look_error_button")})}})}({Model:l["@Model"],UiCore:l["@UiCore"],DressUpAvatarManager:x}),hd=function(g){var b=g.StandardHeadpiece;return b.extend("FeedTagHeadpiece",{className:"feed-tag-headpiece standard-headpiece",uiContextName:"feed_tag_headpiece",dependencies:["globalStringManager"],initialize:function(a){this.__imageUrl=a.imageUrl;this.__isAp=a.isAp;this.__pidListArr=a.pidListArr;this.__user=a.user;a.info={imageUrl:this.__imageUrl,headerText:"Outfit",isAP:this.__isAp};b.prototype.initialize.call(this,a);this.createChildContext(g.BundleCount,{model:null,forceCount:this.__pidListArr.length,$parentElement:this.$(".tile-body")});this.createChildContext(g.WAFWidgets.DisplayName,{$replaceElement:this.$(".secondary-text"),user:this.__user,showVipBadge:!1,size:"small",color:"medium",prefix:this.__globalStringManager.get("by")})}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],BundleCount:A,StandardHeadpiece:z}),id=function(g){var b=g.LightboxDialog;return b.extend("FeedTagLightbox",{uiContextName:"feed_tag_lightbox",className:"feed-tag-lightbox lightbox-dialog",dependencies:["globalStringManager","loginManager","photoDetails","Promise","sceneManager"],initialize:function(a){b.prototype.initialize.call(this,a);this.__dressUpAvatarManagerFactory=a.dressUpAvatarManagerFactory||g.PhotoDressUpAvatarManager;this.__myself=this.track(a.loginManager.getCurrentUser());this.__imageFactory=a.imageFactory;this.__triggerList=this.__serviceProvider.create(a.triggerListFactory||g.TriggerList);this.__user=a.user;this.__sceneManager=a.sceneManager;this.__productCollection=a.productCollection;this.__pidListArr=a.pidListArr;this.__isAp=a.isAp;this.__dressUpAvatarManager=this.__serviceProvider.create(this.__dressUpAvatarManagerFactory,{photoDetails:this.__photoDetails,photoUser:this.__user,persistLooks:!1,confirmGenderChange:!1,deleteOnError:this});this.__Promise.every(this.__productCollection.map(function(c){return c.populated().catch(function(){})}.bind(this))).then(function(){this.__showAvatar()}.bind(this))},__setupHeadpiece:function(){this.addWidgetToHeadpiece(g.FeedTagHeadpiece,{imageUrl:this.__serviceProvider.get("root")+"/image_dressup/"+this.__pidListArr.join(","),isAp:this.__isAp,pidListArr:this.__pidListArr,user:this.__user})},__setupSidebar:function(){this.setSidebarPanelLoading(!0);this.__dressUpAvatarManager.populated().then(function(){return this.__Promise.every([this.__triggerList.loadTriggers(this.__dressUpAvatarManager.getLookModel().get("asset_url"))])}.bind(this)).then(function(){var a=this.__productCollection.map(function(d){return this.__triggerList.triggersForProduct(d)}.bind(this));this.__addAccordionSection(this.__globalStringManager.get("items_in_look",{count:this.__productCollection.length}),g.SubproductList,{collection:this.__productCollection},!0);var c=_.reduce(a,function(d,h){return d+h.length},0);if(0<c){var e="desktop"===this.__platform;a=this.__addAccordionSection(this.__globalStringManager.get("actions_with_count",{count:c}),g.ActionList,{productTriggers:a},e);this.listenTo(a,"playAction",this.__playAction.bind(this))}this.setSidebarPanelLoading(!1)}.bind(this))},__addAccordionSection:function(a,c,e,d){return this.addWidgetToSidebarPanel(g.AccordionSection,{title:a,startOpen:!!d}).addWidget(c,e)},__showAvatar:function(){this.__dressUpAvatarManager.populated().then(function(){return this.__dressUpAvatarManager.forceChangeToLookUrl(this.__serviceProvider.get("root")+"/look/"+this.__pidListArr.join(","))}.bind(this)).then(function(){this.__sceneArgs={model:this.__dressUpAvatarManager.getLookModel(),imageFactory:this.__imageFactory,sceneContext:"shop_clothing",sceneType:"profile_scene",$parentElement:this.$(".main-container"),context:this};this.__avatarWidget=this.__sceneManager.initProfileScene(this.__sceneArgs);this.__setupHeadpiece();this.__setupSidebar()}.bind(this))},setSidebarPanelLoading:function(a,c){c=this.__getPanel(c);c.$widgets.toggleClass("loading",a);c.$footers.toggleClass("loading",a)},hide:function(){this.__avatarWidget&&this.__avatarWidget.toggleRendering(!1,this.__sceneArgs);b.prototype.hide.call(this)},show:function(){this.__avatarWidget&&this.__avatarWidget.toggleRendering(!0,this.__sceneArgs);b.prototype.show.call(this)},delete:function(){this.__dressUpAvatarManager.delete();b.prototype.delete.call(this)},__playAction:function(a){this.__avatarWidget&&this.__avatarWidget.playTriggeredAction(a,this.__sceneArgs)}})}({Model:l["@Model"],AccordionSection:B,ActionList:D,FeedTagHeadpiece:hd,LightboxDialog:v,PhotoDressUpAvatarManager:gd,SubproductList:R,TriggerList:C}),za={lightboxMinImageSizeDesktop:555},jd=function(g){var b=g.StandardHeadpiece;return b.extend("ProductHeadpiece",{className:"product-headpiece standard-headpiece",uiContextName:"product_headpiece",dependencies:["globalStringManager","model"],initialize:function(a){var c=this;this.model=a.model;this.doWork([function(){return c.model.populated()},function(){a.info={imageUrl:IMVU.URI.build(c.model.get("preview_image"),{width:150,height:150}),headerText:c.model.get("product_name"),isAP:"AP"===c.model.get("rating")};a.info.imageUrl=a.info.imageUrl.replace(/\.localhost/,"");b.prototype.initialize.call(c,a);if(c.model.get("is_bundle")){var e=c.createChildContext(g.BundleCount,{model:c.model,$parentElement:c.$(".tile-body")});c.__addRenderGatingPromise(e.getHasRenderedPromise())}e=c.model.getSingleEdge("creator").populated();c.__addRenderGatingPromise(e);return e},function(e){e=c.createChildContext(g.WAFWidgets.DisplayName,{$replaceElement:c.$(".secondary-text"),user:e,showVipBadge:!1,size:"small",color:"medium",prefix:c.__globalStringManager.get("by")});c.__addRenderGatingPromise(e.getHasRenderedPromise());c.__waitOnRenderGatingPromises()}])}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],BundleCount:A,StandardHeadpiece:z}),kd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="panels">\n    <div class="product-detail-left-panel">\n        <div class="avatar"></div>\n    </div>\n    <div class="product-detail-right-panel">\n        <div class="headpiece">\n            <div class="widgets"></div>\n            <div class="bridge-action-buttons">\n                <button class="hidden decorate btn-ghost btn-dark full-width">',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Decorate",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='</button>\n                <button class="hidden join btn-dark full-width"> ';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"join_room",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+=' </button>\n                <button class="hidden add-to-room btn-ghost btn-dark full-width"> ';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"add_to_your_room",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+' </button>\n            </div>\n            <div class="sticky-container"></div>\n        </div>\n        <div class="sidebar">\n            <div class="overlay hidden"></div>\n            <div class="panel-container selected">\n                <div class="scroller"></div>\n            </div>\n        </div>\n        <div class="mobile-chat-bar"></div>\n    </div>\n</div>\n'},useData:!0})}({}),ld=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="progress">\n    <div class="bar">\n        <div class="value"></div>\n        <div class="percentage"></div>\n    </div>\n    <div class="border"></div>\n</div>\n'},useData:!0})}({}),md=function(g){var b=g.UiCore.UiContext;return b.extend("LoadingProgress",{uiContextName:"loading_progress",className:"loading-progress",dependencies:"dialogManager globalStringManager progressPromises Promise timer window".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__timer=a.timer;this.__lingerTime=a.lingerTime||500;this.finished=new a.Promise(function(e){this.__finishedResolver=e}.bind(this));var c=a.weighting||_.map(_.range(this.__progressPromises.length),function(){return 1}.bind(this));this.__initTime=+new Date;this.__progressControls=_.map(this.__progressPromises,function(e,d){return{promise:e,weight:c[d],progress:0}}.bind(this));this.__progressTotal=_.reduce(this.__progressControls,function(e,d){return e+d.weight}.bind(this),0);this.addToDOM();this.__updateBar=this.__createUpdateBarFunction();_.each(this.__progressControls,function(e){e.promise.then(this.__onProgress.bind(this),this.__onProgress.bind(this))}.bind(this));this.__onProgress()},delete:function(){this.__timer.clearTimeout(this.__timeoutFade);this.__timer.clearTimeout(this.__timeoutDelete);b.prototype.delete.call(this)},render:function(){this.$el.html(g.template).addClass("animated");this.$(".percentage").show()},partialProgress:function(a,c){"pending"===this.__progressControls[a].promise.state&&(this.__progressControls[a].progress=c,this.__onProgress())},passive:function(){this.$el.addClass("passive")},__onProgress:function(){var a=_.reduce(this.__progressControls,function(c,e){"pending"!==e.promise.state&&(e.progress=1);return c+e.progress*e.weight},0);this.__updateBar(a/this.__progressTotal);a===this.__progressTotal&&this.__finish()},__finish:function(){this.__finishedResolver.accept();this.__timer.clearTimeout(this.__timeout);this.__timeoutFade=this.__timer.setTimeout(function(){this.$el.fadeOut(.25*this.__lingerTime)}.bind(this),.75*this.__lingerTime);this.__timeoutDelete=this.__timer.setTimeout(this.delete.bind(this),this.__lingerTime);this.trigger("timeCompleted",+new Date-this.__initTime)},__createUpdateBarFunction:function(){this.$(".percentage").show();return function(a){var c=this;this.__window.requestAnimationFrame(function(){c.$(".value").css("width",100*a+"%");c.$(".percentage").text(c.__globalStringManager.get("loading_bar_text",{percentage:Math.floor(100*a)}))})}.bind(this)}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:ld}),nd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return""},useData:!0})}({}),od=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'\n<div class="title">Admin Tools</div>\n<div class="select-option select-totals">\n\t<span class="select-amount">0</span> of\n\t(<span class="select-total">0</span>) Selected\n</div>\n<div class="select-option select-all">Select All</div>\n<div class="select-option select-next">Select Next (12) Products</div>\n<div class="select-option unselect-all disabled">Deselect All</div>\n'},3:function(b,a,c,e){return"disabled"},5:function(b,a,c,e){return'\n<div class="show-greylisted-first">\n<input id="showGreylisted" class="toggle-switch" type="checkbox">\n<label for="showGreylisted">Show Greylisted First</label>\n</div>\n'},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c="";var d=a["if"].call(b,b&&b.showSelectOptions,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(d||0===d)c+=d;c+='\n\n<button class="btn full-width btn-ghost btn-dark btn-greylist ';if((d=a["if"].call(b,b&&b.showSelectOptions,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===d)c+=d;c+='">Greylist</button>\n<button class="btn full-width btn-ghost btn-dark btn-ungreylist ';if((d=a["if"].call(b,b&&b.showSelectOptions,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===d)c+=d;c+='">Ungreylist</button>\n\n';if((d=a["if"].call(b,b&&b.showSelectOptions,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===d)c+=d;return c+"\n"},useData:!0})}({}),pd=l["@Dialogs"].AlloyConfirmDialog.extend("SelectAllWarningDialog",{uiContextName:"select_all_warning_dialog",className:"select-all-warning-dialog"}),qd=function(g){var b=g.UiCore.UiContext;return b.extend("ProductAdminTools",{className:"product-admin-tools",uiContextName:"product_admin_tools",dependencies:["dialogManager","Promise","rest","restModelFactory","window"],trackedEvents:function(){return[{type:"click",selector:".unselect-all",name:"unselect_all",handler:this.__clickUnselectAll},{type:"click",selector:".btn-greylist",name:"greylist",handler:this.__clickGreylist},{type:"click",selector:".btn-ungreylist",name:"ungreylist",handler:this.__clickUngreylist},{type:"change",selector:".toggle-switch#showGreylisted",name:"show_greylisted",handler:this.__triggerProductStatusChange},{type:"click",selector:".select-all",name:"select_all",handler:this.__clickSelectAll},{type:"click",selector:".select-next",name:"select_next",handler:this.__clickSelectNext}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__showSelectOptions=IMVU.optionalProperty(a,"showSelectOptions",!1);this.__product=IMVU.optionalProperty(a,"product",null);this.__Promise=a.Promise;this.__rest=a.rest;this.__restModelFactory=a.restModelFactory;this.__window=a.window;this.addToDOM()},render:function(){this.$el.html(g.template({showSelectOptions:this.__showSelectOptions}));this.__refreshSingleProductButtons()},__refreshSingleProductButtons:function(){var a=this;this.__product&&(this.__addModerationRelation(),this.__product.populated().then(function(){var c=a.__product.getSingleEdge("moderation_history");c.invalidate();c.populated().then(function(){a.__isGreylisted=c.get("is_greylisted");a.setGreylistButton(a.__isGreylisted);a.setUngreylistButton(!a.__isGreylisted)})}))},__clickUnselectAll:function(){this.trigger("unselectAll")},__triggerProductStatusChange:function(){this.trigger("productStatusChange")},__clickGreylist:function(){this.__product?this.greylist([this.__product]):this.trigger("clickGreylist")},__clickUngreylist:function(){this.__product?this.ungreylist([this.__product]):this.trigger("clickUngreylist")},__addModerationRelation:function(){this.__product.relations.moderation_history||(this.__product=this.__restModelFactory.readModel(this.__product.id+"?show_moderation=true",g.Model.ProductNode))},__updateProducts:function(a,c,e){var d=c.length;this.__dialogManager.showDialog(g.Dialogs.AlloyConfirmDialog,{title:"Are you sure?",text:"You are "+a+"ing ("+d+") item"+(1===d?".":"s."),yes:a,no:"Cancel"}).finished.then(function(){return this.__Promise.every(_.map(c,function(h){h.relations.moderation_history||(h=this.__restModelFactory.readModel(h.id+"?show_moderation=true",g.Model.ProductNode));h.populated().then(function(){this.__rest.post(h.relations.moderation_history,e)}.bind(this))}.bind(this))).catch(function(h){this.__window.console.log(h)}.bind(this))}.bind(this)).then(function(){this.__triggerProductStatusChange();this.__refreshSingleProductButtons()}.bind(this)).catch(function(){}.bind(this))},greylist:function(a){this.__updateProducts("Greylist",a,{greylist:!0})},ungreylist:function(a){this.__updateProducts("Ungreylist",a,{greylist:!1})},__clickSelectAll:function(){var a=this;this.__selectAllWarningDialog=this.__dialogManager.showDialog(g.SelectAllWarningDialog,{title:"Are you sure?",html:"This will select EVERY product on this page.<br> This might take a really long time!",yes:"Select All",no:"Cancel"}).finished.then(function(){a.trigger("selectAll")})},__clickSelectNext:function(){this.trigger("selectNext")},hasSelection:function(a){this.$(".unselect-all").toggleClass("disabled",!a);this.setGreylistButton(!a);this.setUngreylistButton(!a)},allowSelectAll:function(a){this.$(".select-all").toggleClass("disabled",a)},setSelectAmount:function(a){this.$(".select-amount").html(g.FormatNumber.addComma(a))},setSelectTotal:function(a){this.$(".select-total").html(g.FormatNumber.addComma(a))},setGreylistButton:function(a){this.$(".btn-greylist").toggleClass("disabled",a)},setUngreylistButton:function(a){this.$(".btn-ungreylist").toggleClass("disabled",a)}})}({Dialogs:l["@Dialogs"],Model:l["@Model"],UiCore:l["@UiCore"],FormatNumber:r,SelectAllWarningDialog:pd,template:od}),rd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression;return"<li class='gender'>"+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"product_gender",{name:"i18n-g",hash:{},data:e})))+": "+h((d=a["i18n-gwd"]||b&&b["i18n-gwd"]||c,d.call(b,b&&b.gender,b&&b.gender,{name:"i18n-gwd",hash:{},data:e})))+"</li>"},3:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression;return"<li class='category'>"+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"product_category",{name:"i18n-g",hash:{},data:e})))+": "+h((d=a["i18n-gwd"]||b&&b["i18n-gwd"]||c,d.call(b,b&&b.category,b&&b.category,{name:"i18n-gwd",hash:{},data:e})))+"</li>"},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;c="<div>\n    <img src='"+c((d=a.product_image||b&&b.product_image,"function"===typeof d?d.call(b,{name:"product_image",hash:{},data:e}):d))+"' />\n</div>\n<ul class='info'>\n    ";if((d=a["if"].call(b,b&&b.gender,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n    ";if((d=a["if"].call(b,b&&b.category,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===d)c+=d;return c+"\n</ul>"},useData:!0})}({}),sd=function(g){var b=g.UiCore.UiContext;return b.extend("ProductDetails",{className:"product-details",uiContextName:"product_details",dependencies:[],initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){this.model.populated().then(function(){var a=this.__serviceProvider.create(g.Model.FilterModel,[],{});a.setCategoryByProduct(this.model);a=a.get("category")?a.get("category").replace("women","").replace("men","").replace(/#|_/g," ").trim():"";this.$el.html(g.template({product_image:this.model.get("legacy_outfit_image")||this.model.get("product_image"),gender:this.model.get("gender"),category:a}))}.bind(this))}})}({Model:l["@Model"],UiCore:l["@UiCore"],template:rd}),td=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c="<div class='name-container'></div>\n<div class='products'></div>\n<button class='view-shop btn btn-small btn-ghost btn-dark full-width'>";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"view_shop",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</button>"},useData:!0})}({}),ud=function(g){var b=g.UiCore.UiContext;return b.extend("MoreByCreator",{className:"more-by-creator",uiContextName:"more_by_creator",dependencies:["globalStartupModel","modeManager","restModelFactory","window"],trackedEvents:function(){return[{type:"click",selector:"button.view-shop",name:"view_shop",handler:"__viewShop"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){var a=this;this.$el.html(g.template);this.model.populated().then(function(){return this.__restModelFactory.searchCollection(this.__globalStartupModel.get("productEndpoint"),{creator:this.model.get("creator_name"),filter_inventory:1,cat:"106,108,3088,425",limit:4},g.Model.ProductCollection).enumerated()}.bind(this)).then(function(c){c=c.reject(function(e){return this.model.id===e.id}.bind(this));c.length&&this.createChildContext(g.LightboxProductList,{collection:new Backbone.Collection(c.slice(0,4)),$parentElement:this.$(".products")});return this.model.getSingleEdge("creator").populated()}.bind(this)).then(function(c){var e=this;this.__creator=c;this.__dualName=this.createChildContext(g.WAFWidgets.DualName,{$parentElement:this.$(".name-container"),user:c,size:"small",hideAtAvatar:!0,displayArgs:{size:"small",showVipBadge:!0,showCreatorBadgeTooltip:!0}});this.__dualName.getHasRenderedPromise().then(function(){e.__setAsRendered()});this.$("button.view-shop").show()}.bind(this)).catch(function(c){a.__window.console.log("Something went wrong:",c)})},__viewShop:function(){var a={id:"products",creatorModel:this.__creator,showAlways:!0};this.__modeManager.openMode({mode:{id:"shop",submode:a},submode:a})}})}({Model:l["@Model"],UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],LightboxProductList:ia,template:td}),vd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='<div class=\'distinguish-widget-container\'>\n    <div class="content">\n        <h3><span class="icon-distinguish"></span> <span class="text-content">',k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Distinguish_Blurb_Title",{name:"i18n-g",hash:{},data:e}));if(k||0===k)f+=k;f+='</span></h3>\n        <p><span class="text-content">'+h((d=a.blurb||b&&b.blurb,"function"===typeof d?d.call(b,{name:"blurb",hash:{},data:e}):d))+'</span> <a href="'+h((d=a.learnmore||b&&b.learnmore,"function"===typeof d?d.call(b,{name:"learnmore",hash:{},data:e}):d))+'" class="distinguish-learn-more" data-external target="_blank"><strong class="text-content">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Distinguish_Blurb_Tell_Me_More",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+"</strong></a></p>\n    </div>\n</div>"},useData:!0})}({}),Aa=function(g){var b=g.UiCore.UiContext;return b.extend("DistinguishBlurbWidget",{uiContextName:"distinguish_blurb_widget",className:"distinguish-blurb-widget",dependencies:["featureAccessManager","globalStringManager","model","urlManager"],initialize:function(a){b.prototype.initialize.call(this,a);this.__isCard=a.isCard;this.__model=a.model;this.__blurb=a.blurb?a.blurb:"";this.addToDOM()},render:function(){var a=this;this.__model?this.doWork([function(){return a.__model.populated()},function(){var c=a.__model.node?a.__model.node:a.__model;(c.get("has_plus_badge")||c.get("is_plus_badge_compatible"))&&a.__makeBlurb();a.__setAsRendered()}]):(this.__makeBlurb(),this.__setAsRendered())},__makeBlurb:function(){this.$el.html(g.template({blurb:this.__globalStringManager.get(this.__blurb),learnmore:this.__urlManager.get("distinguish_more_info")}));this.$el.toggleClass("distinguish-card",this.__isCard);this.$(".text-content").each(function(){this.innerHTML=this.innerText.replace(/imvu\+/gi,"<strong class='distinguish-text-logo'>imvu+</strong>")})}})}({UiCore:l["@UiCore"],template:vd}),wd=function(g){var b=g.UiCore.UiContext;return b.extend("ProductDetailSidebar",{className:"product-detail-sidebar",uiContextName:"product_detail_sidebar",dependencies:"dressUpAvatarManager featureAccessManager globalStringManager loginManager platform Promise".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.model=IMVU.requireProperty(a,"model");this.__loginManager.isLoggedIn()&&(this.__myself=this.__loginManager.getCurrentUser());this.__featureAccessManager=a.featureAccessManager;a=this.__serviceProvider.has("triggerListFactory")?this.__serviceProvider.get("triggerListFactory"):g.TriggerList;this.__triggerList=this.__serviceProvider.create(a);this.addToDOM()},render:function(){var a=this;this.$el.addClass("loading");this.$el.html(g.template);this.__creatorNode=this.model.getSingleEdge("creator");var c=[this.__triggerList.loadTriggers(this.__dressUpAvatarManager.getLookModel().get("asset_url")),this.__creatorNode.populated().catch(function(){})];this.model.get("is_bundle")&&(this.__subproductCollection=this.model.getEdgeCollection("subproducts",g.Model.ProductEdgeCollection),c.push(this.__subproductCollection.populated().catch(function(){})));this.__loadingPromise=this.__Promise.every(c);this.__addRenderGatingPromise(this.__loadingPromise);this.doWork([function(){return a.__loadingPromise},function(){if(a.__loginManager.isLoggedIn()&&a.__myself.relations.user_permissions){var e=a.__myself.getSingleEdge("user_permissions");a.__addRenderGatingPromise(e.populated());e.populated().then(function(){e.get("permissions").includes("manage_cis_products")&&(this.__productAdminToolsWidget=this.__addAccordionSection("Admin Tools",g.ProductAdminTools,{product:this.model},!0),this.listenTo(this.__productAdminToolsWidget,"productStatusChange",this.__refreshStatusShields.bind(this)))}.bind(a))}var d=a.__subproductCollection?a.__subproductCollection.map(function(k){return a.__triggerList.triggersForProduct(k.node)}):[a.__triggerList.triggersForProduct(a.model)];if(a.__subproductCollection){var h=a.__subproductCollection.length,f="";f=_.contains(a.model.get("categories"),"Decorated Rooms")?a.__globalStringManager.get("items_in_room",{count:h}):a.__globalStringManager.get("items_in_look",{count:h});a.__addAccordionSection(f,g.SubproductList,{collection:a.__subproductCollection},!0)}h=_.reduce(d,function(k,m){return k+m.length},0);0<h&&(f="desktop"===a.__platform,d=a.__addAccordionSection(a.__globalStringManager.get("actions_with_count",{count:h}),g.ActionList,{productTriggers:d},f),a.listenTo(d,"playAction",function(k){return a.trigger("playAction",k)}));a.__addAccordionSection(a.__globalStringManager.get("details"),g.ProductDetails,{model:a.model},!0);a.__loginManager.isLoggedIn()&&(a.__addRenderGatingPromise(a.__creatorNode.isPopulated()),a.__creatorNode.isPopulated()&&a.__addAccordionSection(a.__globalStringManager.get("more_by_creator"),g.MoreByCreator,{model:a.model},!0));d=a.createChildContext(g.DistinguishBlurbWidget,{$parentElement:a.$el,isCard:!1,model:a.model,blurb:"Distinguish_Blurb_Product"});a.__addRenderGatingPromise(d.getHasRenderedPromise());a.__waitOnRenderGatingPromises();a.$el.removeClass("loading")}])},loaded:function(){return this.__loadingPromise||this.__Promise.reject("Not Rendered")},__addStandardSections:function(){},__addAccordionSection:function(a,c,e,d){a=this.createChildContext(g.AccordionSection,{$parentElement:this.$el,title:a,startOpen:!!d,dynamicHeight:!0});this.__addRenderGatingPromise(a.getHasRenderedPromise());return a.addWidget(c,e)},__refreshStatusShields:function(){this.trigger("refreshStatusShields")}})}({Model:l["@Model"],UiCore:l["@UiCore"],AccordionSection:B,ActionList:D,DistinguishBlurbWidget:Aa,MoreByCreator:ud,ProductAdminTools:qd,ProductDetails:sd,SubproductList:R,TriggerList:C,template:nd}),xd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<div class="content scrollbar-outer">\n    <div class="my-rooms"></div>\n    <div class="private-rooms"></div>\n    <div class="public-rooms"></div>\n    <div class="other-rooms"></div>\n</div>\n\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-dark continue" disabled>';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"use_this_room",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+" </button>\n<\/script>\n"},useData:!0})}({}),yd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary invite" disabled>';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"chat_invite_list_dialog_cta",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</button>\n<\/script>"},useData:!0})}({}),zd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="user-info"><div class="username"></div></div><span class="icon remove-recipient"></span>\n'},useData:!0})}({}),Ba=function(g){var b=g.UiCore.UiContext;return b.extend("UserNameListItemPresenter",{tagName:"li",className:"user-name-list-item-presenter",uiContextName:"user_name_list_item_presenter",dependencies:["featureAccessManager","globalStringManager","loginManager","modeManager","namePresentation"],trackedEvents:function(){return[{type:"click",selector:".remove-recipient",name:"remove_recipient",handler:"__remove"}]},initialize:function(a){b.prototype.initialize.call(this,a);if(!["single","dual"].includes(this.__namePresentation))throw Error('namePresentation must be "single" or "dual"');this.__userPicker=a.userPicker;this.addToDOM();this.__myself=this.__loginManager&&this.__loginManager.isLoggedIn()?this.__loginManager.getCurrentUser():null},render:function(){var a=this;this.model.populated().then(function(){a.$el.html(g.template);switch(a.__namePresentation){case"single":a.__displayName=a.createChildContext(g.WAFWidgets.DisplayName,{$replaceElement:a.$(".username"),user:a.model,showVipBadge:!1,size:"small",color:"light"});break;case"dual":a.$el.addClass("user-name-list-item-presenter-dual-version"),a.__dualName=a.createChildContext(g.WAFWidgets.DualName,{$replaceElement:a.$(".user-info"),user:a.model,configuration:"small-dual-darkbg",ignoreClicks:!0})}a.__parentUiContext.trigger("add",a);a.__parentUiContext.trigger("rendered")})},__remove:function(){this.__userPicker.toggleUserInCollection(this.model)}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],template:zd}),Ad=function(g){var b=g.UiCore.ListPresenter;return b.extend("UserNameListPresenter",{className:"user-name-list-presenter",uiContextName:"user_name_list_presenter",itemFactory:g.UserNameListItemPresenter,initialize:function(a){a=void 0===a?{}:a;b.prototype.initialize.call(this,a);a.itemFactory&&(this.itemFactory=a.itemFactory)}})}({UiCore:l["@UiCore"],UserNameListItemPresenter:Ba}),Bd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;return'<div class="user-picker-name-box-wrapper">\n    <span class="user-picker-to">To</span>\n    <div class="user-picker-name-box-scroll-wrapper">\n        <div class="user-picker-name-box">\n            <div class="user-name-list-presenter-placeholder"></div>\n            <input type="text" class="user-picker-search with-placeholder no-focus" placeholder="'+c((d=a.placeholderText||b&&b.placeholderText,"function"===typeof d?d.call(b,{name:"placeholderText",hash:{},data:e}):d))+'" tabindex="0" size="5">\n        </div>\n    </div>\n    <div class="clear-input"></div>\n</div>\n<div class="user-suggestion-list-presenter-container"></div>'},useData:!0})}({}),Cd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;return'<li class="no-results"><span class="no-results-text">'+c((d=a.noResultsText||b&&b.noResultsText,"function"===typeof d?d.call(b,{name:"noResultsText",hash:{},data:e}):d))+"</span></li>\n"},useData:!0})}({}),Dd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'\n    <div class="ap-badge">\n        AP\n    </div>\n'},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=this.escapeExpression;c='<div class="checkBoxWrapper">\n    <input id="user-'+h((d=a.username||b&&b.username,"function"===typeof d?d.call(b,{name:"username",hash:{},data:e}):d))+'-checkbox" name="user-'+h((d=a.username||b&&b.username,"function"===typeof d?d.call(b,{name:"username",hash:{},data:e}):d))+'-checkbox" class="checkbox" type="checkbox">\n    <label></label>\n</div>\n<div class="user-info">\n    <p class="username is-truncated"></p>\n</div>\n';if((b=a["if"].call(b,b&&b.show_ap,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)c+=b;return c+"\n"},useData:!0})}({}),Ed=function(g){var b=g.UiCore.UiContext;return b.extend("UserListItemPresenter",{tagName:"li",className:"user-list-item-presenter",uiContextName:"user_list_item_presenter",trackedEvents:function(){return[{type:"click",selector:"",name:"select_friend",handler:"__handleFriendSelection"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__featureAccessManager=a.featureAccessManager;this.__disableFilter=a.disableFilter;this.__selectedUsers=a.selectedUsers||new Backbone.Collection;this.__allowPersonas=a.allowPersonas;this.__noneligibleUsers=a.noneligibleUsers||new Backbone.Collection;this.__disableFlag=IMVU.optionalProperty(a,"disableFlag",!1);this.__bgLight=(this.__useLargeProfileIcon=IMVU.optionalProperty(a,"useLargeProfileIcon",!0))?"large-dual-lightbg":"small-dual-lightbg";this.__bgDark=this.__useLargeProfileIcon?"large-dual-darkbg":"small-dual-darkbg";this.$el.on("toggle",this.__handleFriendSelection.bind(this));this.$el.on("render",this.render.bind(this));this.addToDOM()},render:function(){var a=this;this.$el.removeClass("is-selected");this.model&&this.model.populated?this.model.populated().then(function(){a.$el.html(g.template({show_ap:a.model.get("is_ap")&&!a.__disableFlag,username:a.model.get("username")}));a.__dualName=a.createChildContext(g.WAFWidgets.DualName,{$replaceElement:a.$(".username"),user:a.model,configuration:a.__bgLight});0<a.__selectedUsers.length&&a.__selectedUsers.contains(a.model)&&a.__toggleUserItemSelected();a.__noneligibleUsers.models?0<a.__noneligibleUsers.length&&a.__noneligibleUsers.contains(a.model)&&a.$el.addClass("disabled"):0<a.__noneligibleUsers.length&&a.__noneligibleUsers.forEach(function(c){c.node===this.model&&this.$el.addClass("disabled")}.bind(a));a.__disableFilter&&a.__disableFilter(a.model)&&a.$el.addClass("disabled");a.__allowPersonas||0===a.model.get("persona_type")||a.$el.addClass("disabled")}).catch(function(){a.$el.hide()}):this.$el.hide()},__handleFriendSelection:function(){this.$el.hasClass("disabled")||(this.$el.parent().parent().parent().find(".user-picker-search").focus(),this.__toggleUserItemSelected(),this.trigger("selected",this.model));if("undefined"!==typeof this.__dualName){var a=this.$("input").prop("checked")?this.__bgDark:this.__bgLight;this.__dualName.setConfiguration(a);this.__dualName.drawIt()}},__toggleUserItemSelected:function(){this.$el.toggleClass("is-selected");this.$("input").prop("checked",!this.$("input").prop("checked"))}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],template:Dd}),Fd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;return'<li class="divider"><div class="system-info-header">'+c((d=a.title||b&&b.title,"function"===typeof d?d.call(b,{name:"title",hash:{},data:e}):d))+"</div></li>"},useData:!0})}({}),Gd=function(g){var b=g.UiCore.ListPresenter;return b.extend("UserSuggestionListPresenter",{className:"user-suggestion-list-presenter",uiContextName:"user_suggestion_list_presenter",itemFactory:g.UserListItemPresenter,dependencies:"$inputElement defer featureAccessManager globalStringManager loginManager restModelFactory searchModel serviceProvider timer window".split(" "),triggerNextPage:1,initialize:function(a){var c=this;this.__user=a.user;this.__scroller=a.scroller?$(a.scroller):null;this.collection=new IMVU.NamedCollection;this.__serviceProvider=a.serviceProvider;this.__additionalCollections=[];this.__additionalFilters=a.additionalFilters;this.__myself=a.loginManager.getCurrentUser();this.__includeFriends=IMVU.optionalProperty(a,"includeFriends",!0);this.__onlyFriends=IMVU.optionalProperty(a,"onlyFriends",!1);this.__useDivider=IMVU.optionalProperty(a,"useDivider",!1);this.__friendsFilters=IMVU.optionalProperty(a,"friendsFilters",{});this.__includeSuggestedUsers=IMVU.optionalProperty(a,"includeSuggestedUsers",!1);this.__includeSuggestedOnlineUsers=IMVU.optionalProperty(a,"includeSuggestedOnlineUsers",!1);this.__includeParticipants=IMVU.optionalProperty(a,"includeParticipants",!1);this.__searchTimeout=this.__serviceProvider.has("searchTimeout")?this.__serviceProvider.get("searchTimeout"):250;b.prototype.initialize.call(this,a);this.__user.populated().then(function(){c.__searchModel.on("change:name",c.__searchModelHandler,c);c.__searchModelHandler()})},delete:function(){this.__currentSearchCollection&&this.__currentSearchCollection.off(null,null,this);b.prototype.delete.call(this);this.$el.off();this.collection.off(null,null,this);this.__timer.clearTimeout(this.searchTimeout);$(this.__scroller).off("scroll.userSuggestionListPresenter")},__getSiteUserSuggestionsCollection:function(){var a=this.__serviceProvider.get("globalStartupModel").get("userEndpoint");this.__restModelFactory.rest.cancelAll(a);return this.__restModelFactory.searchCollection(a,_.extend({limit:5,username_like:this.__searchModel.get("name")},this.__additionalFilters),g.UiCore.NodeCollection)},render:function(){this.__scroller=this.__scroller||this.$el;this.__scroller.scrollbar();this.__scroller.addClass("loading");$(this.__scroller).on("scroll.userSuggestionListPresenter",this.__onScroll.bind(this))},__searchModelHandler:function(){this.__scroller.addClass("loading");var a=this.__searchModel.get("name");this.$(".user-list-item-presenter").removeClass("selected");this.searchTimeout&&this.__timer.clearTimeout(this.searchTimeout);null!==a&&/\w{2,}/.test(a)?this.searchTimeout=this.__timer.setTimeout(this.__searchForUser.bind(this),this.__searchTimeout):this.__includeFriends?this.defaultUserList():(this.__resetList(),this.__currentSearchCollection&&this.__currentSearchCollection.off(null,null,this),this.__currentSearchCollection=null)},__addModelToCollection:function(a){var c=this;_.isArray(a)?a[0]&&(a[0]instanceof g.UiCore.NodeModel?this.collection.add(a):(a=_.pluck(a,"node"),this.__includeSuggestedOnlineUsers?a.forEach(function(e){e.get("online")&&c.collection.add(e)}):this.collection.add(a))):this.collection.add(a instanceof g.UiCore.NodeModel?a:a.node)},__resetList:function(){this.collection.reset();this.$el.empty();this.__scroller.removeClass("loading paging")},defaultUserList:function(){var a=this;this.__includeParticipants&&this.__serviceProvider.has("activeChat")?(this.__activeChat=this.__serviceProvider.get("activeChat"),this.__currentSearchCollection=this.__activeChat.getParticipants(),this.__currentSearchCollection.populated().then(function(){a.__resetList();var c=_.pluck(a.__currentSearchCollection.models,"node"),e=a.__searchModel.get("name")||"";c=c.filter(function(d){return d.get("display_name").startsWith(e)&&d.get("legacy_cid")!==a.__myself.get("legacy_cid")});a.collection.reset(c);a.$el.prepend(g.DividerTemplate({title:a.__globalStringManager.get("people_in_chat")}));a.__onPaged();a.__additionalCollections=[a.__searchUserFriendsCollection.bind(a)];a.__getNextCollection()})):(this.__currentSearchCollection=this.__searchUserFriendsCollection(),this.__currentSearchCollection.on("paged",this.__onPaged,this),this.__currentSearchCollection.enumerated().then(function(){a.__resetList();var c=_.pluck(a.__currentSearchCollection.models,"node"),e=a.__searchModel.get("name")||"";c=c.filter(function(d){return d.get("display_name").startsWith(e)});a.collection.reset(c);a.__currentSearchCollection.on("add",a.__addModelToCollection,a);(a.collection.length&&!a.__onlyFriends||a.__useDivider)&&a.$el.prepend(g.DividerTemplate({title:a.__globalStringManager.get("Friends")}));if(a.__includeSuggestedOnlineUsers||a.__includeSuggestedUsers)a.__additionalCollections=[a.__getSiteOnlineUserSuggestionsCollection.bind(a)];a.__onPaged()}))},__searchUserFriendsCollection:function(a){a=this.__searchModel.get("name")&&1===this.__searchModel.get("name").length?null:a||this.__searchModel.get("name");var c=this.__user.relations.friends;this.__restModelFactory.rest.cancelAll(c);return this.__restModelFactory.searchCollection(c,_.extend({limit:5,name_filter:a},this.__friendsFilters),g.UiCore.EdgeCollection)},__getSiteOnlineUserSuggestionsCollection:function(){return this.track(this.__myself.searchEdgeCollection("uml_users",{limit:5}))},__searchForUser:function(){var a=this;this.__currentSearchCollection&&this.__currentSearchCollection.off(null,null,this);var c=this.__searchModel.get("name");this.__includeFriends?(this.__currentSearchCollection=this.__searchUserFriendsCollection(),this.__onlyFriends||(this.__additionalCollections=[this.__getSiteUserSuggestionsCollection.bind(this)])):this.__currentSearchCollection=this.__getSiteUserSuggestionsCollection();this.__currentSearchCollection.on("paged",this.__onPaged,this);this.__currentSearchCollection.enumerated().then(function(){c===a.__searchModel.get("name")&&(a.__resetList(),a.__addModelToCollection(a.__currentSearchCollection.models),a.__includeFriends&&(a.collection.models.length?a.$el.prepend(g.DividerTemplate({title:a.__globalStringManager.get("Matching Friends")})):a.$el.prepend(g.DividerTemplate({title:a.__globalStringManager.get("Friends")}))),a.__currentSearchCollection.on("add",a.__addModelToCollection,a),a.__onPaged())}).catch(function(){a.__currentSearchCollection.off("paged",a.__onPaged,a);a.__resetList()})},__onPaged:function(){if(0===this.collection.models.length){var a=this.__searchModel.get("name")?this.__globalStringManager.get("no_matches"):this.__includeSuggestedOnlineUsers?this.__globalStringManager.get("no_online_friends"):this.__includeParticipants?this.__globalStringManager.get("no_particpants"):this.__globalStringManager.get("no_friends");this.$el.html(g.NoResultsTemplate({noResultsText:a}));this.__includeParticipants?this.$el.prepend(g.DividerTemplate({title:this.__globalStringManager.get("people_in_chat")})):this.__includeFriends&&this.$el.prepend(g.DividerTemplate({title:this.__globalStringManager.get("Friends")}))}this.__scroller.removeClass("loading paging");this.__defer(this.__onScroll.bind(this))},__updateStickyDividers:function(){this.$(".divider").each(function(a,c){a=$(c);c=a.position().top;a.find(".system-info-header").css({top:0>c?"0px":"",position:0>c?"absolute":"relative"})})},__onScroll:function(){this.__currentSearchCollection&&this.__isScrolledIntoView()&&(this.__currentSearchCollection.hasNextPage()?(this.__scroller.addClass("paging"),this.__currentSearchCollection.getNextPage()):this.__additionalCollections[0]&&this.__getNextCollection())},__getNextCollection:function(){var a=this,c=this.__additionalCollections.shift();this.__currentSearchCollection.off(null,null,this);var e=this.__currentSearchCollection=c();this.__currentSearchCollection.on("paged",this.__onPaged,this);this.__currentSearchCollection.on("add",this.__addModelToCollection,this);var d=this.__searchModel.get("name");this.__currentSearchCollection.enumerated().then(function(h){if(a.__currentSearchCollection==e){if(d!==a.__searchModel.get("name"))return!1;a.__includeFriends&&a.__searchModel.get("name")?a.$el.append(g.DividerTemplate({title:a.__globalStringManager.get("More People")})):a.__includeParticipants&&0<a.__currentSearchCollection.length?a.$el.append(g.DividerTemplate({title:a.__globalStringManager.get("Friends")})):(a.__includeSuggestedOnlineUsers||a.__includeSuggestedUsers&&0<a.__currentSearchCollection.length)&&a.$el.append(g.DividerTemplate({title:a.__globalStringManager.get("Online Users")}));a.__addModelToCollection(h.models);a.__onPaged()}}).catch(function(){a.__currentSearchCollection.off(null,null,a)})},__isScrolledIntoView:function(){var a=this.__scroller[0]===this.__window?this.__scroller.scrollTop()+this.__scroller.height():this.__scroller.offset().top+this.__scroller.height(),c=this.$el.children();return 0<c.length?(c=this.$el.children().eq(-this.triggerNextPage),0===c.length?!0:c.offset().top<=a):c.length===this.collection.length}})}({UiCore:l["@UiCore"],UserListItemPresenter:Ed,DividerTemplate:Fd,NoResultsTemplate:Cd}),V=function(g){var b=g.UiCore.UiContext;return b.extend("UserPicker",{className:"user-picker",uiContextName:"user_picker",dependencies:"defer dialogManager globalStringManager namePresentation platform window".split(" "),trackedEvents:function(){return[{type:"keyup",selector:".user-picker-search",name:"keyup_user_search",handler:this.__onUserInput},{type:"click",selector:".user-picker-search",name:"click_user_search",handler:this.__onInputClick,allowBubble:!1},{type:"focus",selector:".user-picker-search",name:"focus_user_search",handler:this.__onFocus},{type:"blur",selector:".user-picker-search",name:"blur_user_search",handler:this.__onBlur},{type:"click",selector:".user-picker-name-box-wrapper",name:"click_user_picker_wrapper",handler:this.__onUserInputWrapperClick},{type:"click",selector:".clear-input",name:"clear_input",handler:this.__onClearInput,allowBubble:!0}]},initialize:function(a){var c=this;this.__user=a.user;b.prototype.initialize.call(this,a);this.__args=a;this.__maxEntries=a.maxEntries||19;this.__disableFilter=a.disableFilter;this.__allowPersonas=a.allowPersonas;this.__canFlowUpwards=a.canFlowUpwards;this.__noneligibleUsers=a.noneligibleUsers||!1;this.__additionalClasses=a.additionalClasses;this.__keys=g.NextUtil.Keys;this.__useLargeProfileIcon=IMVU.optionalProperty(a,"useLargeProfileIcon",!0);this.__beginFocused=IMVU.optionalProperty(a,"beginFocused",!0);this.__includeFriends=IMVU.optionalProperty(a,"includeFriends",!0);this.__onlyFriends=IMVU.optionalProperty(a,"onlyFriends",!1);this.__useDivider=IMVU.optionalProperty(a,"useDivider",!1);this.__includeSuggestedUsers=IMVU.optionalProperty(a,"includeSuggestedUsers",!1);this.__includeSuggestedOnlineUsers=IMVU.optionalProperty(a,"includeSuggestedOnlineUsers",!1);this.__userNameListItemFactory=IMVU.optionalProperty(a,"userNameListItemFactory",g.UserNameListItemPresenter);this.__includeParticipants=IMVU.optionalProperty(a,"includeParticipants",!1);this.__isShopTogether=IMVU.optionalProperty(a,"isShopTogether",!1);this.__additionalFilters=IMVU.optionalProperty(a,"additionalFilters",{});this.__friendsFilters=IMVU.optionalProperty(a,"friendsFilters",{});this.__isShopTogether&&(this.__onlyFriends=this.__includeParticipants=!0);if(a.unlimited)this.__maxEntries=100,this.__placeholderText=IMVU.optionalProperty(a,"placeholder","");else{var e=1<this.__maxEntries?this.__globalStringManager.get("Choose up to max Recipients",{maxEntries:this.__maxEntries}):this.__globalStringManager.get("Select a Recipient");this.__placeholderText=IMVU.optionalProperty(a,"placeholder",e)}this.userCollection=new Backbone.Collection;a.preselectedUsers&&a.preselectedUsers.each(function(d){return c.userCollection.add(d)});this.__mobileDialogType=IMVU.optionalProperty(a,"mobileDialogType",null);this.__mobileDialogTitle=a.mobileDialogTitle;this.searchModel=new Backbone.Model({name:null});this.addToDOM();this.listenTo(this.userCollection,"add remove reset",function(){c.trigger("recipientChanged",c.userCollection.length)});this.listenTo(this.userCollection,"add",function(){var d=c.$(".user-name-list-presenter > li:last-child");d.expect(1);d[0].scrollIntoView(!1)});this.__useLargeProfileIcon||this.$el.addClass("small-user-picker")},delete:function(){$(this.__window).off("resize.user-suggestions");b.prototype.delete.call(this)},render:function(){var a=this;this.$el.html(g.template({placeholderText:this.__placeholderText}));this.$el.attr("data-max-entries",this.__maxEntries);this.__additionalClasses&&this.$el.addClass(this.__additionalClasses);this.userNameListPresenter=this.createChildContext(g.UserNameListPresenter,{$replaceElement:this.$(".user-name-list-presenter-placeholder"),collection:this.userCollection,userPicker:this,namePresentation:this.__namePresentation,itemFactory:this.__userNameListItemFactory});this.userSuggestionPresenter=this.createChildContext(g.UserSuggestionListPresenter,{$parentElement:this.$(".user-suggestion-list-presenter-container"),collection:new Backbone.Collection,searchModel:this.searchModel,$inputElement:this.$(".user-picker-search"),user:this.__user,disableFilter:this.__disableFilter,selectedUsers:this.userCollection,noneligibleUsers:this.__noneligibleUsers,disableFlag:!0,includeFriends:this.__includeFriends,includeParticipants:this.__includeParticipants,onlyFriends:this.__onlyFriends,useDivider:this.__useDivider,allowPersonas:this.__allowPersonas,useLargeProfileIcon:!!this.__useLargeProfileIcon,additionalFilters:this.__additionalFilters,friendsFilters:this.__friendsFilters,includeSuggestedUsers:this.__includeSuggestedUsers,includeSuggestedOnlineUsers:this.__includeSuggestedOnlineUsers});this.listenTo(this.userSuggestionPresenter,"selected",this.toggleUserInCollectionDirect,this);this.__maxSuggestionHeight=parseInt(this.$(".user-suggestion-list-presenter-container > .user-suggestion-list-presenter").css("max-height"),10);0<this.__maxSuggestionHeight&&this.__canFlowUpwards&&(this.__maybeFlowUpwards(),$(this.__window).on("resize.user-suggestions",this.__maybeFlowUpwards.bind(this)));this.__beginFocused&&this.focusInput();this.listenTo(this.userNameListPresenter,"rendered",function(){var c=a.$(".user-picker-name-box");a.$(".user-picker-name-box-scroll-wrapper").scrollbar();c.scrollTop(c[0].scrollHeight)})},__maybeFlowUpwards:function(){var a=this.$(".user-picker-name-box-wrapper")[0].getBoundingClientRect(),c=$(this.__window).height();this.$el.toggleClass("flow-up",a.bottom+this.__maxSuggestionHeight>c)},focusInput:function(){this.$('input[type="text"]').focus()},clearList:function(){this.userSuggestionPresenter.$(".user-list-item-presenter").removeClass("is-selected");this.userSuggestionPresenter.$(".user-list-item-presenter input").prop("checked",!1);this.userCollection.reset();return this},getUserListItemRootElement:function(a){a=a.get("username");return this.$(".user-list-item-presenter #user-"+(a+"-checkbox")).closest(".user-list-item-presenter")},toggleUserInCollection:function(a){var c=this;this.userCollection.contains(a)?a.populated().then(function(e){var d=c.getUserListItemRootElement(e);0===d.length?c.toggleUserInCollectionDirect(e):d.trigger("toggle")}):this.toggleUserInCollectionDirect(a)},__clearText:function(){this.$(".user-picker-search").val("");this.searchModel.set("name","");this.__refreshHasInput()},__onClearInput:function(){this.__clearText();for(var a=[];0<this.userCollection.length;){var c=this.userCollection.models[0];a.push(c);this.userCollection.remove(c)}a=$jscomp.makeIterator(a);for(c=a.next();!c.done;c=a.next())this.getUserListItemRootElement(c.value).trigger("render")},toggleUserInCollectionDirect:function(a){if(this.userCollection.contains(a))this.userCollection.remove(a),this.$el.removeClass("max-cap-disable"),1===this.__maxEntries&&this.__clearText(),this.$("input").show();else{if(this.userCollection.length>=this.__maxEntries)return;this.userCollection.add(a);this.userCollection.length>=this.__maxEntries?(this.$el.addClass("max-cap-disable"),this.$("input").hide()):this.$("input").show()}this.$("input").attr("placeholder",0<this.userCollection.length?"":this.__placeholderText);this.$("input").toggleClass("with-placeholder",0===this.userCollection.length);this.__refreshHasInput()},getUserList:function(){return _.map(this.userCollection.models,function(a){return a.id.replace("/user/","/users/").replace("/user-","/")})},getRawUserList:function(){return this.userCollection.models},getUserIdList:function(){return _.map(this.userCollection.models,function(a){return a.get("legacy_cid")})},__onUserInput:function(a){var c=this,e=this.$(".user-picker-search").val(),d=$.trim(e);this.__refreshHasInput();this.__keys.wasPressed(a,[8])&&""===d?this.__hasUsersToDelete():this.__highlightActive&&this.$(".user-name-list-presenter li:last-child").removeClass("highlight");this.__defer(function(){d!==c.searchModel.get("name")&&c.searchModel.set("name",d)})},__refreshHasInput:function(){this.$el.toggleClass("has-input",0<this.userCollection.length||0<this.$(".user-picker-search").val().length)},__hasUsersToDelete:function(){if(0<this.userCollection.length){var a=this.$(".user-name-list-presenter li:last-child");a.hasClass("highlight")?(this.toggleUserInCollection(this.userCollection.models[this.userCollection.length-1]),this.__highlightActive=!1):""===this.searchModel.get("name")&&(a.addClass("highlight"),this.__highlightActive=!0)}},__showMobileDialog:function(){var a=this;this.__dialogManager.showDialog(this.__mobileDialogType,{title:this.__mobileDialogTitle,userPickerArgs:this.__args}).finished.then(function(c){c&&(a.userCollection.each(a.toggleUserInCollectionDirect.bind(a)),c.each(a.toggleUserInCollectionDirect.bind(a)))})},__onUserInputWrapperClick:function(a){"mobile"===this.__platform&&this.__mobileDialogType?this.__showMobileDialog():this.$(".user-picker-search").focus()},__onInputClick:function(){"mobile"===this.__platform&&this.__mobileDialogType&&this.__showMobileDialog()},__onFocus:function(){this.$el.addClass("focused")},__onBlur:function(){this.$el.removeClass("focused")}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],UserNameListItemPresenter:Ba,UserNameListPresenter:Ad,UserSuggestionListPresenter:Gd,template:Bd}),I=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("ChatInviteList",{uiContextName:"chat_invite_list",className:"chat-invite-list dialog-type-B userpicker-dialog",dependencies:"chatManager dialogManager featureAccessManager globalStringManager loginManager modeManager roomModel".split(" "),trackedEvents:function(){return[{type:"click",selector:"button.invite",name:"invite",handler:this.__handleInviteClicked}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__loginManager=a.loginManager;this.__roomModel=a.roomModel;this.__chatManager=a.chatManager;this.__participants=a.participants;this.title=a.globalStringManager.get("chat_invite_list_dialog_title");this.__myself=this.track(this.__loginManager.getCurrentUser());this.__dialogManager=a.dialogManager;this.__maxEntries=a.maxEntries||!1;this.__modeManager=a.modeManager;this.__shopTogether=a.shopTogether;this.addToDOM()},render:function(){b.prototype.render.call(this);this.__myself.populated().then(function(){this.setContent("footer",this.$(".dialog-footer-template").text());this.userPicker=this.setContent("body",g.UserPicker,{user:this.__myself,disableFilter:function(a){return!a.get("online")},noneligibleUsers:this.__participants,namePresentation:"single",maxEntries:this.__maxEntries,friendsFilters:{status:"online"},includeSuggestedOnlineUsers:!0,isLiveRoom:this.__roomModel.get("supports_audience")&&this.__featureAccessManager.canSeeLiveRooms()});this.userPicker.userCollection.on("add remove",this.__toggleButtonDisabledProp.bind(this))}.bind(this))},__toggleButtonDisabledProp:function(){this.$("button.invite").prop("disabled",0>=this.userPicker.userCollection.length)},postRender:function(){this.setContent("body",g.template)},__handleInviteClicked:function(){this.$el.addClass("loading");this.userPicker&&this.userPicker.userCollection.each(function(a){this.__chatManager.inviteUserToRoom(this.__roomModel,a)}.bind(this));this.promiseResolver.resolve();this.hide()},close:function(){!this.__shopTogether||!this.__modeManager||this.__modeManager.getCurrentMode()&&"shop"!==this.__modeManager.getCurrentMode().id&&this.__modeManager.getCurrentMode().id||this.__modeManager.openMode({mode:{id:"shop"}});b.prototype.close.call(this)}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],UserPicker:V,template:yd}),Hd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return"shop-together-tile"},3:function(b,a,c,e){return'<li><button class="btn ap"></button></li>'},5:function(b,a,c,e){return"private"},7:function(b,a,c,e){c="\n            ";if((b=a["if"].call(b,b&&b.isPrivate,{name:"if",hash:{},fn:this.program(8,e),inverse:this.program(10,e),data:e}))||0===b)c+=b;return c+"\n        "},8:function(b,a,c,e){var d;c=this.escapeExpression;return'\n                <span class="room-type">'+c((d=a.roomType||b&&b.roomType,"function"===typeof d?d.call(b,{name:"roomType",hash:{},data:e}):d))+"</span>\n            "},10:function(b,a,c,e){var d,h;c=this.escapeExpression;return'\n                <span class="room-occupancy">'+c((h=a.occupancy||b&&b.occupancy,"function"===typeof h?h.call(b,{name:"occupancy",hash:{},data:e}):h))+"/"+c((d=(d=(d=b&&b.data,null==d||!1===d?d:d.node),null==d||!1===d?d:d.capacity),"function"===typeof d?d.apply(b):d))+'</span> <span class="room-type">'+c((h=a.roomType||b&&b.roomType,"function"===typeof h?h.call(b,{name:"roomType",hash:{},data:e}):h))+"</span>\n            "},12:function(b,a,c,e){c="\n            ";if((b=a["if"].call(b,b&&b.isPrivate,{name:"if",hash:{},fn:this.program(13,e),inverse:this.program(18,e),data:e}))||0===b)c+=b;return c+"\n        "},13:function(b,a,c,e){c="\n                ";if((b=a["if"].call(b,b&&b.isShopTogetherRoom,{name:"if",hash:{},fn:this.program(14,e),inverse:this.program(16,e),data:e}))||0===b)c+=b;return c+"\n            "},14:function(b,a,c,e){var d,h=a.helperMissing;c="\n                    ";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"shop_together",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"\n                "},16:function(b,a,c,e){var d,h=a.helperMissing;c='\n                    <span class="room-type">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Private Room",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</span>\n                "},18:function(b,a,c,e){var d,h;c=this.escapeExpression;var f="\n                "+c((h=a.occupancy||b&&b.occupancy,"function"===typeof h?h.call(b,{name:"occupancy",hash:{},data:e}):h))+"/"+c((d=(d=(d=b&&b.data,null==d||!1===d?d:d.node),null==d||!1===d?d:d.capacity),"function"===typeof d?d.apply(b):d))+" ";if((d=a["if"].call(b,b&&b.isFull,{name:"if",hash:{},fn:this.program(19,e),inverse:this.noop,data:e}))||0===d)f+=d;return f+"\n            "},19:function(b,a,c,e){var d,h=a.helperMissing;c="(";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"FULL",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+")"},21:function(b,a,c,e){return'<div class="audience-counter-placeholder"></div>'},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c=this.escapeExpression;var d='<div class="tile-thumbnail ',h=a["if"].call(b,b&&b.isShopTogetherRoom,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(h||0===h)d+=h;d+='">\n    <div class="cover-image"></div>\n    <div class="overlay">\n        <ul class="tile-status-icons">\n            ';if((h=a["if"].call(b,b&&b.isAp,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===h)d+=h;d+='\n        </ul>\n    </div>\n</div>\n<div class="tile-footer">\n    <div class="tile-name is-truncated">'+c((h=(h=(h=b&&b.data,null==h||!1===h?h:h.node),null==h||!1===h?h:h.name),"function"===typeof h?h.apply(b):h))+'</div>\n\n    <div class="room-tile-occupancy ';if((h=a["if"].call(b,b&&b.isPrivate,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===h)d+=h;d+='">\n        <span class="icon-person"><svg viewBox="0 0 32 32"><path d="M19 23.3V22c3-1 4.8-3.8 4.8-9.2 0-5.2-3.5-8.5-8-8.5S8 7.6 8 12.8c0 5.4 2 8.3 4.8 9.3v1.4H9.4c-3.2 0-6 3-6.2 6.6v2h25.4v-2c0-3.7-3-6.6-6.2-6.7H19z"/></svg></span>\n        ';if((h=a["if"].call(b,b&&b.isInventoryBridge,{name:"if",hash:{},fn:this.program(7,e),inverse:this.program(12,e),data:e}))||0===h)d+=h;d+="\n    </div>\n</div>\n";if((h=a["if"].call(b,b&&b.isLiveRoom,{name:"if",hash:{},fn:this.program(21,e),inverse:this.noop,data:e}))||0===h)d+=h;return d},useData:!0})}({}),Id=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="tile-thumbnail">\n    <img src="/common/withme/img/default_room_image.png" alt="room background image" />\n</div>\n<div class="tile-footer">\n    <div class="tile-name is-truncated">Night Time Noir</div>\n    <div class="tile-info">\n        <span class="icon-person"><svg viewBox="0 0 32 32"><path d="M19 23.3V22c3-1 4.8-3.8 4.8-9.2 0-5.2-3.5-8.5-8-8.5S8 7.6 8 12.8c0 5.4 2 8.3 4.8 9.3v1.4H9.4c-3.2 0-6 3-6.2 6.6v2h25.4v-2c0-3.7-3-6.6-6.2-6.7H19z"/></svg></span>\n        0/10\n    </div>\n</div>\n'},useData:!0})}({}),W=function(g){var b=g.UiCore.UiContext;return b.extend("ResponsiveTileListItem",{uiContextName:"responsive_tile_list_item",className:"responsive-tile-list-item",tagName:"li",dependencies:["timer"],trackedEvents:function(){return[{type:"click",name:"list_item_on_click",handler:this.__onClick}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__parentType=IMVU.optionalProperty(a,"parentDialog","");this.__collectionType=IMVU.optionalProperty(a,"collectionType","");this.addToDOM();this.__setHeightTimeout=this.__timer.setTimeout(function(){this.$(".tile-thumbnail").height(this.$(".tile-thumbnail").width())}.bind(this),0)},render:function(){this.$el.html(g.template)},delete:function(){this.__timer.clearTimeout(this.__setHeightTimeout);b.prototype.delete.call(this)},__onClick:function(){this.$el.hasClass("disabled")||(g.NextUtil.DomHelper.radioClass(this.$el,"is-selected"),"inventory-bridge"===this.__parentType?this.trigger("item_selected",{model:this.model,type:this.__collectionType}):this.trigger("item_selected",this.model))},__disableFilter:function(a){this.model.node.get(a.key)===a.value&&this.$el.addClass("disabled")}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:Id}),Jd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='<div class="icon-wrapper">',k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-audience",{name:"icon",hash:{},data:e}));if(k||0===k)f+=k;f+='</div>\n<div class="audience-occupancy">';if((k=(d=a.audienceOccupancy||b&&b.audienceOccupancy,"function"===typeof d?d.call(b,{name:"audienceOccupancy",hash:{},data:e}):d))||0===k)f+=k;return f+'</div>\n<div class="audience-tooltip">\n    '+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"audience-tooltip",{name:"i18n-g",hash:{},data:e})))+"\n</div>"},useData:!0})}({}),J=function(g){return{getPauseLiveRoomsInterval:function(b){(b=b.get("pauseLiveRoomsInterval"))||(b=15e3);return parseInt(b,10)},trimChat:function(b){var a=b.collection;(b=b.maxItems)&&a.length>b&&a.shift()},canBoot:function(b){IMVU.requireProperty(b,"Promise");return new b.Promise(function(a){return b.activeChat?a.resolve(b.activeChat.allowBootFromChat(b.myself,b.toBeBooted)):a.resolve(!1)})},generateChatLog:function(b){var a=b.activeChat,c=b.restModelFactory,e="";$.each(b.messageCollection.models,function(){if("message"===this.get("messageType")||"trigger"===this.get("messageId")){var d=a.isLiveRoom()?c.readModel(this.get("userModel").id,g.UiCore.NodeModel):c.readModel(this.get("participantEdge").relations.ref,g.UiCore.NodeModel);e+=d.attributes.username+": "+this.get("messageText");"trigger"===this.get("messageId")&&(e+=this.get("action"));e+="\n"}});return e}}}({UiCore:l["@UiCore"]}),Ca=function(g){var b=g.UiCore.UiContext;return b.extend("audienceCounters",{className:"audience-counter",uiContextName:"audience_counter",dependencies:"featureAccessManager globalStartupModel imqManager modeManager Promise room timer window".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__throttleTimerRef={};this.__throttledGetLiveRoomOccupancy=g.NextUtil.throttle(this.__timer,this.__throttleTimerRef,this.__getLiveRoomOccupancy.bind(this),1e3);this.addToDOM()},delete:function(){this.__timer.clearTimeout(this.__refreshTimer);this.__timer.clearTimeout(this.__throttleTimerRef.timeout);b.prototype.delete.call(this)},render:function(){this.__subscribeFromStateMount();this.$el.html(g.template({}));this.listenTo(this,"shown",this.__subscribeFromStateMount);this.listenTo(this,"hidden",this.__unsubscribeFromStateMount)},subscribe:function(){var a=this;this.stateMount||this.__imqManager.subscribeState(this.__hangoutModel.get("queue"),this.__hangoutModel.get("state_mount"),function(c,e){a.stateMount=e;a.__getLiveRoomOccupancy(a.stateMount);a.stateMount&&(a.stopListening(a.stateMount),a.listenTo(a.stateMount,"stateChange",a.__throttledGetLiveRoomOccupancy))})},__subscribeFromStateMount:function(){this.__room.populated().then(function(){void 0===this.__room.relations.hangout_experience?this.delete():this.__room.getSingleEdge("hangout_experience").populated().then(function(a){this.__hangoutModel=a;this.subscribe()}.bind(this)).catch(function(a){this.__window.console.log(a)}.bind(this))}.bind(this))},__unsubscribeFromStateMount:function(){if(this.stateMount){try{this.stateMount.unsubscribe()}catch(a){this.__window.console.error("Unsubscribe failure",a)}this.stateMount=null}},__getLiveRoomOccupancy:function(a){var c=this,e=_.isEmpty(a.state)?a.queue.stateMounts.hangout_state_mount.state:a.state;this.__audienceOccupancy=e["audience.occupancy"];void 0!==this.__audienceOccupancy&&(this.__featureAccessManager.canSeeLiveRoomsDebugging()&&this.__audienceOccupancy===e["audience.capacity"]&&(this.__window.console.log("full - state:",a.state),this.__window.console.log("audience.occupancy:",e["audience.occupancy"]),this.__window.console.log("audience.capacity:",e["audience.capacity"])),this.$(".audience-occupancy").toggleClass("full",this.__audienceOccupancy===e["audience.capacity"]),this.$(".audience-occupancy").text(this.__audienceOccupancy),this.__featureAccessManager.shouldPauseLiveRooms()&&(this.__unsubscribeFromStateMount(),this.__timer.clearTimeout(this.__refreshTimer),this.__refreshTimer=this.__timer.setTimeout(function(){return c.subscribe()},g.ChatHelper.getPauseLiveRoomsInterval(this.__globalStartupModel))))}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],ChatHelper:J,template:Jd}),X=function(g){var b=g.ResponsiveTileListItem;return b.extend("ResponsiveRoomTileListItem",{uiContextName:"responsive_room_tile_list_item",className:"responsive-room-tile-list-item responsive-tile-list-item",dependencies:"featureAccessManager globalStringManager imageManager imqManager loginManager model".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.defaultRoomImageUrl=a.defaultRoomImageUrl||"/common/withme/img/default_room_image.png";this.__globalStringManager=a.globalStringManager;this.__checkInUse=IMVU.optionalProperty(a,"checkInUse",!1);this.__isInUse=!1;this.__activeChats=IMVU.optionalProperty(a,"activeChats",void 0);this.addToDOM()},render:function(){this.model.populated().then(function(){var a="private"===this.model.node.get("privacy")?!0:!1;this.__isLiveRoom=this.model.node.get("supports_audience");this.__isShopTogetherRoom="shop_together"===this.model.node.get("type");var c="inventory-bridge"===this.__parentType?!0:!1;switch(this.model.node.get("type")){case"listed":var e=this.__globalStringManager.get("inventory_bridge_public_room");break;case"inventory":e=this.__globalStringManager.get("inventory_bridge_private_room");break;case"shared":e=this.__globalStringManager.get("inventory_bridge_shared_room");break;case"marriage":e=this.__globalStringManager.get("inventory_bridge_marriage_room");break;case"shop_together":e=this.__globalStringManager.get("shop_together");break;default:e=this.__globalStringManager.get("inventory_bridge_private_room")}this.__isLiveRoom&&(e=this.__globalStringManager.get("inventory_bridge_live_room"));this.$el.html(g.template({data:this.model.toJSON(),occupancy:this.model.node.get("occupancy")?this.model.node.get("occupancy"):0,isFull:10===parseInt(this.model.node.get("occupancy")),isPrivate:a,isAp:"AP"===this.model.node.get("content_rating"),isInventoryBridge:c,roomType:e,isLiveRoom:this.__isLiveRoom,isShopTogetherRoom:this.__isShopTogetherRoom}));this.__loadImage();this.__checkInUse&&this.__checkForInUse()}.bind(this));this.listenTo(this.__parentUiContext,"disable",this.__disableFilter);this.__isLiveRoom&&(this.track(this.model),this.__getLiveRoomData(),this.__addAudienceCounter())},__checkForInUse:function(){var a=this.model.node;a.populated().then(function(){a.getSingleEdge("chat").populated().then(function(c){this.__activeChats.has(c)&&(this.$(".room-type").text(this.__globalStringManager.get("in_use")),this.$el.addClass("disabled"))}.bind(this)).catch(function(c){this.__window.console.log(c)}.bind(this))}.bind(this))},__getLiveRoomData:function(){var a=this.model.node;a.populated().then(function(){a.getSingleEdge("hangout_experience").populated().then(function(c){this.__imqManager.subscribeState(c.get("queue"),c.get("state_mount"),function(e,d){this.__stateMount=d;this.__getLiveRoomSceneOccupancy(this.__stateMount);this.listenTo(this.__stateMount,"stateChange",this.__getLiveRoomSceneOccupancy)}.bind(this))}.bind(this)).catch(function(c){this.__window.console.log(c)}.bind(this))}.bind(this))},__getLiveRoomSceneOccupancy:function(a){a=_.isEmpty(a.state)?a.queue.stateMounts.hangout_state_mount.state:a.state;this.__sceneOccupancy=a["scene.occupancy"];this.__sceneCapacity=a["scene.capacity"];void 0!==this.__sceneOccupancy&&this.$(".occupancy__current").text(this.__sceneOccupancy+"/");void 0!==this.__sceneCapacity&&this.$(".occupancy__out-of").text(this.__sceneCapacity)},__loadImage:function(a){a=""===this.model.node.get("image_url")||"//ssluserimages-a.akamaihd.net/imvufiles/rooms/image/default_332.jpg"===this.model.node.get("image_url")||"//userimages-akm.imvu.com/imvufiles/rooms/image/default_332.jpg"===this.model.node.get("image_url")?this.model.node.get("themed_image_url")||this.model.node.get("rendered_image"):this.model.node.get("themed_image_url")||this.model.node.get("image_url")||this.model.node.get("rendered_image");this.__imageManager.loadAsBackgroundImage(this.$(".cover-image"),a,{container:this.$el,defaultImage:this.defaultRoomImageUrl})},__addAudienceCounter:function(){this.__audienceCounter=this.createChildContext(g.audienceCounter,{$replaceElement:this.$(".audience-counter-placeholder"),room:this.model.node})}})}({UiCore:l["@UiCore"],audienceCounter:Ca,ResponsiveTileListItem:W,template:Hd}),K=function(g){var b=g.WAFWidgets.EdgeCollectionPresenter;return b.extend("ResponsiveTileList",{uiContextName:"responsive_tile_list",className:"responsive-tile-list",triggerNextPage:3,initialize:function(a){this.itemFactory=IMVU.optionalProperty(a,"itemFactory",g.ResponsiveTileListItem);this.__emptyTemplate=IMVU.optionalProperty(a,"emptyTemplate",!1);this.__user=a.user?a.user:null;b.prototype.initialize.call(this,a);this.$el.toggleClass("two-columns",400>this.$el.width())},__updateEmpty:function(){this.__emptyTemplate?0!==this.collection.models.length||this.__$empty?this.collection.models.length&&this.__$empty&&(this.__$empty.remove(),this.__$empty=null):(this.__$empty=$(this.__emptyTemplate({})),this.$el.append(this.__$empty),this.__$empty.find(".icon-tooltip-icon")&&this.createChildContext(g.Tooltip,{$replaceElement:this.$(".tooltip-content"),$tooltipTarget:this.$(".icon-tooltip-icon")})):b.prototype.__updateEmpty.call(this)}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],ResponsiveTileListItem:W,Tooltip:y}),Kd=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("InventoryBridgeLightbox",{uiContextName:"inventory_bridge_lightbox",className:"inventory-bridge-lightbox dialog-type-B",dependencies:["dialogManager","globalStringManager","loginManager","protocolLinksManager","restModelFactory"],trackedEvents:function(){return[{type:"click",selector:"button.continue",name:"select_room",handler:"__continue"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__dialogManager=a.dialogManager;this.__serviceProvider=this.__serviceProvider||a.serviceProvider;this.__globalStringManager=a.globalStringManager;this.title=this.__globalStringManager.get("select_room_dialog_title");this.__roomsCollection=a.roomsCollection;this.__type=IMVU.requireProperty(a,"type");this.__showAccordions=IMVU.optionalProperty(a,"showAccordions",!1);this.addToDOM()},postRender:function(){this.setContent("body",g.template,{});this.setContent("footer",this.$(".dialog-footer-template").text());this.__showAccordions?(0!==this.__roomsCollection.myPrivateRooms.length&&(this.__privateRoomsAccordion=this.createChildContext(g.AccordionSection,{$parentElement:this.$(".private-rooms").expect(1),title:this.__globalStringManager.get("My Private Rooms"),startOpen:!0,dynamicHeight:!0,specialClass:"accordion-section-small"}),this.__privateRooms=this.__privateRoomsAccordion.addWidget(g.ResponsiveTileList,{collection:this.__roomsCollection.myPrivateRooms,itemFactory:g.ResponsiveRoomTileListItem,emptyTemplate:!1,parentDialog:"inventory-bridge",collectionType:"private-rooms"}),this.listenTo(this.__privateRooms,"item_selected",this.__selectRoom)),0!==this.__roomsCollection.myPublicRooms.length&&(this.__publicRoomsAccordion=this.createChildContext(g.AccordionSection,{$parentElement:this.$(".public-rooms").expect(1),title:this.__globalStringManager.get("My Public Rooms"),startOpen:!0,dynamicHeight:!0,specialClass:"accordion-section-small"}),this.__publicRooms=this.__publicRoomsAccordion.addWidget(g.ResponsiveTileList,{collection:this.__roomsCollection.myPublicRooms,itemFactory:g.ResponsiveRoomTileListItem,emptyTemplate:!1,parentDialog:"inventory-bridge",collectionType:"public-rooms"}),this.listenTo(this.__publicRooms,"item_selected",this.__selectRoom)),0!==this.__roomsCollection.myOtherRooms.length&&(this.__otherRoomsAccordion=this.createChildContext(g.AccordionSection,{$parentElement:this.$(".other-rooms").expect(1),title:this.__globalStringManager.get("My Other Rooms"),startOpen:!0,dynamicHeight:!0,specialClass:"accordion-section-small"}),this.__otherRooms=this.__otherRoomsAccordion.addWidget(g.ResponsiveTileList,{collection:this.__roomsCollection.myOtherRooms,itemFactory:g.ResponsiveRoomTileListItem,emptyTemplate:!1,parentDialog:"inventory-bridge",collectionType:"other-rooms"}),this.listenTo(this.__otherRooms,"item_selected",this.__selectRoom))):(this.__myRooms=this.createChildContext(g.ResponsiveTileList,{$parentElement:this.$(".my-rooms"),collection:this.__roomsCollection,itemFactory:g.ResponsiveRoomTileListItem,emptyTemplate:!1,parentDialog:"inventory-bridge",collectionType:"all-rooms"}),this.listenTo(this.__myRooms,"item_selected",this.__selectRoom));this.$(".dialog-body .content").scrollbar()},__selectRoom:function(a){var c=a.model;switch(a.type){case"private-rooms":this.$(".public-rooms .responsive-room-tile-list-item").removeClass("is-selected");this.$(".other-rooms .responsive-room-tile-list-item").removeClass("is-selected");break;case"public-rooms":this.$(".private-rooms .responsive-room-tile-list-item").removeClass("is-selected");this.$(".other-rooms .responsive-room-tile-list-item").removeClass("is-selected");break;case"other-rooms":this.$(".private-rooms .responsive-room-tile-list-item").removeClass("is-selected"),this.$(".public-rooms .responsive-room-tile-list-item").removeClass("is-selected")}this.$("button.continue").prop("disabled",!1);this.__roomModel=c.node},__continue:function(a){switch(this.__type){case"chat":this.__joinRoom(a);break;case"chatInvite":this.__dialogManager.showDialog(g.ChatInviteList,{roomModel:this.__roomModel}).finished.then(function(){this.__joinRoom(a)}.bind(this),function(){}.bind(this));break;case"decorate":this.__protocolLinksManager.handleProtocolLink({evt:a,currentSubmode:null,parent:this.__parent,model:this.__roomModel,mode:{id:"decorate"},submode:{id:this.__roomModel.relations.scene}})}},__joinRoom:function(a){this.__protocolLinksManager.handleProtocolLink({evt:a,currentSubmode:null,parent:this.__parent,model:this.__roomModel,mode:{id:"chat"},submode:{id:this.__roomModel.id,forceJoin:!0,showAlways:!0}})}})}({Dialogs:l["@Dialogs"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],AccordionSection:B,ChatInviteList:I,ResponsiveRoomTileListItem:X,ResponsiveTileList:K,template:xd}),Ld=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){c="\n    ";var d=a["if"].call(b,b&&b.showPriceInfo,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e});if(d||0===d)c+=d;c+='\n    <div class="icons">\n        ';if((d=a["if"].call(b,b&&b.showInfo,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n        ";if((d=a["if"].call(b,b&&b.showGiftAndWishlist,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===d)c+=d;c+='\n        <span class="share"></span>\n        ';if((d=a["if"].call(b,b&&b.canInvite,{name:"if",hash:{},fn:this.program(8,e),inverse:this.noop,data:e}))||0===d)c+=d;return c+"\n    </div>\n"},2:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='\n        <div class="price-info">\n            <div class="credits hidden flex items-center">\n                <span class="credits-icon wh-20 mr-5">',k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-credits",{name:"icon",hash:{class:"wh-full"},data:e}));if(k||0===k)f+=k;f+='</span>\n                <span class="credits-price">'+h((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+'</span>\n            </div>\n            <div class="owned-label hidden">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"IN INVENTORY",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</div>\n            <div class="displayonly-label hidden">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"DISPLAY ONLY",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+"</div>\n        </div>\n    "},4:function(b,a,c,e){var d;c=a.helperMissing;var h="\n            ",f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"more_options",{name:"i18n-g",hash:{},data:e}));if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-action_more_new",{name:"icon",hash:{title:f,class:"more-info hidden"},data:e})))||0===f)h+=f;return h+"\n        "},6:function(b,a,c,e){var d;c=a.helperMissing;var h="\n        ",f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Gift",{name:"i18n-g",hash:{},data:e}));if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-gift_new",{name:"icon",hash:{title:f,class:"gift hidden"},data:e})))||0===f)h+=f;h+="\n        ";f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"add_to_wishlist",{name:"i18n-g",hash:{},data:e}));if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-action_wishlist",{name:"icon",hash:{title:f,class:"wishlist-action-icon wishlist add-to-wishlist"},data:e})))||0===f)h+=f;h+="\n        ";f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"remove_from_wishlist",{name:"i18n-g",hash:{},data:e}));if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-wishlist-added",{name:"icon",hash:{title:f,class:"wishlist-action-icon remove-from-wishlist"},data:e})))||0===f)h+=f;return h+"\n        "},8:function(b,a,c,e){var d;c=a.helperMissing;var h=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Invite to Chat",{name:"i18n-g",hash:{},data:e}));return(h=(d=a.icon||b&&b.icon||c,d.call(b,"icon-chat-invite",{name:"icon",hash:{title:h,class:"chat-invite"},data:e})))||0===h?h:""},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c="";if((b=a["if"].call(b,b&&b.showProductInfo,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)c+=b;return c+"\n"},useData:!0})}({}),Md=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary btn-dark send-gift" disabled>';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Next",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+'</button>\n<\/script>\n\n<script type="template">\n    <a></a>\x3c!-- get placed into modal heaer aux --\x3e\n<\/script>\n'},useData:!0})}({}),Da=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<div class="dialog-back-button">';if((a=(d=a.icon||b&&b.icon||h,d.call(b,"icon-back-arrow",{name:"icon",hash:{},data:e})))||0===a)c+=a;return c+"</div>"},useData:!0})}({}),Nd=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("GiftingRecipientPicker",{uiContextName:"gifting_recipient_list",className:"gifting-recipient-picker dialog-type-B userpicker-dialog",dependencies:["featureAccessManager","globalStringManager","loginManager","Promise","serviceProvider"],trackedEvents:function(){return[{type:"click",selector:"button.send-gift",name:"send_gift",handler:this.__handleSendGiftClicked},{type:"click",selector:".dialog-back-button",name:"dialog_back_button",handler:"__goBack"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__dialogManager=a.dialogManager;this.__loginManager=a.loginManager;this.__myself=this.track(this.__loginManager.getCurrentUser());this.__Promise=a.Promise;this.__product=a.product;this.__stringManager=a.globalStringManager;this.__maxEntries=a.maxEntries||10;this.__productSelected=IMVU.optionalProperty(a,"productSelected",!0);this.__type=a.type;this.__source=a.source;this.__serviceProvider=a.serviceProvider;this.__activeChat=IMVU.optionalProperty(a,"activeChat",!1);this.title=this.__stringManager.getPluralized("gifting_recipient_list_dialog_title",{howMany:this.__maxEntries,count:0,max:this.__maxEntries});this.addToDOM()},render:function(){b.prototype.render.call(this);this.__productSelected?this.__Promise.every([this.__myself.populated(),this.__product.populated()]).then(function(){this.userPicker=this.setContent("body",g.UserPicker,{maxEntries:this.__maxEntries,user:this.__myself,disableFilter:"GA"!==this.__product.get("rating")?this.__disableDueToNonGAProducts.bind(this):null,namePresentation:"single",includeSuggestedUsers:"shopTogether"!==this.__type,isShopTogether:"shopTogether"===this.__type});this.listenTo(this.userPicker.userCollection,"add remove",this.__enableSendAndUpdateTitle)}.bind(this)):this.__myself.populated().then(function(){this.userPicker=this.setContent("body",g.UserPicker,{maxEntries:this.__maxEntries,user:this.__myself,namePresentation:"single",includeSuggestedUsers:!0});this.listenTo(this.userPicker.userCollection,"add remove",this.__enableSendAndUpdateTitle)}.bind(this));this.setContent("footer",this.$(".dialog-footer-template").text())},postRender:function(){this.setContent("body",g.template,{});this.__dialogManager.hasDialog("gifting-type-picker-dialog")&&this.$(".dialog-header").prepend(g.backButtonTemplate({}))},__disableDueToNonGAProducts:function(a){return!a.get("is_ap")},__enableSendAndUpdateTitle:function(){this.$("button.send-gift").prop("disabled",0>=this.userPicker.userCollection.length);this.title=this.__stringManager.getPluralized("gifting_recipient_list_dialog_title",{howMany:this.__maxEntries,count:this.userPicker.userCollection.length,max:this.__maxEntries});this.$(".dialog-title").text(this.title)},__handleSendGiftClicked:function(){this.__dialogManager.showGiftingDialog({type:this.__type,product:this.__product,userPicker:this.userPicker,source:this.__source}).finished.then(function(){this.promiseResolver.resolve()}.bind(this))},__goBack:function(){this.promiseResolver.reject();this.hide()},__onClose:function(a){b.prototype.closeAll.call(this,a)}})}({Checkout:l["@Checkout"],Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],UserPicker:V,backButtonTemplate:Da,template:Md}),Od=function(g){var b=g.UiCore.UiContext;return b.extend("ShopActionBar",{uiContextName:"shop_action_bar",className:"shop-action-bar",dependencies:"contextMenuManager dialogManager featureAccessManager globalStringManager loginManager Promise rest restModelFactory window".split(" "),trackedEvents:function(){return[{type:"click",selector:".icons .more-info",name:"more_info",handler:"__showMoreInfo"},{type:"click",selector:".icons .gift",name:"gifting",handler:"__giftProduct"},{type:"click",selector:".icons .add-to-wishlist",name:"wishlisting",handler:"__addToWishlist"},{type:"click",selector:".icons .remove-from-wishlist",name:"remove_from_wishlist",handler:"__removeFromWishlist"},{type:"click",selector:".icons .chat-invite",name:"chat_invite",handler:"__inviteToChat"}]},initialize:function(a){this.__loginManager=a.loginManager;this.__isLoggedIn=this.__loginManager.isLoggedIn();this.__model=IMVU.requireProperty(a,"model");this.__myself=this.__isLoggedIn?this.__loginManager.getCurrentUser():null;this.__price=(this.__isVip=this.__isLoggedIn?!!this.__myself.get("is_vip"):!1)?this.__model.get("discount_price"):this.__model.get("product_price");this.__canInvite=IMVU.optionalProperty(a,"canInvite",!1);this.__fromShopTogether=IMVU.optionalProperty(a,"fromShopTogether",!1);this.__activeChat=IMVU.optionalProperty(a,"activeChat",void 0);this.listenTo(this.__model,"change:is_wished",this.__setWishlist.bind(this));this.listenTo(this.__model,"change:is_owned",this.__setInfoAndIconsDisplay.bind(this));this.listenTo(this.__model,"change:is_purchasable",this.__setInfoAndIconsDisplay.bind(this));b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){var a=this;this.doWork([function(){a.__featureAccessManager.canSeeNFT()?a.$el.html(g.template({showProductInfo:!0,showPriceInfo:!0,price:g.FormatNumber.formatCredits(a.__price),showInfo:!0,canInvite:a.__canInvite,showGiftAndWishlist:!a.__model.get("is_nft")})):a.$el.html(g.template({showProductInfo:!0,showPriceInfo:!0,price:g.FormatNumber.formatCredits(a.__price),showInfo:!0,canInvite:a.__canInvite,showGiftAndWishlist:!0}));a.__setWishlist();a.__socialShare=a.createChildContext(g.WithmeWidgets.SocialShare,{$parentElement:a.$(".icons .share")});a.__addRenderGatingPromise(a.__socialShare.getHasRenderedPromise());a.__model.get("is_bundle")&&!a.__model.get("is_owned")?a.doWork([function(){a.__subproducts=a.__model.getEdgeCollection("subproducts",g.Model.ProductEdgeCollection);a.__addRenderGatingPromise(a.__subproducts.populated());return a.__subproducts.populated()},function(){a.__setInfoAndIconsDisplay();a.listenTo(a.__subproducts,"change:is_owned",a.__setInfoAndIconsDisplay.bind(a));a.__waitOnRenderGatingPromises()}]).catch(a.__setInfoAndIconsDisplay.bind(a)):(a.__setInfoAndIconsDisplay(),a.__waitOnRenderGatingPromises());if(!a.__isLoggedIn)a.$(".credits").on("click",function(){this.__dialogManager.showLoginOrSignupDialog()}.bind(a))}])},__isOwned:function(){return this.__model.get("is_owned")||!(!this.__subproducts||!this.__subproducts.get("is_owned"))},__setInfoAndIconsDisplay:function(){var a=this.__isOwned();this.$el.toggleClass("is-owned",a);var c=this.__model.get("is_purchasable")?!0:!1,e=!a&&c,d=!a&&!c;this.$(".credits").toggleClass("hidden",!e);this.$(".owned-label").toggleClass("hidden",!a);this.$(".displayonly-label").toggleClass("hidden",!d);this.$(".gift").toggleClass("hidden",!c);this.$(".more-info").removeClass("hidden")},__showMoreInfo:function(a){if(this.__isLoggedIn){var c=[{name:"report_product",text:this.__globalStringManager.get("product_context_menu_report_product"),handler:this.__reportProduct.bind(this)}];if(this.__isOwned()&&this.__model.get("is_nft")){var e=(this.__nftStoreVisibilityState=this.__model.get("is_visible"))?this.__globalStringManager.get("product_context_menu_hide_in_shop"):this.__globalStringManager.get("product_context_menu_show_in_shop");c.push({name:"change_nft_visibility",text:e,handler:this.__toggleProductVisibility.bind(this)})}this.__contextMenuManager.showMenu(a,g.ContextMenu,{items:c,displayOptions:{right:!0,above:!0}})}else this.__goToLogin()},__reportProduct:function(){this.$(".report").addClass("hidden");this.__dialogManager.showDialog(g.ReportProductDialog,{model:this.__model}).finished.then(function(a){this.trigger("reported_item")}.bind(this))},__giftProduct:function(){this.__isLoggedIn?this.__dialogManager.showGiftingDialog({product:this.__model,source:this.uiContextName,type:this.__fromShopTogether?"shopTogether":void 0,activeChat:this.__activeChat}):this.__goToLogin()},__isWishlisted:function(){return!!this.__model.get("is_wished")},__setWishlist:function(){this.$el.toggleClass("in-wishlist",this.__isWishlisted())},__addToWishlist:function(){this.__isLoggedIn?this.__myself.getSummaryCollection("wishlist",g.Model.ProductEdgeCollection).create({id:this.model.id}):this.__goToLogin()},__removeFromWishlist:function(){this.__isLoggedIn?this.__restModelFactory.readModel(this.model.relations.viewer_wishlist,g.UiCore.EdgeModel).destroy():this.__goToLogin()},__goToLogin:function(){this.__dialogManager.showLoginOrSignupDialog()},__inviteToChat:function(){this.trigger("chatInviteActive")},__toggleProductVisibility:function(){var a="https://api.imvu.com/product/product-"+this.__model.get("product_id");this.__rest.post(a,{is_visible:this.__nftStoreVisibilityState?!1:!0}).then().catch(function(c){})}})}({Model:l["@Model"],UiCore:l["@UiCore"],WithmeWidgets:l["@WithmeWidgets"],ContextMenu:t,FormatNumber:r,GiftingRecipientPicker:Nd,ReportProductDialog:ka,template:Ld}),Pd=function(g){var b=g.DressUpAvatarManager;return b.extend("ProductDressUpAvatarManager",{dependencies:"loginManager modeManager productId Promise restModelFactory window".split(" "),initialize:function(a){a.persistLooks=!1;this.__productId=a.productId;this.__confirmGenderChange=!1;this.__product=a.restModelFactory.readModel(this.__productId,g.Model.ProductNode);this.__modeManager=a.modeManager;this.__loginManager=a.loginManager;b.prototype.initialize.call(this,a)},__initializeLogoutLookModel:function(){return this.__useProductLookModel()},__initializeLookModel:function(){return new this.__Promise(function(a){this.persistentAvatar=this.__myself.getSingleEdge("avatar");this.persistentAvatar.populated().then(function(){return this.__product.populated()}.bind(this)).then(function(){return this.__product.get("is_bundle")?this.__useProductLookModel():this.__useAvatarLookModel()}.bind(this)).then(function(){this.persistentAvatar.on("change",this.__onPersistentAvatarChange,this);a.resolve()}.bind(this)).catch(function(c){this.__window.console.log(c);a.reject(c)}.bind(this))}.bind(this))},__onPersistentAvatarChange:function(){this.__updateAvatarLookModel()},setNewProductId:function(a){this.__productId=a;this.__product=this.__restModelFactory.readModel(this.__productId,g.Model.ProductNode);return this.__product.populated().then(function(){return this.__updateAvatarLookModel()}.bind(this))},__useProductLookModel:function(){this.__createLookModel(this.__productId);return this.__lookModel.populated()},__useAvatarLookModel:function(){var a=this;this.__createLookModel(this.persistentAvatar.id);return this.__lookModel.populated().then(function(){return a.__updateAvatarLookModel()})},__updateAvatarLookModel:function(){var a=this.__serviceProvider.create(this.__lookModelFactory,{typeId:this.persistentAvatar.id});return a.populated().then(function(){return this.__restModelFactory.readModel(a.get("products")[0].id,g.Model.ProductNode).populated()}.bind(this)).then(function(c){c=c.get("gender");var e=this.__product.get("gender")||c;return this.__Promise.accept(c===e||_.contains(this.__product.get("categories"),"Avatars"))}.bind(this)).then(function(c){return c?this.__updateLookModel([this.__productId],[],!1):this.changeGenderAndAdd(this.__product.get("gender"),[this.__productId])}.bind(this))},changeGenderAndAdd:function(a,c){if(this.__myself)return this.__getDefaultOwnedProducts(a).then(function(e){e=this.__buildChangeQuery(c,[],e);return this.__lookModel.fetch(e)}.bind(this));this.__createLookModel(a);return this.__lookModel.populated().then(function(){return this.__updateLookModel([this.__productId],[],!1)}.bind(this))},__buildChangeQuery:function(a,c,e){return _.has(this,"__myself")?b.prototype.__buildChangeQuery.call(this,[this.__productId],[],e):{}},__getCurrentLookAlert:function(){this.dialogManager.alert({title:this.__globalStringManager.get("dialog_get_product_look_error_title"),text:this.__globalStringManager.get("dialog_get_product_look_error_text"),ok:this.__globalStringManager.get("dialog_get_product_look_error_button")}).finished.then(function(){this.__loginManager.isLoggedIn()?this.__modeManager.openMode({mode:{id:"shop"},submode:{id:"__default__"}}):this.__window.location.href="/welcome/login/"}.bind(this))},__setCurrentLookAlert:function(){return this.__Promise.resolve()},forceChangeToLookUrl:function(a,c){return this.__Promise.accept()}})}({Model:l["@Model"],UiCore:l["@UiCore"],DressUpAvatarManager:x}),Qd=function(g){var b=g.UIContextExtension;return b.extend("ProductDetailWidget",{className:"product-detail-widget",uiContextName:"product_detail_widget",dependencies:"contextMenuManager cookieManager dialogManager featureAccessManager globalStartupModel globalStringManager loginManager modeManager platform Promise protocolLinksManager restModelFactory sceneManager screenshotHelper timer window".split(" "),trackedEvents:function(){return[{type:"click",selector:"",name:"product_detail_widget_click",handler:"__onClick"},{type:"click",selector:"button.decorate",name:"product_detail_decorate_click",handler:"__onClickDecorate"},{type:"click",selector:"button.join",name:"product_detail_join_click",handler:"__onClickJoin"},{type:"click",selector:"button.add-to-room",name:"product_detail_add_to_room_click",handler:"__addToRoom"},{type:"mousedown",selector:'canvas[id^="northstar-canvas"]',name:"product_canvas_mousedown",handler:"onMouseDown",repeats:1},{type:"mouseup",selector:'canvas[id^="northstar-canvas"]',name:"product_canvas_mouseup",handler:"onMouseUp",repeats:1}]},onMouseDown:function(a){this.mouseDownX=a.screenX;this.mouseDownY=a.screenY},onMouseUp:function(a){var c=Math.abs(a.screenX-this.mouseDownX),e=Math.abs(a.screenY-this.mouseDownY);2==a.button&&10>c&&10>e&&this.__showScreenshotMenu(a)},initialize:function(a){var c=this;b.prototype.initialize.call(this,a);this.__dressUpAvatarManagerFactory=a.dressUpAvatarManagerFactory||g.ProductDressUpAvatarManager;this.__myCID=0;a.loginManager.isLoggedIn()&&(this.__myself=this.track(a.loginManager.getCurrentUser()),this.__myCID=this.__myself.get("legacy_cid"));this.__imageFactory=a.imageFactory;this.featureAccessManager=this.__serviceProvider.get("featureAccessManager");this.__filterModel=this.__serviceProvider.create(g.Model.FilterModel,[],{});this.__filterModel.setCategoryByProduct(this.model);this.__modeManager=a.modeManager;this.__protocolLinksManager=a.protocolLinksManager;this.model=this.track(this.model);this.__productTaxonomyLocationEnum=IMVU.optionalProperty(a,"productTaxonomyLocationEnum",null);this.__fromShopTogether=IMVU.optionalProperty(a,"fromShopTogether",!1);this.__activeChat=IMVU.optionalProperty(a,"activeChat",void 0);this.__screenshotHelper=a.screenshotHelper;try{this.__loginManager.isLoggedIn()&&!_.contains(this.model.get("categories"),"Decorated Rooms")&&!_.contains(this.model.get("categories"),"Bundled Rooms")||!(_.contains(this.model.get("categories"),"Decorated Rooms")||_.contains(this.model.get("is"),"locked_room")||_.contains(this.model.get("is"),"furniture_room")||_.contains(this.model.get("is"),"furniture"))?this.__dressUpAvatarManager=this.__serviceProvider.create(this.__dressUpAvatarManagerFactory,{persistLooks:!1,confirmGenderChange:!1,productId:this.model.id}):this.__dressUpAvatarManager=a.dressUpAvatarManager||a.serviceProvider.create(g.DressUpAvatarManager,{persistLooks:!1})}catch(e){this.__dialogManager.alert({title:this.__globalStringManager.get("Sorry, this page isn't available.")}).finished.then(function(){return c.__window.location.href="/welcome/login/"})}this.__headpieceButtonsPromise=new this.__Promise(function(e){c.__headpieceButtonsResolver=e});this.__addRenderGatingPromise(this.__headpieceButtonsPromise);this.__hasSidebarPromise=new this.__Promise(function(e){c.__hasSidebarResolver=e});this.__addRenderGatingPromise(this.__hasSidebarPromise);this.__loginManager.isLoggedIn()?this.doWork([function(){c.__cartModel=c.track(c.__myself.getSingleEdge("cart"));c.__addRenderGatingPromise(c.__cartModel.populated());return c.__cartModel.populated()},function(){c.__cartProducts=c.track(c.__cartModel.getEdgeCollection("products",g.Model.CartProductCollection));c.__addRenderGatingPromise(c.__cartProducts.enumerated());return c.__cartProducts.enumerated()},function(){return c.__hasSidebarPromise},function(){return c.__headpieceButtonsPromise},function(){c.__updateAddToCartButton();c.listenTo(c.__cartProducts,"add remove",c.__updateAddToCartButton.bind(c))}]):this.__showLoggedOutButtons();this.__isLoggedIn=!!this.__loginManager.isLoggedIn();this.addToDOM();this.__onWindowResize=this.refreshSize.bind(this);$(this.__window).on("resize.productDetailWidget"+this.cid,this.__onWindowResize)},delete:function(){this.__dressUpAvatarManager&&this.__dressUpAvatarManager.delete();$(this.__window).off("resize.productDetailWidget"+this.cid,this.__onWindowResize);_.has(this,"actionBar")&&this.actionBar.delete();this.__cleanupMetaRoomsCollection();b.prototype.delete.call(this)},__cleanupMetaRoomsCollection:function(){this.__myOtherRooms&&this.__myOtherRooms.delete&&this.__myOtherRooms.delete()},render:function(){var a=this;this.$el.html(g.template());this.__addRenderGatingPromise(this.model.populated());this.doWork([function(){return a.model.populated()},function(){a.refreshSize();a.__isLoggedIn||(a.$(".overlay").removeClass("hidden"),a.$(".overlay").on("click",function(e){return a.__forceLoginStopProp(e)}));a.__creatorNode=a.model.getSingleEdge("creator");a.model.get("is_bundle")&&(a.__subproductCollection=a.model.getEdgeCollection("subproducts",g.Model.ProductEdgeCollection),a.__addRenderGatingPromise(a.__subproductCollection.populated()));_.contains(a.model.get("categories"),"Decorated Rooms")||_.contains(a.model.get("categories"),"Bundled Rooms")||_.contains(a.model.get("is"),"locked_room")||_.contains(a.model.get("is"),"furniture_room")?a.__addRoom(a.model):_.contains(a.model.get("is"),"furniture")?a.__addFurniture(a.model):a.__addAvatar();a.__setupHeadpiece();var c=a.__dressUpAvatarManager.populated();a.__addRenderGatingPromise(c);return c},function(){a.__productDetailSidebar=a.createChildContext(g.ProductDetailSidebar,{$parentElement:a.$(".product-detail-right-panel .sidebar .scroller"),model:a.model,dressUpAvatarManager:a.__dressUpAvatarManager});a.__addRenderGatingPromise(a.__productDetailSidebar.getHasRenderedPromise());a.listenTo(a.__productDetailSidebar,"playAction",a.__playAction.bind(a));a.listenTo(a.__productDetailSidebar,"refreshStatusShields",a.__addProductStatusShields.bind(a));a.refreshSize();a.$(".product-detail-right-panel .sidebar .scroller").scrollbar();if(!a.__isLoggedIn)a.$(".product-detail-left-panel").on("click",a.__forceLoginStopProp.bind(a));a.__addProductStatusShields();a.__addDistinguishStatus();a.__productTaxonomyLocationEnum&&a.recordProductTaxonomyEvent(a.model,{event:"product_tried_on",eventClass:"shop",eventReason:"tap",location:a.__productTaxonomyLocationEnum,status:"success",systemError:null});a.__waitOnRenderGatingPromises();return a.__hasSidebarResolver.accept()}])},__forceLoginStopProp:function(a){this.__isLoggedIn||("undefined"!==typeof a&&a.stopPropagation(),this.__dialogManager.showLoginOrSignupDialog())},__setupHeadpiece:function(){var a=this;this.doWork([function(){a.__addRenderGatingPromise(a.__creatorNode.populated());return a.__creatorNode.populated().catch(function(c){c.contents&&(c=c.contents.message);window.console.error("Creator Error:",a.__creatorNode,a.__creatorNode.id,c)})},function(){var c=a.__filterModel.get("category");a.__productHeadpiece=a.createChildContext(g.ProductHeadpiece,{$parentElement:a.$(".product-detail-right-panel .headpiece .widgets"),model:a.model,category:c});a.__addRenderGatingPromise(a.__creatorNode.populated());a.__stickyContainer=a.createChildContext(g.StickyContainer,{$replaceElement:a.$(".product-detail-right-panel .headpiece .sticky-container")});a.__addRenderGatingPromise(a.__stickyContainer.getHasRenderedPromise());a.actionBar=a.createChildContext(g.ShopActionBar,{$parentElement:a.$(".product-detail-right-panel .headpiece .widgets"),model:a.model,canInvite:a.__featureAccessManager.canSeeRoomBridge()&&_.contains(a.model.get("categories"),"Rooms")&&!_.contains(a.model.get("categories"),"Decorated Rooms")&&a.model.get("is_owned"),fromShopTogether:a.__fromShopTogether,activeChat:a.__activeChat});a.__addRenderGatingPromise(a.__stickyContainer.getHasRenderedPromise());return a.__subproductCollection?a.__subproductCollection.populated():a.__Promise.resolve()},function(){a.__updateHeadpieceButtons();a.__headpieceButtonsResolver.resolve();a.__loginManager.isLoggedIn()&&(a.listenTo(a.model,"change:is_owned",a.__updateHeadpieceButtons.bind(a)),a.__subproductCollection&&a.listenTo(a.__subproductCollection,"change:is_owned",a.__updateHeadpieceButtons.bind(a)),a.listenTo(a.actionBar,"chatInviteActive",a.__onClickInvite.bind(a)));return a.__Promise.accept()}])},__updateHeadpieceButtons:function(){var a=!1;this.__loginManager.isLoggedIn&&(a=this.model.get("is_owned")||!(!this.__subproductCollection||!this.__subproductCollection.get("is_owned")));this.__featureAccessManager.canSeeNFT()&&this.model.get("is_nft")?this.setHeadpieceButtons({ctaPrimary:this.__globalStringManager.get("buy_now"),shopLightbox:!0}):!a&&this.model.get("is_purchasable")?this.setHeadpieceButtons({ctaSecondary:this.__globalStringManager.get("add_to_cart"),ctaPrimary:this.__globalStringManager.get("buy_now"),shopLightbox:!0}):this.removeHeadpieceButtons();this.featureAccessManager.canSeeRoomBridge()&&a&&_.contains(this.model.get("categories"),"Rooms")&&!_.contains(this.model.get("categories"),"Decorated Rooms")&&(this.$(".bridge-action-buttons button.decorate").removeClass("hidden"),this.$(".bridge-action-buttons button.join").removeClass("hidden"));this.featureAccessManager.canSeeRoomBridge()&&this.model.get("is_owned")&&_.contains(this.model.get("categories"),"Furniture")&&!_.contains(this.model.get("categories"),"Decorated Rooms")&&this.$(".bridge-action-buttons button.add-to-room").removeClass("hidden")},setHeadpieceButtons:function(a){this.__ctaButtons=this.createChildContext(g.LightboxButtons,{$replaceElement:this.__stickyContainer.$(".buttons"),buttons:a});this.__loginManager.isLoggedIn()?(this.listenTo(this.__ctaButtons,"lightboxButton:ctaPrimary",this.__openCheckoutDialog.bind(this)),this.listenTo(this.__ctaButtons,"lightboxButton:ctaSecondary",this.__addToCart.bind(this))):(this.listenTo(this.__ctaButtons,"lightboxButton:ctaPrimary",this.__forceLoginStopProp.bind(this)),this.listenTo(this.__ctaButtons,"lightboxButton:ctaSecondary",this.__forceLoginStopProp.bind(this)));this.$(".headpiece").addClass("has-buttons")},removeHeadpieceButtons:function(){this.__ctaButtons&&(this.stopListening(this.__ctaButtons),this.__ctaButtons.delete(),delete this.__ctaButtons,this.$(".headpiece").removeClass("has-buttons"))},__addProductStatusShields:function(){this.__productStatusShields&&this.__productStatusShields.delete();this.__productStatusShields=this.createChildContext(g.ProductStatusShields,{$parentElement:this.$el.find(".product-detail-left-panel"),model:this.model,showBack:!1});this.__addRenderGatingPromise(this.__productStatusShields.getHasRenderedPromise())},__addDistinguishStatus:function(){this.__DistinguishStatus&&this.__DistinguishStatus.delete();this.__DistinguishStatus=this.createChildContext(g.DistinguishStatus,{$parentElement:this.$el.find(".product-detail-left-panel"),model:this.model,position:"start-end offset"});this.__addRenderGatingPromise(this.__DistinguishStatus.getHasRenderedPromise())},__addAvatar:function(){var a=this;this.__addRenderGatingPromise(this.__dressUpAvatarManager.populated());this.doWork([function(){return a.__dressUpAvatarManager.populated()},function(){a.__sceneArgs={context:a,$parentElement:a.$(".avatar"),model:a.__dressUpAvatarManager.getLookModel(),filterModel:a.__filterModel,imageFactory:a.__imageFactory,sceneContext:"shop_clothing",parentType:"profile_scene"};a.__previewWidget=a.__sceneManager.initProfileScene(a.__sceneArgs);a.__addRenderGatingPromise(a.__previewWidget.getInitProfileScenePromise())}])},__addRoom:function(a){a=this.__restModelFactory.readModel(a.get("scene_url"),g.UiCore.NodeModel);a={$parentElement:this.$(".avatar"),sceneModel:a,dressUpAvatarManager:this.__dressUpAvatarManager};this.__previewWidget=this.createChildContext(g.ProductView,a,!0);this.__addRenderGatingPromise(this.__previewWidget.getHasRenderedPromise())},__addFurniture:function(a){var c=this.__restModelFactory.readModel(this.__globalStartupModel.get("furniturePreviewScene"),g.UiCore.NodeModel);a={$parentElement:this.$(".avatar"),sceneModel:c,startingFurniture:[a],dressUpAvatarManager:this.__dressUpAvatarManager,hideAvatar:!this.__loginManager.isLoggedIn()};this.__previewWidget=this.createChildContext(g.ProductView,a,!0);this.__addRenderGatingPromise(this.__previewWidget.getHasRenderedPromise())},suspend:function(){this.__previewWidget&&this.__previewWidget.toggleRendering(!1,this.__sceneArgs);this.hide()},resume:function(){this.show();this.__previewWidget&&this.__previewWidget.toggleRendering(!0,this.__sceneArgs)},__addToCart:function(){this.__dialogManager.showLightbox("ShoppingCartLightbox",{productsToAdd:[this.model]})},__updateAddToCartButton:function(){var a=this;this.doWork([function(){return a.__cartProducts.checkCartContains(a.model.id)},function(c){a.$(".btn.btn-ghost").toggleClass("hidden",c);a.$(".btn.btn-ghost.in-cart").toggleClass("hidden",!c)}])},__showLoggedOutButtons:function(){this.$(".btn.btn-ghost").toggleClass("hidden",!1);this.$(".btn.btn-ghost.in-cart").toggleClass("hidden",!0)},__openCheckoutDialog:function(){this.__dialogManager.showDialog(g.Checkout.CheckoutDialog,{cart:new g.Checkout.CartCollection([this.model]),successOk:this.__globalStringManager.get("OK"),productTaxonomyOrigin:"product_card"}).finished.then(this.__finishCheckout.bind(this))},__finishCheckout:function(){},__showWelcome:function(){this.__loginManager.setLoginDestination(this.__window.location.href);this.__cookieManager.set(this.__loginCookieName,"");this.__window.location="/welcome"},getPanelWidth:function(a){return parseInt(this.$(".product-detail-"+a+"-panel").css("width"),10)},getPanelHeight:function(a){return parseInt(this.$(".product-detail-"+a+"-panel").css("height"),10)},getWidgetWidth:function(){return this.isShown()?"mobile"===this.__platform?this.getPanelWidth("left"):this.getPanelWidth("left")+this.getPanelWidth("right"):345},getSidebarWidth:function(){return"mobile"===this.__platform?0:this.isShown()?this.getPanelWidth("right"):345},refreshSize:function(){var a=this.getSidebarWidth(),c=0;if(this.getParentUiContext().$el.hasClass("lightbox-dialog")){var e=this.getParentUiContext().$(".main-container").height(),d=this.getParentUiContext().$(".main-container").width();c=e;"mobile"!==this.__platform&&(d=Math.min(c+a,d),c=d-a);if(document.documentMode||/Edge/.test(navigator.userAgent))c=d=555}else{c=_.reduce($(this.__window.document.querySelectorAll("nav")),function(k,m){return"none"===$(m).css("display")?k:"none"===k+$(m).css("display")?0:$(m).height()},0);e=$(this.__window).height();d=$(this.__window).width();var h=parseInt(this.$el.css("padding-left"),10)+parseInt(this.$el.css("padding-right"),10),f=parseInt(this.$el.css("padding-top"),10)+parseInt(this.$el.css("padding-bottom"),10);c=e-f-c;d-=h}"mobile"!==this.platform&&c<g.globalCSSVars.lightboxMinImageSizeDesktop&&(c=g.globalCSSVars.lightboxMinImageSizeDesktop);this.$(".panels").css({width:d,height:c});a=d-a;"mobile"!==this.platform&&a<g.globalCSSVars.lightboxMinImageSizeDesktop&&(a=g.globalCSSVars.lightboxMinImageSizeDesktop);this.$(".product-detail-left-panel").css({width:a,height:c});this.$("canvas").outerHeight(c);this.$(".product-detail-right-panel").css({height:c});"mobile"===this.__platform&&(this.$(".product-detail-left-panel, .product-detail-left-panel .avatar, .product-detail-left-panel .avatar .avatar-2d").css({width:d,height:d}),this.$(".product-detail-right-panel").css({"margin-top":d}))},__onClick:function(a){this.trigger("click")},__playAction:function(a){this.__previewWidget&&this.__previewWidget.playTriggeredAction(a,this.__sceneArgs)},_clickCTA:function(a){this.__ctaButtons._triggerButton(a)},__searchCollectionBy:function(a){a=this.__myself.searchEdgeCollection("my_rooms",a,g.UiCore.EdgeCollection);return this.track(a)},__fetchAllRooms:function(){this.__myPublicRooms=this.__searchCollectionBy({type:"listed"});this.__myPrivateRooms=this.__searchCollectionBy({type:"inventory"});this.__myMarriageRooms=this.__searchCollectionBy({type:"marriage"});this.__mySharedRooms=this.__searchCollectionBy({type:"shared"})},__getRelatedRooms:function(){var a=this,c=this.model.get("product_id"),e;this.__isReadyToShow=new this.__Promise(function(d){e=d}.bind(this));this.__roomsInShell?e.resolve():(this.__fetchRoomPromise=new this.__Promise(function(d){this.__fetchRoomResolver=d}.bind(this)),this.createChildContext(g.LoadingProgress,{$parentElement:this.$el,lingerTime:1e3,progressPromises:[this.__fetchRoomPromise]}),this.__roomsInShell=this.__searchCollectionBy({shell_product_id:c}),this.doWork([function(){return a.__roomsInShell.populated()},function(){a.__fetchRoomResolver.accept();e.resolve()}]))},__onClickDecorate:function(a){this.__getRelatedRooms();this.__isReadyToShow.then(function(){if(1<this.__roomsInShell.length)this.__dialogManager.showDialog(g.InventoryBridgeLightbox,{type:"decorate",roomsCollection:this.__roomsInShell});else if(1===this.__roomsInShell.length){var c=this.__roomsInShell.models[0].node;this.__protocolLinksManager.handleProtocolLink({evt:a,currentSubmode:null,parent:this.__parent,model:c,mode:{id:"decorate"},submode:{id:c.relations.scene}})}}.bind(this))},__onClickJoin:function(a){this.__getRelatedRooms();this.__isReadyToShow.then(function(){if(1<this.__roomsInShell.length)this.__dialogManager.showDialog(g.InventoryBridgeLightbox,{type:"chat",roomsCollection:this.__roomsInShell});else if(1===this.__roomsInShell.length){var c=this.__roomsInShell.models[0].node;this.__protocolLinksManager.handleProtocolLink({evt:a,currentSubmode:null,parent:this.__parent,model:c,mode:{id:"chat"},submode:{id:c.id,forceJoin:!0,showAlways:!0}})}}.bind(this))},__addToRoom:function(a){var c=this;this.__fetchRoomPromise=new this.__Promise(function(e){this.__fetchRoomResolver=e}.bind(this));this.createChildContext(g.LoadingProgress,{$parentElement:this.$el,lingerTime:1e3,progressPromises:[this.__fetchRoomPromise]});this.__fetchAllRooms();this.doWork([function(){return c.__Promise.every([c.__myPrivateRooms.populated(),c.__myPublicRooms.populated(),c.__myMarriageRooms.populated(),c.__mySharedRooms.populated()])},function(){c.__cleanupMetaRoomsCollection();c.__myOtherRooms=c.__serviceProvider.create(g.Model.MetaCollection,{collections:[c.__myMarriageRooms,c.__mySharedRooms]});c.__fetchRoomResolver.accept();c.__dialogManager.showDialog(g.InventoryBridgeLightbox,{type:"decorate",showAccordions:!0,roomsCollection:{myPrivateRooms:c.__myPrivateRooms,myPublicRooms:c.__myPublicRooms,myOtherRooms:c.__myOtherRooms}})}])},__onClickInvite:function(a){this.__getRelatedRooms();this.__isReadyToShow.then(function(){if(1<this.__roomsInShell.length)this.__dialogManager.showDialog(g.InventoryBridgeLightbox,{type:"chatInvite",roomsCollection:this.__roomsInShell});else if(1===this.__roomsInShell.length){var c=this.__roomsInShell.models[0].node;this.__dialogManager.showDialog(g.ChatInviteList,{roomModel:c}).finished.then(function(){this.__protocolLinksManager.handleProtocolLink({evt:a,currentSubmode:null,parent:this.__parent,model:c,mode:{id:"chat"},submode:{id:c.id,forceJoin:!0,showAlways:!0}})}.bind(this),function(){}.bind(this))}}.bind(this))},__showScreenshotMenu:function(a){var c=this;this.__featureAccessManager.canSeeQA()&&this.__sceneArgs&&this.__timer.setTimeout(function(){c.__contextMenuManager.showMenu({clientX:a.clientX,clientY:a.clientY,target:c},g.ContextMenu,{items:[{name:"a",text:"Save image",handler:function(){return c.__takeScreenshot(!0)}},{name:"b",text:"Save image, no background",handler:function(){return c.__takeScreenshot(!1)}}],displayOptions:{above:!0,right:!1},mouseMargin:0,showCaret:!1,closeOnScroll:!1})},100)},__takeScreenshot:function(a){var c=this.__sceneManager.getSoloScene(this.__sceneArgs);this.__screenshotHelper.saveScreenshot({session:c.getSession(),canvas:c.getCanvas(),showBackground:a})}},{defaultSidebarWidth:function(){return 345}})}({Checkout:l["@Checkout"],Model:l["@Model"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],ChatInviteList:I,ContextMenu:t,DistinguishStatus:w,DressUpAvatarManager:x,globalCSSVars:za,InventoryBridgeLightbox:Kd,LightboxButtons:fa,LoadingProgress:md,ProductDetailSidebar:wd,ProductDressUpAvatarManager:Pd,ProductHeadpiece:jd,ProductStatusShields:da,ProductView:ya,ShopActionBar:Od,StickyContainer:ha,UIContextExtension:Q,template:kd}),Rd=function(g){var b=g.LightboxDialog;return b.extend("ProductLightbox",{uiContextName:"product_lightbox",className:"product-lightbox lightbox-dialog lightbox-b",dependencies:["dialogManager","featureAccessManager","loginManager"],initialize:function(a){this.__fromShopTogether=IMVU.optionalProperty(a,"fromShopTogether",!1);this.__activeChat=IMVU.optionalProperty(a,"activeChat",void 0);b.prototype.initialize.call(this,a);this.__myself=this.track(a.loginManager.getCurrentUser());this.linkToDetailsSubmode("shop",this.model)},postRender:function(){var a=this;b.prototype.postRender.call(this);this.doWork([function(){a.$(".lightbox-sidebar").addClass("hidden");a.__detailPresenter=a.createChildContext(g.ProductDetailWidget,{$parentElement:a.$(".main-container"),model:a.model,productTaxonomyLocationEnum:a.__fromShopTogether?"shop_together":"shop",fromShopTogether:a.__fromShopTogether,activeChat:a.__activeChat});a.listenTo(a.__detailPresenter,"shown",function(){a.doWork([function(){return a.refreshSize()}])})}])},hide:function(){this.__detailPresenter&&this.__detailPresenter.suspend();b.prototype.hide.call(this)},show:function(){b.prototype.show.call(this);this.__detailPresenter&&this.__detailPresenter.resume()},delete:function(){this.__dressUpAvatarManager&&this.__dressUpAvatarManager.delete();b.prototype.delete.call(this)},refreshSize:function(){var a=this.__detailPresenter?this.__detailPresenter.getSidebarWidth():"mobile"===this.__platform?0:g.ProductDetailWidget.defaultSidebarWidth(),c=this.__squareSize(a);a=c+a;"mobile"===this.__platform?(c=parseInt(this.$el.css("padding-top"),10)+parseInt(this.$el.css("padding-bottom"),10),c=$(this.__window).height()-c):c<g.globalCSSVars.lightboxMinImageSizeDesktop&&(c=g.globalCSSVars.lightboxMinImageSizeDesktop);if(document.documentMode||/Edge/.test(navigator.userAgent))a=900,c=555;this.$(".main-container").css({width:a,height:c});this.__detailPresenter&&this.__detailPresenter.refreshSize()},__onclickSecondary:function(){b.prototype.__onclickSecondary.call(this);this.__addToCart()},__onclickPrimary:function(){this.__openCheckoutDialog()},__addToCart:function(){this.__dialogManager.showDialog(g.ShoppingCartLightbox,{productsToAdd:[this.model]})},__updateAddToCartButton:function(){this.__cartProducts.checkCartContains(this.model.id).then(function(a){this.$(".btn.btn-ghost").toggleClass("hidden",a);this.$(".btn.btn-ghost.in-cart").toggleClass("hidden",!a)}.bind(this))},__openCheckoutDialog:function(){this.__dialogManager.showDialog(g.Checkout.CheckoutDialog,{cart:new g.Checkout.CartCollection([this.model]),successOk:this.__globalStringManager.get("OK")}).finished.then(this.delete.bind(this))},__playAction:function(a){this.__previewWidget&&this.__previewWidget.playTriggeredAction(a,this.__sceneArgs)},__onMobileScroll:function(){var a=this.$(".dialog-header").height()<=this.$(".main-container").scrollTop();this.$(".dialog-container").toggleClass("non-transparent",a)}})}({Checkout:l["@Checkout"],Model:l["@Model"],UiCore:l["@UiCore"],globalCSSVars:za,LightboxDialog:v,ProductDetailWidget:Qd}),Sd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="panels">\n    <div class="left-panel">\n        <div class="lightbox-perfect-square-container">\n            <canvas class="lightbox-perfect-square-sizer" width="1" height="1"></canvas>\n            <img class="left-panel-image lightbox-perfect-square-content">\n        </div>\n        <div class="left-panel-text"><div class="adjustable"></div></div>\n        <div class="headpiece"></div>\n    </div>\n    <div class="right-panel">\n        <div class="headpiece"></div>\n        <div class="main-column"></div>\n    </div>\n    <div class="mobile-chat-bar"></div>\n</div>\n'},useData:!0})}({}),Td=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return" disabled"},3:function(b,a,c,e){var d;c=a.helperMissing;var h='\n        <div class="invite icon" title=',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,b&&b.inviteTooltipKey,{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+=">";if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-chat-invite",{name:"icon",hash:{},data:e})))||0===f)h+=f;return h+"</div>\n        "},5:function(b,a,c,e){return" hidden "},7:function(b,a,c,e){var d,h=a.helperMissing;c='<div class="settings">';if((a=(d=a.icon||b&&b.icon||h,d.call(b,"icon-settings",{name:"icon",hash:{},data:e})))||0===a)c+=a;return c+"</div>"},9:function(b,a,c,e){var d,h=a.helperMissing;c=" ";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"chat_now",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+" "},11:function(b,a,c,e){c=" ";if((b=a["if"].call(b,b&&b.isActiveChat,{name:"if",hash:{},fn:this.program(12,e),inverse:this.program(14,e),data:e}))||0===b)c+=b;return c},12:function(b,a,c,e){var d,h=a.helperMissing;c=" ";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"join_in_3d",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+" "},14:function(b,a,c,e){var d,h=a.helperMissing;c=" ";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"join_room",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+" "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='<div class="first-row">\n    <div class="image-div hidden"><img class="image-img"></div>\n    <div class="name-container">\n        <div class="name"></div>\n        <ul class="detail-status-icons">\n            <li class="ap-badge hidden"><button class="btn ap"></button></li>\n            <li class="vip-badge hidden"><button class="btn vip"></button></li>\n        </ul>\n        <div class="audience-counter-wrapper"></div>\n    </div>\n</div>\n<div class="second-row">\n    <div class="left-side">\n        <div class="more icon',k=a["if"].call(b,b&&b.isMoreDisabled,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+='" title=';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,b&&b.moreTooltipKey,{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=">\n            ";if((k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-action_more_new",{name:"icon",hash:{},data:e})))||0===k)f+=k;f+='\n        </div>\n        <div class="favorite icon hidden" title=';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,b&&b.favoriteTooltipKey,{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=">\n            ";if((k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-like-off",{name:"icon",hash:{},data:e})))||0===k)f+=k;f+='\n        </div>\n        <div class="favorited icon hidden" title=';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,b&&b.favoriteTooltipKey,{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=">\n            ";if((k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-like-on",{name:"icon",hash:{},data:e})))||0===k)f+=k;f+="\n        </div>\n        ";if((k=a["if"].call(b,b&&b.canInvite,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===k)f+=k;f+='\n        <div class="share icon ';if((k=a.unless.call(b,b&&b.canShare,{name:"unless",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===k)f+=k;f+='" title=';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"share_url",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="></div>\n        ";if((k=a["if"].call(b,b&&b.canEdit,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===k)f+=k;f+='\n    </div>\n</div>\n<div class="action-buttons">\n    <button class="hidden decorate btn btn-ghost btn-dark full-width">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Decorate",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</button>\n    <button class="join btn btn-primary btn-dark full-width" data-room-type="'+h((d=a.roomType||b&&b.roomType,"function"===typeof d?d.call(b,{name:"roomType",hash:{},data:e}):d))+'" title="';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,b&&b.joinTooltipKey,{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='">';if((k=a["if"].call(b,b&&b.isChatNowRoom,{name:"if",hash:{},fn:this.program(9,e),inverse:this.program(11,e),data:e}))||0===k)f+=k;return f+"</button>\n</div>\n"},useData:!0})}({}),Ud=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return"checked"},3:function(b,a,c,e){var d;c=this.escapeExpression;var h='\n                        <option value="'+c((d=b&&b.capacity,"function"===typeof d?d.apply(b):d))+'" ';if((d=a["if"].call(b,b&&b.selected,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===d)h+=d;return h+">"+c((d=b&&b.capacity,"function"===typeof d?d.apply(b):d))+"</option>\n                        "},4:function(b,a,c,e){return"selected"},6:function(b,a,c,e){var d;c=this.escapeExpression;var h='\n                        <option value="'+c((d=b&&b.code,"function"===typeof d?d.apply(b):d))+'" ';if((d=a["if"].call(b,b&&b.selected,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===d)h+=d;return h+">"+c((d=b&&b.name,"function"===typeof d?d.apply(b):d))+"</option>\n                        "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='<div class="tabbed-panel">\n\n    <input ',k=a["if"].call(b,b&&b.isPublic,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+=' id="edit-room-settings-public" class="toggle-public-room-input toggle-switch" type="checkbox">\n    <label for="edit-room-settings-public" class="room-config-settings">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Make This Room Public",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</label>\n    <p class="room-privacy-description">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Room Privacy Description",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</p>\n\n    <section class="public-tab-content tab-content">\n        <div class="edit-room-settings-form">\n            <div class="titled-section titled-section-room-name">\n                <label for="edit-room-settings-room-name" class="system-info-header">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"dialog_room_name",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</label>\n                <div class="titled-section-inset">\n                    <img class="room-thumbnail" data-url="'+h((d=a.rendered_image||b&&b.rendered_image,"function"===typeof d?d.call(b,{name:"rendered_image",hash:{},data:e}):d))+'"></img>\n                    <div class=room-name-input>\n                        <input id="edit-room-settings-room-name" type="text" class="room-name full-width" value="'+h((d=a.name||b&&b.name,"function"===typeof d?d.call(b,{name:"name",hash:{},data:e}):d))+'"></input>\n                    </div>\n                </div>\n            </div>\n            <div class="titled-section">\n                <label for="edit-room-settings-description" class="system-info-header">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"dialog_room_description",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</label>\n                <div class="titled-section-inset">\n                    <textarea id="edit-room-settings-description" class="room-description full-width" placeholder="';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Say something...",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='" maxlength="'+h((d=a.descriptionMaxLength||b&&b.descriptionMaxLength,"function"===typeof d?d.call(b,{name:"descriptionMaxLength",hash:{},data:e}):d))+'">'+h((d=a.description||b&&b.description,"function"===typeof d?d.call(b,{name:"description",hash:{},data:e}):d))+'</textarea>\n                </div>\n            </div>\n            <div class="titled-section">\n                <label class="system-info-header">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Room URL",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</label>\n                <div class="titled-section-inset">\n                    <input type="text" class="join-room-url full-width" value="'+h((d=a.join_room_url||b&&b.join_room_url,"function"===typeof d?d.call(b,{name:"join_room_url",hash:{},data:e}):d))+'" readonly>\n                </div>\n            </div>\n            <div class="titled-section titled-section-access-controls">\n                <label class="system-info-header">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"dialog_room_access_controls",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</label>\n                <div class="titled-section-inset">\n                    <input ';if((k=a["if"].call(b,b&&b.isLiveRoom,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===k)f+=k;f+=' id="edit-room-settings-live" class="toggle-live-input toggle-switch" type="checkbox">\n                    <label for="edit-room-settings-live" class="room-config-settings">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Live Room",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</label>\n                    <div class="live-room-desc">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"live_room_description",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</div>\n\n                    <input ";if((k=a["if"].call(b,b&&b.isAccessPassRequired,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===k)f+=k;f+=' id="edit-room-settings-ap" class="toggle-ap-input toggle-switch" type="checkbox">\n                    <label for="edit-room-settings-ap" class="room-config-settings">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Require Access Pass",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</label>\n\n                    <input ";if((k=a["if"].call(b,b&&b.is_vip,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===k)f+=k;f+=' id="edit-room-settings-vip" class="toggle-vip-input toggle-switch" type="checkbox">\n                    <label for="edit-room-settings-vip" class="room-config-settings">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Require VIP",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</label>\n\n                    <input ";if((k=a["if"].call(b,b&&b.is_age_verified,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===k)f+=k;f+=' id="edit-room-settings-age-verified" class="toggle-age-verified-input toggle-switch" type="checkbox">\n                    <label for="edit-room-settings-age-verified" class="room-config-settings">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Require Age Verification",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</label>\n\n                    <input ";if((k=a["if"].call(b,b&&b.is_friends_only,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===k)f+=k;f+=' id="edit-room-settings-friends-only" class="toggle-friends-only-input toggle-switch" type="checkbox">\n                    <label for="edit-room-settings-friends-only" class="room-config-settings">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"friends_only",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</label>\n                </div>\n            </div>\n            <div class="titled-section">\n                <label for="edit-room-settings-capacity" class="system-info-header">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Max Occupancy",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</label>\n                <div class="titled-section-inset">\n                    <select class="room-capacity">\n                        ';if((k=a.each.call(b,b&&b.capacityChoices,{name:"each",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===k)f+=k;f+='\n                    </select>\n                </div>\n            </div>\n            <div class="titled-section">\n                <label for="edit-room-settings-language" class="system-info-header">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Language",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</label>\n                <div class="titled-section-inset">\n                    <select class="room-language">\n                        ';if((k=a.each.call(b,b&&b.languages,{name:"each",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===k)f+=k;f+='\n                    </select>\n                </div>\n            </div>\n            <div class="titled-section">\n                <label class="system-info-header">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Room Moderators",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</label>\n                <div class="titled-section-inset">\n                    <button class="btn choose-moderators full-width">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Choose Moderators",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+'</button>\n                    <div class="room-moderators-wrapper">\n                        <div class="room-moderator-list-placeholder">\n                            <div class="moderators-are-loading"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </section>\n</div>\n\n'},useData:!0})}({}),Vd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="user-info">\n    <p class="username is-truncated"></p>\n</div>'},useData:!0})}({}),Wd=function(g){var b=g.UiCore.UiContext;return b.extend("RoomAdminsListItem",{tagName:"li",className:"room-admins-list-item",uiContextName:"room_admins_list_item",dependencies:["window"],initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){this.model.populated().then(function(){this.$el.html(g.template);this.__dualName=this.createChildContext(g.WAFWidgets.DualName,{$replaceElement:this.$(".username"),user:this.model.node||this.model,configuration:"large-dual-lightbg"})}.bind(this)).catch(function(){this.__window.console.error(arguments)}.bind(this))}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],template:Vd}),Xd=function(g){return g.UiCore.ListPresenter.extend("RoomAdminsListPresenter",{className:"room-admins-list-presenter",uiContextName:"room_admins_list_presenter",itemFactory:g.RoomAdminsListItem})}({UiCore:l["@UiCore"],RoomAdminsListItem:Wd}),Yd=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h="<div class='scroll-zone'>\n    <div class='header-wrapper'>\n        <div class='header-image'></div>\n        <div class='header-title'>",f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"chat_room_slot_upsell_dialog_header_title",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+="</div>\n        <div class='header-description'>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"chat_room_slot_upsell_dialog_header_description",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+'</div>\n    </div>\n    <div class="chat-room-products">\n        <div class="products"></div>\n    </div>\n    <div class="vip-products">\n        <div class="products"></div>\n    </div>\n    <div class="host-subscription-products">\n        <div class="products"></div>\n    </div>\n</div>'},useData:!0})}({}),Zd=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("ChatRoomSlotUpsellDialog",{uiContextName:"chat_room_slot_upsell_dialog",className:"chat-room-slot-upsell-dialog dialog-type-B",dependencies:"dialogManager dollarStoreManager featureAccessManager globalStartupModel globalStringManager iconManager Promise restModelFactory".split(" "),trackedEvents:function(){return[]},initialize:function(a){b.prototype.initialize.call(this,a);this.Promise=a.Promise;this.serviceProvider=a.serviceProvider;this.dialogManager=a.dialogManager;this.restModelFactory=a.restModelFactory;this.__storeCatalogUrl=a.globalStartupModel.get("storeCatalogUrl");this.__storeCatalog=this.track(this.restModelFactory.readModel(this.__storeCatalogUrl,g.UiCore.NodeModel));this.__parentIframe=IMVU.optionalProperty(a,"parentIframe",null);this.__afterAction=IMVU.optionalProperty(a,"afterAction",null);this.__addRoomTile=a.addRoomTile;this.title=this.__globalStringManager.get("chat_room_slot_upsell_dialog_title");this.__slotsSelectedProduct=new IMVU.NamedModel({price:0});this.__vipSelectedProduct=new IMVU.NamedModel({price:0});this.__hostsSelectedProduct=new IMVU.NamedModel({price:0});this.__cartCollection=new IMVU.NamedCollection;this.__allCategories=["upgrade","vip","hosting"];this.__allProducts=["chat_room_slot","vip_web_tier_1","vip_web_tier_2","vip_web_tier_3"];this.__dollarStoreManager.getPaymentChannels(this.__allCategories).then(function(c){this.__defaultPaymentChannel=c.at(0)}.bind(this)).then(function(){this.__productOfferingsPromise=this.__dollarStoreManager.getProductsOffered(this.__allCategories,this.__defaultPaymentChannel,this.__allProducts);this.__productOfferingsPromise.then(function(c){this.__productOfferingCollection=c;this.__products=[];this.__allCategories.forEach(function(h){this.__products[h]=new IMVU.NamedCollection}.bind(this));c.models.forEach(function(h){var f=h.node.get("category");-1<this.__allCategories.indexOf(f)&&this.__products[h.node.get("category")].add(h)}.bind(this));c=!1;var e=null;e=null;for(var d=0;d<this.__productOfferingCollection.models.length;d++)if(e=this.__productOfferingCollection.models[d].node,e="undefined"===typeof e?"":e.get("category"),"vip"===e){c=!0;break}this.addToDOM();c||this.$(".vip-products").expect(1).addClass("hidden")}.bind(this)).catch(function(){this.__window.console.error("ChatRoomSlotUpsellDialog::postRender - Failed to get product offerings")}.bind(this))}.bind(this))},render:function(){b.prototype.render.call(this,arguments);this.$el.is(".dialog-type-B, .dialog-type-B-flexible")&&this.$el.closest("body").is(".mobile")&&(this.$(".dialog-x").text(this.__globalStringManager.get("Close")),this.__adjustTitlePosition());this.$(".header-wrapper .header-image").expect(1).html(this.__iconManager.iconHtml("icon-chat_room"))},delete:function(){this.promiseResolver&&this.promiseResolver.resolve();this.hide();b.prototype.delete.call(this)},__setVipBestValueItem:function(){3===this.__products.vip.length&&this.__products.vip.each(function(a){"vip_1_year_subscription"===a.node.get("code_name")&&a.node.set("is_best",!0)})},__initializeRoomUpgradeList:function(){this.createChildContext(g.MultiProductList,{$parentElement:this.$(".chat-room-products .products"),collection:this.__products.upgrade,category:"upgrade",cartCollection:this.__cartCollection,viewType:"row",upsellDialog:this,isUpsell:!0,headerText:this.__globalStringManager.get("chat_room_slot_upsell_dialog_title")});this.$(".chat-room-products .icon-wrapper").expect(1).html(this.__iconManager.iconHtml("icon-profile_current_room"));this.$(".chat-room-products .category-upgrade .wrapper")[0].click()},__initializeVipList:function(){this.__setVipBestValueItem();this.createChildContext(g.MultiProductList,{$parentElement:this.$(".vip-products .products"),collection:this.__products.vip,category:"vip",cartCollection:this.__cartCollection,upsellDialog:this,isUpsell:!0,noInitialUpsellSelection:!0,headerText:this.__globalStringManager.get("vip_list_header")})},__initializeHostList:function(){this.createChildContext(g.MultiProductList,{$parentElement:this.$(".host-subscription-products .products"),collection:this.__products.hosting,category:"hosting",cartCollection:this.__cartCollection,upsellDialog:this,isUpsell:!0,noInitialUpsellSelection:!0})},postRender:function(){this.setContent("body",g.template);this.createChildContext(g.CheckoutButton,{$parentElement:this.$(".dialog-footer"),selectedSlot:this.__slotsSelectedProduct,selectedVip:this.__vipSelectedProduct,selectedHost:this.__hostsSelectedProduct,globalStringManager:this.__stringManager,context:this,origin:"chat",afterAction:this.__afterAction,addRoomTile:this.__addRoomTile});this.__initializeRoomUpgradeList();this.__initializeVipList();this.__initializeHostList();this.$(".scroll-zone").scrollbar()},__goBack:function(){this.delete()},aProductClicked:function(a,c){a=a?{model:a,name:a.node.get("name"),price:a.edge.get("sale_price"),original_price:a.edge.get("normal_price"),product_packages_id:a.edge.get("product_packages_id"),count:1}:{price:0};switch(c){case"hosting":c=this.__hostsSelectedProduct;break;case"vip":c=this.__vipSelectedProduct;break;case"upgrade":c=this.__slotsSelectedProduct;break;default:return}c.set(a);c.trigger("click")}})}({Dialogs:l["@Dialogs"],Model:l["@Model"],UiCore:l["@UiCore"],CartCollection:xa,CheckoutButton:ua,MultiProductList:wa,template:Yd}),$d=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<div class="user-picker-placeholder"></div>\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary select">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Select",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</button>\n<\/script>"},useData:!0})}({}),Ea=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("RoomModeratorDialog",{uiContextName:"room_moderator_dialog",className:"room-moderator-dialog dialog-type-B userpicker-dialog",dependencies:["globalStringManager","loginManager","moderators"],trackedEvents:function(){return[{type:"click",selector:".select",name:"choose_moderators",handler:"__chooseModerators"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("Choose Moderators");this.__myself=this.__loginManager.getCurrentUser();this.addToDOM()},render:function(){b.prototype.render.call(this);this.__moderators.populated().then(function(){for(var a=new Backbone.Collection,c=0;c<this.__moderators.length;c++)a.add(this.__moderators.at(c).node);this.userPicker=this.setContent("body",g.UserPicker,{user:this.__myself,namePresentation:"single",preselectedUsers:a,unlimited:!0,onlyFriends:!0,useDivider:!0,placeholder:this.__globalStringManager.get("choose_your_moderators")});this.setContent("footer",this.$(".dialog-footer-template").expect(1).text())}.bind(this))},postRender:function(){this.setContent("body",g.template)},__chooseModerators:function(){var a=this.userPicker.getRawUserList();this.promiseResolver.resolve(a)}})}({Dialogs:l["@Dialogs"],UserPicker:V,template:$d}),ae=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<button class="btn btn-primary save full-width" disabled>';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Save",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</button>\n"},useData:!0})}({}),be=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='<div class="container">\n    <div class="container-inner">\n        <div class="sub-header outers">\n            <div class="inner">\n                <div class="icon hidden">',k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-public-room",{name:"icon",hash:{},data:e}));if(k||0===k)f+=k;f+='</div>\n                <div class="text-title">'+h((d=a.subheader_title||b&&b.subheader_title,"function"===typeof d?d.call(b,{name:"subheader_title",hash:{},data:e}):d))+'</div>\n                <div class="text-body">'+h((d=a.subheader_text||b&&b.subheader_text,"function"===typeof d?d.call(b,{name:"subheader_text",hash:{},data:e}):d))+'</div>\n            </div>\n        </div>\n\n        <div class="payment-methods hidden"></div>\n\n        <div class="prompt add-public-room-prompt outers hidden">\n            <div class="inner">\n                <div class="icon">\n                    ';if((k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-public-room",{name:"icon",hash:{},data:e})))||0===k)f+=k;f+='\n                </div>\n                <div class="text-container">\n                    <div class="line-container">\n                        <div class="line-title">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"add_public_room_prompt_title",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</div>\n                        <div class="line-second">\n                            <div class="description">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"add_public_room_prompt",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</div>\n                        </div>\n                    </div>\n                </div>\n                <div class="price-container">\n                    <div class="price text-price"></div>\n                </div>\n            </div>\n        </div>\n\n        <div class="prompt add-shared-room-prompt outers hidden">\n            <div class="inner">\n                <div class="icon">\n                    ';if((k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-shared-room",{name:"icon",hash:{},data:e})))||0===k)f+=k;f+='\n                </div>\n                <div class="text-container">\n                    <div class="line-container">\n                        <div class="line-title">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"add_shared_room_prompt_title",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</div>\n                        <div class="line-second">\n                            <div class="description">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"add_shared_room_prompt",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</div>\n                        </div>\n                    </div>\n                </div>\n                <div class="price-container">\n                    <div class="price text-price"></div>\n                </div>\n            </div>\n        </div>\n\n        <div class="prompt add-marriage-package-prompt outers hidden">\n            <div class="inner">\n                <div class="icon">\n                    ';if((k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-wedding-bands",{name:"icon",hash:{},data:e})))||0===k)f+=k;f+='\n                </div>\n                <div class="text-container">\n                    <div class="line-container">\n                        <div class="line-title">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"add_marriage_package_prompt_title",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</div>\n                        <div class="line-second">\n                            <div class="description">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"add_marriage_package_prompt",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</div>\n                        </div>\n                    </div>\n                    <ul class="line-points">\n                        <li class="point-a point-common">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"add_marriage_package_point_a",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</li>\n                        <li class="point-b point-common">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"add_marriage_package_point_b",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</li>\n                        <li class="point-c point-common">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"add_marriage_package_point_c",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</li>\n                        <li class="point-d point-common">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"add_marriage_package_point_d",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</li>\n                        <li class="point-e point-common">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"add_marriage_package_point_e",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+'</li>\n                    </ul>\n                </div>\n                <div class="price-container">\n                    <div class="price text-price"></div>\n                </div>\n            </div>\n        </div>\n\n        <div class="vip-upgrades outers hidden"><div class="system-info-header">'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"VIP Membership",{name:"i18n-g",hash:{},data:e})))+'</div></div>\n    </div>\n</div>\n<footer class="dialog-footer"><div class="inner">Checkout</div></footer>\n\n\n\n\n'},useData:!0})}({}),ce=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="credits-container"></div>\n<div class="upgrade-container"></div>\n<div class="vip-container"></div>\n<div class="more-items-container"></div>\n'},useData:!0})}({}),de=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=this.escapeExpression;c=a.helperMissing;h='\n<legend class="system-info-header">'+h((d=a.category||b&&b.category,"function"===typeof d?d.call(b,{name:"category",hash:{},data:e}):d))+"</legend>\n\n<h1>";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"no_products_in_purchase_channel",{name:"i18n-g",hash:{},data:e})))||0===a)h+=a;return h+"</h1>\n"},useData:!0})}({}),ee=function(g){var b=g.UiCore.UiContext;return b.extend("NoProductsAvailable",{uiContextName:"no_products_available",className:"no-products-available",tagName:"section",dependencies:["category","featureAccessManager","globalStringManager"],initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){this.$el.html(g.template({category:this.__globalStringManager.get(this.__category)}))}})}({UiCore:l["@UiCore"],template:de}),fe=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d,h=this.escapeExpression;c=a.helperMissing;h='\n        <a data-external href="'+h((d=a.storeUrl||b&&b.storeUrl,"function"===typeof d?d.call(b,{name:"storeUrl",hash:{},data:e}):d))+'" class="go-to-original-store">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"original_store_link_text",{name:"i18n-g",hash:{},data:e})))||0===a)h+=a;return h+"</a>\n    "},3:function(b,a,c,e){var d,h=a.helperMissing;c='\n        <a class="go-to-original-store">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"original_store_link_text",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</a>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<legend class="system-info-header">',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"More",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='</legend>\n<div class="more-upgrades">\n    ';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"more_upgrades",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="\n    ";if((f=a["if"].call(b,b&&b.isElectron,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===f)h+=f;return h+"\n</div>"},useData:!0})}({}),ge=function(g){var b=g.UiCore.UiContext;return b.extend("MoreItems",{uiContextName:"store_more_items",className:"store-more-items",dependencies:["externalNextRoot","featureAccessManager","leanplum","storePlatform","window"],trackedEvents:function(){return[{type:"click",selector:".go-to-original-store",name:"go_to_original_store",handler:this.__goToOriginalStore}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__storePlatform=a.storePlatform;this.__window=a.window;this.__coreStoreUrl=this.__externalNextRoot.replace("next/","store/index");this.__storeUrl=IMVU.URI.build(this.__coreStoreUrl,{platform:this.__storePlatform});this.addToDOM()},render:function(){this.$el.html(g.template({storeUrl:this.__storeUrl,isElectron:this.__featureAccessManager.isElectronClient()}))},__goToOriginalStore:function(){this.__leanplum.recordEvent("go_to_original_store_click");this.__featureAccessManager.isElectronClient()||this.__window.open(IMVU.URI.build(this.__coreStoreUrl,{platform:this.__storePlatform}),"_blank")}})}({UiCore:l["@UiCore"],template:fe}),he=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d,h=a.helperMissing;c="\n    <h1>";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"no_products_in_purchase_channel",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</h1>\n"},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;c='\n<legend class="system-info-header">'+c((d=a.category||b&&b.category,"function"===typeof d?d.call(b,{name:"category",hash:{},data:e}):d))+"</legend>\n\n";if((b=a["if"].call(b,b&&b.no_products,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)c+=b;return c+"\n"},useData:!0})}({}),ie=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=this.escapeExpression;return'\n        <div class="promo-banner sale">'+c((d=a.sale_copy||b&&b.sale_copy,"function"===typeof d?d.call(b,{name:"sale_copy",hash:{},data:e}):d))+'<div class="triangle"></div></div>\n    '},3:function(b,a,c,e){var d,h=a.helperMissing;c='\n        <div class="promo-banner most-popular">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"MOST POPULAR",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+'<div class="triangle"></div></div>\n    '},5:function(b,a,c,e){var d,h=a.helperMissing;c='\n        <div class="promo-banner best-value">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"BEST VALUE",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+'<div class="triangle"></div></div>\n    '},7:function(b,a,c,e){var d;c=this.escapeExpression;var h='\n        <div class="item-info">\n            <div class="image-container"><span class="helper"></span><img src="'+c((d=a.image||b&&b.image,"function"===typeof d?d.call(b,{name:"image",hash:{},data:e}):d))+'"></div>\n            <div class="item-title"><span>'+c((d=a.title||b&&b.title,"function"===typeof d?d.call(b,{name:"title",hash:{},data:e}):d))+'</span></div>\n            <div class="check"></div>\n        </div>\n        <div class="item-price">\n            ',f=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(8,e),inverse:this.noop,data:e});if(f||0===f)h+=f;return h+'\n            <span class="sale-price">'+c((d=a.sale_price||b&&b.sale_price,"function"===typeof d?d.call(b,{name:"sale_price",hash:{},data:e}):d))+"</span>\n        </div>\n    "},8:function(b,a,c,e){var d;c=this.escapeExpression;return'\n                <span class="original-price">'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</span>\n            "},10:function(b,a,c,e){var d,h=this.escapeExpression;c='\n        <div class="item-info">\n            <div class="image-container"><span class="helper"></span><img src="'+h((d=a.image||b&&b.image,"function"===typeof d?d.call(b,{name:"image",hash:{},data:e}):d))+'"></div>\n        </div>\n        <div class="item-price">\n            <div class="title">'+h((d=a.title||b&&b.title,"function"===typeof d?d.call(b,{name:"title",hash:{},data:e}):d))+"</div>\n            ";if((b=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(11,e),inverse:this.program(13,e),data:e}))||0===b)c+=b;return c+"\n        </div>\n    "},11:function(b,a,c,e){var d;c=this.escapeExpression;return'\n            <div class="prices has-discount">\n                <span class="original-price">'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+'</span>\n                <span class="sale-price">'+c((d=a.sale_price||b&&b.sale_price,"function"===typeof d?d.call(b,{name:"sale_price",hash:{},data:e}):d))+"</span>\n            </div>\n            "},13:function(b,a,c,e){var d;c=this.escapeExpression;return'\n            <div class="prices">\n                '+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"\n            </div>\n            "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c='<div class="wrapper">\n    ';var d=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(d||0===d)c+=d;c+="\n\n    ";if((d=a["if"].call(b,b&&b.is_popular,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n\n    ";if((d=a["if"].call(b,b&&b.is_best,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n\n    ";if((d=a["if"].call(b,b&&b.isRow,{name:"if",hash:{},fn:this.program(7,e),inverse:this.program(10,e),data:e}))||0===d)c+=d;return c+"\n</div>\n"},useData:!0})}({}),je=function(g){var b=g.UiCore.UiContext;return b.extend("PaymentProductItem",{uiContextName:"payment_product_item",tagName:"article",className:"payment-product-item",dependencies:"featureAccessManager globalStringManager googleAnalytics imageManager leanplum loginManager model".split(" "),trackedEvents:function(){return[{type:"click",name:"choose_product_item",handler:"__selectItem"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__viewType=IMVU.optionalProperty(a,"viewType","row");this.__purchasingTotal=IMVU.optionalProperty(a,"purchasingTotal",null);this.__category=IMVU.optionalProperty(a,"category",null);this.addToDOM();this.$el.addClass(this.__viewType+"-view")},render:function(){b.prototype.render.call(this);this.__model.populated().then(function(){this.__renderTemplate();this.__creditValue=this.__getCreditAmountFromName(this.__model.node.get("name"));this.$el.data("credit-value",this.__creditValue);this.$el.data("id",this.__model.node.get("product_packages_id"));"credits"===this.__category&&this.__purchasingTotal&&this.__checkIfBestOption()}.bind(this))},__selectItem:function(){this.trigger("select_item",this.__model)},__refreshProduct:function(){this.__model.invalidate();this.render()},__renderTemplate:function(){this.$el.html(g.template({image:this.__model.node.attributes.img160x160,price:this.__model.edge.attributes.normal_price_formatted,sale_price:this.__model.edge.attributes.sale_price_formatted,title:"vip"===this.__category?"membership":this.__model.node.attributes.name,has_discount:this.__model.edge.attributes.normal_price>this.__model.edge.attributes.sale_price,sale_copy:this.__globalStringManager.get("SALE"),isRow:"row"===this.__viewType}));(this.__hasDiscount||this.__model.get("best")||this.__model.get("popular"))&&this.$el.addClass("has-promo")},__checkIfBestOption:function(){if(0<this.__creditValue-this.__purchasingTotal){var a=this.$el.siblings(".selected-item");0<a.length?a.data("credit-value")>this.__creditValue&&(this.$el.toggleClass("selected-item",!0),a.toggleClass("selected-item",!1)):this.$el.toggleClass("selected-item",!0)}},__getCreditAmountFromName:function(a){return parseInt(a.replace(/\D/g,""))}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:ie}),ke=function(g){var b=g.UiCore.ListPresenter;return b.extend("PaymentProductList",{uiContextName:"payment_product_list",className:"payment-product-list",tagName:"section",itemFactory:g.PaymentProductItem,dependencies:["category","globalStringManager"],initialize:function(a){var c=!a.collection||0===a.collection.length;b.prototype.initialize.call(this,a);this.$el.prepend(g.template({category:this.__globalStringManager.get(this.__category),no_products:c}))},getSelected:function(){this.$(".selected-item").data("credit-value");var a=this.$(".selected-item").data("id");return this.collection.filter(function(c){return c.node.get("product_packages_id")===a})}})}({UiCore:l["@UiCore"],PaymentProductItem:je,template:he}),le=function(g){var b=g.UiCore.UiContext;return b.extend("AccountProductsWidget",{uiContextName:"account_products_widget",className:"account-products-widget",tagName:"div",dependencies:"dollarStoreManager globalStartupModel loginManager Promise rest restModelFactory".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__categories=IMVU.optionalProperty(a,"categories",["credits","upgrade","vip"]);this.__payment=IMVU.optionalProperty(a,"payment",null);this.__showMoreItems=IMVU.optionalProperty(a,"showMoreItems",!0);this.__viewType=IMVU.optionalProperty(a,"viewType","row");this.__purchasingTotal=IMVU.optionalProperty(a,"purchasingTotal",null);this.__listPresenter={credits:g.PaymentProductList,upgrade:g.PaymentProductList,vip:g.PaymentProductList};this.__productList=[];this.__myself=this.track(this.__loginManager.getCurrentUser());this.__renderCallback=IMVU.optionalProperty(a,"renderCallback",null);this.addToDOM();this.listenTo(this,"payment_changed",this.__onPaymentMethodChange)},render:function(){this.$el.html(g.template());this.__payment&&this.__renderProducts();this.__showMoreItems&&(this.__moreItems=this.createChildContext(g.MoreItems,{$parentElement:this.$(".more-items-container")}))},__renderProducts:function(){this.__fetchProducts().then(function(a){this.__collections=[];this.__categories.forEach(function(c){this.__collections[c]=new IMVU.NamedCollection}.bind(this));a.models.forEach(function(c,e){e=c.node.get("category");-1<this.__categories.indexOf(e)&&this.__collections[c.node.get("category")].add(c)}.bind(this));this.__categories.forEach(function(c){this.__createList(c)}.bind(this));null!==this.__renderCallback&&this.__renderCallback.call()}.bind(this)).catch(function(a){this.__categories.forEach(function(c){this.__createList(c)}.bind(this))}.bind(this))},__createList:function(a){if(!this.__listPresenter[a])throw Error('List presenter for category: "'+a+'" is not defined');var c=this.$("."+a+"-container");c.html("");this.__collections[a].length?(this.__productList[a]=this.createChildContext(this.__listPresenter[a],{$parentElement:c,collection:this.__collections[a],category:a,viewType:"vip"===a?"row":this.__viewType,purchasingTotal:this.__purchasingTotal}),this.listenTo(this.__productList[a],"select_item",this.__onSelectItem),"credits"===a&&this.listenTo(this.__productList[a],"best_option",this.__onSetBestOption)):this.__productList[a]=this.createChildContext(g.NoProductsAvailable,{$parentElement:c,category:a})},__fetchProducts:function(){return this.__dollarStoreManager.getProductsOffered(this.__categories,this.__payment.model)},__onPaymentMethodChange:function(a,c){if(this.__payment!==a||c)this.__payment=a,this.__renderProducts()},__onSelectItem:function(a){this.trigger("checkout",a)},getSelectedProduct:function(){return this.__productList.credits.getSelected()[0]}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],MoreItems:ge,NoProductsAvailable:ee,PaymentProductList:ke,template:ce}),me=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("AddRoomDialog",{uiContextName:"add_room_dialog",className:"add-room-dialog dialog-type-B",dependencies:"dialogManager dollarStoreManager featureAccessManager globalStartupModel globalStringManager loginManager rest restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:".dialog-footer",name:"click_checkout",handler:this.__clickCheckout}]},initialize:function(a){b.prototype.initialize.call(this,a);this.purchaseComplete=!1;this.serviceProvider=a.serviceProvider;this.dialogManager=a.dialogManager;this.__stringManager=a.globalStringManager;this.restModelFactory=a.restModelFactory;this.__myself=this.track(a.loginManager.getCurrentUser());this.__isVip=!!this.__myself.get("is_vip");this.__productLibrary={};this.__selectedEdgeDerefModel=null;this.__pitchAddPublicRoom="undefined"!==typeof a.pitchAddPublicRoom&&!0===a.pitchAddPublicRoom;this.__pitchAddSharedRoom="undefined"!==typeof a.pitchAddSharedRoom&&!0===a.pitchAddSharedRoom;this.__pitchAddMarriagePackage="undefined"!==typeof a.pitchAddMarriagePackage&&!0===a.pitchAddMarriagePackage;this.__pitchAddPublicRoom?(this.__pitchAddMarriagePackage=this.__pitchAddSharedRoom=!1,this.title=this.__stringManager.get("add_public_room_dialog_title")):this.title=this.__stringManager.get("add_other_room_dialog_title");this.__accountProducts=null;this.addToDOM()},destroy:function(){this.hide();this.delete()},postRender:function(){var a={};if(!this.__pitchAddPublicRoom&&this.__pitchAddSharedRoom&&this.__pitchAddMarriagePackage){var c=this.__stringManager.get("add_other_room_subheader_title");var e=this.__stringManager.get("add_other_room_subheader_description");var d=!0}else c=this.__stringManager.get("add_public_room_subheader_title"),e=this.__isVip?this.__stringManager.get("add_public_room_subheader_description"):this.__stringManager.get("add_public_room_subheader_description_not_vip"),d="";a.subheader_title=c;a.subheader_text=e;this.setContent("body",g.template,a);d&&this.$(".sub-header .icon").removeClass("hidden");this.__postRenderStore()},__postRenderStore:function(){var a=["upgrade","vip"];this.__dollarStoreManager.getPaymentChannels(a).then(function(c){for(var e=0;e<c.models.length;e++){var d=c.at(e).attributes.channel_key;if("saved_card"!==d&&"different_card"!==d)return c.at(e)}}.bind(this)).then(function(c){this.__dollarStoreManager.getProductsOffered(a,c).then(function(e){this.__products=e;e=function(){function d(k){var m=h[k].edge.attributes.normal_price;k=h[k].edge.attributes.sale_price;return(f=k<m?!0:!1)?'<div class="original-price">$'+Number.parseFloat(m).toFixed(2)+"</div><span>$"+Number.parseFloat(k).toFixed(2)+"</span>":"$"+Number.parseFloat(m).toFixed(2)}var h=this.__productLibrary,f=!1;this.__pitchAddPublicRoom?(this.$(".add-public-room-prompt").removeClass("hidden"),this.$(".add-public-room-prompt .price").html(d("Chat Room")),f&&this.$(".add-public-room-prompt .line-title").append("<span>SALE</span>"),this.$(".add-public-room-prompt .inner").on("click",function(){this.__select("Chat Room")}.bind(this)),this.__select("Chat Room")):this.$(".add-public-room-prompt").addClass("hidden");this.__pitchAddSharedRoom?(this.$(".add-shared-room-prompt").removeClass("hidden"),this.$(".add-shared-room-prompt .price").html(d("Shared Room")),f&&this.$(".add-shared-room-prompt .line-title").append("<span>SALE</span>"),this.$(".add-shared-room-prompt .inner").on("click",function(){this.__select("Shared Room")}.bind(this))):this.$(".add-shared-room-prompt").addClass("hidden");this.__pitchAddMarriagePackage&&this.__productLibrary["Marriage License"]?(this.$(".add-marriage-package-prompt").removeClass("hidden"),this.$(".add-marriage-package-prompt .price").html(d("Marriage License")),f&&this.$(".add-marriage-package-prompt .line-title").append("<span>SALE</span>"),this.$(".add-marriage-package-prompt .inner").on("click",function(){this.__select("Marriage License")}.bind(this))):this.$(".add-marriage-package-prompt").addClass("hidden")}.bind(this);this.__getProductLibraryNewStore(e);this.__yearly=this.__quarterly=this.__monthly=null;this.__pitchAddPublicRoom&&!this.__isVip&&(this.$(".vip-upgrades").removeClass("hidden"),this.__accountProducts=this.createChildContext(g.AccountProductsWidget,{$parentElement:this.$(".vip-upgrades"),categories:["vip"],showMoreItems:!1,dollarStoreManager:this.__dollarStoreManager,payment:{model:c}}),this.listenTo(this.__accountProducts,"checkout",this.__onSelectVIP));null!==this.__accountProducts&&this.$(".system-info-header").text("VIP Membership");this.$(".dialog-footer .inner").removeClass("selection-made");this.$(".container").scrollbar()}.bind(this))}.bind(this))},__onSelectVIP:function(a){"vip_1_month_subscription"===a.node.get("code_name")?this.__select("VIP Monthly"):"vip_3_month_subscription"===a.node.get("code_name")?this.__select("VIP Quarterly"):"vip_1_year_subscription"===a.node.get("code_name")&&this.__select("VIP Yearly")},__onPaymentChange:function(a){null!==this.__accountProducts&&this.__accountProducts.trigger("payment_change",a)},__getProductLibrary:function(a){this.__storeCatalog.populated().then(function(c){c.getEdgeCollection("items").populated().then(function(e){_.each(e.models,function(d){var h=d.edge,f="";if("vip"===h.get("type")){if(h.get("id").includes("vip-vip-club-monthly")||"VIP Monthly Subscription"===h.get("title"))f="VIP Monthly";else if(h.get("id").includes("vip-vip-club-quarterly")||"VIP Quarterly Subscription"===h.get("title"))f="VIP Quarterly";else if(h.get("id").includes("vip-vip-club-annually")||"VIP Yearly Subscription"===h.get("title"))f="VIP Yearly";this.__productLibrary[f]=d}else if("upgrades"===h.get("type")){if(h.get("id").includes("upgrades-marriage_package")||"Marriage Package"===h.get("title"))f="Marriage License";else if(h.get("id").includes("upgrades-room_slot")||"Chat Room Slot"===h.get("title"))f="Chat Room";else if(h.get("id").includes("upgrades-shared_room")||"Shared Room Package"===h.get("title"))f="Shared Room";this.__productLibrary[f]=d}}.bind(this));a.call()}.bind(this))}.bind(this))},__getProductLibraryNewStore:function(a){_.each(this.__products.models,function(c){var e="";"vip"===c.node.get("category")?("vip_1_month_subscription"===c.node.get("code_name")?e="VIP Monthly":"vip_3_month_subscription"===c.node.get("code_name")?e="VIP Quarterly":"vip_1_year_subscription"===c.node.get("code_name")&&(e="VIP Yearly"),this.__productLibrary[e]=c):"upgrade"===c.node.get("category")&&("marriage_license"===c.node.get("code_name")?e="Marriage License":"chat_room_slot"===c.node.get("code_name")?e="Chat Room":"shared_room"===c.node.get("code_name")&&(e="Shared Room"),this.__productLibrary[e]=c)}.bind(this));a.call()},__select:function(a){if("undefined"!==typeof this.__productLibrary){this.$(".add-public-room-prompt .inner").removeClass("selected");this.$(".add-shared-room-prompt .inner").removeClass("selected");this.$(".add-marriage-package-prompt .inner").removeClass("selected");this.__accountProducts?(this.__accountProducts.$(".payment-product-list article:nth-of-type(1)").removeClass("selected"),this.__accountProducts.$(".payment-product-list article:nth-of-type(2)").removeClass("selected"),this.__accountProducts.$(".payment-product-list article:nth-of-type(3)").removeClass("selected")):(void 0!==this.__monthly&&null!==this.__monthly&&this.__monthly.removeClass("selected"),void 0!==this.__quarterly&&null!==this.__quarterly&&this.__quarterly.removeClass("selected"),void 0!==this.__yearly&&null!==this.__yearly&&this.__yearly.removeClass("selected"));switch(a){case"Chat Room":this.$(".add-public-room-prompt .inner").addClass("selected");break;case"Shared Room":this.$(".add-shared-room-prompt .inner").addClass("selected");break;case"Marriage License":this.$(".add-marriage-package-prompt .inner").addClass("selected");break;case"VIP Monthly":this.__accountProducts?this.__accountProducts.$(".payment-product-list article:nth-of-type(1)").addClass("selected"):null!==this.__monthly&&this.__monthly.addClass("selected");break;case"VIP Quarterly":this.__accountProducts?this.__accountProducts.$(".payment-product-list article:nth-of-type(2)").addClass("selected"):null!==this.__quarterly&&this.__quarterly.addClass("selected");break;case"VIP Yearly":this.__accountProducts?this.__accountProducts.$(".payment-product-list article:nth-of-type(3)").addClass("selected"):null!==this.__yearly&&this.__yearly.addClass("selected");break;default:throw Error("AddRoomDialog::__select - Unhandled key ("+a+")")}this.__selectedEdgeDerefModel=this.__productLibrary[a];a=this.__selectedEdgeDerefModel.edge.attributes.normal_price;var c=this.__selectedEdgeDerefModel.edge.attributes.sale_price;c<a?this.__updateButton(c):this.__updateButton(a);this.$(".dialog-footer .inner").addClass("selection-made")}},__updateButton:function(a){this.$(".dialog-footer .inner").addClass("selection-made");this.$(".dialog-footer .inner").text("Buy 1 item for $"+Number.parseFloat(a).toFixed(2))},__clickCheckout:function(){null!==this.__selectedEdgeDerefModel&&this.__checkoutMulticart()},__checkoutMulticart:function(){this.__globalStartupModel.get("paymentChannelEndpoint");this.__dollarStoreManager.getPaymentChannels(["upgrade","vip"]).then(function(a){var c=a.models[0],e=new IMVU.NamedCollection,d=null,h=new IMVU.NamedModel({node:this.__selectedEdgeDerefModel.node.attributes,edge:this.__selectedEdgeDerefModel.edge.attributes,productModel:this.__selectedEdgeDerefModel});"vip"===h.attributes.node.category&&(d=h);e.add(h);this.__dollarStoreManager.validateAccountStatus().then(function(){this.__dialogManager.showDialog(g.MultiCartCheckout,{cart:e,paymentChannels:a,defaultChannel:c,vipModel:d,afterAction:"closeAll"}).finished.then(function(){this.destroy()}.bind(this)).catch(function(){this.destroy()}.bind(this))}.bind(this))}.bind(this))},__goBack:function(){this.destroy()}})}({Dialogs:l["@Dialogs"],Model:l["@Model"],UiCore:l["@UiCore"],AccountProductsWidget:le,MultiCartCheckout:U,template:be}),ne=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("EditRoomSettings",{uiContextName:"edit_room_settings",className:"edit-room-settings dialog-type-B",ROOM_NAME_MAX_LENGTH:255,DESCRIPTION_MAX_LENGTH:256,dependencies:"dialogManager errorToasterManager featureAccessManager globalStringManager imageManager loginManager Promise window".split(" "),trackedEvents:function(){return[{type:"change",selector:".toggle-public-room-input",name:"choose_room_privacy",handler:"__chooseRoomPrivacy"},{type:"change",selector:".toggle-public-room-input.toggle-switch",name:"choose_room_privacy",handler:"__maybeDisableSaveButton"},{type:"click",selector:".save",name:"save_room_settings",handler:"__handleSaveRoomSettings"},{type:"input",selector:".room-name",name:"room_name_keypress",handler:"__maybeDisableSaveButton"},{type:"input",selector:".room-description",name:"room_description_keypress",handler:"__maybeDisableSaveButton"},{type:"change",selector:"#edit-room-settings-live",name:"room_access_toggle_live",handler:"__maybeDisableSaveButton"},{type:"change",selector:"#edit-room-settings-ap",name:"room_access_toggle_ap",handler:"__maybeDisableSaveButton"},{type:"change",selector:"#edit-room-settings-vip",name:"room_access_toggle_vip",handler:"__maybeDisableSaveButton"},{type:"change",selector:"#edit-room-settings-age-verified",name:"room_access_toggle_age_verified",handler:"__maybeDisableSaveButton"},{type:"change",selector:"#edit-room-settings-friends-only",name:"room_access_toggle_friends_only",handler:"__maybeDisableSaveButton"},{type:"change",selector:".room-capacity",name:"room_capacity_change",handler:"__maybeDisableSaveButton"},{type:"change",selector:".room-language",name:"room_language_change",handler:"__maybeDisableSaveButton"},{type:"click",selector:".choose-moderators",name:"choose_moderators",handler:"__chooseModerators"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("Edit Room Settings");this.__myself=this.__loginManager.getCurrentUser();this.__roomModel=this.model;this.__isPublicOverride=IMVU.optionalProperty(a,"isPublicOverride",null);this.__initialState={name:this.__roomModel.get("name"),description:this.__roomModel.get("description"),supports_audience:this.__roomModel.get("supports_audience"),is_ap:this.__roomModel.get("is_ap"),is_vip:this.__roomModel.get("is_vip"),is_age_verified:this.__roomModel.get("is_age_verified"),is_friends_only:this.__roomModel.get("is_friends_only"),type:this.__roomModel.get("type"),capacity:Number(this.__roomModel.get("capacity")),language_code:this.__roomModel.get("language_code")||""};this.__currentState=_.clone(this.__initialState);this.__roomManagementInfo=this.track(this.__myself.getSingleEdge("room_management_info"));this.addToDOM()},__getCapacityChoices:function(){for(var a=[],c=!1,e=3;10>=e;e++){var d={capacity:e};e===this.__roomModel.get("capacity")&&(c=!0,d.selected=!0);a.push(d)}c||(_.find(a,function(h){return 10===h.capacity}).selected=!0);return a},__getLanguages:function(){var a=[],c=this.__roomModel.get("language_code")||"";Object.keys(g.LanguageMap).forEach(function(e){a.push({code:"all"===e?"":e,name:g.LanguageMap[e],selected:c===e})});return a},__renderRoomLoading:function(){this.setContent("body",'<div class="room-is-loading"></div>')},__renderRoomMetadata:function(){this.$(".room-is-loading").remove();this.__isPublic=null===this.__isPublicOverride?"listed"===this.__roomModel.get("type"):this.__isPublicOverride;this.setContent("body",g.template({isPrivate:"listed"!==this.__roomModel.get("type"),isPublic:this.__isPublic,isLiveRoom:this.__roomModel.get("supports_audience"),supports_audience:this.__roomModel.get("supports_audience"),isAccessPassRequired:this.__roomModel.get("is_ap")||"AP"===this.__roomModel.get("content_rating"),is_vip:this.__roomModel.get("is_vip"),is_age_verified:this.__roomModel.get("is_age_verified"),is_friends_only:this.__roomModel.get("is_friends_only"),name:this.__roomModel.get("name"),description:this.__roomModel.get("description"),descriptionMaxLength:this.DESCRIPTION_MAX_LENGTH,rendered_image:this.__roomModel.get("rendered_image"),join_room_url:this.__roomModel.get("join_room_url"),capacityChoices:this.__getCapacityChoices(),languages:this.__getLanguages()}));this.setContent("footer",g.footerTemplate);this.__isPublicOverride&&(this.$(".dialog-footer .save").expect(1).prop("disabled",!1),this.__newRoomType="listed");var a=this.$(".room-name");g.NextUtil.DomHelper.enhanceTextarea(a,this.ROOM_NAME_MAX_LENGTH,44);a=this.$(".room-description").expect(1);g.NextUtil.DomHelper.enhanceTextarea(a,this.DESCRIPTION_MAX_LENGTH,175);this.capacityDropdown=this.createChildContext(g.Dropdown,{$replaceElement:this.$("select.room-capacity").expect(1)});this.languageDropdown=this.createChildContext(g.Dropdown,{$replaceElement:this.$("select.room-language").expect(1)});var c=this.$(".room-thumbnail").expect(1);this.__imageManager.load(c,c.attr("data-url")).then(function(){c.removeAttr("data-url")}.bind(this))},__renderRoomModerators:function(){void 0!==this.__roomModeratorList&&(this.__roomModeratorList.delete(),this.$(".room-moderators-wrapper").append('<div class="room-moderator-list-placeholder"><div class="moderators-are-loading"></div></div>'));var a=void 0!==this.__selectedRoomModeratorsCollection?this.__selectedRoomModeratorsCollection:this.__roomModerators;this.__roomModeratorList=this.createChildContext(g.RoomAdminsListPresenter,{$replaceElement:this.$(".room-moderator-list-placeholder").expect(1),collection:a})},__maybeForceAccessPassEntryRequirement:function(){return new this.__Promise(function(a){var c="inventory"===this.__roomModel.get("type"),e="AP"===this.__roomModel.get("content_rating"),d=this.__roomModel.get("is_ap");e&&!d?(this.__roomModel.set("is_ap",!0),this.__roomModel.patch(["is_ap"],{success:function(){this.__initialState.is_ap=!0;a.resolve()}.bind(this),error:function(h,f,k){c&&"ROOM-NODE-005"===h.error?this.__roomModel.invalidate():(h=this.__roomUtilArgs({error:h,xhr:f,options:k}),g.NextUtil.RoomUtil.handlePatchErrors(h));a.resolve()}.bind(this)})):a.resolve()}.bind(this))},postRender:function(){this.__renderRoomLoading();this.__roomModel.populated().then(function(){return this.__maybeForceAccessPassEntryRequirement()}.bind(this)).then(function(){this.__renderRoomMetadata();this.__roomModerators=this.track(this.__roomModel.getEdgeCollection("moderators"));this.__roomModerators.populated().then(function(){this.__renderRoomModerators()}.bind(this));void 0===this.__isPublic||this.__isPublic||this.$(".tabbed-panel .tab-content").expect(1).addClass("hidden");this.$(".tabbed-panel").scrollbar()}.bind(this))},__chooseRoomPrivacy:function(){var a=this.$(".toggle-public-room-input").expect(1).prop("checked"),c=this.$(".tabbed-panel .tab-content").expect(1);this.__maybeDisableSaveButton();a?(c.removeClass("hidden"),this.__newRoomType="listed",this.__roomManagementInfo.invalidate(),this.__roomManagementInfo.populated().then(function(e){var d="listed"===this.__roomModel.get("type"),h=e.get("used_room_slot_count"),f=e.get("total_room_slot_count");if(!d&&h>=f){this.$(".dialog-footer .save").expect(1).prop("disabled",!0);this.__recordEvent("shown",{name:"upsell_dialog_shown",upsell_type:"chat_room_slot"});var k=this.__dialogManager.showDialog(g.ChatRoomSlotUpsellDialog,{afterAction:"closeToEditRoomSettings"});k.finished.then(function(){k.close();this.__roomManagementInfo.invalidate()}.bind(this)).catch(function(){f<e.get("total_room_slot_count")?this.$(".toggle-public-room-input").expect(1).prop("checked",!0):(this.$(".toggle-public-room-input").expect(1).prop("checked",!1),c.addClass("hidden"))}.bind(this));return k}}.bind(this))):(c.addClass("hidden"),this.__newRoomType="inventory")},__saveRoomPrivacy:function(){return new this.__Promise(function(a){if(this.__newRoomType)return this.__roomModel.save({type:this.__newRoomType}).then(function(){this.__initialState.type=this.__newRoomType;this.__newRoomType=null;a.accept()}.bind(this)).catch(function(c){a.reject();var e=this.__globalStringManager.getWithDefault("ERROR."+c.error,"unknown");"unknown"!==e?this.__errorToasterManager.add(e):(this.__errorToasterManager.add(this.__globalStringManager.get("default_room_error")),this.__window.console.error(c.error,c.message))}.bind(this));a.accept()}.bind(this))},__roomUtilArgs:function(a){return _.extend({globalStringManager:this.__globalStringManager,errorToasterManager:this.__errorToasterManager,window:this.__window,Promise:this.__Promise,roomModel:this.__roomModel},a)},__handleSaveRoomSettings:function(a){this.__roomModel.get("supports_audience")&&this.__roomModel.get("is_ap")!==this.$(".toggle-ap-input").expect(1).prop("checked")?this.__confirmSettingsChange().then(function(){this.__saveRoomSettings(a)}.bind(this)):this.__saveRoomSettings(a)},__confirmSettingsChange:function(){var a=this.$(".toggle-ap-input").expect(1).prop("checked")?this.__stringManager.get("live_room_ap_settings_change_dialog_GA_text"):this.__stringManager.get("live_room_ap_settings_change_dialog_AP_text");return new this.__Promise(function(c){return this.__dialogManager.confirm({title:this.__stringManager.get("live_room_ap_settings_change_dialog_title"),text:a,no:this.__stringManager.get("CANCEL"),yes:this.__stringManager.get("OKAY")}).finished.then(function(){return c.accept()}.bind(this)).catch(function(){return c.reject()}.bind(this))}.bind(this))},__saveRoomSettings:function(a){var c,e=function(d,h){this.__initialState[d]!==this.__currentState[d]&&(this.__roomModel.set(d,h),c.push(d),this.__recordEvent("change",{name:"edit_room_settings_toggle",setting_changed:d,changed_to:h}))}.bind(this);return this.__saveRoomPrivacy().then(function(){var d=function(h){return g.NextUtil.RoomUtil.newEditPromise(this.__roomUtilArgs({setup:h}))}.bind(this);d(function(){c=[];this.$(".toggle-public-room-input").expect(1).prop("checked")&&e("type","listed");return c}.bind(this)).then(function(){return d(function(){c=[];e("name",this.$(".room-name").expect(1).val());e("description",this.$(".room-description").expect(1).val());e("is_ap",this.$(".toggle-ap-input").expect(1).prop("checked"));e("is_vip",this.$(".toggle-vip-input").expect(1).prop("checked"));e("is_age_verified",this.$(".toggle-age-verified-input").expect(1).prop("checked"));e("is_friends_only",this.$(".toggle-friends-only-input").expect(1).prop("checked"));e("capacity",Number(this.capacityDropdown.val()));e("language_code",this.$("select.room-language").expect(1).val());e("supports_audience",this.$(".toggle-live-input").expect(1).prop("checked"));return c}.bind(this))}.bind(this)).then(function(){this.__saveRoomModerators()}.bind(this)).then(function(){this.promiseResolver.resolve(this.__roomModel);this.__roomManagementInfo.invalidate()}.bind(this))}.bind(this))},__maybeDisableSaveButton:function(){this.__currentState={name:this.$(".room-name").expect(1).val(),description:this.$(".room-description").expect(1).val(),supports_audience:this.$(".toggle-live-input").expect(1).prop("checked"),is_ap:this.$(".toggle-ap-input").expect(1).prop("checked"),is_vip:this.$(".toggle-vip-input").expect(1).prop("checked"),is_age_verified:this.$(".toggle-age-verified-input").expect(1).prop("checked"),is_friends_only:this.$(".toggle-friends-only-input").expect(1).prop("checked"),type:this.__newRoomType,capacity:Number(this.capacityDropdown.val()),language_code:this.$("select.room-language").expect(1).val()};var a=JSON.stringify(this.__currentState),c=JSON.stringify(this.__initialState),e=this.$(".toggle-live-input").expect(1).prop("checked"),d=this.$(".toggle-vip-input").expect(1).prop("checked"),h=this.$(".toggle-friends-only-input").expect(1).prop("checked"),f=this.$(".toggle-ap-input").expect(1).prop("checked"),k=this.$(".toggle-age-verified-input").expect(1).prop("checked");e&&this.__initialState.supports_audience!==this.__currentState.supports_audience&&this.__maybeUpsellHostSub();d&&this.__initialState.is_vip!==this.__currentState.is_vip&&this.__maybeUpsellVip(".toggle-vip-input");h&&this.__initialState.is_friends_only!==this.__currentState.is_friends_only&&this.__maybeUpsellVip(".toggle-friends-only-input");f&&this.__initialState.is_ap!==this.__currentState.is_ap&&this.__maybeUpsellAp();k&&this.__initialState.is_age_verified!==this.__currentState.is_age_verified&&this.__maybeUpsellAgeVerification();"inventory"===this.__currentState.type&&this.__currentState.type===this.__initialState.type?this.$(".dialog-footer .save").expect(1).prop("disabled",!0):this.$(".dialog-footer .save").expect(1).prop("disabled",c===a)},__chooseModerators:function(){this.__dialogManager.showDialog(g.RoomModeratorDialog,{moderators:this.__roomModerators}).finished.then(function(a){this.$(".dialog-footer .save").expect(1).prop("disabled",!1);this.__selectedRoomModeratorsCollection=new IMVU.NamedCollection;a.forEach(function(c){this.__selectedRoomModeratorsCollection.add(c)}.bind(this));this.__renderRoomModerators()}.bind(this))},__saveRoomModerators:function(){var a,c=new this.__Promise(function(e){a=e});if(void 0===this.__selectedRoomModeratorsCollection)return a.resolve(),c;this.__roomModerators.populated().then(function(){if(this.__selectedRoomModeratorsCollection.length)return this.__Promise.every(this.__selectedRoomModeratorsCollection.map(function(d){for(var h=0;h<this.__roomModerators.length;h++){var f=this.__roomModerators.at(h);this.__removeModerator(f.node)&&f.edge.destroy()}if(!this.__removeModerator(d))return this.__roomModerators.create({id:d.id}).catch(function(k){k=k.error;var m=this.__globalStringManager.getWithDefault("ERROR."+k.error,"unknown",{displayname:d.get("display_name")});"unknown"!==m?this.__errorToasterManager.add(m):(this.__errorToasterManager.add(this.__globalStringManager.get("default_room_error")),this.__window.console.error(k.error,k.message))}.bind(this))}.bind(this))).then(function(){a.resolve()}.bind(this)).catch(function(){a.reject()}.bind(this));for(var e=0;e<this.__roomModerators.length;e++)this.__roomModerators.at(e).edge.destroy();a.resolve()}.bind(this));return c},__removeModerator:function(a){var c=!0;this.__selectedRoomModeratorsCollection.forEach(function(e){e.id===a.id&&(c=!1)}.bind(this));return c},__maybeUpsellHostSub:function(){this.$(".toggle-public-room-input").expect(1).prop("checked")&&(this.__roomManagementInfo.invalidate(),this.__roomManagementInfo.populated().then(function(a){var c="undefined"===typeof a.get("audience_tokens_total")||a.get("audience_tokens_total")<=a.get("audience_tokens_used");if(3===a.get("audience_tokens_total")&&3===a.get("audience_tokens_used"))this.__dialogManager.alert({title:this.__globalStringManager.get("host_sub_max_tokens_used_title"),text:this.__globalStringManager.get("host_sub_max_tokens_used_body"),ok:this.__globalStringManager.get("host_sub_max_tokens_used_success")}).finished.then(function(){this.$(".toggle-live-input").expect(1).prop("checked",!1)}.bind(this));else if(c){var e=a.get("audience_tokens_total")?a.get("audience_tokens_total"):0;this.__recordEvent("shown",{name:"upsell_dialog_shown",upsell_type:"vip"});a=this.__dialogManager.showDialog(g.MultiCartUpsellDialog,{upsellProduct:"vip",contextual:!0,afterAction:"closeToEditRoomSettings"});a.finished.then().catch(function(){this.__roomManagementInfo.invalidate();this.__roomManagementInfo.populated().then(function(d){d=d.get("audience_tokens_total");e<d?this.$(".toggle-live-input").expect(1).prop("checked",!0):this.$(".toggle-live-input").expect(1).prop("checked",!1)}.bind(this))}.bind(this));return a}}.bind(this)))},__maybeUpsellVip:function(a){this.$(".toggle-public-room-input").expect(1).prop("checked")&&this.__myself.populated().then(function(){var c=!this.__myself.get("is_vip"),e=this.__getPurchasedVip();if(c&&e)this.__dialogManager.alert({title:this.__globalStringManager.get("Processing"),text:this.__globalStringManager.get("vip_purchase_pending_body"),ok:this.__globalStringManager.get("OKAY")}).finished.then(function(){this.__myself.invalidate();this.__myself.populated().then(function(){this.$(a).expect(1).prop("checked",!1)}.bind(this))}.bind(this));else if(c&&!e)return this.__recordEvent("shown",{name:"upsell_dialog_shown",upsell_type:"vip"}),c=this.__dialogManager.showDialog(g.MultiCartUpsellDialog,{upsellProduct:"vip",vipTrigger:"edit_room",contextual:!0,afterAction:"closeToEditRoomSettings"}),c.finished.then().catch(function(){this.__myself.invalidate();this.__myself.populated().then(function(){this.__myself.get("is_vip")?this.$(a).expect(1).prop("checked",!0):this.$(a).expect(1).prop("checked",!1)}.bind(this))}.bind(this)),c}.bind(this))},__getPurchasedVip:function(){var a=localStorage.getItem("is_vip");if(!a)return!1;a=JSON.parse(a);return(new Date).getTime()>a.expiry?(localStorage.removeItem("is_vip"),!1):a.value},__maybeUpsellAp:function(){this.$(".toggle-public-room-input").expect(1).prop("checked")&&this.__myself.populated().then(function(){if(!this.__myself.get("is_ap")){this.__recordEvent("shown",{name:"upsell_dialog_shown",upsell_type:"ap"});var a=this.__dialogManager.showDialog(g.MultiCartUpsellDialog,{upsellProduct:"ap",contextual:!0,afterAction:"closeToEditRoomSettings"});a.finished.then().catch(function(){this.__myself.invalidate();this.__myself.populated().then(function(){this.__myself.get("is_ap")?this.$(".toggle-ap-input").expect(1).prop("checked",!0):this.$(".toggle-ap-input").expect(1).prop("checked",!1)}.bind(this))}.bind(this));return a}}.bind(this))},__maybeUpsellAgeVerification:function(){this.$(".toggle-public-room-input").expect(1).prop("checked")&&this.__myself.populated().then(function(){if(!this.__myself.get("is_ageverified")){this.__recordEvent("shown",{name:"upsell_dialog_shown",upsell_type:"age_verification"});var a=this.__dialogManager.showDialog(g.MultiCartUpsellDialog,{upsellProduct:"age_verification",contextual:!0,afterAction:"closeToEditRoomSettings"});a.finished.then().catch(function(){this.__myself.invalidate();this.__myself.populated().then(function(){this.__myself.get("is_ageverified")?this.$(".toggle-age-verified-input").expect(1).prop("checked",!0):this.$(".toggle-age-verified-input").expect(1).prop("checked",!1)}.bind(this))}.bind(this));return a}}.bind(this))},close:function(){b.prototype.close.call(this)}})}({Dialogs:l["@Dialogs"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],AddRoomDialog:me,ChatRoomSlotUpsellDialog:Zd,Dropdown:G,LanguageMap:l["json!/common/js/JSON/LanguageMap.json"],MultiCartUpsellDialog:H,RoomAdminsListPresenter:Xd,RoomModeratorDialog:Ea,footerTemplate:ae,template:Ud}),oe=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=this.escapeExpression;return"\r\n            "+c((d=a.language||b&&b.language,"function"===typeof d?d.call(b,{name:"language",hash:{},data:e}):d))+"\r\n        "},3:function(b,a,c,e){var d,h=a.helperMissing;c="\r\n            ";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Any",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"\r\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='<fieldset class="hostbar">\r\n</fieldset>\r\n<fieldset>\r\n    <legend class="system-info-header">'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"LANGUAGE",{name:"i18n-g",hash:{},data:e})))+'</legend>\r\n    <section class="language flex-vc">\r\n        <div class="icon"></div>\r\n        <span>\r\n        ',k=a["if"].call(b,b&&b.language,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(k||0===k)f+=k;return f+'\r\n        </span>\r\n    </section>\r\n</fieldset>\r\n<fieldset>\r\n    <legend class="system-info-header">'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"OCCUPANCY",{name:"i18n-g",hash:{},data:e})))+'</legend>\r\n    <section class="occupancy flex-vc">\r\n        <div class="icon"></div>\r\n        <span class="occupants-row">\r\n            <span class="occupants">'+h((d=a.occupancy||b&&b.occupancy,"function"===typeof d?d.call(b,{name:"occupancy",hash:{},data:e}):d))+'</span><span class="capacity">/'+h((d=a.capacity||b&&b.capacity,"function"===typeof d?d.call(b,{name:"capacity",hash:{},data:e}):d))+'</span>&nbsp;<span class="users-word"></span>\r\n        </span>\r\n    </section>\r\n</fieldset>\r\n<fieldset>\r\n    <legend class="system-info-header">'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"DESCRIPTION",{name:"i18n-g",hash:{},data:e})))+'</legend>\r\n    <section class="description">'+h((d=a.description||b&&b.description,"function"===typeof d?d.call(b,{name:"description",hash:{},data:e}):d))+'</section>\r\n</fieldset>\r\n<fieldset>\r\n    <legend class="system-info-header">'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"PARTICIPANTS",{name:"i18n-g",hash:{},data:e})))+"</legend>\r\n    <section class='chat-participants'></section>\r\n</fieldset>\r\n"},useData:!0})}({}),pe=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<span class="by-line-text">\n    <span class="username"></span>\n</span>\n'},useData:!0})}({}),qe=function(g){var b=g.UiCore.UiContext;return b.extend("ByLineWidget",{className:"by-line-widget",uiContextName:"bylinewidget",tagName:"div",dependencies:["model","verbBy"],initialize:function(a){b.prototype.initialize.call(this,a);this.__hideOnlineStatus=!!a.hideOnlineStatus;this.__ignoreClicks=!!a.ignoreClicks;this.__hideUsername=a.hasOwnProperty("hideUsername")?a.hideUsername:!0;this.__verbBy=IMVU.optionalProperty(a,"verbBy",null);this.addToDOM()},render:function(){this.$el.html(g.template());this.__dualName=this.createChildContext(g.WAFWidgets.DualName,{$replaceElement:this.$(".username"),user:this.model,hideIcon:!1,size:"medium",hideDisplay:!1,displayArgs:{size:"small",color:"dark",prefix:this.__verbBy},hideAtAvatar:this.__hideUsername,atAvatarArgs:{size:"small",color:"medium"}})}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],template:pe}),re=function(g){var b=g.SafetyReportDialog;return b.extend("ReportRoomDialog",{uiContextName:"report_room_dialog",className:"report-room-dialog",dependencies:"dialogManager featureAccessManager globalStartupModel globalStringManager MediaManager restModelFactory youTubeSyncedMediaManager".split(" "),title:"report_room_title",text:"report_room_text",initialize:function(a){var c=this;this.dropdownOptions=[{label:"report_room_reason_name",value:"name"},{label:"report_room_reason_description",value:"description"},{label:"report_room_reason_photo",value:"photo"}];this.__featureAccessManager=a.featureAccessManager;this.__youTubeSyncedMediaManager=a.youTubeSyncedMediaManager;this.__vivoxMediaManager=a.MediaManager;this.__model=a.model;(this.__mediaPlayersCollection=(this.__hangoutExperience=this.__model.relations.hangout_experience?this.__model.getSingleEdge("hangout_experience"):null)&&this.__hangoutExperience.relations.media_players?this.__hangoutExperience.getEdgeCollection("media_players",g.UiCore.EdgeCollection):null)&&this.__mediaPlayersCollection.populated().then(function(e){e.each(function(d){d.populated().then(function(h){var f="playing"===h.get("current_state.status")||3e5>Date.now()-c.__vivoxMediaManager.getLiveAudioStopTime();c.__featureAccessManager.canSeeVivox()&&"vivox"===h.get("type.provider")&&f&&c.dropdownOptions.unshift({label:"report_room_reason_audio",value:"audio"});f=c.__youTubeSyncedMediaManager.isVideoPlayingForGuest()||3e5>Date.now()-c.__youTubeSyncedMediaManager.getLastVideoStopTime();c.__featureAccessManager.canSeeYouTubePreRecorded()&&"youtube"===h.get("type.provider")&&f&&c.dropdownOptions.unshift({label:"report_room_reason_youtube",value:"youtube_prerecorded"})})})});this.__dialogManager=a.dialogManager;this.__restModelFactory=a.restModelFactory;this.__startupModel=a.globalStartupModel;this.__stringManager=a.globalStringManager;this.__promise=a.Promise;this.__safetyReportUrl=this.__startupModel.get("safetyReportUrl");a=_.extend({title:this.__stringManager.get(this.title),text:this.__stringManager.get(this.text),ok:this.__stringManager.get("report_ok_button"),termsOfService:!0,dropdown:{placeholder:this.__stringManager.get("report_reason_placeholder"),options:_.map(this.dropdownOptions,function(e){return{label:this.__stringManager.get(e.label),value:e.value}}.bind(this))}},a);b.prototype.initialize.call(this,a)},postRender:function(){b.prototype.postRender.call(this)},close:function(){b.prototype.close.call(this)}})}({UiCore:l["@UiCore"],SafetyReportDialog:E}),se=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="profile-icon-placeholder"></div>\r\n'},useData:!0})}({}),te=function(g){function b(c,e){var d=c.get("bootstrapParams").is_app;c.get("window").open(e,d?"_system":"_blank")}function a(c){return-1!==c.indexOf("iPad")||-1!==c.indexOf("iPhone")||-1!==c.indexOf("iPod")}return{openExternal:b,externalizeA:function(c,e){e=$(e);var d=e.attr("href");e.attr("href","");e.click(function(){b(c,d);return!1})},isAndroid:function(c){return-1!==c.get("window").navigator.userAgent.indexOf("Android")},isAndroidChrome:function(c){c=c.get("window").navigator.userAgent;return-1!==c.indexOf("Android")&&-1!==c.indexOf("Chrome/")&&-1===c.indexOf("Version/")},isAndroidWebApp:function(c){c=c.get("window");return-1!==c.navigator.userAgent.indexOf("Android")&&c.navigator.standalone?!0:!1},isIOS:function(c){c=c.get("window").navigator.userAgent;return a(c)},isIOSSafari:function(c){c=c.get("window").navigator.userAgent;return a(c)&&-1===c.indexOf("CriOS/")?-1!==c.indexOf("Safari/")?!0:-1!==c.indexOf("AppleWebKit/")&&-1===c.indexOf("Chrome/"):!1},getVersionIOS:function(c){c=c.get("window").navigator.userAgent;return a(c)?(c=/(iphone|ipad)(; CPU)? OS ((\d+)_(\d+)(_(\d+))?)/i.exec(c),null===c?null:{raw:c[3],major:parseInt(c[4],10),minor:parseInt(c[5],10),revision:c[7]?parseInt(c[7],10):null}):null}}}({}),ue=function(g){var b=g.UiCore.UiContext;return b.extend("DetailParticipantListItem",{uiContextName:"detail_participant_list_item",className:"detail-participant-list-item",tagName:"li",dependencies:["loginManager"],initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},delete:function(){this.__profileIcon.delete();b.prototype.delete.call(this)},render:function(){this.model.populated().then(function(){this.$el.html(g.template());this.__profileIcon=this.createChildContext(g.WAFWidgets.ProfileIcon,{$replaceElement:this.$(".profile-icon-placeholder"),user:this.model.node});g.MobileBrowser.isIOS(this.__serviceProvider)}.bind(this))}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],MobileBrowser:te,template:se}),ve=function(g){var b=g.WAFWidgets.EdgeCollectionPresenter;return b.extend("DetailParticipantList",{uiContextName:"detail_participants_list",className:"detail-participant-list",tagName:"ul",itemFactory:g.DetailParticipantListItem,initialize:function(a){this.itemFactory=a.itemFactory||this.itemFactory;b.prototype.initialize.call(this,a)}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],DetailParticipantListItem:ue}),we=function(g){return{dependencies:"contextMenuManager dialogManager featureAccessManager globalStringManager googleAnalytics modeManager Promise protocolLinksManager".split(" "),isMyRoom:function(){return this.__roomModel.relations.owner===this.__myself.id},__getPrimaryAction:function(){var b=!!this.__roomModel.relations.chat,a=b?this.__serviceProvider.get("activeChats").has(this.__roomModel.getSingleEdge("chat"))?"SHOW ROOM":"JOIN ROOM":"CLOSED";return this.options.hideJoinButton?null:{key:"join",text:this.__globalStringManager.get(a),handler:this.__joinClicked.bind(this),disabled:!b}},__getSecondaryActions:function(){return[this.__featureAccessManager.canEditScenes()&&this.isMyRoom()?{key:"edit",text:this.__globalStringManager.get("EDIT ROOM"),handler:this.__onEditRoom.bind(this),disabled:!1}:{key:"more",text:this.__globalStringManager.get("MORE"),handler:this.__onShowActionMenu.bind(this),disabled:this.isMyRoom()},this.__roomModel.relations.viewer_favorite_room?{key:"favorited",text:this.__globalStringManager.get("FAVORITED"),handler:this.__onToggleFavorite.bind(this,!1),disabled:!1}:{key:"favorite",text:this.__globalStringManager.get("FAVORITE"),handler:this.__onToggleFavorite.bind(this,!0),disabled:!1}]},__onEditRoom:function(b){this.__protocolLinksManager.handleProtocolLink({evt:b,currentSubmode:this.__subMode,parent:this.__parent,model:this.__roomModel,mode:{id:"decorate"},submode:{id:this.__roomModel.relations.scene}})},__onShowActionMenu:function(b){b.stopPropagation();var a=[];this.isMyRoom()||a.push({name:"report",text:this.__globalStringManager.get("Report"),handler:this.__reportAction.bind(this)});this.__contextMenuManager.toggleMenu(b,g.ContextMenu,{items:a,displayOptions:{above:!1,right:!0}})},__reportAction:function(){this.__dialogManager.showDialog(g.ReportRoomDialog,{model:this.__roomModel})},__showOwner:function(){this.__hostedByBlock=this.createChildContext(g.ByLineWidget,{$parentElement:this.$(".hostbar"),model:this.track(this.__roomModel.getSingleEdge("owner")),verbBy:this.__globalStringManager.get("Hosted by")})},__showOccupants:function(){if(this.__roomModel.relations.chat){var b=this.track(this.__roomModel.getSingleEdge("chat"));b.populated().then(function(){return this.track(b.getEdgeCollection("participants")).populated()}.bind(this)).then(function(a){this.createChildContext(g.DetailParticipantList,{collection:a,$parentElement:this.$(".chat-participants"),showProfileIconOnly:!0});var c=function(){this.$("span.occupants").text(a.total_count);this.$("span.users-word").text(this.__globalStringManager.getPluralized("occupancy_user",{howMany:a.total_count}))}.bind(this);this.listenTo(a,"change:relations",c);c()}.bind(this))}},__commonRender:function(b){this.__roomModel.getSingleEdge("scene").populated().then(function(a){this.setForeground(IMVU.URI.build(b.get("rendered_image"),{width:this.__backgroundWidth,height:this.__backgroundHeight,cb:a.relations.shell_product}))}.bind(this));this.setTitle(b.get("name"));this.__imageManager.loadAsBackgroundImage(this.$(".profile-icon, .user-cover-image"),b.get("themed_image_url")||b.get("image_url"));this.setInfo(g.template(b.toJSON()));"private"===b.get("privacy")&&this.$("span.capacity").hide();this.setShields(_.filter([b.get("is_ap")?"ap":null,b.get("is_vip")?"vip":null]));this.__showOwner();this.setActions(this.__getPrimaryAction(),this.__getSecondaryActions());"private"===b.get("privacy")&&this.$(".btn-primary").attr("disabled","disabled");this.listenTo(this.__roomModel,"change:relations",this.__onFavoriteRoomChange);this.__showOccupants()},__onFavoriteRoomChange:function(b,a){a.viewer_favorite_room!=b.viewer_favorite_room&&this.setActions(this.__getPrimaryAction(),this.__getSecondaryActions())},__onToggleFavorite:function(b){return b?this.__myself.getEdgeCollection("favorite_rooms").create({id:this.__roomModel.id}):this.__roomModel.getSingleEdge("viewer_favorite_room",g.UiCore.EdgeModel).destroy()},__joinClicked:function(){this.__roomModel.get("occupancy")>=this.__roomModel.get("capacity")?this.__dialogManager.alert({title:this.__globalStringManager.get("Room Full"),text:this.__globalStringManager.get("This room is currently full"),ok:this.__globalStringManager.get("OK")}):(this.__googleAnalytics.recordEnterChatRoom(this.__roomModel.id),this.__joinRoom())}}}({UiCore:l["@UiCore"],ByLineWidget:qe,ContextMenu:t,DetailParticipantList:ve,ReportRoomDialog:re,template:oe}),xe=function(g){return{mixin:function(){var b=$jscomp.getRestArguments.apply(0,arguments),a=b[0],c=[],e=function(){for(var f=$jscomp.getRestArguments.apply(0,arguments),k=c.length;0<k--;)c[k].apply(this,f)},d=[],h=function(){for(var f=$jscomp.getRestArguments.apply(0,arguments),k=[],m=d.length;0<m--;)k=k.concat(d[m].apply(this,f));return k};_.each(b,function(f){f.initialize&&c.push(f.initialize);f.trackedEvents&&d.push(f.trackedEvents);if(f!==a){var k=a.dependencies||[];_.each(f.dependencies,function(m){-1===_.indexOf(k,m)&&k.push(m)});k.sort();_.extend(a,f,{dependencies:k})}});c.length&&(a.initialize=1<c.length?e:c[0]);d.length&&(a.trackedEvents=1<d.length?h:d[0]);return a}}}({}),ye=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<div class="icon-wrapper">';if((a=(d=a.icon||b&&b.icon||h,d.call(b,"icon-speaker",{name:"icon",hash:{},data:e})))||0===a)c+=a;return c+"</div>"},useData:!0})}({}),ze=function(g){var b=g.UiCore.UiContext;return b.extend("audioIcon",{className:"audio-icon",uiContextName:"audio_icon",dependencies:["window"],initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},delete:function(){b.prototype.delete.call(this)},render:function(){this.$el.html(g.template({}))}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:ye}),Ae=function(g){var b=g.UiCore.UiContext,a=b.extend("RoomDetailWidgetHeadpiece",{className:"room-detail-widget-headpiece",uiContextName:"room_detail_widget_headpiece",dependencies:"browserInfo dialogManager externalWindow featureAccessManager globalNav globalStringManager loginManager modeManager onboardingGamificationManager Promise protocolLinksManager roomModel roomsModeStringManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".join",name:"join_room_click",handler:this.__joinRoom.bind(this),attributes:function(c){return{which:c.attr("data-room-type")}}},{type:"click",selector:".settings .icon-settings",name:"settings",handler:"__showSettings"},{type:"click",selector:".decorate",name:"decorate",handler:"__decorate"},{type:"click",selector:".invite",name:"clicked_invite",handler:"__handleInvite"},{type:"click",selector:".favorite",name:"clicked_favorite",handler:"__recordEventFavorite"},{type:"click",selector:".favorited",name:"clicked_favorited",handler:"__recordEventFavorited"},{type:"click",selector:".vip-badge",name:"vip_badge_clicked",handler:"__handleVipBadgeClick"}]},__decorate:function(c){this.__isLoggedIn?(this.__featureAccessManager.canSeeOnboardingGamification()&&this.__onboardingGamificationManager.handleTaskCompletion("chat_decorate"),this.__protocolLinksManager.handleProtocolLink({evt:c,currentSubmode:this.__subMode,parent:this.__parent,model:this.__roomModel,mode:{id:"decorate"},submode:{id:this.__roomModel.relations.scene}})):this.__loginOverride(this.__isLoggedIn)},__maybeGoToLink:function(c,e){(this.__roomModel.relations.partner?this.__Promise.resolve():this.__dialogManager.confirm({title:this.__globalStringManager.get("finish_"+e+"_setup_title"),text:this.__globalStringManager.get("finish_"+e+"_setup_text"),no:this.__globalStringManager.get("Cancel"),yes:this.__globalStringManager.get("finish_"+e+"_setup_button")}).finished).then(function(){this.__electronSensitiveWindowOpener(c,"_blank")}.bind(this),function(){})},__showSettings:function(){switch(this.__roomModel.get("type")){case"shared":this.__maybeGoToLink("https://www.imvu.com/shared_rooms/","shared");break;case"marriage":this.__maybeGoToLink("https://www.imvu.com/marriage/","marriage");break;default:var c=this.__roomModel.get("privacy");this.__dialogManager.showDialog(g.EditRoomSettings,{model:this.__roomModel}).finished.then(function(){this.__roomModel.getEdgeCollection("moderators").invalidate();this.__roomModel.get("privacy")!==c&&(this.__isPrivate="private"===this.__roomModel.get("privacy"),this.render())}.bind(this))}},__getDetailsFromRoom:function(){this.__roomID=this.__roomModel.id;this.__roomIsAP=this.__roomModel.get("is_ap");this.__roomDescription=this.__roomModel.get("description");this.__roomImage="private"===this.__roomModel.get("privacy")?this.__roomModel.get("rendered_image")||this.roomModel.get("themed_image_url"):this.__roomModel.get("rendered_image")||this.__roomModel.get("image_url")||this.__roomModel.get("themed_image_url");this.__roomName=this.__roomModel.get("name");this.__roomOwnerCID=this.__roomModel.get("customers_id");this.__roomIsVIP=this.__roomModel.get("is_vip")},__tooltipKey:function(c){return this.__isLoggedIn?c:"login_more"},__isMyRoom:function(){return this.__myself&&this.__myself.id===this.__roomModel.relations.owner},__isPartnerViewing:function(){return this.__myself&&this.__myself.id===this.__roomModel.relations.partner},initialize:function(c){var e=this;b.prototype.initialize.call(this,c);this.__isLoggedIn=this.__loginManager.isLoggedIn();this.__subMode="undefined"===typeof c.subMode?null:c.subMode;this.__parent="undefined"===typeof c.parent?null:c.parent;this.__chatModel=null;this.__isChatNowRoom=IMVU.optionalProperty(c,"isChatNowRoom",!1);this.__isActiveChat=IMVU.optionalProperty(c,"isActiveChat",!1);this.__isChatNowRoom&&(this.__chatNowRequest=IMVU.optionalProperty(c,"chatNowRequest",null));this.track(this.__roomModel);this.__myself=this.__isLoggedIn?this.__loginManager.getCurrentUser():null;this.__moreTooltipKey=this.__tooltipKey("more_options");this.__favoriteTooltipKey=this.__tooltipKey("Favorite");this.__inviteTooltipKey=this.__tooltipKey("Invite");this.__joinTooltipKey=this.__tooltipKey("join_room_prompt");this.__protocolLinksManager=c.protocolLinksManager;this.__isRecommended=IMVU.optionalProperty(c,"isRecommended",null);this.__featureAccessManager=c.featureAccessManager;this.__serviceProvider=c.serviceProvider;this.__serviceProvider.register("chatEvent","");this.__serviceProvider.register("chatModel",this.__roomModel);this.__serviceProvider.register("chatSubMode","");this.__serviceProvider.register("chatParent",this.__parent);this.__electronSensitiveWindowOpener=function(d,h,f){var k=this.__window;"_blank"===h&&(k=this.__externalWindow);k.open(d,h,f)};this.doWork([function(){return e.__roomModel.populated()},function(){e.__roomModel.is_recommended="undefined"===typeof e.__roomModel.is_recommended?!1:e.__roomModel.is_recommended;e.__isPublic="public"===e.__roomModel.get("privacy");e.__isPrivate="private"===e.__roomModel.get("privacy");e.__canInvite=e.__canInviteCheck();e.addToDOM();e.doWork([function(){return e.listenTo(e.__roomModel,"change",e.render.bind(e))}])}]).catch(function(d){e.__setAsRenderFailed("RoomDetailWidgetHeadpiece::initialize - failed")})},__canInviteCheck:function(){var c=this;if(_.contains(["marriage","shared"],this.__roomModel.get("type"))&&this.__roomModel.relations.partner)this.doWork([function(){return c.__roomModel.populated()},function(){var d=c.__roomModel.getSingleEdge("partner"),h=c.__roomModel.getSingleEdge("owner");e=c.__myself.get("legacy_cid")===d.get("legacy_cid")||c.__myself.get("legacy_cid")===h.get("legacy_cid")}]);else var e=this.__isPublic||this.__isPrivate&&this.__isMyRoom();return e},__findElements:function(){this.$row1Image=this.$(".first-row").find(".image-div");this.$row1ImageImg=this.$row1Image.find(".image-img");var c=this.$(".second-row"),e=c.find(".left-side");this.$row2LeftMore=e.find(".more");this.$row2LeftFav=e.find(".favorite");this.$row2LeftFaved=e.find(".favorited");this.$row2LeftShare=e.find(".share");this.$row2Over=c.find(".overlay")},__toggleFavoriteLocal:function(){this.__favorited=this.$row2LeftFav.is(".hidden");this.__onToggleFavorite(!this.__favorited).then(function(){(this.__favorited=!this.__favorited)?(this.$row2LeftFav.addClass("hidden"),this.$row2LeftFaved.removeClass("hidden")):(this.$row2LeftFav.removeClass("hidden"),this.$row2LeftFaved.addClass("hidden"))}.bind(this)).catch(function(){this.__window.console.error(arguments)}.bind(this))},__renderElements:function(){this.__isLoggedIn?(this.__viewImages=this.__roomIsAP?!!this.__myself.get("is_ap"):!0,this.__roomIsVIP&&(this.__viewImages=this.__myself.get("is_vip")),this.$el.addClass("logged-in").removeClass("not-logged-in")):(this.__viewImages=!this.__roomIsAP,this.$el.removeClass("logged-in").addClass("not-logged-in"));this.$row1ImageImg.attr("src",this.__roomImage);this.__viewImages?this.$row1Image.removeClass("hidden"):this.$row1Image.addClass("hidden");this.$(".name").expect(1).text(this.__roomName);this.$(".ap-badge").expect(1).toggleClass("hidden",!this.__roomIsAP);this.$(".vip-badge").expect(1).toggleClass("hidden",!this.__roomIsVIP);var c=this.__roomIsAP||this.__roomIsVIP;this.$(".first-row").expect(1).toggleClass("has-badges",!!c);this.$(".detail-status-icons").expect(1).toggleClass("hidden",!c);_.contains(["marriage","shared"],this.__roomModel.get("type"))?this.$(".share").expect(1).remove():this.__socialShare=this.createChildContext(g.WithmeWidgets.SocialShare,{$parentElement:this.$(".second-row .left-side .share"),linkToCopy:this.__roomModel.get("join_room_url")});this.__isLoggedIn?(this.$row2LeftMore.on("click",this.__onShowActionMenu.bind(this)),this.$row2LeftMore.prop("disabled",!1),this.$row2LeftFav.on("click",this.__toggleFavoriteLocal.bind(this)),this.$row2LeftFaved.on("click",this.__toggleFavoriteLocal.bind(this)),this.$row2LeftFav.prop("disabled",!1),this.$row2LeftFaved.prop("disabled",!1)):(this.$row2LeftMore.off("click",this.__onShowActionMenu.bind(this)),this.$row2LeftMore.prop("disabled",!0),this.$row2LeftMore.on("click",this.__loginOverride.bind(this)),this.$row2LeftFav.off("click",this.__toggleFavoriteLocal.bind(this)),this.$row2LeftFaved.off("click",this.__toggleFavoriteLocal.bind(this)),this.$row2LeftFav.prop("disabled",!0),this.$row2LeftFaved.prop("disabled",!0),this.$row2LeftFav.off("click",this.__onToggleFavorite.bind(this)),this.$row2LeftFaved.off("click",this.__onToggleFavorite.bind(this)),this.$row2LeftFav.on("click",this.__loginOverride.bind(this)),this.$row2LeftFaved.on("click",this.__loginOverride.bind(this)));this.__isSharedRoom="marriage"===this.__roomModel.get("type")||"shared"===this.__roomModel.get("type");(this.__showLikeButton=this.__isLoggedIn&&!this.__isSharedRoom&&!this.__isChatNowRoom)?this.__roomModel.relations.viewer_favorite_room?(this.$row2LeftFav.addClass("hidden"),this.$row2LeftFaved.removeClass("hidden")):this.__isPrivate||(this.$row2LeftFav.removeClass("hidden"),this.$row2LeftFaved.addClass("hidden")):(this.$row2LeftFav.addClass("hidden"),this.$row2LeftFaved.addClass("hidden"));this.__isLoggedIn&&this.$row2Over.addClass("hidden")},render:function(){var c=this;this.doWork([function(){c.__getDetailsFromRoom();var e=c.__isMyRoom()||c.__isPartnerViewing(),d="";d=c.__roomModel.get("is_recommended")?"recommended":c.__roomModel.get("supports_audience")?"live_room":"chat";c.$el.html(g.template({canEdit:e,isMoreDisabled:c.__isChatNowRoom||c.__isMyRoom()||c.__isPartnerViewing(),moreTooltipKey:c.__moreTooltipKey,favoriteTooltipKey:c.__favoriteTooltipKey,inviteTooltipKey:c.__inviteTooltipKey,joinTooltipKey:c.__joinTooltipKey,canInvite:c.__canInvite&&!c.__isChatNowRoom,isChatNowRoom:c.__isChatNowRoom,isActiveChat:c.__isActiveChat,canShare:!c.__isChatNowRoom&&!c.__isPrivate,roomType:d}));c.createChildContext(g.DistinguishStatus,{$parentElement:c.$el.find(".image-div"),model:c.__roomModel,position:"end-start small"});c.doWork([function(){return g.NextUtil.RoomUtil.hasJoined({user:c.__myself,room:c.__roomModel,Promise:c.__Promise})},function(){return c.$(".action-buttons .decorate").expect(1).toggleClass("hidden",!e)}]);c.__findElements();c.__renderElements();return c.__roomModel.populated()},function(){c.__isLoggedIn&&c.__roomModel.get("supports_audience")&&c.__roomModel.relations.hangout_experience&&c.__addAudienceCounter();c.__roomModel.get("has_audio")&&c.__featureAccessManager.canSeeVivox()?c.__addAudioIcon():c.__audioIcon&&c.__audioIcon.delete();c.__setAsRendered()}])},__addAudienceCounter:function(){this.__audienceCounter=this.createChildContext(g.audienceCounter,{$parentElement:this.$(".audience-counter-wrapper"),room:this.__roomModel})},__addAudioIcon:function(){this.__audioIcon=this.createChildContext(g.audioIcon,{$parentElement:this.$(".audience-counter-wrapper")})},__joinRoom:function(c){this.__recordEvent("click",{name:"room_detail_widget_headpiece__join",room_id:this.__roomModel.id,cid:this.__roomModel.get("customers_id"),isRecommended:this.__isRecommended});if(this.__isLoggedIn){if(this.__roomModel.get("supports_audience")){var e=this.__serviceProvider.get("subscriptionManager");e.setState({roomId:this.__roomModel.id,state:e.STATE_JOIN})}this.__isChatNowRoom?this.__featureAccessManager.canSeeAppLaunch()?(this.__serviceProvider.register("chatEvent",c),this.__modeManager.openMode({mode:{id:"download"},submode:{id:"applaunch",chatEvent:this.__serviceProvider.get("chatEvent"),chatParent:this.__serviceProvider.get("chatParent"),chatModel:this.__serviceProvider.get("chatModel"),chatSubMode:"chat_now"}})):this.__protocolLinksManager.handleProtocolLink({evt:c,currentSubmode:null,mode:{id:"chat"},submode:{id:"chat_now",chatNowRequest:this.__chatNowRequest}}):this.__featureAccessManager.canSeeAppLaunch()&&!this.__featureAccessManager.isMobile()?(this.__serviceProvider.register("chatEvent",c),this.__serviceProvider.register("chatSubMode",this.__subMode),this.__modeManager.openMode({mode:{id:"download"},submode:{id:"applaunch",chatEvent:this.__serviceProvider.get("chatEvent"),chatParent:this.__serviceProvider.get("chatParent"),chatModel:this.__serviceProvider.get("chatModel"),chatSubMode:this.__serviceProvider.get("chatSubMode")}})):this.__protocolLinksManager.handleProtocolLink({evt:c,currentSubmode:this.__subMode,parent:this.__parent,model:this.__roomModel,mode:{id:"chat"},submode:{id:this.__roomModel.id,forceJoin:!0,showAlways:!0}})}else this.__loginOverride(this.__isLoggedIn)},__recordEventFavorite:function(){this.__recordEvent("click",{name:"room_detail_widget_headpiece__favorite",room_id:this.__roomModel.id,cid:this.__roomModel.get("customers_id"),isRecommended:this.__isRecommended})},__recordEventFavorited:function(){this.__recordEvent("click",{name:"room_detail_widget_headpiece__favorited",room_id:this.__roomModel.id,cid:this.__roomModel.get("customers_id"),isRecommended:this.__isRecommended})},__handleInvite:function(c){this.__isLoggedIn?this.__dialogManager.showDialog(g.ChatInviteList,{roomModel:this.__roomModel}).finished.then(function(){this.__joinRoom(c)}.bind(this),function(){}.bind(this)):this.__loginOverride(this.__isLoggedIn)},__handleVipBadgeClick:function(){this.__dialogManager.showVipUpsellDialog({vipTrigger:"room_settings",vipTriggerLocation:this.__roomModel.get("supports_audience")?"live":"public"})},__loginOverride:function(){this.__isLoggedIn||this.__dialogManager.showLoginOrSignupDialog()}});g.Mixin.mixin(a.prototype,g.RoomDetailMixin);return a}({Model:l["@Model"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],WithmeWidgets:l["@WithmeWidgets"],audienceCounter:Ca,audioIcon:ze,ChatInviteList:I,DistinguishStatus:w,EditRoomSettings:ne,Mixin:xe,RoomDetailMixin:we,template:Td}),Be=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d,h=a.helperMissing;c='\n    <div class="scroll-row language">\n        <div class="title-line big-title">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Language",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+'</div>\n        <div class="lang-payload"></div>\n    </div>\n    '},3:function(b,a,c,e){var d,h=a.helperMissing;c='\n    <div class="scroll-row description">\n        <div class="title-line big-title">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Description",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+'</div>\n        <div class="des-payload"></div>\n    </div>\n    '},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="container">\n    <div class="scroll-row hosted-by-panel">\n        <div class="title-line big-title">',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Hosted by",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='</div>\n        <div class="hosted-by"></div>\n    </div>\n    ';if((f=a["if"].call(b,b&&b.publicRoom,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===f)h+=f;h+='\n    <div class="scroll-row occupancy">\n        <div class="title-line big-title">\n            <span class="occupancy-title">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Occupancy",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</span>\n            <span class="presenters-title hidden">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Presenters",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</span>\n            <span class="count-cap"></span>\n        </div>\n        <div class="line-up">\n            <div class="occupancy-profile-icon-grid-container"></div>\n            <button class="btn btn-tertiary full-width btn-show-audience-list hidden">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"live_room_room_detail_widget_all_audiance_cta",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</button>\n            <div class="logged-out-overlay">\n                <div class="login">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"join_login",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</div>\n            </div>\n        </div>\n    </div>\n    ";if((f=a["if"].call(b,b&&b.publicRoom,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)h+=f;h+='\n    <div class="scroll-row room-moderators hidden">\n        <h2 class="title-line big-title">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Room Moderators",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</h2>\n        <div class="line-up">\n            <div class="room-moderator-list-container"></div>\n            <div class="logged-out-overlay">\n                <div class="login">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"join_login",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+'</div>\n            </div>\n        </div>\n    </div>\n    <div class="scroll-row distinguish hidden"></div>\n</div>\n'},useData:!0})}({}),Ce=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="audience-list-item-presenter"></div>'},useData:!0})}({}),Fa=function(g){var b=g.Dialogs.AlloyConfirmDialog;return b.extend("RemoveUserDialog",{uiContextName:"remove_user_dialog",className:"remove-user-dialog",initialize:function(a){this.__globalStringManager=a.globalStringManager;this.__userToRemove=a.userToRemove;this.__activeChat=a.activeChat;a=_.extend({title:this.__globalStringManager.get("Remove User"),text:this.__globalStringManager.get("Confirm Remove Message"),yes:this.__globalStringManager.get("Remove"),no:this.__globalStringManager.get("dialog_message_cancel")},a);b.prototype.initialize.call(this,a)},__onConfirm:function(){this.__activeChat.bootFromChat(this.__userToRemove).then(function(){this.hide()}.bind(this)).catch(function(a){this.hide();return this.promiseResolver.reject(a)}.bind(this))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"]}),De=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="user-info"></div>\n\n'},useData:!0})}({}),Ga=function(g){var b=g.UiCore.UiContext;return b.extend("AudienceListItem",{className:"audience-list-item",uiContextName:"audience_list_item",dependencies:"dialogManager featureAccessManager globalStringManager imageManager loginManager model modeManager".split(" "),trackedEvents:function(){return[{type:"click",selector:".user-info .dual-name",name:"audience_item_show_profile",handler:this.__onClickAudience.bind(this)},{type:"click",selector:".user-info .boot-user",name:"audience_item_boot_user",handler:this.__onClickBoot.bind(this)}]},initialize:function(a){b.prototype.initialize.call(this,a);this.model=a.model;this.__parentDialog=a.parentDialog;this.addToDOM()},render:function(){this.$el.addClass("loading");this.model.populated().then(function(){var a=this;this.$el.html(g.template({}));var c=this.model,e=0<this.$(".user-info").length?".user-info":".username";this._dualName=this.createChildContext(g.WAFWidgets.DualName,{$parentElement:this.$(e),user:c,configuration:"large-dual-lightbg"});this.__loadImage();this.__parentDialog&&this.__parentDialog.showBootOption(c).then(function(d){d&&(d=a.__globalStringManager.get("Remove User"),a.$(e).append('<button class="btn-simple boot-user">'+d+"</div>"))});this.$el.removeClass("loading")}.bind(this)).catch(function(a){if(!a.contents||404!==a.contents.code)throw a})},__loadImage:function(a){a=this.model.get("thumbnail_url")||this.model.node.get("thumbnail_url");this.__imageManager.load(this.$(".cover-image"),a,{container:this.$el})},__onClickAudience:function(a){this.__user=void 0!==this.model.node?this.model.node:this.model;this.__ignoreClicks||(a.stopPropagation(),this.__user&&this.__user.populated().then(function(){this.__dialogManager.showLightbox("ProfileLightbox",{user:this.__user,activeChat:this.__activeChat})}.bind(this)))},__onClickBoot:function(a){this.__user=this.model;this.__ignoreClicks||(a.stopPropagation(),this.__user&&this.__parentDialog.removeUser(this.__user))}})}({Model:l["@Model"],UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],template:De}),L=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'<span class="tool-tip">?</span>'},3:function(b,a,c,e){var d;c=this.escapeExpression;return'<div class="tool-tip-content">'+c((d=a.toolTipContent||b&&b.toolTipContent,"function"===typeof d?d.call(b,{name:"toolTipContent",hash:{},data:e}):d))+"</div>"},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h='<div class="no-results notation">\n    <span class="standard-text">'+c((d=a.standard||b&&b.standard,"function"===typeof d?d.call(b,{name:"standard",hash:{},data:e}):d)),f=a["if"].call(b,b&&b.hasToolTip,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)h+=f;h+='</span>\n    <span class="concise-text">'+c((d=a.concise||b&&b.concise,"function"===typeof d?d.call(b,{name:"concise",hash:{},data:e}):d));if((f=a["if"].call(b,b&&b.hasToolTip,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===f)h+=f;h+="</span>\n    ";if((f=a["if"].call(b,b&&b.hasToolTip,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)h+=f;return h+"\n</div>"},useData:!0})}({}),Ee=function(g){var b=g.UiCore.ListPresenter;return b.extend("Audience",{uiContextName:"audience_list",className:"audience-list",itemFactory:g.AudienceListItem,initialize:function(a){b.prototype.initialize.call(this,a);this.__collection=a.collection;this.__parentDialog=a.parentDialog;this.__updateEmpty()},__updateEmpty:function(){if(0!==this.collection.models.length||this.__$empty)this.collection.models.length&&this.__$empty&&(this.__$empty.remove(),this.__$empty=null);else{var a=this.__emptyText();a&&(this.__$empty=$(g.emptyTemplate({standard:a.standard,concise:a.concise})),this.$el.append(this.__$empty))}},__emptyText:function(){return{standard:this.__serviceProvider.get("globalStringManager").get("audience_list_dialog_empty_text"),concise:this.__serviceProvider.get("globalStringManager").get("audience_list_dialog_empty_text")}}})}({UiCore:l["@UiCore"],AudienceListItem:Ga,emptyTemplate:L}),Fe=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("AudienceListDialog",{className:"audience-list-dialog dialog-type-B-flexible",uiContextName:"audience_list_dialog",dependencies:"dialogManager globalStringManager imqManager loginManager Promise rest restModelFactory window".split(" "),trackedEvents:function(){return[]},initialize:function(a){b.prototype.initialize.call(this,a);this.__roomModel=IMVU.requireProperty(a,"model");this.title=this.__globalStringManager.get("audience_list_dialog_title");this.__loginManager.isLoggedIn()&&(this.__myself=a.loginManager.getCurrentUser());this.__activeChat=a.activeChat;this.addToDOM()},postRender:function(){this.$(".dialog-body").html(g.template({}));this.__getAudienceListFromRoomModel()},delete:function(){b.prototype.delete.call(this);this.__audienceStateMount&&this.__activeChats&&!this.__activeChats.has(this.__hangoutModel)&&this.__audienceStateMount&&(this.__audienceStateMount.queue.messageMounts.audience_message_mount&&this.__audienceStateMount.queue.messageMounts.audience_message_mount.unsubscribe(),this.__audienceStateMount.queue.messageMounts.scene_message_mount&&this.__audienceStateMount.queue.messageMounts.scene_message_mount.unsubscribe(),this.__audienceStateMount.queue.stateMounts.scene_state_mount&&this.__audienceStateMount.queue.stateMounts.scene_state_mount.unsubscribe(),this.__audienceStateMount.unsubscribe(),this.__audienceStateMount=null)},__getAudienceListFromRoomModel:function(){this.__roomModel.populated().then(function(){this.__roomModel.relations.hangout_experience&&this.__roomModel.getSingleEdge("hangout_experience").populated().then(function(a){this.__hangoutModel=a;this.__audienceExperience=this.__hangoutModel.getSingleEdge("audience_experience");return this.__audienceExperience.populated().then(function(){this.__imqManager.subscribeState(this.__audienceExperience.get("queue"),this.__audienceExperience.get("state_mount"),function(c,e){this.__audienceStateMount=e;this.__getAudienceList(e);this.listenTo(this.__audienceStateMount,"stateChange",this.__getAudienceList)}.bind(this))}.bind(this)).catch(function(c){this.__window.console.log("something went wrong",c)}.bind(this))}.bind(this))}.bind(this))},__getAudienceList:function(a){this.__liveRoomAudienceList=new IMVU.NamedCollection;_.isNull(this.__audienceStateMount)||(a=this.__audienceStateMount.state,_.isEmpty(a)||_.each(a,function(c){c=JSON.parse(c);c.node=this.__restModelFactory.readModel(c.user_url,g.UiCore.NodeModel);this.__liveRoomAudienceList.add(c.node)}.bind(this)),this.updateAudienceList(this.__liveRoomAudienceList))},updateAudienceList:function(a){a=a||this.__liveRoomAudienceList;this.$(".audience-list-item-presenter").empty();var c=this.__globalStringManager.get("audience_list_dialog_title")+" ("+a.length+")";this.$(".dialog-title").text(c);this.__audienceList=this.createChildContext(g.AudienceList,{$parentElement:this.$(".audience-list-item-presenter"),collection:a,itemFactory:g.AudienceListItem,stringManager:this.__globalStringManager,scroller:this.$(".audience-list-item-presenter"),showEmptyText:!0,parentDialog:this});this.$(".audience-list").scrollbar()},showBootOption:function(a){var c=!1;return new this.__Promise(function(e){var d=this;g.ChatHelper.canBoot({Promise:this.__Promise,activeChat:this.__activeChat,featureAccessManager:this.__featureAccessManager,myself:this.__myself,toBeBooted:a}).then(function(h){"isOwner"!==h&&"isModerator"!==h||a===d.__myself||!1===h||(c=!0);e.resolve(c)}).catch(function(h){d.__window.console.error("Error attempting to find out if canBoot",h);e.resolve(c)})}.bind(this))},removeUser:function(a){this.__dialogManager.showDialog(g.RemoveUserDialog,{userToRemove:a,activeChat:this.__activeChat}).finished.then(function(){this.__close()}.bind(this))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],AudienceList:Ee,AudienceListItem:Ga,ChatHelper:J,RemoveUserDialog:Fa,template:Ce}),Ge=function(g){var b=g.UiCore.UiContext;return b.extend("RoomDetailWidgetColumn",{className:"room-detail-widget-column",uiContextName:"room_detail_widget_column",dependencies:"dialogManager featureAccessManager globalNav globalStartupModel globalStringManager loginManager modeManager multiGetManager Promise restModelFactory timer window".split(" "),trackedEvents:function(){return[{type:"click",selector:".logged-out-overlay .login",name:"occupancy_login",handler:this.__loginOverride.bind(this)},{type:"click",selector:".btn-show-audience-list",name:"show_live_room_audience_list",handler:this.__showLiveRoomAudienceDialog.bind(this)}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__perfStartTime=a.perfStartTime;this.__lastParticipant=null;this.__roomModel=a.roomModel;this.__isPublic="public"===this.__roomModel.get("privacy");this.__subMode="undefined"===typeof a.subMode?null:a.subMode;this.__execCommand=a.execCommand||document.execCommand.bind(document);this.__isChatNowRoom=IMVU.optionalProperty(a,"isChatNowRoom",!1);this.__throttleUpdateModeratorsVisibilityTimeout={};this.__throttleUpdateLiveRoomPresentersTimeout={};this.__throttleUpdateLiveRoomPresenters=g.NextUtil.throttle(this.__timer,this.__throttleUpdateLiveRoomPresentersTimeout,this.__updateLiveRoomPresenters.bind(this),1e3);if(this.__isLoggedIn=this.__loginManager.isLoggedIn())this.__myself=this.__loginManager.getCurrentUser();this.__activeChats=IMVU.optionalProperty(a,"activeChats",null);this.__activeChat=a.activeChat;this.addToDOM()},delete:function(){this.__timer.clearTimeout(this.__clipboardTimer);this.__timer.clearTimeout(this.__refreshLiveRoomPresentersTimeout);this.__timer.clearTimeout(this.__throttleUpdateLiveRoomPresentersTimeout.timeout);this.__timer.clearTimeout(this.__throttleUpdateModeratorsVisibilityTimeout.timeout);b.prototype.delete.call(this)},__addHost:function(a){var c=this;a.populated().then(function(){return c.$(".hosted-by-panel").addClass("loaded")});this.createChildContext(g.WAFWidgets.DualName,{$parentElement:this.$(".hosted-by").expect(1),user:a,size:"small",hideAtAvatar:!0,ignoreClicks:!1,displayArgs:{color:"dark"},modeManager:this.__modeManager});this.$el.addClass("host-loaded")},__updateModeratorsVisibility:function(){var a=this;this.doWork([function(){return a.__roomModerators.populated()},function(){var c=0<a.__roomModerators.models.length;a.$(".room-moderators").toggleClass("loaded",c);a.$(".room-moderators").toggleClass("hidden",!c)}])},getOccupancyContainer:function(){return this.$(".occupancy-profile-icon-grid-container").expect(1)},__updateCountsCallback:function(a){this.__participantsCount=a;this.__updateCounts()},__getCapacity:function(){var a=10;this.__isLoggedIn&&(a=this.__roomModel.get("capacity"),10<a&&(a=10));return a},__getParticipantCount:function(){var a=0;this.__isLoggedIn&&(a=this.__participantsCount||0);return a},__updateCounts:function(){var a=this.__getParticipantCount(),c=this.__getCapacity();this.$(".occupancy .count-cap").text("("+a+"/"+c+")")},__updateLanguage:function(){this.$(".language").addClass("loaded");var a=this.__roomModel.get("language")||"Any";this.$(".lang-payload").expect(1).text(a)},__updateDescription:function(){this.$(".description").addClass("loaded");var a=this.__roomModel.get("description");this.$(".des-payload").expect(1).toggleClass("empty",!a).text(a||this.__globalStringManager.get("None"))},subscribeToLiveRoomPresenters:function(){var a=this;this.__sceneExperiencePromise=this.__serviceProvider.get("subscriptionManager").subscribeToRoomExperience({roomId:this.__roomModel.id,imqManager:this.__serviceProvider.get("imqManager"),queueName:this.__sceneExperience.get("queue"),mountName:this.__sceneExperience.get("state_mount"),callback:function(c){c=c.stateMount;a.__updateLiveRoomPresenters(a.__userCollection,c);a.stopListening(c);a.listenTo(c,"stateChange",a.__throttleUpdateLiveRoomPresenters.bind(a,a.__userCollection))}})},__listenForLiveRoomPresenters:function(a){var c=this;return this.doWork([function(){return c.__roomModel.getSingleEdge("hangout_experience").populated()},function(e){c.__hangoutModel=e;c.__sceneExperience=c.__hangoutModel.getSingleEdge("scene_experience");return c.__sceneExperience.populated()},function(){return c.subscribeToLiveRoomPresenters()}])},__updateLiveRoomPresenters:function(a,c){var e=this;c=c.state;var d=null;_.isEmpty(c)||(d=[],_.each(c,function(h){h=JSON.parse(h);h=this.__restModelFactory.readModel(h.user_url,g.UiCore.NodeModel);d.push(h)}.bind(this)),a.reset(d));a=this.__serviceProvider.get("subscriptionManager");this.__featureAccessManager.shouldPauseLiveRooms()&&d&&d.length&&(a.unsubscribeFromRoomExperience({roomId:this.__roomModel.id}),this.__timer.clearTimeout(this.__refreshLiveRoomPresentersTimeout),this.__refreshLiveRoomPresentersTimeout=this.__timer.setTimeout(function(){return e.subscribeToLiveRoomPresenters()},g.ChatHelper.getPauseLiveRoomsInterval(this.__globalStartupModel)))},__showLiveRoomAudienceDialog:function(){this.__dialogManager.showDialog(g.AudienceListDialog,{model:this.__roomModel,activeChat:this.__activeChat})},render:function(){var a=this;this.$el.html(g.template({publicRoom:this.__isPublic}));this.$el.toggleClass("logged-in",this.__isLoggedIn);this.$(".room-moderators").addClass("hidden");this.doWork([function(){return a.__roomModel.populated()},function(){a.__featureAccessManager.shouldPauseLiveRooms()&&a.$("button.btn-show-audience-list").remove();"undefined"!==typeof a.__roomModel.relations.moderators&&a.__multiGetManager.getReact(a.__roomModel.relations.moderators);a.listenTo(a.__roomModel,"change:capacity",function(){return a.__updateCounts()});a.listenTo(a.__roomModel,"change:description",function(){return a.__updateDescription()});a.listenTo(a.__roomModel,"change:language",function(){return a.__updateLanguage()});var c=_.contains(["marriage","shared"],a.__roomModel.get("type"));a.$el.toggleClass("is-shared",c);a.doWork([function(){return a.__roomModel.getSingleEdge("owner").populated()},function(k){return a.__addHost(k)}]);a.$el.toggleClass("has-partner",!!a.__roomModel.relations.partner);c&&a.__roomModel.relations.partner&&(a.__roomModel.getSingleEdge("partner"),a.doWork([function(){return a.__roomModel.getSingleEdge("partner").populated()},function(k){return a.__addHost(k)}]));a.__isPublic&&a.__updateLanguage();var e;c=new a.__Promise(function(k){e=k});!a.__activeChat&&a.__activeChats&&a.__roomModel.relations.chat?a.doWork([function(){return a.__roomModel.getSingleEdge("chat").populated()},function(k){a.__activeChats.has(k)?a.doWork([function(){return a.__activeChats.getChat(k)},function(m){e.resolve(m);a.__activeChat=m}]):e.resolve()}]):e.resolve();var d,h=new a.__Promise(function(k){d=k});if(a.__isLoggedIn&&a.__roomModel.relations.chat)a.doWork([function(){return a.__roomModel.getSingleEdge("chat").populated()},function(k){return k.getEdgeCollection("participants").populated()},function(k){return d.resolve(k)}]);else{var f=new Backbone.Collection;f.populated=function(){return a.__Promise.resolve()};d.resolve(f)}(a.__roomModel.get("has_plus_badge")||a.__roomModel.get("is_plus_badge_compatible"))&&a.$el.find(".distinguish").removeClass("hidden").addClass("loaded");a.createChildContext(g.DistinguishBlurbWidget,{$parentElement:a.$el.find(".distinguish"),isCard:!1,model:a.model,blurb:"Distinguish_Blurb_Product"});return a.__Promise.every([h,c])},function(c){var e=$jscomp.makeIterator(c);c=e.next().value;e.next();a.__userCollection=c;if(e=a.__roomModel.get("supports_audience"))a.$(".occupancy-title").addClass("hidden"),a.$(".presenters-title").removeClass("hidden"),a.$("button.btn-show-audience-list").removeClass("hidden"),a.__listenForLiveRoomPresenters(c);a.__participantsCount=0;var d=function(){};a.__isLoggedIn&&(d=a.__updateCountsCallback.bind(a));a.getOccupancyContainer().html("");a.__profileIconGrid=a.createChildContext(g.WithmeWidgets.ProfileIconGrid,{$parentElement:a.getOccupancyContainer(),activeChat:a.__activeChat,isLiveRoom:e,numSlots:a.__getCapacity(),userCollection:c,userCountCallback:d});a.__addRenderGatingPromise(a.__profileIconGrid.getHasRenderedPromise());a.$(".occupancy").addClass("loaded");a.__isPublic&&a.__updateDescription();a.$(".container").expect(1).addClass("scroller");if(!a.__isLoggedIn)a.$el.on("click",a.__loginOverride.bind(a));if(a.__isChatNowRoom)a.__waitOnRenderGatingPromises({failure:"RoomDetailWidgetColumn::render - failed - 2"});else{a.__roomModerators=a.__roomModel.getEdgeCollection("moderators");c=g.NextUtil.throttle(a.__timer,a.__throttleUpdateModeratorsVisibilityTimeout,a.__updateModeratorsVisibility.bind(a),1e3);a.listenTo(a.__roomModerators,"add remove reset",c);var h=a.__roomModerators.populated();a.doWork([function(){return h},function(){a.__updateModeratorsVisibility();var f=a.$(".room-moderator-list-container").expect(1);f.html("");f={activeChat:a.__activeChat,$parentElement:f,numSlots:a.__isLoggedIn?0:10,userCountCallback:function(){}};a.__isLoggedIn?f.userCollection=a.__roomModerators:(f.userCollection=new Backbone.Collection,f.userCollection.populated=function(){return a.__Promise.resolve()});a.__roomModeratorList=a.createChildContext(g.WithmeWidgets.ProfileIconGrid,f);a.__addRenderGatingPromise(a.__roomModeratorList.getHasRenderedPromise());a.__waitOnRenderGatingPromises({failure:"RoomDetailWidgetColumn::render - failed - 4"})}]).catch(function(f){a.__setAsRenderFailed("RoomDetailWidgetColumn::render - failed - 3")})}}]).catch(function(c){a.__setAsRenderFailed("RoomDetailWidgetColumn::render - failed - 1")})},removeIfInASubmode:function(){null!==this.__subMode&&this.$el.remove()},__loginOverride:function(){this.__isLoggedIn||this.__dialogManager.showLoginOrSignupDialog()},getModerators:function(){return this.__roomModerators}})}({Model:l["@Model"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],WithmeWidgets:l["@WithmeWidgets"],AudienceListDialog:Fe,ChatHelper:J,DistinguishBlurbWidget:Aa,RoomModeratorDialog:Ea,template:Be}),He=function(g){var b=g.UiCore.UiContext;return b.extend("RoomDetailWidget",{className:"room-detail-widget",uiContextName:"room_detail_widget",dependencies:"dialogManager featureAccessManager globalNav globalStringManager imageManager loginManager modeManager Promise timer window".split(" "),trackedEvents:function(){return[{type:"click",selector:".logged-out-overlay .login",name:"occupancy_login",handler:this.__loginOverride.bind(this)}]},__getDetailsFromRoom:function(){this.__roomCapacity=this.__roomModel.get("capacity");this.__roomID=this.__roomModel.id;this.__roomIsAP=this.__roomModel.get("is_ap");this.__roomIsVIP=this.__roomModel.get("is_vip");this.__roomDescription=this.__roomModel.get("description")||this.__globalStringManager.get("None");this.__roomName=this.__roomModel.get("name");this.__roomLanguage=this.__roomModel.get("language")||this.__globalStringManager.get("Any");this.__roomPrivacy=this.__roomModel.get("privacy");this.__roomType=this.__roomModel.get("type")},__getDetailsFromChat:function(){this.__roomCapacity=this.__chatModel.get("capacity")||this.__roomCapacity;this.listenTo(this.__roomModel,"change",this.__updateRoomInfo.bind(this))},__getDetailsFromParticipants:function(){this.__participantModels=[];this.__lastParticipant=null;this.__participantsCollection.models.forEach(function(a){this.__participantModels.push(a.populated());this.__lastParticipant=a}.bind(this));this.__participantsCount=this.__participantModels.length},initialize:function(a){var c=this;b.prototype.initialize.call(this,a);this.__perfStartTime=a.perfStartTime;this.__window=a.window;this.__featureAccessManager=a.featureAccessManager;this.__lastParticipant=this.__chatModel=null;this.__loginManager=a.loginManager;this.__roomModel=a.roomModel;this.__stringManager=a.globalStringManager;this.__dialogManager=a.dialogManager;this.__modeManager=a.modeManager;this.__subMode="undefined"===typeof a.subMode?null:a.subMode;this.__globalNav=a.globalNav;this.__isChatNow=IMVU.optionalProperty(a,"isChatNow",!1);this.__isChatNowRoom=IMVU.optionalProperty(a,"isChatNowRoom",!1);this.__isOnChatNowSplashPage=IMVU.optionalProperty(a,"isOnChatNowSplashPage",!1);this.__isChatNow=IMVU.optionalProperty(a,"isChatNow",!1);this.__isActiveChat=IMVU.optionalProperty(a,"isActiveChat",!1);this.__throttleTimerRef={};this.__isRecommended=IMVU.optionalProperty(a,"isRecommended",null);this.__activeChat=a.activeChat;this.__subscriptionManager=this.__serviceProvider.get("subscriptionManager");this.__subscriptionManager.setState({roomId:this.__roomModel.id,state:this.__subscriptionManager.STATE_OPEN_ROOM_INFO});this.__serviceProvider.has("activeChats")&&(this.__activeChats=this.__serviceProvider.get("activeChats"));this.__isChatNowRoom&&(this.__chatNowRequest=IMVU.optionalProperty(a,"chatNowRequest",null));if(this.__isLoggedIn=this.__loginManager.isLoggedIn())this.__myself=this.__loginManager.getCurrentUser();this.__isMobile=this.__featureAccessManager.isMobile();this.addToDOM();this.doWork([function(){return c.__roomModel.invalidate()},function(){return c.__roomModel.populated()},function(){c.__getDetailsFromRoom();var e=g.NextUtil.throttle(c.__timer,c.__throttleTimerRef,c.__updateRoomInfo.bind(c),1e3);c.listenTo(c.__roomModel,"change",e);return c.__roomModel.getSingleEdge("owner").populated()},function(e){c.__roomOwnerModel=e;if(c.__isLoggedIn&&c.__roomModel.relations.chat)return c.doWork([function(){return c.__roomModel.getSingleEdge("chat").populated()},function(d){c.__chatModel=d;c.__getDetailsFromChat();c.__activeChats&&c.__activeChats.has(d)&&(c.__isActiveChat=!0,c.doWork([function(){return c.__activeChatPromise=c.__activeChats.getChat(d)}]));return c.__chatModel.getEdgeCollection("participants").populated()},function(d){c.__participantsCollection=d;c.__getDetailsFromParticipants()}])}])},delete:function(){this.__timer.clearTimeout(this.__throttleTimerRef.timeout);this.__roomModel.get("supports_audience")&&this.__subscriptionManager.setState({roomId:this.__roomModel.id,state:this.__subscriptionManager.STATE_CLOSE_ROOM_INFO});b.prototype.delete.call(this)},__findElements:function(){this.__eleWidget=this.$el[0];this.__eleLeft=this.__eleWidget.getElementsByClassName("left-panel")[0];this.__eleLeftHead=this.__eleLeft.getElementsByClassName("headpiece")[0];this.__eleLeftPanelText=this.__eleLeft.getElementsByClassName("left-panel-text")[0];this.__eleLeftPanelTextAdjustable=this.__eleLeftPanelText.getElementsByClassName("adjustable")[0];this.__eleLeftAPBadge=this.__eleLeft.getElementsByClassName("ap-badge")[0];this.__eleLeftVIPBadge=this.__eleLeft.getElementsByClassName("vip-badge")[0];this.__eleRight=this.__eleWidget.getElementsByClassName("right-panel")[0];this.__eleRightHead=this.__eleRight.getElementsByClassName("headpiece")[0]},__renderElements:function(){null!==this.__subMode&&this.__subMode.toggleMagicLineMenu(!0);this.__loadBadges();this.$(".left-panel .headpiece");var a=this.$(".right-panel .headpiece");this.__eleLeftHead.classList.add("hidden");this.__eleRightHead.classList.remove("hidden");this.__headpiece=this.createChildContext(g.RoomDetailWidgetHeadpiece,{$parentElement:a,roomModel:this.__roomModel,subMode:this.__subMode,parent:this,isChatNowRoom:this.__isChatNowRoom,isOnChatNowSplashPage:this.__isOnChatNowSplashPage,chatNowRequest:this.__chatNowRequest,isActiveChat:this.__isActiveChat,isRecommended:this.__isRecommended});this.__addRenderGatingPromise(this.__headpiece.getHasRenderedPromise());a={$parentElement:this.$(".main-column"),roomModel:this.__roomModel,isChatNowRoom:this.__isChatNowRoom,activeChat:this.__activeChat};this.__activeChats&&(a.activeChats=this.__activeChats);this.__column=this.createChildContext(g.RoomDetailWidgetColumn,a);this.__addRenderGatingPromise(this.__column.getHasRenderedPromise());this.__isLoggedIn||this.__eleLeft.addEventListener("click",this.__loginOverride.bind(this))},render:function(){var a=this;this.$el.html(g.template());this.doWork([function(){a.__findElements();a.__renderElements();a.__isMobile&&a.__refreshSize();a.createChildContext(g.DistinguishStatus,{$parentElement:a.$el.find(".lightbox-perfect-square-container"),model:a.__roomModel,position:"start-end offset"});a.__waitOnRenderGatingPromises()}])},removeIfInASubmode:function(){null!==this.__subMode&&this.__eleWidget.parentNode&&this.__eleWidget.parentNode.removeChild(this.__eleWidget)},__loginOverride:function(){this.__isLoggedIn||this.__dialogManager.showLoginOrSignupDialog()},__refreshSize:function(){var a=$(this.__window).width();this.$(".left-panel").css({height:a})},__loadBadges:function(){this.__isLoggedIn?(this.__viewImages=this.__roomIsAP?!!this.__myself.get("is_ap"):!0,this.__roomIsVIP&&(this.__viewImages=this.__myself.get("is_vip"))):this.__viewImages=!this.__roomIsAP;if(this.__viewImages){this.$(".left-panel-image").removeClass("hidden");var a=this.__imageManager.load(".left-panel-image",this.__roomModel.get("rendered_image")+"?width=500&height=500");this.__addRenderGatingPromise(a);this.__eleLeftPanelText.classList.add("hidden");this.__eleLeftPanelText.classList.remove("flexing")}else if(this.$(".left-panel-image").addClass("hidden"),this.__eleLeftPanelText.classList.remove("hidden"),this.__eleLeftPanelText.classList.add("flexing"),this.__roomIsAP&&this.__isLoggedIn&&!this.__myself.get("is_ap"))this.__eleLeftPanelTextAdjustable.innerHTML=this.__stringManager.get("ap_image_not_available");else if(!this.__roomIsVIP||this.__myself.get("is_vip"))this.__eleLeftPanelTextAdjustable.innerHTML=this.__stringManager.get("vip_image_not_available")},__updateRoomInfo:function(){this.__getDetailsFromRoom();this.__loadBadges()}})}({Model:l["@Model"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],DistinguishStatus:w,RoomDetailWidgetColumn:Ge,RoomDetailWidgetHeadpiece:Ae,template:Sd}),Ha=function(g){var b=g.LightboxDialog;return b.extend("RoomDetailLightbox",{uiContextName:"room_detail_lightbox",className:"room-detail-lightbox lightbox-dialog lightbox-b",dependencies:"defer dialogManager featureAccessManager globalStartupModel globalStringManager loginManager Promise roomsModeStringManager".split(" "),initialize:function(a){var c=this;a.headerIsVisible=!1;b.prototype.initialize.call(this,a);this.__isChatNowRoom=IMVU.optionalProperty(a,"isChatNowRoom",!1);this.__isOnChatNowSplashPage=IMVU.optionalProperty(a,"isOnChatNowSplashPage",!1);this.__isChatNowRoom&&(this.__chatNowRequest=IMVU.optionalProperty(a,"chatNowRequest",null));this.__isRecommended=IMVU.optionalProperty(a,"isRecommended",null);this.__defer=a.defer;this.__activeChat=a.activeChat;this.__modelPromise=this.model.populated();this.doWork([function(){return c.__modelPromise},function(){c.model.get("is_expired")&&"public"===c.model.get("privacy")?(c.close(),c.__renderRoomRemovedAlert()):(c.__isChatNowRoom||c.linkToDetailsSubmode("chat",c.model),c.doWork([function(){return c.createChildContext(g.RoomDetailWidget,{$parentElement:c.$(".main-container"),roomModel:c.model,isChatNowRoom:c.__isChatNowRoom,isOnChatNowSplashPage:c.__isOnChatNowSplashPage,chatNowRequest:c.__chatNowRequest,isRecommended:c.__isRecommended,activeChat:c.__activeChat}).hasRendered},function(){c.refreshSize()}]))}]).catch(function(){c.__defer(function(){c.close();c.__renderRoomRemovedAlert()})})},__renderRoomRemovedAlert:function(){this.__dialogManager.alert({title:this.__roomsModeStringManager.get("room_unavailable_title"),text:this.__roomsModeStringManager.get("room_unavailable_text"),ok:this.__roomsModeStringManager.get("room_unavailable_ok")})},show:function(){b.prototype.show.call(this);this.refreshSize()},refreshSize:function(){if(!this.__featureAccessManager.isMobile()){var a=this.$(".lightbox-perfect-square-sizer").height(),c=parseInt(this.$(".lightbox-perfect-square-sizer").css("min-height"),10);a=a>=c?a:c;this.$(".right-panel").height(a)}},__onMobileScroll:function(){var a=this.$(".dialog-header").height()<=this.$(".main-container").scrollTop();this.$(".dialog-container").toggleClass("non-transparent",a)},close:function(){this.trigger("close");b.prototype.close.call(this)}})}({Checkout:l["@Checkout"],Model:l["@Model"],LightboxDialog:v,RoomDetailWidget:He}),Ie=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;return(a=(d=a.text||b&&b.text,"function"===typeof d?d.call(b,{name:"text",hash:{},data:e}):d))||0===a?a:""},useData:!0})}({}),M=function(g){var b=g.UiCore.UiContext;return b.extend("UserText",{className:"user-text",uiContextName:"user_text",dependencies:"conversationHelpers dialogManager featureAccessManager globalStringManager modeManager prefsManager Promise root text timer window".split(" "),trackedEvents:function(){this.__linkClickingHandler=g.NextUtil.DomHelper.createLinkClickingHandler({dialogManager:this.__dialogManager,featureAccessManager:this.__featureAccessManager,globalStringManager:this.__globalStringManager,modeManager:this.__modeManager,prefsManager:this.__prefsManager,window:this.__window});this.__onClickLink=this.__linkClickingHandler.handler;return[{type:"click",selector:"a",name:"user_text_link",handler:this.__onClickLink}]},initialize:function(a){b.prototype.initialize.call(this,a);this.text=String(a.text)||"";this.__dialogManager=a.dialogManager;this.__window=a.window;this.__prefsManager=a.prefsManager;this.__featureAccessManager=a.featureAccessManager;this.__globalStringManager=a.globalStringManager;this.__conversationHelpers=a.conversationHelpers;this.__modeManager=a.modeManager;this.__root=a.root;this.__isWhisper=a.isWhisper;this.addToDOM()},delete:function(){b.prototype.delete.call(this);this.__timer.clearTimeout(this.__visibleTimer)},render:function(a){a=a||!0;this.text=this.text.replace(/(?:\r\n|\r|\n)/g,"<br />");a&&(this.text=this.text.replace(/<(?:.|\n)*?>/gm," "));this.text=this.__conversationHelpers.sanitize(this.text);this.text=this.__conversationHelpers.collapseWhitespace(this.text);this.__isWhisper&&(this.text=this.__conversationHelpers.wrapEmojis(this.text));this.$el.html(g.template({text:this.text}));this.$el.linkify({target:"_blank"})},isExternalLinkWarningSuppressed:function(){return this.__linkClickingHandler.isExternalLinkWarningSuppressed()},suppressExternalLinkWarnings:function(){this.__linkClickingHandler.suppressExternalLinkWarnings()},isExternalLink:function(a){return this.__linkClickingHandler.isExternalLink(a)},isGoLink:function(a){return this.__linkClickingHandler.isGoLink(a)},waitForVisible:function(){return new this.__Promise(function(a){var c=10,e=function(){this.isVisible()?a.resolve():0<c?(c--,this.__visibleTimer=this.__timer.setTimeout(e.bind(this),500)):a.reject(Error("text never becomes visible"))};e.call(this)}.bind(this))},isVisible:function(){return this.$el.is(":visible")},isOverflowed:function(){return this.isVisible()&&(Math.ceil(this.$el.innerWidth())<this.$el[0].scrollWidth||Math.ceil(this.$el.innerHeight())<this.$el[0].scrollHeight)?!0:!1},handleOverflow:function(){this.$el.text(this.text);if(this.isOverflowed()){if(!this.shortText){for(var a=this.text,c,e=0;this.isOverflowed();){if(e>this.text.length){a=this.text.substr(0,this.text.length/2);break}c=a.replace(/\s+\S+$/,"...");c===a&&(c=a.replace(/(\.\.\.)*$/,""),c=c.replace(/.{1,3}$/,"..."));a=c;this.$el.text(a);this.$el.linkify({target:"_blank"});e++}c=a.replace(/(\s+\S+){1,2}$/,"...");c===a&&(c=a.replace(/(\.\.\.)*$/,""),c=c.replace(/.{1,6}$/,"..."));this.shortText=c}this.$el.text(this.shortText);this.$el.linkify({target:"_blank"})}else this.$el.linkify({target:"_blank"}),this.$el.html()}})}({Linkify:l["@Linkify"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:Ie}),Je=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c="<div class='message'></div>\n<div class=\"big-liking-animation\">";if((a=(d=a.icon||b&&b.icon||h,d.call(b,"icon-like-on",{name:"icon",hash:{class:"color-red"},data:e})))||0===a)c+=a;return c+"</div>\n"},useData:!0})}({}),Ke=function(g){var b=g.UiCore.UiContext;return g.UiCore.UiContext.extend("FeedText",{className:"feed-text",uiContextName:"feed_text",dependencies:["googleAnalytics","model","platform","timer"],trackedEvents:function(){return[g.NextUtil.DomHelper.trackClickOrDouble({selector:"",clickName:"feed_item_click",doubleclickName:"feed_item_like",clickHandler:function(){},doubleclickHandler:this.__like})]},bigLikingAnimation:function(){this.__timer.clearTimeout(this.__likeTimer);this.__likeTimer=g.NextUtil.DomHelper.applyTemporaryClass(this.__timer,this.$el,"liking",1e3)},__like:function(){this.trigger("like")},initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},delete:function(){b.prototype.delete.call(this);this.__timer.clearTimeout(this.__likeTimer);this.__timer.clearTimeout(this.__scrollbarTimeout)},render:function(){this.model.populated().then(function(){this.$el.html(g.template);var a=this.model.get("payload.background_color");a&&this.$el.css("background-color","#"+a);this.__userText=this.createChildContext(g.UserText,{$parentElement:this.$(".message"),text:this.model.get("payload.message")});"mobile"!==this.__platform&&(this.__scrollbarTimeout=this.__timer.setTimeout(function(){this.$(".message").scrollbar()}.bind(this),0))}.bind(this))}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],UserText:M,template:Je}),Le=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c="<ul class='items'>\n</ul>\n<div class='more hidden'>";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"view_more_likes",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</div>"},useData:!0})}({}),Me=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="username"></div>\n<div class="button-container"></div>\n'},useData:!0})}({}),Ne=function(g){var b=g.UiCore.UiContext;return b.extend("LikeListItem",{uiContextName:"like_list_item",className:"like-list-item",dependencies:["loginManager","model"],trackedEvents:function(){return[{type:"click",selector:".btn.add-friend",name:"add_friend",handler:"__addFriend"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__serviceProvider.has("friendManager")&&(this.__friendManager=this.__serviceProvider.get("friendManager"));a.loginManager.isLoggedIn()&&(this.__myself=a.loginManager.getCurrentUser());this.addToDOM()},render:function(){this.__model.populated().then(function(){this.__loginManager.isLoggedIn()&&this.$el.toggleClass("is-me",this.__model.node.id===this.__myself.id);this.$el.html(g.template);this.createChildContext(g.WAFWidgets.DualName,{$replaceElement:this.$(".username"),user:this.__model.node,configuration:"small-single-lightbg"});this.__myself&&this.__myself.relations.profile!==this.__model.node.id&&(this.__followButton=this.createChildContext(g.WithmeWidgets.FollowButton,{$replaceElement:this.$(".button-container"),profileNode:this.__model.node}))}.bind(this))}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],WithmeWidgets:l["@WithmeWidgets"],template:Me}),Oe=function(g){var b=g.WAFWidgets.EdgeCollectionPresenter;return b.extend("LikeList",{uiContextName:"like_list",className:"like-list",tagName:"div",itemFactory:g.LikeListItem,dependencies:["globalStringManager","timer"],trackedEvents:function(){return[{type:"click",selector:".more",name:"view_more",handler:"viewMore"}]},initialize:function(a){a.manuallyPage=!0;b.prototype.initialize.call(this,a);this.collection.populated().then(function(){this.__multiGetManager.queue(this.collection);this.__refreshMore();this.listenTo(this.collection,"add remove update reset",this.__refreshMore.bind(this,!0))}.bind(this))},renderTemplate:function(){this.$el.html(g.template);this.$itemContainer=this.$(".items");b.prototype.renderTemplate.call(this)},__refreshMore:function(a){this.$(".more").toggleClass("hidden",!this.collection.hasNextPage())},__childrenInDOM:function(){var a=_.map(_.filter(_.values(this.__registry),function(c){return c.$el}),function(c){return c.$el[0]});return this.$itemContainer.children().filter(a)},__emptyText:function(){return this.collection.total_count!=this.collection.models.length?{standard:this.__globalStringManager.get("post_cant_show_likes"),concise:this.__globalStringManager.get("post_cant_show_likes")}:{standard:this.__globalStringManager.get("post_has_no_likes"),concise:this.__globalStringManager.get("post_has_no_likes")}}})}({WAFWidgets:l["@WAFWidgets"],LikeListItem:Ne,template:Le}),Pe=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<img class="inline-image" />\n<div class=\'expanded-photo\'>\n    <a href="#" class="dialog-x"></a>\n    <img />\n</div>\n<div class="big-liking-animation">';if((a=(d=a.icon||b&&b.icon||h,d.call(b,"icon-like-on",{name:"icon",hash:{class:"color-red"},data:e})))||0===a)c+=a;return c+"</div>\n"},useData:!0})}({}),Ia=function(g){var b=g.UiCore.UiContext;return g.UiCore.UiContext.extend("FeedPhoto",{className:"feed-photo",uiContextName:"feed_photo",dependencies:["imageManager","model","timer"],trackedEvents:function(){return[g.NextUtil.DomHelper.trackDoubleclick({selector:".inline-image",name:"feed_item_like",handler:this.__like})]},bigLikingAnimation:function(){this.__timer.clearTimeout(this.__likeTimer);this.__likeTimer=g.NextUtil.DomHelper.applyTemporaryClass(this.__timer,this.$el,"liking",1e3)},__like:function(){this.trigger("like")},initialize:function(a){b.prototype.initialize.call(this,a);this.__fadeTimers=[];this.__photoFadeDelay=a.photoFadeDelay||150;this.addToDOM()},delete:function(){b.prototype.delete.call(this);for(var a=$jscomp.makeIterator(this.__fadeTimers),c=a.next();!c.done;c=a.next())this.__timer.clearTimeout(c.value);this.__timer.clearTimeout(this.__likeTimer)},render:function(){this.$el.addClass("loading").html(g.template);this.__fadeTimers.push(this.__timer.setTimeout(function(){this.$el.addClass("fade")}.bind(this),this.__photoFadeDelay));this.model.populated().then(function(){this.$el.css({"max-width":Math.max(this.model.get("payload.width"),this.model.get("payload.height"))+"px"});return this.__imageManager.load(this.$("img"),this.model.get("payload.url"),{})}.bind(this)).then(function(){this.$el.removeClass("loading")}.bind(this)).catch(function(){this.$el.removeClass("loading").addClass("error");this.model.invalidate();this.render()}.bind(this))}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:Pe}),Qe=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=this.escapeExpression;c=a.helperMissing;h='<span class="count">'+h((d=a.count||b&&b.count,"function"===typeof d?d.call(b,{name:"count",hash:{},data:e}):d))+'</span>\n<span class="label-single">';var f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,b&&b.nameSingular,{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='</span>\n<span class="label-plural">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,b&&b.namePlural,{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</span>"},useData:!0})}({}),Re=function(g){var b=g.UiCore.UiContext;return b.extend("Counter",{className:"counter",uiContextName:"counter",dependencies:["count","name"],initialize:function(a){b.prototype.initialize.call(this,a);this.__count=a.count;this.__name=a.name;this.addToDOM()},render:function(){this.$el.html(g.template({count:g.FormatNumber.formatMini(this.__count),nameSingular:this.__name+"_single",namePlural:this.__name+"_plural"}));this.$el.toggleClass("is-plural",0===this.__count||1<this.__count);this.__setAsRendered()},update:function(a){this.__count=a;this.render()}})}({UiCore:l["@UiCore"],FormatNumber:r,template:Qe}),Se=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="photo-room-container">\n    <div class="photo-room-details is-truncated">\n        <div class="location">',f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-chat-location",{name:"icon",hash:{},data:e}));if(f||0===f)h+=f;h+="<div class=\"room-name is-truncated\"></div></div><div class='photo-with secondary-text is-truncated'><span>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"with",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+" </span><span class='username-placeholder'></span><span class='with-others'></span></div>\n    </div>\n</div>"},useData:!0})}({}),Ja=function(g){var b=g.UiCore.UiContext;return b.extend("PhotoRoomUsers",{uiContextName:"photo_room_users",tagName:"article",className:"photo-room-users",dependencies:"dialogManager errorToasterManager featureAccessManager globalStringManager imageManager loginManager Promise rest restModelFactory window".split(" "),trackedEvents:function(){return[{type:"click",name:"show_room_lightbox",selector:".room-name",handler:this.__showRoomDetails}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__featureAccessManager=a.featureAccessManager;this.__Promise=a.Promise;this.__restModelFactory=a.restModelFactory;this.__actor=a.actor;this.__model=a.model;this.__roomModel=a.roomModel;this.__loginManager=a.loginManager;this.__isLoggedIn=this.__loginManager.isLoggedIn();this.__window=a.window;this.addToDOM()},render:function(a){var c=this;this.$el.html(g.template);var e=this.__actor,d=this.__restModelFactory,h=this.__Promise,f=this,k=this.$(".photo-with .with-others"),m=this.__globalStringManager;this.__model&&this.doWork([function(){return c.__model.populated()},function(n){return n.getSingleEdge("photo").populated()},function(n){if(n.relations.location){var q=d.readModel(n.relations.location,g.UiCore.NodeModel);c.doWork([function(){return q.populated()},function(p){f.$(".photo-room-details .room-name").text(p.attributes.name);return d.readModel(n.relations.photo_details,g.UiCore.NodeModel).populated()},function(p){p=_.without(_.pluck(p.get("users"),"id"),e.id);return h.every(_.map(p,function(u){return d.readModel(u,g.UiCore.NodeModel).populated()}))},function(p){p&&0<p.length?(f.$(".photo-with").show(),f.createChildContext(g.WAFWidgets.DisplayName,{$parentElement:f.$(".photo-with .username-placeholder"),user:p[0],showVipBadge:!1,ignoreClicks:!0}),1<p.length&&k.text(2===p.length?m.get("with_1_other"):m.get("with_x_others",{count:p.length-1}))):f.$(".photo-room-details .photo-with").css("visibility","hidden")}])}}])},__roomTypeCheckPromise:function(){var a=this.__roomModel;return"closed"!==a.get("type")?this.__Promise.resolve():this.__dialogManager.confirm({no:this.__globalStringManager.get("Cancel"),yes:this.__globalStringManager.get("Open Room"),title:this.model.node.get("name"),text:this.__globalStringManager.get("Open Room confirmation text")}).finished.then(function(){return g.NextUtil.RoomUtil.newEditPromise({globalStringManager:this.__globalStringManager,errorToasterManager:this.__errorToasterManager,window:this.__window,Promise:this.__Promise,roomModel:a,setup:function(){a.set("type","listed");return["type"]}})}.bind(this))},__showRoomDetails:function(){var a=arguments,c=this;this.doWork([function(){return c.__roomTypeCheckPromise()},function(){return c.__dialogManager.showLightbox("RoomDetailLightbox",{model:c.__roomModel})}]).catch(function(e){"no"!==e.confirm&&c.__window.console.error(a)})}})}({Model:l["@Model"],UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],template:Se}),Te=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="main-info">\n    <div class=\'picture tile-body\'>\n    </div>\n    <div class=\'text\'>\n        <div class=\'primary-text\'></div>\n        <div class="photo-room-container" style="display:none;">\n            <div class="photo-room-details">\n                <div class="location is-truncated">',f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-chat-location",{name:"icon",hash:{},data:e}));if(f||0===f)h+=f;h+="<div class=\"room-name\"></div></div><div class='photo-with secondary-text is-truncated'><span>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"with",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+=" </span><span class='username-placeholder'></span><span class='with-others'></span></div>\n            </div>\n        </div>\n        <div class=\"caption secondary-text hidden\"></div>\n        <div class='secondary-text posted-timestamp'>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"posted",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+" </div>\n    </div>\n</div>\n"},useData:!0})}({}),Ue=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression;return'<div class="expanding-text-text" />\n<a class="helip hidden" data-more="'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"...more",{name:"i18n-g",hash:{},data:e})))+'" data-less="'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"...less",{name:"i18n-g",hash:{},data:e})))+'" />\n'},useData:!0})}({}),Ka=function(g){var b=g.UiCore.UiContext;return b.extend("ExpandingText",{className:"expanding-text",uiContextName:"expanding_text",dependencies:["textValue"],trackedEvents:function(){return[{type:"click",selector:".helip",name:"expanding_text_helip_click",handler:"__onHelipClick"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__hideHelip=IMVU.optionalProperty(a,"hideHelip",!1);this.addToDOM()},__handleOverflow:function(){this.__expanding.isOverflowed()&&(this.__expanding.handleOverflow(),this.__toggleHelip(!0))},render:function(){var a=this;this.doWork([function(){a.$el.html(g.template());a.__expanding=a.createChildContext(g.UserText,{$replaceElement:a.$(".expanding-text-text"),text:a.__textValue});a.__expanding.$el.addClass("expanding-text-text is-truncated");a.__hideHelip&&a.__expanding.$el.attr("title",a.__textValue)}])},changeText:function(a){var c=this;this.doWork([function(){a=a||"";c.__expanding.shortText=null;c.__expanding.text=a;c.__expanding.render();return c.__expanding.waitForVisible()},function(){var e=!1;c.$el.hasClass("open")&&(e=!0,c.$el.toggleClass("open"));c.__expanding.isOverflowed()?c.__toggleHelip(!0):c.__toggleHelip(!1);e&&c.$el.toggleClass("open");c.__handleOverflow()}])},__onHelipClick:function(a){this.$el.toggleClass("open");this.__expanding.handleOverflow();this.trigger("openText")},__toggleHelip:function(a){this.__hideHelip?this.$(".helip").addClass("hidden"):a?this.$(".helip").removeClass("hidden"):this.$(".helip").addClass("hidden")}})}({UiCore:l["@UiCore"],UserText:M,template:Ue}),Ve=function(g){var b=g.UiCore.UiContext;return b.extend("Timestamp",{className:"timestamp-widget",uiContextName:"timestamp",tagName:"timestamp",dependencies:["moment","timestamp","timestampHelper"],initialize:function(a){b.prototype.initialize.call(this,a);this.__timestampHelper=a.timestampHelper;this.__moment=a.moment;this.__timestampHelper.setDifference(a.timestamp);this.addToDOM();this.$el.attr("data-actual-date",this.__timestampHelper.now().toString())},render:function(){this.$el.text(this.__timestampHelper.formatTime())}})}({UiCore:l["@UiCore"]}),La=function(g){var b=g.Timestamp;return b.extend("FeedItemTimestamp",{className:"timestamp-widget feed-item-timestamp system-info-detail",uiContextName:"feed_item_timestamp",initialize:function(a){this.__includeAgo=!!a.includeAgo;b.prototype.initialize.call(this,a)},render:function(){this.$el.text(this.__timestampHelper.feedItem(this.__includeAgo));this.__setAsRendered()}})}({UiCore:l["@UiCore"],Timestamp:Ve}),We=function(g){var b=g.StandardHeadpiece;return g.UiCore.UiContext.extend("FeedHeadpiece",{className:"feed-headpiece standard-headpiece",uiContextName:"feed_headpiece",dependencies:"contextMenuManager dialogManager errorToasterManager featureAccessManager globalStartupModel globalStringManager loginManager model Promise restModelFactory window".split(" "),trackedEvents:function(){return[{type:"click",name:"show_room_lightbox",selector:".room-name",handler:this.__showRoomDetails}]},initialize:function(a){b.prototype.initialize.call(this,a)},delete:function(){b.prototype.delete.call(this);this.model.off(void 0,void 0,this)},render:function(){var a=this;this.$el.html(g.template({}));this.doWork([function(){return a.model.populated()},function(){a.__actor=a.model.getSingleEdge("actor");var c=a.createChildContext(g.WAFWidgets.ProfileIcon,{user:a.__actor,$parentElement:a.$(".picture"),ignoreClicks:!1});a.__addRenderGatingPromise(c.getHasRenderedPromise());c=a.createChildContext(g.WAFWidgets.DisplayName,{$parentElement:a.$(".primary-text"),user:a.__actor,size:"large",color:"dark",ignoreClicks:!1});a.__addRenderGatingPromise(c.getHasRenderedPromise());"photo"===a.model.get("type")&&((c=a.model.get("payload.message"))&&0<c.length&&(a.__caption=a.createChildContext(g.ExpandingText,{$parentElement:a.$(".caption"),textValue:c}),a.$(".main-info").addClass("has-caption"),a.$(".caption").removeClass("hidden"),a.listenTo(a.__caption,"openText",a.__toggleOpen.bind(a))),a.__onModelChange());c=a.createChildContext(g.FeedItemTimestamp,{$parentElement:a.$(".posted-timestamp"),timestamp:a.model.get("time"),includeAgo:!0});a.__addRenderGatingPromise(c.getHasRenderedPromise());a.model.relations.photo&&(c=a.__showPhotoWith(),a.__addRenderGatingPromise(c));a.model.on("change",a.__onModelChange,a);a.__waitOnRenderGatingPromises()}])},__onModelChange:function(){var a=this;this.doWork([function(){if("photo"===a.model.get("type")){var c=a.model.get("payload.message");a.__caption?a.__caption.changeText(c):!a.__caption&&c&&0<c.length&&(a.__caption=a.createChildContext(g.ExpandingText,{$parentElement:a.$(".caption"),textValue:c}),a.listenTo(a.__caption,"openText",a.__toggleOpen.bind(a)),a.$(".caption").removeClass("hidden"))}}])},__toggleOpen:function(){this.$(".main-info").toggleClass("open")},__showPhotoWith:function(){var a=this;this.__showPhotoWithResolver=null;this.__showPhotoWithPromise=new this.__Promise(function(h){a.__showPhotoWithResolver=h});var c=this.__restModelFactory,e=this,d=!1;this.doWork([function(){return a.model.getSingleEdge("photo").populated()},function(h){if(h.relations.location){d=!0;var f=c.readModel(h.relations.location,g.UiCore.NodeModel);a.__roomModel=f;a.doWork([function(){return f.populated().catch(function(k){if(!k.contents||403!==k.contents.code)throw k})},function(k){k&&"public"===k.attributes.privacy&&!k.attributes.is_ap?(e.$(".photo-room-container").show(),e.$(".text .photo-room-details .room-name").text(k.attributes.name)):(e.$(".photo-room-container").hide(),e.$(".location").hide())}])}return h.getSingleEdge("photo_details").populated()},function(h){h=h.get("users");h=_.pluck(h,"id");h=_.without(h,a.__actor.id);h=_.map(h,function(f){return a.__restModelFactory.readModel(f,g.UiCore.NodeModel).populated()});return a.__Promise.every(h)},function(h){h&&0<h.length?(a.$(".photo-room-container").show(),d||(e.$(".location").css("visibility","hidden"),e.$(".photo-with").css("visibility","hidden"),e.$(".photo-room-container").css("height",0)),a.createChildContext(g.WAFWidgets.DisplayName,{$replaceElement:a.$(".photo-with .username-placeholder"),user:h[0],size:"small",color:"dark",showVipBadge:!1,ignoreClicks:!0}),1<h.length&&(h=2===h.length?a.__globalStringManager.get("with_1_other"):a.__globalStringManager.get("with_x_others",{count:h.length-1}),a.$(".photo-with .with-others").text(h))):e.$(".text .photo-room-details .photo-with").css("visibility","hidden");a.__showPhotoWithResolver.resolve()}]).catch(function(h){a.__showPhotoWithResolver.resolve()});return this.__showPhotoWithPromise},__roomTypeCheckPromise:function(){var a=this.__roomModel;return"closed"!==a.get("type")?this.__Promise.resolve():this.__dialogManager.confirm({no:this.__globalStringManager.get("Cancel"),yes:this.__globalStringManager.get("Open Room"),title:this.model.node.get("name"),text:this.__globalStringManager.get("Open Room confirmation text")}).finished.then(function(){return g.NextUtil.RoomUtil.newEditPromise({globalStringManager:this.__globalStringManager,errorToasterManager:this.__errorToasterManager,window:this.__window,Promise:this.__Promise,roomModel:a,setup:function(){a.set("type","listed");return["type"]}})}.bind(this))},__showRoomDetails:function(){this.__roomTypeCheckPromise().then(function(){this.__dialogManager.showLightbox("RoomDetailLightbox",{model:this.__roomModel})}.bind(this)).catch(function(a){"no"!==a.confirm&&this.__window.console.error(arguments)}.bind(this))}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],ContextMenu:t,ExpandingText:Ka,FeedItemTimestamp:La,StandardHeadpiece:z,template:Te}),Xe=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;return"<div class='more hidden'>"+c((d=a.more_comments_text||b&&b.more_comments_text,"function"===typeof d?d.call(b,{name:"more_comments_text",hash:{},data:e}):d))+"</div>\n<ul class='items'>\n</ul>"},useData:!0})}({}),Ye=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="profile-icon-placeholder"></div>\n<section>\n    <header>\n       <div class="username"></div>\n    </header>\n    <div class="comment-message"></div>\n</section>\n'},useData:!0})}({}),Ze=function(g){var b=g.UiCore.UiContext;return b.extend("FeedCommentsItem",{uiContextName:"feed_comments_item",tagName:"li",className:"feed-comments-item",dependencies:"contextMenuManager conversationHelpers dialogManager featureAccessManager feedModel globalNav globalStartupModel globalStringManager imageManager loginManager restModelFactory timestampHelper".split(" "),trackedEvents:function(){return[{type:"click",selector:".profile-icon",name:"feed_comment_tap_portrait",handler:this.__onClickAuthor},{type:"click",selector:".display-name-text",name:"feed_comment_tap_author",handler:this.__onClickAuthor},{type:"click",selector:".comment-message",name:"feed_comment_tap_message",handler:this.__onClickComment}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__imageManager=a.imageManager;this.__edgeModel=a.model;this.__featureAccessManager=a.featureAccessManager;this.__globalNav=a.globalNav;this.__restModelFactory=a.restModelFactory;this.__conversationHelpers=a.conversationHelpers;this.__dialogManager=a.dialogManager;this.__contextMenuManager=a.contextMenuManager;this.__globalStringManager=a.globalStringManager;this.__startupModel=a.globalStartupModel;this.__reportUrl=this.__startupModel.get("safetyReportUrl");this.__loginManager=a.loginManager;this.__myself=a.loginManager.getCurrentUser();this.__timestampHelper=a.timestampHelper;this.__featureAccessManager=a.featureAccessManager;this.addToDOM()},render:function(){this.__edgeModel.populated().then(function(){var a=this.__edgeModel.node;this.__timeSince=this.__timestampHelper.formatTime(a.get("time"));this.$el.html(g.template);this.__userText=this.createChildContext(g.UserText,{$parentElement:this.$(".comment-message"),text:a.get("text")});this.author=this.__edgeModel.node.getSingleEdge("author");this.$el.toggleClass("is-me",this.author===this.__myself);this.__profileIcon=this.createChildContext(g.WAFWidgets.ProfileIcon,{$replaceElement:this.$(".profile-icon-placeholder"),user:this.author});this.__addRenderGatingPromise(this.__profileIcon.getHasRenderedPromise());this.__displayName=this.createChildContext(g.WAFWidgets.DisplayName,{$replaceElement:this.$(".username"),user:this.author,showVipBadgeTooltip:!0,marginLeft:"medium",size:"small",color:"medium"});this.__addRenderGatingPromise(this.__displayName.getHasRenderedPromise());this.$el.attr("data-cid",this.__edgeModel.cid);this.__conversationHelpers.applyMessageBoundaries(this,this.__edgeModel);this.__waitOnRenderGatingPromises()}.bind(this))},__onClickComment:function(a){a.stopPropagation();var c=this.track(this.__feedModel.getSingleEdge("actor"));this.__loginManager.isLoggedIn()&&this.author.populated().then(function(){var e=this.author.get("id")||this.author.id,d=c.get("id")||c.id,h=[{name:"timestamp",text:this.__timeSince,classNames:"header"}];e=e===this.__loginManager.getCurrentUser().id;d=d===this.__loginManager.getCurrentUser().id;(e||d)&&h.push({name:"delete",text:"Delete",handler:this.__deleteFeedComment.bind(this)});e||h.push({name:"report",text:"Report",handler:this.__reportFeedComment.bind(this)});this.__contextMenuManager.toggleMenu(a,g.ContextMenu,{items:h,displayOptions:{above:!1,right:!0}})}.bind(this))},__reportFeedComment:function(){this.__dialogManager.confirm({title:this.__globalStringManager.get("dialog_feed_report_comment_title"),text:this.__globalStringManager.get("dialog_feed_report_comment_text"),yes:this.__globalStringManager.get("Report"),no:this.__globalStringManager.get("Cancel"),termsOfService:!0}).finished.then(function(){this.__restModelFactory.createModel(this.__reportUrl,g.UiCore.NodeModel,{reason:"comment",relations:{content:this.model.node.id}}).then(function(){this.__dialogManager.alert({title:this.__globalStringManager.get("report_confirm_title"),text:this.__globalStringManager.get("report_confirm_text"),ok:this.__globalStringManager.get("report_confirm_done")})}.bind(this),function(){this.__dialogManager.alert({title:this.__globalStringManager.get("report_error_title"),text:this.__globalStringManager.get("report_error_text"),ok:this.__globalStringManager.get("report_error_done")})}.bind(this))}.bind(this))},__deleteFeedComment:function(){this.__edgeModel.node.destroy()}})}({moment:l["@moment"],UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],ContextMenu:t,UserText:M,template:Ye}),$e=function(g){var b=g.WAFWidgets.EdgeCollectionPresenter;return b.extend("FeedComments",{uiContextName:"feed_comments",className:"feed-comments",dependencies:"conversationHelpers featureAccessManager globalStartupModel globalStringManager multiGetManager rest restModelFactory touchEventHelper".split(" "),initialize:function(a){this.__featureAccessManager=a.featureAccessManager;this.itemFactory=a.itemFactory||g.FeedCommentsItem;a.reverse=!0;a.manuallyPage=!0;this.__touchEventHelper=a.touchEventHelper;this.__globalStringManager=a.globalStringManager;b.prototype.initialize.call(this,a);this.__conversationHelpers=a.conversationHelpers;this.collection.populated().then(function(){this.__multiGetManager.queue(this.collection,this.__multiGetManager.autoRequestPlease);this.__conversationHelpers.refreshAllMessageBoundaries(this)}.bind(this));this.collection.on("add paged reset",function(){this.collection.populated().then(function(){this.__conversationHelpers.refreshAllMessageBoundaries(this)}.bind(this))}.bind(this))},__toggleTimestamp:function(a){this.$el.toggleClass("show-timestamp",a)},__emptyText:function(){return{standard:this.__globalStringManager.get("no_feed_comments"),concise:this.__globalStringManager.get("no_feed_comments")}}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],FeedCommentsItem:Ze}),af=function(g){var b=g.FeedComments;return b.extend("CommentList",{className:"comment-list feed-comments",uiContextName:"comment_list",tagName:"div",dependencies:["globalStringManager","loginManager"],onAdd:function(a,c,e){b.prototype.onAdd.call(this,a,c,e)},trackedEvents:function(){return[{type:"click",selector:".more",name:"view_more",handler:"viewMore"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.collection.populated().then(function(){this.__refreshMore();this.listenTo(this.collection,"add remove reset",this.__refreshMore.bind(this,!0))}.bind(this))},renderTemplate:function(){this.$el.html(g.template({more_comments_text:this.__globalStringManager.get("view_all_comments",{count:this.collection.total_count})}));this.$itemContainer=this.$(".items");b.prototype.renderTemplate.call(this)},__refreshMore:function(a){this.$(".more").toggleClass("hidden",!this.collection.hasNextPage());a&&this.$(".more").text(this.__globalStringManager.get("load_more_comments"))},__childrenInDOM:function(){var a=_.map(_.filter(_.values(this.__registry),function(c){return c.$el}),function(c){return c.$el[0]});return this.$itemContainer.children().filter(a)},__emptyText:function(){if(this.__loginManager.isLoggedIn())return{standard:this.__globalStringManager.get("post_has_no_comments"),concise:this.__globalStringManager.get("post_has_no_comments")}}})}({UiCore:l["@UiCore"],FeedComments:$e,template:Xe}),bf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'\n        <button class="btn ap"></button>\n    '},3:function(b,a,c,e){return'\n        <button class="btn vip"></button>\n    '},5:function(b,a,c,e){var d,h=a.helperMissing;c='\n        <button class="btn requires_friend wh-25 flex items-center justify-center">\n            <div class="wh-20">';if((a=(d=a.icon||b&&b.icon||h,d.call(b,"icon-nav_friends_fill",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)c+=a;return c+"</div>\n        </button>\n    "},7:function(b,a,c,e){var d;c=this.escapeExpression;return"<span class='name'>"+c((d=a.name||b&&b.name,"function"===typeof d?d.call(b,{name:"name",hash:{},data:e}):d))+"</span>"},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=this.escapeExpression;c='<svg version="1.1" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <defs>\n        <filter id="invert-action-'+h((d=a.uid||b&&b.uid,"function"===typeof d?d.call(b,{name:"uid",hash:{},data:e}):d))+'">\n            <feColorMatrix in="SourceGraphic" type="matrix" values="-1 0 0 0 1\n                                                                    0 -1 0 0 1\n                                                                    0 0 -1 0 1\n                                                                    0 0 0 1 0"/>\n        </filter>\n        <mask id="masked-action-'+h((d=a.uid||b&&b.uid,"function"===typeof d?d.call(b,{name:"uid",hash:{},data:e}):d))+'">\n            <image src="" width="100%" height="100%" filter="url(\'#invert-action-'+h((d=a.uid||b&&b.uid,"function"===typeof d?d.call(b,{name:"uid",hash:{},data:e}):d))+'\')" xlink:href="'+h((d=a.image_url||b&&b.image_url,"function"===typeof d?d.call(b,{name:"image_url",hash:{},data:e}):d))+'"></image>\n        </mask>\n    </defs>\n    <rect x="0" y="0" width="100%" height="100%" fill="#000" mask="url(\'#masked-action-'+h((d=a.uid||b&&b.uid,"function"===typeof d?d.call(b,{name:"uid",hash:{},data:e}):d))+"')\" />\n</svg>\n<div class='shields'>\n    ";if((d=a["if"].call(b,b&&b.requires_ap,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n    ";if((d=a["if"].call(b,b&&b.requires_vip,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n    ";if((d=a["if"].call(b,b&&b.requires_friend,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n</div>\n<div class='title'>";if((d=a["if"].call(b,b&&b.show_name,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===d)c+=d;return c+"</div>"},useData:!0})}({}),N=function(g){var b=g.UiCore.UiContext;return b.extend("ActionCatalogItem",{uiContextName:"action_catalog_item",tagName:"li",className:"catalog-item action-catalog-item",dependencies:["globalStringManager","loginManager","Promise","timer"],trackedEvents:function(){return[{type:"click",selector:".title",name:"change_partner",handler:this.__changePartner}]},initialize:function(a){b.prototype.initialize.call(this,a);this.model=a.model;this.__timer=a.timer;this.__myself=a.loginManager.getCurrentUser();this.__Promise=a.Promise;this.__partner=a.partner;this.addToDOM()},__shouldFilter:function(){return this.model.get("requires_ap")&&!this.__myself.get("is_ap")||this.model.get("requires_vip")&&!this.__myself.get("is_vip")},__changePartner:function(a){this.trigger("change-partner",a)},render:function(){this.__Promise.every([this.model.populated(),this.__myself.populated()]).then(function(){if(this.__shouldFilter())return this.__Promise.reject();this.$el.attr("data-id",this.model.id);var a=_.extend(this.model.toJSON(),{uid:this.model.cid+"-"+this.__timer.getTime()}),c=a.name;this.__partner?(a.show_name=!1,a.name=""):a.show_name=!0;this.$el.html(g.template(a));this.__partner&&(c+=" "+this.__globalStringManager.get("with"),this.__partnerDisplayName=this.createChildContext(g.WAFWidgets.DisplayName,{$parentElement:this.$(".title"),user:this.__partner.node,size:"small",color:"light",showVipBadge:!1,prefix:c,ignoreClicks:!0}))}.bind(this)).catch(function(){this.$el.hide()}.bind(this))}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],template:bf}),cf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c="<div class='preview'>\n    <div class='cancel'>\n        <div class=\"wh-20\">";if((a=(d=a.icon||b&&b.icon||h,d.call(b,"icon-dialog_close",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)c+=a;return c+"</div>\n    </div>\n</div>\n<div class='catalog-container'></div>"},useData:!0})}({}),Ma=function(g){var b=g.UiCore.UiContext;return b.extend("ChatBarMenu",{className:"chat-bar-menu",dependencies:[],trackedEvents:function(){return[{type:"click",selector:".preview .cancel",name:"cancel_preview",handler:this.cancelSelection},{type:"click",selector:".catalog-container .catalog-item",name:"click_catalog_item",handler:this.__onClickItem,attributes:function(a){return{item_id:a.data("id")}}},{type:"keyup",name:"enter_catalog_item",handler:this.__onKeyUp,allowBubble:!0}]},initialize:function(a){b.prototype.initialize.call(this,a);this.$el.attr("tabindex",-1);this.$el.attr("data-nodismissonclickinsider",!0);g.NextUtil.DomHelper.dismissible({dismissibleEl:this.$el,dismissHandler:this.__dismissHandler.bind(this)});this.__currentSelection=null;this.addToDOM()},render:function(){this.$el.html(g.template)},connect:function(a){this.cancelSelection()},preloadCatalog:function(){_.delay(function(){this.__catalogCreated||(this.__catalogCreated=!0,this.__createCatalog())}.bind(this))},showCatalog:function(){this.__catalogCreated||(this.__catalogCreated=!0,this.__createCatalog());this.$el.addClass("showing-catalog")},hideCatalog:function(){this.$el.removeClass("showing-catalog");this.cancelSelection()},cancelSelection:function(){this.$(".catalog-item").removeClass("highlighted");this.__setSelection(null)},__setSelection:function(a){this.__currentSelection=a;this.$(".preview").toggle(!!a);this.__updatePreviewContent();this.trigger("change")},__updatePreviewContent:function(){this.__previewContent&&this.__previewContent.delete();this.__currentSelection&&(this.__previewContent=this.__createPreviewContent())},__createPreviewContent:function(){},__onClickItem:function(a){a=$(a.currentTarget);var c=a.data("id");if(c){if(this.getSelectionId()===c)return this.trigger("send");g.NextUtil.DomHelper.radioClass(a,"highlighted");this.__setSelection(c);this.$el.focus()}},__onKeyUp:function(a){this.__currentSelection&&a.keyCode===g.NextUtil.Keys.VK_ENTER&&this.trigger("send")},getSelection:function(){return this.__currentSelection},getSelectionId:function(){return this.__currentSelection},__dismissHandler:function(){this.$el.hasClass("showing-catalog")&&(this.__currentSelection?this.cancelSelection():this.__parentUiContext.collapseMenus())}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:cf}),df=function(g){var b=IMVU.BaseClass;return b.extend("ActionCategorylist",{dependencies:["globalStartupModel","Promise","restModelFactory"],initialize:function(a){b.prototype.initialize.call(this,a);this.__Promise=a.Promise;this.__serviceProvider=a.serviceProvider;this.__actionCategoryUrl=a.globalStartupModel.get("actionCategoryUrl");this.__restModelFactory=a.restModelFactory},search:function(a){return this.__restModelFactory.searchCollection(this.__actionCategoryUrl,a,g.UiCore.NodeCollection)},__getActionsForType:function(a,c){var e={};return a.populated().then(function(){return this.__Promise.every(a.map(function(d){var h=d.get("name");e[h]=d.getEdgeCollection("actions");return e[h].populated()}.bind(this)))}.bind(this)).then(function(){var d={};_.each(e,function(h,f){var k={};h.each(function(m){if(!c.whitelist||_.contains(c.whitelist,m.node.get("name")))c.hasOwnProperty("ap")&&!c.ap&&m.node.get("requires_ap")||c.hasOwnProperty("vip")&&!c.vip&&m.node.get("requires_vip")||c.hasOwnProperty("friend")&&!c.friend&&m.node.get("requires_friend")||(k[m.node.get("name")]=m.node)});0<_.size(k)&&(d[f]=k)}.bind(this));return this.__Promise.accept(d)}.bind(this))},__getActionList:function(a,c){c=void 0===c?{}:c;if("solo"===a)return this.__soloActionCategories||(this.__soloActionCategories=this.search({type:"solo"})),this.__getActionsForType(this.__soloActionCategories,c);if("coop"===a)return this.__coopActionCategories||(this.__coopActionCategories=this.search({type:"coop"})),this.__getActionsForType(this.__coopActionCategories,c);throw Error('Type should be either "solo" or "coop"')},getFlatActionList:function(a,c){return this.__getActionList(a,c).then(function(e){var d=new IMVU.NamedCollection;_.each(e,function(h){_.each(h,function(f,k){d.add(f)}.bind(this))}.bind(this));return this.__Promise.accept(d)}.bind(this)).catch(function(e){window.console.log(e);return this.__Promise.reject(e)}.bind(this))},__getActionBySelector:function(a,c,e){return new this.__Promise(function(d){this.getFlatActionList(a).then(function(h){(h=h.find(c))?d.resolve(h):d.reject(e)}.bind(this))}.bind(this))},getActionForCommand:function(a,c){return this.__getActionBySelector(a,function(e){return e.get("pitcher_action")===c},'Command "'+c+'" not found in '+a+" actions")},getActionForName:function(a,c){return this.__getActionBySelector(a,function(e){return e.get("name").toLowerCase()===c.toLowerCase()},'Command "'+c+'" not found in '+a+" actions")}})}({UiCore:l["@UiCore"]}),Na=function(g){var b=g.UiCore.UiContext;return b.extend("ActionCatalog",{uiContextName:"action_catalog",className:"action-catalog is-list",tagName:"ul",initialize:function(a){b.prototype.initialize.call(this,a);this.collection=a.collection;this.addToDOM()},render:function(){this.$el.css("overflow-y","auto");this.collection.each(function(a){this.createChildContext(g.ActionCatalogItem,{$parentElement:this.$el,model:a})}.bind(this));this.$el.scrollbar();this.listenTo(this.collection,"add",function(a){this.createChildContext(g.ActionCatalogItem,{$parentElement:this.$el,model:a})}.bind(this))}})}({UiCore:l["@UiCore"],ActionCatalogItem:N}),Y=function(g){var b={solo:"Clap Nod Yay Smile Nope Breakdance Kick Sleep".split(" "),coop:"Shake;Hi-5;BearHug;Bow;Cheek Kiss;Blow Kiss;Hug;Light Hug;Punch;Slap".split(";")},a=g.ChatBarMenu;return a.extend("ActionMenu",{initialize:function(c){a.prototype.initialize.call(this,c);this.__serviceProvider=c.serviceProvider;this.__actionCategoryList=c.serviceProvider.create(c.actionCategoryListFactory||g.ActionCategoryList)},__createCatalog:function(){this.$el.addClass("loading");this.__actionCategoryList.getFlatActionList(this.actionType,{whitelist:b[this.actionType]}).then(function(c){this.__actionCollection=c;this.$el.removeClass("loading");this.createChildContext(g.ActionCatalog,{$parentElement:this.$(".catalog-container"),collection:c})}.bind(this))}})}({UiCore:l["@UiCore"],ActionCatalog:Na,ActionCategoryList:df,ChatBarMenu:Ma}),Oa=function(g){var b=g.ActionMenu;return b.extend("SoloActionMenu",{uiContextName:"solo_action_menu",payloadName:"solo_action",className:"chat-bar-menu solo-action-menu",actionType:"solo",__setSelection:function(a){b.prototype.__setSelection.call(this,a?this.__actionCollection.get(a):null)},getSelectionId:function(){return this.__currentSelection?this.__currentSelection.id:this.__currentSelection},__createPreviewContent:function(){return this.createChildContext(g.ActionCatalogItem,{$parentElement:this.$(".preview"),model:this.getSelection()})}})}({UiCore:l["@UiCore"],ActionCatalogItem:N,ActionMenu:Y}),ef=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f="<div class='menu-bar magic-line-menu'>\n    <ul class='menu-tabs'></ul>\n    <div class='magic-line'></div>\n</div>\n<div class='bar'>\n    <div class='relative menu-toggle w-20 h-30 fade-hover'>\n        <div class=\"absolute menu-toggle-collapsed wh-full transiion-opacity duration-150\">",k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-action_stickers",{name:"icon",hash:{class:"wh-full"},data:e}));if(k||0===k)f+=k;f+='</div>\n        <div class="absolute menu-toggle-expanded wh-full transition-opacity duration-150">';if((k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-dialog_close",{name:"icon",hash:{class:"wh-full"},data:e})))||0===k)f+=k;return f+'</div>\n    </div>\n    <textarea class="input-text no-focus" type="text" placeholder="'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Say something...",{name:"i18n-g",hash:{},data:e})))+'"></textarea>\n    <button class="btn btn-small btn-ghost btn-strokeless btn-send" type="submit" data-room-type="chat" disabled>'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Send",{name:"i18n-g",hash:{},data:e})))+"</button>\n</div>"},useData:!0})}({}),ff=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h="<div class='preview'>\n    <div class='cancel'>\n        <div class=\"wh-20\">",f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-dialog_close",{name:"icon",hash:{class:"wh-full"},data:e}));if(f||0===f)h+=f;h+="</div>\n    </div>\n</div>\n<div class='catalog-container'>\n    <div class='no-partner-message notation'>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"no_coop_partners",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</div>\n</div>"},useData:!0})}({}),gf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h="<div class='header'>",f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"coop_with",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+="</div>\n<div class='items is-list'>\n    <ul></ul>\n</div>\n<div class='error-message'>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"coop_partner_context_error",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</div>"},useData:!0})}({}),hf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return"<li>\n    <span class='username'></span>\n</li>"},useData:!0})}({}),Pa=function(g){var b=g.ContextMenu;return b.extend("CoopPartnerMenu",{uiContextName:"coop_partner_menu",tagName:"div",className:"context-menu coop-partner-menu",dependencies:["loginManager","Promise"],initialize:function(a){this.__requirements=a.requirements||{};this.__Promise=a.Promise;this.__myself=a.loginManager.getCurrentUser();b.prototype.initialize.call(this,a)},render:function(){this.$el.html(g.template);this.$(".items").addClass("loading");_.isEmpty(this.__requirements)?this.__onLoaded():this.__Promise.every(_.map(this.__items,function(a){return a.user.populated()})).then(this.__onLoaded.bind(this))},__onLoaded:function(){_.any(this.__items,function(a){return this.__checkPartnerRequirements(a.user)}.bind(this))?(_.each(this.__items,function(a){this.__createUserItem(a)}.bind(this)),this.$(".items").removeClass("loading").scrollbar(),this.trigger("resize")):this.$el.addClass("error")},__checkPartnerRequirements:function(a){return this.__requirements.ap&&!a.get("is_ap")||this.__requirements.friend&&!a.relations.viewer_friend?!1:!0},__createUserItem:function(a){var c=a.user;if(c.id!==this.__myself.id){a=$(g.itemTemplate()).attr("data-menu-item",a.name).addClass(a.classNames);this.$("ul").append(a);var e=this.createChildContext(g.WAFWidgets.DualName,{$replaceElement:a.find(".username"),user:c,configuration:"small-dual-lightbg",ignoreClicks:!0,hoverOn:!0});a.on("mouseenter",function(){e.onMouseover()});a.on("mouseleave",function(){e.onMouseleave()});this.__checkPartnerRequirements(c)||a.addClass("disabled")}}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],ContextMenu:t,itemTemplate:hf,template:gf}),Qa=function(g){var b=g.ActionMenu;return b.extend("CoopActionMenu",{uiContextName:"coop_action_menu",payloadName:"coop_action",className:"chat-bar-menu coop-action-menu",actionType:"coop",dependencies:["contextMenuManager","dialogManager","globalStringManager","loginManager"],initialize:function(a){b.prototype.initialize.call(this,a);this.__contextMenuManager=a.contextMenuManager;this.__myself=a.loginManager.getCurrentUser();this.__activeChat=a.activeChat;this.__stringManager=a.globalStringManager;this.__dialogManager=a.dialogManager;this.__preselectedPartner=null},__refreshPartners:function(){this.$el.toggleClass("no-partners",2>this.__participants.length)},render:function(){this.$el.html(g.template)},connect:function(a){b.prototype.connect.call(this,a);this.__activeChat=a;(this.__isLiveRoom=a.isLiveRoom())?this.__participants=this.__activeChat.getPresenters():(this.__participants&&(this.__participants.off(null,null,this),this.untrack(this.__participants)),this.__participants=this.track(this.__activeChat.getParticipants()),this.__refreshPartners(),this.__participants.on("add remove reset",this.__refreshPartners,this))},__onClickItem:function(a){var c=$(a.currentTarget).data("id");c&&(this.__preselectedPartner?this.__vetActionForPreselectedPartner(c):this.__choosePartner(c,a))},__onDoubleClickItem:function(){},__vetActionForPreselectedPartner:function(a){var c=this.__actionCollection.get(a);c.get("requires_ap")&&!this.__preselectedPartner.node.get("is_ap")?this.__dialogManager.alert({title:this.__stringManager.get("coop_partner_dialog_title"),text:this.__stringManager.get("coop_partner_dialog_text_ap"),ok:this.__stringManager.get("coop_partner_dialog_ok")}):c.get("requires_friend")&&!this.__preselectedPartner.node.relations.viewer_friend?this.__dialogManager.alert({title:this.__stringManager.get("coop_partner_dialog_title"),text:this.__stringManager.get("coop_partner_dialog_text_friend"),ok:this.__stringManager.get("coop_partner_dialog_ok")}):this.__selectCoopAction(a,this.__preselectedPartner)},hideCatalog:function(){b.prototype.hideCatalog.call(this);this.__maybeClearPreselected()},cancelSelection:function(){b.prototype.cancelSelection.call(this);this.__maybeClearPreselected()},__maybeClearPreselected:function(){this.getSelection()||this.$el.hasClass("showing-catalog")||(this.__preselectedPartner=null)},preselectPartner:function(a){this.__preselectedPartner=this.__participants.find(function(c){return c.node&&c.node.id===a.id});this.cancelSelection()},__choosePartner:function(a,c){this.__preselectedPartner=null;if(this.__isLiveRoom){this.__participants=this.__activeChat.getPresenters();var e=_.compact(this.__participants.map(function(h){if(h.node&&h.node.id!==this.__myself.id)return{name:h.node.id,user:h.node,handler:this.__selectCoopAction.bind(this,a,h)}}.bind(this)))}else e=_.compact(this.__participants.map(function(h){if(h.node&&h.node.id!==this.__myself.id)return{name:h.edge.id,user:h.node,handler:this.__selectCoopAction.bind(this,a,h)}}.bind(this)));var d=this.__actionCollection.get(a);this.__contextMenuManager.showMenu(c,g.CoopPartnerMenu,{items:e,displayOptions:{above:!0,right:!1},requirements:{ap:!!d.get("requires_ap"),friend:!!d.get("requires_friend")}})},__selectCoopAction:function(a,c){var e=this.$('[data-id="'+a+'"]');g.NextUtil.DomHelper.radioClass(e,"highlighted");this.__setSelection({action:this.__actionCollection.get(a),partner:c})},__createPreviewContent:function(){var a=this.createChildContext(g.ActionCatalogItem,{$parentElement:this.$(".preview"),model:this.getSelection().action,partner:this.getSelection().partner});a.on("change-partner",this.__choosePartner.bind(this,this.getSelection().action.id));return a},delete:function(){!this.__isLiveRoom&&this.__participants&&this.__participants.off(null,null,this);b.prototype.delete.call(this)}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],ActionCatalogItem:N,ActionMenu:Y,CoopPartnerMenu:Pa,template:ff}),jf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'\n        <button class="btn ap"></button>\n    '},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;c='<div class="product-item">\n    <div class="product-arrow">\n        <div class="arrow"></div>\n    </div>\n    <div class=\'title\'><span class=\'product\'>'+c((d=a.product_name||b&&b.product_name,"function"===typeof d?d.call(b,{name:"product_name",hash:{},data:e}):d))+"</span></div>\n    <div class='shields'>\n    ";if((b=a["if"].call(b,b&&b.is_ap,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)c+=b;return c+"\n    </div>\n</div>\n"},useData:!0})}({}),kf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;return"<div class='title'><span class='trigger'>"+c((d=a.trigger_name||b&&b.trigger_name,"function"===typeof d?d.call(b,{name:"trigger_name",hash:{},data:e}):d))+"</span></div>\n"},useData:!0})}({}),lf=function(g){var b=g.UiCore.UiContext;return b.extend("PidActionCatalogItem",{uiContextName:"pid_action_catalog_item",tagName:"li",className:"catalog-item pid-action-catalog-item disable-text-selection",dependencies:["loginManager","Promise"],initialize:function(a){b.prototype.initialize.call(this,a);this.model=a.model;this.__myself=a.loginManager.getCurrentUser();this.__Promise=a.Promise;this.addToDOM()},render:function(){this.model.populated().then(function(){this.$el.attr("data-id",this.model.id);this.$el.html(g.template(this.model.toJSON()))}.bind(this)).catch(function(){this.$el.hide()}.bind(this))}})}({UiCore:l["@UiCore"],ActionCatalog:Na,template:kf}),mf=function(g){var b=g.UiCore.UiContext;return b.extend("PidActionCatalog",{uiContextName:"pid_action_catalog",className:"pid-action-catalog is-list",tagName:"ul",initialize:function(a){b.prototype.initialize.call(this,a);this.collection=a.collection;this.addToDOM()},addItem:function(a){this.createChildContext(g.PidActionCatalogItem,{$parentElement:this.$el,model:a})},render:function(){this.collection.each(this.addItem.bind(this));this.listenTo(this.collection,"add",this.addItem)}})}({UiCore:l["@UiCore"],PidActionCatalogItem:lf}),nf=function(g){var b=g.UiCore.UiContext;return b.extend("PidProductCatalogItem",{uiContextName:"pid_product_catalog_item",tagName:"li",className:"catalog-item pid-product-catalog-item",dependencies:["loginManager","Promise","templateArgs"],initialize:function(a){b.prototype.initialize.call(this,a);this.collection=a.collection;this.__myself=a.loginManager.getCurrentUser();this.addToDOM()},render:function(){this.$el.html(g.template(this.__templateArgs));this.createChildContext(g.PidActionCatalog,{$parentElement:this.$el,collection:this.collection})}})}({UiCore:l["@UiCore"],PidActionCatalog:mf,template:jf}),of=function(g){var b=g.UiCore.UiContext;return b.extend("PidProductCatalog",{uiContextName:"pid_product_catalog",className:"pid-product-catalog is-list",tagName:"ul",initialize:function(a){b.prototype.initialize.call(this,a);this.collection=a.collection;this.triggersByProduct={};this.addToDOM()},addTrigger:function(a){a.populated().then(function(){this.triggersByProduct[a.get("productId")]||(this.triggersByProduct[a.get("productId")]=this.createChildContext(g.PidProductCatalogItem,{$parentElement:this.$el,templateArgs:{product_name:a.get("product_name"),is_ap:a.get("is_ap")},collection:new IMVU.NamedCollection}));this.triggersByProduct[a.get("productId")].collection.add(a)}.bind(this))},render:function(){this.$el.css("overflow-y","auto");this.collection.each(this.addTrigger.bind(this));this.listenTo(this.collection,"add",this.addTrigger);this.$el.scrollbar()}})}({UiCore:l["@UiCore"],PidProductCatalogItem:nf}),pf=function(g){var b=g.ActionMenu;return b.extend("PidActionMenu",{uiContextName:"pid_action_menu",payloadName:"trigger",className:"chat-bar-menu pid-action-menu",actionType:"pid",dependencies:["Promise"],initialize:function(a){b.prototype.initialize.call(this,a);this.__Promise=a.Promise;this.__connected=new this.__Promise(function(c){this.__connectedResolver=c}.bind(this))},connect:function(a){this.__connectedResolver.accept(a)},__createCatalog:function(){this.$el.addClass("loading");this.__connected.then(function(a){this.__avatarTriggers=a.get("triggerList");return this.__avatarTriggers.populated()}.bind(this)).then(function(){this.$el.removeClass("loading");this.__catalog=this.createChildContext(g.PidProductCatalog,{$parentElement:this.$(".catalog-container"),collection:this.__avatarTriggers});this.trigger("item_list",this.__avatarTriggers.length);this.listenTo(this.__avatarTriggers,"reset",function(){this.removeChildContext(this.__catalog);this.__catalog.delete();this.$(".pid-product-catalog").remove();this.__catalog=this.createChildContext(g.PidProductCatalog,{$parentElement:this.$(".catalog-container"),collection:this.__avatarTriggers})}.bind(this));this.listenTo(this.__avatarTriggers,"add reset remove",function(){this.trigger("item_list",this.__avatarTriggers.length)}.bind(this))}.bind(this))},__onClickItem:function(a){var c=$(a.currentTarget);c.data("id")?b.prototype.__onClickItem.call(this,a):c.hasClass("opened")?(c.find(".pid-action-catalog-item").removeClass("highlighted"),this.__setSelection(null),c.removeClass("opened")):g.NextUtil.DomHelper.radioClass(c,"opened")},__setSelection:function(a){b.prototype.__setSelection.call(this,a?this.__avatarTriggers.get(a):null)},getSelectionId:function(){return this.__currentSelection?this.__currentSelection.id:this.__currentSelection},__createPreviewContent:function(){var a=new IMVU.NamedModel;a.set({name:this.getSelection().get("trigger_name"),image_url:"https://static-akm.imvu.com/imvufiles/actions/actions_trigger_preview.png"});a.populated=function(){return this.__Promise.accept()}.bind(this);return this.createChildContext(g.ActionCatalogItem,{$parentElement:this.$(".preview"),model:a})}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],ActionCatalogItem:N,ActionMenu:Y,PidProductCatalog:of}),qf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f="<div class='whisper-cancel-bar'>\n   Whispering to <span class='font-medium'>@"+c((d=a.whisperRecipient||b&&b.whisperRecipient,"function"===typeof d?d.call(b,{name:"whisperRecipient",hash:{},data:e}):d))+'</span><span class="whisper-close">',k=(d=a.icon||b&&b.icon||h,d.call(b,"icon-close",{name:"icon",hash:{},data:e}));if(k||0===k)f+=k;f+="</span>\n</div>\n<div class='bar'>\n    <div class='relative menu-toggle w-20 h-30 fade-hover invisible'>\n        <div class=\"absolute menu-toggle-collapsed wh-full transiion-opacity duration-150\">";if((k=(d=a.icon||b&&b.icon||h,d.call(b,"icon-action_stickers",{name:"icon",hash:{class:"wh-full"},data:e})))||0===k)f+=k;f+='</div>\n        <div class="absolute menu-toggle-expanded wh-full transition-opacity duration-150">';if((k=(d=a.icon||b&&b.icon||h,d.call(b,"icon-dialog_close",{name:"icon",hash:{class:"wh-full"},data:e})))||0===k)f+=k;return f+'</div>\n    </div>\n    <textarea class="input-text no-focus" type="text" placeholder="'+c((d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"whisper_chat_bar_whisper_something",{name:"i18n-g",hash:{},data:e})))+'"></textarea>\n    <button class="btn btn-small btn-ghost btn-strokeless btn-send whisper" type="submit" data-room-type="chat" disabled>'+c((d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"whisper_chat_bar_whisper",{name:"i18n-g",hash:{},data:e})))+"</button>\n</div>"},useData:!0})}({}),rf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="shiny-tooltip__content">\n    <div class="shiny-tooltip__shape">\n        <span class="shiny-tooltip__icon"></span>\n        <span class="shiny-tooltip__text"></span>\n    </div>\n</div>\n'},useData:!0})}({}),sf=function(g){var b=g.UiCore.UiContext;return b.extend("ShinyTooltip",{className:"shiny-tooltip",uiContextName:"shiny_tooltip",dependencies:[],trackedEvents:function(){return[]},initialize:function(a){b.prototype.initialize.call(this,a);this.__side=IMVU.optionalProperty(a,"side","left");this.addToDOM()},render:function(){this.$el.html(g.template());this.el.classList.add("shiny-tooltip--"+this.__side+"-side");this.__icon=this.el.querySelector(".shiny-tooltip__icon");this.__text=this.el.querySelector(".shiny-tooltip__text")},setContent:function(a,c){this.__text.innerHTML=a?a:"";if(""!==c){for(;this.__icon.firstChild;)this.__icon.removeChild(this.__icon.firstChild);this.__icon.appendChild(document.createRange().createContextualFragment(c))}else this.__icon.innerHtml=""},showTooltip:function(a){this.el.classList.toggle("is-active",a)}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],template:rf}),tf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="preview">\n    <div class="cancel"></div>\n    <div class="shuffle"></div>\n</div>\n<div class="catalog-container">\n    <div class="detail-container">\n        <div class="catalog-error-content">\n            <div class="title">',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"sticker_error_title",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+="</div>\n            <div class='icon'></div>\n            <div>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"sticker_error_text",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+'</div>\n        </div>\n    </div>\n</div>\n<div class="catalog-menu-bar">\n    <a class="contextual-dressup"></a>\n    <a class="recent-stickers"></a>\n    <div class="catalog-menu small-simple-scroller"></div>\n    <a class="add-catalog">\n        <div class="new-badge hidden"></div>\n    </a>\n</div>\n'},useData:!0})}({}),uf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;a=this.escapeExpression;return'\n    <li class="segmented-control-item" data-value="'+a((d=null==e||!1===e?e:e.key,"function"===typeof d?d.apply(b):d))+'">\n        '+a("function"===typeof b?b.apply(b):b)+"\n    </li>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c='<ul class="disable-text-selection">\n    ';if((b=a.each.call(b,b&&b.options,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)c+=b;return c+"\n</ul>\n"},useData:!0})}({}),Z=function(g){var b=g.UiCore.UiContext;return b.extend("SegmentedControl",{className:"segmented-control",uiContextName:"segmented_control",dependencies:["loginManager","name","options","window"],trackedEvents:function(){return[{type:"click",selector:".segmented-control-item",name:"segmented_control_item_click",handler:this.__onClickItem.bind(this),allowBubble:!0}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__name=a.name;this.__options=a.options;this.__loginManager=a.loginManager;this.__isLoggedIn=this.__loginManager.isLoggedIn();this.addToDOM();this.$(".segmented-control-item").first().addClass("is-selected")},render:function(){this.$el.html(g.template({name:this.__name,options:this.__options}))},__select:function(a){if(!this.__isLoggedIn){var c=this.$(".segmented-control-item[data-value=comments] .counter .count");c.removeClass("count");c.addClass("hidden");c=this.$(".segmented-control-item[data-value=likes] .counter .count");c.removeClass("count");c.addClass("hidden");c=this.$(".segmented-control-item[data-value=tags] .counter .count");c.removeClass("count");c.addClass("hidden")}a=$(a);a.hasClass("is-selected")||(g.NextUtil.DomHelper.radioClass(a,"is-selected"),a.trigger("change"))},__onClickItem:function(a){this.__select(a.currentTarget)},toggleOption:function(a,c){this.$(".segmented-control-item[data-value="+a+"]").prop("disabled",!c)},val:function(a){if(!a)return this.$(".segmented-control-item.is-selected").attr("data-value");this.__select(this.$(".segmented-control-item[data-value="+a+"]"))}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:uf}),vf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return"<div class='img-container'>\n    <img />\n</div>"},useData:!0})}({}),aa=function(g){var b=g.UiCore.UiContext;return b.extend("Sticker",{className:"sticker",uiContextName:"sticker",dependencies:"contextMenuManager defer dialogManager featureAccessManager globalStringManager imageManager prefsManager".split(" "),trackedEvents:function(){return[{type:"click",selector:"img",name:"show_context_menu",handler:this.__showContextMenu},{type:"click",selector:"canvas",name:"show_context_menu",handler:this.__showContextMenu},{type:"click",name:"tile",handler:this.__onTileClick}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__contextMenuManager=a.contextMenuManager;this.__dialogManager=a.dialogManager;this.__featureAccessManager=a.featureAccessManager;this.__imageManager=a.imageManager;this.__prefsManager=a.prefsManager;this.__globalStringManager=a.globalStringManager;this.__defer=a.defer;this.__imageUrl=a.imageUrl;this.__customContextMenus=a.customContextMenus?a.customContextMenus:[];this.__allowSafetyReport="allowSafetyReport"in a?a.allowSafetyReport:!1;this.addToDOM()},render:function(){this.$el.html(g.template);this.$img=this.$("img");this.__loadImage()},delete:function(){this.$img.off().removeAttr("src");b.prototype.delete.call(this)},__reload:function(){var a=$('img[src="'+this.__imageUrl+'"]');_.each(a,function(c){c.src=""});_.each(a,function(c){c.src=this.__imageUrl}.bind(this));this.__defer(function(){this.$img[0].src=this.__imageUrl}.bind(this))},__showContextMenu:function(a){var c=[];if(this.__customContextMenus.length)for(var e=0;e<this.__customContextMenus.length;e++)c.push(this.__customContextMenus[e]);c.push({name:"reload",text:this.__globalStringManager.get("sticker_context_menu_reload"),handler:this.__reload.bind(this)});this.__allowSafetyReport&&c.push({name:"report",text:this.__globalStringManager.get("sticker_context_menu_report"),handler:function(){this.trigger("safety_report")}.bind(this)});this.__contextMenuManager.showMenu(a,g.ContextMenu,{items:c,displayOptions:{above:!1,right:!1}})},__loadImage:function(){this.__prefsManager.populated().then(function(){var a=this.__prefsManager.getBool("next.gif_animations.disabled"),c=this.$el.siblings(".shimmer-container");void 0!==c&&c.addClass("shimmer-on");this.__imageManager.load(this.$img,this.__imageUrl,{container:this.$el,forceStaticImage:a}).then(function(){this.$img.off();var e=this.$el.siblings(".shimmer-container");void 0!==e&&e.removeClass("shimmer-on");a||this.__reload()}.bind(this)).catch(function(){this.$img.off()}.bind(this))}.bind(this))},__onTileClick:function(){this.$el.hasClass("error")&&(this.$el.removeClass("error"),this.__loadImage())}})}({UiCore:l["@UiCore"],ContextMenu:t,template:vf}),ba=function(g){var b=g.Sticker;return b.extend("StickerPreview",{className:"sticker sticker-preview",uiContextName:"sticker_preview",dependencies:["globalStartupModel","restModelFactory"],initialize:function(a){this.__context=a.context;this.__stickerTemplate=a.stickerTemplate;this.__startupModel=a.globalStartupModel;this.__restModelFactory=a.restModelFactory;this.__rest=a.serviceProvider.get("rest");this.__participants=a.participants;this.__ownedPreview=IMVU.optionalProperty(a,"ownedPreview",!0);b.prototype.initialize.call(this,a)},__loadImage:function(){this.$el.addClass("loading");var a={sticker_template:this.__stickerTemplate,participants:this.__participants};this.__context&&(a.context=this.__context.id);this.__ownedPreview?this.__startupModel.populated().then(function(){return this.__restModelFactory.simplePOST(this.__startupModel.get("stickerInstanceUrl"),{is_preview:!0,relations:a})}.bind(this)).then(function(c){this.__deleted||(this.__imageUrl=c.data.ssr_url,b.prototype.__loadImage.call(this))}.bind(this)).catch(function(c){this.trigger("preview-error",c,this.__stickerTemplate);this.$el.removeClass("loading").addClass("error");c=this.$el.prev(".shimmer-container");void 0!==c&&c.removeClass("shimmer-on")}.bind(this)):(this.__imageUrl=this.__stickerTemplate,b.prototype.__loadImage.call(this))}})}({UiCore:l["@UiCore"],Sticker:aa}),Ra=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="sticker-menu"></div>\n<div class="catalog"></div>\n'},useData:!0})}({}),Sa=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<img class=\'sticker-thumbnail\'/>\n<div class="shimmer-container"><div class="shimmer"></div></div>'},useData:!0})}({}),Ta=function(g){var b=g.UiCore.UiContext;return b.extend("StickerItem",{uiContextName:"sticker_catalog_item",tagName:"li",className:"catalog-item sticker-item",dependencies:["featureAccessManager","imageManager","loginManager","restModelFactory"],trackedEvents:function(){return this.__canPreview?[{type:"click",name:"toggle_preview",handler:this.togglePreview}]:[]},initialize:function(a){this.__restModelFactory=a.restModelFactory;this.__myself=a.loginManager.getCurrentUser();this.__imageManager=a.imageManager;this.__featureAccessManager=a.featureAccessManager;this.__canPreview=!!a.canPreview;b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){this.model.populated().then(function(){this.$el.html(g.template).attr({"data-id":this.model.node.id,"data-participant_count":this.model.node.get("participant_count")});this.__imageManager.load(this.$(".sticker-thumbnail"),this.model.edge.get("thumbnail_url"),{defaultImage:"/common/withme/img/sticker_template_error.png"})}.bind(this)).catch(function(){this.$el.hide()}.bind(this))},togglePreview:function(){this.__triggerStickerPreviewSelected();this.__preview||(this.__preview=this.createChildContext(g.StickerPreview,{$parentElement:this.$el,stickerTemplate:this.model.node.get("preview_image"),participants:[this.__myself.id],ownedPreview:!1}),this.listenTo(this.__preview,"loading-complete",this.__triggerStickerPreviewComplete));this.$el.toggleClass("previewing").siblings().removeClass("previewing")},__triggerStickerPreviewSelected:function(){this.$el.hasClass("no-overlay")?this.collection.trigger("clear-preview"):this.collection.trigger("load-preview");this.$el.toggleClass("no-overlay")}})}({UiCore:l["@UiCore"],StickerPreview:ba,template:Sa}),wf=function(g){var b=g.WAFWidgets.EdgeCollectionPresenter;return b.extend("StickerTemplateList",{uiContextName:"catalog_menu_list",className:"catalog-menu-list",itemFactory:g.StickerItem,dependencies:["collection","globalStringManager","selectedTab"],initialize:function(a){this.__stringManager=a.globalStringManager;b.prototype.initialize.call(this,a);this.listenTo(this.collection,"load-preview",function(){this.$(".catalog-item").removeClass("no-overlay").addClass("preview-selected")});this.listenTo(this.collection,"clear-preview",function(){this.$(".catalog-item").removeClass("preview-selected")})},__emptyText:function(){var a=this.__stringManager.get("sticker_templates_empty_solo"),c=this.__stringManager.get("sticker_templates_empty_coop");return{emptySolo:{standard:a,concise:a},emptyCoop:{standard:c,concise:c}}},__updateEmpty:function(){if(0===this.collection.models.length&&!this.__$empty){var a=this.__emptyText();a?"single"===this.__selectedTab?(this.__$empty=$(g.emptyTemplate({standard:a.emptySolo.standard,concise:a.emptySolo.concise})),this.$el.append(this.__$empty)):"cooperative"===this.__selectedTab&&(this.__$empty=$(g.emptyTemplate({standard:a.emptyCoop.standard,concise:a.emptyCoop.concise})),this.$el.append(this.__$empty)):b.prototype.__updateEmpty.call(this)}}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],StickerItem:Ta,emptyTemplate:L}),ca=function(g){var b=g.UiCore.UiContext;return b.extend("StickerPackDetail",{className:"sticker-pack-detail",uiContextName:"sticker_pack_detail",dependencies:["globalStringManager"],trackedEvents:function(){return b.prototype.trackedEvents.call(this).concat([{type:"change",selector:".sticker-menu [data-value]",name:"sticker_types",handler:this.__onChangeStickerType,attributes:function(a){return{tab_type:a.attr("data-value")}}}])},initialize:function(a){b.prototype.initialize.call(this,a);this.__model=a.model;this.__startingTab=a.startingTab;this.__canPreview=!!a.canPreview;this.addToDOM()},render:function(){this.$el.html(g.template);this.catalogTabs=this.createChildContext(g.SegmentedControl,{$parentElement:this.$(".sticker-menu"),name:"catalogTab",options:{all:this.__globalStringManager.get("All"),single:this.__globalStringManager.get("Solo"),cooperative:this.__globalStringManager.get("Group")}});this.catalogTabs.val(this.__startingTab);this.__showStickers()},selectTab:function(a){this.catalogTabs.val(a)},__showStickers:function(){this.__stickerTemplateList&&this.__stickerTemplateList.delete();this.__templateCollection&&this.untrack(this.__templateCollection);var a={},c=this.catalogTabs.val();"all"!==c&&(a.type=c);c=this.$(".segmented-control-item.is-selected");c=c.eq(c.length-1).data("value");this.__templateCollection=this.track(this.__model.searchEdgeCollection("sticker_templates",a,g.UiCore.EdgeCollection));this.__stickerTemplateList=this.createChildContext(g.StickerTemplateList,{$parentElement:this.$(".catalog"),collection:this.__templateCollection,canPreview:this.__canPreview,selectedTab:c});this.__templateCollection.enumerated().then(function(){this.trigger("updated")}.bind(this),function(){this.untrack(this.__templateCollection);this.__templateCollection.release();this.trigger("error")}.bind(this))},__onChangeStickerType:function(a){this.__showStickers()}})}({UiCore:l["@UiCore"],SegmentedControl:Z,StickerTemplateList:wf,template:Ra}),xf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="sticker-packs"></div>'},useData:!0})}({}),yf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d,h=a.helperMissing;c='\n        <p class="in-inventory">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"IN INVENTORY",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</p>\n    "},3:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f='\n        <p class="in-inventory hidden">';if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"IN INVENTORY",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+'</p>\n        <p class="price-credits">'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</p>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;c='<div class="is-new"></div>\n<div class="tile-thumbnail">\n    <div class="cover-image"></div>\n</div>\n<div class="tile-footer">\n    <div class="tile-name is-truncated">'+c((d=a.product_name||b&&b.product_name,"function"===typeof d?d.call(b,{name:"product_name",hash:{},data:e}):d))+"</div>\n\n    \n    ";if((b=a["if"].call(b,b&&b.is_owned,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===b)c+=b;return c+"\n</div>"},useData:!0})}({}),zf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return"New"},useData:!0})}({}),O=function(g){var b=g.UiCore.UiContext;return b.extend("IsNewTag",{className:"is-new-tag",uiContextName:"is_new_tag",tagName:"span",initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){this.$el.html(g.template())}})}({UiCore:l["@UiCore"],template:zf}),Af=function(g){return{render:function(b,a){b.html(g.template(a));b.find(".product-select").prop("checked",a.checked);if(a.preview_image){var c=a.preview_image;a.imageHeight&&a.imageWidth&&(c=IMVU.URI.build(c,{width:a.imageWidth,height:a.imageHeight}));b.find("img").attr({src:c})}a.creator&&(b.addClass("has-creator"),b.find(".creator-name").text(a.creator.display_name))}}}({template:function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return"\n    <div class='also-tried-on'>YOU ALSO TRIED ON</div>\n"},3:function(b,a,c,e){return'<button class="btn ap ap-badge"></button>'},5:function(b,a,c,e){var d;c=this.escapeExpression;return"\n        <div class='name'>"+c((d=a.name||b&&b.name,"function"===typeof d?d.call(b,{name:"name",hash:{},data:e}):d))+"</div>\n    "},7:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f="\n    <div class='price-vcoin font-medium text-12 flex'>\n        <div class=\"wh-15 mr-5\">";if((h=(d=a.icon||b&&b.icon||h,d.call(b,"icon-vcoin",{name:"icon",hash:{class:"wh-full"},data:e})))||0===h)f+=h;return f+'</div>\n        <div class="vcoin-value">'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</div>\n    </div>\n    "},9:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f="\n    <div class='price-credits font-medium text-12 flex'>\n        <div class=\"wh-15 mr-5\">";if((h=(d=a.icon||b&&b.icon||h,d.call(b,"icon-credits",{name:"icon",hash:{class:"wh-full"},data:e})))||0===h)f+=h;return f+'</div>\n        <div class="credits-value">'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</div>\n    </div>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h="",f=a["if"].call(b,b&&b.also_tried_on,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)h+=f;h+="\n<input id='cart-item-"+c((d=a.product_id||b&&b.product_id,"function"===typeof d?d.call(b,{name:"product_id",hash:{},data:e}):d))+"' class='checkbox product-select' "+c((d=a.checked||b&&b.checked,"function"===typeof d?d.call(b,{name:"checked",hash:{},data:e}):d))+" type='checkbox'>\n<label class='product-info' for='cart-item-"+c((d=a.product_id||b&&b.product_id,"function"===typeof d?d.call(b,{name:"product_id",hash:{},data:e}):d))+"'>\n    <div class='cart-image placeholder-container'>\n        <img>\n        <div class=\"cover-image-placeholder hidden\"></div>\n        ";if((f=a["if"].call(b,b&&b.isAp,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)h+=f;h+="\n    </div>\n    ";if((f=a["if"].call(b,b&&b.name,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===f)h+=f;h+="\n    <div class='creator'></div>\n    ";if((f=a["if"].call(b,b&&b.isNFT,{name:"if",hash:{},fn:this.program(7,e),inverse:this.program(9,e),data:e}))||0===f)h+=f;return h+"\n</label>\n"},useData:!0})}({})}),Bf=function(g){var b=g.UiCore.UiContext;return b.extend("CartListItem",{tagName:"li",className:"cart-list-item",uiContextName:"item",dependencies:["featureAccessManager","globalStringManager","loginManager","productImageManager","Promise"],trackedEvents:function(){return[{type:"click",selector:".product-select",name:"change_product_select",handler:this.__changeProductSelect.bind(this)}]},initialize:function(a){b.prototype.initialize.call(this,a);this.loginManager=a.loginManager;this.__myself=a.loginManager.getCurrentUser();this.imageHeight=a.imageHeight?a.imageHeight:null;this.imageWidth=a.imageWidth?a.imageWidth:null;this.__formatNumber=g.FormatNumber;this.__priceResolver=null;this.__pricePromise=new this.__Promise(function(c){this.__priceResolver=c}.bind(this));this.__filterModel=this.__serviceProvider.create(g.Model.FilterModel,[],{});this.__filterModel.setCategoryByProduct(this.model);this.__productImageManager=a.productImageManager;this.addToDOM()},render:function(){this.model.populated().then(function(){var a=this.__getDetails();g.CartListItemUi.render(this.$el,a);a=this.model.get("preview_image");this.__setImage(a,this.imageWidth,this.imageHeight);this.model.getSingleEdge("creator").populated().then(function(c){this.__displayName=this.createChildContext(g.WAFWidgets.DisplayName,{$parentElement:this.$(".creator"),user:c,size:"tiny",color:"dark",showVipBadge:!1,ignoreClicks:!0,prefix:this.__globalStringManager.get("By")})}.bind(this));this.createChildContext(g.DistinguishStatus,{$parentElement:this.$(".cart-image"),model:this.model,position:"small end-start"});this.__featureAccessManager.canSeeNFT()&&this.createChildContext(g.NFTStatusBadge,{$parentElement:this.$(".cart-image"),model:this.model,position:"offset-5"})}.bind(this))},__getDetails:function(){this.__getPrice();return this.__pricePromise.then(function(a){return{name:this.model.get("product_name"),price:this.__formatNumber.formatCredits(Number(a)),checked:this.model.get("is_selected"),product_id:this.model.get("product_id"),also_tried_on:this.model.get("also_tried_on"),isAp:"AP"===this.model.get("rating"),preview_image:this.model.get("preview_image"),imageWidth:this.imageWidth,imageHeight:this.imageHeight,isNFT:this.__featureAccessManager.canSeeNFT()&&this.model.get("is_nft")}}.bind(this)).result},__getPrice:function(){var a=this.model.get("product_price");this.model.get("is_nft")&&(a=this.model.get("vcoin_price"));if(this.model.get("is_bundle")){var c=this.model.getEdgeCollection("subproducts",g.Model.ProductEdgeCollection);c.populated().then(function(){c.map(function(e){e.node.get("is_owned")&&80!=e.node.get("product_id")&&191!=e.node.get("product_id")&&(a-=e.node.get("product_price"))}.bind(this));this.__priceResolver.accept(a)}.bind(this))}else this.__priceResolver.accept(a)},__changeProductSelect:function(a){this.model.set("is_selected",!!$(a.target).prop("checked"))},__setImage:function(a,c,e){c&&e&&(a=IMVU.URI.build(this.model.get("preview_image"),{width:this.imageWidth,height:this.imageHeight}));this.__productImageManager.getProductImage(this.$("img"),a,this.__filterModel.get("category"),this.$el,this.$(".cover-image-placeholder"))}})}({Model:l["@Model"],UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],CartListItemUi:Af,DistinguishStatus:w,FormatNumber:r,NFTStatusBadge:ea}),Cf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=this.escapeExpression;return"\n        <div class='name'>"+c((d=a.name||b&&b.name,"function"===typeof d?d.call(b,{name:"name",hash:{},data:e}):d))+"</div>\n    "},3:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f="\n        <div class='created-by'>";if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"By",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+" <span class='creator'>"+c((d=a.creator||b&&b.creator,"function"===typeof d?d.call(b,{name:"creator",hash:{},data:e}):d))+"</span></div>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f='<div class="is-new"></div>\n<input id=\'cart-item-'+c((d=a.product_id||b&&b.product_id,"function"===typeof d?d.call(b,{name:"product_id",hash:{},data:e}):d))+"' class='checkbox product-select' "+c((d=a.checked||b&&b.checked,"function"===typeof d?d.call(b,{name:"checked",hash:{},data:e}):d))+" type='checkbox'>\n<div class='product-info' for='cart-item-"+c((d=a.product_id||b&&b.product_id,"function"===typeof d?d.call(b,{name:"product_id",hash:{},data:e}):d))+"'>\n    <div class='cart-image'>\n        <img>\n    </div>\n    ",k=a["if"].call(b,b&&b.name,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+='\n    <div class="sticker-count">\n        <span class="single-count"></span> ';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Solo",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=',\n        <span class="cooperative-count"></span> ';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Group",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="\n    </div>\n    ";if((k=a["if"].call(b,b&&b.creator,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n    <div class='price-credits'>"+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</div>\n</div>\n<p class='preview-label'>";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Click to preview",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+'</p>\n<div class="sticker-picker"></div>'},useData:!0})}({}),Df=function(g){return g.CartListFactory.extend("StickerCartListItem",{tagName:"li",className:"sticker-cart-list-item",uiContextName:"item",dependencies:["globalStringManager","restModelFactory"],render:function(){this.model.populated().then(function(){this.__creatorModel=this.model.getSingleEdge("creator");return this.__creatorModel.populated()}.bind(this)).then(function(){this.model.set("is_selected",!0);var b=this.__getDetails();b.price=this.model.get("product_price")?this.model.get("product_price"):this.__globalStringManager.get("FREE");this.$el.html(g.template(b));this.$(".product-select").prop("checked",this.model.get("is_selected"));b=this.model.get("product_image");this.imageHeight&&this.imageWidth&&(b=IMVU.URI.build(b,{width:this.imageWidth,height:this.imageHeight}));this.$("img").attr({src:b});this.__isNew();this.createChildContext(g.StickerPackDetail,{$parentElement:this.$(".sticker-picker"),model:this.model,canPreview:!0});_.each(["single","cooperative"],function(a){this.__restModelFactory.searchCollection(this.model.relations.sticker_templates,{type:a,limit:0},g.UiCore.EdgeCollection).populated().then(function(c){this.$("."+a+"-count").text(c.total_count)}.bind(this))}.bind(this))}.bind(this))},__isNew:function(){this.model.get("is_new")&&this.createChildContext(g.IsNewTag,{$replaceElement:this.$(".is-new")})}})}({UiCore:l["@UiCore"],CartListFactory:Bf,IsNewTag:O,StickerPackDetail:ca,template:Cf}),Ua=function(g){var b=g.UiCore.ListPresenter;return b.extend("StickerCartList",{uiContextName:"sticker_cart_list",className:"sticker-cart-list",initialize:function(a){a.imageWidth=80;a.imageHeight=80;this.itemFactory=a.itemFactory||g.CartListItem;b.prototype.initialize.call(this,a)}})}({UiCore:l["@UiCore"],CartListItem:Df}),Va=function(g){var b=g.UiCore.ListPresenter;return b.extend("StickerCatalog",{uiContextName:"sticker_catalog",className:"sticker-catalog is-list",tagName:"ul",itemFactory:g.StickerItem,initialize:function(a){b.prototype.initialize.call(this,a)},render:function(){b.prototype.render.call(this);this.__scroller=this.$el;$(this.__scroller).on("scroll",this.__onScroll.bind(this))},addToDOM:function(){b.prototype.addToDOM.call(this)},__onScroll:function(){this.__maybePage()},__onPaged:function(){this.$el.removeClass("loading");this.__maybePage()},__maybePage:function(){this.__shouldPage()&&this.collection.hasNextPage()&&(this.$el.addClass("loading"),this.collection.getNextPage().then(this.__onPaged.bind(this),this.__onPaged.bind(this)))},__childrenInDOM:function(){var a=_.map(_.filter(_.values(this.__registry),function(c){return c.$el}),function(c){return c.$el[0]});return this.$el.children().filter(a)},__readyToPage:function(){return this.isDeleted()||this.collection.isSyncing()||!this.$el.is(":visible")?!1:this.__childrenInDOM().length===this.collection.length},__shouldPage:function(){if(!this.__readyToPage())return!1;var a=this.__scroller[0]===this.__window?this.__scroller.scrollTop()+this.__scroller.height():this.__scroller.offset().top+this.__scroller.height(),c=this.$el.children().eq(-this.triggerNextPage);return 0===c.length?!0:c.offset().top<=a}})}({UiCore:l["@UiCore"],StickerItem:Ta}),Ef=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=this.escapeExpression;return"\n                <div class='name'>"+c((d=a.name||b&&b.name,"function"===typeof d?d.call(b,{name:"name",hash:{},data:e}):d))+"</div>\n            "},3:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f="\n                <div class='created-by'>";if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"By",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+" <span class='creator'>"+c((d=a.creator||b&&b.creator,"function"===typeof d?d.call(b,{name:"creator",hash:{},data:e}):d))+"</span></div>\n            "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=this.escapeExpression;c=a.helperMissing;h='<div class="sticker-pack-container">\n    <div class="sticker-pack-wrapper">\n    <div class="is-new-label"></div>\n        <div class=\'product-info\' for=\'cart-item-'+h((d=a.product_id||b&&b.product_id,"function"===typeof d?d.call(b,{name:"product_id",hash:{},data:e}):d))+"'>\n            <div class='cart-image'>\n                <img>\n            </div>\n            ";var f=a["if"].call(b,b&&b.name,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)h+=f;h+='\n            <div class="sticker-count">\n                <span class="single-count"></span> ';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Solo",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+=',\n                <span class="cooperative-count"></span> ';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Group",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="\n            </div>\n            ";if((f=a["if"].call(b,b&&b.creator,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)h+=f;h+='\n            <p class="in-inventory">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"IN INVENTORY",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</p>\n        </div>\n        <p class='preview-label'>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Click to preview",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+'</p>\n        <div class="sticker-picker"></div>\n    </div>\n</div>'},useData:!0})}({}),Ff=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="back-button"></div>'},useData:!0})}({}),Wa=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("StickerPackDetailDialog",{uiContextName:"sticker_pack_detail_dialog",className:"sticker-pack-detail-dialog dialog-type-B",dependencies:["dialogManager","globalStringManager","Promise","restModelFactory"],initialize:function(a){this.__formatNumber=g.FormatNumber;this.__restModelFactory=a.restModelFactory;this.__dialogManager=a.dialogManager;b.prototype.initialize.call(this,a);this.addToDOM()},trackedEvents:function(){return[{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},postRender:function(){this.model.populated().then(function(){this.__creatorModel=this.model.getSingleEdge("creator");return this.__creatorModel.populated()}.bind(this)).then(function(){var a=this.__getDetails();a.price=this.model.get("product_price")?this.model.get("product_price"):this.__globalStringManager.get("FREE");this.setContent("body",g.template,a);this.$(".dialog-title").text(this.model.get("product_name"));this.$(".dialog-header").prepend(g.backButtonTemplate({}));this.$(".product-select").prop("checked",this.model.get("is_selected"));a=this.model.get("product_image");this.imageHeight&&this.imageWidth&&(a=IMVU.URI.build(a,{width:this.imageWidth,height:this.imageHeight}));this.$("img").attr({src:a});this.__maybeCreateNewTag();this.createChildContext(g.StickerPackDetail,{$parentElement:this.$(".sticker-picker"),model:this.model,canPreview:!0});_.each(["single","cooperative"],function(c){this.__restModelFactory.searchCollection(this.model.relations.sticker_templates,{type:c,limit:0},g.UiCore.EdgeCollection).populated().then(function(e){this.$("."+c+"-count").text(e.total_count)}.bind(this))}.bind(this));"mobile"===this.serviceProvider.get("platform")?this.$(".sticker-pack-container").css("max-height",this.__window.innerHeight-50+"px"):this.$(".sticker-pack-container").scrollbar()}.bind(this))},__getDetails:function(){return{name:this.model.get("product_name"),price:this.__formatNumber.formatCredits(Number(this.model.get("product_price"))),checked:this.model.get("is_selected"),product_id:this.model.get("product_id"),creator:this.__creatorModel.get("display_name"),also_tried_on:this.model.get("also_tried_on"),isAp:"AP"===this.model.get("rating")}},__goBack:function(){this.promiseResolver.resolve(!0)},__maybeCreateNewTag:function(){this.model.get("is_new")&&this.createChildContext(g.IsNewTag,{$replaceElement:this.$(".is-new-label")})}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],FormatNumber:r,IsNewTag:O,StickerPackDetail:ca,backButtonTemplate:Ff,template:Ef}),Gf=function(g){var b=g.ResponsiveTileListItem;return b.extend("ResponsiveStickerPack",{className:"responsive-sticker-pack responsive-tile-list-item",uiContextName:"responsive_sticker_pack",dependencies:["dialogManager","globalStringManager","imageManager"],trackedEvents:function(){return[{type:"click",selector:"",name:"sticker_pack_add_to_cart",handler:"__buyStickerPack"}]},initialize:function(a){this.__useBackButton=!0===a.useBackButton;b.prototype.initialize.call(this,a);this.addToDOM();this.listenTo(this.model,"change",this.__maybeCreateOwnedTag)},render:function(){this.$el.html(g.template({product_name:this.model.get("product_name"),price:this.model.get("product_price")?this.model.get("product_price"):this.__globalStringManager.get("FREE"),is_owned:this.model.get("is_owned")}));this.__maybeCreateNewTag();this.__setImage(this.model.get("product_image"));this.$el.toggleClass("is-owned",this.model.get("is_owned"))},__setImage:function(a){this.__imageManager.loadAsBackgroundImage(this.$(".cover-image"),a,{container:this.$el})},__buyStickerPack:function(a){this.model.get("is_owned")?this.__dialogManager.showDialog(g.StickerPackDetailDialog,{model:this.model}):this.__dialogManager.showDialog(g.Checkout.CheckoutDialog,{cart:new g.Checkout.CartCollection([this.model]),cartListFactory:g.stickerCartListFactory,isStickerCheckout:!0,stickerPackName:this.model.get("product_name"),useBackButton:this.__useBackButton})},__maybeCreateNewTag:function(){this.model.get("is_new")&&this.createChildContext(g.IsNewTag,{$replaceElement:this.$(".is-new")})},__maybeCreateOwnedTag:function(){this.model.get("is_owned")&&(this.$(".price-credits").remove(),this.$(".in-inventory").removeClass("hidden"))}})}({Checkout:l["@Checkout"],UiCore:l["@UiCore"],IsNewTag:O,ResponsiveTileListItem:W,Sticker:aa,stickerCartListFactory:Ua,StickerCatalog:Va,StickerPackDetailDialog:Wa,template:yf}),Hf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<li class="spinner"></li>\n'},useData:!0})}({}),If=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d,h=a.helperMissing;c='\n    <p class="in-inventory">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"IN INVENTORY",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</p>\n"},3:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f='\n    <p class="in-inventory hidden">';if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"IN INVENTORY",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+'</p>\n    <p class="price-credits">'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</p>\n"},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;c='<div class="is-new"></div>\n<div class="image-wrapper"><img src="" /></div>\n<h1 class="is-truncated">'+c((d=a.product_name||b&&b.product_name,"function"===typeof d?d.call(b,{name:"product_name",hash:{},data:e}):d))+"</h1>\n\n\n";if((b=a["if"].call(b,b&&b.is_owned,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===b)c+=b;return c+"\n"},useData:!0})}({}),Jf=function(g){var b=g.UiCore.UiContext;return b.extend("StickerPack",{className:"sticker-pack",uiContextName:"sticker_pack",dependencies:["dialogManager","globalStringManager","imageManager"],trackedEvents:function(){return[{type:"click",selector:"",name:"sticker_pack_add_to_cart",handler:"__buyStickerPack"}]},initialize:function(a){this.__useBackButton=!0===a.useBackButton;b.prototype.initialize.call(this,a);this.addToDOM();this.track(this.model);this.listenTo(this.model,"change",this.__maybeCreateOwnedTag)},render:function(){this.$el.html(g.template({product_name:this.model.get("product_name"),price:this.model.get("product_price")?this.model.get("product_price"):this.__globalStringManager.get("FREE"),is_owned:this.model.get("is_owned")}));this.__maybeCreateNewTag();this.__setImage(this.model.get("product_image"));this.$el.toggleClass("is-owned",this.model.get("is_owned"))},__setImage:function(a){this.__imageManager.load(this.$("img"),a,{container:this.$el})},__buyStickerPack:function(a){this.model.get("is_owned")?this.__dialogManager.showDialog(g.StickerPackDetailDialog,{model:this.model}):this.__dialogManager.showDialog(g.Checkout.CheckoutDialog,{cart:new g.Checkout.CartCollection([this.model]),cartListFactory:g.stickerCartListFactory,isStickerCheckout:!0,stickerPackName:this.model.get("product_name"),useBackButton:this.__useBackButton})},__maybeCreateNewTag:function(){this.model.get("is_new")&&this.createChildContext(g.IsNewTag,{$replaceElement:this.$(".is-new")})},__maybeCreateOwnedTag:function(){this.model.get("is_owned")&&(this.$(".price-credits").remove(),this.$(".in-inventory").removeClass("hidden"))}})}({Checkout:l["@Checkout"],UiCore:l["@UiCore"],IsNewTag:O,Sticker:aa,stickerCartListFactory:Ua,StickerCatalog:Va,StickerPackDetailDialog:Wa,template:If}),Kf=function(g){var b=g.WAFWidgets.EdgeCollectionPresenter;return b.extend("StickerPackList",{uiContextName:"sticker_pack_list",className:"sticker-packList",tagName:"section",dependencies:["globalStringManager"],initialize:function(a){this.itemFactory=a.itemFactory||g.StickerPack;b.prototype.initialize.call(this,a)},__emptyText:function(){return{standard:this.__globalStringManager.get("No Sticker Packs Available"),concise:this.__globalStringManager.get("No Sticker Packs Available")}}})}({WAFWidgets:l["@WAFWidgets"],StickerPack:Jf,template:Hf}),Lf=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("StickerPackDialog",{uiContextName:"sticker_pack_dialog",className:"sticker-pack-dialog dialog-type-B",dependencies:"dialogManager featureAccessManager globalStartupModel globalStringManager loginManager Promise restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:".back-button",name:"back_to_checkout",handler:this.__backToCheckout}]},initialize:function(a){b.prototype.initialize.call(this,a);this.dialogManager=a.dialogManager;this.__myself=a.loginManager.getCurrentUser();this.__stickerPacksEndPoint=this.__globalStartupModel.get("productEndpoint");this.title=this.__globalStringManager.get("WithMoji Shop");this.$el.toggleClass("is-padded",!0);this.addToDOM()},destroy:function(){this.hide();this.delete()},postRender:function(){this.__myself.populated().then(function(){this.setContent("body",g.template);this.__stickerPackCollection=this.track(this.__restModelFactory.searchCollection(this.__stickerPacksEndPoint,{cat:this.__globalStartupModel.get("stickerPackCategory")},g.Model.ProductCollection));return this.__stickerPackCollection.populated()}.bind(this)).then(function(){this.createChildContext(g.ResponsiveTileList,{collection:this.__stickerPackCollection,$parentElement:this.$(".sticker-packs"),stringManager:this.__globalStringManager,itemFactory:g.ResponsiveStickerPack});this.$(".sticker-packs").scrollbar()}.bind(this))}})}({Dialogs:l["@Dialogs"],Model:l["@Model"],UiCore:l["@UiCore"],FormatNumber:r,ResponsiveStickerPack:Gf,ResponsiveTileList:K,StickerPackList:Kf,template:xf}),Mf=function(g){var b=g.UiCore.NodeModel;return b.extend("ProductNode",{initialize:function(){b.prototype.initialize.apply(this,arguments);this.listenTo(this,"change:relations",this.__triggerChanges.bind(this))},__triggerChanges:function(a,c){a=a||{};c=c||{};a.viewer_inventory!=c.viewer_inventory&&this.trigger("change:is_owned",this,c.viewer_inventory);a.viewer_wishlist!=c.viewer_wishlist&&this.trigger("change:is_wished",this,c.viewer_wishlist)},isAvatar:function(){return _.contains(this.get("categories"),"Avatars")},isCompatibleWithBodyPatterns:function(a){var c=_.contains(this.get("is"),"clothing_product"),e=_.contains(this.get("is"),"avatar_attachment");a=0<_.intersection(a,this.get("compatible_body_patterns")).length;return c&&(e||a)},getPrices:function(){return{full:this.get("product_price"),discounted:this.get("discount_price")?this.get("discount_price"):this.get("product_price")}},get:function(a){switch(a){case"is_owned":return!!this.relations.viewer_inventory;case"is_wished":return!!this.relations.viewer_wishlist;default:return b.prototype.get.apply(this,arguments)}}})}({UiCore:l["@UiCore"]}),Nf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="simple-scroller-viewport"></div>\n<button class="btn btn-tertiary simple-scroller-right flex items-center justify-center" disabled>\n    ',f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-page-right",{name:"icon",hash:{class:"wh-15 block"},data:e}));if(f||0===f)h+=f;h+='\n</button>\n<button class="btn btn-tertiary simple-scroller-left flex items-center justify-center" disabled>\n    ';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-page-left",{name:"icon",hash:{class:"wh-15 block"},data:e})))||0===f)h+=f;return h+"\n</button>"},useData:!0})}({}),P=function(g){var b=0,a=g.UiCore.UiContext;return g.UiCore.UiContext.extend("SimpleScroller",{className:"simple-scroller disable-text-selection",uiContextName:"simple_scroller",keepGoingThreshold:50,dependencies:["$target","timer","window"],initialize:function(c){a.prototype.initialize.call(this,c);this.__instanceNumber=b++;this.__absoluteScrollBy=c.scrollBy||!1;this.__window=c.window;this.__autoRefresh=!!c.autoRefresh;this.__timer=c.timer;this.__scrollEntireWidth=c.scrollEntireWidth;this.__responsiveTiles=c.responsiveTiles;this.__extraTileHeight=c.extraTileHeight||0;this.__$target=c.$target;this.__$target.parent(".simple-scroller-viewport").length||(this.template=c.template||g.template,this.addToDOM(),this._refreshScrollabilityCount=0,this.$(".simple-scroller-viewport").on("scroll.simple-scroller",this.refreshScrollability.bind(this)),this.$(".simple-scroller-left").on("click",this.scrollLeft.bind(this)),this.$(".simple-scroller-right").on("click",this.scrollRight.bind(this)),$(this.__window).on(this.__getEventNamespaceForThisInstance("resize"),this.refreshScrollability.bind(this)))},__getEventNamespaceForThisInstance:function(c){return c+".ss-"+this.__instanceNumber},delete:function(){$(this.__window).off(this.__getEventNamespaceForThisInstance("resize"));this.$(".simple-scroller-viewport").off(".simple-scroller");this.__refreshTimer&&this.__timer.clearInterval(this.__refreshTimer);a.prototype.delete.call(this)},render:function(){this.$el.html(this.template);this.$(".simple-scroller-viewport").append(this.__$target);this.__$target.addClass("simple-scroller-target");this.refreshScrollability();this.__autoRefresh&&(this.__refreshTimer=this.__timer.setInterval(function(){this.$el.is(":visible")&&this.refreshScrollability()}.bind(this),300));this.__setAsRendered()},viewportWidth:function(){return this.$(".simple-scroller-viewport").outerWidth()},leftEdge:function(){return this.$(".simple-scroller-viewport").scrollLeft()},rightEdge:function(){return this.scrollWidth()-this.viewportWidth()-1},scrollWidth:function(){return this.$(".simple-scroller-viewport")[0].scrollWidth},scrollBy:function(){return this.__absoluteScrollBy||this.viewportWidth()/2},scrollByEntireWidth:function(){return this.__absoluteScrollBy||this.viewportWidth()},resizeResponsiveTiles:function(){var c=this.viewportWidth(),e="."+this.__$target[0].firstChild.className;this.$(e).css("width",c);c=this.$(e);for(e=0;e<c.length;e++)if(c[e].offsetLeft===this.$(".simple-scroller-viewport")[0].scrollLeft){var d=c[e].firstChild.offsetHeight;break}d&&this.$(".simple-scroller-viewport").css("height",d+this.__extraTileHeight)},refreshLeftScrollability:function(){this.$(".simple-scroller-left").prop("disabled",0>=this.leftEdge())},refreshRightScrollability:function(){this.$(".simple-scroller-right").prop("disabled",this.leftEdge()>=this.rightEdge())},refreshScrollability:function(){this.__responsiveTiles&&this.resizeResponsiveTiles();this._refreshScrollabilityCount++;this.refreshLeftScrollability();this.refreshRightScrollability()},scroll:function(c){this.$(".simple-scroller-viewport").animate({scrollLeft:"+="+c},150,this.refreshScrollability.bind(this))},scrollLeft:function(c){c=this.scrollBy();this.__scrollEntireWidth&&(c=this.scrollByEntireWidth());this.leftEdge()-c<this.keepGoingThreshold&&(c*=2);this.scroll(-c)},scrollRight:function(c){c=this.scrollBy();this.__scrollEntireWidth&&(c=this.scrollByEntireWidth());this.leftEdge()+c>this.rightEdge()-this.keepGoingThreshold&&(c*=2);this.scroll(c)},resetPosition:function(){this.$(".simple-scroller-viewport").scrollLeft(0);this.refreshScrollability()}})}({UiCore:l["@UiCore"],template:Nf}),Of=function(g){var b=g.UiCore.UiContext;return b.extend("RecentStickerItem",{uiContextName:"sticker_catalog_item",tagName:"li",className:"catalog-item sticker-item recent-sticker-item",dependencies:["featureAccessManager","imageManager","loginManager","restModelFactory"],trackedEvents:function(){return this.__canPreview?[{type:"click",name:"toggle_preview",handler:this.togglePreview}]:[]},initialize:function(a){this.__restModelFactory=a.restModelFactory;this.__myself=a.loginManager.getCurrentUser();this.__imageManager=a.imageManager;this.__featureAccessManager=a.featureAccessManager;this.__canPreview=!!a.canPreview;b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){this.model.populated().then(function(){var a=this.model.node||this.model,c=a.get("thumb_image");this.$el.attr("data-id",a.get("template_id"));this.$el.attr("data-participant_count",a.get("participant_count"));1<this.$el.attr("data-participant_count")?this.$el.attr("data-sticker-type","cooperative"):this.$el.attr("data-sticker-type","single");this.$el.html(g.template);this.__imageManager.load(this.$(".sticker-thumbnail"),c,{defaultImage:"/common/withme/img/sticker_template_error.png"})}.bind(this)).catch(function(){this.$el.hide()}.bind(this))},togglePreview:function(){this.__preview||(this.__preview=this.createChildContext(g.StickerPreview,{$parentElement:this.$el,stickerTemplate:this.model.node.id,participants:[this.__myself.id]}));this.$el.toggleClass("previewing").siblings().removeClass("previewing")}})}({UiCore:l["@UiCore"],StickerPreview:ba,template:Sa}),Pf=function(g){var b=g.WAFWidgets.EdgeCollectionPresenter;return b.extend("RecentStickerTemplateList",{uiContextName:"catalog_menu_list",className:"catalog-menu-list",itemFactory:g.RecentStickerItem,dependencies:["collection","globalStringManager"],initialize:function(a){this.__stringManager=a.globalStringManager;b.prototype.initialize.call(this,a)},__emptyText:function(){var a=this.__stringManager.get("recent_sticker_templates_empty");return{standard:a,concise:a}}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],RecentStickerItem:Of}),Qf=function(g){var b=g.UiCore.UiContext;return b.extend("RecentStickerPackDetail",{className:"sticker-pack-detail recent-sticker-pack-detail",uiContextName:"sticker_pack_detail",dependencies:["globalStringManager","Promise"],trackedEvents:function(){return b.prototype.trackedEvents.call(this).concat([{type:"change",selector:".sticker-menu [data-value]",name:"sticker_types",handler:this.__onChangeStickerType,attributes:function(a){return{tab_type:a.attr("data-value")}}}])},initialize:function(a){this.__globalStringManager=a.globalStringManager;b.prototype.initialize.call(this,a);this.__Promise=a.Promise;this.__stickers=a.stickersArray;this.__startingTab=a.startingTab;this.__canPreview=!!a.canPreview;this.addToDOM()},render:function(){this.$el.html(g.template);this.catalogTabs=this.createChildContext(g.SegmentedControl,{$parentElement:this.$(".sticker-menu"),name:"catalogTab",options:{all:this.__globalStringManager.get("All"),single:this.__globalStringManager.get("Solo"),cooperative:this.__globalStringManager.get("Group")}});this.catalogTabs.val(this.__startingTab);this.__showStickers()},selectTab:function(a){this.catalogTabs.val(a)},__showStickers:function(){this.__stickerTemplateList&&this.__stickerTemplateList.delete();this.__templateCollection&&this.untrack(this.__templateCollection);this.$el.toggleClass("empty",0===this.__stickers.length);var a=_.map(this.__stickers,function(c){return this.__serviceProvider.create(IMVU.NamedModel,c)}.bind(this));_.each(a,function(c){c.populated=function(){return this.__Promise.resolve()}.bind(this)}.bind(this));this.__templateCollection=this.__serviceProvider.create(IMVU.NamedCollection,a,{model:IMVU.NamedModel});this.__templateCollection.url="synthesizedCollection/recentStickers";this.__templateCollection.enumerated=function(){return this.__Promise.resolve()}.bind(this);this.__templateCollection.populated=function(){return this.__Promise.resolve()}.bind(this);this.__templateCollection.hasNextPage=function(){return!1};this.__templateCollection.isSyncing=function(){return!1};this.__stickerTemplateList=this.createChildContext(g.RecentStickerTemplateList,{$parentElement:this.$(".catalog"),collection:this.__templateCollection,canPreview:this.__canPreview});this.__templateCollection.enumerated().catch(function(){this.untrack(this.__templateCollection);this.__templateCollection.release();this.trigger("error")}.bind(this))},__onChangeStickerType:function(a){this.$(".catalog-menu-list .no-results").remove();this.$(".catalog-menu-list .sticker-item").each(function(e,d){$(d).toggleClass("hidden",$(d).attr("data-sticker-type")!==$(a.currentTarget).attr("data-value"))});"all"===$(a.currentTarget).attr("data-value")&&this.$(".catalog-menu-list .sticker-item").removeClass("hidden");var c=this.$(".catalog-menu-list .sticker-item:not(.hidden)").length;this.__$empty=$(g.emptyTemplate({standard:this.__globalStringManager.get("recent_sticker_templates_type_empty"),concise:this.__globalStringManager.get("recent_sticker_templates_type_empty")}));0===c&&this.$(".catalog-menu-list").append(this.__$empty)}})}({UiCore:l["@UiCore"],RecentStickerTemplateList:Pf,SegmentedControl:Z,emptyTemplate:L,template:Ra}),Rf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;return'<img src="'+c((d=a.product_image||b&&b.product_image,"function"===typeof d?d.call(b,{name:"product_image",hash:{},data:e}):d))+'" class="sticker-item-image" height="20"/>'},useData:!0})}({}),Sf=function(g){var b=g.UiCore.UiContext;return b.extend("StickerPackItem",{uiContextName:"sticker_catalog_item",tagName:"li",className:"sticker-pack-item",initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){this.model.populated().then(function(){var a=this.model.node;this.$el.attr("data-id",a.id);this.$el.html(g.template({product_image:a.get("product_image"),product_name:a.get("product_name")}))}.bind(this)).catch(function(){this.$el.hide()}.bind(this))}})}({UiCore:l["@UiCore"],template:Rf}),Tf=function(g){var b=g.WAFWidgets.EdgeCollectionPresenter;return b.extend("StickerPackList",{uiContextName:"sticker_pack_list",className:"sticker-pack-list",itemFactory:g.StickerPackItem,dependencies:["collection"],render:function(){b.prototype.render.call(this)}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],SimpleScroller:P,StickerPackItem:Sf}),Uf=function(g){var b=g.ChatBarMenu;return b.extend("StickerMenu",{className:"chat-bar-menu sticker-menu",uiContextName:"sticker_menu",payloadName:"sticker_template",dependencies:"contextMenuManager dialogManager globalStartupModel globalStringManager localStorage loginManager prefsManager Promise restModelFactory".split(" "),trackedEvents:function(){return b.prototype.trackedEvents.call(this).concat([{type:"click",selector:".sticker-pack-item",name:"sticker_pack",handler:this.__onClickStickerPack},{type:"click",selector:".recent-stickers",name:"recent_stickers",handler:this.__onShowRecentStickers},{type:"click",selector:".add-catalog",name:"add_catalog",handler:this.__onAddCatalog},{type:"click",selector:".shuffle",name:"shuffle_partner",handler:this.__shufflePartner},{type:"click",selector:".catalog-error-content",name:"retry_load",handler:this.__retryLoad}])},initialize:function(a){b.prototype.initialize.call(this,a);this.__myself=this.track(a.loginManager.getCurrentUser());this.__context=a.context;this.__partnerCollection=a.partnerCollection;this.listenTo(this.__partnerCollection,"add remove reset",this.__refreshShuffleButton);this.addToDOM()},render:function(){this.$el.html(g.template());var a=this.__prefsManager.get("next.last_opened_WithMoji_shop");if(a){var c=this.__restModelFactory.searchCollection(this.__globalStartupModel.get("productEndpoint"),{cat:this.__globalStartupModel.get("stickerPackCategory"),since:a,limit:0},g.Model.ProductCollection);c.enumerated().then(function(){this.$(".new-badge").toggleClass("hidden",0===c.total_count)}.bind(this))}else this.$(".new-badge").removeClass("hidden")},delete:function(){this.__stickerPackDetail&&this.__stickerPackDetail.delete();this.__simpleScroller&&this.__simpleScroller.delete();b.prototype.delete.call(this)},onSubmit:function(){this.__updateStickerPref(this.getSelection().template,this.getSelection().thumb_image,this.getSelection().participants.length)},preselectPartner:function(a){this.__preselectedPartner=a;this.__stickerPackDetail?this.__stickerPackDetail.selectTab("cooperative"):this.__startingTab="cooperative"},hideCatalog:function(){this.__preselectedPartner=null;b.prototype.hideCatalog.call(this)},__createCatalog:function(){this.$el.removeClass("error").addClass("loading");this.__Promise.every([this.__myself.populated(),this.__globalStartupModel.populated()]).then(function(){this.__stickerPackCollection=this.track(this.__myself.searchEdgeCollection("inventory",{cat:this.__globalStartupModel.get("stickerPackCategory")},g.Model.ProductEdgeCollection));this.__myAvatar=this.track(this.__myself.getSingleEdge("avatar"));return this.__Promise.every([this.__myAvatar.populated(),this.__stickerPackCollection.enumerated()])}.bind(this)).then(function(){this.listenTo(this.__myAvatar,"change:asset_url",this.__updatePreviewContent)}.bind(this)).then(function(){this.$el.removeClass("loading");if(this.__stickerPackCollection.length){var a=this.__preselectedPackId?this.__stickerPackCollection.find(function(c){return c.node.id===this.__preselectedPackId}.bind(this)):this.__stickerPackCollection.at(0);this.__selectStickerPack(a);this.__stickerPackList=this.createChildContext(g.StickerPackList,{$parentElement:this.$(".catalog-menu-bar .catalog-menu"),collection:this.__stickerPackCollection});this.$(".catalog-menu-bar .catalog-menu li:first-child").addClass("selected");this.__markSelectedPack(this.$('.sticker-pack-item[data-id="'+a.node.id+'"]'));this.__simpleScroller=this.createChildContext(g.SimpleScroller,{$target:this.$(".sticker-pack-list"),$parentElement:this.$(".catalog-menu"),autoRefresh:!0})}}.bind(this)).catch(function(){this.$el.removeClass("loading").addClass("error");this.__stickerPackCollection&&(this.untrack(this.__stickerPackCollection),this.__stickerPackCollection.release())}.bind(this))},__retryLoad:function(){this.__selectedStickerPack?this.__showPackDetails():this.__createCatalog()},__selectStickerPack:function(a){a.populated().then(function(){this.__selectedStickerPack=a;this.__showPackDetails()}.bind(this))},__refreshCatalogTabs:function(){this.__templateCollection.populated().then(function(){var a=this.__templateCollection.any(function(e){return 1===e.node.get("participant_count")}),c=this.__templateCollection.any(function(e){return 1<e.node.get("participant_count")});this.catalogTabs.toggleOption("single",a);this.catalogTabs.toggleOption("cooperative",c)}.bind(this))},__showStickers:function(){this.__stickerTemplateList?this.__stickerTemplateList.delete():this.__startingTab="cooperative"},__showPackDetails:function(){this.$el.removeClass("error");this.__stickerPackDetail&&this.__stickerPackDetail.delete();this.$(".catalog-container .detail-container").scrollbar();this.__stickerPackDetail=this.createChildContext(g.StickerPackDetail,{$parentElement:this.$(".catalog-container .detail-container"),model:this.__selectedStickerPack.node,startingTab:this.__startingTab||"all"});this.__stickerPackDetail.on("error",this.__onDetailError,this);this.__startingTab=null;this.__stickerPackDetail.on("updated",function(){this.__currentSelection&&this.$('.catalog-item[data-id="'+this.__currentSelection.template+'"]').addClass("highlighted")}.bind(this))},__onDetailError:function(){this.$el.addClass("error")},__getStickerPref:function(){return JSON.parse(this.__localStorage.getItem("next.recent_stickers-"+this.__myself.get("legacy_cid")))||[]},__updateStickerPref:function(a,c,e){var d=this.__removeStickerArray(a);d.unshift({template_id:a,thumb_image:c,participant_count:e});d=d.slice(0,25);this.__setStickerPref(d);0!==this.$(".recent-stickers.selected").length&&this.__onShowRecentStickers()},__setStickerPref:function(a){this.__localStorage.setItem("next.recent_stickers-"+this.__myself.get("legacy_cid"),JSON.stringify(a))},__removeStickerArray:function(a){return this.__getStickerPref().filter(function(c){return c.template_id!==a})},__removeStickerPrefItem:function(a){a=this.__removeStickerArray(a);this.__setStickerPref(a)},__onClickItem:function(a){var c=$(a.currentTarget),e=c.data("id");e&&(this.__currentSelection&&e===this.__currentSelection.template?this.trigger("send"):1===c.data("participant_count")?this.__selectStickerTemplate(e):1===this.__availablePartners().length?(a=this.__availablePartners()[0],this.__selectStickerTemplate(e,(a.node||a).id)):this.__preselectedPartner?this.__selectStickerTemplate(e,this.__preselectedPartner):this.__choosePartnerFor(e,a))},__availablePartners:function(){return this.__partnerCollection.filter(function(a){return(a.node||a).id!==this.__myself.id}.bind(this))},__choosePartnerFor:function(a,c){var e=this.__partnerCollection.map(function(d){d=d.node||d;return{name:d.id,user:d,classNames:this.__currentSelection&&d.id===this.__currentSelection.participants[1]&&a===this.__currentSelection.template?"currently-chosen":"",handler:this.__selectStickerTemplate.bind(this,a,d.id)}}.bind(this));this.__contextMenuManager.showMenu(c,g.CoopPartnerMenu,{items:e,displayOptions:{above:!0,right:!1}})},__selectStickerTemplate:function(a,c){var e=this.$('.sticker-item[data-id="'+a+'"]');g.NextUtil.DomHelper.radioClass(e,"highlighted");this.__setSelection({template:a,participants:_.compact([this.__myself.id,c]),thumb_image:e.find("img").attr("src")})},__setSelection:function(a){b.prototype.__setSelection.call(this,a);this.__refreshShuffleButton()},__refreshShuffleButton:function(){this.$(".shuffle").toggle(this.__currentSelection&&1<this.__currentSelection.participants.length&&1<this.__availablePartners().length)},__shufflePartner:function(a){this.__preselectedPartner=null;this.__choosePartnerFor(this.getSelection().template,a)},__previewError:function(a,c){"STICKER_INSTANCE-001"===a.error.error&&(this.__dialogManager.alert({title:this.__globalStringManager.get("Sticker Unavailable"),text:this.__globalStringManager.get("This sticker is no longer available."),ok:this.__globalStringManager.get("OK")}),this.__removeStickerPrefItem(c),this.$('.catalog-menu-list [data-id="'+c+'"]').addClass("deleted"),this.cancelSelection())},__markSelectedPack:function(a){this.$(".catalog-menu-bar .selected").removeClass("selected");a.addClass("selected")},__createPreviewContent:function(){var a=this.createChildContext(g.StickerPreview,{$parentElement:this.$(".preview"),stickerTemplate:this.__currentSelection.template,participants:this.__currentSelection.participants,context:this.__context});this.listenTo(a,"preview-error",this.__previewError);return a},__onShowRecentStickers:function(){this.__stickerTemplateList&&this.__stickerTemplateList.delete();var a=this.__getStickerPref();this.$el.removeClass("error");this.__markSelectedPack(this.$(".recent-stickers"));this.__stickerPackDetail&&this.__stickerPackDetail.delete();this.$(".catalog-container .detail-container").scrollbar();this.__stickerPackDetail=this.createChildContext(g.RecentStickerPackDetail,{$parentElement:this.$(".catalog-container .detail-container"),stickersArray:a,startingTab:this.__startingTab||"all"});this.__stickerPackDetail.on("error",this.__onDetailError,this);this.__startingTab=null},__onAddCatalog:function(){this.__prefsManager.set("next.last_opened_WithMoji_shop",(new Date).toISOString());this.$(".new-badge").addClass("hidden");return this.__dialogManager.showDialog(g.StickerPackDialog,{})},selectStickerPack:function(a){!this.__catalogCreated||this.$el.hasClass("loading")?this.__preselectedPackId=a:(this.__markSelectedPack(this.$('.sticker-pack-item[data-id="'+a+'"]')),this.__selectStickerPack(this.__stickerPackCollection.find(function(c){return c.node.id===a})))},__onClickStickerPack:function(a){(a=$(a.currentTarget).data("id"))&&this.selectStickerPack(a)}})}({Model:l["@Model"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],ChatBarMenu:Ma,CoopPartnerMenu:Pa,ProductNode:Mf,RecentStickerPackDetail:Qf,SegmentedControl:Z,SimpleScroller:P,StickerPackDetail:ca,StickerPackDialog:Lf,StickerPackList:Tf,StickerPreview:ba,template:tf}),Vf=function(g){var b=g.UiCore.UiContext;return b.extend("ExpandingChatBar",{className:"chat-bar",uiContextName:"expanding_chat_bar",dependencies:"featureAccessManager globalStartupModel globalStringManager iconManager loginManager onboardingGamificationManager prefsManager timer".split(" "),trackedEvents:function(){return[{type:"click",selector:".menu-toggle",name:"toggle_menu",handler:"__toggleMenus"},{type:"click",selector:".btn-send",name:"chat",handler:"__send",attributes:function(a){return{number_of_windows:this.__serviceProvider.get("windowManager").getTotalOpenWindows(),sent_from:this.__isInWindow?"Window":"Mode",which:a.attr("data-room-type")}}.bind(this)},{type:"click",selector:".menu-tabs li",name:"menu_tab",handler:"__onClickMenuTab",attributes:function(a){return{menu:a.attr("data-menu")}}},{type:"keypress",selector:"textarea",name:"keypress",handler:"__onKeypress",attributes:{repeats:1}},{type:"input",selector:"textarea",name:"input",handler:"__onInput",attributes:{repeats:1}},{type:"click",selector:"textarea",name:"input",handler:"__onInputFocus",allowBubble:!0},{type:"click",selector:".whisper-close",name:"close_whisper",handler:"__onWhisperClose"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__serviceProvider=a.serviceProvider;this.__timer=a.timer;this.__globalStartupModel=a.globalStartupModel;this.__globalStringManager=a.globalStringManager;this.__featureAccessManager=a.featureAccessManager;this.__loginManager=a.loginManager;this.__placeholder=a.placeholder;this.__isInWindow=!!a.isInWindow;this.__actionCategoryListFactory=a.actionCategoryListFactory;this.__menus={};this.__menuTypes=a.menus;this.__chatStream=IMVU.optionalProperty(a,"chatStream");this.__currentMenu=null;this.__context=IMVU.optionalProperty(a,"context");this.__partnerCollection=IMVU.optionalProperty(a,"partnerCollection");this.__menuFactories=a.menuFactories||(this.__serviceProvider.services.menuFactories?this.__serviceProvider.get("menuFactories"):!1)||{stickers:g.StickerMenu,solo_actions:g.SoloActionMenu,pid_actions:g.PidActionMenu,coop_actions:g.CoopActionMenu};this.__chatMaxLength=this.__globalStartupModel.get("chat_message_max_length");this.__liveMaxLength=this.__globalStartupModel.get("live_message_max_length");this.__textarea=null;this.addToDOM();this.toggle(!1);this.__createMenus(a.menus)},coopActionWith:function(a){this.showMenu("coop_actions");this.__menus.coop_actions.preselectPartner(a)},coopStickerWith:function(a){this.showMenu("stickers");this.__menus.stickers.preselectPartner(a)},delete:function(){this.__inputActivityTimeoutHandle&&this.__timer.clearTimeout(this.__inputActivityTimeoutHandle);_.each(this.__menus,function(a){a.delete()});b.prototype.delete.call(this)},renderCorrectFooter:function(a){var c=this;if(a.inWhisperMode()){var e=a.get("messageTarget").displayName,d=a.get("messageTarget").cid;this.__whisperChatBarColor=a.getWhisperColorByCid(d);this.$el.html(g.whisperTemplate({whisperRecipient:e}));this.el.querySelector(".whisper-cancel-bar").style.setProperty("--bg-color",this.__whisperChatBarColor);this.$el.hasClass("menu-open")&&this.collapseMenus()}else this.$el.html(g.template()),this.__createMenus(this.__menuTypes),_.each(this.__menus,function(h){h.connect(c.__activeChat)});this.__textarea=this.$(".input-text");this.$(".btn-send").css({width:"70px",paddingLeft:"0px",paddingRight:"0px"})},connect:function(a){var c=this;_.each(this.__menus,function(e){e.connect(a);e.preloadCatalog()});this.__activeChat=a;this.__activeChat.on("change:messageTarget",this.renderCorrectFooter.bind(this));this.__activeChat.on("startWhisper",this.focusOnInput.bind(this));this.listenTo(this.__activeChat,"tooltipTutorial:complete",this.__maybeShowOnboardingTooltip);this.listenTo(this.__activeChat,"chatStream:open",function(){c.__chatStream&&c.__chatStream.setIsVisible(!0);c.__maybeShowOnboardingTooltip()});this.toggle(!0);this.__roomType=void 0!==this.__activeChat&&this.__activeChat.isLiveRoom()?"live_room":"chat";this.__maxLength="chat"===this.__roomType?this.__chatMaxLength:this.__liveMaxLength;this.$(".btn-send").attr("data-room-type",this.__roomType);this.$(".btn-send").css({width:"70px",paddingLeft:"0px",paddingRight:"0px"})},toggle:function(a){this.$el.toggleClass("disabled",!a);this.__textarea.blur()},render:function(){this.$el.html(g.template);this.__textarea=this.$(".input-text");this.__loginManager.isLoggedIn()?(this.__placeholder&&this.__textarea.attr("placeholder",this.__placeholder),g.NextUtil.DomHelper.enhanceTextarea(this.__textarea)):this.__textarea.attr("disabled","disabled");this.__maybeShowOnboardingTooltip();this.__setAsRendered()},__createMenus:function(a){a&&a.length?(_.each(a,function(c){var e=this.createChildContext(this.__menuFactories[c],{$parentElement:this.$el,context:this.__context,partnerCollection:this.__partnerCollection,actionCategoryListFactory:this.__actionCategoryListFactory});e.on("change",this.__updateSendButton.bind(this));e.on("send",this.__send.bind(this));this.__menus[c]=e;var d=$("<li />").text(this.__globalStringManager.get(c+"_tab"));d.attr("data-menu",c);this.$(".menu-tabs").append(d);e.on("item_list",this.__updateItemCount.bind(this,d,e))}.bind(this)),2>a.length&&this.$(".menu-bar").remove()):this.$(".menu-toggle").remove()},__onClickMenuTab:function(a){this.__switchToMenu($(a.currentTarget).attr("data-menu"))},__toggleMenus:function(){this.$(".menu-toggle").hasClass("disabled")||(this.$el.hasClass("menu-open")?this.collapseMenus():this.__expandMenus())},__switchToMenu:function(a){a!==this.__currentMenu&&(this.__menus[this.__currentMenu].cancelSelection(),this.__menus[this.__currentMenu].hideCatalog(),this.__openMenu(a))},showMenu:function(a){this.__expandMenus();this.__switchToMenu(a)},__setSelectedMenu:function(a){this.__currentMenu=a;a=this.$('.menu-tabs li[data-menu="'+a+'"]');a.length&&(g.NextUtil.DomHelper.radioClass(a,"active"),this.$(".menu-bar .magic-line").show().css({"margin-left":a.position().left+parseInt(a.css("margin-left"),10)+"px",width:a.outerWidth()}))},__openMenu:function(a){this.__setSelectedMenu(a);this.__menus[a].showCatalog()},__onWhisperClose:function(){this.__activeChat.resetMessageTarget()},__expandMenus:function(){this.$el.addClass("menu-open");this.__openMenu(this.__currentMenu||_.keys(this.__menus)[0])},disableActionMenu:function(a){this.$(".menu-toggle").toggleClass("disabled",a)},collapseMenus:function(){this.$el.removeClass("menu-open");this.__currentMenu&&this.__menus[this.__currentMenu].hideCatalog()},toggleStickerButton:function(a){!a&&this.__currentMenu&&(this.__menus[this.__currentMenu].cancelSelection(),this.collapseMenus());this.$(".menu-toggle").toggleClass("disabled",!a)},showStickerPack:function(a){this.toggleStickerButton(!0);this.showMenu("stickers");this.__menus.stickers.selectStickerPack(a.id)},hasInput:function(){return this.get().trim()||_.any(this.__menus,function(a){return a.getSelection()})},__updateSendButton:function(){this.$(".btn-send").prop("disabled",!this.hasInput());this.hasInput()?this.$(".btn-send.whisper").css({color:"rgb("+this.__whisperChatBarColor+")"}):this.$(".btn-send.whisper").css({color:""})},__updateItemCount:function(a,c,e){0<e?a.removeClass("hidden"):(c.cancelSelection(),c.hideCatalog(),a.addClass("hidden"),a=this.$(".menu-tabs li[data-menu]:first-child").attr("data-menu"),this.__setSelectedMenu(a))},__onInput:function(){this.__trimInputToMax();this.__updateSendButton();this.trigger("input",this.get())},__onInputFocus:function(){this.__featureAccessManager.canSeeOnboardingGamification()&&2===this.__onboardingGamificationManager.getModeStep("chat")&&(this.__maybeShowOnboardingTooltip(),this.__onboardingGamificationManager.setModeStep("chat",3))},__onKeypress:function(a){a.keyCode!==g.NextUtil.Keys.VK_ENTER||a.shiftKey||(this.__recordEvent("click",{name:"send",pressed_enter:1,number_of_windows:this.__serviceProvider.get("windowManager").getTotalOpenWindows(),sent_from:this.__isInWindow?"Window":"Mode",which:this.__roomType?this.__roomType:"chat"}),this.__send(a),a.preventDefault())},__trimInputToMax:function(){this.set(this.get().substr(0,this.__maxLength))},__send:function(a){var c=this;if(!this.hasInput())return!1;var e={message:this.get().trim()?this.get():this.get().trim()};_.each(this.__menus,function(d,h){if(h=d.getSelection())if(e[d.payloadName]=h,d.onSubmit)d.onSubmit()}.bind(this));this.clear();this.trigger("sendInput",e);this.__featureAccessManager.canSeeOnboardingGamification()&&(this.__myself=this.__loginManager.getCurrentUser(),this.__onboardingGamificationManager.handleTaskCompletion("chat_message",function(){return c.__recordEvent("onboarding",{name:"grant_reward",event_type:"chat_message",cid:c.__myself.get("legacy_cid"),record:!0})}));return!1},get:function(){return this.__textarea.val()},set:function(a){this.__textarea.val(a)},clear:function(){_.each(this.__menus,function(a){a.cancelSelection()}.bind(this));this.collapseMenus();this.__textarea.val("").trigger("refresh");this.__updateSendButton()},focusOnInput:function(){this.__textarea[0].focus()},hasFocus:function(){return this.__textarea[0]===document.activeElement},__createOnboardingTooltip:function(){this.__onboardingTooltip=this.createChildContext(g.ShinyTooltip,{$parentElement:this.$el,side:"left"});this.__onboardingTooltip.setContent(this.__globalStringManager.get("onboarding_tooltip_message"),this.__iconManager.iconHtml("icon-onboarding_chat_message"))},__maybeShowOnboardingTooltip:function(a){var c=this;if(!this.__loginManager.isLoggedIn())return!1;var e=4<=this.__prefsManager.getInt("next.chatscene.chat_room_tutorial_page")&&4<=this.__prefsManager.getInt("next.chatscene.chat_room_tooltip_step");a=2===this.__onboardingGamificationManager.getModeStep("chat")||a&&"chat"===a.mode&&2===a.step;e=this.__featureAccessManager.canSeeOnboardingGamification()&&!this.__featureAccessManager.isMobile()&&!(!this.__chatStream||!this.__chatStream.getIsVisible())&&e&&a;this.__onboardingTooltip?this.__onboardingTooltip.showTooltip(e):e&&(this.__createOnboardingTooltip(),this.__onboardingTooltip.showTooltip(e),this.listenTo(this.__onboardingGamificationManager,"mode:set",function(d){return c.__maybeShowOnboardingTooltip(d)}))}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],CoopActionMenu:Qa,CoopStickerMenu:Qa,PidActionMenu:pf,ShinyTooltip:sf,SoloActionMenu:Oa,SoloStickerMenu:Oa,StickerMenu:Uf,template:ef,whisperTemplate:qf}),Wf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c="<div class='notation no-results'><span>";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"post_has_no_tags",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</span></div>"},useData:!0})}({}),Xf=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'<button class="btn ap ap-badge"></button>'},3:function(b,a,c,e){var d,h=a.helperMissing;c='\n        <div class="owned-label">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"IN INVENTORY",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</div>\n    "},5:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f='\n        <div class="price-credits font-medium text-12 flex">\n            <div class="wh-15 mr-5">';if((h=(d=a.icon||b&&b.icon||h,d.call(b,"icon-credits",{name:"icon",hash:{class:"wh-full"},data:e})))||0===h)f+=h;return f+'</div>\n            <div class="credits-value">'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</div>\n        </div>\n    "},7:function(b,a,c,e){var d;c=a.helperMissing;var h='\n        <div class="cart-button add-to-cart-btn" title="',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Add to Cart",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='">';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-add-to-cart",{name:"icon",hash:{},data:e})))||0===f)h+=f;h+='</div>\n        <div class="cart-button in-cart-btn" title="';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"In Cart",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='">';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-in-cart",{name:"icon",hash:{},data:e})))||0===f)h+=f;return h+"</div>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h='<div class=\'name-container\'></div>\n<div class="tile-body">\n    <img class="tile-image" />\n    ',f=a["if"].call(b,b&&b.isAp,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)h+=f;h+='\n</div>\n<div class="product-info">\n    <div class="product-name">'+c((d=a.name||b&&b.name,"function"===typeof d?d.call(b,{name:"name",hash:{},data:e}):d))+'</div>\n    <div class="price-info">\n    ';if((f=a["if"].call(b,b&&b.isOwned,{name:"if",hash:{},fn:this.program(3,e),inverse:this.program(5,e),data:e}))||0===f)h+=f;h+="\n    </div>\n    ";if((f=a.unless.call(b,b&&b.isOwned,{name:"unless",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)h+=f;return h+"\n</div>\n"},useData:!0})}({}),Yf=function(g){var b=g.UiCore.UiContext;return b.extend("FeedTagTile",{className:"tile lightbox-tile product-tile feed-tag-tile",uiContextName:"feed_tag_tile",dependencies:"dialogManager featureAccessManager globalStartupModel imageManager loginManager photoDetails Promise restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",name:"click_tile",handler:"__onClick"},{type:"click",selector:".add-to-cart-btn",name:"add_look_to_cart",handler:"__addLookToCart"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__myself=this.track(a.loginManager.getCurrentUser());this.__cartModel=this.track(this.__myself.getSingleEdge("cart"));this.__user=this.track(this.__restModelFactory.readModel(a.tagInfo.id,g.UiCore.NodeModel),["online"],900);a=0<a.tagInfo.products.length?a.tagInfo.products:[this.__globalStartupModel.get("femaleBodyPatternUrl")];this.__productCollection=new IMVU.NamedCollection(_.map(a,function(c){return this.__restModelFactory.readModel(c,g.Model.ProductNode)}.bind(this)));this.__pidListArr=[];this.__isAp=this.__hasAvatar=!1;this.__price=0;this.__isOwned=!0;this.__outfitName="Outfit";this.__maleItemCount=this.__femaleItemCount=0;this.__Promise.every(this.__productCollection.map(function(c){return c.populated().then(function(){this.__pidListArr.push(c.get("product_id"));-1!=c.get("categories").indexOf("Avatars")&&(this.__hasAvatar=!0);"AP"==c.get("rating")&&(this.__isAp=!0);"female"==c.get("gender")?this.__femaleItemCount++:this.__maleItemCount++;c.get("is_owned")||(this.__isOwned=!1,this.__price=this.__myself.get("is_vip")?this.__price+c.get("discount_price"):this.__price+c.get("product_price"))}.bind(this))}.bind(this))).then(function(){this.__hasAvatar||(this.__femaleItemCount>this.__maleItemCount?this.__pidListArr.push("80"):this.__pidListArr.push("191"));this.__pidList=this.__pidListArr.join(",");this.__outfitUrl=this.__serviceProvider.get("root")+"/image_dressup/"+this.__pidList;this.addToDOM()}.bind(this))},render:function(){this.__cartModel.populated().then(function(){this.__cartProducts=this.__cartModel.getEdgeCollection("products",g.Model.CartProductCollection);return this.__cartProducts.populated({ignoreBadProducts:!0})}.bind(this)).then(function(){this.$el.html(g.template({name:this.__outfitName,price:this.__price,isAp:this.__isAp,isOwned:this.__isOwned}));this.__dualName=this.createChildContext(g.WAFWidgets.DualName,{$replaceElement:this.$(".name-container"),user:this.__user,configuration:"small-single-lightbg"});this.__imageManager.load(this.$(".tile-image"),this.__outfitUrl);this.__updateCartButton();this.listenTo(this.__cartProducts,"add remove reset",this.__updateCartButton.bind(this));this.__productCollection.each(function(a){this.listenTo(a,"change:is_owned",this.__updateCartButton.bind(this))}.bind(this))}.bind(this))},__updateCartButton:function(){var a=0<this.__productsToAddToCart().length;this.$el.toggleClass("in-cart",!a)},__onClick:function(){this.__dialogManager.showLightbox("FeedTagLightbox",{user:this.__user,photoDetails:this.__photoDetails,productCollection:this.__productCollection,pidListArr:this.__pidListArr,isAp:this.__isAp})},__addLookToCart:function(){this.__dialogManager.showLightbox("ShoppingCartLightbox",{productsToAdd:this.__productsToAddToCart()})},__productsToAddToCart:function(){return this.__productCollection.filter(function(a){return!a.get("is_owned")&&!this.__cartProducts.find(function(c){return c.node&&c.node.id===a.id})}.bind(this))}})}({Model:l["@Model"],UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],template:Xf}),Zf=function(g){var b=g.UiCore.UiContext;return b.extend("TagPanel",{uiContextName:"tag_panel",className:"tag-panel",dependencies:"featureAccessManager globalStartupModel globalStringManager model multiGetManager restModelFactory".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__restModelFactory=a.restModelFactory;this.__tagCount=0;this.addToDOM()},render:function(){this.model.populated().then(function(){return this.model.getSingleEdge("photo").populated()}.bind(this)).then(function(a){this.__photoNode=a;return a.getSingleEdge("photo_details").populated()}.bind(this)).then(function(a){this.__multiGetManager.queue(this.__photoNode);this.__multiGetManager.queue(a,this.__multiGetManager.autoRequestPlease);this.$el.html(g.template);var c=a.get("users");c=_.sortBy(c,function(d){return 0<d.products.length?-1:1});if(0<c.length){var e=0;_.each(c,function(d,h){0<d.products.length&&(e++,this.createChildContext(g.FeedTagTile,{photoDetails:a,tagInfo:d,$parentElement:this.$el}))}.bind(this));this.__tagCount=e}else this.$el.addClass("has-no-tags")}.bind(this))},getTagCount:function(){return this.__tagCount}})}({Model:l["@Model"],UiCore:l["@UiCore"],FeedTagTile:Yf,template:Wf}),$f=function(g){var b=g.SafetyReportDialog;return b.extend("ReportFeedItemDialog",{uiContextName:"report_feed_item_dialog",className:"report-feed-item-dialog",dependencies:["dialogManager","globalStartupModel","globalStringManager","restModelFactory"],title:"report_post_title",text:"report_post_text",dropdownOptions:[],initialize:function(a){this.__model=a.model;this.__pids=a.pids;this.dropdownOptions=[];"photo"===this.__model.get("type")?(this.dropdownOptions.push({label:"report_post_reason_inappropriate_image",value:"photo"}),this.__model.get("payload.message")&&this.dropdownOptions.push({label:"report_post_reason_inappropriate_caption",value:"caption"})):this.dropdownOptions.push({label:"report_post_reason_inappropriate_text",value:"text"});b.prototype.initialize.call(this,a)},getResult:function(){var a=b.prototype.getResult.call(this);a.pids=this.__pids;return a},postRender:function(){b.prototype.postRender.call(this)}})}({UiCore:l["@UiCore"],SafetyReportDialog:E}),ag=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression;return'\n<div class="counts-container">\n    <a class="action-like-count">\n        <span class="count count-likes">0</span>\n        <span class="likes-text"> '+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Likes",{name:"i18n-g",hash:{},data:e})))+'</span> &#183;&nbsp;\n    </a>\n        <a class="action-comment-count">\n            <span class="count count-comments">0</span>\n            <span class="comments-text"> '+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Comments",{name:"i18n-g",hash:{},data:e})))+'</span> &#183;&nbsp;\n        </a>\n    <a class="action-tag-count">\n        <span class="count count-tags">0</span>\n        <span class="tags-text"> '+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Tags",{name:"i18n-g",hash:{},data:e})))+"</span>\n    </a>\n</div>\n"},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h="",f=a.unless.call(b,b&&b.hideCounts,{name:"unless",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)h+=f;h+='\n<ul class="actions-container bar">\n    <li class="action-bar-item action-more-container">\n        <button class="btn action-more">\n            ';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-more",{name:"icon",hash:{},data:e})))||0===f)h+=f;h+='\n        </button>\n    </li>\n    <li class="action-bar-item action-like-container">\n        <a class="btn action-like">\n            ';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-like-off",{name:"icon",hash:{},data:e})))||0===f)h+=f;h+="\n            ";if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-like-on",{name:"icon",hash:{class:"color-red"},data:e})))||0===f)h+=f;h+='\n        </a>\n    </li>\n    <li class="action-bar-item action-comment-container">\n        <a class="btn action-comment">\n            ';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-comment-off",{name:"icon",hash:{},data:e})))||0===f)h+=f;h+='\n        </a>\n    </li>\n    <li class="action-bar-item action-tag-container">\n        <a class="btn action-tag">\n            ';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-tag",{name:"icon",hash:{},data:e})))||0===f)h+=f;return h+'\n        </a>\n    </li>\n    <li class="action-bar-item action-share-container">\n    </li>\n</ul>\n'},useData:!0})}({}),bg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="main-container">\r\n    <div class="canvas-container container"><div class="image-container"></div><div class="canvas-footer"></div></div>\r\n    <div class="controls-container container"></div>\r\n</div>\r\n\r\n<script type="text/template" class="post-header-template">\r\n    <a class="back">',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Back",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='</a>\r\n    <a class="post">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"dialog_photobooth_post",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</a>\r\n<\/script>\r\n\r\n<script type="text/template" class="save-header-template">\r\n    <a class="save">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Save",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</a>\r\n<\/script>"},useData:!0})}({}),Xa=function(g){var b=g.UiCore.UiContext;return b.extend("UploadCurtain",{uiContextName:"upload_curtain",className:"upload-curtain",dependencies:["Promise","timer"],initialize:function(a){b.prototype.initialize.call(this,a);this.serviceProvider=a.serviceProvider;this.Promise=a.Promise;this.timer=a.timer;this.__completeDelay=a.completeDelay||1e3;this.addToDOM()},show:function(){this.$el.addClass("loading");b.prototype.show.call(this)},complete:function(){this.$el.removeClass("loading");return new this.Promise(function(a){this.__completeTimer=this.timer.setTimeout(function(){a.accept();this.hide()}.bind(this),this.__completeDelay)}.bind(this))},delete:function(){this.timer.clearTimeout(this.__completeTimer)}})}({UiCore:l["@UiCore"]}),cg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing;return'<div class="component-options">\n    <div class="component-option">\n        <textarea tabindex="1" class="input-caption" maxlength="'+c((d=a.photoCaptionMaxLength||b&&b.photoCaptionMaxLength,"function"===typeof d?d.call(b,{name:"photoCaptionMaxLength",hash:{},data:e}):d))+'" placeholder="'+c((d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Say something...",{name:"i18n-g",hash:{},data:e})))+'" autofocus></textarea>\n    </div>\n</div>\n'},useData:!0})}({}),dg=function(g){var b=g.UiCore.UiContext;return b.extend("BaseControlsPresenter",{activate:function(){this.show();this.__scroller.refreshScrollability()},addToDOM:function(){b.prototype.addToDOM.call(this);this.__scroller=this.createChildContext(g.SimpleScroller,{$parentElement:this.$el,scrollBy:380,$target:this.$("ul")})},deactivate:function(){this.hide()},reset:function(){}})}({UiCore:l["@UiCore"],SimpleScroller:P}),eg=function(g){var b=g.BaseControlsPresenter;return b.extend("CaptionControlsPresenter",{uiContextName:"caption_controls_presenter",className:"caption-controls-presenter control-presenter",dependencies:[],initialize:function(a){b.prototype.initialize.call(this,a);this.__canvasPresenter=a.canvasPresenter;this.__photoCaptionMaxLength=a.photoCaptionMaxLength;this.addToDOM()},render:function(){this.$el.html(g.template({photoCaptionMaxLength:this.__photoCaptionMaxLength}));g.NextUtil.DomHelper.enhanceTextarea(this.$(".input-caption"),this.__photoCaptionMaxLength)}})}({NextUtil:l["@NextUtil"],BaseControlsPresenter:dg,template:cg}),Ya=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("PhotoBoothCaptionDialog",{uiContextName:"photo_booth_caption_dialog",className:"photo-booth-caption-dialog dialog-type-B-flexible is-tall",dependencies:["dialogManager","featureAccessManager","globalStringManager","onboardingGamificationManager"],trackedEvents:function(){return[{type:"click",selector:".post",name:"post",handler:this.__post},{type:"click",selector:".save",name:"save",handler:this.__save},{type:"click",selector:".back",name:"back",handler:this.__back}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__mode=a.mode||"add";this.__stringManager=a.globalStringManager;this.__dialogManager=a.dialogManager;this.__photoCaptionMaxLength=a.photoCaptionMaxLength;this.title="edit"===this.__mode?this.__stringManager.get("dialog_photobooth_edit_title"):this.__stringManager.get("dialog_photobooth_caption_title");this.__postCompleteDelay=a.postCompleteDelay||1e3;"edit"===this.__mode?this.model=a.model:this.__photoBooth=a.photoBooth;this.addToDOM()},postRender:function(){this.$(".dialog-body").html(g.template({photoCaptionMaxLength:this.__photoCaptionMaxLength}));"edit"===this.__mode?this.__postRenderEdit():this.__postRenderAdd()},__postRenderAdd:function(){this.__uploadCurtain=this.createChildContext(g.UploadCurtain,{$parentElement:this.$el,completeDelay:this.__postCompleteDelay});this.$(".image-container").css("background-image","url("+this.__photoBooth.getImageUrl()+")");this.createChildContext(g.CaptionControlsPresenter,{$parentElement:this.$(".controls-container"),photoCaptionMaxLength:this.__photoCaptionMaxLength});this.__photoBooth.on("exit",this.__photoBoothExit,this);this.__photoBooth.on("postFail",this.__removeCurtain,this);this.__photoBooth.on("canPost",this.setPostStatus,this);this.setContent("auxHeader",this.$(".post-header-template").text())},__postRenderEdit:function(){this.createChildContext(g.FeedPhoto,_.extend({$parentElement:this.$(".canvas-container")},{model:this.model}));this.createChildContext(g.CaptionControlsPresenter,{$parentElement:this.$(".controls-container"),photoCaptionMaxLength:this.__photoCaptionMaxLength});this.$(".image-container").css("display","none");this.$(".input-caption").val(this.model.get("payload.message"));this.$(".input-caption").trigger("refresh");this.setContent("auxHeader",this.$(".save-header-template").text())},__post:function(){this.__uploadCurtain.show();this.__photoBooth.post(this.$(".input-caption").val())},__photoBoothExit:function(){var a=this;this.__featureAccessManager.canSeeOnboardingGamification()&&this.__onboardingGamificationManager.handleTaskCompletion("social_feed",function(){return a.__recordEvent("onboarding",{name:"grant_reward",event_type:"social_feed",cid:a.__myself.get("legacy_cid"),record:!0})});this.__uploadCurtain.hide();this.promiseResolver.resolve();this.delete()},__removeCurtain:function(){this.__uploadCurtain.hide()},setPostStatus:function(a){this.$(".back").toggleClass("disabled",!a);this.$(".post").toggleClass("disabled",!a)},__save:function(){this.__previousCaptionVal=this.model.get("payload.message");var a={payload:{id:this.model.relations.photo,message:this.$(".input-caption").val()},type:"photo"};this.model.save(a).catch(function(){this.__dialogManager.alert({title:this.__stringManager.get("dialog_photobooth_save_error_title"),text:this.__stringManager.get("dialog_photobooth_save_error_text"),ok:this.__stringManager.get("dialog_photobooth_save_error_button")});this.model.save({payload:{message:this.__previousCaptionVal}})}.bind(this));this.delete()},__back:function(){this.delete()},delete:function(){b.prototype.delete.call(this)}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],CaptionControlsPresenter:eg,FeedPhoto:Ia,UploadCurtain:Xa,template:bg}),Za=function(g){var b=function(d){return function(){d.__photoBooth.post()}},a=function(d){return function(){d.__dialogManager.showDialog(g.PhotoBoothCaptionDialog,{photoBooth:d.__photoBooth,photoCaptionMaxLength:d.__photoCaptionMaxLength}).finished.then(function(){d.promiseResolver.resolve();d.hide()})}},c=function(d){return function(h,f){d.__photoBooth=d.__modeManager.createChildContext(h.PhotoBooth,{$parentElement:d.__modeManager.$el,overrideLookUrl:d.__overrideLookUrl});d.__serviceProvider.register("photoBooth",d.__photoBooth);d.addToDOM()}},e=g.Dialogs.AlloyModalDialog;return e.extend("PhotoBoothDialog",{uiContextName:"photo_booth_dialog",className:"photo-booth-dialog dialog-type-B-flexible is-tall",dependencies:["dialogManager","featureAccessManager","globalStartupModel","globalStringManager","modeManager"],trackedEvents:function(){return[{type:"click",selector:".post",name:"post",handler:b(this)},{type:"click",selector:".next",name:"next",handler:a(this)}]},initialize:function(d){e.prototype.initialize.call(this,d);this.__stringManager=d.globalStringManager;this.title=d.title||this.__stringManager.get("dialog_photobooth_title");this.__modeManager=d.modeManager;this.__overrideLookUrl=d.overrideLookUrl;this.__photoCaptionMaxLength=d.globalStartupModel.get("photo_caption_max_length");_.has(this.__serviceProvider.services,"photoBooth")||_.has(d,"photoBooth")?(this.__photoBooth=d.photoBooth||this.__serviceProvider.get("photoBooth"),this.addToDOM()):module.run({PhotoBooth:"@PhotoBooth"},c(this))},postRender:function(){this.__photoBooth.attach(this.$(".dialog-body"),{overrideLookUrl:this.__overrideLookUrl}).then(function(){this.setContent("auxHeader",this.$(".aux-header-template-2").text())}.bind(this));this.__photoBooth.on("exit",this.hide,this);this.__photoBooth.on("canPost",this.setPostStatus,this)},setPostStatus:function(d){this.$(".post").toggleClass("disabled",!d)},delete:function(){this.__photoBooth.detach();this.__photoBooth.off(null,null,this);e.prototype.delete.call(this)}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],PhotoBoothCaptionDialog:Ya}),$a=function(g){var b=g.UiCore.UiContext;return b.extend("FeedActionBar",{uiContextName:"feed_action_bar",tagName:"ul",className:"feed-action-bar bar",dependencies:"contextMenuManager dialogManager featureAccessManager globalStartupModel globalStringManager googleAnalytics loginManager modeManager platform Promise rest restModelFactory timer".split(" "),trackedEvents:function(){return[{type:"click",selector:".action-more",name:"feed_item_menu",handler:this.__showActionMenu},{type:"click",selector:".action-tag",name:"feed_item_tag",handler:this.__triggerTags},{type:"click",selector:".action-tag-count",name:"feed_item_tag_count",handler:this.__triggerTagCount},{type:"click",selector:".action-like:not(.is-liked)",name:"feed_item_like",handler:this.triggerLike},{type:"click",selector:".action-like.is-liked",name:"feed_item_like",handler:this.__triggerUnlike},{type:"click",selector:".action-like-count",name:"feed_item_like_count",handler:this.__triggerLikeCount},{type:"click",selector:".action-comment",name:"feed_item_comment",handler:this.__triggerComments},{type:"click",selector:".action-comment-count",name:"feed_item_comment_count",handler:this.__triggerCommentCount}]},initialize:function(a){this.uiAttributes={repeats:1};b.prototype.initialize.call(this,a);this.__imageManager=a.imageManager;this.__loginManager=a.loginManager;this.__isLoggedIn=this.__loginManager.isLoggedIn();this.__modeManager=a.modeManager;this.__googleAnalytics=a.googleAnalytics;this.__contextMenuManager=a.contextMenuManager;this.__dialogManager=a.dialogManager;this.__globalStringManager=a.globalStringManager;this.__restModelFactory=a.restModelFactory;this.__reportUrl=a.globalStartupModel.get("safetyReportUrl");this.__featureAccessManager=a.featureAccessManager;this.__rest=a.rest;this.__hideCounts=a.hideCounts;this.__activeChat=IMVU.optionalProperty(a,"activeChat",null);this.__isReportable=IMVU.optionalProperty(a,"isReportable",!1);this.__feedType=a.feedType;this.__allCounts=new Backbone.Model({tags:0,likes:0,comments:0});this.listenTo(this.__allCounts,"change",this.__onCountsChange.bind(this));this.__photoCaptionMaxLength=this.__globalStartupModel.get("photo_caption_max_length");this.__isLoggedIn=!!this.__loginManager.isLoggedIn();this.addToDOM();this.listenTo(this.model,"change",this.__onModelChange.bind(this))},delete:function(){b.prototype.delete.call(this);this.__timer.clearTimeout(this.__waitAtLeastTimeout)},__forceLoginStopProp:function(a){this.__isLoggedIn||("undefined"!==typeof a&&a.stopPropagation(),this.__dialogManager.showLoginOrSignupDialog())},__onCountsChange:function(){this.$(".action-tag-container, .action-tag-count").toggleClass("disabled",!this.__allCounts.get("tags"));var a=this.__allCounts.get("tags");this.$(".action-tag-container, .action-tag-count").toggleClass("disabled",!a);this.$(".count-tags").text(a);1===a&&this.$(".tags-text").text(this.__globalStringManager.get("Tag"));a=this.__allCounts.get("comments");this.$(".count-comments").text(g.FormatNumber.formatMini(a));1===a&&this.$(".comments-text").text(this.__globalStringManager.get("Comment"));a=this.__allCounts.get("likes");this.$(".count-likes").text(g.FormatNumber.formatMini(a));1===a&&this.$(".likes-text").text(this.__globalStringManager.get("Like"));this.$el.toggleClass("has-counts",0<this.__allCounts.get("tags")||0<this.__allCounts.get("likes")||0<this.__allCounts.get("comments"))},__postIsByMe:function(){if(this.__loginManager.isLoggedIn()){var a=this.actor_profile.id.match(/\d+$/)[0],c=this.__loginManager.getCurrentUser().id.match(/\d+$/)[0];return a===c}return!1},__isStaff:function(){return this.__loginManager.isLoggedIn()?this.__loginManager.getCurrentUser().get("is_staff"):!1},__mayWhiteList:function(){return this.__featureAccessManager.hasWhitelistAccess()||this.__isStaff()},__isWhiteListed:function(){return void 0===this.model.relations.whitelist&&void 0!==this.model.relations.unwhitelist},__isUnWhiteListed:function(){return void 0!==this.model.relations.whitelist&&void 0===this.model.relations.unwhitelist},__getActionMenuItems:function(){var a=[];if(this.__postIsByMe())a.push({name:"delete",text:this.__globalStringManager.get("Delete"),handler:this.__deleteFeedItem.bind(this)}),"photo"===this.model.get("type")&&a.push({name:"edit",text:this.__globalStringManager.get("dialog_photobooth_edit_title"),handler:this.__editFeedItem.bind(this)});else{var c=this.__modeManager.getCurrentMode();c=c&&c.getCurrentSubmode()?c.getCurrentSubmode().id:void 0;(!this.__isWhiteListed()&&"explore"!==c||!this.__isWhiteListed()&&this.__isReportable)&&a.push({name:"report",text:this.__globalStringManager.get("Report"),handler:this.__reportFeedItem.bind(this)})}this.__mayWhiteList()&&(this.__isUnWhiteListed()?a.push({name:"whitelist",text:this.__globalStringManager.get("Whitelist"),handler:this.__whitelist.bind(this)}):this.__isWhiteListed()&&a.push({name:"unwhitelist",text:this.__globalStringManager.get("Unwhitelist"),handler:this.__unwhitelist.bind(this)}));this.__whitelistedBy&&a.push({name:"whitelistedby",text:this.__globalStringManager.get("WhitelistedBy",{username:this.__whitelistedBy.get("username")}),handler:this.__onClickWhitelister.bind(this)});return a},__showActionMenu:function(a){this.__isLoggedIn?(a.stopPropagation(),this.__contextMenuManager.toggleMenu(a,g.ContextMenu,{items:this.__getActionMenuItems(),displayOptions:{above:!1,right:!0}})):this.__forceLoginStopProp(a)},__whitelist:function(){this.__rest.post(this.model.relations.whitelist,{}).then(function(){this.model.invalidate()}.bind(this)).catch(function(){this.__dialogManager.alert({title:this.__globalStringManager.get("whitelist_error_title"),text:this.__globalStringManager.get("whitelist_error_text"),ok:this.__globalStringManager.get("OK")})}.bind(this))},__unwhitelist:function(){this.__rest.delete(this.model.relations.unwhitelist,{}).then(function(){this.model.invalidate()}.bind(this)).catch(function(){this.__dialogManager.alert({title:this.__globalStringManager.get("whitelist_error_title"),text:this.__globalStringManager.get("unwhitelist_error_text"),ok:this.__globalStringManager.get("OK")})}.bind(this))},__reportFeedItem:function(){var a,c=new this.__Promise(function(d){a=d});if(this.model.relations.photo_details){var e=[];this.model.getSingleEdge("photo_details").populated().then(function(d){var h=d.get("room.products");d.get("users").forEach(function(f){h=h.concat(f.products)});e=h.map(function(f){return f.match(/\d+/)[0]}).filter(function(f,k,m){return m.indexOf(f)===k}).join();a.resolve(e)}.bind(this)).catch(function(){a.resolve("")}.bind(this))}else a.resolve("");c.then(function(d){return this.__dialogManager.showDialog(g.ReportFeedItemDialog,{model:this.model,pids:d}).finished}.bind(this))},__deleteFeedItem:function(){this.__dialogManager.confirm({title:this.__globalStringManager.get("Delete Post"),text:this.__globalStringManager.get("Are you sure"),yes:this.__globalStringManager.get("Delete"),no:this.__globalStringManager.get("Cancel")}).finished.then(function(){this.model.destroy().then(function(){this.__modeManager.openMode({openDefaultView:!0,mode:{id:"feed"}})}.bind(this),function(){this.__dialogManager.alert({title:this.__globalStringManager.get("Network Error Title"),text:this.__globalStringManager.get("Network Error Text"),ok:this.__globalStringManager.get("Network Error Ok")})}.bind(this))}.bind(this))},__editFeedItem:function(){this.__dialogManager.showDialog(g.PhotoBoothCaptionDialog,{mode:"edit",model:this.model,photoCaptionMaxLength:this.__photoCaptionMaxLength})},render:function(){var a=this;this.doWork([function(){return a.model.populated()},function(){a.$el.html(g.template({hideCounts:a.__hideCounts}));a.__onCountsChange();var c=null;a.__mayWhiteList()&&a.model.relations.whitelister&&(c=a.model.getSingleEdge("whitelister"),c.populated().then(function(e){this.__whitelistedBy=e}.bind(a)));a.actor_profile=a.model.getSingleEdge("actor_profile");a.actor=a.model.getSingleEdge("actor");c=a.createChildContext(g.WithmeWidgets.SocialShare,{$parentElement:a.$(".action-share-container"),linkToCopy:a.__getShareLink()});a.$el.toggleClass("hide-counts",!!a.__hideCounts);a.__onModelChange(!1);a.$(".action-more").toggle("subscribed_feed"===a.__feedType||0<a.__getActionMenuItems().length);c.getHasRenderedPromise().then(function(){a.__setAsRendered()})}]).catch(function(c){a.__setAsRenderFailed("FeedActionBar::render - Failed")});if(!this.__isLoggedIn)this.$(".action-more").on("click",function(c){this.__forceLoginStopProp(c)}.bind(this))},__onModelChange:function(){var a=this;this.likedby&&this.likedby.off(void 0,void 0,this);this.likedby=this.track(this.model.searchEdgeCollection("liked_by_profile",{limit:0},g.UiCore.EdgeCollection));this.listenTo(this.likedby,"add remove update reset",this.__onLikeCollectionChange.bind(this));this.__onLikeCollectionChange();this.__hideCounts||(this.commentsSummary&&this.commentsSummary.off(void 0,void 0,this),this.commentsSummary=this.model.getSummaryCollection("comments"),this.listenTo(this.commentsSummary,"update add remove reset",this.__onCommentsCollectionChange.bind(this)),this.__onCommentsCollectionChange(),"photo"===this.model.get("type")&&this.doWork([function(){return a.model.getSingleEdge("photo").populated()},function(c){return c.getSingleEdge("photo_details").populated()},function(c){a.__userTags=new IMVU.NamedCollection;var e=0;_.each(c.get("users"),function(d){d.products&&0<d.products.length&&e++;this.__userTags.add(this.__serviceProvider.create(IMVU.NamedModel,d))}.bind(a));a.__allCounts.set("tags",e)}]))},__onCommentsCollectionChange:function(){this.__allCounts.set("comments",this.commentsSummary.total_count)},__onLikeCollectionChange:function(){this.likedby.populated().then(function(){this.__allCounts.set("likes",this.likedby.total_count);var a=null!==this.likedby.getMyEdge();if(!a&&this.__loginManager.isLoggedIn()){var c=this.__loginManager.getCurrentUser().relations.profile;_.each(this.likedby.models,function(e){e.node.id===c&&(a=!0)}.bind(this))}if(!0===this.__pendingOptimisticLikeState||!1===this.__pendingOptimisticLikeState)a=this.__pendingOptimisticLikeState,delete this.__pendingOptimisticLikeState;this.$(".action-like").toggleClass("is-liked",!!a)}.bind(this))},__waitAtLeast:function(a,c,e){a-=new Date-c;0>a&&(a=0);this.__timer.clearTimeout(this.__waitAtLeastTimeout);this.__waitAtLeastTimeout=this.__timer.setTimeout(e,a)},triggerLike:function(){if(!this.__isLoggedIn)this.__forceLoginStopProp();else if(!this.__isLikeOrUnlikeInFlight){var a=new Date;this.__isLikeOrUnlikeInFlight=!0;this.__googleAnalytics.recordFeedItemAction("liked post");this.__pendingOptimisticLikeState=!0;this.$(".action-like").addClass("is-liked");this.trigger("like");this.model.like().catch(function(c){delete this.__pendingOptimisticLikeState;this.__waitAtLeast(1e3,a,function(){this.$(".action-like").removeClass("is-liked")}.bind(this))}.bind(this)).then(function(){this.__isLikeOrUnlikeInFlight=!1}.bind(this))}},__triggerUnlike:function(){if(!this.__isLikeOrUnlikeInFlight){var a=new Date;this.__isLikeOrUnlikeInFlight=!0;this.__googleAnalytics.recordFeedItemAction("unliked post");this.__pendingOptimisticLikeState=!1;this.$(".action-like").removeClass("is-liked");this.model.unlike().catch(function(c){delete this.__pendingOptimisticLikeState;this.__waitAtLeast(1e3,a,function(){this.$(".action-like").addClass("is-liked")}.bind(this))}.bind(this)).then(function(){this.__allCounts.set("likes",this.__allCounts.get("likes")-1);this.__isLikeOrUnlikeInFlight=!1}.bind(this))}},__triggerLikeCount:function(){"mobile"===this.__platform?this.$(".action-like").hasClass("is-liked")?this.__triggerUnlike():this.triggerLike():this.trigger("action-like-count")},__triggerComments:function(){this.trigger("action-comments")},__triggerCommentCount:function(){this.trigger("action-comment-count")},__triggerTags:function(){this.trigger("action-tags")},__triggerTagCount:function(){this.trigger("action-tag-count")},__onClickWhitelister:function(a){this.__user=this.__whitelistedBy;this.__ignoreClicks||(a.stopPropagation(),this.__user&&this.__user.populated().then(function(){this.__isLoggedIn?this.__dialogManager.showLightbox("ProfileLightbox",{user:this.__user,activeChat:this.__activeChat}):this.__modeManager.openMode({mode:{id:"av"},submode:{id:this.__user.get("id")}})}.bind(this)))},__getShareLink:function(){var a=this.__globalStartupModel.get("goLinkBase"),c=this.model.id.split("/");return a+="/feed/"+c.pop()}})}({Model:l["@Model"],UiCore:l["@UiCore"],WithmeWidgets:l["@WithmeWidgets"],ContextMenu:t,FormatNumber:r,PhotoBoothCaptionDialog:Ya,PhotoBoothDialog:Za,ReportFeedItemDialog:$f,template:ag}),fg=function(g){var b=g.FeedActionBar;return b.extend("ActionBar",{className:"action-bar feed-action-bar",uiContextName:"action_bar",initialize:function(a){a.hideCounts=!0;b.prototype.initialize.call(this,a)}})}({UiCore:l["@UiCore"],FeedActionBar:$a}),gg=function(g){var b=g.LightboxDialog;return b.extend("FeedLightbox",{uiContextName:"feed_lightbox",className:"feed-lightbox lightbox-dialog",trackedEvents:function(){return b.prototype.trackedEvents.call(this).concat([{type:"click",selector:".feed-photo .expanded-photo",name:"collapse_photo",handler:"__collapsePhoto"},g.NextUtil.DomHelper.trackClickOrDouble({selector:".feed-photo",clickName:"click_toggle_photo_view",clickHandler:this.__expandPhoto,doubleclickName:"doubleclick_like",doubleclickHandler:this.__like})])},dependencies:"defer dialogManager featureAccessManager globalStringManager loginManager model multiGetManager platform restModelFactory timer".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__dialogManager=a.dialogManager;this.__myself=this.track(a.loginManager.getCurrentUser());this.linkToDetailsSubmode("feed",this.model);this.model.populated().then(function(){this.isPhoto="photo"===this.model.get("type");this.actor=this.model.getSingleEdge("actor");this.isPhoto?(this.feedItemWidget=this.addWidgetToMainContainer(g.FeedPhoto,{model:this.model}),"mobile"===this.__platform&&this.model.getSingleEdge("photo").populated().then(function(c){if(c.relations.location){var e=this.__restModelFactory.readModel(c.relations.location,g.UiCore.NodeModel);e.populated().then(function(d){"public"!==d.attributes.privacy||d.attributes.is_ap||this.addWidgetToMainContainer(g.PhotoRoomUsers,{model:this.model,$parentElement:this.$(".widgets"),actor:this.actor,roomModel:e})}.bind(this))}}.bind(this))):this.feedItemWidget=this.addWidgetToMainContainer(g.FeedText,{model:this.model});this.__setupHeadpiece();this.__setupComments();this.__setupLikes();this.isPhoto&&this.__setupTags();a.tab&&this.__selectPanel(a.tab)}.bind(this))},postRender:function(){b.prototype.postRender.call(this);this.model.populated().then(function(){}.bind(this)).catch(function(){this.model.invalidate();this.render()}.bind(this))},__setupHeadpiece:function(){this.addWidgetToHeadpiece(g.FeedHeadpiece,{model:this.model});var a=this.addWidgetToHeadpiece(g.ActionBar,{model:this.model});a.on("like",function(){this.feedItemWidget.bigLikingAnimation()}.bind(this));this.listenTo(a,"item-reported",this.__onReported.bind(this));this.feedItemWidget.on("like",function(){a.triggerLike()}.bind(this))},__setupLikes:function(){this.__likesCollection=this.track(this.model.searchEdgeCollection("liked_by_profile",{limit:20},g.UiCore.EdgeCollection,{appendToSearchCollection:!0}));this.__likesCollection.on("add remove reset",this.__updateLikes,this);this.addWidgetToSidebarPanel(g.LikeList,{collection:this.__likesCollection,addCounter:!0},"likes");this.__updateLikes()},__updateLikes:function(){this.$(".counter-likes").text(g.FormatNumber.formatMini(this.__likesCollection.total_count||0));1===this.__likesCollection.total_count&&this.$(".counter-likes-text").text(this.__globalStringManager.get("Like"))},__setupTags:function(){this.__tagPanel=this.addWidgetToSidebarPanel(g.TagPanel,{addCounter:!0,model:this.model},"tags");this.model.getSingleEdge("photo").populated().then(function(a){return a.getSingleEdge("photo_details").populated()}.bind(this)).then(function(a){this.__multiGetManager.queue(a,this.__multiGetManager.autoRequestPlease);this.__userTags=new IMVU.NamedCollection;_.each(a.get("users"),function(c){this.__userTags.add(this.__serviceProvider.create(IMVU.NamedModel,c))}.bind(this));this.$(".counter-tags").text(this.__tagPanel.getTagCount());1===this.__tagPanel.getTagCount()&&this.$(".counter-tags-text").text(this.__globalStringManager.get("Tag"))}.bind(this))},__setupComments:function(){this.__commentsCollection=this.track(this.model.searchEdgeCollection("comments",{limit:10},g.Model.FeedCommentCollection,{appendToSearchCollection:!0}));this.__commentsCollection.on("add remove reset",this.__updateComments,this);this.addWidgetToSidebarPanel(g.CommentList,{addCounter:!0,collection:this.__commentsCollection,feedModel:this.model},"comments");var a=this.addFooterToSidebarPanel(g.ChatBar,{placeholder:this.__globalStringManager.get("Say something...")},"comments");a.toggle(!0);this.listenTo(a,"sendInput",this.__sendComment.bind(this));this.__commentsCollection.populated().then(function(){this.__multiGetManager.queue(this.__commentsCollection,this.__multiGetManager.autoRequestPlease);this.__updateComments();this.__scrollToLastComment()}.bind(this))},__sendComment:function(a){var c=function(e){e.populated().then(function(){e.node.getSingleEdge("author").id===this.__myself.id&&(this.__commentsCollection.off("add",c,this),this.__defer(this.__scrollToLastComment.bind(this)))}.bind(this))};this.__commentsCollection.on("add",c,this);this.__restModelFactory.createModel(this.__commentsCollection.url,g.UiCore.EdgeModel,{comment_text:a.message}).catch(function(){this.__commentsCollection.off("add",c,this);this.__dialogManager.alert({title:this.__globalStringManager.get("dialog_feed_comment_error_title"),text:this.__globalStringManager.get("dialog_feed_comment_error_text"),ok:this.__globalStringManager.get("dialog_feed_comment_error_button")})}.bind(this))},__updateComments:function(){this.$(".counter-comments").text(g.FormatNumber.formatMini(this.__commentsCollection.total_count));1===this.__commentsCollection.total_count&&this.$(".counter-comments-text").text(this.__globalStringManager.get("Comment"))},__scrollToLastComment:function(){if("mobile"!==this.__platform){var a=this.$("[data-panel=comments] .feed-comments").outerHeight(!0);this.$("[data-panel=comments] .scroller:not(.scroll-wrapper)").scrollbar().scrollTop(a)}},__onReported:function(){this.hide();this.promiseResolver.reject()},__expandPhoto:function(){"mobile"===this.__platform&&(this.$el.addClass("is-expanded"),this.$(".main-container").css({height:"100%",width:"100%"}))},__collapsePhoto:function(){this.$el.removeClass("is-expanded");this.refreshSize()},delete:function(){this.__commentsCollection&&this.__commentsCollection.off(null,null,this);this.__likesCollection&&this.__likesCollection.off(null,null,this);b.prototype.delete.call(this)},__like:function(){this.model.like();this.__bigLikingAnimation()},__bigLikingAnimation:function(){g.NextUtil.DomHelper.applyTemporaryClass(this.__timer,this.$(".feed-photo"),"liking",1e3)}})}({Model:l["@Model"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],ActionBar:fg,ChatBar:Vf,CommentList:af,Counter:Re,FeedHeadpiece:We,FeedPhoto:Ia,FeedText:Ke,FormatNumber:r,LightboxDialog:v,LikeList:Oe,PhotoRoomUsers:Ja,TagPanel:Zf}),hg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="profile-posts-container"></div>'},useData:!0})}({}),ig=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="bar">\n    <div class="name-widget-goes-here"></div>\n</div>'},useData:!0})}({}),jg=function(g){var b=function(){function a(c,e,d,h,f){return f.relativeTime(e||1,!!d,c,h)}return function(c){var e=+this;var d=this.lang();var h=Math.round(Math.abs(e)/1e3),f=Math.round(h/60),k=Math.round(f/60),m=Math.round(k/24),n=Math.round(m/365);h=45>h&&["s",h]||1===f&&["m"]||45>f&&["mm",f]||1===k&&["h"]||22>k&&["hh",k]||1===m&&["d"]||345>=m&&["dd",m]||1===n&&["y"]||["yy",n];h[2]=!c;h[3]=0<e;h[4]=d;d=a.apply({},h);c&&(d=this.lang().pastFuture(e,d));return d}}();g.moment.lang("IOSRelativeTime",{relativeTime:{future:"in %s",past:"%s ago",s:"Just now",m:"1m",mm:"%dm",h:"1h",hh:"%dh",d:"1d",dd:function(a){return 7>a?a+"d":Math.floor(a/7)+"w"},y:"1y",yy:"%dy"}});g.moment.lang("en");return function(a){var c=g.moment.apply(this,Array.prototype.slice.call(arguments,1));c.lang("IOSRelativeTime");c.from=function(e,d){e=b.call(g.moment.duration(this.diff(e)).lang(this.lang()._abbr),!d);return a.get("globalStringManager").getWithDefault(e,e||"")};return c}}({moment:l["@moment"]}),kg=function(g){var b=g.UiCore.UiContext;return b.extend("FeedItemHeader",{uiContextName:"feed_item_header",tagName:"header",className:"feed-item-header feed-item-runner",dependencies:["featureAccessManager","timer"],initialize:function(a){b.prototype.initialize.call(this,a);this.__timer=a.timer;this.__featureAccessManager=a.featureAccessManager;this.__model=a.model;this.__ignoreUserClicks=!!a.ignoreUserClicks;this.__feedType=a.feedType;this.__viewType=a.viewType;this.addToDOM()},setUseCase:function(a){if(void 0!==a){if(this.__useCase=a,this.__dualName)switch(this.__useCase){case"FeedToggleToGrid":this.__dualName.setConfiguration("small-single-split-darkbg");this.__dualName.drawIt();break;case"FeedToggleToColumn":this.__dualName.setConfiguration("small-single-lightbg"),this.__dualName.drawIt()}}else if(this.__useCase="FeedItemCard","grid"===this.__viewType)this.__useCase="FeedItemGrid";else switch(this.__feedType){case"subscribed_feed":case"recommended_feed":case"adult_feed":case"teen_feed":this.__useCase="FeedItemColumn";break;case"user_profile_card":this.__useCase="FeedItemUserProfile";break;default:"feed_detail_widget"!==this.__parentUiContext.uiContextName&&(this.__useCase="FeedItemUserProfile")}},shouldShowCaption:function(){return this.__useCase.match(/column$/i)||"FeedItemUserProfile"===this.__useCase},render:function(){var a=this;this.doWork([function(){return a.model.populated()},function(){a.$el.html(g.template);a.createChildContext(g.FeedItemTimestamp,{$parentElement:a.$(".bar"),timestamp:a.model.get("time")});a.actorProfile=a.model.getSingleEdge("actor_profile");return a.actorProfile.populated()},function(){a.setUseCase();switch(a.__useCase){case"FeedItemGrid":a.__dualName=a.createChildContext(g.WAFWidgets.DualName,{$replaceElement:a.$(".name-widget-goes-here"),user:a.actorProfile,configuration:"small-single-split-darkbg",ignoreClicks:a.__ignoreUserClicks});break;case"FeedItemColumn":a.__dualName=a.createChildContext(g.WAFWidgets.DualName,{$replaceElement:a.$(".name-widget-goes-here"),user:a.actorProfile,configuration:"small-single-lightbg",ignoreClicks:a.__ignoreUserClicks});break;case"FeedItemCard":a.__dualName=a.createChildContext(g.WAFWidgets.DualName,{$parentElement:a.$(".name-widget-goes-here"),user:a.actorProfile,configuration:"small-single-darkbg",ignoreClicks:a.__ignoreUserClicks});break;case"FeedItemUserProfile":a.__dualName=a.createChildContext(g.WAFWidgets.DualName,{$replaceElement:a.$(".name-widget-goes-here"),user:a.actorProfile,configuration:"small-single-lightbg",ignoreClicks:a.__ignoreUserClicks})}}])}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],FeedItemTimestamp:La,IOSRelativeTime:jg,template:ig}),lg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=a.helperMissing;var h='\n<div class="feed-item-container">\n    <div class="dummy"></div>\n    <div class="feed-item-photo">\n        <img class="cover-image"/>\n    </div>\n    <div class="big-liking-animation">',f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-like-on",{name:"icon",hash:{class:"color-red"},data:e}));if(f||0===f)h+=f;h+="</div>\n</div>\n<div class='photo-with secondary-text is-truncated'><span>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"with",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+" </span><span class='username-placeholder'> </span><span class='with-others'></span></div>\n<div class=\"caption hidden\" />\n"},3:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='\n<div class="feed-item-container">\n    <div class="dummy"></div>\n    <div class="feed-item-text" ',k=a["if"].call(b,b&&b.background_color,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+=">\n        <div class='message'></div>\n        <div class=\"more-indicator\">"+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"See more",{name:"i18n-g",hash:{},data:e})))+'</div>\n    </div>\n    <div class="big-liking-animation">';if((k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-like-on",{name:"icon",hash:{class:"color-red"},data:e})))||0===k)f+=k;return f+"</div>\n</div>\n"},4:function(b,a,c,e){var d;c=this.escapeExpression;return'style="background-color: #'+c((d=a.background_color||b&&b.background_color,"function"===typeof d?d.call(b,{name:"background_color",hash:{},data:e}):d))+'"'},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='<header class="feed-item-header-placeholder"></header>\n',k=a["if"].call(b,b&&b.is_photo,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(k||0===k)f+=k;f+='\n<footer class="feed-item-footer feed-item-runner">\n    <ul class="action-bar-placeholder"></ul>\n    <ul class="extension-bar bar">\n        <li class="extension-bar-column count-comments-container">\n            <span class="extension-bar-column-info count-comments">\n                ';if((k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-comment_filled",{name:"icon",hash:{class:"extension-bar-icon"},data:e})))||0===k)f+=k;f+='\n                <span class="count-comments-text"></span>\n            </span>\n            <span class="comments-labels">\n                <span class="comments-text-singular">'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Comment",{name:"i18n-g",hash:{},data:e})))+'</span>\n                <span class="comments-text-plural">'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Comments",{name:"i18n-g",hash:{},data:e})))+'</span>\n            </span>\n        </li>\n        <li class="extension-bar-column count-likes-container">\n            <span class="extension-bar-column-info count-likes">\n                ';if((k=(d=a.icon||b&&b.icon||c,d.call(b,"icon-like-on",{name:"icon",hash:{class:"extension-bar-icon"},data:e})))||0===k)f+=k;return f+'\n                <span class="count-likes-text"></span>\n            </span>\n            <span class="likes-labels">\n                <span class="likes-text-singular">'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Like",{name:"i18n-g",hash:{},data:e})))+'</span>\n                <span class="likes-text-plural">'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Likes",{name:"i18n-g",hash:{},data:e})))+"</span>\n            </span>\n        </li>\n    </ul>\n</footer>\n"},useData:!0})}({}),ab=function(g){var b=g.UiCore.UiContext;return b.extend("FeedItem",{uiContextName:"feed_list_item",tagName:"article",className:"feed-item",dependencies:"contextMenuManager dialogManager featureAccessManager globalStartupModel globalStringManager googleAnalytics imageManager loginManager modeManager platform restModelFactory timer window".split(" "),trackedEvents:function(){return[g.NextUtil.DomHelper.trackClickOrDouble({selector:".feed-item-container",clickName:"feed_item_click",doubleclickName:"feed_item_like",clickHandler:this.__triggerDetails.bind(this,!1),doubleclickHandler:this.__like}),{type:"click",selector:".count-comments, .comments-text-singular, .comments-text-plural",name:"feed_item_click",handler:this.__triggerDetails.bind(this,!1)},{type:"click",selector:".count-likes, .likes-text-singular, .likes-text-plural",name:"show_like_list",handler:this.__showLikeList}]},setViewType:function(a){this.__viewType=a},initialize:function(a){this.__featureAccessManager=a.featureAccessManager;this.uiAttributes={repeats:1};b.prototype.initialize.call(this,a);this.__imageManager=a.imageManager;this.__loginManager=a.loginManager;this.__modeManager=a.modeManager;this.__googleAnalytics=a.googleAnalytics;this.__dialogManager=a.dialogManager;this.__ignoreUserClicks=!!a.ignoreUserClicks;this.__feedType=a.feedType;this.__platform=a.platform;this.__timer=a.timer;this.__reportUrl=this.__globalStartupModel.get("safetyReportUrl");this.__showHeader=IMVU.optionalProperty(a,"showHeader",!0);this.__forceShowCaption=IMVU.optionalProperty(a,"forceShowCaption",!1);this.__isReportable=IMVU.optionalProperty(a,"isReportable",!1);this.setViewType(a.viewType);this.addToDOM();this.listenTo(this.model,"change",this.__onModelChange.bind(this))},delete:function(){b.prototype.delete.call(this);this.__timer.clearTimeout(this.__likeTimer)},setUseCase:function(a){void 0!==this.feedItemHeader&&(this.$(".caption")[0]&&this.$(".caption").addClass("hidden"),this.feedItemHeader.setUseCase(a),this.$(".caption")[0]&&this.$(".caption").toggleClass("hidden",!this.feedItemHeader.shouldShowCaption()))},render:function(){var a=this;this.$el.addClass("sorting");this.doWork([function(){return a.model.populated()},function(){a.$el.removeClass("sorting");var c=a.model.node,e=c.get("payload.message")||"",d="photo"===c.get("type"),h={id:c.id,img_src:c.get("payload.thumbnail_url"),is_photo:d,background_color:c.get("payload.background_color"),time:a.__serviceProvider.get("timestampHelper").formatSingleUnit(c.get("time"))};a.$el.html(g.template(h));a.$el.attr("data-item",h.id);a.__showHeader&&(a.feedItemHeader=a.createChildContext(g.FeedItemHeader,{model:a.model.node,$replaceElement:a.$(".feed-item-header-placeholder"),ignoreUserClicks:a.__ignoreUserClicks,feedType:a.__feedType,viewType:a.__viewType,isList:a.__isList}));a.__actor=c.getSingleEdge("actor");"grid"!==a.__viewType&&c.relations.photo&&a.doWork([function(){return c.getSingleEdge("photo").populated()},function(k){if(k.relations.location){var m=a.track(a.__restModelFactory.readModel(k.relations.location,g.UiCore.NodeModel));a.doWork([function(){return m.populated()},function(n){var q=n.attributes.is_ap;"public"!==n.attributes.privacy||q||a.createChildContext(g.PhotoRoomUsers,{model:a.model,$replaceElement:a.$(".photo-with"),feedType:a.__feedType,actor:a.__actor,roomModel:m})}])}}]);var f=a.createChildContext(g.FeedActionBar,{model:a.model.node,$replaceElement:a.$(".action-bar-placeholder"),feedType:a.__feedType,imageManager:a.__imageManager,isReportable:a.__isReportable});f.on("action-tags",a.__showProducts.bind(a));f.on("action-tag-count",a.__showProducts.bind(a));f.on("action-comments",a.__triggerDetails.bind(a,!0));f.on("action-comment-count",a.__triggerDetails.bind(a,!0));f.on("action-like-count",a.__showLikeList.bind(a));f.on("item-reported",a.__onItemReported.bind(a));f.on("like",a.__bigLikingAnimation.bind(a));d||(a.__userText=a.createChildContext(g.UserText,{$parentElement:a.$(".feed-item-text .message"),text:e}),a.__setAsRendered());h.is_photo&&(d=a.$(".feed-item-photo > img"),a.__imageManager.load(d,h.img_src,{}).then(function(){this.__setAsRendered()}.bind(a)).catch(function(k){this.__window.console.error(k);this.__setAsRendered()}.bind(a)),a.__caption=a.createChildContext(g.ExpandingText,{$parentElement:a.$(".caption"),textValue:e}),a.listenTo(a.__caption,"helip",a.__toggleCaption.bind(a)),a.feedItemHeader&&(a.feedItemHeader.setUseCase(),a.$(".caption").toggleClass("hidden",!a.feedItemHeader.shouldShowCaption())),a.__forceShowCaption&&a.$(".caption").toggleClass("hidden",!1));a.__onModelChange()}])},__onItemReported:function(){this.$el.hide()},__onModelChange:function(){var a=this;this.doWork([function(){a.commentsSummary&&a.commentsSummary.off(void 0,void 0,a);a.commentsSummary=a.model.node.getSummaryCollection("comments");a.listenTo(a.commentsSummary,"update add remove reset",a.__onCommentsCollectionChange.bind(a));a.__onCommentsCollectionChange();a.likedby&&a.likedby.off(void 0,void 0,a);a.likedby=a.model.node.searchEdgeCollection("liked_by_profile",{limit:0},g.UiCore.EdgeCollection);a.listenTo(a.likedby,"update add remove reset",a.__onLikeCollectionChange.bind(a));a.__onLikeCollectionChange();a.__caption&&"photo"===a.model.node.get("type")&&(a.__caption.changeText(a.model.node.get("payload.message")),a.model.node.get("payload.message")&&""!==a.model.node.get("payload.message")?a.$(".caption").addClass("has-caption"):a.$(".caption").removeClass("has-caption"));""===a.$(".username-placeholder").text().trim()&&a.$(".photo-with").hide()}])},__refreshExtensionBar:function(){var a=!!(this.likedby&&0+this.likedby.total_count),c=!!(this.commentsSummary&&0+this.commentsSummary.total_count);1==this.commentsSummary.total_count?(this.$(".comments-text-singular").show(),this.$(".comments-text-plural").hide()):(this.$(".comments-text-singular").hide(),this.$(".comments-text-plural").show());a?1==0+this.likedby.total_count?(this.$(".likes-text-singular").show(),this.$(".likes-text-plural").hide()):(this.$(".likes-text-singular").hide(),this.$(".likes-text-plural").show()):this.$(".likes-text-singular").hide();this.$(".extension-bar").toggleClass("has-likes-or-comments",a||c)},__onCommentsCollectionChange:function(){var a=this;this.doWork([function(){a.$(".count-comments-text").text(g.FormatNumber.formatMini(a.commentsSummary.total_count));a.__refreshExtensionBar()}])},__onLikeCollectionChange:function(){var a=this;this.doWork([function(){a.$(".count-likes-text").text(g.FormatNumber.formatMini(a.likedby.total_count));a.likedby.populated().then(a.__refreshExtensionBar.bind(a))}])},__showLightbox:function(a){this.__dialogManager.showLightbox("FeedLightbox",_.extend({model:this.model.node,feedType:this.__feedType},a||{}))},__triggerDetails:function(a){this.__showLightbox({focusComments:!!a})},__showProducts:function(){this.__showLightbox({tab:"tags"})},__showLikeList:function(){this.__showLightbox({tab:"likes"})},__bigLikingAnimation:function(){this.__timer.clearTimeout(this.__likeTimer);this.__likeTimer=g.NextUtil.DomHelper.applyTemporaryClass(this.__timer,this.$(".feed-item-container"),"liking",1e3)},__like:function(){this.model.node.like();this.__bigLikingAnimation()},__toggleCaption:function(){this.$(".caption").toggleClass("open")}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],ContextMenu:t,ExpandingText:Ka,FeedActionBar:$a,FeedItemHeader:kg,FormatNumber:r,PhotoRoomUsers:Ja,UserText:M,template:lg}),mg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c="<img src='/common/withme/img/post.png'/>\n<button class=\"btn btn-ghost btn-dark btn-small\">";if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Post Now",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</button>"},useData:!0})}({}),ng=function(g){var b=g.UiCore.UiContext;return b.extend("ProfileFeedPostNow",{className:"profile-feed-post-now",uiContextName:"profile_feed_post_now",dependencies:["dialogManager","globalStringManager","modeManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"post_now",handler:"__openPhotoBooth"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__dressUpAvatarManager=a.dressUpAvatarManager||a.serviceProvider.create(g.DressUpAvatarManager,{persistLooks:!1});this.addToDOM()},render:function(){this.$el.html(g.template({}))},__openPhotoBooth:function(){this.__dressUpAvatarManager.populated().then(function(){this.__dressUpAvatarManager.containsAPProduct()?this.__dialogManager.alert({title:this.__globalStringManager.get("dialog_photobooth_ap_error_title"),text:this.__globalStringManager.get("dialog_photobooth_ap_error_text"),ok:this.__globalStringManager.get("dialog_photobooth_ap_error_button")}):this.__dialogManager.showDialog(g.PhotoBoothDialog)}.bind(this))}})}({UiCore:l["@UiCore"],DressUpAvatarManager:x,PhotoBoothDialog:Za,template:mg}),og=function(g){var b=g.WithmeWidgets.AdsListPresenter;return b.extend("Feed",{uiContextName:"feed_list",className:"feed",tagName:"section",dependencies:["globalStringManager","localStorage"],triggerNextPage:3,initialize:function(a){a.serviceProvider.get("Promise");this.__initialRenderComplete=!1;this.__localStorage=a.localStorage;this.itemFactory=a.itemFactory||g.FeedItem;a.firstAdPositionInColumnView=a.globalStartupModel.get("firstAdPositionFeed")||4;a.showAdEveryNItemsInColumnView=a.globalStartupModel.get("showAdEveryNColumns")||4;a.firstAdAfterNRow=3;a.showAdAfterEveryNRowsInGridView=3;b.prototype.initialize.call(this,a)},onAdd:function(a){var c=this;b.prototype.onAdd.apply(this,arguments);this.__setUseCase();if(!this.__initialRenderComplete&&this.getItems&&this.getItems().length===this.collection.length){var e=this.getItems();0<e.length&&"undefined"!==typeof e[0].getHasRenderedPromise&&e.forEach(function(d){"undefined"!==typeof d.getHasRenderedPromise&&c.__addRenderGatingPromise(d.getHasRenderedPromise())});this.__waitOnRenderGatingPromises();this.getHasRenderedPromise().then(function(){c.__initialRenderComplete=!0})}},refresh:function(){var a=this;this.doWork([function(){a.collection.invalidate();a.collection.reset()}])},onReset:function(a,c){var e=this;this.doWork([function(){var d=e.collection.length;0===d&&(b.prototype.onReset.call(e,a,c),e.__onScroll());var h=function(){d--;0===d&&(b.prototype.onReset.call(this,a,c),this.__onScroll())}.bind(e);_.each(e.collection.models,function(f){f.populated().then(h,h)})}])},onInitError:function(){b.prototype.onInitError.call(this);this.trigger("initError")},onPageError:function(a){window.console.log("Feed Error:",a);b.prototype.onPageError.call(this,a);this.trigger("pageError")},__onPaged:function(){this.__viewType=this.__localStorage.getItem("next.feed_filters.view");b.prototype.__onPaged.call(this)},__setUseCase:function(a){a=a||this.__viewType;void 0!==a&&_.each(this.__childContexts,function(c){switch(a){case"grid":c.setUseCase("FeedToggleToGrid");this.el.classList.remove("column");this.el.classList.add("grid");break;case"column":c.setUseCase("FeedToggleToColumn"),this.el.classList.remove("grid"),this.el.classList.add("column")}}.bind(this))},refreshSize:function(a){this.__maybePage();this.__setUseCase(a);a&&this.__rearrangeAdSlots(a)},__emptyText:function(){return{standard:this.__globalStringManager.get("No posts"),concise:this.__globalStringManager.get("No posts")}}})}({UiCore:l["@UiCore"],WithmeWidgets:l["@WithmeWidgets"],FeedItem:ab}),pg=function(g){var b=g.Feed;return b.extend("ProfileFeedListPresenter",{uiContextName:"profile_feed_list_presenter",className:"profile-feed",initialize:function(a){this.__isMyself=IMVU.optionalProperty(a,"isMyself",!1);b.prototype.initialize.call(this,a)},__updateEmpty:function(){this.__isMyself?0!==this.collection.models.length||this.__$empty?this.collection.models.length&&this.__$empty&&(this.__$empty.remove(),this.__$empty=null):(this.__postNow=this.createChildContext(g.ProfileFeedPostNow,{$parentElement:this.$el,dressUpAvatarManager:this.__dressUpAvatarManager}),this.__$empty=this.__postNow.$el):b.prototype.__updateEmpty.call(this)}})}({UiCore:l["@UiCore"],Feed:og,ProfileFeedPostNow:ng}),qg=function(g){var b=g.UiCore.UiContext;return b.extend("ProfilePosts",{className:"profile-posts",uiContextName:"profile_posts",dependencies:["loginManager","user"],trackedEvents:function(){return[]},initialize:function(a){b.prototype.initialize.call(this,a);this.__isReportable=!0;this.__feedItemFactory=a.feedItemFactory||g.FeedItem;if(this.__isLoggedIn=!!this.__loginManager.isLoggedIn())this.__isMyself=!1,this.__isLoggedIn&&(this.__myself=this.__loginManager.getCurrentUser(),this.__user.id===this.__myself.id&&(this.__isMyself=!0)),this.__scroller=a.scroller,this.addToDOM()},render:function(){var a=this;this.doWork([function(){a.$el.html(g.template({}));a.__scroller||(a.__scroller=a.$(".profile-posts-container"));a.__initializeFeed()}])},__initializeFeed:function(){this.__feedInitialized||(this.$el.addClass("loading-feed"),this.$(".profile-posts-container").on("scroll.initializeFeed",this.__maybeShowFeed.bind(this)),this.__maybeShowFeed(),this.__feedInitialized=!0)},__showFeed:function(){var a=this;this.__addRenderGatingPromise(this.__user.getSingleEdge("personal_feed").populated());this.doWork([function(){return a.__user.getSingleEdge("personal_feed").populated()},function(c){a.$el.removeClass("loading-feed");a.__feed=a.createChildContext(g.Feed,{$parentElement:a.$(".profile-posts-container"),collection:a.track(c.getEdgeCollection("elements",g.Model.FeedCollection)),scroller:a.__scroller,itemFactory:a.__feedItemFactory,ignoreUserClicks:!0,feedType:"user_profile_card",userProfileCard:!0,showAds:!1,showHeader:!0,isMyself:a.__isMyself,isReportable:a.__isReportable});a.__feed.getHasRenderedPromise().then(function(){a.__setAsRendered()})}])},__maybeShowFeed:function(){if(0<this.$(".profile-posts-container").children().length){var a=this.$(".profile-posts-container").children().last(),c=this.$el.offset().top+this.$el.height();a.offset().top+a.height()<=c&&(this.$(".profile-posts-container").off("scroll.initializeFeed"),this.__showFeed())}else this.__showFeed()}})}({Model:l["@Model"],UiCore:l["@UiCore"],Feed:pg,FeedItem:ab,template:hg}),rg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=a.helperMissing;var h="\n    <fieldset class=\"has-textarea-above\">\n        <legend class='system-info-header'>",f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"creator",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='</legend>\n        <div class="edit-profile-attribute background-container show-label">\n            <input id=\'profile-checkbox-show-creator-tier\' type="checkbox" class="toggle-switch" data-pref="avwidget_show_creator_tier" data-pref-default=1>\n            <label id="display-creator-tier-toggle" for=\'profile-checkbox-show-creator-tier\'>\n                <div>\n                    ';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"show creator tier",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"<br>\n                </div>\n            </label>\n        </div>\n    </fieldset>\n    "},3:function(b,a,c,e){return' class="has-textarea-above"'},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f='<div class=\'profile\'>\n    <fieldset>\n        <div class="change-profile background-container">\n            <div class="profile-icon-placeholder"></div>\n            <form class="customProfileImage">\n                <label class="change-profile-image" for="custom-profile-image">',k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"change profile image",{name:"i18n-g",hash:{},data:e}));if(k||0===k)f+=k;f+='</label>\n                <input class="change-profile-image-input" type="file" accept="image/*" name="custom-profile-image" id="custom-profile-image" />\n            </form>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"name",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</legend>\n        <div class=\'edit-profile-attribute displayName\'>\n            <textarea id="display_name" type="text" class="value" placeholder="';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"display name",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset class="has-textarea-above">\n        <legend class=\'system-info-header\'>';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"bio",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</legend>\n        <div class=\'edit-profile-attribute tagline\'>\n            <textarea id="tagline" type="text" class="value" placeholder="';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"profile_bio",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset class="has-textarea-above">\n        <legend class=\'system-info-header\'>';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"interests",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</legend>\n        <div class=\'edit-profile-attribute interests\'>\n            <textarea id="interests" class="value" placeholder="';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"profile_interests",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='"></textarea>\n        </div>\n    </fieldset>\n\n    ';if((k=a["if"].call(b,b&&b.is_creator,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n\n    <fieldset ";if((k=a.unless.call(b,b&&b.is_creator,{name:"unless",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===k)f+=k;f+=">\n        <legend class='system-info-header'>";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"show age",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</legend>\n        <div class="edit-profile-attribute background-container show-label">\n            <input id=\'profile-checkbox-show-age\' type="checkbox" class="toggle-switch" data-pref="avwidget_show_age" data-pref-default=1>\n            <label id="display-age-toggle" for=\'profile-checkbox-show-age\'>\n                <div>\n                    ';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"show age",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="\n                </div>\n            </label>\n        </div>\n        <span class='description'>"+h((d=a.age_description||b&&b.age_description,"function"===typeof d?d.call(b,{name:"age_description",hash:{},data:e}):d))+' <a class="help-center" href="'+h((d=a.helpUrl||b&&b.helpUrl,"function"===typeof d?d.call(b,{name:"helpUrl",hash:{},data:e}):d))+'" target="_blank">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"help center",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=".</a></span>\n    </fieldset>\n\n    <fieldset>\n        <legend class='system-info-header'>";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"gender",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</legend>\n        <div class='edit-profile-attribute gender show-label background-container'>\n            <input id='profile-checkbox-show-gender' type=\"checkbox\" class=\"toggle-switch\" data-pref=\"avwidget_show_gender\" data-pref-default=1><label for='profile-checkbox-show-gender'>";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"show gender",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</label>\n        </div>\n        <div class="separator"></div>\n        <div class=\'edit-profile-attribute gender\'>\n            <select id="gender" class="value"></select>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"location",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</legend>\n        <div class='edit-profile-attribute geo-location show-label background-container'>\n            <input id='profile-checkbox-show-geo-location' type=\"checkbox\" class=\"toggle-switch\" data-pref=\"avwidget_show_geo_location\" data-pref-default=1><label for='profile-checkbox-show-geo-location'>";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"show location",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='</label>\n        </div>\n        <div class="separator"></div>\n        <div class=\'edit-profile-attribute location background-container\' id="location"></div>\n        <div class=\'location-container hidden\'>\n            <div class=\'edit-profile-attribute country\'>\n                <select id="country" class="value"></select>\n            </div>\n             <div class="separator"></div>\n            <div class=\'edit-profile-attribute state not-applicable\'>\n                <select id="state" class="value"></select>\n            </div>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"affinity",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+="</legend>\n        <div class='edit-profile-attribute relationship_status affinity'>\n            <span class=\"descriptor\">";if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"relationship",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=':</span>\n            <select id="relationship_status" class="value"></select>\n        </div>\n        <div class="separator"></div>\n        <div class=\'edit-profile-attribute looking_for affinity\'>\n            <span class="descriptor">';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"here for",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+=':</span>\n            <select id="looking_for" class="value"></select>\n        </div>\n    </fieldset>\n\n</div>\n<option class="dropdown-item hidden"></option>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary btn-dark submit">\n        ';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Save",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;return f+"\n    </button>\n<\/script>"},useData:!0})}({}),sg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<a class="header-button save-profile">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Save",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</a>"},useData:!0})}({}),tg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<footer class="dialog-footer">\n    <a href="javascript:;" class="post footer-post-btn btn btn-primary"></a>\n</footer>'},useData:!0})}({}),ug=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="back-button"></div>'},useData:!0})}({}),vg=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("EditProfileImageDialog",{uiContextName:"edit_profile_image_dialog",className:"edit-profile-image-dialog dialog-type-B can-dismiss",dependencies:["dialogManager","globalStringManager","modeManager","timer"],trackedEvents:function(){return[{type:"click",selector:".post",name:"post",handler:this.__post},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__stringManager=a.globalStringManager;this.title=this.__stringManager.get("dialog_edit_profile_image_title");this.__file=IMVU.requireProperty(a,"file",null);this.__modeManager=a.modeManager;_.has(this.__serviceProvider.services,"editProfileImage")||_.has(a,"editProfileImage")?(this.__editProfileImage=a.editProfileImage||this.__serviceProvider.get("editProfileImage"),this.addToDOM()):module.run({EditProfile:"@EditProfileImage"},this.__completeInit.bind(this))},__completeInit:function(a,c){this.__editProfileImage=this.__modeManager.createChildContext(a.EditProfile,{$parentElement:this.__modeManager.$el});this.__serviceProvider.register("editProfileImage",this.__editProfileImage);this.addToDOM()},postRender:function(){this.setContent("body",g.template);"mobile"===this.serviceProvider.get("platform")&&(this.$(".dialog-header").prepend(g.backButtonTemplate({})),this.$(".dialog-x").remove());this.$post=this.$(".footer-post-btn").text(this.__stringManager.get("dialog_profile_image_edit_post"));this.__editProfileImage.attach(this.$(".dialog-body"));this.__editProfileImage.restoreScrollValues();this.__editProfileImage.on("exit",this.hide,this);this.__editProfileImage.on("uploadError",this.__uploadError,this);this.__editProfileImage.on("canPost",this.setPostStatus,this);this.__editProfileImage.changeCustomProfile(this.__file)},__uploadError:function(){this.__timer.setTimeout(function(){this.promiseResolver.resolve(!0);this.__dialogManager.alert({title:this.__stringManager.get("dialog_edit_profile_invalid_image_title"),text:this.__stringManager.get("dialog_edit_profile_invalid_image_text")})}.bind(this),0)},setPostStatus:function(a){this.$post.toggleClass("disabled",!a)},__post:function(){this.__editProfileImage.post()},delete:function(){this.__editProfileImage.reset();this.__editProfileImage.saveScrollValues();this.__editProfileImage.detach();this.__editProfileImage.off(null,null,this);b.prototype.delete.call(this)},__goBack:function(){this.promiseResolver.resolve(!0)}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],backButtonTemplate:ug,template:tg}),wg=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("EditProfileDialog",{uiContextName:"edit_profile_dialog",className:"edit-profile-dialog dialog-type-B",dependencies:"dialogManager featureAccessManager globalStringManager loginManager platform prefsManager Promise urlManager".split(" "),trackedEvents:function(){return[{type:"change",selector:".change-profile-image-input",name:"change_profile_image",handler:this.__changeProfileImage},{type:"click",selector:"button.submit",name:"submit",handler:this.__submitChanges},{type:"click",selector:"button.cancel",name:"cancel",handler:this.__cancel},{type:"change",selector:"#country",name:"country",handler:this.__handleCountryChange},{type:"change",selector:"#state",name:"state",handler:this.__handleFieldChange},{type:"click",selector:"#location",name:"location",handler:this.__showLocationDropdown},{type:"change",selector:"#gender",name:"gender",handler:this.__handleFieldChange},{type:"change",selector:"#looking_for",name:"looking_for",handler:this.__handleFieldChange},{type:"change",selector:"#relationship_status",name:"relationship_status",handler:this.__handleFieldChange},{type:"input",selector:"#display_name",name:"display_name",handler:this.__handleFieldChange,repeats:1},{type:"input",selector:"#interests",name:"interests",handler:this.__handleFieldChange,repeats:1},{type:"input",selector:"#tagline",name:"tagline",handler:this.__handleFieldChange,repeats:1},{type:"change",selector:"input[data-pref]",name:"preference",handler:this.__handleFieldChange,attributes:function(a){return{pref:a.data("pref")}}}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__stringManager=a.globalStringManager;this.__myself=a.loginManager.getCurrentUser();this.__curtainDelay=a.curtainDelay||700;this.__initialUserData={};this.__initialUserPrefs={};this.title=this.__stringManager.get("dialog_edit_profile_title");this.userFieldsToPopulate="country state gender looking_for relationship_status tagline".split(" ");this.addToDOM()},postRender:function(){this.setContent("body",g.template({age_description:this.__globalStringManager.get("age_description",{age:this.__myself.get("age")}),is_creator:this.__myself.get("is_creator"),helpUrl:this.__urlManager.get("imvu_help")}));this.$(".profile").scrollbar();this.__setupDropDowns();g.NextUtil.DomHelper.enhanceTextarea(this.$("#tagline"),100,90);g.NextUtil.DomHelper.enhanceTextarea(this.$("#interests"),255,90);g.NextUtil.DomHelper.enhanceTextarea(this.$("#display_name"),30,40);this.setContent("footer",this.$(".dialog-footer-template").text());this.__uploadCurtain=this.createChildContext(g.UploadCurtain,{$parentElement:this.$el,completeDelay:this.__curtainDelay});this.__postRenderCompletePart1Resolver=null;this.__postRenderCompletePart1Promise=new this.__Promise(function(a){this.__postRenderCompletePart1Resolver=a}.bind(this));this.__postRenderCompletePart2Resolver=null;this.__postRenderCompletePart2Promise=new this.__Promise(function(a){this.__postRenderCompletePart2Resolver=a}.bind(this));this.__myself.populated().then(function(){this.__profileIcon=this.createChildContext(g.WAFWidgets.ProfileIcon,{$replaceElement:this.$(".profile-icon-placeholder"),user:this.__myself});this.__myself.get("is_adult")||this.$("#display-age-toggle").closest("fieldset").remove();this.$(".age").text(this.__myself.get("age"));this.__populateUserFields();this.__handleCountryChange();this.__toggleHasChanges(!1);this.__postRenderCompletePart1Resolver.resolve()}.bind(this));this.__prefsManager.populated().then(function(){this.__populatePrefs();this.__toggleHasChanges(!1);this.__postRenderCompletePart2Resolver.resolve()}.bind(this));this.__Promise.every([this.__postRenderCompletePart1Promise,this.__postRenderCompletePart2Promise]).then(function(){}.bind(this))},__populatePrefs:function(){this.$("input[data-pref]").each(function(a,c){a=$(c);c=a.attr("data-pref");var e=this.__prefsManager.getBool(c,!!a.attr("data-pref-default"));a.attr("data-pref-invert")&&(e=!e);a.prop("checked",e);this.__initialUserPrefs[c]=e}.bind(this))},__populateUserFields:function(){_.each(this.userFieldsToPopulate,function(a){var c=this.__myself.get(a);""!==c&&(this.$("select#"+a).val(c).trigger("change"),this.__initialUserData[a]=c)}.bind(this));this.__initialUserData.username=this.__myself.get("username");this.__initialUserData.country=this.__myself.get("country");this.__initialUserData.state=this.__myself.get("state");this.$("#username").text(this.__initialUserData.username.replace("Guest_","")).trigger("input");this.$("#location").text(this.__initialUserData.country+(this.__initialUserData.state?" - "+this.__initialUserData.state:""));_.each(["display_name","interests","tagline"],function(a){""!==this.__myself.get(a)?(this.__initialUserData[a]=this.__myself.get(a),this.$("#"+a).val(this.__initialUserData[a]).trigger("input")):this.__initialUserData[a]=""}.bind(this))},__setupDropDowns:function(){_.each(this.userFieldsToPopulate,function(a){var c=this.$("select#"+a);c.length&&(_.each(g.profileJSON[a],function(e,d){var h=this.$(".dropdown-item").clone().removeClass("hidden dropdown-item");c.append(h.attr("value",d).text(this.__globalStringManager.getWithDefault(e,e||"")))}.bind(this)),this.createChildContext(g.Dropdown,{$replaceElement:c,dismissOnScroll:this.$(".profile"),lightText:!0,hideArrow:!0}))}.bind(this))},__getFormValues:function(){var a={gender:this.$("#gender").val(),country:this.$("#country").val(),relationship_status:this.$("#relationship_status").val(),looking_for:this.$("#looking_for").val(),interests:this.$("#interests").val(),tagline:this.$("#tagline").val(),display_name:this.$("#display_name").val()};this.__countryIsUSA()&&(a.state=this.$("#state").val());return a},__getFormPrefs:function(){var a=[];document.querySelectorAll("input[data-pref]").forEach(function(c){var e=c.getAttribute("data-pref");c=c.getAttribute("data-pref-invert")?!c.checked:c.checked;a[e]=c});return a},__getChanges:function(a,c){var e={};Object.keys(c).forEach(function(d){var h=c[d]||"",f=a[d]||"";typeof f!==typeof h&&(f=f.toString(),h=h.toString());h!==f&&(e[d]=h)});return e},__changeProfileImage:function(a){this.__dialogManager.showDialog(g.EditProfileImageDialog,{file:a.target.files[0]});this.$(".customProfileImage")[0].reset()},__collectChanges:function(){var a=this,c=[],e=this.__getChanges(this.__initialUserData,this.__getFormValues());0!==Object.keys(e).length&&(c=[this.__myself.save(e,{error:this.__myself.invalidate.bind(this.__myself)})]);var d=this.__getChanges(this.__initialUserPrefs,this.__getFormPrefs());0!==Object.keys(d).length&&Object.keys(d).forEach(function(h){c.push(a.__prefsManager.setBool(h,d[h]))});return c},__submitChanges:function(){var a=this;this.__removeMultipleConsecutiveSpaces(this.$("#display_name"));this.__uploadCurtain.show();var c=this.__collectChanges();0<c.length&&this.__Promise.every(c).then(function(){a.__toggleHasChanges(!1);a.__uploadCurtain.complete();a.__myself.get("is_creator")&&a.__myself.getSingleEdge("creator_details").invalidate();a.__myself.invalidate()}).catch(function(e){var d=a.__stringManager.get("dialog_generic_save_error_text"),h={minimum:"1",maximum:"30"},f="msg_blank msg_display_name_not_string msg_display_name_length msg_display_name_inappropriate msg_display_name_registered msg_display_name_wrapping_spaces msg_display_name_at_sign msg_display_name_persona msg_display_name_multiple_spaces".split(" ");e.message&&-1<f.indexOf(e.message)&&(d=a.__stringManager.get("edit_profile_error_"+e.message,h));a.__uploadCurtain.hide();a.__dialogManager.alert({title:a.__stringManager.get("dialog_generic_save_error_title"),text:d,ok:a.__stringManager.get("dialog_generic_save_error_ok")})});this.close()},__toggleHasChanges:function(a){this.$("button.submit").prop("disabled",!a)},__handleFieldChange:function(){""!==this.$("#display_name").val()?this.__toggleHasChanges(!0):this.$("button.submit").prop("disabled",!0)},__removeMultipleConsecutiveSpaces:function(a){a.val(a.val().replace(/\s\s+/g," "))},__cancel:function(){this.close();this.promiseResolver.reject()},__countryIsUSA:function(){return"US"===this.$("#country").val()},__handleCountryChange:function(){this.$(".edit-profile-attribute.state").toggleClass("not-applicable",!this.__countryIsUSA());this.__handleFieldChange()},__showLocationDropdown:function(){this.$("#location").toggleClass("hidden",!0);this.$(".location-container").toggleClass("hidden",!1)}})}({Dialogs:l["@Dialogs"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],Dropdown:G,EditProfileImageDialog:vg,profileJSON:l["json!/common/pure/util/profile.json"],UploadCurtain:Xa,SaveButtonTemplate:sg,template:rg}),xg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<a class="header-button edit-profile">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"Edit",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</a>"},useData:!0})}({}),yg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d;c=a.helperMissing;var h='\n    <li class="action-more-container">\n        <button class="btn action-more">\n            ',f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-action_more_new",{name:"icon",hash:{},data:e}));if(f||0===f)h+=f;h+='\n        </button>\n    </li>\n    <li class="action-gift-container">\n        <button class="btn action-gift">\n            ';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-gift_new",{name:"icon",hash:{},data:e})))||0===f)h+=f;h+='\n        </button>\n    </li>\n    <li class="action-message-container">\n        <button class="btn action-message">\n            ';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-action_message",{name:"icon",hash:{},data:e})))||0===f)h+=f;return h+"\n        </button>\n    </li>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c='<div class="actions-container bar">\n    ';if((b=a["if"].call(b,b&&b.notMyProfile,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)c+=b;return c+'\n    <li class="action-share-container">\n    </li>\n</div>\n<div class="follow-container"></div>'},useData:!0})}({}),zg=function(g){var b=g.Dialogs.AlloyConfirmDialog;return b.extend("ReportUserDialog",{uiContextName:"report_user_dialog",className:"report-user-dialog",dependencies:["dialogManager","globalStartupModel","globalStringManager","loginManager","restModelFactory"],initialize:function(a){this.__model=a.model;this.__dialogManager=a.dialogManager;this.__restModelFactory=a.restModelFactory;this.__startupModel=a.globalStartupModel;this.__stringManager=a.globalStringManager;a=_.extend({title:this.__stringManager.get("unblock_person_title"),html:this.__stringManager.get("unblock_person_html",{displayname:this.__model.get("display_name"),username:this.__model.get("username").replace(/^guest_/i,"")}),yes:this.__stringManager.get("unblock_person_unblock"),no:this.__stringManager.get("unblock_person_cancel")},a);b.prototype.initialize.call(this,a);this.__myself=this.track(a.loginManager.getCurrentUser());this.__blockedUsers=this.track(this.__myself.getEdgeCollection("blocked",g.UiCore.EdgeCollectionModel))},__onConfirm:function(){this.__blockedUsers.populated().then(function(){this.__blockedUserModel=this.__blockedUsers.find(function(a){return this.__model.id===a.node.id}.bind(this));return this.__blockedUserModel.edge.destroy()}.bind(this)).then(this.__confirmDialog.bind(this)).then(function(){this.promiseResolver.resolve();this.hide()}.bind(this)).catch(function(a){this.__errorDialog(a).then(function(){this.promiseResolver.resolve();this.hide()}.bind(this))}.bind(this))},__confirmDialog:function(){return this.__dialogManager.showDialog(g.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("unblock_person_confirm_title"),text:this.__stringManager.get("unblock_person_confirm_text",{displayname:this.__model.get("display_name"),username:this.__model.get("username").replace(/^guest_/i,"")}),ok:this.__stringManager.get("unblock_person_confirm_done")}).finished},__errorDialog:function(a){return this.__dialogManager.showDialog(g.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("unblock_person_error_title"),text:this.__stringManager.get("unblock_person_error_text"),ok:this.__stringManager.get("unblock_person_error_done")}).finished}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"]}),Ag=function(g){var b=g.Dialogs.AlloyConfirmDialog;return b.extend("ReportUserDialog",{uiContextName:"report_user_dialog",className:"report-user-dialog",dependencies:["dialogManager","globalStartupModel","globalStringManager","loginManager","restModelFactory"],initialize:function(a){this.__model=a.model;this.__dialogManager=a.dialogManager;this.__restModelFactory=a.restModelFactory;this.__startupModel=a.globalStartupModel;this.__stringManager=a.globalStringManager;a=_.extend({title:this.__stringManager.get("block_person_title"),html:this.__stringManager.get("block_person_html",{displayname:this.__model.get("display_name"),username:this.__model.get("username").replace(/^guest_/i,"")}),yes:this.__stringManager.get("block_person_block"),no:this.__stringManager.get("block_person_cancel")},a);b.prototype.initialize.call(this,a);this.__myself=this.track(a.loginManager.getCurrentUser());this.__blockedUsers=this.track(this.__myself.getEdgeCollection("blocked",g.UiCore.EdgeCollectionModel))},__onConfirm:function(){this.__blockedUsers.populated().then(function(){return this.__blockedUsers.create({id:this.__model.id})}.bind(this)).then(this.__confirmDialog.bind(this)).then(function(){this.promiseResolver.resolve();this.hide()}.bind(this)).catch(function(a){this.__errorDialog(a).then(function(){this.promiseResolver.resolve();this.hide()}.bind(this))}.bind(this))},__confirmDialog:function(){return this.__dialogManager.showDialog(g.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("block_person_confirm_title"),text:this.__stringManager.get("block_person_confirm_text",{displayname:this.__model.get("display_name"),username:this.__model.get("username").replace(/^guest_/i,"")}),ok:this.__stringManager.get("block_person_confirm_done")}).finished},__errorDialog:function(a){return this.__dialogManager.showDialog(g.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("block_person_error_title"),text:this.__stringManager.get("block_person_error_text"),ok:this.__stringManager.get("block_person_error_done")}).finished}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"]}),Bg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression;return'<p class="section-title">'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"WISHLIST",{name:"i18n-g",hash:{},data:e})))+'</p>\n<div class="id-searchbox"></div>\n<div class="wish-list-container-container">\n    <div class="wish-list-container is-list"></div>\n</div>'},useData:!0})}({}),Cg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression;return'<div class="id-go-to-shop btn-primary">'+h((d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"GO TO SHOP",{name:"i18n-g",hash:{},data:e})))+"</div>"},useData:!0})}({}),Dg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=this.escapeExpression;c=a.helperMissing;h='<form class="search">\n    <input type="text" placeholder="'+h((d=a.placeholder||b&&b.placeholder,"function"===typeof d?d.call(b,{name:"placeholder",hash:{},data:e}):d))+'">\n    <button class="btn btn-small" type="reset">';var f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-close",{name:"icon",hash:{class:"wh-15"},data:e}));if(f||0===f)h+=f;h+='</button>\n    <button class="btn btn-small" type="submit">';if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-search",{name:"icon",hash:{class:"wh-15"},data:e})))||0===f)h+=f;return h+"</button>\n</form>"},useData:!0})}({}),Eg=function(g){var b=g.UiCore.UiContext;return b.extend("SearchWidget",{uiContextName:"search_widget",className:"search-widget",dependencies:["stringManager"],initialize:function(a){this.__filterList=a.filterList;this.__stringManager=a.stringManager;this.__placeholder=this.__stringManager.getWithDefault(a.placeholder,a.placeholder);this.model=a.model||a.serviceProvider.create(g.Model.FilterModel,a.filterList,{});b.prototype.initialize.call(this,a);this.addToDOM();this.setInputToReflectModel();a.showCategoryPlaceholder&&(this.__updateCategoryPlaceholder(),this.listenTo(this.model,"change:category",this.__updateCategoryPlaceholder))},setInputToReflectModel:function(){this.$('input[type="text"]').val(this.model.get("filter_text"))},render:function(){this.$el.html(g.template({placeholder:this.__placeholder}))},__updateCategoryPlaceholder:function(){var a=this.__placeholder;"__default__"===this.model.get("category")&&this.model.set("category","all");"all"!==this.model.get("category")&&-1===this.model.get("category").indexOf("user-")&&(a=this.__stringManager.get("search_box_category",{category:this.__stringManager.get("cat_"+this.model.get("category"))}));this.$('input[type="text"]').attr("placeholder",a)}})}({Model:l["@Model"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:Dg}),bb=function(g){var b=g.SearchWidget;return b.extend("SearchBoxWidget",{uiContextName:"search_box_widget",className:"search-widget search-box-widget",dependencies:["stringManager"],trackedEvents:function(){return[{type:"click",selector:'button[type="submit"]',name:"submit_search",handler:"__onSubmitSearch"},{type:"click",selector:'button[type="reset"]',name:"reset",handler:"resetSearch"},{type:"keyup",selector:'input[type="text"]',name:"submit_search",handler:"__onKeyup",allowBubble:!0}]},setInputToReflectModel:function(){b.prototype.setInputToReflectModel.call(this);this.__updateResettable()},__val:function(){return $.trim(this.$('input[type="text"]').val())},__onSubmitSearch:function(a){a.preventDefault();this.__submit();this.__updateResettable()},__onKeyup:function(a){a.preventDefault();a.keyCode===g.NextUtil.Keys.VK_ENTER&&(this.__recordEvent("click",{name:"submit_search",pressed_enter:1}),this.__submit());this.__updateResettable()},__submit:function(){var a=this.__val();a!==this.model.get("filter_text")&&this.model.set("filter_text",a)},__updateResettable:function(){var a=this.__val();this.$el.toggleClass("resettable",0<a.length&&a===this.model.get("filter_text"))},resetSearch:function(){this.$('input[type="text"]').val("");this.model.set("filter_text","");this.$('input[type="text"]').removeClass("is-filled");this.__updateResettable()}})}({NextUtil:l["@NextUtil"],SearchWidget:Eg}),Fg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'<button class="btn ap ap-badge"></button>'},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f='<div class="product-img placeholder-container">\n    <img class="cover-image">\n    <div class="cover-image-placeholder hidden"></div>\n    ',k=a["if"].call(b,b&&b.isAp,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(k||0===k)f+=k;return f+'\n</div>\n<div class="product-info">\n    <div class="product-name">'+c((d=a.name||b&&b.name,"function"===typeof d?d.call(b,{name:"name",hash:{},data:e}):d))+'</div>\n    <div class="created-by">'+c((d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"created_by_user",{name:"i18n-g",hash:{user:b&&b.creatorName},data:e})))+'</div>\n    <div class="price-info">\n        <div class="price-credits">'+c((d=a.price||b&&b.price,"function"===typeof d?d.call(b,{name:"price",hash:{},data:e}):d))+"</div>\n    </div>\n</div>\n"},useData:!0})}({}),Gg=function(g){var b=g.UiCore.UiContext;return g.UiCore.UiContext.extend("WishListItem",{className:"wishlist-item",uiContextName:"wishlist_item",tagName:"div",dependencies:["globalStringManager","iconManager","imageManager","loginManager","productImageManager"],trackedEvents:function(){return[]},initialize:function(a){b.prototype.initialize.call(this,a);this.__filterModel=this.__serviceProvider.create(g.Model.FilterModel,[],{});this.__filterModel.setCategoryByProduct(this.model.edge);this.__myself=a.loginManager.getCurrentUser();this.__productImageManager=a.productImageManager;this.addToDOM()},setImage:function(a,c,e){this.__category=this.__filterModel.get("category");c&&e&&(a=IMVU.URI.build(a,{width:e,height:c}));this.__productImageManager.getProductImage(this.$("img"),a,this.__category,this.$el,this.$(".cover-image-placeholder"))},render:function(){this.model.populated().then(function(a){this.$el.html(g.template({name:a.get("product_name"),creatorName:a.get("creator_name"),isAp:"AP"===a.get("rating"),price:a.get(this.__myself.get("isVip")?"discount_price":"product_price")}));this.setImage(a.get("preview_image"),100,100);this.$el.data("node",a)}.bind(this))}})}({Model:l["@Model"],UiCore:l["@UiCore"],template:Fg}),Hg=function(g){var b=g.WAFWidgets.EdgeCollectionPresenter;return b.extend("WishlistCollectionPresenter",{className:"wish-list",uiContextName:"wish_list",itemFactory:g.WishlistItem,dependencies:["globalStringManager"],initialize:function(a){this.__globalStringManager=a.globalStringManager;b.prototype.initialize.call(this,a)},__emptyText:function(){return{standard:this.__globalStringManager.get("no_wishlist_results"),concise:this.__globalStringManager.get("no_wishlist_results_concise")}}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],WishlistItem:Gg}),Ig=function(g){var b=function(e){return e.extend("ItemPickerDialogWishlistCollectionPresenter",{initialize:function(d){this.__isBaseWishlistEmpty=d.isBaseWishlistEmpty;this.__giftee=d.giftee;this.__updateEmpty=function(){e.prototype.__updateEmpty.call(this);d.updateEmptyCallback.call(this,this.__isBaseWishlistEmpty())};g.WishlistCollectionPresenter.prototype.initialize.call(this,d)},__emptyText:function(){return this.__isBaseWishlistEmpty()?{standard:this.__globalStringManager.get("no wishlist_items_upsell",{user:this.__giftee.get("display_name")}),concise:this.__globalStringManager.get("No wishlist items")}:e.prototype.__emptyText.call(this)}})}(g.WishlistCollectionPresenter),a=[106,108,3088,425,366,1027],c=g.Dialogs.AlloyModalDialog;return c.extend("ItemPickerDialog",{uiContextName:"itempicker_dialog",className:"itempicker-dialog dialog-type-B",dependencies:["dialogManager","featureAccessManager","globalStringManager","loginManager","modeManager"],trackedEvents:function(){return[{type:"click",selector:".wishlist-item",name:"wishlist_picker_checkout",handler:this.__checkout.bind(this)},{type:"click",selector:".id-go-to-shop",name:"wishlist_picker_shopupsell",handler:this.__goToShop.bind(this)},{type:"click",selector:".dialog-back-button",name:"dialog_back_button",handler:"__goBack"}]},initialize:function(e){this.__filterModel=e.serviceProvider.create(g.Model.FilterModel,["filter_text"],{});this.title=e.globalStringManager.get("Send Gift");c.prototype.initialize.call(this,e);this.__myself=this.track(e.loginManager.getCurrentUser());this.__userPicker=e.userPicker;this.__source=e.source;this.model=void 0===this.__userPicker?IMVU.requireProperty(e,"model"):e.model?e.model:this.__userPicker.userCollection.at(0);this.model.populated().then(function(){this.baseWishlistSummary=this.model.searchEdgeCollection("wishlist",{filter:IMVU.URI.buildQuery({cat:a}),limit:0},g.Model.ProductEdgeCollection);this.baseWishlistSummary.populated().then(this.addToDOM.bind(this))}.bind(this))},render:function(){c.prototype.render.call(this);this.setContent("body",g.template);this.__createList(!0);this.$(".wish-list-container").scrollbar();this.listenTo(this.__filterModel,"change:filter_text",this.__createList.bind(this,!1))},postRender:function(){this.$(".dialog-header").prepend(g.backButtonTemplate({}))},__goBack:function(){this.promiseResolver.reject();this.hide()},__onClose:function(e){c.prototype.closeAll.call(this,e)},__displayUpSellButton:function(e){this.__$upSellButton||(this.__$upSellButton=$(g.upsellButtonTemplate()));this.__$upSellButton.toggle(e);this.$(".dialog-footer").append(this.__$upSellButton)},__isBaseWishlistEmpty:function(){return 0===this.baseWishlistSummary.total_count},__createList:function(e){this.__wishlistPresenter&&this.__wishlistPresenter.delete();var d=["wishlist",{filter:IMVU.URI.buildQuery({cat:a,keywords:this.__filterModel.get("filter_text")},{prune:!0})},g.Model.ProductEdgeCollection];e&&this.model.searchEdgeCollection.apply(this.model,d).enumerated().then(function(h){h.length&&this.createChildContext(g.SearchBox,{$replaceElement:this.$(".id-searchbox"),placeholder:"Search Wishlist",model:this.__filterModel,stringManager:this.__globalStringManager})}.bind(this));this.__wishlistPresenter=this.createChildContext(b,{collection:this.track(this.model.searchEdgeCollection.apply(this.model,d)),$parentElement:this.$(".wish-list-container"),scroller:this.$(".wish-list-container"),updateEmptyCallback:this.__displayUpSellButton.bind(this),isBaseWishlistEmpty:this.__isBaseWishlistEmpty.bind(this),giftee:this.model})},__checkout:function(e){e=$(e.currentTarget).data("node");this.__dialogManager.showGiftingDialog({type:"product",recipient:this.model,product:e,source:this.__source}).finished.then(function(){this.promiseResolver.resolve()}.bind(this))},__goToShop:function(){this.__modeManager.openMode({mode:{id:"shop"}})}})}({Checkout:l["@Checkout"],Dialogs:l["@Dialogs"],Model:l["@Model"],UiCore:l["@UiCore"],SearchBox:bb,WishlistCollectionPresenter:Hg,backButtonTemplate:Da,template:Bg,upsellButtonTemplate:Cg}),Jg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<div class="content-container">\n    <div class="content">\n        <div class="my-private-room-list-placeholder"></div>\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary continue" disabled>';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"shop_together_use_this_room",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</button>\n<\/script>"},useData:!0})}({}),Kg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="no-results notation no-private-room">\n    ',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"no_shop_together_rooms",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+=' \n    <span class="icon icon-tooltip-icon"></span>\n</div> \n\n<div class="tooltip-content">\n    <div class="tooltip-body">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"my_private_rooms_tooltip",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</div>\n</div>"},useData:!0})}({}),Lg=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("ShopTogetherCreationDialog",{uiContextName:"choose_room_dialog",className:"shop-together-creation-dialog dialog-type-B dialog-type-grid",dependencies:"dialogManager globalStartupModel globalStringManager loginManager modeManager Promise protocolLinksManager restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:"button.continue",name:"choose_room",handler:"__continue"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("shop_together_choose_room_dialog_title");this.__myself=this.__loginManager.getCurrentUser();this.__shopTogetherRoomUrl=this.__globalStartupModel.get("baseApiURI")+"room";this.__shopTogetherCreationManager=IMVU.requireProperty(a,"shopTogetherCreationManager");this.__invitedUser=IMVU.optionalProperty(a,"invitedUser",void 0);this.__modeManager=a.modeManager;this.addToDOM()},postRender:function(){this.setContent("body",g.template,{});this.setContent("footer",this.$(".dialog-footer-template").text());this.__myself.populated().then(function(){this.__roomCollection=this.__myself.searchEdgeCollection("my_rooms",{view:"shop_together_picker"},g.UiCore.EdgeCollection);return this.__roomCollection.populated()}.bind(this)).then(function(){this.__myRoomPickerChoices=this.createChildContext(g.ResponsiveTileList,{$replaceElement:this.$(".my-private-room-list-placeholder"),collection:this.__roomCollection,checkInUse:!0,activeChats:this.__serviceProvider.get("activeChats"),itemFactory:g.ResponsiveRoomTileListItem,emptyTemplate:g.ResponsiveShopTogetherRoomEmptyTemplate});this.listenTo(this.__myRoomPickerChoices,"item_selected",this.__selectRoom);this.__invitedUser&&!this.__invitedUser.get("is_ap")&&this.__myRoomPickerChoices.trigger("disable",{key:"content_rating",value:"AP"});this.$(".dialog-body .content-container").scrollbar();this.$el.find(".shop-together-tile").click()}.bind(this))},__selectRoom:function(a){if("AP"!==a.node.get("content_rating")||!this.__invitedUser||this.__invitedUser.get("is_ap"))this.__selectedRoomModel=a.node,this.$("button.continue").prop("disabled",!1)},_getSelectedRoomModel:function(){return this.__selectedRoomModel},__continue:function(){var a=this,c=this.__restModelFactory.createModel(this.__shopTogetherRoomUrl,g.UiCore.NodeModel,{shop_together:!0});if(this.__selectedRoomModel){var e=this.__shopTogetherRoomUrl+"/room-"+this.__selectedRoomModel.get("customers_id")+"-"+this.__selectedRoomModel.get("customers_room_id");c=this.__restModelFactory.simplePOST(e,{type:"shop_together"}).then(function(){a.__roomCollection.invalidate()}).then(function(){return a.__restModelFactory.readModel(e,g.UiCore.NodeModel).populated()})}this.__invitedUser?this.__shopTogetherCreationManager.goToRoom(c):this.__shopTogetherCreationManager.showInviteDialog(c)},close:function(){!this.__modeManager||this.__modeManager.getCurrentMode()&&"shop"!==this.__modeManager.getCurrentMode().id&&this.__modeManager.getCurrentMode().id||this.__modeManager.openMode({mode:{id:"shop"}});b.prototype.close.call(this)}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],ResponsiveRoomTileListItem:X,ResponsiveTileList:K,ResponsiveShopTogetherRoomEmptyTemplate:Kg,template:Jg}),Mg=function(g){var b=IMVU.BaseClass;return b.extend("ShopTogetherCreationManager",_.extend({dependencies:"chatManager dialogManager globalStartupModel globalStringManager loginManager modeManager Promise protocolLinksManager restModelFactory window windowManager".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__dialogManager=a.dialogManager;this.__globalStartupModel=a.globalStartupModel;this.__loginManager=a.loginManager;this.__protocolLinksManager=a.protocolLinksManager;this.__restModelFactory=a.restModelFactory;this.__chatManager=a.chatManager;this.__windowManager=a.windowManager;this.__window=a.window;this.__modeManager=a.modeManager;this.__globalStringManager=a.globalStringManager;this.__serviceProvider=a.serviceProvider;this.__pillToasterWidget=this.__serviceProvider.get("pillToasterWidget");this.__myself=this.__loginManager.getCurrentUser();this.__shopTogetherRoomUrl=this.__globalStartupModel.get("baseApiURI")+"room";this.__maxEntries=(this.__isVip=this.__myself.get("is_vip"))?2:1;this.__showRoomChooser=IMVU.optionalProperty(a,"showRoomChooser",this.__isVip);this.__invitedUser=IMVU.optionalProperty(a,"invitedUser",void 0);this.__redirectFunction=a.redirectFunction||this.redirectToFeatured;this.__successFullyCreated=!1;this.listenTo(this,"redirect",this.__redirectFunction)},redirectToFeatured:function(){this.stopListening(this,"redirect");this.__modeManager.getCurrentMode().openDefaultView()},createAndNavigateToShopTogetherRoom:function(){var a=this,c=this.__windowManager.getShopTogetherWindow();if(null!==c)this.__invitedUser&&this.__chatManager.inviteUserToRoom(c.model,this.__invitedUser),c.joinRoom();else{c=(c=this.__modeManager.getCurrentMode()?this.__modeManager.getCurrentMode().getCurrentSubmode():null)&&"shop_together"===c.id&&this.__invitedUser;if(this.__showRoomChooser&&!c)return this.__dialogManager.showDialog(g.ShopTogetherCreationDialog,{shopTogetherCreationManager:this,invitedUser:this.__invitedUser}).finished.catch(function(){a.closeAll()});if(c)c=this.__modeManager.getCurrentMode().getCurrentSubmode().model,this.__chatManager.inviteUserToRoom(c,this.__invitedUser);else return this.__invitedUser?this.goToRoom():this.showInviteDialog()}},goToRoom:function(a){var c=this;return(a?a:this.__restModelFactory.createModel(this.__shopTogetherRoomUrl,g.UiCore.NodeModel,{shop_together:!0})).then(function(e){c.shopTogetherRoomModel=e;return c.shopTogetherRoomModel}).then(function(){c.__successFullyCreated=!0;c.closeAll();c.__protocolLinksManager.handleProtocolLink({model:c.shopTogetherRoomModel,mode:{id:"shop"},submode:{id:"shop_together",forceJoin:!0,showAlways:!0,model:c.shopTogetherRoomModel}});c.__chatManager.inviteUserToRoom(c.shopTogetherRoomModel,c.__invitedUser)}).catch(function(){c.closeAll()})},showInviteDialog:function(a){var c=this;return(a?a:this.__restModelFactory.createModel(this.__shopTogetherRoomUrl,g.UiCore.NodeModel,{shop_together:!0})).then(function(e){c.shopTogetherRoomModel=e;return c.shopTogetherRoomModel.getSingleEdge("chat").populated()}).then(function(e){return e.getEdgeCollection("participants").populated()}).then(function(e){return 0===e.total_count?c.__dialogManager.showDialog(g.ChatInviteList,{roomModel:c.shopTogetherRoomModel,maxEntries:c.__maxEntries,participants:e,shopTogether:!0}).finished:!0}).then(function(){c.__successFullyCreated=!0;c.closeAll();c.__protocolLinksManager.handleProtocolLink({model:c.shopTogetherRoomModel,mode:{id:"shop"},submode:{id:"shop_together",forceJoin:!0,showAlways:!0,model:c.shopTogetherRoomModel}});c.__pillToasterWidget.renderToaster(c.__globalStringManager.get("shop_invitation_sent"))}).catch(function(e){e&&e.error&&"ROOM-NODE-044"===e.error.error?c.__dialogManager.alert({title:c.__globalStringManager.get("shop_together_oops"),text:c.__globalStringManager.get("ERROR.ROOM-NODE-044"),ok:c.__globalStringManager.get("OKAY")}).finished.then(function(){c.closeAll()}):c.closeAll()})},closeAll:function(){this.__dialogManager.closeAll();this.__successFullyCreated||this.__window.location.pathname.includes("/shop_together")&&this.trigger("redirect");return this}},Backbone.Events))}({UiCore:l["@UiCore"],ChatInviteList:I,ShopTogetherCreationDialog:Lg}),Ng=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="content">\n    <div class="private-rooms">\n        <div class="room-list-header">',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"My Private Rooms",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='</div>\n        <div class="my-private-room-list-placeholder"></div>\n    </div>\n    <div class="public-rooms">\n        <div class="room-list-header">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"My Public Rooms",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</div>\n        <div class="my-public-room-list-placeholder"></div>\n    </div>\n</div>\n\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary continue" disabled>';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Continue",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</button>\n<\/script>"},useData:!0})}({}),Og=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="no-results notation no-private-room">\n    ',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"no_my_private_rooms",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+=' \n    <span class="icon icon-tooltip-icon"></span>\n</div> \n\n<div class="tooltip-content">\n    <div class="tooltip-body">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"my_private_rooms_tooltip",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</div>\n</div>"},useData:!0})}({}),Pg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="no-results notation no-public-room">\n    ',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"no_my_public_rooms",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+=' \n    <span class="icon icon-tooltip-icon"></span>\n</div> \n\n<div class="tooltip-content">\n    <div class="tooltip-body">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"my_public_rooms_tooltip",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</div>\n</div>"},useData:!0})}({}),Qg=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("ChooseRoomDialog",{uiContextName:"choose_room_dialog",className:"choose-room-dialog dialog-type-B is-padded",dependencies:"chatManager dialogManager featureAccessManager globalStartupModel globalStringManager loginManager modeManager Promise rest restModelFactory user".split(" "),trackedEvents:function(){return[{type:"click",selector:"button.continue",name:"choose_room",handler:"__continue"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("choose_room_dialog_title");this.__myself=this.__loginManager.getCurrentUser();this.__publicRoomSelected=!1;this.addToDOM()},postRender:function(){this.setContent("body",g.template,{});this.setContent("footer",this.$(".dialog-footer-template").text());this.__myself.populated().then(function(){this.__publicCollection=this.__myself.searchEdgeCollection("my_rooms",{type:"listed"},g.UiCore.EdgeCollection);this.__privateCollection=this.__myself.searchEdgeCollection("my_rooms",{type:"inventory"},g.UiCore.EdgeCollection);return this.__Promise.every([this.__publicCollection.populated(),this.__privateCollection.populated()])}.bind(this)).then(function(){this.__myPrivateRooms=this.createChildContext(g.ResponsiveTileList,{$replaceElement:this.$(".my-private-room-list-placeholder"),collection:this.__privateCollection,itemFactory:g.ResponsiveRoomTileListItem,emptyTemplate:g.ResponsivePrivateRoomEmptyTemplate});this.listenTo(this.__myPrivateRooms,"item_selected",this.__selectPrivateRoom);this.__myPublicRooms=this.createChildContext(g.ResponsiveTileList,{$replaceElement:this.$(".my-public-room-list-placeholder"),collection:this.__publicCollection,itemFactory:g.ResponsiveRoomTileListItem,emptyTemplate:g.ResponsivePublicRoomEmptyTemplate});this.listenTo(this.__myPublicRooms,"item_selected",this.__selectPublicRoom);this.__user.get("is_ap")||(this.__myPrivateRooms.trigger("disable",{key:"content_rating",value:"AP"}),this.__myPublicRooms.trigger("disable",{key:"content_rating",value:"AP"}));this.__myPrivateRooms.trigger("disable",{key:"type",value:"shop_together"});this.$(".dialog-body .content").scrollbar()}.bind(this)).catch(function(){}.bind(this))},__selectPrivateRoom:function(a){this.__publicRoomSelected&&(this.__publicRoomSelected=!1,this.__myPublicRooms.$("li").removeClass("is-selected"));this.__selectRoom(a)},__selectPublicRoom:function(a){this.__publicRoomSelected||(this.__publicRoomSelected=!0,this.__myPrivateRooms.$("li").removeClass("is-selected"));this.__selectRoom(a)},__selectRoom:function(a){if("AP"!==a.node.get("content_rating")||this.__user.get("is_ap"))this.__roomModel=a.node,this.$("button.continue").prop("disabled",!1)},_getSelectedRoomModel:function(){return this.__roomModel},__continue:function(){this.__roomModel&&(this.__featureAccessManager.canSeeQA()||this.__featureAccessManager.isDev()||this.__featureAccessManager.isElectronClient()||!this.__featureAccessManager.canSeeClientUpsell()?(this.__modeManager.openMode({mode:{id:"chat"},submode:{id:this.__roomModel.id,forceJoin:!0,showAlways:!0}}),this.__serviceProvider.get("windowManager").removeWindow(this.__roomModel.id),this.__chatManager.inviteUserToRoom(this.__roomModel,this.__user)):this.__modeManager.openMode({mode:{id:"download"},submode:{id:"applaunch",chatModel:this.__roomModel,chooseRoom:!0}}).then(function(){this.__serviceProvider.get("windowManager").removeWindow(this.__roomModel.id);this.__chatManager.inviteUserToRoom(this.__roomModel,this.__user)}.bind(this)))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],ResponsiveRoomTileListItem:X,ResponsiveTileList:K,ResponsivePrivateRoomEmptyTemplate:Og,ResponsivePublicRoomEmptyTemplate:Pg,template:Ng}),Rg=function(g){var b=g.SafetyReportDialog;return b.extend("ReportUserDialog",{uiContextName:"report_user_dialog",className:"report-user-dialog",dependencies:["dialogManager","globalStartupModel","globalStringManager","restModelFactory"],title:"report_user_title",text:"report_user_text",reportButton:"report_user_report",dropdownOptions:[{label:"report_user_reason_inappropriate_name",value:"name"},{label:"report_user_reason_inappropriate_image",value:"photo"},{label:"report_user_reason_inappropriate_tagline",value:"tagline"},{label:"report_user_reason_inappropriate_interest",value:"interest"}],postRender:function(){b.prototype.postRender.call(this)}})}({UiCore:l["@UiCore"],SafetyReportDialog:E}),Sg=function(g){var b=g.UiCore.UiContext;return b.extend("ProfileActionBar",{className:"action-bar profile-action-bar",uiContextName:"profile_action_bar",dependencies:"contextMenuManager dialogManager featureAccessManager globalStartupModel globalStringManager googleAnalytics loginManager modeManager onboardingGamificationManager Promise protocolLinksManager user webGL window windowManager".split(" "),trackedEvents:function(){return[{type:"click",selector:".action-more",name:"profile_action_more",handler:this.__moreAction},{type:"click",selector:".action-gift",name:"profile_action_gift",handler:this.__gift},{type:"click",selector:".action-message",name:"profile_action_message",handler:this.__messageAction}]},initialize:function(a){var c=this;b.prototype.initialize.call(this,a);this.__openContext=IMVU.optionalProperty(a,"openContext",null);this.__isLoggedIn=!!this.__loginManager.isLoggedIn();this.__isNotMyProfile=!0;this.__blockedUserModel=null;this.__isLoggedIn&&(this.__myself=this.__loginManager.getCurrentUser(),this.__friendManager=this.__serviceProvider.get("friendManager"),this.__chatManager=this.__serviceProvider.get("chatManager"),this.__activeChat=IMVU.optionalProperty(a,"activeChat",null),this.__blockedUsers=this.track(this.__myself.getEdgeCollection("blocked",g.UiCore.EdgeCollectionModel)),this.__featureAccessManager.canSeeShopTogether()&&(this.__shopTogetherCreationManager=this.__serviceProvider.create(g.ShopTogetherCreationManager,{invitedUser:this.__user})),this.__addRenderGatingPromise(this.__blockedUsers.populated()),this.doWork([function(){return c.__blockedUsers.populated()},function(){c.__blockedUserModel=c.__blockedUsers.find(function(e){return c.__user.id===e.node.id})}]),this.__isNotMyProfile=this.__user.id!==this.__myself.id,this.listenTo(this,"message",this.__messageAction.bind(this)),this.listenTo(this,"gift",this.__gift.bind(this)));this.addToDOM()},render:function(){var a=this;this.doWork([function(){a.$el.html(g.template({notMyProfile:a.__isNotMyProfile}));var c=a.createChildContext(g.WithmeWidgets.SocialShare,{$parentElement:a.$(".action-share-container"),linkToCopy:a.__getLinkToCopy()});a.__addRenderGatingPromise(c.getHasRenderedPromise());a.__isNotMyProfile&&(a.__followButton=a.createChildContext(g.WithmeWidgets.FollowButton,{$parentElement:a.$(".follow-container"),profileNode:a.__user.getSingleEdge("profile")}),a.__addRenderGatingPromise(a.__followButton.getHasRenderedPromise()));a.__waitOnRenderGatingPromises()}])},__getLinkToCopy:function(){return this.__globalStartupModel.get("goLinkBase")+"/av/"+this.__user.get("username").replace(/^guest_/i,"")},__gift:function(a){this.__isLoggedIn?a&&$(a.currentTarget).hasClass("disabled")||this.__dialogManager.showGiftingDialog({recipient:this.__user,source:this.uiContextName}).finished.then(function(){this.__close()}.bind(this)):this.__forceLoginStopProp(a)},__messageAction:function(a){this.__isLoggedIn?a&&$(a.currentTarget).hasClass("disabled")||(this.__featureAccessManager.canSeeWindows()?this.__windowManager.addMessagesWindow(this.__user.id,{model:"interimMessage",targetUser:this.__user}):this.__modeManager.openMode({showAlways:!0,mode:{id:"messages",modelUrl:this.__user.get("username").replace(/^guest_/i,"")},submode:{id:"compose"}}).then(function(c){c.composeMessageTo(this.__user)}.bind(this)),this.__dialogManager.closeAll(),this.__close()):this.__forceLoginStopProp(a)},__moreAction:function(a){var c=this;this.__isLoggedIn?this.doWork([function(){return c.__user.populated()},function(){return g.ChatHelper.canBoot({Promise:c.__Promise,activeChat:c.__activeChat,featureAccessManager:c.__featureAccessManager,myself:c.__myself,toBeBooted:c.__user})},function(e){var d=[];0===c.__user.get("persona_type")&&d.push({name:"chat",classNames:c.__user.get("online")?"":"disabled",text:c.__globalStringManager.get("Invite to Chat"),handler:c.__chatAction.bind(c,!c.__user.get("online"))});c.__featureAccessManager.canSeeShopTogether()&&d.push({name:"invite_shop",classNames:c.__user.get("online")?"":"disabled",text:c.__globalStringManager.get("invite_to_shop"),handler:c.__shopAction.bind(c,!c.__user.get("online"))});c.__activeChat&&(c.__activeChat.isUserMuted(c.__user)?d.push({name:"unmute",text:c.__globalStringManager.get("Unmute"),handler:c.__unmuteUser.bind(c)}):d.push({name:"mute",text:c.__globalStringManager.get("Mute"),handler:c.__muteUser.bind(c)}),c.__activeChat.myselfIsPresenter()&&d.push({name:"actions",text:c.__globalStringManager.get("Actions"),handler:c.__getCoopActions.bind(c)}));c.__canSeeActions()&&d.push({name:"message",text:c.__globalStringManager.get("Message"),handler:c.__messageAction.bind(c),classNames:0!==c.__user.get("persona_type")?"disabled":""});c.__user.relations.viewer_outbound_friend_request||(c.__user.relations.viewer_inbound_friend_request?(d.push({name:"friend_accept",text:c.__globalStringManager.get("Accept Friend Request"),handler:c.__friendAction.bind(c)}),d.push({name:"decline",text:c.__globalStringManager.get("Decline Friend Request"),handler:c.__declineFriendAction.bind(c)})):c.__user.relations.viewer_friend?d.push({name:"unfriend",text:c.__globalStringManager.get("Unfriend"),handler:c.__unfriendAction.bind(c)}):d.push({name:"friend_send",text:c.__globalStringManager.get("Add Friend"),handler:c.__friendAction.bind(c)}));c.__user.get("is_staff")||(c.__blockedUserModel?d.push({name:"unblock",text:c.__globalStringManager.get("Unblock"),handler:c.__unBlockAction.bind(c)}):d.push({name:"block_person",text:c.__globalStringManager.get("Block"),handler:c.__blockAction.bind(c)}));d.push({name:"report_person",text:c.__globalStringManager.get("Report"),handler:c.__reportAction.bind(c)});e&&(c.__activeChat.isLiveRoom()&&d.push({name:"make_viewer",text:c.__globalStringManager.get("Make a Viewer"),handler:c.__makeViewer.bind(c)}),d.push({name:"remove_user",text:c.__globalStringManager.get("Remove User"),handler:c.__removeUser.bind(c)}));c.__contextMenuManager.showMenu(a,g.ContextMenu,{items:d,displayOptions:{above:!0,right:!1}})}]):this.__forceLoginStopProp(a)},__canSeeActions:function(){if(this.__openContext){for(var a=this.__openContext,c=["chat_now_submode","room_instance_submode"];a&&-1===c.indexOf(a.uiContextName);)a=a.getParentUiContext();return a&&this.__webGL.use3d()&&this.__activeChat}return!1},__chatAction:function(a){var c=this;a||this.doWork([function(){return c.__user.populated()},function(){return c.__dialogManager.showDialog(g.ChooseRoomDialog,{user:c.__user})}])},__shopAction:function(a){var c=this;a||this.doWork([function(){return c.__user.populated()},function(){if(c.__featureAccessManager.canSeeAppLaunch()&&!c.__featureAccessManager.isMobile())c.__modeManager.openMode({mode:{id:"download"},submode:{id:"applaunch",shopTogetherSubmode:{id:"shop_together",invitedUser:c.__user}}});else return c.__shopTogetherCreationManager.createAndNavigateToShopTogetherRoom()},function(){c.__modeManager.getCurrentMode()&&c.__modeManager.getCurrentMode().getCurrentSubmode()&&"shop_together"===c.__modeManager.getCurrentMode().getCurrentSubmode().id&&c.getParentUiContext().close()}])},__blockAction:function(a){this.__dialogManager.showDialog(g.BlockPersonDialog,{model:this.__user}).finished.then(function(){this.__close()}.bind(this))},__unBlockAction:function(a){this.__dialogManager.showDialog(g.UnBlockPersonDialog,{model:this.__user})},__reportAction:function(a){this.__dialogManager.showDialog(g.ReportUserDialog,{model:this.__user}).finished.then(function(){this.__close()}.bind(this))},__friendAction:function(a){$(a.target).toggleClass("disabled",!0);if(this.__user.relations.viewer_friend||this.__user.relations.viewer_outbound_friend_request)throw Error("Tried to friend either myself or someone I've already friended!");this.__user.relations.viewer_inbound_friend_request?(this.__googleAnalytics.recordFriendRequest("accepted"),a=this.__friendManager.acceptFriendRequest(this.__user),this.$('li[data-menu-item="friend_accept"]').hide()):(this.__googleAnalytics.recordFriendRequest("sent"),a=this.__friendManager.addFriend(this.__user),this.$('li[data-menu-item="friend_send"]').hide());a.then(function(){var c=this;this.__featureAccessManager.canSeeOnboardingGamification()&&this.__onboardingGamificationManager.handleTaskCompletion("social_friend",function(){return c.__recordEvent("onboarding",{name:"grant_reward",event_type:"social_friend",cid:c.__myself.get("legacy_cid"),record:!0})});this.__user.invalidate()}.bind(this))},__unfriendAction:function(){this.__friendManager.unfriend(this.__user).then(function(){this.__dialogManager.alert({title:this.__globalStringManager.get("dialog_generic_save_success_title"),text:this.__globalStringManager.get("dialog_generic_save_success_text")+this.__user.get("display_name")+" (@"+this.__user.get("username").replace(/^guest_/i,"")+").",ok:this.__globalStringManager.get("dialog_generic_save_success_ok")})}.bind(this),function(a){this.__dialogManager.alert({title:this.__globalStringManager.get("dialog_generic_save_cancelled_title"),text:this.__globalStringManager.get("dialog_generic_save_cancelled_text"),ok:this.__globalStringManager.get("dialog_generic_save_cancelled_ok")})}.bind(this))},__declineFriendAction:function(){this.__friendManager.rejectFriendRequest(this.__user).then(function(){this.__user.invalidate()}.bind(this))},__removeUser:function(){this.__dialogManager.showDialog(g.RemoveUserDialog,{userToRemove:this.__user,activeChat:this.__activeChat}).finished.then(function(){this.__close()}.bind(this))},__makeViewer:function(){this.__activeChat.makeViewer(this.__user)},__muteUser:function(){this.__activeChat.muteUser(this.__user);this.__close()},__unmuteUser:function(){this.__activeChat.unmuteUser(this.__user);this.__close()},__close:function(){this.trigger("close_dialog")},__forceLoginStopProp:function(a){this.__isLoggedIn||("undefined"!==typeof a&&a.stopPropagation(),this.__dialogManager.showLoginOrSignupDialog())},__showLoginDialog:function(a){this.__dialogManager.showLoginOrSignupDialog()},__getCoopActions:function(){this.trigger("profile:coopWith",this.__user);this.__close()}})}({UiCore:l["@UiCore"],WithmeWidgets:l["@WithmeWidgets"],BlockPersonDialog:Ag,ChatHelper:J,ChooseRoomDialog:Qg,ContextMenu:t,ItemPickerDialog:Ig,RemoveUserDialog:Fa,ReportUserDialog:Rg,ShopTogetherCreationManager:Mg,UnBlockPersonDialog:zg,template:yg}),Tg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'\n<div class="creator-status-placeholder"></div>\n'},3:function(b,a,c,e){var d;c=this.escapeExpression;return"\n                "+c((d=a.age||b&&b.age,"function"===typeof d?d.call(b,{name:"age",hash:{},data:e}):d))+"\n            "},5:function(b,a,c,e){return'\n                <svg><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-profile_birthday"></svg>\n            '},7:function(b,a,c,e){var d;c=this.escapeExpression;return"\n                "+c((d=a.location_flag||b&&b.location_flag,"function"===typeof d?d.call(b,{name:"location_flag",hash:{},data:e}):d))+"\n            "},9:function(b,a,c,e){var d;c=this.escapeExpression;return'\n            <svg class="'+c((d=a.location_class||b&&b.location_class,"function"===typeof d?d.call(b,{name:"location_class",hash:{},data:e}):d))+'"><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-profile_'+c((d=a.location_class||b&&b.location_class,"function"===typeof d?d.call(b,{name:"location_class",hash:{},data:e}):d))+'"></svg>\n            '},11:function(b,a,c,e){return" location-hidden "},13:function(b,a,c,e){var d;c=a.helperMissing;var h='\n<div class="creator-shop info-row">\n    <div class="horizontal-divider"></div>\n    <legend class="title big-title">',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"profile_card.creator_shop.title",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+='</legend>\n    <section class="content">\n        <div class="creator-shop-product-title">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"profile_card.creator_shop.product_title",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+=':</div>\n        <div class="creator-shop-product-list-container"></div>\n        <div><button class="view-shop btn btn-ghost btn-dark full-width">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"profile_card.creator_shop.see_all",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</button></div>\n    </section>\n</div>\n"},15:function(b,a,c,e){var d,h=this.escapeExpression;c=a.helperMissing;h='\n<div class="current-room info-row '+h((d=a.current_room_class||b&&b.current_room_class,"function"===typeof d?d.call(b,{name:"current_room_class",hash:{},data:e}):d))+'">\n    <div class="horizontal-divider"></div>\n    <legend class="title big-title">';if((c=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"current room",{name:"i18n-g",hash:{},data:e})))||0===c)h+=c;h+='</legend>\n    <section class="content">\n        ';if((c=a["if"].call(b,b&&b.current_room_shown,{name:"if",hash:{},fn:this.program(16,e),inverse:this.program(18,e),data:e}))||0===c)h+=c;return h+"\n    </section>\n</div>\n"},16:function(b,a,c,e){return'\n            <img class="room-image"/>\n            <div class="room-name"></div>\n        '},18:function(b,a,c,e){var d;c=this.escapeExpression;return"\n            "+c((d=a.current_room_placeholder||b&&b.current_room_placeholder,"function"===typeof d?d.call(b,{name:"current_room_placeholder",hash:{},data:e}):d))+"\n        "},20:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f='\n<div class="bio info-row '+c((d=a.bio_class||b&&b.bio_class,"function"===typeof d?d.call(b,{name:"bio_class",hash:{},data:e}):d))+'">\n    <div class="horizontal-divider"></div>\n    <legend class="title big-title">';if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"bio",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+'</legend>\n    <section class="content">\n        '+c((d=a.bio||b&&b.bio,"function"===typeof d?d.call(b,{name:"bio",hash:{},data:e}):d))+"\n    </section>\n</div>\n"},22:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f='\n<div class="interests info-row '+c((d=a.interests_class||b&&b.interests_class,"function"===typeof d?d.call(b,{name:"interests_class",hash:{},data:e}):d))+'">\n    <div class="horizontal-divider"></div>\n    <legend class="title big-title">';if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"interests",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+'</legend>\n    <section class="content">\n        '+c((d=a.interests||b&&b.interests,"function"===typeof d?d.call(b,{name:"interests",hash:{},data:e}):d))+"\n    </section>\n</div>\n"},24:function(b,a,c,e){var d,h=this.escapeExpression;c=a.helperMissing;h='\n<div class="affinity info-row '+h((d=a.affinity_class||b&&b.affinity_class,"function"===typeof d?d.call(b,{name:"affinity_class",hash:{},data:e}):d))+'">\n    <div class="horizontal-divider"></div>\n    <legend class="title big-title">';if((c=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"affinity",{name:"i18n-g",hash:{},data:e})))||0===c)h+=c;h+='</legend>\n    <section class="content">\n        ';if((c=a["if"].call(b,b&&b.relationship_status_shown,{name:"if",hash:{},fn:this.program(25,e),inverse:this.noop,data:e}))||0===c)h+=c;h+="\n        ";if((c=a["if"].call(b,b&&b.looking_for_shown,{name:"if",hash:{},fn:this.program(27,e),inverse:this.noop,data:e}))||0===c)h+=c;return h+"\n    </section>\n</div>\n"},25:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f='\n            <div class="affinity-row relationship '+c((d=a.relationship_status_class||b&&b.relationship_status_class,"function"===typeof d?d.call(b,{name:"relationship_status_class",hash:{},data:e}):d))+'">\n                <span class="affinity-title">';if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"relationship",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+':</span>\n                <span class="affinity-text relationship">'+c((d=a.relationship_status||b&&b.relationship_status,"function"===typeof d?d.call(b,{name:"relationship_status",hash:{},data:e}):d))+"</span>\n            </div>\n        "},27:function(b,a,c,e){var d;c=this.escapeExpression;var h=a.helperMissing,f='\n            <div class="affinity-row looking-for '+c((d=a.looking_for_class||b&&b.looking_for_class,"function"===typeof d?d.call(b,{name:"looking_for_class",hash:{},data:e}):d))+'">\n                <span class="affinity-title">';if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"here for",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+':</span>\n                <span class="affinity-text herefor">'+c((d=a.looking_for||b&&b.looking_for,"function"===typeof d?d.call(b,{name:"looking_for",hash:{},data:e}):d))+"</span>\n            </div>\n        "},29:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f='\n<div class="member-since info-row">\n    <div class="horizontal-divider"></div>\n    <legend class="title big-title">';if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"profile_about_member_since",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+'</legend>\n    <section class="content">\n        '+c((d=a.member_since||b&&b.member_since,"function"===typeof d?d.call(b,{name:"member_since",hash:{},data:e}):d))+"\n    </section>\n</div>\n"},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h=this.escapeExpression,f="\n",k=a["if"].call(b,b&&b.is_the_user_creator,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(k||0===k)f+=k;f+='\n\n<div class="basic-info info-row">\n    <section class="age info-col">\n        <legend class="info-col-header title">\n            ';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"age",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='\n        </legend>\n        <div class="info-col-body">\n            ';if((k=a["if"].call(b,b&&b.age,{name:"if",hash:{},fn:this.program(3,e),inverse:this.program(5,e),data:e}))||0===k)f+=k;f+='\n        </div>\n        <div class="info-col-footer">\n            '+h((d=a.age_text||b&&b.age_text,"function"===typeof d?d.call(b,{name:"age_text",hash:{},data:e}):d))+'\n        </div>\n    </section>\n    <div class="vertical-divider"></div>\n    <section class="gender info-col">\n        <legend class="info-col-header title">\n            ';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"gender",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='\n        </legend>\n        <div class="info-col-body">\n            <svg class="'+h((d=a.gender_class||b&&b.gender_class,"function"===typeof d?d.call(b,{name:"gender_class",hash:{},data:e}):d))+'"><use onload="this.href.baseVal = this.href.baseVal;" xlink:href="#icon-profile_'+h((d=a.gender_class||b&&b.gender_class,"function"===typeof d?d.call(b,{name:"gender_class",hash:{},data:e}):d))+'"></svg>\n        </div>\n        <div class="info-col-footer">\n            '+h((d=a.gender||b&&b.gender,"function"===typeof d?d.call(b,{name:"gender",hash:{},data:e}):d))+'\n        </div>\n    </section>\n    <div class="vertical-divider"></div>\n    <section class="location info-col">\n        <legend class="info-col-header title">\n            ';if((k=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"location",{name:"i18n-g",hash:{},data:e})))||0===k)f+=k;f+='\n        </legend>\n        <div class="info-col-body">\n            ';if((k=a["if"].call(b,b&&b.location_flag_shown,{name:"if",hash:{},fn:this.program(7,e),inverse:this.program(9,e),data:e}))||0===k)f+=k;f+='\n        </div>\n        <div class="info-col-footer ';if((k=a.unless.call(b,b&&b.location_flag_shown,{name:"unless",hash:{},fn:this.program(11,e),inverse:this.noop,data:e}))||0===k)f+=k;f+='">\n            '+h((d=a.location||b&&b.location,"function"===typeof d?d.call(b,{name:"location",hash:{},data:e}):d))+"\n        </div>\n    </section>\n</div>\n\n";if((k=a["if"].call(b,b&&b.is_the_user_creator,{name:"if",hash:{},fn:this.program(13,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n\n";if((k=a["if"].call(b,b&&b.current_room_section_shown,{name:"if",hash:{},fn:this.program(15,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n\n";if((k=a["if"].call(b,b&&b.bio_shown,{name:"if",hash:{},fn:this.program(20,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n\n";if((k=a["if"].call(b,b&&b.interests_shown,{name:"if",hash:{},fn:this.program(22,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n\n";if((k=a["if"].call(b,b&&b.affinity_shown,{name:"if",hash:{},fn:this.program(24,e),inverse:this.noop,data:e}))||0===k)f+=k;f+="\n\n";if((k=a["if"].call(b,b&&b.member_since,{name:"if",hash:{},fn:this.program(29,e),inverse:this.noop,data:e}))||0===k)f+=k;return f+"\n"},useData:!0})}({}),Ug=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'\n    <button class="btn ap ap-badge"></button>\n'},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;c='<img src="'+c((d=a.thumbnail||b&&b.thumbnail,"function"===typeof d?d.call(b,{name:"thumbnail",hash:{},data:e}):d))+'">\n';if((b=a["if"].call(b,b&&b.isAP,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)c+=b;return c},useData:!0})}({}),Vg=function(g){var b=g.UiCore.UiContext;return b.extend("CreatorProductListItem",{className:"creator-product-list-item",uiContextName:"creator_product_list_item",dependencies:["dialogManager","model"],trackedEvents:function(){return[{type:"click",selector:"",name:"creator_product_item_click",handler:this.__onClick.bind(this)}]},initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){this.$el.html(g.template({thumbnail:IMVU.URI.build(this.__model.get("preview_image"),{width:75,height:75}),isAP:"AP"===this.__model.get("rating")}))},__onClick:function(a){this.__model.isPopulated()&&this.__dialogManager.showLightbox("ProductLightbox",{model:this.__model})}})}({UiCore:l["@UiCore"],template:Ug}),Wg=function(g){return g.UiCore.ListPresenter.extend("CreatorProductList",{uiContextName:"creator_product_list",className:"creator-product-list",itemFactory:g.CreatorProductListItem})}({UiCore:l["@UiCore"],CreatorProductListItem:Vg,emptyTemplate:L}),Xg=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c='<legend class="title big-title">\n    ';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"creator_status",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+'\n</legend>\n<section class="content">\n    <ul class="creator-status-tags"></ul>\n</section>\n<div class="horizontal-divider"></div>'},useData:!0})}({}),Yg=function(g){var b=function(c){return function(){c.__window.open("https://im.vu/help973","_blank")}},a=g.UiCore.UiContext;return a.extend("ProfileCreatorStatus",{className:"creator-status info-row",uiContextName:"profile_creator_status",dependencies:["featureAccessManager","globalStringManager","restModelFactory","window"],trackedEvents:function(){return[{type:"click",selector:".creator-status-tag",name:"creator_status_tag",handler:b(this)}]},initialize:function(c){a.prototype.initialize.call(this,c);this.__user=c.user;this.__tagList=null;this.__creatorDetails=this.__user.getSingleEdge("creator_details");this.addToDOM()},render:function(){var c=this;this.$el.html(g.template());this.__tagList=this.el.querySelector(".creator-status-tags");this.__creatorDetails.populated().then(function(){c.__setupTags()})},__setupTags:function(){if(this.__creatorDetails.get("show_tier")&&this.__creatorDetails.get("creator_tier")){var c=this.__creatorDetails.get("is_pro")?"pro":"tier";this.__createTag("Tier",c)}this.__creatorDetails.get("is_top_seller")&&this.__createTag("Top Seller","top");this.__creatorDetails.get("is_veteran")&&this.__createTag("Veteran Creator","veteran");this.__creatorDetails.get("is_media_master")&&this.__createTag("Media Master","master");this.__creatorDetails.get("is_media_maven")&&this.__createTag("Media Maven","maven");this.__creatorDetails.get("is_active")&&this.__createTag("Active Creator","active");this.__hasTags&&this.el.classList.add("show-status");this.__setAsRendered()},__createTag:function(c,e){this.__hasTags||(this.__hasTags=!0);var d=document.createElement("li");d.textContent="Tier"===c?this.__globalStringManager.get(c,{number:this.__creatorDetails.get("creator_tier")}):this.__globalStringManager.get(c);d.classList.add("creator-status-tag","creator-status-tag--"+e);this.__tagList.append(d)}})}({Model:l["@Model"],UiCore:l["@UiCore"],template:Xg}),Zg=function(g){var b=g.UiCore.UiContext;return b.extend("ProfileAbout",{className:"profile-about",uiContextName:"profile_about",dependencies:"dialogManager featureAccessManager globalStartupModel globalStringManager imageManager loginManager modeManager prefsManager restModelFactory user window".split(" "),trackedEvents:function(){return[{type:"click",selector:".current-room .room-name, .current-room .room-image",name:"current_room",handler:"__showRoomCard"},{type:"click",selector:"button.view-shop",name:"view_creator_shop",handler:"__viewShop"}]},initialize:function(a){var c=this;b.prototype.initialize.call(this,a);this.__isMyself=!1;if(this.__isLoggedIn=this.__loginManager.isLoggedIn())this.__myself=this.track(this.__loginManager.getCurrentUser()),this.__user===this.__myself&&(this.__isMyself=!0);this.__productSearchUrl=this.__globalStartupModel.get("productUrl");"true"===localStorage.getItem("forceProduction")&&(this.__productSearchUrl=this.__productSearchUrl.replace("localhost.",""));this.shown={age:!0,gender:!0,current_room:!0,location:!0};this.__isMyself?this.doWork([function(){return c.__prefsManager.populated()},function(){c.shown.age=c.__prefsManager.getBool("avwidget_show_age",!0);c.shown.gender=c.__prefsManager.getBool("avwidget_show_gender",!0);c.shown.location=c.__prefsManager.getBool("avwidget_show_geo_location",!0);c.shown.current_room=!c.__prefsManager.getBool("client.is_current_location_hidden",!1);c.addToDOM()}]):this.addToDOM()},render:function(){var a=this;this.__user.get("is_creator")&&this.__isLoggedIn&&this.__user.getSingleEdge("creator_details").invalidate();this.__user.invalidate();this.__addRenderGatingPromise(this.__user.populated());this.doWork([function(){return a.__user.populated()},function(){a.__showProfile();a.__user.on("change reset change:relations",a.__showProfile,a);a.__waitOnRenderGatingPromises()}])},__showProfile:function(){var a=this,c={relationship_status:null!==this.__user.get("relationship_status")?this.__globalStringManager.get("relationship_status_"+this.__user.get("relationship_status")):null,looking_for:null!==this.__user.get("looking_for")?this.__globalStringManager.get("looking_for_"+this.__user.get("looking_for")):null,member_since:null!==this.__user.get("registered")?new Date(1e3*this.__user.get("registered")).toLocaleDateString():null};c.bio=this.__user.get("tagline")?this.__user.get("tagline"):this.__globalStringManager.get("profile_bio");c.bio_class=this.__user.get("tagline")?"":"empty";c.bio_shown=this.__user.get("tagline")?!0:this.__isMyself?!0:!1;c.interests=this.__user.get("interests")?this.__user.get("interests"):this.__globalStringManager.get("profile_interests");c.interests_class=this.__user.get("interests")?"":"empty";c.interests_shown=this.__user.get("interests")?!0:this.__isMyself?!0:!1;0===this.__user.get("looking_for")&&0===this.__user.get("relationship_status")?(c.affinity_class="empty",c.affinity_shown=this.__isMyself?!0:!1):(c.affinity_class="",c.affinity_shown=!0);c.looking_for_shown=0===this.__user.get("looking_for")?this.__isMyself?!0:!1:!0;c.relationship_status_shown=0===this.__user.get("relationship_status")?this.__isMyself?!0:!1:!0;c.looking_for_class=0===this.__user.get("looking_for")?"empty":"";c.relationship_status_class=0===this.__user.get("relationship_status")?"empty":"";c.age=this.__isMyself&&!this.shown.age||null===this.__user.get("age")?null:this.__user.get("age");c.age_text=null===c.age?this.__globalStringManager.get("hidden"):this.__globalStringManager.get("profile_about_age_description");var e=this.__isMyself&&!this.shown.gender||null===this.__user.get("gender")?null:this.__user.get("gender");null===e?(c.gender=this.__globalStringManager.get("hidden"),c.gender_class="gender_hidden"):(c.gender=this.__globalStringManager.get("gender_"+this.__user.get("gender")),c.gender_class="f"===e?"female_new":"male_new");null===(this.__isMyself&&!this.shown.location||null===this.__user.get("country")?null:this.__user.get("country"))?(c.location=this.__globalStringManager.get("hidden"),c.location_class="location_hidden",c.location_flag_shown=!1):(c.location=this.__user.get("country"),c.location_flag=this.__countryCodeToEmoji(this.__user.get("country")),c.location_flag_shown=!0,"US"===this.__user.get("country")&&this.__user.get("state")&&(c.location=this.__user.get("state")+", "+c.location),c.location_class="");c.is_in_experience_room=!!this.__user.relations.current_experience_room;c.is_in_chat_room=!!this.__user.relations.current_room;c.current_room_section_shown=c.is_in_chat_room||c.is_in_experience_room||this.__isMyself;c.current_room_placeholder=this.shown.current_room?this.__globalStringManager.get("profile_current_room_shown_placeholder"):this.__globalStringManager.get("profile_current_room_hidden_placeholder");c.current_room_shown=this.__isMyself?(c.is_in_chat_room||c.is_in_experience_room)&&this.shown.current_room:c.is_in_chat_room||c.is_in_experience_room;c.is_the_user_creator=!!this.__user.get("is_creator");this.$el.html(g.template(c));c.is_the_user_creator&&(this.__showCreatorProducts(),this.__isLoggedIn&&this.__showCreatorStatus());c.current_room_shown&&(this.$(".current-room").hide(),c.is_in_chat_room?this.__roomModel=this.__user.getSingleEdge("current_room"):c.is_in_experience_room&&(this.__roomModel=this.__user.getSingleEdge("current_experience_room")),this.__addRenderGatingPromise(this.__roomModel.populated()),this.doWork([function(){return a.__roomModel.populated()},function(){a.$(".current-room .room-name").text(a.__roomModel.get("name"));"AP"===a.__roomModel.get("rating")&&a.$(".current-room").addClass("is-ap");var d=a.__imageManager.load(a.$(".current-room .room-image"),a.__roomModel.get("themed_image_url")||a.__roomModel.get("image_url"));a.__addRenderGatingPromise(d);a.$(".current-room").show()}]))},__showRoomCard:function(){this.__dialogManager.showDialog(g.RoomDetailLightbox,{model:this.__roomModel})},__countryCodeToEmoji:function(a){return a.toUpperCase().replace(/[A-Z]/g,function(c){return String.fromCodePoint(c.charCodeAt(0)+127397)})},__showCreatorProducts:function(){var a=this,c={no_cat:"316,324",creator:this.__user.get("username")};this.__isLoggedIn&&this.__myself.get("is_ap")||(c.ap=0,c.product_rating=0,c.rating="ga",c.ga_only=1);this.shopCollection=this.track(this.__restModelFactory.searchCollection(this.__productSearchUrl,c,g.Model.ProductCollection));this.__addRenderGatingPromise(this.shopCollection.populated());this.shopCollection.enumerated().then(function(){0<a.shopCollection.length&&0===a.$(".creator-product-list").length?(a.__creatorProductList=a.createChildContext(g.CreatorProductList,{$parentElement:a.$(".creator-shop-product-list-container"),collection:a.shopCollection}),a.shopCollection.populated().then(function(){for(var e=a.__creatorProductList.getItems(),d=0;d<e.size;d++)a.__addRenderGatingPromise(e[d].getHasRenderedPromise())}),a.$(".creator-product-list").scrollbar()):a.$(".creator-shop").toggleClass("hidden",!0)})},__showCreatorStatus:function(){this.__creatorStatus=this.createChildContext(g.ProfileCreatorStatus,{$replaceElement:this.$el.find(".creator-status-placeholder"),user:this.__user});this.__addRenderGatingPromise(this.__creatorStatus.getHasRenderedPromise())},__viewShop:function(){var a={id:"products",creatorModel:this.__user,showAlways:!0};this.__modeManager.openMode({mode:{id:"shop",submode:a},submode:a})},delete:function(){b.prototype.delete.call(this);this.__user&&this.__user.off(void 0,void 0,this)}})}({Model:l["@Model"],UiCore:l["@UiCore"],CreatorProductList:Wg,ProfileCreatorStatus:Yg,RoomDetailLightbox:Ha,template:Tg}),$g=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return"<div class=\"main-info\">\n    <div class='picture tile-body'>\n    </div>\n    <div class='text'>\n        <div class='display-name-install-point'></div>\n        <div class='avatar-name-install-point'></div>\n    </div>\n</div>\n"},useData:!0})}({}),ah=function(g){var b=g.UiCore.UiContext;return b.extend("ProfileHeadpiece",{className:"profile-headpiece standard-headpiece",uiContextName:"profile_headpiece",dependencies:["Promise","user","window"],initialize:function(a){var c=this;b.prototype.initialize.call(this,a);this.__ignoreClicks=IMVU.optionalProperty(a,"ignoreClicks",!1);this.doWork([function(){return c.__user.populated()},function(){c.addToDOM();var e=c.createChildContext(g.WAFWidgets.ProfileIcon,{ignoreClicks:c.__ignoreClicks,user:c.__user,$parentElement:c.$(".picture"),useExtraLargeProfile:!0});c.__addRenderGatingPromise(e.getHasRenderedPromise());e=c.createChildContext(g.WAFWidgets.DisplayName,{$replaceElement:c.$(".display-name-install-point"),user:c.__user,showVipBadge:!0,size:"large",ignoreClicks:c.__ignoreClicks});c.__addRenderGatingPromise(e.getHasRenderedPromise());e=c.createChildContext(g.WAFWidgets.AtAvatarName,{$replaceElement:c.$(".avatar-name-install-point"),user:c.__user,size:"small",color:"dark",ignoreClicks:c.__ignoreClicks});c.__addRenderGatingPromise(e.getHasRenderedPromise());c.__waitOnRenderGatingPromises()}])},render:function(){var a=this;this.doWork([function(){a.$el.html(g.template({avatarName:a.__user.get("username")}))}])}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],template:$g}),bh=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=this.escapeExpression;return'<div class="avatar-container '+c((d=a.liveRoomsPhase2||b&&b.liveRoomsPhase2,"function"===typeof d?d.call(b,{name:"liveRoomsPhase2",hash:{},data:e}):d))+'"></div>\n<div class="shields-placeholder"></div>\n'},useData:!0})}({}),ch=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){var d,h=a.helperMissing;c='\n<div class="error-button">\n    <button class="btn btn-ghost-light btn-xsmall">';if((a=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"reload",{name:"i18n-g",hash:{},data:e})))||0===a)c+=a;return c+"</button>\n</div>\n"},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d,h=a.helperMissing;c=this.escapeExpression;var f='<div class="error-title">';if((h=(d=a["i18n-g"]||b&&b["i18n-g"]||h,d.call(b,"profile_look_load_error_title",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n<div class="error-text">'+c((d=a.message||b&&b.message,"function"===typeof d?d.call(b,{name:"message",hash:{},data:e}):d))+"</div>\n";if((h=a["if"].call(b,b&&b.showCTA,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===h)f+=h;return f},useData:!0})}({}),dh=function(g){var b=g.UiCore.UiContext;return b.extend("ProfileLookError",{className:"profile-look-error",uiContextName:"profile_look_error",dependencies:["globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"reload_profile_look",handler:"__reloadLook"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__message=IMVU.optionalProperty(a,"message",this.__globalStringManager.get("profile_look_load_error_text"));this.__showCTA=IMVU.optionalProperty(a,"showCTA",!0);this.addToDOM()},render:function(){this.$el.html(g.template({message:this.__message,showCTA:this.__showCTA}))},__reloadLook:function(){this.trigger("reload")}})}({UiCore:l["@UiCore"],template:ch}),eh=function(g){var b=g.DressUpAvatarManager;return b.extend("ProfileOutfitDressUpAvatarManager",{dependencies:["profile","Promise","restModelFactory"],initialize:function(a){a.persistLooks=!1;this.__profile=a.profile;b.prototype.initialize.call(this,a)},__initializeLookModel:function(){this.__createLookModel(this.__profile);return this.__lookModel.populated()},__initializeLogoutLookModel:function(){this.__createLookModel(this.__profile);return this.__lookModel.populated()},__getCurrentLookAlert:function(){this.dialogManager.alert({title:this.__globalStringManager.get("dialog_get_profile_look_error_title"),text:this.__globalStringManager.get("dialog_get_profile_look_error_text"),ok:this.__globalStringManager.get("dialog_get_profile_look_error_button")})},__setCurrentLookAlert:function(){return this.__Promise.resolve()}})}({Model:l["@Model"],UiCore:l["@UiCore"],DressUpAvatarManager:x}),fh=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({1:function(b,a,c,e){return'<button class="btn staff"></button>'},3:function(b,a,c,e){var d,h=a.helperMissing;c='<button class="btn vip_tier">';if((a=(d=a.icon||b&&b.icon||h,d.call(b,b&&b.vip_icon,{name:"icon",hash:{},data:e})))||0===a)c+=a;return c+"</button>"},5:function(b,a,c,e){return'<button class="btn ap"></button>'},7:function(b,a,c,e){return'<button class="btn vip"></button>'},9:function(b,a,c,e){return'<button class="btn age-verified"></button>'},11:function(b,a,c,e){return'<button class="btn married"></button>'},13:function(b,a,c,e){var d,h=a.helperMissing;c='<button class="btn host_subscriptions">';if((a=(d=a.icon||b&&b.icon||h,d.call(b,"icon-host_subscriptions",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)c+=a;return c+"</button>"},15:function(b,a,c,e){var d,h=a.helperMissing;c='<button class="btn greeter">';if((a=(d=a.icon||b&&b.icon||h,d.call(b,"icon-profile_greeter",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)c+=a;return c+"</button>"},17:function(b,a,c,e){var d,h=a.helperMissing;c='<button class="btn moderator" disabled>';if((a=(d=a.icon||b&&b.icon||h,d.call(b,"icon-moderator-badge",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)c+=a;return c+"</button>"},19:function(b,a,c,e){var d,h=a.helperMissing;c='<button class="btn creator">';if((a=(d=a.icon||b&&b.icon||h,d.call(b,b&&b.creator_icon,{name:"icon",hash:{},data:e})))||0===a)c+=a;return c+"</button>"},21:function(b,a,c,e){var d;c=a.helperMissing;var h='<button class="btn nft-owner">',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"nft_logo_text",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;if((f=(d=a.icon||b&&b.icon||c,d.call(b,"icon-nft",{name:"icon",hash:{},data:e})))||0===f)h+=f;return h+"</button>"},compiler:[5,">= 2.0.0"],main:function(b,a,c,e){c="";var d=a["if"].call(b,b&&b.staff,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(d||0===d)c+=d;c+="\n";if((d=a["if"].call(b,b&&b.vip_tier,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n";if((d=a["if"].call(b,b&&b.ap,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n";if((d=a["if"].call(b,b&&b.vip_legacy,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n";if((d=a["if"].call(b,b&&b.ageverified,{name:"if",hash:{},fn:this.program(9,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n";if((d=a["if"].call(b,b&&b.married,{name:"if",hash:{},fn:this.program(11,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n";if((d=a["if"].call(b,b&&b.host,{name:"if",hash:{},fn:this.program(13,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n";if((d=a["if"].call(b,b&&b.greeter,{name:"if",hash:{},fn:this.program(15,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n";if((d=a["if"].call(b,b&&b.moderator,{name:"if",hash:{},fn:this.program(17,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n";if((d=a["if"].call(b,b&&b.creator,{name:"if",hash:{},fn:this.program(19,e),inverse:this.noop,data:e}))||0===d)c+=d;c+="\n";if((d=a["if"].call(b,b&&b.nftOwner,{name:"if",hash:{},fn:this.program(21,e),inverse:this.noop,data:e}))||0===d)c+=d;return c},useData:!0})}({}),gh=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){var d;c=a.helperMissing;var h='<div class="column-1"></div>\n<div class="column-2">\n    <h1>\n        ',f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"nft_intro_dialog_header_1",{name:"i18n-g",hash:{},data:e}));if(f||0===f)h+=f;h+="\n        <span>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"nft_intro_dialog_header_2",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</span>\n    </h1>\n    <p>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"nft_intro_widget_paragraph_1",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="</p>\n    <p>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"nft_intro_widget_paragraph_2",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</p>\n    <p class="go-to-shop">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"nft_intro_dialog_shop_now",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+="<span>";if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"nft_intro_dialog_shop_cta",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;h+='</span></p>\n\n    <button class="confirmation btn-primary font-medium">';if((f=(d=a["i18n-g"]||b&&b["i18n-g"]||c,d.call(b,"Got It",{name:"i18n-g",hash:{},data:e})))||0===f)h+=f;return h+"</button>\n</div>"},useData:!0})}({}),hh=function(g){var b=g.Dialogs.AlloyModalDialog;return b.extend("NFTIntroDialog",{className:"nft-intro-dialog dialog-type-B",uiContextName:"nft_intro_dialog",dependencies:["dialogManager","globalStringManager","modeManager","Promise","window"],trackedEvents:function(){return[{type:"click",selector:".shop-nft",name:"shop_nft",handler:"__goToNFTShop"},{type:"click",selector:".confirmation",name:"nft_intro_dialog_confirmation",handler:"__onClose"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.serviceProvider=a.serviceProvider;this.__stringManager=a.globalStringManager;this.addToDOM()},render:function(){this.$el.html(g.template({}))},show:function(){b.prototype.show.call(this)},hide:function(){b.prototype.hide.call(this)},close:function(){this.hide();this.promiseResolver.reject()},__onClose:function(a){a.stopPropagation();this.close()},__goToNFTShop:function(){},delete:function(){this.__postToParent&&this.__window.parent&&this.__window.parent.postMessage&&this.__window.parent.postMessage({message:"deleting_modal_dialog",type:this.uiContextName},"*");b.prototype.delete.call(this)}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],template:gh}),cb=function(g){var b=function(f){return function(){return f.__dialogManager.showDialog(g.MultiCartUpsellDialog,{upsellProduct:"vip",afterAction:"close"}).finished.then(function(){f.__dialogManager.closeActive()})}},a=function(f){var k=f.context,m=f.type,n=f.contextual,q=void 0===f.afterAction?!1:f.afterAction,p=void 0===f.disabledProducts?!1:f.disabledProducts;return function(){var u={upsellProduct:m};n&&(u.contextual=!0);q&&(u.afterAction="close");!1!==p&&(u.disabledProducts=p);"vip"===m&&(u.vipTrigger="vip_shield",u.vipTriggerLocation="profile_card");return k.__dialogManager.showDialog(g.MultiCartUpsellDialog,u)}},c=function(f){return function(){f.__upsellDialog=f.__dialogManager.showDialog(g.MultiCartUpsellDialog,{upsellProduct:"greeter"})}},e=function(f){return function(){f.__window.open("https://about.imvu.com/careers/","_blank")}},d=function(f){return function(){f.__window.open("https://www.imvu.com/creators/creator_dashboard.php","_blank")}},h=g.UiCore.UiContext;return h.extend("Shields",{className:"shields",uiContextName:"shields",dependencies:"dialogManager featureAccessManager globalStringManager loginManager Promise user window".split(" "),trackedEvents:function(){return[{type:"click",selector:"button.ap",name:"button_ap",handler:a({context:this,type:"ap",contextual:!0})},{type:"click",selector:"button.age-verified",name:"button_age_verified",handler:a({context:this,type:"age_verification",contextual:!0})},{type:"click",selector:"button.vip",name:"button_vip",handler:a({context:this,type:"vip",contextual:!0,afterAction:!0})},{type:"click",selector:"button.vip_tier",name:"button_vip_tier",handler:a({context:this,type:"vip",contextual:!0,afterAction:!0})},{type:"click",selector:"button.married",name:"button_marriage",handler:a({context:this,type:"marriage_package",contextual:!0})},{type:"click",selector:"button.greeter",name:"button_greeter",handler:c(this)},{type:"click",selector:"button.staff",name:"button_staff",handler:e(this)},{type:"click",selector:"button.host_subscriptions",name:"button_host_subscriptions",handler:b(this)},{type:"click",selector:"button.creator",name:"button_creator",handler:d(this)},{type:"click",selector:"button.nft-owner",name:"button_nft_owner",handler:this.__openNFTIntroDialog}]},initialize:function(f){var k=this;h.prototype.initialize.call(this,f);this.shown=f.shown||{age:!0,gender:!0,ap:!0,av:!0,staff:!0,vip:!0,tiered_vip:!0,greeter:!0,moderator:!0,married:!0,host_subscriptions:!0,creator:!0,creator_icon:null};this.__user=this.track(f.user);this.__user.on("change",function(){k.__resetCreatorDetails();k.__runWork()},this);this.__isLoggedIn=this.__loginManager.isLoggedIn();this.__isCreator=!1;this.__creatorDetails=null;this.addToDOM()},render:function(){this.__resetCreatorDetails();this.__user.invalidate();this.__addRenderGatingPromise(this.__user.populated());this.__runWork()},delete:function(){h.prototype.delete.call(this);this.__user&&this.__user.off(void 0,void 0,this)},__runWork:function(){var f=this;this.doWork([function(){return f.__user.populated()},function(){return f.__checkCreatorStatus()},function(){f.__checkVIPStatus()},function(){f.__addShields()}])},__resetCreatorDetails:function(){this.__user.get("is_creator")&&this.__isLoggedIn&&this.__user.getSingleEdge("creator_details").invalidate()},__checkCreatorStatus:function(){var f=this;return(this.__isCreator=this.__user.get("is_creator"))&&this.__isLoggedIn?this.__user.getSingleEdge("creator_details").populated().then(function(k){f.__creatorDetails=k}):this.__Promise.resolve()},__checkVIPStatus:function(){this.__VIPtier=this.__user.get("vip_tier");this.__VIPplatform=this.__user.get("vip_platform");this.__VIPlegacy=this.__user.get("is_vip");this.__HOSTlegacy=this.__user.get("is_host")},__addShields:function(){var f=this.__isLoggedIn&&this.__user.get("is_staff")&&this.shown.staff,k;if(k=this.__isLoggedIn)(k=localStorage.getItem("is_ap"))?(k=JSON.parse(k),(new Date).getTime()>k.expiry?(localStorage.removeItem("is_ap"),k=!1):k=k.value):k=!1;f={staff:f,ap:k||this.__user.get("is_ap")&&this.shown.ap,ageverified:this.__isLoggedIn&&this.__user.get("is_ageverified")&&this.shown.av,married:this.__isLoggedIn&&void 0!==this.__user.relations.spouse&&this.shown.married,greeter:this.__isLoggedIn&&this.__user.get("is_greeter")&&this.shown.greeter,moderator:this.__isLoggedIn&&this.__user.get("is_discussion_moderator")&&this.shown.moderator,creator:!1,nftOwner:this.__featureAccessManager.canSeeNFT()&&this.__user.get("has_nft")};if(this.__isCreator&&this.__isLoggedIn){k=this.__creatorDetails.get("show_tier")?this.__creatorDetails.get("creator_tier"):"hidden";var m=this.__creatorDetails.get("is_pro")?"-pro":"";f.creator=this.shown.creator;f.creator_icon="icon-creator-shield-"+k+m}this.__VIPtier?(f.vip_platform=this.__VIPplatform,4===this.__VIPplatform?(f.vip_legacy=!0,f.host=this.__HOSTlegacy):(f.vip_tier=this.__VIPtier,f.vip_icon="icon-vip_badge_level_"+this.__VIPtier,f.host=!0)):(f.vip_legacy=this.__VIPlegacy,f.host=this.__HOSTlegacy);this.$el.html(g.template(f));this.__waitOnRenderGatingPromises()},__openNFTIntroDialog:function(){this.__dialogManager.showDialog(g.NFTIntroDialog)}})}({UiCore:l["@UiCore"],MultiCartUpsellDialog:H,NFTIntroDialog:hh,template:fh}),ih=function(g){var b=function(c){c.__addAvatarResolver=null;c.__addAvatarPromise=new c.__Promise(function(e){c.__addAvatarResolver=e});!c.__loginManager.isLoggedIn()&&c.__is2d?(c.__showError({showCTA:!1,message:c.__globalStringManager.get("failed_to_load")}),c.__addAvatarResolver.resolve()):c.doWork([function(){return c.__dressUpAvatarManager.populated()},function(){return c.__dressUpAvatarManager.getLookModel().populated()},function(){c.__sceneArgs={$parentElement:c.$(".avatar-container"),model:c.__dressUpAvatarManager.getLookModel(),view:"dressup_front_outfits",sceneType:"profile_scene",context:c};c.__sceneManager=c.__sceneManager.initProfileScene(c.__sceneArgs);c.__sceneManager&&(c.listenTo(c.__sceneManager,"avatar_load_fail",c.__showError),c.doWork([function(){return c.__sceneManager.getSceneLoadedPromise()},function(){c.__addAvatarResolver.resolve()}]))}]);return c.__addAvatarPromise},a=g.UiCore.UiContext;return a.extend("ProfileLook",{className:"profile-look",uiContextName:"profile_look",dependencies:"dialogManager featureAccessManager globalStringManager iconManager loginManager Promise sceneManager user webGL window".split(" "),initialize:function(c){a.prototype.initialize.call(this,c);this.__isColumnView=IMVU.optionalProperty(c,"isColumnView",!1);this.shown={age:!0,gender:!0,ap:!0,av:!0,staff:!0,vip:!0,greeter:!0,moderator:!0};if(this.__isLoggedIn=this.__loginManager.isLoggedIn())this.__myself=this.__loginManager.getCurrentUser();this.__sceneManager=c.sceneManager;this.__is2d=!this.__webGL.canUse3d();this.__dressUpAvatarManagerFactory=c.dressUpAvatarManagerFactory||g.DressUpAvatarManager;this.__dressUpAvatarManager=this.__serviceProvider.create(this.__dressUpAvatarManagerFactory,_.extend(c,{profile:this.__user.relations.profile_outfit}));this.liveRoomsPhase2torial=c.liveRoomsPhase2torial;this.liveRoomsPhase2Class="";this.addToDOM();this.$el.toggleClass("column-view",this.__isColumnView)},render:function(){this.liveRoomsPhase2torial&&(this.liveRoomsPhase2Class="transparent-avatar");this.$el.html(g.template({liveRoomsPhase2:this.liveRoomsPhase2Class}));this.liveRoomsPhase2torial||(this.__addAvatarPromise=b(this));this.__featureAccessManager.isMobile()||this.createChildContext(g.Shields,{$replaceElement:this.$(".shields-placeholder"),user:this.__user})},getAddAvatarPromise:function(){return this.__addAvatarPromise}})}({UiCore:l["@UiCore"],DressUpAvatarManager:eh,MultiCartUpsellDialog:H,ProfileLookError:dh,Shields:cb,template:bh}),jh=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="search-container">\n</div>\n<div class="profile-user-list-container">\n</div>'},useData:!0})}({}),kh=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="profile-info">\n</div>'},useData:!0})}({}),lh=function(g){return g.UiCore.UiContext.extend("ProfileFriendsListItem",{uiContextName:"profile_friends_list_item",tagName:"article",className:"profile-friends-list-item",dependencies:["dialogManager","imageManager","model"],trackedEvents:function(){return[{type:"click",selector:".profile-info",name:"profile_item_show_profile",handler:this.__onClickTile.bind(this)}]},initialize:function(b){g.UiCore.UiContext.prototype.initialize.call(this,b);this.userNode=this.__model.node;this.addToDOM();this.$el.removeClass("loading")},__loadImage:function(b){this.__imageManager.load(this.$(".cover-image"),this.userNode.get("thumbnail_url"),{container:this.$el})},render:function(){this.model.populated().then(function(){this.$el.html(g.template({}));this.createChildContext(g.WAFWidgets.DualName,{$parentElement:this.$(".profile-info"),user:this.userNode,configuration:"large-dual-lightbg"});this.__loadImage()}.bind(this))},__onClickTile:function(){this.__ignoreClicks||(event.stopPropagation(),this.__user&&this.userNode.populated().then(function(){this.__isLoggedIn?this.__dialogManager.showLightbox("ProfileLightbox",{user:this.userNode,activeChat:this.__activeChat}):this.__modeManager.openMode({mode:{id:"av"},submode:{id:this.userNode.get("id")}})}.bind(this)))}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],template:kh}),mh=function(){var g=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return g({compiler:[5,">= 2.0.0"],main:function(b,a,c,e){return'<div class="profile-info">\r\n    <div class="disabled-txt hidden">Disabled Account</div>\r\n</div>\r\n<div class="button-container"></div>'},useData:!0})}({}),db=function(g){return g.UiCore.UiContext.extend("ProfileListItem",{uiContextName:"profile_list_item",tagName:"article",className:"profile-list-item",dependencies:"appMonitor dialogManager imageManager loginManager model modeManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".profile-info",name:"profile_item_show_profile",handler:this.__onClickTile.bind(this)}]},initialize:function(b){g.UiCore.UiContext.prototype.initialize.call(this,b);this.model=b.model;this.__appMonitor=b.appMonitor;this.__imageManager=b.imageManager;this.__context=b.context||null;this.profileJSON=g.ProfileJSON;this.__loginManager=b.loginManager;this.__activeChat=IMVU.optionalProperty(b,"activeChat",null);this.__window=b.window;b.template&&(this.template=b.template);this.template||(this.template=g.template);this.__isLoggedIn=this.__loginManager.isLoggedIn();this.__ignoreClicks&&this.$el.addClass("ignore-clicks");this.addToDOM();this.$el.removeClass("loading")},__loadImage:function(b){var a=this,c=this.model.get("image")||this.model.node.get("image")||this.model.get("thumbnail_url")||this.model.node.get("thumbnail_url");this.__imageManager.load(this.$(".cover-image"),c,{container:this.$el}).then(function(){a.__appMonitor.waypoint("ProfileListItem::__loadImage - image loaded - title="+a.model.node.get("title")+", img="+c)})["catch"](function(e){a.__appMonitor.reportCustomError("ProfileListItem","__loadImage","web_error_0019","failed to load image",a.__appMonitor.buildErrorArray(e));a.__appMonitor.waypoint("ProfileListItem::__loadImage - reported image load failure - title="+a.model.node.get("title")+", img="+c)})},render:function(){var b=this;this.doWork([function(){return b.model.populated()},function(){b.$el.html(b.template);var a=0<b.$(".profile-info").length?".profile-info":".username",c=0<b.$(".button-container").length;".profile-info"===a&&(b.__dualName=b.createChildContext(g.WAFWidgets.DualName,{$parentElement:b.$(a),user:b.model.node||b.model,configuration:"large-img-small-dual-text-lightbg",useLargeProfile:!0}),c&&(b.__followButton=b.createChildContext(g.WithmeWidgets.FollowButton,{$replaceElement:b.$(".button-container"),profileNode:b.model.node||b.model})));var e=b.model.node||b.model;e.on("change:online",function(){!0===e.get("online")&&(this.__sfxHelper||(this.__sfxHelper=this.__serviceProvider.get("SFXHelper")),this.__sfxHelper&&this.__sfxHelper.playAudio("friend_online"))}.bind(b));b.__loadImage()}]).catch(function(a){404==a.contents.code&&b.$(".disabled-txt").removeClass("hidden")})},__onClickTile:function(b){void 0!==this.model.node.get("type")?this.__user=this.model.node.getSingleEdge("restgraph_entity"):this.__user=this.model.node;this.__ignoreClicks||(b.stopPropagation(),this.__user&&this.__user.populated().then(function(){this.__isLoggedIn?this.__dialogManager.showLightbox("ProfileLightbox",{user:this.__user,activeChat:this.__activeChat}):this.__modeManager.openMode({mode:{id:"av"},submode:{id:this.__user.get("id")}})}.bind(this)))}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],WithmeWidgets:l["@WithmeWidgets"],ProfileJSON:l["json!/common/withme/js/mode/friends/profile.json"],template:mh}),nh=function(g){var b=g.WAFWidgets.EdgeCollectionPresenter;return b.extend("ProfileList",{uiContextName:"profile_list",className:"profile-list",tagName:"section",triggerNextPage:3,dependencies:["globalStringManager","stringManager","window"],initialize:function(a){this.filterModel=a.filterModel;this.globalStringManager=this.stringManager=a.globalStringManager;this.itemFactory=a.itemFactory||g.ProfileListItem;b.prototype.initialize.call(this,a);this.__emptyPlaceholder=IMVU.optionalProperty(a,"emptyPlaceholder",null)},__emptyText:function(){return this.__emptyPlaceholder?{standard:this.stringManager.get(this.__emptyPlaceholder),concise:this.stringManager.get(this.__emptyPlaceholder)}:{standard:this.globalStringManager.get("no_followers"),concise:this.globalStringManager.get("no_search_results_concise")}}})}({UiCore:l["@UiCore"],WAFWidgets:l["@WAFWidgets"],ProfileListItem:db}),oh=function(g){var b=g.UiCore.UiContext;return b.extend("ProfileUserListPresenter",{className:"profile-user-list-presenter",uiContextName:"profile_user_list_presenter",dependencies:["context","globalStringManager","loginManager","node","Promise"],initialize:function(a){b.prototype.initialize.call(this,a);this.__filterModel=this.__serviceProvider.create(g.Model.FilterModel,["filter_text"],{});this.__filterModel.set({limit:50});this.__historySearch=[];this.__scroller=a.scroller;this.collection=this.__node.searchEdgeCollection(this.__context,{limit:50},g.UiCore.EdgeCollection);this.__isLoggedIn=a.loggedIn||this.__loginManager.isLoggedIn();switch(this.__context){case"subscribers":this.__itemFactory=g.ItemFactory;this.__emptyPlaceholder="no_followers";this.__searchPlaceholder="search_followers";break;case"subscriptions":this.__itemFactory=g.ItemFactory;this.__emptyPlaceholder="no_followings";this.__searchPlaceholder="search_followings";break;case"friends":this.__itemFactory=g.FriendsListItem,this.__emptyPlaceholder="no_friends",this.__searchPlaceholder="search_friends"}this.addToDOM()},render:function(){var a=this;this.doWork([function(){a.$el.html(g.template());a.__search=a.createChildContext(g.SearchBox,{$parentElement:a.$(".search-container"),placeholder:a.__searchPlaceholder,model:a.__filterModel,stringManager:a.__globalStringManager});a.doWork([function(){return a.collection.populated()},function(){a.$(".search-container").toggleClass("hidden",0===a.collection.total_count);a.__setAsRendered()}]);a.search();a.listenTo(a.__filterModel,"change",function(){return a.search()})}])},show:function(){this.searchBox&&this.searchBox.setInputToReflectModel();b.prototype.show.call(this)},search:function(){this.collection=this.__node.searchEdgeCollection(this.__context,this.__augmentedQueryParams(),g.UiCore.EdgeCollection);_.contains(this.__historySearch,this.collection.url)||this.__historySearch.push(this.collection.url);this.__refreshUserList()},__refreshUserList:function(){var a=this;this.doWork([function(){a.__list&&a.__list.delete();a.__isLoggedIn&&(a.__list=a.createChildContext(g.ProfileList,{$parentElement:a.$(".profile-user-list-container"),collection:a.collection,stringManager:a.__globalStringManager,itemFactory:a.__itemFactory,emptyPlaceholder:a.__emptyPlaceholder,scroller:a.__scroller}))}])},__isFiltered:function(){var a=this.__filterModel.toQueryParamsMap();delete a.limit;return!_.isEmpty(a)},__augmentedQueryParams:function(){var a=this.__filterModel.toQueryParamsMap();a.sortby="name";a.type="user";a.name_filter&&(a.q=a.name_filter);return a}})}({Model:l["@Model"],UiCore:l["@UiCore"],FriendsListItem:lh,ItemFactory:db,ProfileList:nh,SearchBox:bb,template:jh}),ph=function(g){var b=g.LightboxDialog;return b.extend("ProfileLightbox",{uiContextName:"profile_lightbox",className:"profile-lightbox lightbox-dialog",dependencies:"appMonitor dialogManager globalStringManager historyManager loginManager modeManager platform user".split(" "),trackedEvents:function(){return b.prototype.trackedEvents.call(this).concat([{type:"click",selector:".edit-profile",name:"edit_profile",handler:"__openEditProfileDialog"}])},initialize:function(a){var c=this;b.prototype.initialize.call(this,a);this.__appMonitor=a.appMonitor;this.__user=this.track(a.user);var e=this.__serviceProvider.get("Promise");this.__profileLookResolver=null;this.__profileLookPromise=new e(function(d){this.__profileLookResolver=d}.bind(this));this.doWork([function(){return c.__user.populated()},function(){c.linkToDetailsSubmode("av",c.__user);c.__featureAccessManager.isMobile()&&c.createChildContext(g.Shields,{$replaceElement:c.$(".shields-placeholder"),user:c.__user});c.__historyManager.setState({fragment:c.__user.get("username").replace(/^guest_/i,""),mode:{id:"av"},submode:{id:c.__user.id,summary:{model:c.__user}},replace:!0});c.__isMobile="mobile"===c.__platform;c.__isLoggedIn=!!c.__loginManager.isLoggedIn();c.__isMyself=!1;c.__profileLook=a.profileLook||g.ProfileLook;c.__profileLookResolver.resolve();c.__chatScene=a.chatScene;c.__liveRoomsPhase2Class="transparent-avatar";c.__liveRoomsPhase2BodyClass="has-transparent-avatar-dialog";c.__isLoggedIn&&(c.__myself=c.__loginManager.getCurrentUser(),c.__user.id===c.__myself.id&&(c.__isMyself=!0),c.__activeChat=IMVU.optionalProperty(a,"activeChat",null));c.__isPersona=0!==c.__user.get("persona_type");c.__showEditButton();c.__profileLookPromise.then(function(){this.__setupLightbox()}.bind(c));c.addWidgetToHeadpiece(g.ProfileHeadpiece,{user:c.__user,ignoreClicks:!0});c.__isPersona||(c.__actionBar=c.addWidgetToHeadpiece(g.ProfileActionBar,{user:c.__user,activeChat:c.__activeChat}),c.listenTo(c.__actionBar,"profile:coopWith",c.__echoCoopEvent.bind(c)));c.modeNavSimpleScroller=c.createChildContext(g.SimpleScroller,_.extend({$replaceElement:c.$(".simple-scroller-placeholder"),$target:c.$(".sticky-content .nav-container")}));c.addWidgetToSidebarPanel(g.ProfileAbout,{addCounter:!1,user:c.__user},"about");c.addWidgetToSidebarPanel(g.ProfilePosts,{addCounter:!1,user:c.__user},"posts");c.__isPersona||(c.__profile=c.__user.getSingleEdge("profile"),c.doWork([function(){return c.__profile.populated()},function(){c.__followersCollection=c.__profile.searchEdgeCollection("subscribers",{limit:50},g.UiCore.EdgeCollection);c.__followingsCollection=c.__profile.searchEdgeCollection("subscriptions",{limit:50},g.UiCore.EdgeCollection);c.__followersCollectionSummary=c.__profile.getSummaryCollection("subscribers");c.__followingsCollectionSummary=c.__profile.getSummaryCollection("subscriptions");c.addWidgetToSidebarPanel(g.ProfileUserList,{addCounter:!0,manuallyPage:!1,node:c.__profile,context:"subscribers"},"followers");c.doWork([function(){return c.__followersCollectionSummary.populated()},function(){c.$(".counter-followers").text(g.FormatNumber.formatMini(c.__followersCollectionSummary.total_count,1e4));1===c.__followersCollectionSummary.total_count&&c.$('[data-btn="followers"] .counter-comments-text').text(c.__globalStringManager.get("follower"))}]);c.addWidgetToSidebarPanel(g.ProfileUserList,{addCounter:!0,manuallyPage:!1,node:c.__profile,context:"subscriptions"},"followings");c.doWork([function(){return c.__followingsCollectionSummary.populated()},function(){return c.$(".counter-followings").text(g.FormatNumber.formatMini(c.__followingsCollectionSummary.total_count,1e4))}]);c.__isMyself&&(c.__friendsCollection=c.track(c.__user.searchEdgeCollection("friends",{limit:50,sortby:"name"},g.UiCore.EdgeCollection)),c.addWidgetToSidebarPanel(g.ProfileUserList,{addCounter:!0,manuallyPage:!1,node:c.__user,context:"friends"},"friends"),c.doWork([function(){return c.__friendsCollection.populated()},function(){c.$(".counter-friends").text(g.FormatNumber.formatMini(c.__friendsCollection.total_count,1e4));1===c.__friendsCollection.total_count&&c.$('[data-btn="friends"] .counter-comments-text').text(c.__globalStringManager.get("friend"))}]));c.__isMobile&&c.__showHeader();c.doWork([function(){return c.__followingsCollection.populated()},function(){return c.__avatarConstructedPromise}])}]))}])},refreshSize:function(){b.prototype.refreshSize.call(this);this.__chatScene&&(this.__resetWidth=this.__getCurrentCanvasWidth(),"function"===typeof this.__chatScene.getSession3DAggregate&&null!==this.__chatScene.getSession3DAggregate()&&this.__chatScene.getSession3DAggregate().setCanvasSize(this.__resetWidth+345,this.__window.$(".chat-mode.room-3d-session canvas").height()))},__showEditButton:function(){this.$(".dialog-header").before(g.EditButtonTemplate({}));this.$(".edit-profile").toggleClass("invisible",!this.__isMyself)},__openEditProfileDialog:function(a){a.preventDefault();this.__dialogManager.showDialog(g.EditProfileDialog,{})},__showHeader:function(){this.$(".dialog-title").toggleClass("hidden",!0);this.$(".dialog-title").text(this.__user.get("display_name"));this.$(".dialog-header").prepend(this.$("a.dialog-x"));this.$(".dialog-header").append(this.$("a.edit-profile"));this.showHeader()},__showPanelNav:function(){this.hideHeader();this.$(".headpiece").addClass("has-nav");this.__isPersona&&this.$(".nav-container").addClass("persona-nav");this.$(".nav-container").show()},__echoCoopEvent:function(a){this.trigger("profile:coopWith",this.__user);this.close()},__getCurrentCanvasWidth:function(){var a=this.__window.$(".room-3d-session  .canvas-container").width();if(0>=a||"number"!==typeof a)a=this.__window.innerWidth;return a},__setupLightbox:function(){if(this.__chatScene){this.__resetWidth=this.__getCurrentCanvasWidth();var a=this.__getCurrentCanvasWidth()+345;"function"===typeof this.__chatScene.getSession3DAggregate&&null!==this.__chatScene.getSession3DAggregate()&&this.__chatScene.getSession3DAggregate().setCanvasSize(a,this.__window.$(".chat-mode.room-3d-session canvas").height());this.__window.$(".chat-mode.room-3d-session canvas").attr("width",a).css({"margin-left":"-345px"});document.body.classList.add(this.__liveRoomsPhase2BodyClass);this.__window.$(".dialog-manager").addClass(this.__liveRoomsPhase2Class);this.__window.$(".profile-lightbox.lightbox-dialog").addClass(this.__liveRoomsPhase2Class);this.__window.$(".profile-lightbox.lightbox-dialog .lightbox").addClass(this.__liveRoomsPhase2Class);this.__window.$(".profile-lightbox.lightbox-dialog .lightbox-sidebar").addClass(this.__liveRoomsPhase2Class);this.__avatarConstructedPromise=this.addWidgetToMainContainer(this.__profileLook,{user:this.__user,isColumnView:!1,liveRoomsPhase2torial:!0}).getAddAvatarPromise();this.__window.$(".avatar-container.transparent-avatar").on("click",this.close.bind(this))}else this.__avatarConstructedPromise=this.addWidgetToMainContainer(this.__profileLook,{user:this.__user,isColumnView:!1}).getAddAvatarPromise()},__tearDownLightbox:function(){this.__chatScene&&(this.__window.$(".avatar-container.transparent-avatar").off("click",this.close.bind(this)),this.__window.$(".chat-mode.room-3d-session canvas").attr("width",this.__resetWidth).css({"margin-left":"0"}),document.body.classList.remove(this.__liveRoomsPhase2BodyClass),this.__window.$(".dialog-manager").removeClass(this.__liveRoomsPhase2Class),this.__window.$(".profile-lightbox.lightbox-dialog").removeClass(this.__liveRoomsPhase2Class),this.__window.$(".profile-lightbox.lightbox-dialog .lightbox").removeClass(this.__liveRoomsPhase2Class),this.__window.$(".profile-lightbox.lightbox-dialog .lightbox-sidebar").removeClass(this.__liveRoomsPhase2Class),"function"===typeof this.__chatScene.getSession3DAggregate&&null!==this.__chatScene.getSession3DAggregate()&&this.__chatScene.getSession3DAggregate().setCanvasSize(this.__resetWidth,this.__window.$(".chat-mode.room-3d-session canvas").height()),this.__chatScene.getCurrentPolicyChat()&&this.__chatScene.getCurrentPolicyChat().unfocusOnAvatar())},show:function(){b.prototype.show.call(this);this.__profileLookPromise.then(function(){this.__setupLightbox()}.bind(this))},close:function(){this.hide();b.prototype.close.call(this)},hide:function(){this.__tearDownLightbox();b.prototype.hide.call(this)}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],EditProfileDialog:wg,FormatNumber:r,LightboxDialog:v,ProfileAbout:Zg,ProfileActionBar:Sg,ProfileHeadpiece:ah,ProfileLook:ih,ProfilePosts:qg,ProfileUserList:oh,Shields:cb,SimpleScroller:P,EditButtonTemplate:xg});return{FeedLightbox:gg,FeedTagLightbox:id,InventoryOutfitLightbox:yb,LightboxDialog:v,ProductLightbox:Rd,ProfileLightbox:ph,RoomDetailLightbox:Ha,ShoppingCartLightbox:fd}});