module({"@UiCore":"@UiCore","css!/build/withme/NextUtil.css":"css!/asset/d41d8cd98f00b204/build/withme/NextUtil.css"},function(v){var A=function(){return function(h,c,e,l,a){var d,b,f,g=null,m=0;a||(a={});var k=function(){m=!1===a.leading?0:h.getTime();g=null;f=e.apply(d,b);g||(d=b=null)};return function(){var p=h.getTime();m||!1!==a.leading||(m=p);var n=l-(p-m);d=this;b=arguments;0>=n||n>l?(g&&(h.clearTimeout(g),g=null),m=p,f=e.apply(d,b),g||(d=b=null)):g||!1===a.trailing||(g=h.setTimeout(k,n),c.timeout=g);return f}}}({}),x=function(){return{startsWith:function(h,c,e){return h.substr(e||0,c.length)===c},endsWith:function(h,c,e){if("number"!==typeof e||!isFinite(e)||Math.floor(e)!==e||e>h.length)e=h.length;e-=c.length;h=h.indexOf(c,e);return-1!==h&&h===e},unicodeChars:RegExp("\ud83c[\udffb-\udfff](?=\ud83c[\udffb-\udfff])|(?:[^\ud800-\udfff][̀-ͯ︠-︣⃐-⃰]?|[̀-ͯ︠-︣⃐-⃰]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff])[︎️]?(?:[̀-ͯ︠-︣⃐-⃰]|\ud83c[\udffb-\udfff])?(?:‍(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[︎️]?(?:[̀-ͯ︠-︣⃐-⃰]|\ud83c[\udffb-\udfff])?)*","g"),length:function(h){if("string"!==typeof h)throw Error("ERROR: Must supply a string to check the length");return null===h||0===h.length?0:h.match(this.unicodeChars).length},substring:function(h,c,e){if("string"!==typeof h||"number"!==typeof c||"number"!==typeof e)throw Error("ERROR: An error has occured, please check that you have supplied a string, starting number and ending number.");if(e<c)throw Error("ERROR: The ending number must be larger than the starting number");return h.match(this.unicodeChars).slice(c,e).join("")}}}({}),B=function(){return function(h){return function(c){this.$(h).html(Handlebars.Utils.escapeExpression(c))}}}({}),y=function(h){return{VK_BACKSPACE:8,VK_TAB:9,VK_ENTER:13,VK_CONTROL:17,VK_ESC:27,VK_SPACE:32,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_COMMA:188,wasPressed:function(c,e){return _.contains(e,c.keyCode)},is:function(c,e){if(!(e in this))throw Error("invalid key code: "+e);return c.keyCode===this[e]},getAlphaNumericChar:function(c){c=c.keyCode;if(!(47<c&&58>c||64<c||91>c)||95<c&&106>c)return!1;if(47<c&&58>c)return c-48+"";if(64<c||91>c)return String.fromCharCode(c).toLowerCase();if(95<c&&106>c)return c-96+""}}}({}),E=function(h){var c="top top-right right bottom-right bottom bottom-left left top-left".split(" "),e="Please use one of: "+JSON.stringify(c),l={TRANSITIONEVENT:"transitionend webkitTransitionEnd otransitionend oTransitionEnd MSTransitionEnd",ANIMATIONEVENT:"animationend webkitAnimationEnd oanimationend oAnimationEnd MSAnimationEnd",__toDegree:function(a){if(!_.isString(a)&&!_.isNumber(a))throw Error("direction must be a string or number, got: "+JSON.stringify(a)+". "+e);if(_.isNumber(a))return a;if(-1!==a.indexOf("deg"))return parseInt(a,10);var d=_.indexOf(c,a);if(-1===d)throw Error(JSON.stringify(a)+" is an unknown direction. "+e);return 45*d},__toCssRect:function(a){if(a===window||a===document)a=$("body");if(_.isArray(a))return 4===a.length?{left:a[0],top:a[1],width:a[2],height:a[3]}:{left:a[0],top:a[1],width:0,height:0};if(a.jquery||a.nodeType)return a=$(a)[0].getBoundingClientRect(),{left:a.left,top:a.top,width:a.width,height:a.height};if(_.isObject(a))return _.isNumber(a.width)?{left:a.left,top:a.top,width:a.width,height:a.height}:{left:a.left,top:a.top,width:0,height:0};throw Error("__toCssRect called with ",a,", expected a valid rectangle")},__getRelationalPoint:function(a){var d=this.__toDegree(a.at),b=this.__toCssRect(a.of);a=a.margin||0;b.left-=a;b.top-=a;b.width+=2*a;b.height+=2*a;a=b.left+b.width/2;var f=b.top+b.height/2;d-=90;return{left:Math.min(Math.max(a+Math.floor(b.width*Math.cos(d*Math.PI/180)),b.left),b.left+b.width),top:Math.min(Math.max(f+Math.floor(b.height*Math.sin(d*Math.PI/180)),b.top),b.top+b.height)}},trackDoubleclick:function(a){return this.__doubleclickHelper({selector:a.selector,doubleclickName:a.name,doubleclickHandler:a.handler})},trackClickOrDouble:function(a){IMVU.requireProperty(a,"clickName");IMVU.requireProperty(a,"clickHandler");return this.__doubleclickHelper(a)},__doubleclickHelper:function(a){var d=IMVU.requireProperty(a,"selector"),b=IMVU.requireProperty(a,"doubleclickName"),f=IMVU.requireProperty(a,"doubleclickHandler"),g=IMVU.optionalProperty(a,"clickName",null),m=IMVU.optionalProperty(a,"clickHandler",null),k=null;return{type:"click",selector:d,name:"watching_for_click",handler:function(p){var n=p.currentTarget,r=this.__serviceProvider.get("timer").getTime();k&&k.time>=r-500&&k.target===n?(f.call(this,p),this.__recordEvent("dblclick",{name:b,selector:d}),k.timeout&&this.__serviceProvider.get("timer").clearTimeout(k.timeout),k=null):(k={time:r,target:n},m&&(k.timeout=this.__serviceProvider.get("timer").setTimeout(function(){m.call(this,p);this.__recordEvent("click",{name:g,selector:d});k=null}.bind(this,p),500)))}}},__toDirection:function(a){for(;0>a;)a+=360;for(;360<=a;)a-=360;return c[Math.floor(a/45)]},__getOppositeDirection:function(a){return this.__toDirection(this.__toDegree(a)+180)},__getAttachmentRect:function(a){var d=this.__getRelationalPoint(a),b=this.__getRelationalPoint({at:this.__getOppositeDirection(a.at),of:a.me});return _.extend(this.__toCssRect(a.me),{left:d.left-b.left,top:d.top-b.top})},__attach:function(a){return this.__toCssRect($(a.me).css(this.__getAttachmentRect(a)))},onTransitionEnd:function(a,d,b){var f=function(){b&&a.off(this.TRANSITIONEVENT,f);d()};a.on(this.TRANSITIONEVENT,f)},onAnimationEnd:function(a,d){a.on(this.ANIMATIONEVENT,d)},DEFAULT_TEMPORARY_CLASS_DURATION:333,applyTemporaryClass:function(a,d,b,f){var g=$(d);if(!g.hasClass(b))return g.addClass(b),a.setTimeout(function(){g.removeClass(b)},f||l.DEFAULT_TEMPORARY_CLASS_DURATION)},radioClass:function(a,d){a=$(a);a.addClass(d).siblings().removeClass(d);return a},dismissAllDismissibles:function(){$("[data-dismissible]").each(function(a,d){$(d).trigger("dismiss")})},__dismissibleClickHandler:function(a){var d=$(a.target);d.parents(".tooltip").length||d.parents(".creator-dropdown").length||$("[data-dismissible]").each(function(b,f){b=$(f);b.is('[data-ui-role="popup"]')?!b.is(".pinned")&&this.__shouldDismissPopup(d)&&b.trigger("dismiss"):(f=d.closest(b.data("openerEl")),b.attr("data-nodismissonclickinsider")||b[0]===d[0]||$.contains(b[0],a.target)||f.length||b.trigger("dismiss"))}.bind(this))},__shouldDismissPopup:function(a){for(var d=!1,b=".component-panel .type-selector:not(.active);.component-item:not(.selected);.tabs .panel-tab:not(.selected);.component-list-presenter .header[data-type=material] .new-component;.component-list-presenter .header[data-type=action] .new-component;.component-list-presenter .header[data-type=particle] .new-component".split(";"),f=0;f<b.length&&!(d=a.is(b[f])||0<a.closest(b[f]).length);f++);return d},__dismissibleKeyupHandler:function(a){a.keyCode===h.Keys.VK_ESC&&$("[data-dismissible]").each(function(d,b){$(b).trigger("dismiss")})},dismissibleSetUp:function(){document.addEventListener("click",this.__dismissibleClickHandler.bind(this),!0);$(document).keyup(this.__dismissibleKeyupHandler)},dismissibleTearDown:function(){document.removeEventListener("click",this.__dismissibleClickHandler.bind(this),!0);$(document).off("keyup",this.__dismissibleKeyupHandler)},dismissible:function(a){var d=$(a.openerEl),b=$(IMVU.requireProperty(a,"dismissibleEl")),f=IMVU.requireProperty(a,"dismissHandler");b.attr("data-dismissible","true").on("dismiss",function(g){f(g);return!1});d.length&&b.data("openerEl",d)},enhanceTextarea:function(a,d,b){if(d){var f=$("<div/>").addClass("textarea-limit");a.after(f);a.parent().addClass("textarea-container")}var g=a.height(),m=a.outerHeight()-a.height(),k=a.val(),p=function(){var n=a.val();d&&(h.StringUtil.length(n)>d&&(n=h.StringUtil.length(k)===d?k:n.substr(0,d),a.val(n)),f.text(Math.max(0,d-h.StringUtil.length(n))));a.css({height:g});var r=Math.max(g,a[0].scrollHeight-m);b?a.height(Math.min(b-m,r)):a.height(r);k=n};p();a.on("input refresh",p)},truncateMultilineText:function(a,d,b){b=b||a.parent().height();a.css("height","auto");if(a.height()>b){var f=parseInt(a.css("line-height"),10);a.css("height",Math.floor(b-b%f));d.show()}},squarify:function(a){var d=$(a.me),b=$(a.within),f=Math.min(b.width(),b.height());f&&(0<a.shrink&&(f=0<f-a.shrink?f-a.shrink:0),b=f,a.isHalfWidth&&(b/=2),d.width(b).height(f))},goLinkHandler:function(a,d){var b=$(d.target).closest("a");if(b.length&&(b=b.attr("href"))&&(0===b.indexOf("https://go.imvu.com/")||0===b.indexOf("http://go.imvu.com/"))){d.preventDefault();b=new URL(b);d=b.pathname;b=b.hash.replace(/#/gm,"");""===b&&0===d.search("/store/")&&(b=d.substring(7),d="/store");0===d.search("/featured-event/")&&(a.get("window").location="https://imvu.com"+d);var f="/next"+d+(""!==b?"/"+b:""),g={};"/store"===d&&""!==b&&(g.showAlways=!0);var m=a.get("acceptedDollarStorePermaLinkProducts");"/store"===d&&m.includes(b)?a.get("window").location=f:a.get("modeManager").openModeFromPath(f,g)}},goLinkSetUp:function(a){document.addEventListener("click",l.goLinkHandler.bind(l,a),!0)},createGUID:function(){var a=window.crypto.getRandomValues(new Uint8Array(32));return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(d){return(d^((a=a.slice(1))&&a[0])&15>>d/4).toString(16)})},createLinkClickingHandler:function(a){function d(q){var t=_.rest(q.pathname.split("/"));return _.contains(C,q.hostname)&&1<t.length&&"next"===t[0]&&0<t[1].length}function b(q){return"go.imvu.com"===q.hostname}function f(q){return!_.contains(D,q.hostname)}function g(){return z.getBool("alloy.external_link_warnings.suppressed",!1)}function m(){z.setBool("alloy.external_link_warnings.suppressed",!0)}var k=IMVU.requireProperty(a,"dialogManager"),p=IMVU.requireProperty(a,"featureAccessManager"),n=IMVU.requireProperty(a,"globalStringManager"),r=IMVU.requireProperty(a,"modeManager"),z=IMVU.requireProperty(a,"prefsManager"),w=IMVU.requireProperty(a,"window"),D="imvu.com www.imvu.com secure.imvu.com avatars.imvu.com im.vu localhost.imvu.com help.imvu.com go.imvu.com about.imvu.com".split(" "),C=["imvu.com","www.imvu.com","secure.imvu.com","localhost.imvu.com"];return{isNextMode:d,isGoLink:b,isExternalLink:f,isExternalLinkWarningSuppressed:g,suppressExternalLinkWarnings:m,handler:function(q){if(d(q.target))if(q.preventDefault(),p.isElectronClient()&&q.target.pathname.includes("download")){var t=q.target.href;w.electronRequire("electron").shell.openExternal(t)}else r.openModeFromPath(q.target.pathname);else b(q.target)?q.preventDefault():f(q.target)&&!g()&&(q.preventDefault(),k.confirm({title:n.get("visit_link_title"),text:n.get("visit_link_text"),checkbox:n.get("visit_link_checkbox"),checkedByDefault:!1,yes:n.get("OK"),no:n.get("Cancel")}).finished.then(function(u){u.checked&&m();u=q.target.href;p.isElectronClient()?w.electronRequire("electron").shell.openExternal(u):w.open(u,"_blank")}))}}}};return l}({Keys:y,StringUtil:x}),F=function(){function h(e,l,a){return(((1-3*a+3*l)*e+(3*a-6*l))*e+3*l)*e}var c="function"===typeof Float32Array;return function(e,l,a,d){if(!(0<=e&&1>=e&&0<=a&&1>=a))throw Error("bezier x values must be in [0, 1] range");var b=c?new Float32Array(11):Array(11);if(e!==l||a!==d)for(var f=0;11>f;++f)b[f]=h(.1*f,e,a);return function(g){if(e===l&&a===d)return g;if(0===g)return 0;if(1===g)return 1;for(var m=0,k=1;10!==k&&b[k]<=g;++k)m+=.1;--k;k=m+(g-b[k])/(b[k+1]-b[k])*.1;var p=3*(1-3*a+3*e)*k*k+2*(3*a-6*e)*k+3*e;if(.001<=p){for(m=0;4>m;++m){p=3*(1-3*a+3*e)*k*k+2*(3*a-6*e)*k+3*e;if(0===p)break;var n=h(k,e,a)-g;k-=n/p}g=k}else if(0===p)g=k;else{k=m;m+=.1;p=0;do{n=k+(m-k)/2;var r=h(n,e,a)-g;0<r?m=n:k=n}while(1e-7<Math.abs(r)&&10>++p);g=n}return h(g,l,d)}}}({});v=function(h){return{favorite:function(c){var e=IMVU.requireProperty(c,"serviceProvider"),l=IMVU.requireProperty(c,"user");c=IMVU.requireProperty(c,"room");e=e.get("Promise");return"inventory"===c.get("type")?e.reject({errorMessageTitleKey:"Room is Private",errorMessageTextKey:"You cannot favorite a private room"}):l.getEdgeCollection("favorite_rooms").create({id:c.id}).then(function(){return{isFavorite:!0}})},unfavorite:function(c){IMVU.requireProperty(c,"serviceProvider");IMVU.requireProperty(c,"user");return IMVU.requireProperty(c,"room").getSingleEdge("viewer_favorite_room",h.UiCore.EdgeModel).destroy().then(function(){return{isFavorite:!1}})},toggleFavorite:function(c){var e=c.isFavorite;return this.isFavorite(c).then(function(l){void 0===e&&(e=!l);return e?this.favorite(c):this.unfavorite(c)}.bind(this))},isFavorite:function(c){var e=IMVU.requireProperty(c,"room");return e.populated().then(function(){return!!e.relations.viewer_favorite_room})},handlePatchErrors:function(c){var e=IMVU.requireProperty(c,"roomModel"),l=IMVU.requireProperty(c,"error"),a=IMVU.requireProperty(c,"xhr"),d=IMVU.requireProperty(c,"options"),b=IMVU.requireProperty(c,"globalStringManager"),f=IMVU.requireProperty(c,"errorToasterManager");IMVU.requireProperty(c,"window");e.invalidate();e=b.getWithDefault("ERROR."+l.error,"unknown");"unknown"!==e?f.add(e):(f.add(b.get("default_room_error")),c.window.console.error(l.error,l.message,a,d))},newEditPromise:function(c){var e=IMVU.requireProperty(c,"roomModel"),l=IMVU.requireProperty(c,"globalStringManager"),a=IMVU.requireProperty(c,"errorToasterManager"),d=IMVU.requireProperty(c,"setup");IMVU.requireProperty(c,"window");IMVU.requireProperty(c,"Promise");return new c.Promise(function(b){var f=d();f.length?e.patch(f,{success:function(){b.resolve()}.bind(this),error:function(g,m,k){"ROOM-NODE-018"!==g.error&&this.handlePatchErrors({roomModel:e,globalStringManager:l,errorToasterManager:a,window:c.window,error:g,xhr:m,options:k});b.reject(g)}.bind(this)}):b.resolve()}.bind(this))},hasJoined:function(c){var e=IMVU.requireProperty(c,"user"),l=IMVU.requireProperty(c,"room");IMVU.requireProperty(c,"Promise");var a,d=new c.Promise(function(b){a=b});if(!e)return a.resolve(!1),d;c.Promise.every([e.populated(),l.populated()]).then(function(){l.relations.chat?l.getSingleEdge("chat").populated().then(function(b){return b.getEdgeCollection("participants").populated()}).then(function(b){var f=!1;b.each(function(g){g.node===e&&(f=!0)});a.resolve(f)}):a.resolve(!1)});return d}}}({UiCore:v["@UiCore"]});var G=function(){return function(h){return function(c){return function(){c.call(this,arguments[h-1])}}}}({});return function(h){return _.extend(h,{mirrorModelChange:function(c){return h.nthArg(2).call(this,h.hbEscape(c))}})}({BezierEasing:F,DomHelper:E,hbEscape:B,Keys:y,nthArg:G,RoomUtil:v,string:x,throttle:A})});