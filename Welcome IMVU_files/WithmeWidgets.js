module({"json!/common/withme/i18n/settings.json":"json!/asset/6de7917171955166/common/withme/i18n/settings.json","@Dialogs":"@Dialogs","json!/common/js/JSON/States.json":"json!/asset/581385bf78983508/common/js/JSON/States.json","@NextUtil":"@NextUtil","json!/common/js/JSON/LanguageMap.json":"json!/asset/58eb7a4b19ab9746/common/js/JSON/LanguageMap.json","json!/common/js/JSON/Provinces.json":"json!/asset/1e80a06c565197b7/common/js/JSON/Provinces.json","json!@StoreModeDictionary":"json!@StoreModeDictionary","@Model":"@Model","json!/common/js/JSON/RoomsOccupancy.json":"json!/asset/18a4ecdf13f29bb8/common/js/JSON/RoomsOccupancy.json","json!/common/js/JSON/PPCCountries.json":"json!/asset/cb7303d250cfc7c9/common/js/JSON/PPCCountries.json","@UiCore":"@UiCore","json!/common/js/JSON/Countries.json":"json!/asset/82bbf3f0be07c92d/common/js/JSON/Countries.json","json!/common/js/JSON/PPCValue.json":"json!/asset/997927575664224c/common/js/JSON/PPCValue.json","json!/common/js/JSON/SortOptions.json":"json!/asset/aca7abe6ed7a2d4e/common/js/JSON/SortOptions.json","json!/common/js/JSON/ProductPricing.json":"json!/asset/f47409f4768bae3d/common/js/JSON/ProductPricing.json","@moment":"@moment","css!/build/withme/WithmeWidgets.css":"css!/asset/ec8e19dd64aa6e0d/build/withme/WithmeWidgets.css"},function(l){var K=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression;return'<span class="following-txt">'+g((c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Following",{name:"i18n-g",hash:{},data:e})))+'</span><span class="follow-txt">'+g((c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Follow",{name:"i18n-g",hash:{},data:e})))+"</span>"},useData:!0})}({}),L=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;return'<div class="icon-container"></div>\r\n<div class="unfollow-txt">Unfollow '+d((c=a.displayName||b&&b.displayName,"function"===typeof c?c.call(b,{name:"displayName",hash:{},data:e}):c))+" (@"+d((c=a.userName||b&&b.userName,"function"===typeof c?c.call(b,{name:"userName",hash:{},data:e}):c))+")?</div>"},useData:!0})}({}),M=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d="\n        ";if((a=(c=a.silhouetteHtml||b&&b.silhouetteHtml,"function"===typeof c?c.call(b,{name:"silhouetteHtml",hash:{},data:e}):c))||0===a)d+=a;return d+"\n    "},3:function(b,a,d,e){return'\n        <img src="/common/withme/img/loading_avatar.png">\n    '},5:function(b,a,d,e){var c;d=this.escapeExpression;return'\n            <div class="number-actor-mask"></div>\n            <div class="number-actor">'+d((c=a.numberOfActor||b&&b.numberOfActor,"function"===typeof c?c.call(b,{name:"numberOfActor",hash:{},data:e}):c))+"</div>\n    "},7:function(b,a,d,e){return'\n<div class="online-status"></div>\n'},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d='<a class="profile-icon-image">\n    ';var c=a["if"].call(b,b&&b.showSilhouette,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(c||0===c)d+=c;d+="\n    ";if((c=a["if"].call(b,b&&b.isMultipleActor,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n</a>\n";if((c=a["if"].call(b,b&&b.showOnlineStatus,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"\n"},useData:!0})}({}),N=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c,g=a.helperMissing;d='<div class="bg-granite color-pumice">\n    ';if((a=(c=a.icon||b&&b.icon||g,c.call(b,"icon-avatar_default_150x150",{name:"icon",hash:{},data:e})))||0===a)d+=a;return d+"\n</div>\n"},useData:!0})}({}),y=function(k){var b=k.UiCore.UiContext,a=/\/s\d+x\d+\//;return b.extend("ProfileIcon",{className:"profile-icon new-profile-icon",uiContextName:"profile_icon",dependencies:"dialogManager featureAccessManager globalStringManager imageManager loginManager modeManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:"",name:"profile_icon_click",handler:this.__onClick.bind(this),allowBubble:!0}]},initialize:function(d){var e=this;b.prototype.initialize.call(this,d);this.__feedType=d.feedType;this.__openContext=d.openContext;this.__isLoggedIn=this.__loginManager.isLoggedIn();this.__activeChat=IMVU.optionalProperty(d,"activeChat",null);this.__ignoreClicks="undefined"!==typeof d.ignoreClicks?!!d.ignoreClicks:!this.__loginManager.isLoggedIn();this.__showErrorView=!!d.showErrorView;this.__numberOfActor=IMVU.optionalProperty(d,"numberOfActor",1);this.__useExtraLargeProfile=IMVU.optionalProperty(d,"useExtraLargeProfile",!1);this.__useLargeProfile=IMVU.optionalProperty(d,"useLargeProfile",!1);this.__useSmallProfile=IMVU.optionalProperty(d,"useSmallProfile",!1);this.__forceStaticImage=d.forceStaticImage;this.__chatScene=d.chatScene;d.ignoreClicks&&this.$el.addClass("ignore-clicks");this.__useLargeProfile&&this.$el.addClass("large-profile");this.__useSmallProfile&&this.$el.addClass("small-profile");this.__useExtraLargeProfile&&this.$el.addClass("extra-large-profile");_.has(d,"user")?this.doWork([function(){e.__user=e.track(d.user,["online"],1800);return e.__user.populated()},function(){e.__profile=e.track((e.__user.node||e.__user).getSingleEdge("profile"),[],1800);e.addToDOM()}]).catch(function(c){e.__showSilhouette=!0;e.addToDOM()}):(this.__profile=this.track(IMVU.requireProperty(d,"profile")),this.addToDOM());this.__isMe=!1},render:function(){var d=this;this.$el.html(k.template({numberOfActor:this.__numberOfActor,isMultipleActor:1<this.__numberOfActor,showSilhouette:this.__showSilhouette,silhouetteHtml:k.avatarSilhouetteTemplate(),showOnlineStatus:!this.__useSmallProfile}));this.__showSilhouette||this.doWork([function(){return d.__profile.populated()},function(){return d.__getUser().populated()},function(){d.$(".online-status").toggleClass("is-online",d.__user.get("online")&&1==d.__numberOfActor);d.__loginManager.isLoggedIn()&&(d.__isMe=d.__profile.relations.restgraph_entity===d.__loginManager.getCurrentUser().id,d.__isMe&&(d.__user=d.__loginManager.getCurrentUser(),d.listenTo(d.__user,"change:availability",d.__refreshOnlineOnMyAvailability,d)));var e=d.__profile.get("avatar_name");e=_.isNull(e)||_.isUndefined(e)?"":e.replace("Guest_","");d.$el.attr("title",e);d.__refreshThumbnailUrl();d.__refreshOnline();d.listenTo(d.__user,"change:online",d.__refreshOnline);d.listenTo(d.__profile,"change:image",d.__refreshThumbnailUrl);d.listenTo(d.__user,"change",function(){this.__profile.invalidate()});d.__setAsRendered()}]).catch(function(){d.__showErrorView&&(d.__ignoreClicks=!0,d.$el.html("...").addClass("ignore-clicks"));d.__setAsRenderFailed("ProfileIcon::render - failed")})},__getUser:function(){this.__user||(this.__user=this.__profile.getSingleEdge("restgraph_entity"));return this.__user},__refreshOnline:function(){1==this.__numberOfActor&&(this.__isMe?this.$(".online-status").toggleClass("is-online",!!this.__user.get("online")&&!0===this.__profileShowOnlineIndicator()):this.$(".online-status").toggleClass("is-online",!!this.__user.get("online")))},__disabledUserAlert:function(){this.__dialogManager.alert({title:this.__globalStringManager.get("dialog_inactive_user_profile_icon_click_error")})},__onClick:function(d){var e=this;this.__ignoreClicks||(d.stopPropagation(),this.__profile?this.doWork([function(){return e.__profile.populated()},function(){return e.__getUser().populated()},function(){e.__isLoggedIn?(e.__chatScene&&e.__chatScene.__policyChat.focusOnAvatar(e.__user.get("legacy_cid").toString(),!0),e.__myself=e.__loginManager.getCurrentUser(),e.__myself.populated().then(function(){var c=this;if(this.__chatScene&&this.__user!==this.__myself||!this.__chatScene){this.__chatScene&&"shopTogether"===this.__chatScene.getType()&&this.__chatScene.toggleShopTogetherLeftSlidein(!1);var g=this.__dialogManager.showLightbox("ProfileLightbox",{user:this.__user,activeChat:this.__activeChat,chatScene:this.__chatScene});this.__chatScene&&"shopTogether"===this.__chatScene.getType()&&g.finished.catch(function(){c.__chatScene.toggleShopTogetherLeftSlidein(!0)});this.listenTo(g,"profile:coopWith",function(f){this.__activeChat.triggerEvent("profile:coopWith",f)}.bind(this))}}.bind(e))):(e.__window.console.log("ProfileIcon::__onClick - directing click to user perma link"),e.__modeManager.openMode({mode:{id:"av"},submode:{id:e.__user.get("id")}}))}]).catch(this.__disabledUserAlert.bind(this)):this.__disabledUserAlert())},tuneFidelity:function(d){var e=30;this.__useSmallProfile?e=16:this.__useLargeProfile?e=50:this.__useExtraLargeProfile&&(e=75);e*=Math.max(2,window.devicePixelRatio);d.startsWith("https://userimages-akm.imvu.com")?d="https://webasset-akm.imvu.com/resized_image/duserimages/s"+e+"x"+e+"/tmaintain_aspect_ratio/i"+encodeURIComponent(d.replace("https://userimages-akm.imvu.com","")):d.match(a)&&(d=d.replace(a,"/s"+e+"x"+e+"/"));return d},__refreshThumbnailUrl:function(){var d=this;this.doWork([function(){d.__profile.get("image")||d.__profile.invalidate();return d.__profile.populated()},function(){d.__imageManager.load(d.$("img"),d.tuneFidelity(d.__profile.get("image")),{forceStaticImage:d.__forceStaticImage}).catch(function(e){d.__showSilhouette=!0;d.render()})}]).catch(function(e){d.__showSilhouette=!0;d.render()})},__refreshOnlineOnMyAvailability:function(){1==this.__numberOfActor&&this.$(".online-status").toggleClass("is-online",this.__profileShowOnlineIndicator())},__profileShowOnlineIndicator:function(){return this.__user.get("online")?"DoNotDisturb"===this.__user.get("availability")?!1:"Available"===this.__user.get("availability")||""===this.__user.get("availability")?!0:!1:!1}})}({UiCore:l["@UiCore"],avatarSilhouetteTemplate:N,template:M}),O=function(k){var b=k.Dialogs.AlloyConfirmDialog;return b.extend("unfollowDialog",{uiContextName:"unfollow_dialog",className:"unfollow-dialog",dependencies:["globalStringManager","modeManager"],initialize:function(a){this.__perfStartTime=a.perfStartTime;this.hasCloseButton=!1;this.__stringManager=a.globalStringManager;this.__profile=a.profile;a.yes=this.__stringManager.get("Unfollow");a.no=this.__stringManager.get("Cancel");this.__profile.populated().then(function(){a.html=k.template({userName:this.__profile.attributes.avatar_name.replace(/^guest_/i,""),displayName:this.__profile.attributes.title})}.bind(this));b.prototype.initialize.call(this,a)},postRender:function(){b.prototype.postRender.call(this);this.__profileIcon=this.createChildContext(k.ProfileIcon,{$parentElement:this.$(".icon-container"),user:this.__profile.getSingleEdge("restgraph_entity"),modeManager:this.__modeManager})}})}({Dialogs:l["@Dialogs"],Model:l["@Model"],UiCore:l["@UiCore"],ProfileIcon:y,template:L}),P=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c,g=a.helperMissing;d='\n    <div class="label label-fb">\n        <a class="btn btn-fb id-fb">';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"continue_with_facebook",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</a>\n    </div>\n"},3:function(b,a,d,e){var c;a=this.escapeExpression;return"\n        <a class='px-5 language language-"+a((c=b&&b.code,"function"===typeof c?c.apply(b):c))+"' data-code='"+a((c=b&&b.code,"function"===typeof c?c.apply(b):c))+"' href=\""+a((c=b&&b.url,"function"===typeof c?c.apply(b):c))+'">'+a((c=b&&b.name,"function"===typeof c?c.apply(b):c))+"</a>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='<form name="login_form" method="GET" action="#" class="login">\n    <div class="label login_avatarname label-first" data-holder="',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"welcome_dialog_username_placeholder",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+='">\n        <input type="text" tabindex="1" name="avatarname" placeholder=\'';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"welcome_dialog_username_placeholder",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='\'  autocapitalize="none" autocorrect="off" autocomplete="off" spellcheck="false" value="'+g((c=a.username||b&&b.username,"function"===typeof c?c.call(b,{name:"username",hash:{},data:e}):c))+'" />\n    </div>\n    <div class="label login_password label-second" data-holder="';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"welcome_dialog_password_placeholder",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='">\n        <div style="position:relative">\n            <input tabindex="1" type="password" name="password" placeholder=\'';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"welcome_dialog_password_placeholder",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='\'/>\n            <div class="toggle-password-visibility icon icon-password-show"></div>\n        </div>\n    </div>\n\n    <label class="submit">\n        <div class="error-message-container">\n            <div class="error-message try-again-later">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_try_again_later_error",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message try-again-later-server-load">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_try_again_later_error_server_load",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message client-2fa-not-supported">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_client_2fa_not_supported",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message credentials">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_credentials_error",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message disabled">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_disabled_error",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message unknown">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_unknown_login_error",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message 2fa-email-sent-rate-limit">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_2fa_email_sent_rate_limit",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message wrong-code-rate-limit">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_wrong_code_rate_limit",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n        </div>\n    </label>\n\n    <div class="label label-forgot">\n        <a data-external class="forgot-password-link" href="'+g((c=a.forgotPasswordUrl||b&&b.forgotPasswordUrl,"function"===typeof c?c.call(b,{name:"forgotPasswordUrl",hash:{},data:e}):c))+'">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_forgot_credentials",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</a>\n    </div>\n    <div class="label label-log-in">\n        <button class="btn btn-primary" >';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_signin_button",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</button>\n    </div>\n    <div class="label label-or">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_or",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n        <div class="label label-apple">\n            <a class="btn btn-apple id-apple">Continue with Apple</a>\n        </div>\n';if((h=a["if"].call(b,b&&b.showFBButton,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n\n    <div class="label signup">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"welcome_dialog_no_account",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='&nbsp;<a class="id-signup">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"welcome_dialog_signup",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</a></div>\n    <div class="label need-help">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_need_help",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='<a data-external href="https://help.imvu.com/">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_help_center",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</a></div>\n\n    <div class="label languages flex items-center justify-center">\n        <a class=\'px-5 language current_language language-'+g((h=(h=b&&b.currentLocale,null==h||!1===h?h:h.code),"function"===typeof h?h.apply(b):h))+"' data-code='"+g((h=b&&b.code,"function"===typeof h?h.apply(b):h))+"' href=\""+g((h=(h=b&&b.currentLocale,null==h||!1===h?h:h.url),"function"===typeof h?h.apply(b):h))+'">'+g((h=(h=b&&b.currentLocale,null==h||!1===h?h:h.name),"function"===typeof h?h.apply(b):h))+"</a>\n        ";if((h=a.each.call(b,b&&b.otherLocales,{name:"each",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n        <div class="px-5 inline-block more-locales right text-charcoal cursor-pointer">\n            <div class="w-25 h-18">\n                ';if((h=(c=a.icon||b&&b.icon||d,c.call(b,"icon-action_more",{name:"icon",hash:{class:"wh-full"},data:e})))||0===h)f+=h;f+='\n            </div>\n        </div>\n    </div>\n\n    <p class="app-store-buttons text-spacing">\n        <a data-external href="https://itunes.apple.com/us/app/imvu-mobile/id919745844?mt=8" class="ios-button" target="_blank">\n            ';if((h=(c=a.icon||b&&b.icon||d,c.call(b,"icon-app-store",{name:"icon",hash:{},data:e})))||0===h)f+=h;f+='\n        </a>\n        <a data-external href="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova" class="last android-button" target="_blank">\n            ';if((h=(c=a.icon||b&&b.icon||d,c.call(b,"icon-google-play",{name:"icon",hash:{},data:e})))||0===h)f+=h;f+='\n        </a>\n    </p>\n\n    <p class="privacy-agreements">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_privacy_agreements_description",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='<a target="_blank" href="'+g((c=a.policyHubUrl||b&&b.policyHubUrl,"function"===typeof c?c.call(b,{name:"policyHubUrl",hash:{},data:e}):c))+'">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_terms_of_conditions",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</a><a target="_blank" href="'+g((c=a.arbitrationAgreementUrl||b&&b.arbitrationAgreementUrl,"function"===typeof c?c.call(b,{name:"arbitrationAgreementUrl",hash:{},data:e}):c))+'">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_arbitration_agreement",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</a>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login__dialog_privacy_agreements_and",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='<a target="_blank" href="'+g((c=a.privacyPolicyUrl||b&&b.privacyPolicyUrl,"function"===typeof c?c.call(b,{name:"privacyPolicyUrl",hash:{},data:e}):c))+'">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_privacy_policy",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"</a></p>\n</form>\n"},useData:!0})}({}),Q=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return"show-label"},3:function(b,a,d,e){var c;return(a=(c=a.defaultLabel||b&&b.defaultLabel,"function"===typeof c?c.call(b,{name:"defaultLabel",hash:{},data:e}):c))||0===a?a:""},5:function(b,a,d,e){return"&nbsp"},7:function(b,a,d,e){var c;return(a=(c=a.content||b&&b.content,"function"===typeof c?c.call(b,{name:"content",hash:{},data:e}):c))||0===a?a:""},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d='<div class="holder-label">\n    <div class="info ';var c=a["if"].call(b,b&&b.defaultLabel,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(c||0===c)d+=c;d+='">';if((c=a["if"].call(b,b&&b.defaultLabel,{name:"if",hash:{},fn:this.program(3,e),inverse:this.program(5,e),data:e}))||0===c)d+=c;d+='</div>\n    <div class="content">';if((c=a["if"].call(b,b&&b.content,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"</div>\n</div>\n"},useData:!0})}({}),R=function(k){Handlebars.registerPartial("InputMixinHolderLabel",k.HolderLabelTemplate);return{dependencies:[],trackedEvents:function(){return[{type:"focus",selector:".label[data-holder] input",name:"focus_input",handler:"__onHolderInputFocus"},{type:"blur",selector:".label[data-holder] input",name:"blur_input",handler:"__onHolderInputBlur"}]},initialize:function(){this.render=function(b){return function(){b.apply(this,arguments);this.__insertLabelTemplate(this.$(".label[data-holder]"))}}(this.render)},__insertLabelTemplate:function(b){b=(b instanceof $?b:this.$(b)).not(":has(>.holder-label)");b.prepend(k.HolderLabelTemplate());b.filter("[data-dropdown]").each(function(a,d){this.__setInputLabelMsg(d,$(d).attr("data-holder"))}.bind(this))},__onHolderInputFocus:function(b){b=$(b.currentTarget);b.attr("placeholder","");b=b.closest(".label[data-holder]").removeClass("error");this.__insertLabelTemplate(b);b.find(">.holder-label >.info").html(b.attr("data-holder")).addClass("show-label")},__onHolderInputBlur:function(b){b=$(b.currentTarget);if(!b.val()){var a=b.closest(".label[data-holder]");b.attr("placeholder",a.attr("data-holder"));a.hasClass("error")||a.find(">.holder-label >.info").html("&nbsp;").removeClass("show-label")}},__clearError:function(b){b=$(b).closest(".label[data-holder]").removeClass("error");var a=b.find("input");!a[0]||a.val()?this.__setInputLabelMsg(b,b.attr("data-holder")):(a.attr("placeholder",b.attr("data-holder")),b.find(">.holder-label >.info").html("&nbsp;").removeClass("show-label"))},__setInputLabelMsg:function(b,a){b=b instanceof $?b:this.$(b);b.find(">.holder-label >.info").html(a).toggleClass("show-label",!!b.attr("data-holder")||b.hasClass("error"))},__setInputErrorLabelMsg:function(b,a){this.__setInputLabelMsg(this.$(b).addClass("error"),a)}}}({UiCore:l["@UiCore"],HolderLabelTemplate:Q}),S=function(k){return k.UiCore.RestCollection.extend("PrefCollection",{model:k.UiCore.EdgeModel})}({UiCore:l["@UiCore"]}),T=function(k){return IMVU.BaseClass.extend("PrefsManager",{dependencies:["loginManager","Promise","rest"],initialize:function(b){this.Promise=b.Promise;this.rest=b.rest;this.__pendingSets={};var a=b.userModel||b.loginManager.getCurrent().getSingleEdge("user");this.__populated=a.populated().then(function(){var d=this.Promise.resolve();a.relations&&a.relations.preferences||(a.invalidate(),d=a.populated());return d.then(function(){return a.getEdgeCollection("preferences",k.PrefCollection)})}.bind(this)).then(function(d){this.collection=d;return d.populated()}.bind(this)).then(function(){this.collection.on("change",this.__cleanPendingSet.bind(this))}.bind(this))},__cleanPendingSet:function(b){var a=b.get("name");b=b.get("value");this.__pendingSets[a]===b&&delete this.__pendingSets[a]},populated:function(){return this.__populated},__ensurePopulated:function(){if("pending"===this.__populated.state)throw Error("Cannot perform preference operation until preferences are populated")},get:function(b,a){this.__ensurePopulated();if(this.__pendingSets[b])return this.__pendingSets[b];for(var d=0;d<this.collection.length;d++){var e=this.collection.at(d);if(e.get("name")===b)return e.get("value")}return a},getBool:function(b,a){b=this.get(b,null);return _.isNull(b)?a:!!parseInt(b,10)},getInt:function(b,a){b=this.get(b,null);return _.isNull(b)?a:parseInt(b,10)},setBool:function(b,a){return this.set(b,a?"1":"0")},setInt:function(b,a){return this.set(b,String(a))},set:function(b,a){this.__ensurePopulated();if("string"!==typeof a)throw Error("Tried to set pref with non-string value: "+typeof a);if(this.get(b)===a)return new this.Promise(function(d){d.accept()});this.__pendingSets[b]=a;a=this.rest.post(this.collection.url,{id:"/preferences/preference-"+b,data:{value:a}});a.catch(function(){delete this.__pendingSets[b]}.bind(this));return a}})}({UiCore:l["@UiCore"],PrefCollection:S}),U=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="copy-body">\n    ',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_pending_guardian_approval_1",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+="\n    ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_pending_guardian_approval_2",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n    ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_pending_guardian_approval_3",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='\n    <a href="https://help.imvu.com" target="_blank">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Help Center",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='.</a></div>\n</div>\n<div class="privacy-policy-link"><a href="https://secure.imvu.com/next/policyhub/privacypolicy/">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"view_privacy_policy",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</a></div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary full-width">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"close pending policy",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</button>\n<\/script>\n\n"},useData:!0})}({}),V=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("TooltipDialog",{uiContextName:"tooltip_dialog",className:"tooltip-dialog dialog-type-B text-close",trackedEvents:function(){return this.__customTrackedEvents},initialize:function(a){this.__customTrackedEvents=a.trackedEvents||[];b.prototype.initialize.call(this,a);this.title=a.title;this.__tooltipContent=a.tooltipContent;this.addToDOM()},postRender:function(){this.setContent("body",this.__tooltipContent)}})}({Dialogs:l["@Dialogs"]}),r=function(k){var b=k.UiCore.UiContext;return b.extend("Tooltip",{className:"tooltip",uiContextName:"tooltip",dependencies:["dialogManager","timer","tooltipLayer","window"],trackedEvents:function(){return[{type:"click",selector:"a",name:"link_click",handler:"__clickedLink",allowBubble:!0}].concat(this.__customTrackedEvents)},__installTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.on("mouseenter.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.$target.off("mouseleave.tooltip")}.bind(this));this.__tooltipLayer.$el.on("mouseleave.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__tooltipTimeout);this.__tooltipTimeout=this.__timer.setTimeout(function(){this.setVisible(!1);this.__timer.clearTimeout(this.__tooltipTimeout);this.__tooltipTimeout=this.__timer.setTimeout(function(){this.__hide();this.__installTargetMouseleave()}.bind(this),125)}.bind(this),250)}.bind(this))},__removeTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.off(".tooltip")},initialize:function(a){this.$tooltip=IMVU.requireProperty(a,"$replaceElement");this.$target=IMVU.requireProperty(a,"$tooltipTarget");this.tooltipTitle=IMVU.optionalProperty(a,"title",!1);this.__tooltipStyle=IMVU.optionalProperty(a,"tooltipStyle","default");this.__tooltipPosition=IMVU.optionalProperty(a,"tooltipPosition","default");this.__positionDelta=IMVU.optionalProperty(a,"positionDelta",0);this.__forceTargetToUseOuterWidth=IMVU.optionalProperty(a,"forceTargetToUseOuterWidth",!1);this.__customTrackedEvents=a.trackedEvents||[];b.prototype.initialize.call(this,a);this.$body=$("body");this.$globalNav=$("nav.global-nav:visible");if("mobile"===this.__serviceProvider.get("platform"))this.$target.on("click.tooltip",function(d){d.stopPropagation();this.__openTooltipDialog()}.bind(this));else this.$target.on("mouseenter.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.__timer.clearTimeout(this.__targetFadeinTimeout);this.__installTargetMouseleave();this.__targetFadeinTimeout=this.__timer.setTimeout(function(){this.setVisible(!0);this.__show()}.bind(this),250)}.bind(this));"snug"===this.__tooltipStyle&&this.$el.addClass("tooltip-snug");this.$el.append(this.$tooltip);this.setParentUiContext(this.__tooltipLayer);this.__tooltipLayer.$el.append(this.$el);this.__setAsRendered()},setVisible:function(a){this.$el.toggleClass("tooltip-open",!!a)},__installTargetMouseleave:function(){this.$target.on("mouseleave.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__targetTimeout=this.__timer.setTimeout(function(){this.setVisible(!1);this.__timer.clearTimeout(this.__targetTimeout);this.__targetTimeout=this.__timer.setTimeout(function(){this.__hide()}.bind(this),125)}.bind(this),250)}.bind(this))},__show:function(){this.__installTooltipLayerEventHandlers();this.__trackTooltip();$(this.__window).on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this));this.$body.find(".transparent-overlay").on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this))},trackTooltip:function(){this.__trackTooltip()},__trackTooltip:function(){var a=this.$globalNav.height()||0,d=this.$target[0].getBoundingClientRect().top,e=this.$target[0].getBoundingClientRect().left,c=$(window).width()-(e+this.$target.outerWidth()/2),g=this.$el[0].offsetWidth;0<this.$target.parents(".dialog-manager").length&&(a=0);var f=this.$target.width();this.__forceTargetToUseOuterWidth&&(f=this.$target.outerWidth());c=c>g?e+f/2:e+f/2-g;"bottom"===this.__tooltipPosition?(c=e-this.$tooltip.outerWidth()/2,d=this.$target[0].getBoundingClientRect().bottom-this.__positionDelta):"above"===this.__tooltipPosition?(c=e+f/2-g,d=this.$target[0].getBoundingClientRect().top-this.$el[0].offsetHeight):"left"===this.__tooltipPosition?(c=e-f-g-this.__positionDelta,d=this.$target[0].getBoundingClientRect().top):"bottom-left-edge"===this.__tooltipPosition&&(c=e,d=0);this.$el.css({"margin-top":Math.max(d,a),"margin-left":c})},__hide:function(){this.__removeTooltipLayerEventHandlers();this.setVisible(!1)},__openTooltipDialog:function(){return this.__dialogManager.showDialog(k.TooltipDialog,{title:this.tooltipTitle||this.$target.text(),tooltipContent:this.$tooltip.html(),trackedEvents:this.__customTrackedEvents})},delete:function(){this.$el.removeAttr("style");this.__timer.clearTimeout(this.__targetFadeinTimeout);this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.$target.off(".tooltip");this.__removeTooltipLayerEventHandlers();$(this.__window).off("scroll.tooltip");this.$body.find(".transparent-overlay").off("scroll.tooltip");b.prototype.delete.call(this)},__clickedLink:function(a){this.__hide()}})}({UiCore:l["@UiCore"],TooltipDialog:V}),W=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("PrivacyPolicyMinorsPendingDialog",{uiContextName:"privacy_policy_minors_pending_dialog",className:"privacy-policy-minors-pending-dialog dialog-type-B",dependencies:["cookieManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_adult_okay",handler:"__onClose"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("privacy_pending_guardian_approval_title");this.addToDOM();this.$(".dialog-x").remove()},postRender:function(){this.setContent("body",k.template,{});this.setContent("footer",this.$(".dialog-footer-template").text())},__onClose:function(a){b.prototype.__onClose.call(this,a)}})}({Dialogs:l["@Dialogs"],Tooltip:r,template:U}),X=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="copy-body">\n    ',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_adult_dialog_body_1",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='\n    <a href="https://secure.imvu.com/next/policyhub/gdprconsent/" class="tooltip-target">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_adult_dialog_body_2",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</a>\n    ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_adult_dialog_body_3",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='\n    <a href="https://secure.imvu.com/next/policyhub/privacypolicy/" target="_blank">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_adult_dialog_body_4",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</a>\n    ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_adult_dialog_body_5",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n    <br>\n    ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_adult_dialog_body_6",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='\n\n    <div class="accept-button">\n        <button class="btn btn-primary accept-cookies">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"accept all cookies",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+'</button>\n    </div> \n</div>\n\n\n<div class="tooltip-content cookie-tooltip">\n    <div class="tooltip-body">\n        To give you the best possible experience, personalize content and ads, this site uses Cookies. Continuing to use the site you agree we may place these cookies on your device. You can view our Privacy Policy for more details.\n\n        <div class="tooltip-header">Strictly Necessary Cookies:</div>\n            <div>These cookies are necessary for the website to function and cannot be switched off in our systems. </div>\n            <ul>\n                <li>prefer_alloy - Used to determine if you see IMVU Next or Core.</li>\n                <li>alloy_landing_cookie - Used to determine if you see IMVU Next or Core.</li>\n                <li>in_ux - Assigned to a "unique user" experiment.</li>\n                <li>osCsid - Session cookie; required for login to function.</li>\n            </ul>\n        <div class="tooltip-header">Performance Cookies:</div>\n            <div>These cookies allow us to count visits and traffic sources, so we can measure and improve the performance of our site. They help us know which pages are the most and least popular and see how visitors move around the site.</div>\n            <ul>\n                <li>browser_session - Tracks statistics about your IMVU session.</li>\n                <li>window_session - Tracks statistics about a specific IMVU window.</li>\n                <li>Targeting Cookies</li>\n                <li>These cookies are set through our site by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant ads on other sites. They work by uniquely identifying your browser and device.</li>\n                <li>login_interstitial_seen - tracks the last time you saw an interstitial, for aggregate analytics purposes.</li>\n                <li>sncd - Tracks CIDs you have logged into, for detecting if a new account is an alt.</li>\n                <li>nunu - Tracks if we believe you are a new new user.</li>\n                <li>preLogID - Used to connect incoming users with their subsequent login or registration.</li>\n                <li>imvua - Tracks which acquisition partner you came from.</li>\n                <li>datetime_entered - Tracks when you first landed on our site.</li>\n                <li>linkshare_site_id - If acquired through a specific partner, tracks which ad you followed.</li>\n                <li>lpip - Stores the IP you hit a landing page with.</li>\n            </ul>\n        <div class="tooltip-header">Presentation Cookies:</div>\n            <div>These cookies are set to help enhance your experience and for example, allow us to show you IMVU in the language of your choice.</div>\n            <ul>\n                <li>imvu_avnm - stores your avatarname for display purposes.</li>\n                <li>saved_locale - stores which language you prefer to see IMVU in.</li>\n            </ul>\n        <div class="tooltip-header">Third Party Partners:</div>\n            <div>We also have third party partners who may set cookies including this list below:</div>\n            <ul>\n                <li>Amazon</li>\n                <li>Doubleverify</li>\n                <li>Facebook</li>\n                <li>Google</li>\n                <li>Peanutlabs</li>\n                <li>Revenue Universe</li>\n                <li>AppNexus</li>\n                <li>Google Analytics</li>\n                <li>Threat Metrix</li>​\n            </ul>\n    </div>\n</div>'},useData:!0})}({}),Y=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("PrivacyPolicyAdultDialog",{uiContextName:"privacy_policy_adult_dialog",className:"privacy-policy-adult-dialog dialog-type-B",dependencies:["cookieManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:".accept-button",name:"submit_privacy_policy_adult_okay",handler:"__onClose"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("privacy_policy_adult_dialog_title");this.isUncancellableDialog=!0;this.addToDOM();this.$(".dialog-x").remove()},postRender:function(){this.setContent("body",k.template,{});this.tooltip=this.createChildContext(k.Tooltip,{$replaceElement:this.$(".tooltip-content"),$tooltipTarget:this.$(".tooltip-target")});this.tooltip.$el.addClass("tooltip-wide")},__onClose:function(a){this.__cookieManager.set("accepted_all_cookies","true");b.prototype.__onClose.call(this,a)}})}({Dialogs:l["@Dialogs"],Tooltip:r,template:X}),Z=function(k){var b=k.UiCore.UiContext;return b.extend("ContextMenu",{uiContextName:"context_menu",tagName:"ul",className:"context-menu",trackedEvents:function(){return[{type:"click",selector:"li",name:"context_menu_item",handler:"__chooseMenuItem",attributes:function(a){return{which:a.attr("data-menu-item")}}}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__items=IMVU.requireProperty(a,"items");this.location=IMVU.requireProperty(a,"location");this.mouseMargin=IMVU.optionalProperty(a,"mouseMargin","");this.__showCaret=IMVU.optionalProperty(a,"showCaret",!1);this.__isChatStreamProfileMenu=IMVU.optionalProperty(a,"chatStreamProfile",null);this.__closeOnScroll=void 0!==a.closeOnScroll?a.closeOnScroll:!0;this.addToDOM()},render:function(){_.each(this.__items,function(a){var d=$("<li />");d.attr("data-menu-item",a.name).text(a.text).addClass(a.classNames).toggleClass("divider",!!a.divider);_.has(a,"title")&&_.isString(a.title)&&d.attr("title",a.title);this.$el.append(d)}.bind(this));this.__showCaret&&(this.__isChatStreamProfileMenu?($('<div class="caret"></div>').insertAfter(".context-menu li:first-of-type"),this.$(".caret").css({bottom:82,left:-16})):this.$el.append('<div class="caret"></div>'))},__chooseMenuItem:function(a){var d=$(a.currentTarget).data("menu-item"),e=_.find(this.__items,function(c){return c.name===d}).handler;e&&e.call(this,a);this.trigger("item-chosen")},shouldCloseOnScroll:function(){return!this.__closeOnScroll}})}({UiCore:l["@UiCore"]}),aa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="content">\n    <div class="privacy-policy-minors-body">',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_dialog_body",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='</div>\n    <div class="privacy-policy-minors-form">\n        <div class="privacy-policy-minors-form-title">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_dialog_form_title",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</div>\n        <div class="fieldset">\n            <label>';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Name",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</label>\n            <input type="text" class="privacy-policy-minors-avatarname full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"your name",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</label>\n            <input type="text" class="privacy-policy-minors-name full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"email address",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="<span> (";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_email_note",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+=')</span></label>\n            <input type="text" class="privacy-policy-minors-email full-width"></input>\n            <div class="input-error"></div>\n        </div>\n        <div class="fieldset">\n            <label>';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_guardian_name",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</label>\n            <input type="text" class="privacy-policy-minors-guardian-name full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_guardian_email",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</label>\n            <input type="text" class="privacy-policy-minors-guardian-email full-width"></input>\n            <div class="input-note">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_guardian_email_note",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</div>\n            <div class="input-error"></div>\n        </div>\n    </div>\n    <div class="privacy-policy-link"><a href="https://secure.imvu.com/next/policyhub/privacypolicy/">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"view_privacy_policy",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</a></div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary minors-guardian-form-submit full-width disabled">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"submit",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</button>\n<\/script>"},useData:!0})}({}),ba=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g="<div>\n    <p>",f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_guardian_dialog_body_1",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+="</p>\n    <p>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_guardian_dialog_body_2",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</p>\n</div>\n<div class="privacy-policy-link"><a href="https://secure.imvu.com/next/policyhub/privacypolicy/">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"view_privacy_policy",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</a></div>\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary ok full-width">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"OK",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</button>\n<\/script>"},useData:!0})}({}),ca=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("PrivacyPolicyMinorsGuardianDialog",{uiContextName:"privacy_policy_minors_guardian_dialog",className:"privacy-policy-minors-guardian-dialog dialog-type-B",dependencies:["globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_minors_okay",handler:"__onClose"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("privacy_policy_minors_guardian_dialog_title");this.addToDOM()},postRender:function(){this.setContent("body",k.template,{});this.setContent("footer",this.$(".dialog-footer-template").text())}})}({Dialogs:l["@Dialogs"],template:ba}),da=function(k){return{validateEmail:function(b){return/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,3}$/.test(b)}}}({}),ea=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("PrivacyPolicyMinorsDialog",{uiContextName:"privacy_policy_minors_dialog",className:"privacy-policy-minors-dialog dialog-type-B",dependencies:["dialogManager","globalStringManager","rest"],trackedEvents:function(){return[{type:"keyup",selector:"input.privacy-policy-minors-avatarname",name:"change_avatarname",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-name",name:"change_username",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-email",name:"change_email",handler:"__validateMinorsEmail"},{type:"keyup",selector:"input.privacy-policy-minors-guardian-name",name:"change_guardian_name",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-guardian-email",name:"change_guardian_email",handler:"__validateGuardiansEmail"},{type:"click",selector:"button",name:"submit_privacy_policy_minors_form",handler:"__submit"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__GUARDIAN_VERIFICATION_URL=this.__serviceProvider.get("root")+"/guardian_verification";this.title=this.__globalStringManager.get("privacy_policy_minors_dialog_title");this.__formValidator=k.FormValidator;this.addToDOM();this.$(".dialog-x").remove();this.__hasError=!1},postRender:function(){this.setContent("body",k.template,{});this.setContent("footer",this.$(".dialog-footer-template").text());this.$(".content").scrollbar()},__toggleButton:function(){var a=!1;this.$("input").each(function(e){$(this).val()||(a=!0)});var d=this.__minorsEmailError||this.__guardiansEmailError;this.$(".minors-guardian-form-submit").toggleClass("disabled",a||d)},__validateMinorsEmail:function(a){this.__minorsEmailError=!1;var d=$(a.currentTarget);a=d.siblings(".input-error");a.text("");d=this.__validateEmail(d.val());null!==d&&(this.__minorsEmailError=!0,a.text(d));this.__toggleButton()},__validateGuardiansEmail:function(a){this.__guardiansEmailError=!1;a=$(a.currentTarget);a.siblings(".input-note").toggleClass("hidden",!1);var d=a.siblings(".input-error");d.text("");var e=this.__validateEmail(a.val());null===e&&this.$("input.privacy-policy-minors-email").val()===this.$("input.privacy-policy-minors-guardian-email").val()&&(e=this.__globalStringManager.get("privacy_policy_minors_guardian_email_note"));null!==e&&(this.__guardiansEmailError=!0,d.text(e),a.siblings(".input-note").toggleClass("hidden",!0));this.__toggleButton()},__validateEmail:function(a){return a?this.__formValidator.validateEmail(a)?null:this.__globalStringManager.get("error_message_email_invalide_format"):this.__globalStringManager.get("error_message_email_empty")},__submit:function(a){this.__rest.post(this.__GUARDIAN_VERIFICATION_URL,{avatarname:this.$("input.privacy-policy-minors-avatarname").val(),user_name:this.$("input.privacy-policy-minors-name").val(),user_email:this.$("input.privacy-policy-minors-email").val(),guardian_name:this.$("input.privacy-policy-minors-guardian-name").val(),guardian_email:this.$("input.privacy-policy-minors-guardian-email").val()}).then(function(d){});this.__onClose(a);this.__dialogManager.showDialog(k.PrivacyPolicyMinorsGuardianDialog)}})}({Dialogs:l["@Dialogs"],FormValidator:da,PrivacyPolicyMinorsGuardianDialog:ca,template:aa}),fa=function(k){return{mixin:function(){var b=$jscomp.getRestArguments.apply(0,arguments),a=b[0],d=[],e=function(){for(var f=$jscomp.getRestArguments.apply(0,arguments),h=d.length;0<h--;)d[h].apply(this,f)},c=[],g=function(){for(var f=$jscomp.getRestArguments.apply(0,arguments),h=[],m=c.length;0<m--;)h=h.concat(c[m].apply(this,f));return h};_.each(b,function(f){f.initialize&&d.push(f.initialize);f.trackedEvents&&c.push(f.trackedEvents);if(f!==a){var h=a.dependencies||[];_.each(f.dependencies,function(m){-1===_.indexOf(h,m)&&h.push(m)});h.sort();_.extend(a,f,{dependencies:h})}});d.length&&(a.initialize=1<d.length?e:d[0]);c.length&&(a.trackedEvents=1<c.length?g:c[0]);return a}}}({}),ha=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("LoginDialog",k.Mixin.mixin({uiContextName:"login_dialog",className:"login-dialog dialog-type-B-flexible",dependencies:"browserInfo contextMenuManager cookieManager counterHelper dialogManager featureAccessManager globalStringManager googleAnalytics localStorage loginManager modeManager prefsManager Promise restModelFactory urlManager window".split(" "),trackedEvents:function(){return[{type:"submit",selector:"form.login",name:"login",handler:"__onLogin"},{type:"click",selector:".id-signup",name:"signup",handler:"__onClickSignup"},{type:"click",selector:".id-fb",name:"fb_login",handler:this.__onClickFB},{type:"click",selector:".id-apple",name:"apple_login",handler:"__onClickApple"},{type:"click",selector:".toggle-password-visibility",name:"toggle_password_visibility",handler:"__togglePasswordVisibility"},{type:"click",selector:".forgot-password-link",name:"forgot_password",handler:"__forgotPassword"},{type:"click",selector:".language",name:"language",handler:this.__changeLanguage},{type:"click",selector:".more-locales",name:"more_locales",handler:this.__showMoreLocalesMenu}]},initialize:function(a){this.__browserInfo=a.browserInfo;this.title=a.globalStringManager.get("welcome_login_dialog_signin");"undefined"!==typeof a.globalStringManager&&(this.__globalStringManager=a.globalStringManager);this.hasCloseButton=_.isUndefined(a.hasCloseButton)?!0:a.hasCloseButton;this.__loginMode=a.loginMode;b.prototype.initialize.call(this,a);this.__loginCookieName=this.__serviceProvider.get("loginCookieName");this.__cookieManager=this.__serviceProvider.get("cookieManager");this.__hasSignupButton=_.isUndefined(a.hasSignupButton)?!0:a.hasSignupButton;this.__loginUsername=this.__cookieManager.get("login_username")?this.__cookieManager.get("login_username"):"";this.__refreshOnLogin=a.refreshOnLogin||"mobile"===this.__serviceProvider.get("platform");this.__loginDestination=a.loginDestination?this.__getLoginDestination(a.loginDestination):null;this.__contextMenuManager=a.contextMenuManager;this.shouldFocusOnPrimaryButton=!1;this.__socialLogin=this.__loginManager.getSocialLogin();this.__socialLogin.checkLoginState();(this.__hadSocialLogin=this.__socialLogin.hadEverLoggedIn())&&this.__socialLogin.logout();(a=this.__serviceProvider.get("currentLocale"))&&"en"!=a||(a="www");var d=this.__serviceProvider.get("locales");this.__currentLocaleInfo=void 0;this.__otherLocaleInfo=[];this.__remainderLocaleInfo=[];var e=0;d=$jscomp.makeIterator(d);for(var c=d.next();!c.done;c=d.next())(c=c.value)&&c.url&&(c.url=decodeURIComponent(c.url)),c.code==a?this.__currentLocaleInfo=c:2>e&&-1!=["es","pt","www"].indexOf(c.code)?(this.__otherLocaleInfo.push(c),++e):this.__remainderLocaleInfo.push(c);a=this.__serviceProvider.get("siteRoot").replace("welcome/","").replace("next/","");this.__featureAccessManager.isElectronClient()&&(a="https://secure.imvu.com/");this.__forgotPasswordUrl=a+"welcome/forgotpassword/";this.addToDOM()},postRender:function(){this.__loginUsername="undefined"===typeof this.__loginUsername?"":this.__loginUsername;this.__loginUsername="undefined"===this.__loginUsername?"":this.__loginUsername;this.__loginUsername=null===this.__loginUsername?"":this.__loginUsername;this.__showFBButton=this.__featureAccessManager.canSeeFacebookLogin();this.setContent("body",k.template,{username:this.__loginUsername,forgotPasswordUrl:this.__forgotPasswordUrl,currentLocale:this.__currentLocaleInfo,otherLocales:this.__otherLocaleInfo,canSeeAppleSignIn:this.__featureAccessManager.canSeeAppleSignIn(),policyHubUrl:this.__urlManager.get("policy_hub"),arbitrationAgreementUrl:this.__urlManager.get("arbitration_agreement"),privacyPolicyUrl:this.__urlManager.get("privacy_policy"),showFBButton:this.__showFBButton});this.$(".login_avatarname input").focus();this.__loginUsername&&this.$(".login_password input").focus();this.$(".login").toggleClass("can-signup",this.__hasSignupButton);if(this.__loginUsername){var a=this.$('input[name="avatarname"]').closest(".label[data-holder]");this.__insertLabelTemplate(a);if(a.hasClass("ignore-placeholder-behavior"))return;a.find(">.holder-label >.info").html(a.attr("data-holder"))}this.__counterHelper.increment("welcome_login_dialog")},__showMoreLocalesMenu:function(a){a.preventDefault();for(var d=[],e={},c=$jscomp.makeIterator(this.__remainderLocaleInfo),g=c.next();!g.done;e={$jscomp$loop$prop$localeInfo$3:e.$jscomp$loop$prop$localeInfo$3},g=c.next())e.$jscomp$loop$prop$localeInfo$3=g.value,d.push({name:e.$jscomp$loop$prop$localeInfo$3.code,text:e.$jscomp$loop$prop$localeInfo$3.name,handler:function(f){return function(){var h=f.$jscomp$loop$prop$localeInfo$3.code;if(this.__featureAccessManager.isElectronClient())this.__localStorage.setItem("lang",h),this.__window.location.reload();else{""===h?this.__cookieManager.clear("saved_locale"):this.__cookieManager.set("saved_locale",h);var m=new URL(this.__window.location.href);3<m.host.split(".").length&&(m.host=m.host.split(".").splice(1).join("."));m.host=[h,m.host].join(".");this.__window.location.href=m}}}(e).bind(this)});this.__contextMenuManager.showMenu(a,k.ContextMenu,{items:d,displayOptions:{above:!0,right:!0}})},__changeLanguage:function(a){a.preventDefault();var d=a.target.getAttribute("data-code");this.__featureAccessManager.isElectronClient()?(this.__localStorage.setItem("lang",d),this.__window.location.reload()):(""===d?this.__cookieManager.clear("saved_locale"):this.__cookieManager.set("saved_locale",d),this.__window.location.href=a.target.getAttribute("href"))},__onLogin:function(a){null!==a&&a.preventDefault();a="true"===this.__cookieManager.get("accepted_all_cookies")?!0:!1;var d={username:this.$('[name="avatarname"]').val(),password:this.$('[name="password"]').val(),gdpr_cookie_acceptance:a};this.$("label.submit").addClass("loading");this.__loginManager.performLoginFromCredentials(this.__serviceProvider,d).then(function(e){this.__googleAnalytics.recordSuccessfulAuthentication("true");this.$("label.submit").removeClass("loading");this.$(".error-message").removeClass("active").css("height","");this.__cookieManager.set(this.__loginCookieName,"true");this.__cookieManager.set("prefer_alloy","1");this.__cookieManager.set("login_username",d.username);this.__cookieManager.set("password_changed","0");var c=this.__restModelFactory.readModel(e.relations.user,k.UiCore.NodeModel);c.relations&&c.relations.preferences||c.invalidate();c.populated().then(function(){c.get("is_on_hold")?this.__dialogManager.alert({title:this.__globalStringManager.get("welcome_login_banned_user_title"),text:this.__globalStringManager.get("welcome_login_banned_user_text")}).finished.then(function(){this.hide();this.__featureAccessManager.isElectronClient()?(this.__externalWindow=this.__serviceProvider.get("externalWindow"),this.__externalWindow.newElectronWindow({width:1024,height:768}).loadURL("https://help.imvu.com/s/contactus"),this.__onLoginContinue(c)):this.__window.location="https://help.imvu.com/s/contactus"}.bind(this)):this.__onLoginContinue(c)}.bind(this))}.bind(this),function(e){var c="credentials";e===this.__loginManager.ERROR_TRY_AGAIN_LATER?c="try-again-later":e===this.__loginManager.ERROR_DISABLED?c="disabled":e===this.__loginManager.ERROR_UNDERAGE||e===this.__loginManager.ERROR_COOKIE_UNACCEPT||e===this.__loginManager.ERROR_UNDERAGE_PENDING_CONSENT?(c="disabled",this.__showPrivacyPolicyDialog(e)):e===this.__loginManager.ERROR_EXCESSIVE_SERVER_LOAD?c="try-again-later-server-load":e===this.__loginManager.ERROR_CODE_EMAIL_RATE_LIMIT?c="2fa-email-sent-rate-limit":e===this.__loginManager.ERROR_WRONG_CODE_RATE_LIMIT?c="wrong-code-rate-limit":e===this.__loginManager.ERROR_CLIENT_2FA_NOT_SUPPORTED&&(c="client-2fa-not-supported");k.NextUtil.DomHelper.radioClass(this.$(".error-message."+c),"active");e=this.$(".error-message.active").height();this.$(".error-message.active").css("height",0);this.$("label.submit").removeClass("loading");this.$(".error-message.active").height();this.$(".error-message.active").css("height",e)}.bind(this))},__onLoginContinue:function(a){var d=this,e=this.__Promise.resolve();this.__featureAccessManager.isElectronClient()&&(e=new this.__Promise(function(c){d.__LoggedInPrefsManager=d.__serviceProvider.create(k.LoggedInPrefsManager,{userModel:a});d.__LoggedInPrefsManager.populated().then(function(){this.__LoggedInPrefsManager.setBool("next.has_signed_onto_client",!0);c.resolve()}.bind(d)).catch(function(g){window.console.error("Unable to save next.has_signed_onto_client",g);c.resolve()})}));e.then(function(){var c=new URL(d.__window.location.href).searchParams;c&&c.get("next")?(c=c.get("next"),d.__window.location.href=decodeURIComponent(c)):d.__loginDestination?d.__window.location.href=decodeURIComponent(d.__loginDestination):d.__loginManager.getLoginDestination()?d.__window.location.href=d.__loginManager.getLoginDestination():d.__serviceProvider.services.overrideMode&&"ftux"!==d.__serviceProvider.services.overrideMode?(c=d.__serviceProvider.get("siteRoot"),c+=d.__serviceProvider.get("startMode")+"/",d.__serviceProvider.services.startSubmode&&(c+=d.__urlId(d.serviceProvider.get("startSubmode"))+"/"),d.__window.location.href=c):d.__refreshOnLogin?d.__window.location.reload():a.populated().then(function(){return a.getEdgeCollection("preferences",k.UiCore.RestCollection)}.bind(d)).then(function(g){this.__prefs=g;return this.__prefs.populated()}.bind(d)).then(function(){for(var g=!1,f=0;f<this.__prefs.length;f++){var h=this.__prefs.at(f);"registered_through_alloy"!==h.get("name")&&"registered_through_mobile"!==h.get("name")&&"pure_mobile_access"!==h.get("name")||!h.get("value")||(g=!0,this.__window.location.reload())}g||(this.__window.location.href="/switch_to/classic/")}.bind(d))})},__onClickSignup:function(a){a.preventDefault();this.__googleAnalytics.recordSignUpClick("login");this.promiseResolver.resolve("signup");if("iOS"===this.__browserInfo.getMobileOS())this.__window.location="itms-apps://itunes.apple.com/us/app/imvu/id919745844?mt=8";else if("Android"===this.__browserInfo.getMobileOS())this.__window.location="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova";else if((a=new URL(this.__window.location.href).searchParams)&&a.get("next")){var d=a.get("next");a=null!==this.__window.location.host.match(/localhost\.imvu\.com$/)===!0?new URL("https://localhost.imvu.com/welcome/ftux/gender/"):new URL("https://secure.imvu.com/welcome/ftux/gender/");a.searchParams.append("next",d);this.__window.open(a,"_self")}else this.__window.location="/welcome/ftux/gender/"},__redirectToFtux:function(){this.$el.fadeOut(300,function(){this.__modeManager.openMode({mode:{id:"ftux"},submode:{id:"gender"}})}.bind(this))},__onClickCta:function(){"mobile"===this.__serviceProvider.get("platform")?"iOS"===this.__browserInfo.getMobileOS()?this.__window.location="itms-apps://itunes.apple.com/us/app/imvu/id919745844?mt=8":"Android"===this.__browserInfo.getMobileOS()?this.__window.location="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova":this.__window.location="https://about.imvu.com/mobile/":this.__redirectToFtux()},__onClickFB:function(){var a=this;"mobile"===this.__serviceProvider.get("platform")?this.__socialLogin.fbSDKLogin(this.__imvuLoginCallback.bind(this),function(){a.__dialogManager.confirm({title:a.__globalStringManager.get("ftux_frontpage_get_the_app"),text:a.__globalStringManager.get("ftux_frontpage_best_mobile_experience"),yes:a.__globalStringManager.get("ftux_frontpage_get_the_app_yes_btn"),no:a.__globalStringManager.get("ftux_frontpage_get_the_app_cancel_btn")}).finished.then(function(){this.__onClickCta()}.bind(a))}):this.__featureAccessManager.isElectronClient()?this.__window.navigator.onLine?this.__socialLogin.fbOauthLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this)):this.__dialogManager.alert({title:this.__globalStringManager.get("generic_offline_error_title"),text:this.__globalStringManager.get("generic_offline_error_message")}):this.__socialLogin.fbSDKLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this))},__onClickApple:function(){var a=this;"mobile"===this.__serviceProvider.get("platform")?this.__socialLogin.appleSDKLogin(this.__imvuLoginCallback.bind(this),function(){a.__dialogManager.confirm({title:a.__globalStringManager.get("ftux_frontpage_get_the_app"),text:a.__globalStringManager.get("ftux_frontpage_best_mobile_experience"),yes:a.__globalStringManager.get("ftux_frontpage_get_the_app_yes_btn"),no:a.__globalStringManager.get("ftux_frontpage_get_the_app_cancel_btn")}).finished.then(function(){this.__onClickCta()}.bind(a))},this.__appleErrorCallback.bind(this)):this.__featureAccessManager.isElectronClient()?this.__window.navigator.onLine?this.__socialLogin.appleOauthLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this),this.__appleErrorCallback.bind(this)):this.__dialogManager.alert({title:this.__globalStringManager.get("generic_offline_error_title"),text:this.__globalStringManager.get("generic_offline_error_message")}):this.__socialLogin.appleSDKLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this),this.__appleErrorCallback.bind(this))},__imvuLoginCallback:function(){var a=new URL(this.__window.location.href).searchParams;a&&a.get("next")?(a=a.get("next"),this.__window.location.href=decodeURIComponent(a)):this.__loginDestination?this.__window.location.href=decodeURIComponent(this.__loginDestination):this.__loginManager.getLoginDestination()?this.__window.location.href=this.__loginManager.getLoginDestination():this.__serviceProvider.services.overrideMode&&"ftux"!==this.__serviceProvider.services.overrideMode?(a=this.__serviceProvider.get("siteRoot"),a+=this.__serviceProvider.get("startMode")+"/",this.__serviceProvider.services.startSubmode&&(a+=this.__urlId(this.serviceProvider.get("startSubmode"))+"/"),this.__window.location.href=a):this.__window.location.reload()},__appleErrorCallback:function(a){var d=this.__globalStringManager.get("Error"),e=this.__globalStringManager.get("login_dialog_unknown_login_error");"user-disabled"===a?e=this.__globalStringManager.get("login_dialog_disabled_error"):"user-velocity"===a?e=this.__globalStringManager.get("login_dialog_try_again_later_error"):"user-service"===a&&(e=this.__globalStringManager.get("login_dialog_try_again_later_error_server_load"));this.__dialogManager.alert({title:d,text:e})},__togglePasswordVisibility:function(){var a=this.$(".login_password input"),d="password"==a.attr("type");a[0].setAttribute("type",d?"text":"password");this.$(".toggle-password-visibility").toggleClass("icon-password-show",!d).toggleClass("icon-password-hide",d);a.focus()},__forgotPassword:function(){this.__featureAccessManager.isElectronClient()||(this.__window.location=this.__forgotPasswordUrl)},__showPrivacyPolicyDialog:function(a){var d=k.PrivacyPolicyAdultDialog;a===this.__loginManager.ERROR_UNDERAGE?d=k.PrivacyPolicyMinorsDialog:a===this.__loginManager.ERROR_UNDERAGE_PENDING_CONSENT&&(d=k.PrivacyPolicyMinorsPendingDialog);return this.__dialogManager.showDialog(d)},__getLoginDestination:function(a){for(var d=["logoff"],e=0;e<d.length;e++)if(-1<a.indexOf(d[e])){a="/next";break}return a}},k.InputMixin))}({Dialogs:l["@Dialogs"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],ContextMenu:Z,InputMixin:R,LoggedInPrefsManager:T,Mixin:fa,PrivacyPolicyAdultDialog:Y,PrivacyPolicyMinorsDialog:ea,PrivacyPolicyMinorsPendingDialog:W,template:P}),ia=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d='\n<div class="id-body-contents">';if((a=(c=a.html||b&&b.html,"function"===typeof c?c.call(b,{name:"html",hash:{},data:e}):c))||0===a)d+=a;return d+"</div>\n"},3:function(b,a,d,e){var c;d=this.escapeExpression;return'\n<p class="id-body-contents">'+d((c=a.text||b&&b.text,"function"===typeof c?c.call(b,{name:"text",hash:{},data:e}):c))+"</p>\n"},5:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='\n<p class="terms-of-service">\n    <span>',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"dialog_for_your_reference_terms_of_service",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+=' <a data-external href="'+g((c=a.policyHubUrl||b&&b.policyHubUrl,"function"===typeof c?c.call(b,{name:"policyHubUrl",hash:{},data:e}):c))+'" target="_blank">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Terms of Service",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"</a>.</span>\n</p>\n"},7:function(b,a,d,e){var c;d=this.escapeExpression;var g='\n<div class="dialog-checkbox-container">\n    <input id="dialog-checkbox" type="checkbox" class="checkbox" ',f=a["if"].call(b,b&&b.checkedByDefault,{name:"if",hash:{},fn:this.program(8,e),inverse:this.noop,data:e});if(f||0===f)g+=f;return g+'><label for="dialog-checkbox">'+d((c=a.checkbox||b&&b.checkbox,"function"===typeof c?c.call(b,{name:"checkbox",hash:{},data:e}):c))+"</label>\n</div>\n"},8:function(b,a,d,e){return"checked"},10:function(b,a,d,e){d='\n<div class="dialog-dropdown-container">\n    <select id="dialog-dropdown">\n        ';var c=a["if"].call(b,(c=b&&b.dropdown,null==c||!1===c?c:c.placeholder),{name:"if",hash:{},fn:this.program(11,e),inverse:this.noop,data:e});if(c||0===c)d+=c;return d+"\n    </select>\n</div>\n"},11:function(b,a,d,e){var c;a=this.escapeExpression;return'\n        <option class="dropdown-placeholder" value="" disabled selected>'+a((c=(c=b&&b.dropdown,null==c||!1===c?c:c.placeholder),"function"===typeof c?c.apply(b):c))+"</option>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;var g="",f=a["if"].call(b,b&&b.html,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(f||0===f)g+=f;g+="\n\n";if((f=a["if"].call(b,b&&b.termsOfService,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n\n";if((f=a["if"].call(b,b&&b.checkbox,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n\n";if((f=a["if"].call(b,b&&b.dropdown,{name:"if",hash:{},fn:this.program(10,e),inverse:this.noop,data:e}))||0===f)g+=f;return g+'\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary btn-dark" data-confirm="ok" disabled>'+d((c=a.ok||b&&b.ok,"function"===typeof c?c.call(b,{name:"ok",hash:{},data:e}):c))+"</button>\n<\/script>\n"},useData:!0})}({}),ja=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){return'<div class="dropdown-label is-truncated"><span>&nbsp;</span></div>\n<div class="dropdown-option-list-container">\n    <div class="dropdown-scroll-up"></div>\n    <div class="dropdown-scroll-down"></div>\n    <ul class="dropdown-option-list">\n        <li class="dropdown-option is-truncated" data-value="" tabindex="-1"></li>\n    </ul>\n</div>\n'},useData:!0})}({}),v=function(k){function b(e){e=$(e.target).closest(".dropdown");$(".dropdown").not(e).each(function(c,g){$(g).data("dropdown-instance").__hide()})}var a=k.UiCore.UiContext,d=k.NextUtil.Keys;return a.extend("Dropdown",{globalSetup:function(){document.addEventListener("click",b,!0);document.addEventListener("touchend",b,!0)},globalTearDown:function(){document.removeEventListener("click",b,!0);document.removeEventListener("touchend",b,!0)},uiContextName:"dropdown",className:"dropdown disable-text-selection",ITEM_HEIGHT:40,AUTO_SCROLL_BY:2,dependencies:["timer","window"],trackedEvents:function(){return[{type:"click",selector:".dropdown-label",name:"dropdown_label_click",handler:"toggleOpen"},{type:"click",selector:".dropdown-option",name:"dropdown_option_click",handler:"clickOption"},{type:"keydown",selector:"",name:"dropdown_keydown",handler:this.__onKeydown.bind(this,[])},{type:"mousemove",selector:".dropdown-option",name:"dropdown_option_mouseenter",handler:this.__onMousemove.bind(this,{x:0,y:0})},{type:"mouseenter",selector:".dropdown-label",name:"dropdown_label_mouseenter",handler:"__onMouseenterLabel"},{type:"mouseenter",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseenter",handler:"__onScrollUpMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseleave",handler:"__onScrollUpMouseleave"},{type:"mouseenter",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseenter",handler:"__onScrollDownMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseleave",handler:"__onScrollDownMouseleave"}]},__onMousemove:function(e,c){if(e.x!=c.screenX||e.y!=c.screenY)e.x=c.screenX,e.y=c.screenY,this.$el.focus(),this.setActiveElement($(c.target))},__onBlur:function(e){this.$el.removeClass("is-open")},__onMouseenterLabel:function(e){this.$(".is-selected").removeClass("is-selected")},initialize:function(e){this.$select=IMVU.requireProperty(e,"$replaceElement");if(!this.$select.is("select"))throw Error("$replaceElement must be a <select> element. got: "+this.$select[0].tagName);if(this.$select.closest("label").length)throw Error("do not wrap custom dropdowns with <label> tags; it disrupts event handling");a.prototype.initialize.call(this,e);this.window=e.window;this.timer=e.timer;this.boundingBox=e.boundingBox||this.getDefaultBoundingBox();this.document=e.document||document;this.__keyArray=[];if(this.dismissOnScroll=e.dismissOnScroll)$(e.dismissOnScroll).on("scroll.dropdown",function(){this.__hide()}.bind(this));$(".dropdown-layer").length||$("body").append('<div class="dropdown-layer"/>');this.$dropdownLayer=$(".dropdown-layer");e.dimNoValue&&this.$el.addClass("dim-no-value");e.lightText&&this.$el.addClass("light-text");e.hideArrow&&this.$el.addClass("hide-arrow");this.$el.data("dropdown-instance",this);this.addToDOM()},delete:function(){this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray);this.dismissOnScroll&&$(this.dismissOnScroll).off("scroll.dropdown");$(this.window).off("resize.dropdown");a.prototype.delete.call(this)},__onHidden:function(){this.$el.is(":visible")&&this.remove();a.prototype.__onHidden.apply(this,arguments)},getDefaultBoundingBox:function(){var e=this.$el.position().top-5*this.ITEM_HEIGHT,c=e+11*this.ITEM_HEIGHT;0>e&&(e=0);c>$(this.window).height()&&(c=$(this.window).height());return{x:0,y:e,w:$(this.window).width(),h:c-e}},render:function(){this.$placeholder=$("<div/>");this.$el.html(k.template);this.$label=this.$(".dropdown-label");this.$optionList=this.$(".dropdown-option-list");this.$optionListContainer=this.$(".dropdown-option-list-container");var e=this.$optionList.find(".dropdown-option");this.$select.addClass("is-enhanced");this.refreshLabel(this.$select.find(":selected"));e.remove();this.$select.children().each(function(c,g){c=e.clone(!0);c.text($(g).text());c.attr("data-text",$(g).text().toLowerCase());c.attr("data-value",$(g).val());this.$optionList.append(c)}.bind(this));this.$el.addClass(this.$select[0].className).removeClass("dropdown-template").addClass("dropdown");this.$label.append(this.$select);this.$el.attr("tabindex",this.$select.attr("tabindex")||"0");this.$select.attr("tabindex",-1);this.$optionList.on("scroll",this.__onScroll.bind(this));this.$select.on("change",this.__changedOption.bind(this));this.$el.addClass("is-ready")},__fullHeight:function(){return this.$select.children().length*this.ITEM_HEIGHT},__getSelectedIndex:function(){return this.$select[0].selectedIndex},__getTopEdgeInViewport:function(e){return e.offset().top-$(this.document).scrollTop()},__getComputedInfo:function(){var e=this.__getTopEdgeInViewport(this.$el),c=this.__fullHeight(),g=this.__getSelectedIndex()*this.ITEM_HEIGHT,f=this.getDefaultBoundingBox().y,h=this.getDefaultBoundingBox().y+this.getDefaultBoundingBox().h,m=e-g,n=m+c;m<f&&(m=f);if(n>h){var p=n-h;n=h;m>f&&(m-=Math.min(m-f,p))}return{projectedTopDiff:m-e,computedHeight:n-m,selectedTop:g,maxTop:f,maxBottom:h,fullHeight:c}},__refreshScrollers:function(){var e=this.$optionList[0].scrollHeight-this.$optionList.innerHeight(),c=0<this.$optionList.scrollTop();e=Math.round(this.$optionList.scrollTop())<e;this.$el.toggleClass("can-scroll-up",c).toggleClass("can-scroll-down",e)},isOpen:function(){return this.$el.hasClass("is-open")},__hide:function(){this.isOpen()&&($(this.window).off("resize.dropdown"),this.$el.removeClass("is-open"),this.$placeholder.before(this.$el).detach(),this.$el.removeAttr("style"))},__show:function(){if(!this.isOpen()){$(this.window).on("resize.dropdown",b);var e=this.$el.offset(),c=this.$el.width(),g=this.$el.height(),f=this.$el.css("margin-left"),h=this.$el.css("margin-right"),m=this.$el.css("margin-top"),n=this.$el.css("margin-bottom"),p=this.$el.css("float");this.$placeholder.css({width:c,height:g,"margin-left":f,"margin-right":h,"margin-top":m,"margin-bottom":n,float:p});this.$el.addClass("is-open").css({top:this.__getTopEdgeInViewport(this.$el),left:e.left,width:c,height:g,"margin-left":0,"margin-right":0,"margin-top":0,"margin-bottom":0});this.$el=this.$el.before(this.$placeholder).detach();this.$dropdownLayer.append(this.$el)}},toggleOpen:function(e){this.isOpen()?this.__hide():(this.__show(),e=this.__getComputedInfo(),this.$optionListContainer.css({top:e.projectedTopDiff,height:e.computedHeight}),this.$el.focus(),e=e.selectedTop+e.projectedTopDiff,this.$optionList.scrollTop(e),this.__lastScrollTop=e,this.setActiveElement(this.$(".dropdown-option").eq(this.__getSelectedIndex())),this.__refreshScrollers());return!1},refreshLabel:function(e){this.$label.find("> span").text(e.text()).toggleClass("no-value",""===e.val())},clickOption:function(e){this.__hide();this.$select.val($(e.target).attr("data-value"));this.$select.trigger("change");b(e)},selectByValue:function(e){this.$(".is-selected").removeClass("is-selected");this.$('.dropdown-option[data-value="'+e+'"]').addClass("is-selected");this.$("select").val(e);e=this.$("select").find(":selected");this.refreshLabel(e)},val:function(){return this.$("select").val()},__changedOption:function(e){e=$(e.target).find(":selected");this.refreshLabel(e)},__maybeScrollOptionIntoView:function(e,c){if(e[0]){var g=this.$el.hasClass("can-scroll-up"),f=this.$el.hasClass("can-scroll-down"),h=this.$optionList,m=h.height(),n=h.offset().top,p=n+m,q=e.outerHeight();e=e.offset().top;var ka=e+q,u=e-n+h.scrollTop(),z=m/2-q/2*3;e<n+(g?q:0)?(c&&(u-=z),h.scrollTop(u-(g?this.ITEM_HEIGHT:0))):ka>p-(f?q:0)&&(c&&(u+=z),h.scrollTop(u-(m-q)+(f?q:0)))}},__open:function(e){this.isOpen()&&this.$select.val(this.$optionList.find(".is-selected").attr("data-value")).change();this.toggleOpen(e);e=this.$optionList.children().eq(this.$select[0].selectedIndex);k.NextUtil.DomHelper.radioClass(e,"is-selected");return e},__moveSelection:function(e){e=this.$optionList.children().index(this.$optionList.find(".is-selected"))+e;0>e?e=0:e>this.$select.children().length-1&&(e=this.$select.children().length-1);e=this.$optionList.children().eq(e);k.NextUtil.DomHelper.radioClass(e,"is-selected");return e},setActiveElement:function(e){this.__activeElement=e;k.NextUtil.DomHelper.radioClass(e,"is-selected")},__onKeydown:function(e,c){if(!this.isOpen()&&d.is(c,"VK_ENTER")||!this.isOpen()&&d.is(c,"VK_DOWN"))b(this.$el),this.__open(c);else{var g=this.__activeElement&&this.__activeElement.parent()[0]===this.$optionList[0]?this.__activeElement:this.$(".dropdown-option").first();if(d.is(c,"VK_DOWN"))this.__maybeScrollOptionIntoView(g.next()),g.next()[0]&&this.setActiveElement(g.next());else if(d.is(c,"VK_UP"))this.__maybeScrollOptionIntoView(g.prev()),g.prev()[0]&&this.setActiveElement(g.prev());else if(d.is(c,"VK_ENTER"))this.__hide(),this.$select.val(this.__activeElement.attr("data-value")),this.$select.trigger("change"),b(c);else if(d.is(c,"VK_ESC"))b(this.$el);else{var f=d.getAlphaNumericChar(c);if(!1!==f){var h=g[0];this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray);e.push(f);f=e.join("").toLowerCase();for(this.__keyValueArray=this.timer.setTimeout(function(){e.length=0}.bind(this),1e3);h.nextSibling;){h=h.nextSibling;var m=$(h);if(m.attr("data-text")[0]&&k.NextUtil.string.startsWith(m.attr("data-text"),f)){this.isOpen()||this.toggleOpen(c);this.setActiveElement(m);this.__maybeScrollOptionIntoView(m,m[0]!=g[0].nextSibling&&m[0]!=g[0].prevSibling);return}}for(h=this.$(".dropdown-option")[0];h&&h!=g[0];){m=$(h);if(m.attr("data-text")[0]&&k.NextUtil.string.startsWith(m.attr("data-text"),f)){this.isOpen()||this.toggleOpen(c);this.setActiveElement(m);this.__maybeScrollOptionIntoView(m,m[0]!=g[0].nextSibling&&m[0]!=g[0].prevSibling);break}h=h.nextSibling}}}}},__onScroll:function(e){e=this.$optionList.scrollTop();this.__refreshScrollers();this.__lastScrollTop=e},__doScrollUp:function(e,c){e=this.__getComputedInfo();var g=void 0===c?this.AUTO_SCROLL_BY:c;this.$optionListContainer.offset().top+this.$optionListContainer.height()+g<e.maxBottom?(c=this.$optionListContainer.height()+g,c>e.fullHeight&&(c=e.fullHeight),this.$optionListContainer.css({height:c}),this.$optionList[0].scrollTop-=g,this.__refreshScrollers(this.$dropdown)):void 0===c&&(this.$optionList[0].scrollTop-=this.AUTO_SCROLL_BY)},__onScrollUpMouseenter:function(e){this.timer.clearInterval(this.__autoScrollInterval);this.__autoScrollIntervalCounter=0;this.__autoScrollInterval=this.timer.setInterval(function(){this.__doScrollUp(e)}.bind(this),1)},__onScrollUpMouseleave:function(e){this.timer.clearInterval(this.__autoScrollInterval)},__doScrollDown:function(e,c){e=this.__getComputedInfo();var g=void 0===c?this.AUTO_SCROLL_BY:c;if(this.$optionListContainer.offset().top-g>e.maxTop){var f=this.$optionListContainer.height()+g;c=this.$optionListContainer.position().top-g;f>e.fullHeight?f=e.fullHeight:this.$optionListContainer.css({top:c});this.$optionListContainer.css({height:f});this.$optionList[0].scrollTop+=g;this.__refreshScrollers(this.$dropdown)}else void 0===c&&(this.$optionList[0].scrollTop+=this.AUTO_SCROLL_BY)},__onScrollDownMouseenter:function(e){this.timer.clearInterval(this.__autoScrollDownInterval);this.__autoScrollDownIntervalCounter=0;this.__autoScrollDownInterval=this.timer.setInterval(function(){this.__doScrollDown(e)}.bind(this),1)},__onScrollDownMouseleave:function(e){this.timer.clearInterval(this.__autoScrollDownInterval)}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:ja}),la=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return""},3:function(b,a,d,e){return" no-header"},5:function(b,a,d,e){var c,g=a.helperMissing;d='\n            <div class="wh-20">';if((a=(c=a.icon||b&&b.icon||g,c.call(b,"icon-chatwindow_close",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)d+=a;return d+"</div>\n        "},7:function(b,a,d,e){var c,g=a.helperMissing;d='\n            <div class="wh-20">';if((a=(c=a.icon||b&&b.icon||g,c.call(b,"icon-dialog_close",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)d+=a;return d+"</div>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='<div class="dialog-container ',h=a["if"].call(b,b&&b.headerIsVisible,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(h||0===h)f+=h;f+='">\n    <a href="#" class="dialog-x">\n        ';if((h=(c=a.platform||b&&b.platform||d,c.call(b,"mobile",{name:"platform",hash:{},fn:this.program(5,e),inverse:this.program(7,e),data:e})))||0===h)f+=h;return f+'\n    </a>\n    <header class="dialog-header">\n        <h3 class="dialog-title nowrap">'+g((c=a.title||b&&b.title,"function"===typeof c?c.call(b,{name:"title",hash:{},data:e}):c))+'</h3>\n    </header>\n    <div class="aux-header"></div>\n    <section class="dialog-body"></section>\n    <footer class="dialog-footer"></footer>\n</div>\n'},useData:!0})}({}),ma=function(k){var b=k.UiCore.UiContext;return b.extend("UIContextExtension",{dependencies:"browserInfo currentLocale featureAccessManager loginManager timestampHelper window".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__appMonitor=null;this.__browserInfo=a.browserInfo;this.__featureAccessManager=a.featureAccessManager;this.__loginManager=a.loginManager;this.__timestampHelper=a.timestampHelper;this.__currentLocale=this.__currentLocale||"en";this.__currentLocale="www"===this.__currentLocale?"en":this.__currentLocale;this.serviceProvider=a.serviceProvider;this.__userIsLoggedIn=this.__loginManager.isLoggedIn();this.__myCid=0;this.__userIsLoggedIn&&(this.__myself=this.__loginManager.getCurrentUser(),this.__loginType=this.__loginManager.getLoginType(),this.__myself.populated().then(function(){this.__myCid=this.__myself.get("legacy_cid");if("string"===typeof this.__myCid)if(/^\d+$/.test(this.__myCid))this.__myCid=parseInt(this.__myCid);else{if(!this.__appMonitor&&this.serviceProvider.has("appMonitor")){var d=this.serviceProvider.get("appMonitor");d&&(this.__appMonitor=d)}this.__appMonitor?this.__appMonitor.reportCustomError("UIContextExtension","initialize","web_perm_0017","Bad CID detected",["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]):this.__window.appMonitorPending.push(["UIContextExtension","initialize","web_perm_0017","Bad CID detected",["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]]);this.__myCid=0}this.__myCid=this.__myCid?this.__myCid:0;this.__myCountry=this.__myself.get("country")}.bind(this)));this.__perfReportManager=this.serviceProvider.get("perfReportManager");this.__perfReportManager.setUIContext(this)},getActivityGroupID:function(){return this.__activityGroup.id},getClientSessionID:function(){},packageAppDeviceData:function(){var a=this.__browserInfo.getPlatformData();return{is_test_data:String(this.__window.location).includes("localhost")?"test":"production",app_instance_id:a.appInstanceID,device_platform:a.devicePlatform,device_model:a.deviceModel,app_version:a.appVersion,customer_id:this.__myCid}},__packageEventData:function(a,d){var e=this.__timestampHelper.now().unix().toString();return _.extend({event:null,event_class:null,event_transaction_id:d,event_timestamp:e,event_source:"user",event_reason:null,location:null},a)},__packageTaxonomyData:function(a,d){return{payload_format:"taxonomy",taxonomy:{tenant_id:"IMVU",schema_version:1,app_device_data:this.packageAppDeviceData(),event_data:this.__packageEventData(a,d)}}},__recordTaxonomyEvent:function(a,d){var e=k.NextUtil.DomHelper.createGUID();a=this.__packageTaxonomyData(a,e);this.__recordEvent("taxonomy",a,d||"","soma_taxonomy");return e},recordSentWhisper:function(a){return this.__recordTaxonomyEvent({event:"whisper_sent",event_class:"chat",event_reason:"click",string_one:navigator.language,integer_one:a.receiverCid,integer_two:a.senderVipStatus,integer_three:a.receiverVipStatus,location:a.location,level_one:a.roomType,level_two:a.roomId,level_three:a.startOrReply,client_ip:a.clientIp})},recordShowTieredVipUpsell:function(a){return this.__recordTaxonomyEvent({event:"vip_upsell",event_class:"vip",event_reason:"click",string_one:navigator.language,string_two:a.vipTriggerLocation,event_source:"user",location:a.vipTrigger,user_agent:navigator.userAgent,client_ip:a.clientIp})},recordYouTubePlaylistClick:function(a){var d=a.playlistId;d.includes("list=")&&(d=d.split("list=")[1]);return this.__recordTaxonomyEvent({event:"youtube_imvu_curated_playlist_started",event_class:"youtube",event_reason:"click",string_one:d,client_ip:a.clientIp})},recordYouTubeSearch:function(a){return this.__recordTaxonomyEvent({event:"youtube_video_search",event_class:"youtube",event_reason:"click",string_one:a.searchString,client_ip:a.clientIp})},recordGuestExperiencesYouTube:function(a){var d=parseInt(a.hostCid.match(/\d+$/)[0],10);return this.__recordTaxonomyEvent({event:"youtube_video_viewed_by_non_host",event_class:"youtube",event_reason:a.alreadyPlaying?"playing":"started",integer_one:d,level_one:a.roomId,client_ip:a.clientIp})},recordProductTaxonomyEvent:function(a,d){a=a.get("product_id");if("number"!==typeof a||0>=a)return null;d.systemError=""===d.systemError?null:d.systemError;var e=a.toString(),c={event:IMVU.requireProperty(d,"event"),event_class:IMVU.requireProperty(d,"eventClass"),event_reason:IMVU.requireProperty(d,"eventReason"),location:IMVU.requireProperty(d,"location"),string_one:IMVU.requireProperty(d,"status")};"product_purchased"===d.event?(c.string_two=IMVU.requireProperty(d,"currencyType"),c.string_three=IMVU.requireProperty(d,"systemError"),c.string_four=this.__loginType,c.string_five=this.__getLanguangeSetting()):(c.string_two=IMVU.requireProperty(d,"systemError"),c.integer_one=a);return this.__recordTaxonomyEvent(c,e)},recordPerformanceTaxonomyEvent:function(a,d,e){if(-1===this.__perfReportManager.getBudget(a))return this.__window.console.error("UIContextExtension::recordPerformanceTaxonomyEvent - tage("+String(a)+") not recognized"),null;var c=this.__perfReportManager.getBudget(a);e=e||{};e.submode="__default__"===e.submode?"default":e.submode;var g=IMVU.optionalProperty(e,"northstar",null);g=g?JSON.stringify(g):"";var f=this.__serviceProvider.get("systemMetrics");f=f?JSON.stringify(f):"";var h=this.__featureAccessManager.getMarketingPlatform(),m=this.__serviceProvider.get("appVersion"),n=0,p=0,q=0;"@DEV"===m?h="desktop-client-dev":m&&(h="desktop-client-"+m,q=m.split("."),n=parseInt(q[0]),p=parseInt(q[1]),q=parseInt(q[2]));m=this.__serviceProvider.get("appName");a=a+"__"+h+"__"+m+"__"+(e.type+"_Mode-"+e.mode+"_Submode-"+e.submode);h=-1;"undefined"===typeof e.sessionDuration?this.__window.console.error("UiContextExtension::recordPerformanceTaxonomyEvent - Event data missing sessionDuration"):h=e.sessionDuration;return this.__recordTaxonomyEvent({event:"performance",event_class:"measurement",event_reason:"dna",location:"dna",decimal_one:c,decimal_two:d,string_one:a,string_two:g,string_three:f,integer_one:n,integer_two:p,integer_three:q,integer_four:h},"")},__getLanguangeSetting:function(){return this.__currentLocale+"-"+this.__myCountry}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"]}),A=function(k){var b=k.AlloyModalDialog;return b.extend("AlloyAlertDialog",{uiContextName:"alert_dialog_alloy",className:"alert-dialog-alloy",dependencies:["externalNextRoot"],trackedEvents:function(){return[{type:"click",selector:'[data-confirm="ok"]',name:"confirm",handler:"__onConfirm"},{type:"change",selector:"#dialog-dropdown",name:"option",handler:"__toggleConfirmButton"}]},initialize:function(a){this.title=a.title;this.text=a.text;this.html=a.html;this.darkText=IMVU.optionalProperty(a,"dark_text",!1);b.prototype.initialize.call(this,a);this.ok=a.ok||this.__stringManager.get("OK");this.checkbox=a.checkbox;this.dropdown=a.dropdown;this.termsOfService=a.termsOfService;this.checkedByDefault=_.isUndefined(a.checkedByDefault)?!0:a.checkedByDefault;this.addToDOM()},postRender:function(){this.setContent("body",k.template,{text:this.text,html:this.html,ok:this.ok,checkbox:this.checkbox,dropdown:this.dropdown,termsOfService:this.termsOfService,checkedByDefault:this.checkedByDefault,policyHubUrl:this.__externalNextRoot+"policyhub/"});this.setContent("footer",this.$(".dialog-footer-template").last().text());this.$("#dialog-dropdown").length&&(_.each(this.dropdown.options,function(a){this.$("#dialog-dropdown").append('<option value="'+a.value+'">'+a.label+"</option>")}.bind(this)),this.reasonDropDown=this.createChildContext(k.Dropdown,{$replaceElement:this.$("#dialog-dropdown")}));this.$(".dialog-title").toggleClass("long-title",this.title&&19<this.title.length);this.darkText&&this.$el.addClass("dark-text");this.__toggleConfirmButton()},getResult:function(){var a={},d=this.$("#dialog-checkbox"),e=this.$("#dialog-dropdown");d.length&&(a.checked=d.is(":checked"));e.length&&(a.dropdown=e.val());return a},__onConfirm:function(){this.$(".btn-primary").prop("disabled",!0);this.promiseResolver.resolve(this.getResult());this.hide()},__toggleConfirmButton:function(){this.$("#dialog-dropdown").length?this.$(".btn-primary").prop("disabled",!this.$("#dialog-dropdown").val()):this.$(".btn-primary").prop("disabled",!1)}})}({AlloyModalDialog:function(k){var b=k.UIContextExtension;return b.extend("AlloyModalDialog",{uiContextName:"modal_dialog_alloy",className:"alloy-modal-dialog",dependencies:["appMonitor","globalStringManager","nextRoot","Promise","window"],hasCloseButton:!0,headerIsVisible:!0,contentAreas:{header:".dialog-header",auxHeader:".aux-header",body:".dialog-body",footer:".dialog-footer"},initialize:function(a){b.prototype.initialize.call(this,a);"undefined"!==typeof a.hasCloseButton&&(this.hasCloseButton=a.hasCloseButton);"undefined"!==typeof a.headerIsVisible&&(this.headerIsVisible=a.headerIsVisible);this.serviceProvider=a.serviceProvider;this.__appMonitor=a.appMonitor;this.dialogManager=a.dialogManager;this.__stringManager=a.globalStringManager;this.__nextRootBase=this.__nextRoot.replace("/next/","");this.__postToParent="undefined"===typeof a.postToParent?!0:a.postToParent;this.canCloseWithOverlayClick=IMVU.optionalProperty(a,"canCloseWithOverlayClick",!0);this.__appMonitor.waypoint("AlloyModalDialog::initialize:"+this.constructor.name);this.finished=new a.Promise(function(d){this.promiseResolver=d}.bind(this));this.shouldFocusOnPrimaryButton=!0;a=this.delete.bind(this);this.finished.then(a,a);this.$el.attr("data-ui-role","modal-dialog");this.$el.on("focusin",function(d){this.$el.closest("html").addClass("dialog-focused")}.bind(this));this.$el.on("focusout",function(d){this.$(d.target).closest(".dropdown").length||this.$el.closest("html").removeClass("dialog-focused")}.bind(this));this.$el.trigger("focusout");this.__postToParent&&this.__window.parent&&this.__window.parent.postMessage&&this.__window.parent.postMessage({message:"opening_modal_dialog",type:this.uiContextName},"*")},render:function(){var a=this;this.doWork([function(){a.$el.html(k.template({title:a.title||"",headerIsVisible:a.headerIsVisible}));a.$(".dialog-x").on("click",a.__onClose.bind(a));a.$el.toggleClass("can-dismiss",a.hasCloseButton);a.postRender();a.$el.closest("html").attr("data-dialog",a.uiContextName);a.__focusPrimaryButton();a.$el.is(".dialog-type-B, .dialog-type-B-flexible")&&a.$el.closest("body").is(".mobile")&&470>a.$el.width()&&(a.$el.is(".text-close")?a.$(".dialog-x").text("Close"):a.$el.is(".text-done")?a.$(".dialog-x").text("Done"):a.$el.is(".text-none")?a.$(".dialog-x").text(""):a.$(".dialog-x").text("Cancel"),a.__adjustTitlePosition())}])},__adjustTitlePosition:function(){this.$(".dialog-title").removeClass("overflowed");var a=this.$(".dialog-title").width(),d=this.$(".dialog-header").width();a<=d-160?this.$(".dialog-title").toggleClass("overflowed",!1):this.$(".dialog-title").toggleClass("overflowed",!0)},linkToDetailsSubmode:function(a,d){this.serviceProvider.get("historyManager").setState({fragment:this.__urlId(d.id),mode:{id:a},submode:{id:d.id,summary:{model:d}}})&&(a=function(){this.serviceProvider.get("historyManager").silentMoveHistory(-1)}.bind(this),this.finished.then(a,a))},show:function(){this.__appMonitor.waypoint("AlloyModalDialog::show:"+this.constructor.name);b.prototype.show.call(this);this.__focusPrimaryButton()},hide:function(){this.__appMonitor.waypoint("AlloyModalDialog::hide:"+this.constructor.name);b.prototype.hide.call(this);this.$el.closest("html").removeAttr("data-dialog")},close:function(){this.__appMonitor.waypoint("AlloyModalDialog::close:"+this.constructor.name);this.hide();this.promiseResolver.reject()},closeAll:function(a){a.preventDefault();this.__recordEvent("click",{name:"dialog_close"});this.__dialogManager.closeAll()},showHeader:function(){this.headerIsVisible=!0;this.$(".dialog-container").removeClass("no-header")},hideHeader:function(){this.headerIsVisible=!1;this.$(".dialog-container").addClass("no-header")},toggleHeader:function(){this.headerIsVisible?this.hideHeader():this.showHeader()},__onClose:function(a){a.preventDefault();this.__recordEvent("click",{name:"dialog_close"});this.close()},__focusPrimaryButton:function(){if(this.shouldFocusOnPrimaryButton){var a=this.$(".btn-primary");1<a.length?a.trigger("blur"):a.first().focus()}},updateDialogTitle:function(a){this.$(".dialog-header .dialog-title").text(a);this.__adjustTitlePosition()},delete:function(){this.__appMonitor.waypoint("AlloyModalDialog::delete:"+this.constructor.name);this.__postToParent&&this.__window.parent&&this.__window.parent.postMessage&&this.__window.parent.postMessage({message:"deleting_modal_dialog",type:this.uiContextName},"*");b.prototype.delete.call(this)}})}({UiCore:l["@UiCore"],UIContextExtension:ma,template:la}),Dropdown:v,template:ia}),na=function(k){var b=k.UiCore.UiContext;return b.extend("FollowButton",{className:"follow-button btn-simple",uiContextName:"follow_button",tagName:"button",dependencies:"dialogManager featureAccessManager globalStringManager loginManager onboardingGamificationManager Promise timestampHelper window".split(" "),trackedEvents:function(){return[{type:"click",selector:"",name:"follow_button_click",handler:this.__onClick}]},initialize:function(a){var d=this;this.__handleButtonClickInProgress=!1;this.__clickLog=[];b.prototype.initialize.call(this,a);this.$el.addClass("hidden");this.__profileNode=this.track(a.profileNode);this.__isLoggedIn=this.__loginManager.isLoggedIn();(this.__flavor=IMVU.optionalProperty(a,"flavor",void 0))&&this.$el.addClass(this.__flavor);this.__isLoggedIn?(this.__myself=this.__loginManager.getCurrentUser(),this.__myProfile=this.__myself.getSingleEdge("profile"),this.__Promise.every([this.__profileNode.populated(),this.__myProfile.populated()]).then(function(){d.__setButtonStateBasedOnViewSubscription();d.__myFollowingCollection=d.__myProfile.searchEdgeCollection("subscriptions",{},k.UiCore.EdgeCollection);d.listenTo(d.__profileNode,"change:relations",d.__setButtonStateBasedOnViewSubscription);d.addToDOM()})):this.addToDOM()},render:function(){var a=this;this.__profileNode.populated().then(function(){a.$el.html(k.template({})).removeClass("hidden");a.__setAsRendered()})},__setButtonStateBasedOnViewSubscription:function(){this.$el.toggleClass("following","undefined"!==typeof this.__profileNode.relations.viewer_subscription)},__invalidateProfileNode:function(){var a=this;this.$el.addClass("disabled");this.__profileNode.invalidate();this.__profileNode.populated().then(function(){a.$el.removeClass("disabled");a.__setButtonStateBasedOnViewSubscription()})},__onClick:function(){this.__clickLog.push(this.__timestampHelper.now().unix());10<this.__clickLog.length&&this.__clickLog.shift();this.__isLoggedIn?this.__handleButtonClickInProgress||(this.__handleButtonClickInProgress=!0,this.$el.hasClass("following")?this.__handleFollowingClick():this.__handleFollowClick()):this.__dialogManager.showLoginOrSignupDialog()},__unsetDebounceFlag:function(){var a=this;this.__profileNode.populated().then(function(){a.__setButtonStateBasedOnViewSubscription();a.__handleButtonClickInProgress=!1}).catch(function(){a.__setButtonStateBasedOnViewSubscription();a.__handleButtonClickInProgress=!1})},__handleFollowingClick:function(){var a=this;this.__profileNode.populated().then(function(){"undefined"===typeof a.__profileNode.relations.viewer_subscription?(a.__setButtonStateBasedOnViewSubscription(),a.__unsetDebounceFlag()):a.__dialogManager.showDialog(k.UnfollowDialog,{profile:a.__profileNode}).finished.then(function(){a.__profileNode.populated().then(function(){"undefined"!==typeof a.__profileNode.relations.viewer_subscription&&a.__profileNode.getSingleEdge("viewer_subscription",k.UiCore.EdgeModel).destroy().then(function(){a.__invalidateProfileNode()});a.__unsetDebounceFlag()}).catch(function(){a.__unsetDebounceFlag()})},function(){a.__unsetDebounceFlag()})})},__handleFollowClick:function(){var a=this;this.__profileNode.populated().then(function(){"undefined"!==typeof a.__profileNode.relations.viewer_subscription?(a.__setButtonStateBasedOnViewSubscription(),a.__unsetDebounceFlag()):(a.__featureAccessManager.canSeeOnboardingGamification()&&a.__onboardingGamificationManager.handleTaskCompletion("social_follow",function(){return a.__recordEvent("onboarding",{name:"grant_reward",event_type:"social_follow",cid:a.__myself.get("legacy_cid"),record:!0})}),a.__myFollowingCollection.create({id:a.__profileNode.id}).then(function(){a.__invalidateProfileNode();a.__unsetDebounceFlag()}).catch(a.__onFollowFailure.bind(a)))})},__onFollowFailure:function(a){switch(a.error.error){case"PROFILE-003":this.__dialogManager.showDialog(k.AlloyAlertDialog,{title:this.__globalStringManager.get("oops"),text:this.__globalStringManager.get("dialog_follow_too_many_error_text"),ok:this.__globalStringManager.get("OK")})}},__showLoginDialog:function(){this.__dialogManager.showDialog(k.LoginDialog,{stringManager:this.__globalStringManager,loginDestination:this.__window.location.href})}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],AlloyAlertDialog:A,LoginDialog:ha,UnfollowDialog:O,template:K}),oa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return" square "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d='<div class="thumbnail-wrap">\n    <div class="thumbnail ';if((b=a["if"].call(b,b&&b.useSquareThumbnail,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)d+=b;return d+'"></div>\n</div>\n<div class="text">\n    <div class="line-1 text-line"></div>\n    <div class="line-2 text-line"></div>\n    <div class="line-3 text-line"></div>\n    <div class="line-4 text-line"></div>\n</div>\n'},useData:!0})}({}),pa=function(k){var b=k.UiCore.UiContext;return b.extend("LoadingPlaceholderListItem",{uiContextName:"loading_placeholder_list_item",className:"loading-placeholder-list-item",tagName:"li",initialize:function(a){b.prototype.initialize.call(this,a);this.__useSquareThumbnail=IMVU.optionalProperty(a,"useSquareThumbnail",!1);this.addToDOM()},render:function(){b.prototype.render.call(this);this.$el.html(k.template({useSquareThumbnail:this.__useSquareThumbnail}))}})}({UiCore:l["@UiCore"],template:oa}),qa=function(k){var b=k.UiCore.UiContext;return b.extend("LoadingPlaceholderList",{uiContextName:"loading_placeholder_list",tagName:"ul",className:"loading-placeholder-list",itemCount:6,initialize:function(a){b.prototype.initialize.call(this,a);this.__useSquareThumbnail=IMVU.optionalProperty(a,"useSquareThumbnail",!1);this.itemCount=IMVU.optionalProperty(a,"itemCount",6);this.addToDOM()},render:function(){b.prototype.render.call(this);_(this.itemCount).times(function(){this.createChildContext(k.LoadingPlaceholderListItem,{$parentElement:this.$el,useSquareThumbnail:this.__useSquareThumbnail})}.bind(this))}})}({UiCore:l["@UiCore"],LoadingPlaceholderListItem:pa}),ra=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<script type="text/template" class="profile-icon-grid-slot-template">\n    <div class="profile-icon-grid-slot">',f=(c=a.icon||b&&b.icon||d,c.call(b,"icon-chat-occupancy",{name:"icon",hash:{},data:e}));if(f||0===f)g+=f;g+='</div>\n<\/script>\n<script type="text/template" class="profile-icon-grid-slot-empty-template">\n    ';if((f=(c=a.icon||b&&b.icon||d,c.call(b,"icon-chat-occupancy",{name:"icon",hash:{},data:e})))||0===f)g+=f;return g+"\n<\/script>"},useData:!0})}({}),sa=function(k){var b=k.UiCore.UiContext;return b.extend("ProfileIconGrid",{className:"profile-icon-grid",uiContextName:"profile_icon_grid",dependencies:"loginManager numSlots Promise timer userCollection userCountCallback window".split(" "),initialize:function(a){var d=this;b.prototype.initialize.call(this,a);this.__activeChat=IMVU.optionalProperty(a,"activeChat",null);this.__cache={};this.__slots=[];this.__throttleTimerRef={};this.doWork([function(){return d.__userCollection.populated()},function(){d.addToDOM();d.listenTo(d.__userCollection,"add remove reset",k.NextUtil.throttle(d.__timer,d.__throttleTimerRef,d.__update.bind(d),1e3));d.__update()}])},delete:function(){this.__timer.clearTimeout(this.__throttleTimerRef.timeout);b.prototype.delete.call(this)},__addSlot:function(a){this.__slots[a]=null;a=this.$(".profile-icon-grid-slot-template").text();this.$el.append(a)},__addUser:function(a){var d=this.__cache[a.id]={model:a,online:a.get("online"),thumbnail_url:a.get("thumbnail_url")};this.__slots.filter(function(g){return!!g}).length===this.__slots.length&&(this.__numSlots++,this.__addSlot(this.__slots.length));for(var e=-1,c=0;c<this.__numSlots;c++)if(!this.__slots[c]){this.__slots[c]=a.id;e=c;break}d.index=e;a={$parentElement:this.$(".profile-icon-grid-slot").eq(e).html(""),user:a.node||a,ignoreClicks:!this.__loginManager.isLoggedIn(),activeChat:this.__activeChat,fadeIn:!0};a=this.createChildContext(k.ProfileIcon,a);d.icon=a;this.__addRenderGatingPromise(a.getHasRenderedPromise())},__update:function(){for(var a=this,d=$jscomp.makeIterator(_.keys(this.__cache)),e=d.next();!e.done;e=d.next()){e=e.value;for(var c=!1,g=$jscomp.makeIterator(this.__userCollection.models),f=g.next();!f.done;f=g.next())if(f.value.id===e){c=!0;break}c||(c=this.__cache[e],c.icon.delete(),delete this.__slots[c.index],delete this.__cache[e])}this.__userCollection.each(function(h){h.id in a.__cache||a.__addUser(h)});d=this.$(".profile-icon-grid-slot");for(e=0;e<this.__slots.length;e++)c=d.eq(e),this.__slots[e]||(g=this.$(".profile-icon-grid-slot-empty-template").text(),c.html(g));this.__userCountCallback(this.__userCollection.length)},render:function(){var a=this;this.doWork([function(){a.$el.html(k.template());a.$el.toggleClass("logged-out",!a.__loginManager.isLoggedIn());a.__numSlots=Math.max(a.__userCollection.length,a.__numSlots);for(var d=0;d<a.__numSlots;d++)a.__addSlot(d);a.__loginManager.isLoggedIn()?(a.__userCollection.each(function(e){return a.__addUser(e)}),a.__waitOnRenderGatingPromises({failure:"ProfileIconGrid::render - failed - 2"})):a.__setAsRendered()}]).catch(function(d){a.__setAsRenderFailed("ProfileIconGrid::render - failed - 1")})}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],ProfileIcon:y,template:ra}),ta=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;return'<div class="header">\n    <span class="date">'+d((c=a.dateText||b&&b.dateText,"function"===typeof c?c.call(b,{name:"dateText",hash:{},data:e}):c))+'</span>\n    <span class="time">'+d((c=a.timeText||b&&b.timeText,"function"===typeof c?c.call(b,{name:"timeText",hash:{},data:e}):c))+"</span>\n</div>\n\n"},useData:!0})}({}),t=function(k){var b=k.UiCore.UiContext;return b.extend("Timestamp",{className:"timestamp-widget",uiContextName:"timestamp",tagName:"timestamp",dependencies:["moment","timestamp","timestampHelper"],initialize:function(a){b.prototype.initialize.call(this,a);this.__timestampHelper=a.timestampHelper;this.__moment=a.moment;this.__timestampHelper.setDifference(a.timestamp);this.addToDOM();this.$el.attr("data-actual-date",this.__timestampHelper.now().toString())},render:function(){this.$el.text(this.__timestampHelper.formatTime())}})}({UiCore:l["@UiCore"]}),ua=function(k){return k.Timestamp.extend("MessageHeaderTimestamp",{className:"timestamp-widget message-header-timestamp",uiContextName:"message_header_timestamp",render:function(){this.$el.html(k.template({dateText:this.__timestampHelper.messageHeaderDay(),timeText:this.__timestampHelper.formatTime()}))}})}({UiCore:l["@UiCore"],Timestamp:t,template:ta}),va=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<button class="btn share-button">\n    ',f=(c=a.icon||b&&b.icon||d,c.call(b,"icon-action_share_on",{name:"icon",hash:{class:"share-on-button icon"},data:e}));if(f||0===f)g+=f;g+="\n    ";if((f=(c=a.icon||b&&b.icon||d,c.call(b,"icon-action_share_off",{name:"icon",hash:{class:"share-off-button icon"},data:e})))||0===f)g+=f;return g+"\n</button>"},useData:!0})}({}),wa=function(k){var b=k.UiCore.UiContext;return b.extend("LayerAbovePage",{className:"layer-above-page",uiContextName:"layer_above_page",initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()}})}({UiCore:l["@UiCore"]}),xa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='<div class="share-title">',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"share",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+='</div>\n<div class="share-text">'+g((c=a.linkToCopy||b&&b.linkToCopy,"function"===typeof c?c.call(b,{name:"linkToCopy",hash:{},data:e}):c))+'</div>\n<div class="share-icons">\n    <div class="clipboard-tooltip">\n        <button class="btn btn-primary copy-btn btn-small">\n            <span class="tooltiptext hidden"></span>\n            ';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"copy",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"\n        </button>\n    </div>\n</div>\n"},useData:!0})}({}),ya=function(k){var b=k.UiCore.UiContext;return b.extend("LayerAboveDialog",{className:"layer-above-dialog",uiContextName:"layer_above_dialog",initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()}})}({UiCore:l["@UiCore"]}),za=function(k){var b=k.UiCore.UiContext;return b.extend("SharePanel",{className:"share-panel",uiContextName:"share_panel",dependencies:"$shareButton globalStartupModel globalStringManager modeManager restModelFactory window".split(" "),trackedEvents:function(){return[{type:"click",selector:".copy-btn",name:"copy_to_clipboard",handler:this.__copyToClilpboard.bind(this)},{type:"mouseout",selector:".copy-btn",name:"mouseout_copy_to_clipboard",handler:this.__onMouseout.bind(this)}]},initialize:function(a){var d=this;b.prototype.initialize.call(this,a);this.__linkToCopy=IMVU.optionalProperty(a,"linkToCopy",null);this.__linkToCopy||(this.__linkToCopy=this.__generateLinkToCopy(),this.__productId=this.__linkToCopy.slice(24),this.__productUrl=this.__restModelFactory.readModel(this.__globalStartupModel.get("productUrl")+this.__productId,k.UiCore.NodeModel),this.__productUrl.populated().then(function(e){e.get("is_nft")&&d.__recordEvent("click",{name:"sharing_nft_product"})}));this.$body=$("body");this.__$dialog=this.__$shareButton.parents(".dialog-container");this.__sharePanelLayerFactory=(this.__isInDialog=0<this.__$dialog.length)?k.LayerAboveDialog:k.LayerAbovePage;this.__sharePanelLayer=this.__modeManager.createChildContext(this.__sharePanelLayerFactory,{$parentElement:this.__modeManager.$el});this.__$parentElement=this.__sharePanelLayer.$el;this.setParentUiContext(this.__sharePanelLayer);this.addToDOM()},render:function(){this.$el.html(k.template({linkToCopy:this.__linkToCopy}));this.__$tooltipText=this.$(".tooltiptext");this.__trackSharePanel();this.__selectText();$(this.__window).on("scroll.socialshare",function(){this.__trackSharePanel()}.bind(this));$(this.__window).on("resize.socialshare",function(){this.__trackSharePanel()}.bind(this));this.$body.find(".transparent-overlay").on("scroll.socialshare",function(){this.__trackSharePanel()}.bind(this));k.NextUtil.DomHelper.dismissible({openerEl:this.__$shareButton,dismissibleEl:this.$el,dismissHandler:this.delete.bind(this)})},delete:function(){this.trigger("delete");$(this.__window).off("scroll.socialshare");$(this.__window).off("resize.socialshare");this.$body.find(".transparent-overlay").off("scroll.socialshare");b.prototype.delete.call(this);this.__sharePanelLayer.delete()},__copyToClilpboard:function(a){a=document.createElement("input");a.style="position: absolute; left: -1000px; top: -1000px";a.value=this.__linkToCopy;this.$el.append(a);a.select();document.execCommand("copy")?this.__showTooltip(!0):this.__showTooltip(!1);a.remove()},__onMouseout:function(){this.__hideTooltip()},__showTooltip:function(a){a=a?this.__globalStringManager.get("share_widget_copy_success"):this.__globalStringManager.get("share_widget_copy_fail");this.__$tooltipText.text(a);this.__$tooltipText.removeClass("hidden")},__hideTooltip:function(){this.__$tooltipText.addClass("hidden")},__trackSharePanel:function(){var a=this.__$shareButton[0].getBoundingClientRect().top+this.__$shareButton.outerHeight(),d=this.__$shareButton[0].getBoundingClientRect().left;a-=15;d-=15;var e=this.$el[0].offsetWidth,c=d+e;if(this.__isInDialog){var g=this.__$dialog[0].getBoundingClientRect().right;c>g&&(d=g-e-20)}else g=$(this.__window).innerWidth(),c>g&&(d=g-e-20);this.$el.css({top:a,left:d})},__selectText:function(){if("undefined"!==typeof this.__window.getSelection){this.__window.getSelection().removeAllRanges();var a=document.createRange();a.setStartBefore(this.$(".share-text")[0]);a.setEndAfter(this.$(".share-text")[0]);this.__window.getSelection().addRange(a)}},__generateLinkToCopy:function(){return this.__globalStartupModel.get("goLinkBase")+this.__window.location.pathname.replace("/next","")}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],LayerAboveDialog:ya,LayerAbovePage:wa,template:xa}),Aa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;var g=a.helperMissing,f='<div class="copy-to-clipboard">\n    <div class="share-text">'+d((c=a.linkToCopy||b&&b.linkToCopy,"function"===typeof c?c.call(b,{name:"linkToCopy",hash:{},data:e}):c))+'</div>\n    <div class="share-icons">\n        <div class="clipboard-tooltip">\n            <button class="btn btn-primary copy-btn btn-small">\n                ';if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"copy",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+'\n            </button>\n        </div>\n    </div>\n    <input value="'+d((c=a.linkToCopy||b&&b.linkToCopy,"function"===typeof c?c.call(b,{name:"linkToCopy",hash:{},data:e}):c))+'"/>\n</div>\n\n'},useData:!0})}({}),Ba=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("SharePanelDialog",{uiContextName:"share_panel_dialog",className:"share-panel-dialog dialog-type-B text-close",dependencies:["globalStringManager","window"],trackedEvents:function(){return[{type:"click",selector:".copy-btn",name:"copy_to_clipboard",handler:this.__copyToClilpboard.bind(this)}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("share");this.__linkToCopy=IMVU.optionalProperty(a,"linkToCopy",null);this.__linkToCopy||(this.__linkToCopy=this.__generateLinkToCopy());this.addToDOM();this.__$tooltipText=this.$("button");this.__$input=this.$("input")},postRender:function(){this.setContent("body",k.template({linkToCopy:this.__linkToCopy}))},__showTooltip:function(a){a=a?this.__globalStringManager.get("share_widget_copy_success"):this.__globalStringManager.get("share_widget_copy_fail");this.__$tooltipText.text(a)},__copyToClilpboard:function(a){this.__$input[0].focus();this.__$input[0].setSelectionRange(0,999999);document.execCommand("copy")?this.__showTooltip(!0):this.__showTooltip(!1)},__generateLinkToCopy:function(){return location.protocol+"//go.imvu.com"+location.pathname.replace("/next","")}})}({Dialogs:l["@Dialogs"],template:Aa}),Ca=function(k){var b=k.UiCore.UiContext;return b.extend("SocialShare",{className:"social-share",uiContextName:"social_share",dependencies:["dialogManager","globalStartupModel","platform"],trackedEvents:function(){return[]},initialize:function(a){b.prototype.initialize.call(this,a);this.__linkToCopy=IMVU.optionalProperty(a,"linkToCopy",null);this.addToDOM()},render:function(){this.$el.html(k.template());this.__$shareOnButton=this.$("svg.share-on-button");this.__$shareOffButton=this.$("svg.share-off-button");this.__$shareButton=this.$(".share-button");this.__toggleShareButtonState(!1);this.$el[0].addEventListener("click",this.__openOrCloseSharePanel.bind(this));this.__setAsRendered()},__openOrCloseSharePanel:function(){"none"==this.$(".share-on-button").css("display")?this.__openSharePanel():this.__closeSharePanel()},__openSharePanel:function(){"mobile"===this.__platform?this.__sharePanel=this.__openSharePanelDialog():(this.__toggleShareButtonState(!0),this.__sharePanel||(this.__sharePanel=this.createChildContext(k.SharePanel,{$shareButton:this.__$shareButton,linkToCopy:this.__linkToCopy}),this.listenTo(this.__sharePanel,"delete",this.__onSharePanelDelete)))},__closeSharePanel:function(){this.__sharePanel.delete()},__onSharePanelDelete:function(){this.__toggleShareButtonState(!1);this.__sharePanel=null},__toggleShareButtonState:function(a){a?(this.__$shareOnButton.show(),this.__$shareOffButton.hide()):(this.__$shareOnButton.hide(),this.__$shareOffButton.show())},__openSharePanelDialog:function(){return this.__dialogManager.showDialog(k.SharePanelDialog,{linkToCopy:this.__linkToCopy})}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],SharePanel:za,SharePanelDialog:Ba,template:va}),Da=function(k){return k.Timestamp.extend("activityHeaderTimestamp",{className:"activity-header-timestamp system-info-header",uiContextName:"activity_header_timestamp",tagName:"datedivider",render:function(){this.$el.text(this.__timestampHelper.activityCenterHeader())}})}({UiCore:l["@UiCore"],Timestamp:t}),Ea=function(k){return k.Timestamp.extend("ChatDrawerTimestamp",{className:"timestamp-widget chat-drawer-timestamp system-info-drawer",uiContextName:"chat_drawer_timestamp",render:function(){this.$el.text(this.__timestampHelper.chatDrawerTimestamp())}})}({UiCore:l["@UiCore"],Timestamp:t}),Fa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){return""},useData:!0})}({}),Ga=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=a.helperMissing;return(a=(c=a.icon||b&&b.icon||d,c.call(b,"icon-credits",{name:"icon",hash:{},data:e})))||0===a?a:""},3:function(b,a,d,e){var c;d=a.helperMissing;return(a=(c=a.icon||b&&b.icon||d,c.call(b,"icon-vcoin",{name:"icon",hash:{},data:e})))||0===a?a:""},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;var g='<div class="option-icon">\n    ',f=a["if"].call(b,b&&b.isCredits,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)g+=f;g+="\n    ";if((f=a["if"].call(b,b&&b.isVcoin,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)g+=f;return g+'\n</div>\n<div class="option-value">'+d((c=a.value||b&&b.value,"function"===typeof c?c.call(b,{name:"value",hash:{},data:e}):c))+"</div>\n"},useData:!0})}({}),Ha=function(k){var b=k.UiCore.UiContext;return b.extend("GiftingOption",{className:"gifting-option",uiContextName:"gifting_option",dependencies:[],trackedEvents:function(){return[{type:"click",selector:"",name:"option_selected",handler:"__handleClick"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__option=IMVU.requireProperty(a,"option");this.__type=IMVU.requireProperty(a,"type");this.addToDOM()},render:function(){this.$el.html(k.template({isVcoin:"vcoin"===this.__type,isCredits:"credits"===this.__type,value:this.__option}))},__handleClick:function(){this.$el.siblings(".gifting-option").removeClass("selected");this.$el.addClass("selected");this.trigger("option_selected",this.__option)}})}({UiCore:l["@UiCore"],template:Ga}),Ia=function(k){var b=k.UiCore.UiContext;return b.extend("GiftingOptionsGrid",{className:"gifting-options-grid",uiContextName:"gifting_options_grid",dependencies:[],initialize:function(a){b.prototype.initialize.call(this,a);this.__type=IMVU.requireProperty(a,"type");this.__options=IMVU.requireProperty(a,"options");this.addToDOM()},render:function(){this.__options.forEach(function(a){a=this.createChildContext(k.GiftingOption,{$parentElement:this.$el,option:a,type:this.__type});this.listenTo(a,"option_selected",this.__giftingOptionSelected)}.bind(this))},__giftingOptionSelected:function(a){this.trigger("gifting_option_selected",a)},resetSelection:function(){this.$(".gifting-option").removeClass("selected")}})}({UiCore:l["@UiCore"],GiftingOption:Ha,template:Fa}),Ja=function(k){return k.Timestamp.extend("activityDetailTimestamp",{className:"timestamp-widget activity-detail-timestamp system-info-detail",uiContextName:"activity_detail_timestamp",render:function(){this.$el.text(this.__timestampHelper.activityCenterDetail())}})}({UiCore:l["@UiCore"],Timestamp:t}),Ka=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=a.helperMissing;return(a=(c=a.icon||b&&b.icon||d,c.call(b,"icon-vcoin",{name:"icon",hash:{},data:e})))||0===a?a:""},3:function(b,a,d,e){var c;d=a.helperMissing;return(a=(c=a.icon||b&&b.icon||d,c.call(b,"icon-credits_full",{name:"icon",hash:{},data:e})))||0===a?a:""},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="balance-wrapper">\n    ',f=a["if"].call(b,b&&b.isVcoin,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)g+=f;g+="\n    ";if((f=a["if"].call(b,b&&b.isCredits,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)g+=f;g+='\n    <span class="balance"></span>\n</div>\n<div class="btn-open-upsell-dialog">';if((f=(c=a.icon||b&&b.icon||d,c.call(b,"icon-plus",{name:"icon",hash:{},data:e})))||0===f)g+=f;return g+"</div>"},useData:!0})}({}),La=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;var g=a.helperMissing,f='\n            <img class="upsell_after_gift_product-ad" src="'+d((c=a.product_ad_url||b&&b.product_ad_url,"function"===typeof c?c.call(b,{name:"product_ad_url",hash:{},data:e}):c))+'">\n            <div class="upsell_after_gift_recipient_received">'+d((c=a.giftRecipient||b&&b.giftRecipient,"function"===typeof c?c.call(b,{name:"giftRecipient",hash:{},data:e}):c))+" ";if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"received_your_gift",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+'</div><br/>\n            <div class="upsell_after_gift_title">'+d((c=a.subtitle||b&&b.subtitle,"function"===typeof c?c.call(b,{name:"subtitle",hash:{},data:e}):c))+"</div>\n        "},3:function(b,a,d,e){var c;d=this.escapeExpression;return'\n            <img class="product-ad" src="'+d((c=a.product_ad_url||b&&b.product_ad_url,"function"===typeof c?c.call(b,{name:"product_ad_url",hash:{},data:e}):c))+'">\n            <div class="title">'+d((c=a.subtitle||b&&b.subtitle,"function"===typeof c?c.call(b,{name:"subtitle",hash:{},data:e}):c))+"</div>\n        "},5:function(b,a,d,e){var c;d=a.helperMissing;var g='\n        <div class="vcoin-bullet-wrapper">\n            <div>',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin_upsell_bullet_intro",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='</div>\n            <ul class="vcoin-upsell-points">\n                <li>';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin_upsell_bullet_point_1",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n                <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin_upsell_bullet_point_2",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n                <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin_upsell_bullet_point_3",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n            </ul>\n            <div>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin_upsell_description_2",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</div>\n            \n        </div>\n        "},7:function(b,a,d,e){var c,g=a.helperMissing;d='\n    <button class="btn btn-primary btn-dark greeter-cta">';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"JOIN NOW",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</button>\n"},9:function(b,a,d,e){d='\n    <button class="btn btn-primary checkout-cta disabled">\n        ';if((b=a["if"].call(b,b&&b.simulated,{name:"if",hash:{},fn:this.program(10,e),inverse:this.program(12,e),data:e}))||0===b)d+=b;return d+"\n    </button>\n"},10:function(b,a,d,e){var c,g=a.helperMissing;d="\n            ";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"buy_now",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n        "},12:function(b,a,d,e){d="\n            ";if((b=a["if"].call(b,b&&b.upsellAfterGift,{name:"if",hash:{},fn:this.program(13,e),inverse:this.program(15,e),data:e}))||0===b)d+=b;return d+"\n        "},13:function(b,a,d,e){var c,g=a.helperMissing;d="\n                ";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"upsell_after_gift_cta",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n            "},15:function(b,a,d,e){var c,g=a.helperMissing;d=this.escapeExpression;var f="\n                ";if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"buy_now_for",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+" "+d((c=a.sale_price||b&&b.sale_price,"function"===typeof c?c.call(b,{name:"sale_price",hash:{},data:e}):c))+"\n            "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d='<div class="dialog-body-scroller">\n    <div class="multicart-upsell-panel">\n        ';var c=a["if"].call(b,b&&b.upsellAfterGift,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(c||0===c)d+=c;d+='\n        <div class="description"></div>\n        ';if((c=a["if"].call(b,b&&b.vcoinUpsell,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===c)d+=c;d+='\n        <div class="product-selectors"></div>\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n';if((c=a["if"].call(b,b&&b.greeter,{name:"if",hash:{},fn:this.program(7,e),inverse:this.program(9,e),data:e}))||0===c)d+=c;return d+"\n<\/script>\n"},useData:!0})}({}),B=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=a.helperMissing;var g='\n<div class="vip_web_tier_1-description">\n    <p>',f=a["if"].call(b,b&&b.isCreatorLanding,{name:"if",hash:{},fn:this.program(2,e),inverse:this.program(4,e),data:e});if(f||0===f)g+=f;g+="</p>\n    <ul>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_host_shields",{name:"i18n-g",hash:{tier:"Gold"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_credits_per_month",{name:"i18n-g",hash:{credits:"2,000"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_live",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+=" or ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_chat",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_hours",{name:"i18n-g",hash:{hours:"2"},data:e})))||0===f)g+=f;g+=" ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_broadcasting",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n    </ul>\n    <ul>\n        ";if((f=a["if"].call(b,b&&b.canSeeYouTube,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_tips",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_support",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_gifts",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</li>\n    </ul>\n</div>\n"},2:function(b,a,d,e){var c,g=a.helperMissing;d="\n        ";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"vip_upsell_creator_landing_body",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n    "},4:function(b,a,d,e){var c,g=a.helperMissing;d="\n        ";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"vip_product_prop_description",{name:"i18n-g",hash:{tier:"Gold"},data:e})))||0===a)d+=a;return d+"\n    "},6:function(b,a,d,e){var c,g=a.helperMissing;d="\n        <li>";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"vip_product_prop_streaming",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</li>\n        "},8:function(b,a,d,e){var c;d=a.helperMissing;var g='\n<div class="vip_web_tier_2-description active">\n    <p>',f=a["if"].call(b,b&&b.isCreatorLanding,{name:"if",hash:{},fn:this.program(2,e),inverse:this.program(9,e),data:e});if(f||0===f)g+=f;g+="</p>\n    <ul>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_host_shields",{name:"i18n-g",hash:{tier:"Platinum"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_credits_per_month",{name:"i18n-g",hash:{credits:"5,000 - 7,400"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_rooms_and_live",{name:"i18n-g",hash:{live:"2",rooms:"5"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_hours",{name:"i18n-g",hash:{hours:"6"},data:e})))||0===f)g+=f;g+=" ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_broadcasting",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n    </ul>\n    <ul>\n        ";if((f=a["if"].call(b,b&&b.canSeeYouTube,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_loyalty_credits",{name:"i18n-g",hash:{url:"https://help.imvu.com/s/article/How-do-the-VIP-5000-Credits-Work?language=en_US",credits:"200"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_tips",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_support",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_gifts",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_whisper",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_no_ads",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_creator",{name:"i18n-g",hash:{url:"https://www.imvu.com/creatorlanding/explore"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_dressup",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_avatar_actions",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_percent_off_everything",{name:"i18n-g",hash:{percent:"5"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_percent_off_badges",{name:"i18n-g",hash:{percent:"10"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_shop_together",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</li>\n    </ul>\n</div>\n"},9:function(b,a,d,e){var c,g=a.helperMissing;d="\n        ";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"vip_product_prop_description",{name:"i18n-g",hash:{tier:"Platinum"},data:e})))||0===a)d+=a;return d+"\n    "},11:function(b,a,d,e){var c;d=a.helperMissing;var g='\n<div class="vip_web_tier_3-description">\n    <p>',f=a["if"].call(b,b&&b.isCreatorLanding,{name:"if",hash:{},fn:this.program(2,e),inverse:this.program(12,e),data:e});if(f||0===f)g+=f;g+="</p>\n    <ul>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_host_shields",{name:"i18n-g",hash:{tier:"Diamond"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_credits_per_month",{name:"i18n-g",hash:{credits:"6,000 - 8,400"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_rooms_and_live",{name:"i18n-g",hash:{live:"3",rooms:"10"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_unlimited",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+=" ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_broadcasting",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_unlimited",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+=" ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_friend_matches",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n    </ul>\n    <ul>\n        ";if((f=a["if"].call(b,b&&b.canSeeYouTube,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_loyalty_credits",{name:"i18n-g",hash:{url:"https://help.imvu.com/s/article/How-do-the-VIP-5000-Credits-Work?language=en_US",credits:"200"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_tips",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_support",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_gifts",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_whisper",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_no_ads",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_creator",{name:"i18n-g",hash:{url:"https://www.imvu.com/creatorlanding/explore"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_dressup",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_avatar_actions",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_percent_off_everything",{name:"i18n-g",hash:{percent:"5"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_percent_off_badges",{name:"i18n-g",hash:{percent:"10"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_shop_together",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_daily_spin",{name:"i18n-g",hash:{spins:"2"},data:e})))||0===f)g+=f;return g+"</li>\n    </ul>\n</div>\n"},12:function(b,a,d,e){var c,g=a.helperMissing;d="\n        ";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"vip_product_prop_description",{name:"i18n-g",hash:{tier:"Diamond"},data:e})))||0===a)d+=a;return d+"\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d="";var c=a["if"].call(b,b&&b.vip_web_tier_1,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(c||0===c)d+=c;d+="\n\n";if((c=a["if"].call(b,b&&b.vip_web_tier_2,{name:"if",hash:{},fn:this.program(8,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n";if((c=a["if"].call(b,b&&b.vip_web_tier_3,{name:"if",hash:{},fn:this.program(11,e),inverse:this.noop,data:e}))||0===c)d+=c;return d},useData:!0})}({}),Ma=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;return"\n        "+d((c=a.header_text||b&&b.header_text,"function"===typeof c?c.call(b,{name:"header_text",hash:{},data:e}):c))+"\n    "},3:function(b,a,d,e){var c;d=this.escapeExpression;return"\n        "+d((c=a.category||b&&b.category,"function"===typeof c?c.call(b,{name:"category",hash:{},data:e}):c))+"\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d='\n<legend class="system-info-header">\n    ';if((b=a["if"].call(b,b&&b.header_text,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===b)d+=b;return d+"\n    <span class='more-items hidden'>\n        <span class='indicator'>+&nbsp;</span><span class='description'></span>\n    </span>\n</legend>\n"},useData:!0})}({}),Na=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;var g=a.helperMissing,f="\n        ",h=a["if"].call(b,b&&b.is_popular,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e});if(h||0===h)f+=h;f+='\n\n        <div class="left">\n            <div class="icon icon-wrapper"><img src="'+d((c=a.image||b&&b.image,"function"===typeof c?c.call(b,{name:"image",hash:{},data:e}):c))+'"></div>\n        </div>\n        <div class="middle">\n            <div class="line1">'+d((c=a.title||b&&b.title,"function"===typeof c?c.call(b,{name:"title",hash:{},data:e}):c))+'</div>\n            <div class="line2">'+d((c=a.line2_text||b&&b.line2_text,"function"===typeof c?c.call(b,{name:"line2_text",hash:{},data:e}):c))+'</div>\n            <div class="line3">\n                ';if((h=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n                <span class="sale-price">'+d((c=a.sale_price||b&&b.sale_price,"function"===typeof c?c.call(b,{name:"sale_price",hash:{},data:e}):c))+'</span>\n            </div>\n        </div>\n        <div class="right">\n            <div class="inner">\n                <span class="label-active hidden">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"ACTIVE",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"</span>\n            </div>\n        </div>\n    "},2:function(b,a,d,e){var c,g=a.helperMissing;d='\n            <div class="promo-banner most-popular"><span>';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"MOST POPULAR",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+'</span><div class="triangle"></div></div>\n        '},4:function(b,a,d,e){var c;d=this.escapeExpression;return'\n                    <span class="original-price">'+d((c=a.price||b&&b.price,"function"===typeof c?c.call(b,{name:"price",hash:{},data:e}):c))+"</span>\n                "},6:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f="\n\n        ",h=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e});if(h||0===h)f+=h;f+="\n\n        <span class='pend-multiplier hidden' pend-count='0'>\n            <div class=\"pend-tooltip\">\n                <div class=\"tooltip-header\">";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"PENDING_TOOLTIP_TITLE",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n                <div class="tooltip-body">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"PENDING_TOOLTIP_DESC",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</div>\n            </div>\n        </span>\n        <span class='multiplier' cart-count='0'></span>\n\n        ";if((h=a["if"].call(b,b&&b.is_popular,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===h)f+=h;f+="\n\n        ";if((h=a["if"].call(b,b&&b.is_best,{name:"if",hash:{},fn:this.program(9,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n        <div class="item-info">\n            <div class="image-container icon-wrapper"><span class="helper"></span><img src="'+g((c=a.image||b&&b.image,"function"===typeof c?c.call(b,{name:"image",hash:{},data:e}):c))+'"></div>\n            <div class="title">'+g((c=a.title||b&&b.title,"function"===typeof c?c.call(b,{name:"title",hash:{},data:e}):c))+'</div>\n            <div class="title2">'+g((c=a.title2||b&&b.title2,"function"===typeof c?c.call(b,{name:"title2",hash:{},data:e}):c))+'</div>\n            <div class="title3">'+g((c=a.title3||b&&b.title3,"function"===typeof c?c.call(b,{name:"title3",hash:{},data:e}):c))+'</div>\n            <div class="icon icon-ok"></div>\n        </div>\n        <div class="item-price">\n            ';if((h=a["if"].call(b,b&&b.isActive,{name:"if",hash:{},fn:this.program(11,e),inverse:this.program(13,e),data:e}))||0===h)f+=h;return f+"\n        </div>\n    "},7:function(b,a,d,e){var c;d=this.escapeExpression;return'\n            <div class="promo-banner sale">'+d((c=a.sale_copy||b&&b.sale_copy,"function"===typeof c?c.call(b,{name:"sale_copy",hash:{},data:e}):c))+'<div class="triangle"></div></div>\n        '},9:function(b,a,d,e){var c,g=a.helperMissing;d='\n            <div class="promo-banner best-value"><span>';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"BEST VALUE",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+'</span><div class="triangle"></div></div>\n        '},11:function(b,a,d,e){var c,g=a.helperMissing;d="\n                <span>";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"ACTIVE",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</span>\n            "},13:function(b,a,d,e){var c;d=this.escapeExpression;var g="\n                \x3c!-- sales_price is source of truth, if discount show original price with sales price --\x3e\n                ",f=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e});if(f||0===f)g+=f;return g+'\n                <span class="sale-price">'+d((c=a.sale_price||b&&b.sale_price,"function"===typeof c?c.call(b,{name:"sale_price",hash:{},data:e}):c))+"</span>\n            "},15:function(b,a,d,e){return'\n    <div class="separator"></div>\n'},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d='<div class="wrapper">\n    ';var c=a["if"].call(b,b&&b.isMobileAndUpsell,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(6,e),data:e});if(c||0===c)d+=c;d+="\n</div>\n";if((c=a["if"].call(b,b&&b.isMobileAndUpsell,{name:"if",hash:{},fn:this.program(15,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"\n"},useData:!0})}({}),Oa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;return'<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-ghost btn-dark" data-confirm="no">'+d((c=a.no||b&&b.no,"function"===typeof c?c.call(b,{name:"no",hash:{},data:e}):c))+'</button>\n    <button class="btn btn-primary btn-dark" data-confirm="yes">'+d((c=a.yes||b&&b.yes,"function"===typeof c?c.call(b,{name:"yes",hash:{},data:e}):c))+"</button>\n<\/script>\n"},useData:!0})}({}),Pa=function(k){var b=k.AlloyAlertDialog;return b.extend("AlloyConfirmDialog",{uiContextName:"confirm_dialog_alloy",className:"confirm-dialog-alloy",trackedEvents:function(){return[{type:"click",selector:'[data-confirm="yes"]',name:"confirm",handler:"__onConfirm",attributes:{which:this.__confirmDialogType}},{type:"click",selector:'[data-confirm="no"]',name:"deny",handler:"__onDeny",attributes:{which:this.__confirmDialogType}}]},initialize:function(a){a.title=a.title;a.text=a.text;this.yes=a.yes;this.no=a.no;this.__confirmDialogType=a.confirmDialogType;this.darkText=IMVU.optionalProperty(a,"dark_text",!1);this.eventAttributes=IMVU.optionalProperty(a,"eventAttributes",{});b.prototype.initialize.call(this,a)},postRender:function(){b.prototype.postRender.call(this);this.$el.attr("data-type","confirm");this.setContent("body",k.template,{yes:this.yes,no:this.no});var a=this.$(".dialog-footer-template");this.$(".dialog-footer").html("");this.setContent("footer",a.last().text());this.darkText&&this.$el.addClass("dark-text")},__onConfirm:function(){var a=_.extend(this.getResult(),{confirm:"yes"});this.promiseResolver.resolve(a);this.hide()},__onDeny:function(){var a=_.extend(this.getResult(),{confirm:"no"});this.promiseResolver.reject(a);this.hide()},__getUiAttributes:function(a){return _.extend(this.eventAttributes,b.prototype.__getUiAttributes.call(this,a))}})}({AlloyAlertDialog:A,template:Oa}),Qa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c,g=a.helperMissing;d='\n        <button class="btn btn-primary btn-dark disabled">\n            ';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"IN CART",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n        </button>\n    "},3:function(b,a,d,e){var c,g=a.helperMissing;d=this.escapeExpression;var f='\n        <button class="btn btn-primary btn-dark">\n            ';if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"ADD TO CART FOR",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+"&nbsp;<span>"+d((c=a.sale_price||b&&b.sale_price,"function"===typeof c?c.call(b,{name:"sale_price",hash:{},data:e}):c))+"</span>\n        </button>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c,g=this.escapeExpression;d='<div class="multicart-upgrade-panel">\n    <img class="product-ad" src="'+g((c=a.product_ad_url||b&&b.product_ad_url,"function"===typeof c?c.call(b,{name:"product_ad_url",hash:{},data:e}):c))+'">\n    <div class="title">\n        '+g((c=a.subtitle||b&&b.subtitle,"function"===typeof c?c.call(b,{name:"subtitle",hash:{},data:e}):c))+'\n    </div>\n    <div class="description"></div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    ';if((b=a["if"].call(b,b&&b.in_cart,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===b)d+=b;return d+"\n<\/script>\n"},useData:!0})}({}),Ra=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("MultiCartUpgrade",{className:"multicart-upgrade-dialog dialog-type-B",uiContextName:"multicart_upgrade_dialog",dependencies:["dollarStoreManager","featureAccessManager","globalStringManager","model"],trackedEvents:function(){return[{type:"click",selector:".btn-primary",name:"add_to_cart",handler:"__addToCart"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__model.node.attributes.name;this.__cartCollection=IMVU.optionalProperty(a,"cartCollection",null);this.__inCart=!1;this.__package_map={};this.__package_map.dlg_namechange={subtitle_key:"UPGRADE_NAME_CHANGE_TOKEN_TITLE",desc_key:"UPGRADE_NAME_CHANGE_TOKEN_DESC"};this.__package_map.dlg_accesspass={subtitle_key:"UPGRADE_ACCESS_PASS_TITLE",desc_key:"UPGRADE_ACCESS_PASS_DESC"};this.__package_map.dlg_namereg={subtitle_key:"UPGRADE_NAME_REGISTRATION_TITLE",desc_key:"UPGRADE_NAME_REGISTRATION_DESC"};this.__package_map.dlg_ageverify={subtitle_key:"UPGRADE_AGE_VERIFICATION_TITLE",desc_key:"UPGRADE_AGE_VERIFICATION_DESC"};this.__package_map.dlg_sharedroom={subtitle_key:"UPGRADE_SHARED_ROOM_TITLE",desc_key:"UPGRADE_SHARED_ROOM_DESC"};this.__package_map.dlg_chatroomslot={subtitle_key:"UPGRADE_CHATROOM_SLOT_TITLE",desc_key:"UPGRADE_CHATROOM_SLOT_DESC"};this.__package_map.dlg_marriagepackage={subtitle_key:"UPGRADE_MARRIAGE_LICENSE_TITLE",desc_key:"UPGRADE_MARRIAGE_LICENSE_DESC"};this.__package_map.dlg_vip={subtitle_key:"UPGRADE_VIP_TITLE",desc_key:"UPGRADE_VIP_DESC"};this.__package_map.dlg_tiered_vip={subtitle_key:"UPGRADE_VIP_TITLE",desc_key:"UPGRADE_"+this.__model.node.get("code_name")};this.__package_map.dlg_host_subscription={subtitle_key:"UPGRADE_HOST_SUB_TITLE",desc_key:"UPGRADE_HOST_SUB_DESC",dlg_title:"UPGRADE_HOST_SUB_DLG_TITLE"};this.__package_map.dlg_credits={subtitle_key:"UPGRADE_CREDITS_TITLE",desc_key:"UPGRADE_CREDITS_DESC"};this.__package_map.vcoin={subtitle_key:"UPGRADE_VCOIN_TITLE",desc_key:"UPGRADE_VCOIN_DESC",dlg_title:"UPGRADE_VCOIN_DLG_TITLE"};this.__package_map.dlg_badge_canvas={subtitle_key:"UPGRADE_BADGE_CANVAS_SUBTITLE",desc_key:"UPGRADE_BADGE_CANVAS_DESC"};this.__dlgName=this.__model.node.get("dlg_name");(a=this.__package_map[this.__dlgName])?(this.__subtitle=this.__globalStringManager.get(a.subtitle_key),this.__description=this.__globalStringManager.get(a.desc_key),a.dlg_title&&(this.title=this.__globalStringManager.get(a.dlg_title))):(this.__subtitle=this.__globalStringManager.get("UPGRADE_CREDITS_TITLE"),this.__description=this.__globalStringManager.get("UPGRADE_CREDITS_DESC"));"dlg_tiered_vip"==this.__model.node.get("dlg_name")&&(a={},this.__description=k.multiProductUpsellVipTiers((a[this.__model.node.get("code_name")]=1,a.canSeeYouTube=this.__featureAccessManager.canSeeYouTubePreRecorded(),a)));this.addToDOM();this.$(".dialog-container").addClass(this.__dlgName)},postRender:function(){this.__cartCollection&&this.__package_map[this.__dlgName]&&("vip"===this.__model.node.attributes.category||"hosting"===this.__model.node.attributes.category)&&(this.__inCart=this.__isMatchingProductId());this.setContent("body",k.template,{product_ad_url:this.__model.node.get("dlg_background_url"),subtitle:this.__subtitle,sale_price:this.__model.edge.attributes.sale_price_formatted,in_cart:this.__inCart});this.$(".description").html(this.__description);this.setContent("footer",this.$(".dialog-footer-template").text())},__addToCart:function(){this.close();this.__model.trigger("select_and_add_item_to_cart")},__isMatchingProductId:function(){return!_.isEmpty(_.filter(this.__cartCollection.models,function(a){if(void 0!==this.__model.node.attributes.id&&void 0!==a.attributes.node.id)return this.__model.node.attributes.id===a.attributes.node.id}.bind(this)))}})}({Dialogs:l["@Dialogs"],Model:l["@Model"],UiCore:l["@UiCore"],multiProductUpsellVipTiers:B,template:Qa}),Sa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;return"\n            <p class='desc'>"+d((c=a.email_msg||b&&b.email_msg,"function"===typeof c?c.call(b,{name:"email_msg",hash:{},data:e}):c))+"</p>\n        "},3:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression;return"\n            <p class='desc'>"+g((c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"TwoFactorChallenge.desc",{name:"i18n-g",hash:{},data:e})))+"</p>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;var g=a.helperMissing,f='<div class="content-container">\n    <div class="content-block">\n        ',h=a["if"].call(b,b&&b.email_msg,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(h||0===h)f+=h;return f+"\n        <div class='input-panel'>\n            <input class='two-factor-code' required maxlength='6' placeholder=\""+d((c=a.placeholder||b&&b.placeholder,"function"===typeof c?c.call(b,{name:"placeholder",hash:{},data:e}):c))+"\">\n            <div class='enrollment-error'></div>\n        </div>\n\n        <div class='link-panel'>\n            <p class='change-email'>\n                "+d((c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"TwoFactorEnrollment.cant_access_email",{name:"i18n-g",hash:{},data:e})))+"\n                <span class='change-email'>"+d((c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"TwoFactorEnrollment.change_email",{name:"i18n-g",hash:{},data:e})))+"</span>\n            </p>\n            <p class='new-code'>\n                "+d((c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"TwoFactorEnrollment.need_another_code",{name:"i18n-g",hash:{},data:e})))+"\n                <span class='new-code'>"+d((c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"TwoFactorEnrollment.send_a_new_code",{name:"i18n-g",hash:{},data:e})))+'</span>\n            </p>\n        </div>\n\n    </div>\n</div>\n\n<footer class="dialog-footer">\n    <button class="btn btn-primary disabled submit">'+d((c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"Continue",{name:"i18n-g",hash:{},data:e})))+"</button>\n</footer>\n"},useData:!0})}({}),Ta=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="content-container">\n    <div class="content-block">\n        <legend class="system-info-header">\n            ',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"email address",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='\n        </legend>\n\n        <div class=\'input-panel\'>\n            <input class=\'two-factor-email\' required placeholder="Email">\n            <ul class=\'email-error\'>\n                <li class="error-message hidden"></li>\n            </ul>\n            <input class=\'two-factor-password\' type="password" required placeholder="Password">\n            <ul class=\'password-error\'>\n                <li class="error-message hidden"></li>\n            </ul>\n        </div>\n\n    </div>\n</div>\n\n<footer class="dialog-footer">\n    <button class="btn btn-primary send-code disabled">\n        ';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"TwoFactorChangeEmail.button",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"\n    </button>\n</footer>\n"},useData:!0})}({}),C=function(k){return IMVU.BaseClass.extend("StringManager",{dependencies:["cookieManager","dictionary","window"],initialize:function(b){this.__cookieManager=b.cookieManager;this.__dictionary=b.dictionary;this.__window=b.window;if(!this.__dictionary)throw Error("StringManager requires a dictionary");this.__appMonitor=null;this.serviceProvider=b.serviceProvider},__getAppMonitor:function(){if(!this.__appMonitor&&this.serviceProvider.has("appMonitor")){var b=this.serviceProvider.get("appMonitor");b&&(this.__appMonitor=b)}return this.__appMonitor},__process_placeholders:function(b,a){_.each(a,function(d,e){b=b.replace(new RegExp("{{\\s*"+e+"\\s*}}","g"),d)});return b},isImvuese:function(){return"1"===this.__cookieManager.get("imvuese")},get:function(b,a){if(this.isImvuese())return"{"+b+"}";var d=this.__dictionary[b];if(!_.isString(d))throw a='Unable to find text: "'+b+'" in translation dictionary. Use getWithDefault to set default value.',this.__getAppMonitor()?this.__appMonitor.reportCustomError("StringManager","get","web_perm_0018",a,["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]):this.__window.appMonitorPending.push(["UIContextExtension","initialize","web_perm_0018",a,["Bad key["+b+"]"]]),Error(a);return this.__process_placeholders(d,a)},getWithDefault:function(b,a,d){if(this.isImvuese())return"{"+b+"}";if("string"!==typeof a)throw Error("defaultText must be a string, but got "+IMVU.repr(a));b=this.__dictionary[b];return _.isString(b)?this.__process_placeholders(b,d):a},getPluralized:function(b,a){if(this.isImvuese())return"{"+b+"}";var d=parseInt(a.howMany,10);return 0===d?this.get(b+"_none",a):this.get(b+(2>d?"_singular":"_plural"),a)},handlebarsHelper:function(b,a){return this.get(b,a.hash)},handlebarsHelperWithDefault:function(b,a,d){return this.getWithDefault(b,a,d)}})}({}),Ua=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("TwoFactorChangeEmail",{uiContextName:"two_factor_change_email_dialog",className:"two-factor-change-email-dialog dialog-type-B",dependencies:"dialogManager globalStartupModel globalStringManager loginManager rest serviceProvider".split(" "),trackedEvents:function(){return[{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack},{type:"keyup",selector:".two-factor-email",name:"typing_email",handler:this.__onTypingEmail},{type:"click",selector:".btn-primary",name:"send_code",handler:this.__sendCode}]},initialize:function(a){b.prototype.initialize.call(this,a);this.shouldFocusOnPrimaryButton=!1;this.title=this.__globalStringManager.get("TwoFactorChangeEmail.title");this.__myself=a.loginManager.getCurrentUser();this.__settingsDict=this.__serviceProvider.create(k.StringManager,{dictionary:k.settingsDict});this.addToDOM()},delete:function(){b.prototype.delete.call(this)},close:function(){this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.setContent("body",k.template,{});this.$("input.two-factor-email").focus()},__goBack:function(){this.hide();this.promiseResolver.reject()},__onTypingEmail:function(){var a=this.$("input.two-factor-email").val();/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,3}$/.test(String(a).toLowerCase())?this.$(".btn-primary").removeClass("disabled"):this.$(".btn-primary").hasClass("disabled")||this.$(".btn-primary").addClass("disabled")},__sendCode:function(){var a=this.__globalStartupModel.get("changeEmailUrl");this.$(".error-message").addClass("hidden");this.__rest.post(a,{new_email:this.$("input.two-factor-email").val(),password:this.$("input.two-factor-password").val()}).then(function(d){202===d.xhr.status?this.promiseResolver.resolve({code:"change_email_challenge",new_email:this.$("input.two-factor-email").val(),password:this.$("input.two-factor-password").val(),email_url:this.__globalStartupModel.get("changeEmailUrl")}):(this.trigger("new_email_address_saved"),this.promiseResolver.resolve({code:"new_email_saved",new_email:this.$("input.two-factor-email").val()}))}.bind(this)).catch(function(d){var e="",c=!1;switch(d.error.error){case"CHANGE_EMAIL-001":d=this.__settingsDict.get("CHANGE_EMAIL_SAME_AS_OLD");e=".email-error";break;case"CHANGE_EMAIL-002":d=this.__settingsDict.get("CHANGE_EMAIL_ALREADY_IN_USE");e=".email-error";break;case"CHANGE_EMAIL-003":d=this.__settingsDict.get("CHANGE_EMAIL_INVALID_FORMAT");e=".email-error";break;case"CHANGE_EMAIL-004":d=this.__settingsDict.get("CHANGE_EMAIL_WRONG_PASSWORD");e=".password-error";break;case"CHANGE_EMAIL-005":d=this.__settingsDict.get("CHANGE_EMAIL_CHANGED_RECENTLY");c=!0;break;case"CHANGE_EMAIL-006":d=this.__settingsDict.get("CHANGE_EMAIL_ACCOUNT_ON_HOLD");e=".email-error";break;default:d=d.error.message}c?this.__dialogManager.alert({title:this.__globalStringManager.get("oops"),text:d,ok:this.__globalStringManager.get("OK")}):(this.$(e+" .error-message").text(d),this.$(e+" .error-message").removeClass("hidden"))}.bind(this))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],settingsDict:l["json!/common/withme/i18n/settings.json"],StringManager:C,template:Ta}),Va=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("TwoFactorEnrollment",{uiContextName:"two_factor_enrollment_dialog",className:"two-factor-enrollment-dialog dialog-type-B",dependencies:["dialogManager","globalStringManager","loginManager","securitySettingsManager","window"],trackedEvents:function(){return[{type:"click",selector:".btn-primary",name:"continue",handler:this.__clickContinue},{type:"input",selector:".two-factor-code",name:"typing_code",handler:this.__onTypingCode},{type:"keyup",selector:".two-factor-code",name:"typing_code",handler:this.__onKeyUp},{type:"click",selector:"span.change-email",name:"change_email",handler:this.__clickChangeEmail},{type:"click",selector:"span.new-code",name:"new_code",handler:this.__clickSendNewCode}]},initialize:function(a){b.prototype.initialize.call(this,a);this.shouldFocusOnPrimaryButton=!1;this.title=this.__globalStringManager.get("TwoFactorEnrollment.title");this.__myself=this.__loginManager.getCurrentUser();this.__isEnabling=IMVU.optionalProperty(a,"isEnabling",!0);this.__regex_not_allowed=/[ ]/gi;this.__securitySettingsManager.toggle2FA({enabling:this.__isEnabling}).then(function(d){if(d.error&&"failure"===d.error.status||d.error&&"NetworkFailure"===d.error.error){var e=d.error.message;"SECURITY_SETTINGS-003"===d.error.error&&(e=this.__globalStringManager.get("TwoFactorEnrollment.apple_signed_in"));this.__dialogManager.showDialog(k.Dialogs.AlloyAlertDialog,{title:this.__globalStringManager.get("Error"),text:e,ok:this.__globalStringManager.get("OKAY")}).finished.then(function(){this.addToDOM()}.bind(this)).catch(function(){this.close()}.bind(this))}else{this.__email_msg=null;if(d.response&&d.response.message&&d.response.details)try{this.__email_addr=d.response.details.email_address,this.__email_msg=d.response.message.replace("%email_address",this.__email_addr)}catch(c){this.__window.console.error(c)}this.addToDOM()}}.bind(this))},close:function(){this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},postRender:function(){this.setContent("body",k.template,{email_msg:this.__email_msg,placeholder:this.__globalStringManager.get("TwoFactorEnrollment.code_placeholder")});!1===this.__isEnabling&&this.$(".change-email").addClass("hidden")},__onKeyUp:function(a){a.keyCode===k.NextUtil.Keys.VK_ENTER&&(this.$(".btn-primary").hasClass("disabled")||this.__clickContinue())},__onTypingCode:function(){var a=this.$("input.two-factor-code").val();-1<a.search(this.__regex_not_allowed)&&(a=a.replace(this.__regex_not_allowed,""),this.$("input.two-factor-code").val(a));a&&a.length===this.$("input.two-factor-code")[0].maxLength?this.$(".btn-primary").removeClass("disabled"):this.$(".btn-primary").hasClass("disabled")||(this.$(".btn-primary").addClass("disabled"),this.$(".enrollment-error").removeClass("error-visible"),this.$(".two-factor-code").removeClass("error-visible"))},__clickContinue:function(){this.__securitySettingsManager.toggle2FA({enabling:this.__isEnabling,code:this.$("input.two-factor-code").val()}).then(function(a){200===a.xhr.status?this.promiseResolver.resolve("valid_code"):(a&&a.error?(this.$(".enrollment-error").addClass("error-visible"),"SECURITY_SETTINGS-002"===a.error.error?this.$(".enrollment-error").text(this.__globalStringManager.get("TwoFactorEnrollment.incorrect_code")):this.$(".enrollment-error").text(a.error.message)):(this.$(".enrollment-error").addClass("error-visible"),this.$(".enrollment-error").text(this.__globalStringManager.get("message_error.generic_title"))),this.$(".two-factor-code").addClass("error-visible"))}.bind(this)).catch(function(){this.$(".enrollment-error").addClass("error-visible");this.$(".enrollment-error").text(this.__globalStringManager.get("message_error.generic_title"))}.bind(this))},__clickChangeEmail:function(){this.__dialogManager.showDialog(k.TwoFactorChangeEmail,{}).finished.then(function(a){"new_email_saved"===a.code?(a=this.__obfuscateEmail(a.new_email),this.__email_msg=this.__email_msg.replace(this.__email_addr,a),this.__email_addr=a,this.$(".content-block p.desc").text(this.__email_msg)):this.__window.console.log("Unexpected error, resp:",a)}.bind(this)).catch(function(){}.bind(this))},__obfuscateEmail:function(a){a=a.split("@");var d=a[0].length,e=3<d?a[0].substr(d-3):"";e=e.padStart(d,"*");return[e,"@",a[1]].join("")},__clickSendNewCode:function(){this.__securitySettingsManager.toggle2FA({enabling:this.__isEnabling}).then(function(a){var d=this.__globalStringManager.get("message_error.generic_title"),e=this.__globalStringManager.get("TwoFactorNewCode.title");a.response?d="SECURITY_SETTINGS-001"===a.response.error?this.__globalStringManager.get("TwoFactorNewCode.desc"):a.response.message:a.error&&(d=a.error.message,e=this.__globalStringManager.get("oops"));this.__dialogManager.showDialog(k.Dialogs.AlloyAlertDialog,{title:e,text:d,ok:this.__globalStringManager.get("OKAY"),postToParent:!1})}.bind(this))}})}({Dialogs:l["@Dialogs"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],TwoFactorChangeEmail:Ua,template:Sa}),D=function(k){var b=k.Dialogs.AlloyConfirmDialog;return b.extend("TwoFactorSetupAlert",{uiContextName:"two_factor_setup_alert_dialog",className:"two-factor-setup-alert-dialog",dependencies:["dialogManager","globalStringManager","loginManager","securitySettingsManager"],initialize:function(a){this.__dialogManager=a.dialogManager;this.__stringManager=a.globalStringManager;this.__requireSetup=IMVU.optionalProperty(a,"requireSetup",!0);var d=a.text?a.text:this.__requireSetup?this.__stringManager.get("TwoFactorSetupAlert.text"):this.__stringManager.get("TwoFactorSetupAlert.optional_text");a=_.extend({title:this.__stringManager.get("TwoFactorSetupAlert.title"),html:d,yes:this.__stringManager.get("TwoFactorSetupAlert.setup"),no:this.__requireSetup?this.__stringManager.get("CANCEL"):this.__stringManager.get("TwoFactorSetupAlert.skip")},a);b.prototype.initialize.call(this,a);this.$el.removeClass("can-dismiss")},__onConfirm:function(){this.__dialogManager.showDialog(k.TwoFactorEnrollment,{isEnabling:!0}).finished.then(function(){this.promiseResolver.resolve()}.bind(this)).catch(function(){this.promiseResolver.reject()}.bind(this))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],TwoFactorEnrollment:Va}),Wa=function(k){var b=k.Dialogs.AlloyConfirmDialog;return b.extend("LinkUpholdDialog",{uiContextName:"link_uphold_dialog",className:"link-uphold-dialog",dependencies:["globalStringManager","loginManager"],trackedEvents:function(){return[{type:"click",name:"link_uphold_account",selector:"[data-confirm=yes]",handler:this.__onLink},{type:"click",name:"cancel_linking_uphold_account",selector:"[data-confirm=no]",handler:this.__onCancel}]},initialize:function(a){this.__globalStringManager=a.globalStringManager;this.__loginManager=a.loginManager;this.__wallet=IMVU.optionalProperty(a,"wallet",null);null===this.__wallet&&(this.__myself=this.__loginManager.getCurrentUser(),this.__myself.populated().then(function(){this.__wallet=this.__myself.getSingleEdge("wallet")}.bind(this)));a.title=this.__globalStringManager.get("vcoin_link_uphold_account");a.text=this.__globalStringManager.get("vcoin_link_uphold_text");a.yes=this.__globalStringManager.get("Continue");a.no=this.__globalStringManager.get("Cancel");this.hasCloseButton=!1;b.prototype.initialize.call(this,a)},postRender:function(){b.prototype.postRender.call(this)},__onCancel:function(){this.close()},__onLink:function(){this.__wallet.populated().then(function(){this.__upholdLink=this.__wallet.get("uphold_url");this.__window.open(this.__upholdLink,"_blank");this.close()}.bind(this))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"]}),Xa=function(k){var b=k.UiCore.UiContext;return b.extend("MultiProductItem",{uiContextName:"multi_product_item",tagName:"article",className:"multi-product-item",dependencies:"dialogManager dollarStoreManager featureAccessManager globalStringManager googleAnalytics iconManager imageManager leanplum loginManager model securitySettingsManager urlManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".wrapper:not(.is-active) .item-info",name:"choose_product_item",handler:"__userClickedUpper"},{type:"click",selector:".wrapper:not(.is-active) .item-price",name:"choose_product_item",handler:"__userClickedLower"},{type:"click",selector:".wrapper:not(.is-active).upsell",name:"choose_product_item",handler:"__userClickedLower"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__viewType=IMVU.optionalProperty(a,"viewType","row");this.__category=IMVU.optionalProperty(a,"category",null);this.__cartCollection=this.__parentUiContext.getCartCollection?this.__parentUiContext.getCartCollection():null;this.__isMobile=this.__featureAccessManager.isMobile();this.__isUpsell=IMVU.optionalProperty(a,"isUpsell",!1);this.__specialCase=null;this.__userClicked=!1;this.__upsellDialog=IMVU.optionalProperty(a,"upsellDialog",null);this.addToDOM()},render:function(){b.prototype.render.call(this);this.__model.populated().then(function(){this.__category=this.__model.node.get("category");this.__isTieredVIP="vip"===this.__category&&"dlg_tiered_vip"===this.__model.node.get("dlg_name");this.__isActive=-1!==this.__model.edge.get("rules").indexOf("active");this.__renderTemplate();this.$el.data("id",this.__model.node.get("product_packages_id"));this.__isActive?(this.__isTieredVIP&&this.__upsellDialog&&this.__upsellDialog.switchDescription&&this.__upsellDialog.switchDescription(this.__model.node.get("code_name")),this.$el.addClass("is-active"),this.$(".wrapper").addClass("is-active")):(this.listenTo(this.__model,"removed_from_cart",this.__onRemoveFromCart),this.listenTo(this.__model,"select_and_add_item_to_cart",this.__selectAndAddItemToCart),this.listenTo(this.__model,"add_pending_item_to_cart",this.__addPendingItemToCart));this.createChildContext(k.Tooltip,{$replaceElement:this.$(".pend-tooltip"),$tooltipTarget:this.$(".pend-multiplier"),tooltipPosition:"bottom"});this.__isUpsell&&(this.$el.addClass("upsell"),this.$(".wrapper").addClass("upsell"),this.__isActive&&this.$(".label-active").removeClass("hidden"));this.__window.addEventListener("message",this.__receiveMessage.bind(this),!0);this.$el.addClass(this.__viewType+"-view");this.$el.addClass("category-"+this.__category);"vip"===this.__category&&"dlg_tiered_vip"===this.__model.node.get("dlg_name")&&(this.$el.addClass(this.__model.node.get("code_name")),this.$el.addClass("tiered_vip"))}.bind(this))},__selectAndAddItemToCart:function(){this.__selectItem()},__addPendingItemToCart:function(){this.__selectItem({pended:!0})},__confirmVIPDowngrade:function(a){var d=["","gold","platinum","diamond"],e=this.__model.edge.get("metadata.tier"),c=this.__model.node.get("code_name").substr(-1);d=this.__globalStringManager.get("vip_downgrade_"+d[e]+"_to_"+d[c]+"_body");this.__dialogManager.confirm({title:this.__globalStringManager.get("common_subscription_cancel_confirm_dialog_title"),text:d,no:this.__globalStringManager.get("CANCEL"),yes:this.__globalStringManager.get("OKAY")}).finished.then(function(){a()})},__vcoinErrorCheck:function(a,d){d=void 0===d?{}:d;d=d.rules_hit?d.rules_hit:this.__dollarStoreManager.validateMultiCartShoppingRules(this.__model,this.__cartCollection);var e=this.__model.edge.get("metadata.available_for_purchase"),c=this.__dollarStoreManager.getCartVcoinTotal(),g=this.__model.node.attributes.vcoin;if(d.includes("region_blocked")&&!this.__ignoreRegionBlockedRule)this.__upsellDialog?(this.__upsellDialog.trigger("vcoin_product_selected_in_blocked_region"),a()):this.__showVcoinUnavailableDialog(a);else if(d.includes("purchase_limit")&&d.includes("unavailable")||c+g>e)d='<a href="'+this.__urlManager.get("vcoin_limits")+'" target="_blank">'+this.__globalStringManager.get("vcoin_unavailable_limit_reached_error_message_link")+"</a>",d="<p>"+this.__globalStringManager.get("vcoin_unavailable_limit_reached_error_message")+" "+d+".</p>",this.__dialogManager.alert({title:this.__globalStringManager.get("vcoin_unavailable_limit_reached_error_title"),html:d,ok:this.__globalStringManager.get("OKAY"),dark_text:!0}).finished.then(function(){this.__upsellDialog&&this.__upsellDialog.upsellAfterGift&&this.__dialogManager.closeAll()}.bind(this));else{if(d.includes("requires_kyc")&&d.includes("unavailable"))return this.__dialogManager.showDialog(k.LinkUpholdDialog,{}).finished.then(function(){this.$el.removeClass("is-selected")}.bind(this));d.includes("require_2FA")?this.__dollarStoreManager.userHasTwoFactorAuth()?(this.__canBuyVcoinWithRules=!0,a()):this.__securitySettingsManager.get("2fa_enabled").then(function(f){this.__dollarStoreManager.setUserTwoFactorAuthStatus(f["2fa_enabled"]);if(f["2fa_enabled"])this.__canBuyVcoinWithRules=!0,a();else return this.__dialogManager.showDialog(k.TwoFactorSetupAlertDialog,{requireSetup:!0}).finished.then(function(){this.__dollarStoreManager.setUserTwoFactorAuthStatus(!0);this.__canBuyVcoinWithRules=!0;a()}.bind(this))}.bind(this)):a()}},__showVcoinUnavailableDialog:function(a){var d='<a href="'+this.__urlManager.get("unavailable_vcoin")+'" target="_blank">'+this.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_link")+"</a>";d="<p>"+this.__globalStringManager.get("vcoin_unavailable_error_text")+" "+d+"</p>";this.__dialogManager.showDialog(k.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("vcoin_unavailable_error_title"),text:this.__globalStringManager.get("vcoin_unavailable_error_text"),html:d,yes:this.__globalStringManager.get("Continue"),no:this.__globalStringManager.get("CANCEL"),dark_text:!0}).finished.then(function(){this.__ignoreRegionBlockedRule=!0;this.__vcoinErrorCheck(a)}.bind(this))},__userClickedUpper:function(){if(this.__upsellDialog)this.__userClickedLower();else{this.__userClicked=!0;var a=function(){this.__dollarStoreManager.validateAccountStatus(this.__model).then(function(){return this.__dialogManager.showDialog(k.MultiCartUpgrade,{model:this.__model,cartCollection:this.__cartCollection}).finished.then(function(){}.bind(this))}.bind(this))}.bind(this);"vcoin"===this.__category?this.__vcoinErrorCheck(a):a()}},__selectItem:function(a){var d=this;a=void 0===a?{pended:!1}:a;"vip"===this.__category&&this.__productSwap(this.__model,this.__category);var e=this.__dollarStoreManager.validateMultiCartShoppingRules(this.__model,this.__cartCollection);-1!==e.indexOf("require_2FA")&&"vcoin"!==this.__category?this.__dollarStoreManager.userHasTwoFactorAuth()?(e=_.without(e,"require_2FA"),this.__handleSelection(a,e)):this.__securitySettingsManager.get("2fa_enabled").then(function(c){d.__dollarStoreManager.setUserTwoFactorAuthStatus(c["2fa_enabled"]);if(c["2fa_enabled"])e=_.without(e,"require_2FA"),d.__handleSelection(a,e);else return d.__dialogManager.showDialog(k.TwoFactorSetupAlertDialog,{requireSetup:!0}).finished.then(function(){d.__dollarStoreManager.setUserTwoFactorAuthStatus(!0);e=_.without(e,"require_2FA");d.__handleSelection(a,e)})}):"vcoin"===this.__category?e.includes("purchase_limit")||(e=_.without(e,"region_blocked"),this.__vcoinErrorCheck(function(){return d.__handleSelection(a,e)},{rules_hit:e})):-1!==e.indexOf("downgrade")&&"vip"===this.__category?(e=_.without(e,"downgrade"),this.__userClicked?this.__confirmVIPDowngrade(function(){return d.__handleSelection(a,e)}):this.__handleSelection(a,e)):this.__handleSelection(a,e)},__handleSelection:function(a,d){if(_.isEmpty(d)||"vcoin"===this.__category&&this.__canBuyVcoinWithRules){d=parseInt(this.$(".multiplier").attr("cart-count"),10);var e=parseInt(this.$(".pend-multiplier").attr("pend-count"),10);a.pended?this.$(".pend-multiplier").attr("pend-count",++e):(this.__dollarStoreManager.trigger("select_multicart_item",this.__model),this.$el.hasClass("is-selected")||this.$el.addClass("is-selected"),this.$(".multiplier").attr("cart-count",++d));!this.__dollarStoreManager.isLoading()&&this.__userClicked&&this.__dollarStoreManager.trigger("update_persistent_cart",this.__model,d)}else if(this.__userClicked){var c=[];a="";_.each(d,function(g){try{c.push(this.__globalStringManager.get(g))}catch(f){c.push(g)}}.bind(this));c=c.join(" ");a=this.__globalStringManager.get("rules_dialog_title");["apple","google_play"].includes(this.__model.edge.attributes["metadata.provider"])?(c=this.__globalStringManager.get("vip_upsell_previous_subscription_mobile_body",{company:this.__globalStringManager.get("vip_upsell_company_3"),platform:this.__globalStringManager.get("vip_upsell_platform_3")}),a=this.__globalStringManager.get("vip_upsell_previous_subscription_title")):"unavailable"===c&&(c=this.__globalStringManager.get("add_to_cart_error_unavailable_text"));return this.__dialogManager.showDialog(k.Dialogs.AlloyAlertDialog,{title:a,text:c,ok:this.__globalStringManager.get("add_to_cart_error_ok")})}this.__userClicked=!1},__userClickedLower:function(){var a=this,d=null;this.__wasSelected=this.$el.hasClass("is-selected");this.__upsellDialog?d=function(){a.__isTieredVIP&&a.__upsellDialog&&a.__upsellDialog.switchDescription&&a.__upsellDialog.switchDescription(a.__model.node.get("code_name"));a.$el.siblings().removeClass("is-selected");a.$el.toggleClass("is-selected",!a.__wasSelected);a.__upsellDialog.aProductClicked(a.__wasSelected?null:a.__model,a.__category)}:(this.__userClicked=!0,d=function(){this.__selectItem()}.bind(this));"vcoin"===this.__category?this.__vcoinErrorCheck(d):d()},__receiveMessage:function(a){a.data.showDialog&&(this.codeName=a.data.showDialog,this.codeName===this.__model.node.attributes.code_name&&this.__userClickedLower())},__refreshProduct:function(){this.__model.invalidate();this.render()},__renderTemplate:function(){var a=this.__model.edge.get("normal_price")>this.__model.edge.get("sale_price"),d="1"===this.__model.node.get("most_popular"),e=this.__model.node.get("is_best"),c=this.__model.node.get("name"),g=this.__model.node.get("initial_selection");"vip"===this.__category&&(c=this.__model.node.get("name"));this.$el.html(k.template({image:this.__model.node.get("img160x160"),price:this.__model.edge.get("normal_price_formatted"),sale_price:this.__model.edge.get("sale_price_formatted"),title:c,title2:"",title3:"",has_discount:a,is_popular:d,is_best:e,sale_copy:this.__globalStringManager.get("SALE"),isRow:"row"===this.__viewType,isActive:this.__isActive,isMobileAndUpsell:this.__isMobile&&this.__isUpsell,line2_text:"",isVIP:"vip"===this.__category}));""!==this.__model.node.get("svgicon")&&(a=this.__model.node.get("svgicon"),this.$(".icon-wrapper").html(this.__iconManager.iconHtml(a)));this.__isMobile&&this.__isUpsell&&"vip"===this.__category&&this.$(".line2").addClass("hidden");!this.__isUpsell||this.__upsellDialog&&this.__upsellDialog.upsellAfterGift||g&&this.__userClickedLower();g=this.__model.node.get("should_disable");a=this.__model.node.get("disabled");!0===g?(this.$el.addClass("disabled"),this.__model.node.set("should_disable",null)):this.$el.toggleClass("disabled",void 0===a?!1:a)},__onRemoveFromCart:function(a,d){d=void 0!==d?d:!0;a=_.map(a.models,function(e){return e.attributes.node.product_packages_id});-1===_.indexOf(a,this.__model.node.attributes.product_packages_id)?(this.$el.removeClass("is-selected"),a=0):a=this.$(".multiplier").attr("cart-count")-1;this.$(".multiplier").attr("cart-count",a);d&&this.__dollarStoreManager.trigger("update_persistent_cart",this.__model,a)},__productSwap:function(a,d){_.each(this.__cartCollection.models,function(e){if(e&&e.attributes.node.category===d&&a.node.attributes.product_packages_id!==e.attributes.node.product_packages_id)return this.__cartCollection.remove(e),0===this.__cartCollection.length&&this.__dollarStoreManager.trigger("empty_multi_cart"),this.__dollarStoreManager.trigger("update_cart_total_price"),e.attributes.productModel.trigger("removed_from_cart",this.__cartCollection),!1}.bind(this))},_setCartCollection:function(a){this.__cartCollection=a}})}({Dialogs:l["@Dialogs"],NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],AlloyConfirmDialog:Pa,LinkUpholdDialog:Wa,MultiCartUpgrade:Ra,Tooltip:r,TwoFactorSetupAlertDialog:D,template:Na}),Ya=function(k){var b=k.UiCore.ListPresenter;return b.extend("MultiProductList",{className:"multi-product-list",uiContextName:"multi_product_list",tagName:"section",dependencies:["category","featureAccessManager","globalStringManager","platform"],trackedEvents:function(){return[{type:"click",selector:".more-items",name:"more_items",handler:"__onToggleMoreItems"}]},initialize:function(a){this.itemFactory=a.itemFactory||k.MultiProductItem;var d=!a.collection||0===a.collection.length;this.__cartCollection=IMVU.optionalProperty(a,"cartCollection",null);this.__isUpsell=IMVU.optionalProperty(a,"isUpsell",!1);this.__noInitialUpsellSelection=IMVU.optionalProperty(a,"noInitialUpsellSelection",!1);this.__headerText=IMVU.optionalProperty(a,"headerText","");this.__disabledProducts=IMVU.optionalProperty(a,"disabledProducts",[]);this.__selectedProduct=IMVU.optionalProperty(a,"selectedProduct",!1);this.__featureAccessManager=a.featureAccessManager;this.__isUpsell&&!d&&(this.__noInitialUpsellSelection?this.__unsetInitialUpsellSelection(a.collection.models):this.__setInitialUpsellSelection(a.collection.models));b.prototype.initialize.call(this,a);this.__isMobile=this.__featureAccessManager.isMobile();this.$el.prepend(k.template({category:this.__globalStringManager.get(this.__category),header_text:this.__headerText,no_products:d}));this.__isUpsell&&(this.$el.addClass("upsell"),this.__headerText||this.$(".system-info-header").remove());if("credits"===this.__category||"vcoin"===this.__category)"credits"===this.__category?(this.__moreOptionsText=this.__globalStringManager.get("MORE CREDIT OPTIONS"),this.__lessOptionsText=this.__globalStringManager.get("Less Credit Options")):"vcoin"===this.__category&&(this.__moreOptionsText=this.__globalStringManager.get("More VCOIN Options"),this.__lessOptionsText=this.__globalStringManager.get("Less VCOIN Options")),this.$(".system-info-header .more-items .description").text(this.__moreOptionsText),this.$(".system-info-header .more-items").removeClass("hidden"),this.__childSelector="article:nth-of-type(n+4)",this.__isUpsell||this.$(this.__childSelector).addClass("is-collapsed")},getCartCollection:function(){return this.__cartCollection},__setInitialUpsellSelection:function(a){var d=this;if(void 0!==a&&0!==a.length){var e=-1,c=-1;e=a.findIndex(function(g){return"1"===g.node.get("most_popular")});c=a.findIndex(function(g){return(g=g.edge.get("rules"))&&-1!==g.indexOf("active")});a.forEach(function(g,f){g.node.set("should_disable",d.__disabledProducts.includes(f))});!1!==this.__selectedProduct?a[Math.max(0,Math.min(a.length-1,this.__selectedProduct))].node.set("initial_selection",!0):-1!==e&&e>c?a[e].node.set("initial_selection",!0):this.__unsetInitialUpsellSelection(a)}},__unsetInitialUpsellSelection:function(a){void 0!==a&&0!==a.length&&a.forEach(function(d){d.node&&d.node.get("initial_selection")&&d.node.set("initial_selection",!1)})},__onToggleMoreItems:function(){this.$(this.__childSelector).toggleClass("is-collapsed");this.$(this.__childSelector).hasClass("is-collapsed")?(this.$(".more-items .indicator").text("+ "),this.$(".system-info-header .more-items .description").text(this.__moreOptionsText)):(this.$(this.__childSelector).css({transition:"height 0.25s ease"}),this.$(".more-items .indicator").text("- "),this.$(".system-info-header .more-items .description").text(this.__lessOptionsText))}})}({UiCore:l["@UiCore"],MultiProductItem:Xa,template:Ma}),Za=function(k){return IMVU.NamedCollection.extend("CartCollection",{markSelectedProducts:function(){this.each(function(b){b.set("is_selected",!0)}.bind(this))}})}({}),$a=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c,g=a.helperMissing;d="\n    <div class='alert-message title'>";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"payment_processing_error_text_2",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</div>\n"},3:function(b,a,d,e){a=this.escapeExpression;return"\n        <div class='alert-message'>"+a("function"===typeof b?b.apply(b):b)+"</div>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="content-container">\n\n',f=a.unless.call(b,b&&b.isNoHope,{name:"unless",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)g+=f;g+="\n\n    ";if((f=a.each.call(b,b&&b.messages,{name:"each",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n\n    <div class='alert-message summary'>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"payment_processing_error_text_3",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"\n        <a target='_blank' href='https://help.imvu.com/'>help.imvu.com</a>.\n    </div>\n</div>\n"},useData:!0})}({}),ab=function(k){var b=k.Dialogs.AlloyAlertDialog;return b.extend("MultiCartErrorDialog",{uiContextName:"multicart_error_dialog",className:"multicart-error-dialog dialog-type-B",dependencies:["globalStringManager","window"],initialize:function(a){this.__stringManager=a.globalStringManager;this.__keys=IMVU.requireProperty(a,"keys");a.title=this.__stringManager.get("payment_processing_status_title");a.ok=this.__stringManager.get("payment_processing_error_button");this.__storeDictionary=a.serviceProvider.create(k.StringManager,{dictionary:k.storeDictionary});a.serviceProvider.register("storeDictionary",this.__storeDictionary);Handlebars.registerHelper("storeDict_i18n",this.__storeDictionary.handlebarsHelper.bind(this.__storeDictionary));b.prototype.initialize.call(this,a)},postRender:function(){b.prototype.postRender.call(this);var a=[],d=!1,e=!1;_.each(this.__keys,function(c,g,f){try{a.push(this.__storeDictionary.get(c))}catch(h){this.__window.console.error("Error key not found in dict: %s\n%s",c,h),d||(a.push(this.__storeDictionary.get("FCM_default")),d=!0)}"co_blocked"===c&&(e=!0)}.bind(this));this.$(".id-body-contents").html(k.template({messages:a,isNoHope:e}));this.$(".content-container").scrollbar()}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],storeDictionary:l["json!@StoreModeDictionary"],StringManager:C,template:$a}),bb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;return"<iframe class='frame-base' src='"+d((c=a.src||b&&b.src,"function"===typeof c?c.call(b,{name:"src",hash:{},data:e}):c))+"'></iframe>\n"},useData:!0})}({}),cb=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("IframeDialog",{uiContextName:"iframe_dialog",className:"iframe-dialog dialog-type-B",dependencies:"dialogManager globalStartupModel globalStringManager platform rest window".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__platform=a.platform;this.title="undefined"===typeof a.titleID?"":this.__globalStringManager.get(a.titleID);this.__src=a.src;this.__hideHeader="undefined"===typeof a.hideHeader?!0:!0===a.hideHeader;this.__hideFooter="undefined"===typeof a.hideFooter?!0:!0===a.hideFooter;this.addToDOM();a.isCreatorLanding||this.__window.addEventListener("message",this.__receiveMessage.bind(this),!0)},makeSeamless:function(){this.$(".frame-base").hasClass("seamless")||this.$(".frame-base").addClass("seamless")},postRender:function(){this.setContent("body",k.template,{src:this.__src});this.makeSeamless();this.__hideHeader&&(this.$(".dialog-header").addClass("hide"),this.$(".aux-header").addClass("hide"));this.__hideFooter&&this.$(".dialog-footer").addClass("hide")},setClasses:function(a,d){a.removeClass("dialog-type-B");a.removeClass("can-dismiss");a.removeClass("iframe-dialog");a.removeClass(d);a.addClass("iframe-dialog");a.addClass(d);a.addClass("dialog-type-B");a.addClass("can-dismiss")},close:function(){this.__window.removeEventListener("message",this.__receiveMessage.bind(this),!0);b.prototype.close.call(this)},__receiveMessage:function(a){"no_dialog_in_iframe"===a.data.message?b.prototype.close.call(this):"close_iframe_dialog"===a.data.message?b.prototype.close.call(this):("opening_modal_dialog"===a.data.message&&("alert_dialog_alloy"===a.data.type||"confirm_dialog_alloy"===a.data.type||"two_factor_setup_alert_dialog"===a.data.type||"link_uphold_dialog"===a.data.type?this.$(".dialog-x").addClass("hidden"):"payment_wall_dialog"===a.data.type?(this.isUncancellableDialog=!0,this.$el.addClass("payment-wall-open")):this.$(".dialog-x").removeClass("hidden")),"deleting_modal_dialog"===a.data.message?"confirm_dialog_alloy"===a.data.type?this.$(".dialog-x").removeClass("hidden"):"alert_dialog_alloy"===a.data.type?(this.$(".dialog-x").removeClass("hidden"),this.close()):"payment_wall_dialog"===a.data.type&&(this.isUncancellableDialog=!1,this.$el.removeClass("payment-wall-open")):"iframe_open_new_window"===a.data.message&&this.__window.open(a.data.params.url,a.data.params.name?a.data.params.name:"_blank"))},delete:function(){this.__window.removeEventListener("message",this.__receiveMessage.bind(this),!0);b.prototype.delete.call(this)}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],template:bb}),db=function(k){var b=k.IframeBase;return b.extend("PaymentWallDialog",{uiContextName:"payment_wall_dialog",className:"payment-wall-dialog text-close",dependencies:["dialogManager"],trackedEvents:function(){return[]},initialize:function(a){a=_.extend({titleID:"payment_dialog_title",hideHeader:!1,hideFooter:!0},a);b.prototype.initialize.call(this,a);this.makeSeamless();this.addToDOM();this.$el.addClass(a.paymentWallChan)},postRender:function(){b.prototype.postRender.call(this);b.prototype.setClasses(this.$el,this.className);this.__contextualClassRemoved=this.__dialogManager.toggleTransparentOverlaySize(!1)},hide:function(){this.__contextualClassRemoved&&this.__dialogManager.toggleTransparentOverlaySize(!0);b.prototype.hide.call(this)}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],IframeBase:cb}),eb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;return'\n        <div class="title">'+d((c=a.status_prompt||b&&b.status_prompt,"function"===typeof c?c.call(b,{name:"status_prompt",hash:{},data:e}):c))+"</div>\n        "},3:function(b,a,d,e){return"\n            <div class='other-payment-channel-list'>\n                <span class='name'>PAY WITH VCOIN</span>\n                <img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'>\n            </div>            \n    "},5:function(b,a,d,e){d="\n        ";if((b=a["if"].call(b,b&&b.billingInfo,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===b)d+=b;return d+"            \n    "},6:function(b,a,d,e){var c,g=a.helperMissing;d='\n            <legend class="system-info-header">\n                ';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"BILLED TO",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+'\n            </legend>\n            <div class="billing-info"></div>\n        '},8:function(b,a,d,e){d="\n        ";if((b=a["if"].call(b,b&&b.isCheckedoutModel,{name:"if",hash:{},fn:this.program(9,e),inverse:this.noop,data:e}))||0===b)d+=b;return d+"\n        "},9:function(b,a,d,e){var c;d=this.escapeExpression;var g='\n            <div class="order-row">\n                <div class="order-item">\n                    <div class="image-container"><img src="'+d((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.node),null==c||!1===c?c:c.img160x160),"function"===typeof c?c.apply(b):c))+'"></div>\n                    <div class="item-info">\n                        <div class="item-name">'+d((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.node),null==c||!1===c?c:c.name),"function"===typeof c?c.apply(b):c))+"</div>\n                        ";if((c=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(10,e),inverse:this.program(12,e),data:e}))||0===c)g+=c;return g+"\n                    </div>\n                </div>\n            </div>\n        "},10:function(b,a,d,e){var c;a=this.escapeExpression;return'\n                            <div class="product-price"><img src=\'https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg\'><span class="item-info-price">'+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.vcoin_sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</span></div>\n                        "},12:function(b,a,d,e){var c;a=this.escapeExpression;return'\n                            <div class="product-price">'+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</div>\n                        "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;var g=a.helperMissing,f='<div class="payment-content-container">\n    <div class="info-block message">\n        ',h=a["if"].call(b,b&&b.notPaymentWall,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(h||0===h)f+=h;f+='\n        <div class="text">'+d((c=a.status_message||b&&b.status_message,"function"===typeof c?c.call(b,{name:"status_message",hash:{},data:e}):c))+"</div>\n    </div>\n    ";if((h=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(3,e),inverse:this.program(5,e),data:e}))||0===h)f+=h;f+='\n    <legend class="system-info-header">\n        ';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"YOUR ORDER",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='\n    </legend>\n    <div class="order-block">\n        ';if((h=a.each.call(b,b&&b.cart,{name:"each",hash:{},fn:this.program(8,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n    </div>\n    <div class="summary-block">\n        <div>';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"Order",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+=" #"+d((c=a.order_id||b&&b.order_id,"function"===typeof c?c.call(b,{name:"order_id",hash:{},data:e}):c))+"</div>\n        <div>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"Purchase date",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+=": "+d((c=a.order_date||b&&b.order_date,"function"===typeof c?c.call(b,{name:"order_date",hash:{},data:e}):c))+'</div>\n\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-dark btn-primary">\n        ';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"payment_success_button",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"\n    </button>\n<\/script>\n"},useData:!0})}({}),w=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;var g='\n<div class="info-line address">'+d((c=a.address||b&&b.address,"function"===typeof c?c.call(b,{name:"address",hash:{},data:e}):c))+'</div>\n<div class="info-line">'+d((c=a.city||b&&b.city,"function"===typeof c?c.call(b,{name:"city",hash:{},data:e}):c))+", ",f=a["if"].call(b,b&&b.state,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e});if(f||0===f)g+=f;g+=" ";if((f=a["if"].call(b,b&&b.postal_code,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===f)g+=f;return g+d((c=a.country||b&&b.country,"function"===typeof c?c.call(b,{name:"country",hash:{},data:e}):c))+"</div>\n"},2:function(b,a,d,e){var c;d=this.escapeExpression;return" "+d((c=a.state||b&&b.state,"function"===typeof c?c.call(b,{name:"state",hash:{},data:e}):c))+" "},4:function(b,a,d,e){var c;d=this.escapeExpression;return" "+d((c=a.postal_code||b&&b.postal_code,"function"===typeof c?c.call(b,{name:"postal_code",hash:{},data:e}):c))+", "},6:function(b,a,d,e){var c;d=this.escapeExpression;var g=a.helperMissing,f='\n<div class="info-line card-type">'+d((c=a.card_type||b&&b.card_type,"function"===typeof c?c.call(b,{name:"card_type",hash:{},data:e}):c))+" ";if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"ending in",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+" -"+d((c=a.last_four_digits||b&&b.last_four_digits,"function"===typeof c?c.call(b,{name:"last_four_digits",hash:{},data:e}):c))+"</div>\n"},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;d='<div class="info-line name-on-card">'+d((c=a.name||b&&b.name,"function"===typeof c?c.call(b,{name:"name",hash:{},data:e}):c))+"</div>\n";if((c=a["if"].call(b,b&&b.address,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n";if((c=a["if"].call(b,b&&b.last_four_digits,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===c)d+=c;return d},useData:!0})}({}),E=function(k){var b=[{name:"americanexpress",pattern:/^3[47]/},{name:"jcb",pattern:/^35(2[89]|[3-8][0-9])/},{name:"visa",pattern:/^4/},{name:"mastercard",pattern:/^5[1-5]/},{name:"discover",pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/}];return{getType:function(a){for(var d=$jscomp.makeIterator(b),e=d.next();!e.done;e=d.next())if(e=e.value,a.match(e.pattern))return e.name;return null},passesChecksum:function(a){for(var d=0,e=!1,c=a.length-1;0<=c;c--){var g=a.charAt(c);g=parseInt(g,10);e&&(g*=2,9<g&&(g-=9));d+=g;e=!e}return 0===d%10}}}({}),F=function(k){var b=k.UiCore.UiContext;return b.extend("BillingInfo",{className:"billing-info",uiContextName:"billing_info",dependencies:["globalStringManager"],initialize:function(a){b.prototype.initialize.call(this,a);this.__billingInfo=IMVU.requireProperty(a,"billingInfo");this.__CCValidator=k.CCValidator;this.addToDOM()},render:function(){var a="",d="";this.__billingInfo.credit_card&&(a=this.__CCValidator.getType(this.__billingInfo.credit_card),d=this.__billingInfo.credit_card.substring(this.__billingInfo.credit_card.length-4));this.$el.html(k.template({name:this.__billingInfo.name,address:this.__billingInfo.address,city:this.__billingInfo.city,state:this.__billingInfo.state,postal_code:this.__billingInfo.postal_code,country:this.__billingInfo.country,card_type:this.__globalStringManager.get("card_type_"+(a?a:"other")),last_four_digits:d}))}})}({UiCore:l["@UiCore"],CCValidator:E,template:w}),G=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("MultiCartSuccessDialog",{uiContextName:"multicart_success_dialog",className:"multicart-success-dialog dialog-type-B text-none",dependencies:"cart dialogManager dollarStoreManager featureAccessManager globalStartupModel globalStringManager loginManager modeManager onboardingGamificationManager orderResponse prefsManager securitySettingsManager timestampHelper window".split(" "),trackedEvents:function(){return[{type:"click",selector:".btn.btn-primary",name:"multicart_success_done",handler:"__done"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__coreDollarstoreProductOfferingData=IMVU.optionalProperty(a,"coreDollarstoreProductOfferingData",null);this.$el.removeClass("can-dismiss");this.__prefsManager=a.prefsManager;this.__hideCalled=!1;this.__origin=IMVU.optionalProperty(a,"origin",null);this.__billingInfo=IMVU.optionalProperty(a,"billingInfo",null);this.__altTitle=IMVU.optionalProperty(a,"altTitle",null);this.__vipModel=IMVU.optionalProperty(a,"vipModel",null);this.__channel=IMVU.optionalProperty(a,"channel",null);this.isVcoinAsAPaymentMethod=!1;this.title=this.__altTitle?this.__altTitle:this.__globalStringManager.get("payment_success_title");this.ok=this.__globalStringManager.get("payment_success_button");this.__creditsPurchased=this.__vipSubscriptionPurchased=!1;a=IMVU.optionalProperty(a,"cart",[]);this.isVcoinAsAPaymentMethod=a.isVcoinAsAPaymentMethod?!0:!1;for(var d=0;d<a.length;d++){var e=a[d].get("node");var c=e.category;var g=e.code_name;this.__setBadgeLocalStorage(c,g);"credits"===c?this.__creditsPurchased=e.credits:"vip"===c?(this.__vipSubscriptionPurchased=!0,["vip_web_tier_1","vip_web_tier_2","vip_web_tier_3"].includes(g)?this.__vipTierPurchased=g:this.__vipTierPurchased="legacy"):"vcoin"===c&&(this.__vcoinPurchased=!0)}this.addToDOM()},postRender:function(){var a=!1,d=this.__timestampHelper.orderDate(this.__orderResponse.get("order_date")),e=this.__globalStringManager.get("order_thankyou");this.__billingInfo&&(a=this.__billingInfo.name?!0:!1);var c=this.__globalStringManager.get("order_status_message");null!==this.__coreDollarstoreProductOfferingData&&this.__coreDollarstoreProductOfferingData.isAGift&&(e=this.__globalStringManager.get("order_thankyou_gifting"),c=this.__globalStringManager.get("order_status_message_gifting_1")+" "+this.__coreDollarstoreProductOfferingData.recipientDisplayName+" "+this.__globalStringManager.get("order_status_message_gifting_2"));"paypal"===this.__channel?null===this.__vipModel&&(c=this.__globalStringManager.get("paypal_order_status_message")):"paymentwall"===this.__channel&&(c=this.__globalStringManager.get("paymentwall_order_status_message"));var g=parseFloat(this.__orderResponse.attributes["order.price"]).toFixed(2);this.setContent("body",k.template({status_prompt:e,cart:this.__cart,has_name:a,billingInfo:this.__billingInfo,order_date:d,order_id:this.__orderResponse.attributes["order.cash_orders_id"],order_total:g,status_message:c,notPaymentWall:"paymentwall"!==this.__channel}));a?this.createChildContext(k.BillingInfo,{$replaceElement:this.$(".billing-info"),billingInfo:this.__billingInfo}):this.__billingInfo&&!0===this.__billingInfo.saved_card&&this.$(".billing-info").html(k.billingTemplate({last_four_digits:this.__billingInfo.last_four_digits,card_type:this.__globalStringManager.get("card_type_"+this.__billingInfo.card_type)}));this.setContent("footer",this.$(".dialog-footer-template").text());if(this.__window._qevents)for(a=0;a<this.__cart.length;a++)d={qacct:"p-EAkvGxbXCcR77",uid:this.__myCid.toString(),orderid:this.__orderResponse.attributes["order.cash_orders_id"],revenue:this.__cart[a].attributes.edge.sale_price.toString(),event:"refresh"},"vip"==this.__cart[a].attributes.node.category?(d.labels="_fp.event.VIP Confirmation Page,_fp.pcat.vip",this.__window._qevents.push(d)):"upgrade"==this.__cart[a].attributes.node.category&&"access_pass"==this.__cart[a].attributes.node.code_name&&(d.labels="_fp.event.AP Confirmation Page,_fp.pcat.upgrade",this.__window._qevents.push(d));if("creatorlanding"===this.__modeManager.uiApplication){var f=[],h=0;_.each(this.__cart,function(m){f.push({product_name:m.attributes.node.code_name,product_id:m.attributes.node.product_packages_id.toString(),product_category:m.attributes.node.category,product_price:m.attributes.edge.sale_price,product_quantity:1});h+=m.attributes.edge.sale_price});try{h=parseFloat(h.toFixed(2)),this.__window.pintrk("track","checkout",{value:h,order_quantity:this.__cart.length,currency:"USD",order_id:this.__orderResponse.attributes["order.cash_orders_id"],line_items:f},function(m,n){m||this.__appMonitor.reportCustomError("MultiCartSuccess","postRender","web_perm_0005l","Error returned from pintrk callback",["Reported Error: "+n])}.bind(this))}catch(m){this.__appMonitor.reportCustomError("MultiCartSuccess","postRender","web_perm_0005e","Error thrown in call to window.pintrk",["Reported Error: "+m.message])}}},__onClose:function(a){a.preventDefault();this.__done();this.hide()},__done:function(){var a=this;this.__recordEvent("click",{name:"dialog_close"});!1===this.__creditsPurchased||this.__myself.get("is_vip")?this.__vipSubscriptionPurchased?(this.__prefsManager.setBool("next.subscriptions.has_active_vip",!0),this.__prefsManager.set("next.subscriptions.active_tier_vip",this.__vipTierPurchased),this.promiseResolver.resolve("clear_cart"),this.hide(),"store"===this.__modeManager.getCurrentMode().id&&(this.__window.location="/next/store/cart")):this.__vcoinPurchased?(this.__featureAccessManager.canSeeOnboardingGamification()&&this.__recordEvent("onboarding",{name:"grant_reward",event_type:"vcoin_purchase",cid:this.__myself.get("legacy_cid"),record:!0}),this.hide(),this.__securitySettingsManager.get("2fa_enabled").then(function(d){d["2fa_enabled"]?a.promiseResolver.resolve():a.__dialogManager.showDialog(k.TwoFactorSetupAlertDialog,{requireSetup:!1}).finished.then(function(){return a.promiseResolver.resolve()}).catch(function(){return a.promiseResolver.resolve()})}).catch(function(d){a.__window.console.log("Something went wrong:",d);a.promiseResolver.resolve()})):(this.promiseResolver.resolve("clear_cart"),this.hide(),this.__modeManager.getCurrentMode()&&"store"===this.__modeManager.getCurrentMode().id&&(this.__window.location="/next/store/cart")):this.__dialogManager.confirm({title:this.__globalStringManager.get("vip_credit_upsell_title"),text:this.__globalStringManager.get("vip_credit_upsell_body",{credits:this.__creditsPurchased}),yes:this.__globalStringManager.get("vip_credit_upsell_yes"),no:this.__globalStringManager.get("vip_credit_upsell_no")}).finished.then(function(){a.__dialogManager.closeAll();a.__dollarStoreManager.makeVIPUpsell()}).catch(function(){a.promiseResolver.resolve("clear_cart");a.hide();a.__dialogManager.closeAll();"store"===a.__modeManager.getCurrentMode().id&&(a.__window.location="/next/store/cart")})},__handleHostSubRedirectMessageLinkClick:function(){this.__modeManager.openMode({mode:{id:"chat"},submode:{id:"my_rooms"}})},__setBadgeLocalStorage:function(a,d){"vip"===a?this.__setBadgeLocalStorageHelper("is_vip"):"upgrade"===a&&"access_pass"===d&&this.__setBadgeLocalStorageHelper("is_ap")},__setBadgeLocalStorageHelper:function(a){var d={value:!0,expiry:(new Date).getTime()+3e5};localStorage.setItem(a,JSON.stringify(d))},hide:function(){this.__hideCalled||(this.__hideCalled=!0,b.prototype.hide.call(this))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],BillingInfo:F,TwoFactorSetupAlertDialog:D,billingTemplate:w,template:eb}),H=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("MultiCartAbstractBaseDialog",{dependencies:"dollarStoreManager featureAccessManager loginManager Promise rest restModelFactory".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.restModelFactory=a.restModelFactory;this.__eProtectResponse=null},_test_getPoid:function(){return this.__productOfferingID},_testSetBillingInfo:function(a){this.__billingInfo=a},__processingOldDollarstoreProductOffering:function(){return this.__window.location.href.includes("/checkout/")},__getCoreDollarstoreProductOfferingUrlAndId:function(){if(!this.__processingOldDollarstoreProductOffering())return{url:null,id:null};var a=this.__globalStartupModel.get("oldDollarstoreBypassProductOfferingUrl"),d=null;a&&(d=a.split("-"),d=d[d.length-1]);return{url:a,id:d}},__getProductOfferingDataFromCoreDS:function(){var a=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=a.url;this.__coreDollarstoreProductOfferingId=a.id;this.__coreDollarstoreProductOfferingPromise=this.__coreDollarstoreProductOfferingRecipient=this.__coreDollarstoreProductOfferingPurchaser=this.__coreDollarstoreProductOfferingData=null;null!==this.__coreDollarstoreProductOfferingUrl&&(this.__coreDollarstoreProductOfferingPromise=this.__rest.get(this.__coreDollarstoreProductOfferingUrl),this.__coreDollarstoreProductOfferingPromise.then(function(d){this.__coreDollarstoreProductOfferingResponse=d.response;this.__coreDollarstoreProductOfferingPurchaser=this.track(this.restModelFactory.readModel(this.__coreDollarstoreProductOfferingResponse.relations.purchaser,k.UiCore.NodeModel));this.__coreDollarstoreProductOfferingRecipient=this.track(this.restModelFactory.readModel(this.__coreDollarstoreProductOfferingResponse.relations.recipient,k.UiCore.NodeModel));this.__coreDollarstoreProductOfferingPurchaserPromise=this.__coreDollarstoreProductOfferingPurchaser.populated();this.__coreDollarstoreProductOfferingRecipientPromise=this.__coreDollarstoreProductOfferingRecipient.populated();this.__Promise.every([this.__coreDollarstoreProductOfferingPurchaserPromise,this.__coreDollarstoreProductOfferingRecipientPromise]).then(function(){this.__purchaserID=this.__coreDollarstoreProductOfferingPurchaser.get("legacy_cid");this.__purchaserDisplayName=this.__coreDollarstoreProductOfferingPurchaser.get("display_name");this.__recipientID=this.__coreDollarstoreProductOfferingRecipient.get("legacy_cid");this.__recipientDisplayName=this.__coreDollarstoreProductOfferingRecipient.get("display_name");this.__coreDollarstoreProductOfferingData={isAGift:this.__purchaserID!==this.__recipientID,purchaserID:this.__purchaserID,purchaserDisplayName:this.__purchaserDisplayName,recipientID:this.__recipientID,recipientDisplayName:this.__recipientDisplayName}}.bind(this))}.bind(this)).catch(function(d){this.__window.console.error("MultiCartAbstractDialog::__getProductOfferingDataFromCoreDS - error - failed to get product offering",d)}.bind(this)));return this.__coreDollarstoreProductOfferingPromise},creditCardCheckout:function(a){this.__productOfferingID=null;return new this.__Promise(function(d){var e={cart:a.models,cc_payment:this.__billingInfo};!0===this.__billingInfo.saved_card?(e.payment_method="saved_cc_payment",e.card_id=this.__billingInfo.card_id):(e.eprotect=this.__eProtectResponse,e.payment_method="cc_payment");this.__productOfferingID=a.models[0].attributes.edge.product_offering_id;var c=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=c.url;this.__coreDollarstoreProductOfferingId=c.id;this.__coreDollarstoreProductOfferingUrl&&(this.__productOfferingID=this.__coreDollarstoreProductOfferingId);this.__submitVantivOrder(e,this.__productOfferingID).then(function(g){this.__setProcessing(!1);if("delivered"===g.attributes["order.status"]&&"success"===g.attributes["transaction.status"]){var f={expiry:(new Date).getTime()+3e5};localStorage.setItem("successfulVantivOrder",JSON.stringify(f));this.__hostSubscriptionChanged&&(f=parseInt(g.get("order.date_purchased").substring(8,10)),this.__hostSubscriptionChangedText=this.__globalStringManager.get("subscription_changed_text_part_1")+String(f),this.__hostSubscriptionChangedText=1===f||21===f||31===f?this.__hostSubscriptionChangedText+"st, ":2===f||22===f?this.__hostSubscriptionChangedText+"nd, ":3===f||23===f?this.__hostSubscriptionChangedText+"rd, ":this.__hostSubscriptionChangedText+"th, ",this.__hostSubscriptionChangedText+=this.__globalStringManager.get("subscription_changed_text_part_2"));g={billingInfo:this.__billingInfo,cart:a.models,orderResponse:g,channel:"vantiv"};this.__hostSubscriptionChanged&&(g.hostSubscriptionChangedText=this.__hostSubscriptionChangedText);this.__origin&&(g.origin=this.__origin);g.coreDollarstoreProductOfferingData=this.__coreDollarstoreProductOfferingData;this.__dialogManager.showDialog(k.MultiCartSuccess,g).finished.then(function(){return d.accept()}.bind(this)).catch(function(){return d.reject()}.bind(this))}else this.__dialogManager.showDialog(k.MultiCartError,{response:g,keys:g.attributes["transaction.customer_messages"]}).finished.then(function(h){return d.reject("order_fail")}.bind(this)).catch(function(){return d.reject("order_fail")}.bind(this))}.bind(this)).catch(function(g){this.__setProcessing(!1);return this.__displayExceptionDialog(g)}.bind(this))}.bind(this))},vcoinCheckout:function(a){this.__productOfferingID=null;return new this.__Promise(function(d){var e={cart:a.models};this.__productOfferingID=a.models[0].attributes.edge.product_offering_id;var c=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=c.url;this.__coreDollarstoreProductOfferingId=c.id;this.__coreDollarstoreProductOfferingUrl&&(this.__productOfferingID=this.__coreDollarstoreProductOfferingId);this.__submitVcoinOrder(e,this.__productOfferingID).then(function(g){this.__setProcessing(!1);if("delivered"===g.attributes["order.status"]&&"success"===g.attributes["transaction.status"]){var f={value:!0,expiry:(new Date).getTime()+3e5};localStorage.setItem("successfulVcoinOrder",JSON.stringify(f));this.__hostSubscriptionChanged&&(f=parseInt(g.get("order.date_purchased").substring(8,10)),this.__hostSubscriptionChangedText=this.__globalStringManager.get("subscription_changed_text_part_1")+String(f),this.__hostSubscriptionChangedText=1===f||21===f||31===f?this.__hostSubscriptionChangedText+"st, ":2===f||22===f?this.__hostSubscriptionChangedText+"nd, ":3===f||23===f?this.__hostSubscriptionChangedText+"rd, ":this.__hostSubscriptionChangedText+"th, ",this.__hostSubscriptionChangedText+=this.__globalStringManager.get("subscription_changed_text_part_2"));g={cart:a.models,orderResponse:g,channel:"vcoin"};this.__hostSubscriptionChanged&&(g.hostSubscriptionChangedText=this.__hostSubscriptionChangedText);this.__origin&&(g.origin=this.__origin);g.coreDollarstoreProductOfferingData=this.__coreDollarstoreProductOfferingData;this.__dialogManager.showDialog(k.MultiCartSuccess,g).finished.then(function(){return d.accept()}.bind(this)).catch(function(){return d.reject()}.bind(this))}else this.__dialogManager.showDialog(k.MultiCartError,{response:g,keys:g.attributes["transaction.customer_messages"]}).finished.then(function(h){this.promiseResolver.resolve("clear_cart");return d.reject("order_fail")}.bind(this)).catch(function(){this.promiseResolver.resolve("clear_cart");return d.reject("order_fail")}.bind(this))}.bind(this)).catch(function(g){this.__setProcessing(!1);return this.__displayExceptionDialog(g)}.bind(this))}.bind(this))},__setProcessing:function(a){this.$el.toggleClass("loading",a);a?(this.$el.removeClass("can-dismiss"),this.isUncancellableDialog=!0,this.__window.$("body").addClass("waiting")):(this.$el.addClass("can-dismiss"),this.isUncancellableDialog=!1,this.__window.$("body").removeClass("waiting"));this.$(".payment-input").prop("disabled",a);this.$(".dialog-x").prop("disabled",a);this.$("button.checkout").prop("disabled",a)},__openPaypalWindow:function(){var a=!0;this.__closePaypalWindow();this.__paypalUrl=this.__externalNextRoot.replace("next/","paypal/loading/");this.__paypalWindow=this.__window.open(this.__paypalUrl,"_blank");if(!this.__paypalWindow||this.__paypalWindow.closed||"undefined"===typeof this.__paypalWindow.closed)a=!1;return a},__closePaypalWindow:function(){this.__paypalWindow&&(this.__paypalWindow.close(),this.__paypalWindow=null)},__calculateTotal:function(a){var d=0;_.each(a,function(e){e.isCheckedoutModel&&(d+=parseFloat(e.attributes.edge.sale_price))}.bind(this));return d.toFixed(2)},__displayExceptionDialog:function(a){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_failed_title"),text:this.__globalStringManager.get("payment_failed_text"),ok:this.__globalStringManager.get("payment_failed_button")}).finished.then(function(d){this.promiseResolver.resolve("clear_cart")}.bind(this)).catch(function(d){this.promiseResolver.resolve("clear_cart")}.bind(this))},__displayMultiErrorDialog:function(a,d){return this.__dialogManager.showDialog(k.MultiCartError,{response:a,keys:d}).finished.then(function(e){this.promiseResolver.resolve("clear_cart")}.bind(this)).catch(function(e){this.promiseResolver.resolve("clear_cart")}.bind(this))},__displayPaypalWindowErrorDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("Error"),text:this.__globalStringManager.get("PAYPAL ERROR OPENING WINDOW"),ok:this.__globalStringManager.get("checkout_error_button")}).finished.then(function(a){this.promiseResolver.reject()}.bind(this))},__buildOrderSelection:function(a){var d=[];_.each(a,function(e){if(e.isCheckedoutModel){var c=_.indexOf(_.pluck(d,"product_packages_id"),e.attributes.node.product_packages_id);-1===c?d.push({product_packages_id:e.attributes.node.product_packages_id,count:e.attributes.edge.selected_count?e.attributes.edge.selected_count:1}):d[c].count+=1}}.bind(this));return d},_testSetChannel:function(a){this.__channel=a},__submitVantivOrder:function(a,d){var e=this.serviceProvider.get("vantiv_threat_metrics_id"),c=this.__globalStartupModel.get("cashOrderTrans"),g=this.__calculateTotal(a.cart),f=this.__buildOrderSelection(a.cart);d={total:g,product_offering_id:d,selected:f};d.payment_authorization_info={tmxsid:e,payment_method:this.__channel.attributes.payment_method,channel:this.__channel.attributes.channel_key,eprotect:a.eprotect};"cc_payment"===a.payment_method?(d.payment_authorization_info.card_name=a.cc_payment.name,d.payment_authorization_info.card_address=a.cc_payment.address,d.payment_authorization_info.card_city=a.cc_payment.city,d.payment_authorization_info.card_state=a.cc_payment.state,d.payment_authorization_info.card_country=a.cc_payment.country,d.payment_authorization_info.card_zipcode=a.cc_payment.postal_code,d.payment_authorization_info.save_card=!0===a.cc_payment.save_card?1:0):"saved_cc_payment"===a.payment_method&&(d.payment_authorization_info.use_saved_card=1,d.payment_authorization_info.saved_card_id=a.card_id);return this.__restModelFactory.createModel(c,k.UiCore.NodeModel,d)},__submitVcoinOrder:function(a,d){var e=this.__globalStartupModel.get("cashOrderTrans"),c=this.__calculateTotal(a.cart);a=this.__buildOrderSelection(a.cart);d={total:c,product_offering_id:d,selected:a};d.payment_authorization_info={payment_method:this.__channel.attributes.payment_method,channel:this.__channel.attributes.channel_key};return this.__restModelFactory.createModel(e,k.UiCore.NodeModel,d)},__paypalCheckout:function(a,d){return new this.__Promise(function(e){if(this.__openPaypalWindow()){this.__setProcessing(!0);var c=d.models[0].attributes.edge.product_offering_id,g=this.__globalStartupModel.get("cashOrderTrans"),f=this.__buildOrderSelection(d.models);c={total:this.__calculateTotal(d.models),product_offering_id:c,selected:f};c.payment_authorization_info={payment_method:a.attributes.payment_method,channel:a.attributes.channel_key};this.__restModelFactory.createModel(g,k.UiCore.NodeModel,c).then(function(h){this.__paypalWindow&&!this.__paypalWindow.closed?(this.__paypalWindow.location=h.get("transaction.auth_url"),this.__showWaitStatusForPaypal(),this.__waitForPaypalResponse(h).then(function(){this.__setProcessing(!1);this.__dialogManager.showDialog(k.MultiCartSuccess,{cart:d.models,vipModel:this.__vipModel,orderResponse:h,altTitle:this.__globalStringManager.get("PAYPAL PROCESS PENDING TITLE"),channel:"paypal",origin:this.__origin}).finished.then(function(m){return e.accept("finished_order_success")}.bind(this)).catch(function(m){return e.accept("finished_order_fail")}.bind(this))}.bind(this)).catch(function(m){this.__displayMultiErrorDialog(h,["paypal_tab_pending"]);return e.accept("finished_order_fail")}.bind(this))):(this.__displayMultiErrorDialog(h,["paypal_tab_error"]),this.__closePaypalWindow())}.bind(this)).catch(function(h){this.__setProcessing(!1);return this.__displayExceptionDialog(h)}.bind(this))}else this.__displayPaypalWindowErrorDialog().then(function(){return e.reject("fail to load paypal window tab")}.bind(this))}.bind(this))},__showWaitStatusForPaypal:function(){this.$(".dialog-container .dialog-header .dialog-title").text(this.__globalStringManager.get("PayPal"));this.$(".checkout-container").addClass("hidden");this.$(".other-checkout-container").addClass("hidden");this.$(".pending-panel").removeClass("hidden");this.$(".dialog-footer .checkout").prop("disabled",!1);this.$(".dialog-footer .checkout").addClass("paypalpending");this.$(".dialog-footer .checkout.paypalpending").text(this.__globalStringManager.get("CANCEL"));this.$(".dialog-footer .checkout.paypalpending").on("click",function(){this.__setProcessing(!1);this.__closePaypalWindow();this.close()}.bind(this))},__waitForPaypalResponse:function(a){this.__response=a;return new this.__Promise(function(d){this.track(this.__response);return this.listenTo(this.__response,"change",function(){this.untrack(this.__response);this.stopListening(this.__response,"change");this.__response.populated().then(function(e){return"delivered"===e.get("order.status")||"need_ipn"===e.get("order.status")||"authorized"===e.get("order.status")||"pended"===e.get("order.status")||"paid"===e.get("order.status")?d.accept("delivered"):d.reject("failed")}.bind(this))}.bind(this))}.bind(this))},__paymentWallCheckout:function(a,d){return new this.__Promise(function(e){var c=d.models[0].attributes.edge.product_offering_id,g=this.__buildOrderSelection(d.models);c={total:this.__calculateTotal(d.models),product_offering_id:c,selected:g};c.payment_authorization_info={payment_method:a.attributes.payment_method,channel:a.attributes.channel_key};g=this.__globalStartupModel.get("cashOrderTrans");this.__restModelFactory.createModel(g,k.UiCore.NodeModel,c).then(function(f){"need_auth"===f.attributes["transaction.status"]?this.__dialogManager.showDialog(k.PaymentWallDialog,{src:f.attributes["transaction.auth_url"],paymentWallChan:a.attributes.channel_key}).finished.then(function(){this.__paymentWallPendingDialog(d,f).then(function(h){return e.accept("delivered")}.bind(this))}.bind(this)).catch(function(){this.__paymentWallPendingDialog(d,f).then(function(h){return e.accept("delivered")}.bind(this))}.bind(this)):this.__displayMultiErrorDialog(f,f.attributes["transaction.customer_messages"])}.bind(this)).catch(function(f){this.__displayExceptionDialog(f)}.bind(this))}.bind(this))},__paymentWallPendingDialog:function(a,d){return new this.__Promise(function(e){this.__dialogManager.showDialog(k.MultiCartSuccess,{cart:a.models,orderResponse:d,altTitle:this.__globalStringManager.get("PAYMENTWALL_PURCHASE_INFO_TITLE"),channel:"paymentwall"}).finished.then(function(){return e.accept("finished_order_success")}.bind(this)).catch(function(){return e.accept("finished_order_success")}.bind(this))}.bind(this))}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],MultiCartError:ab,MultiCartSuccess:G,PaymentWallDialog:db}),fb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){d="\n        ";var c=a.unless.call(b,(c=b&&b.attributes,null==c||!1===c?c:c.saved_card),{name:"unless",hash:{},fn:this.program(2,e),inverse:this.program(4,e),data:e});if(c||0===c)d+=c;return d+"\n    "},2:function(b,a,d,e){var c;a=this.escapeExpression;return"\n            <li id='"+a((c=b&&b.id,"function"===typeof c?c.apply(b):c))+"'>\n                    <span class='name'>\n                        "+a((c=(c=b&&b.attributes,null==c||!1===c?c:c.display_name),"function"===typeof c?c.apply(b):c))+"\n                    </span>\n                <img src='"+a((c=(c=b&&b.attributes,null==c||!1===c?c:c.icon_url),"function"===typeof c?c.apply(b):c))+"'>\n            </li>\n        "},4:function(b,a,d,e){var c,g;d=this.escapeExpression;var f=a.helperMissing,h="\n            <li id='"+d((c=b&&b.id,"function"===typeof c?c.apply(b):c))+"'>\n                <div class='card-info'>\n                    <p class='card-num'>\n                        XXXX-XXXX-XXXX-"+d((c=(c=b&&b.attributes,null==c||!1===c?c:c.card_last_digits),"function"===typeof c?c.apply(b):c))+"\n                    </p>\n                    <p class='expires'>\n                        <span class='card-type'>"+d((c=(c=b&&b.attributes,null==c||!1===c?c:c.card_type),"function"===typeof c?c.apply(b):c))+"</span>\n                        <span class='card-expire'>";if((c=(g=a["i18n-g"]||b&&b["i18n-g"]||f,g.call(b,"CARD EXPIRY",{name:"i18n-g",hash:{},data:e})))||0===c)h+=c;return h+" "+d((c=(c=b&&b.attributes,null==c||!1===c?c:c.expiry),"function"===typeof c?c.apply(b):c))+"</span>\n                    </p>\n                </div>\n            </li>\n        "},6:function(b,a,d,e){var c,g=a.helperMissing;d="\n        <li id='other-payment-type'>\n            <span class='name'>";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"OTHER PAYMENT TYPE PLURAL",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n                <span class='right-arrow'></span>\n            </span>\n        </li>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d="<ul class='payment-channel-list'>\n    ";var c=a.each.call(b,b&&b.channels,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(c||0===c)d+=c;d+="\n    ";if((c=a["if"].call(b,b&&b.hasOtherChannels,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"\n</ul>"},useData:!0})}({}),gb=function(k){var b=k.UiCore.UiContext;return b.extend("PaymentChannels",{className:"payment-channels",uiContextName:"payment_channels",dependencies:[],initialize:function(a){b.prototype.initialize.call(this,a);this.__channels=IMVU.requireProperty(a,"channels");this.__hasOtherChannels=IMVU.requireProperty(a,"hasOtherChannels");this.addToDOM()},delete:function(){b.prototype.delete.call(this)},render:function(){this.$el.html(k.template({channels:this.__channels,hasOtherChannels:this.__hasOtherChannels}))}})}({UiCore:l["@UiCore"],template:fb}),hb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=a.helperMissing;var g='\n            <div class=\'vcoin-terms-and-conditions\'>\n                <input type="checkbox" class="checkbox vcoin-checkbox" data-name="has_accepted_vcoin_terms_and_conditions" id=\'vcoin_terms_and_conditions_checkbox\'>\n                <label class="toggle-label" for=\'vcoin_terms_and_conditions_checkbox\'>\n                    <span class="vcoin_terms_and_conditions_checkbox_text">',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin_terms_and_conditions_text",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+=' </span><a class="vcoin-terms-and-conditions-link">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin_terms_and_conditions_link",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</a>\n                </label>\n            </div>\n            "},3:function(b,a,d,e){var c;d=a.helperMissing;var g='\n                <p><a href="https://help.imvu.com/s/article/How-do-the-VIP-5000-Credits-Work" target="_blank">',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_terms_and_conditions_loyalty_credits_link_title",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+="</a> ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_terms_and_conditions_loyalty_credits_text",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</p>\n            "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='\n<div class="status-block">\n    <ul>\n        <li class="error-message vip-checkbox-missing">',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_vip_checkbox_unchecked",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+='</li>\n        <li class="error-message vcoin-checkbox-missing">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_vcoin_checkbox_unchecked",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</li>\n        <li class="error-message vcoin-no-payment-methods">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"VCOIN NO PAYMENT METHODS NOTICE",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</li>\n        <li class="error-message items-unavailable-for-purchase">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"ITEMS UNAVAILBLE FOR PURCHASE",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</li>\n        <li class="notice-message notice-subscription-message hidden">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"SUBSCRIPTION ORDERS PROCESSED SEPARATELY",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</li>\n        <li class="notice-message notice-vcoin-in-cart-message hidden">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"VCOIN PAYMENT METHODS NOTICE",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</li>\n        <li class="notice-message notice-credit-card-only-message hidden">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"CREDIT CARD ONLY PAYMENT METHODS NOTICE",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</li>\n    </ul>\n</div>\n<div class=\"checkout-container\">\n    <p class='title'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"CART",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</p>\n    <div class="multi-cart-list-placehoder">\n        <div class="cart-list"></div>\n    </div>\n    <div class="checkout-bottom-container">\n        <div class=\'vip-status-widget\'></div>\n        <div class=\'price-summary\'>\n            <span>';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"TODAYS TOTAL",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="&nbsp;</span><span class='price'>"+g((c=a.total||b&&b.total,"function"===typeof c?c.call(b,{name:"total",hash:{},data:e}):c))+"</span>\n        </div>\n    </div>\n\n    <div class='agreement'>\n        <div class='vip-panel hidden'>\n            <input type=\"checkbox\" class=\"checkbox\" data-name=\"has_accepted_vip_agreement\" id='vip_checkbox'>\n            <label class=\"toggle-label\" for='vip_checkbox'>\n                <span>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"VIP_AGREEMENT",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</span>\n                <span class="vip-terms-link vip-toc-link tooltip-target bold">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"VIP_AGREEMENT_LINK",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</span>\n            </label>\n            <div class="vip-toc-tooltip">\n                <div class="tooltip-header"><a class="vip-terms-and-conditions-link" href="'+g((c=a.vipTermsURL||b&&b.vipTermsURL,"function"===typeof c?c.call(b,{name:"vipTermsURL",hash:{},data:e}):c))+'" target="_blank">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_dialog_title",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</a></div>\n                <div class="tooltip-body">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_tool_tip_text_part_1",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+=' <a class="vip-terms-and-conditions-link" href="'+g((c=a.subscriptionURL||b&&b.subscriptionURL,"function"===typeof c?c.call(b,{name:"subscriptionURL",hash:{},data:e}):c))+'" target="_blank">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_tool_tip_subscription_label",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</a>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_tool_tip_text_part_2",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+=' <a class="vip-terms-and-conditions-link" href="'+g((c=a.helpCenterURL||b&&b.helpCenterURL,"function"===typeof c?c.call(b,{name:"helpCenterURL",hash:{},data:e}):c))+'" target="_blank">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_tool_tip_help_center_label",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</a>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_tool_tip_text_part_3",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</div>\n            </div>\n        </div>\n        <div class='terms'>\n            ";if((h=a["if"].call(b,b&&b.vcoinInCart,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===h)f+=h;f+="\n            ";if((h=a["if"].call(b,b&&b.tieredVIPInCart,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===h)f+=h;f+="\n            <p class='imvu-terms-and-conditions'>\n                ";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Clicking Checkout",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+=" <span class='bold link'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"IMVU TERMS AND CONDITIONS",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</span>\n            </p>\n        </div>\n    </div>\n    <p class='title payment-method'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"CHOOSE PAYMENT METHOD",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</p>\n    <div class="payment-channels-wrapper"></div>\n</div>\n\n<div class="other-checkout-container"></div>\n\n<div class=\'pending-panel hidden\'>\n    <h2>\n        ';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"PAYPAL STATUS MESG",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='\n    </h2>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary checkout">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"CHECKOUT",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"</button>\n<\/script>\n"},useData:!0})}({}),ib=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c,g;d=this.escapeExpression;var f=a.helperMissing,h="\n            <li class='saved-card-item' id='"+d((c=(c=b&&b.attributes,null==c||!1===c?c:c.id),"function"===typeof c?c.apply(b):c))+"'>\n                <div class='card-info'>\n                    <p class='card-num'>\n                        XXXX-XXXX-XXXX-"+d((c=(c=b&&b.attributes,null==c||!1===c?c:c.card_last_digits),"function"===typeof c?c.apply(b):c))+"\n                    </p>\n                    <p class='expires'>\n                        <span class='card-type'>"+d((c=(c=b&&b.attributes,null==c||!1===c?c:c.card_type),"function"===typeof c?c.apply(b):c))+"</span>\n                        <span class='card-expire'>";if((c=(g=a["i18n-g"]||b&&b["i18n-g"]||f,g.call(b,"CARD EXPIRY",{name:"i18n-g",hash:{},data:e})))||0===c)h+=c;h+=" "+d((c=(c=b&&b.attributes,null==c||!1===c?c:c.expiry),"function"===typeof c?c.apply(b):c))+"</span>\n                    </p>\n                    ";if((c=a["if"].call(b,(c=b&&b.attributes,null==c||!1===c?c:c.is_primary),{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===c)h+=c;return h+"\n                </div>\n            </li>\n        "},2:function(b,a,d,e){var c,g=a.helperMissing;d="\n                        <span class='primary'>";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"Primary",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</span>\n                    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g="\n<div class=\"credit-card-container\">\n    <p class='title saved-cards'>",f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"NEW CREDIT CARD",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+="</p>\n    <li class='add-new-credit-card'>\n        <span class='name'>\n            ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Add a New Credit Card",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n        </span>\n        <img src='/common/withme/img/store/payment/payment-creditcard.png'>\n    </li>\n\n    <p class='title saved-cards'>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"SAVED CREDIT CARDS",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</p>\n    <ul class='saved-card-list'>\n        ";if((f=a.each.call(b,b&&b.saved_cards,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===f)g+=f;g+='\n    </ul>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary use">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"USE THIS CARD",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</button>\n<\/script>\n"},useData:!0})}({}),jb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return"\n                    <div class='other-payment-channel-list'>\n                        <span class='name'>PAY WITH VCOIN</span>\n                        <img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'>\n                    </div>\n                "},3:function(b,a,d,e){d="\n            ";if((b=a["if"].call(b,b&&b.isCheckedoutModel,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===b)d+=b;return d+"\n            "},4:function(b,a,d,e){var c;d=this.escapeExpression;var g='\n                <div class="order-row">\n                    <div class="order-item">\n                        <div class="image-container"><img src="'+d((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.node),null==c||!1===c?c:c.img160x160),"function"===typeof c?c.apply(b):c))+'"></div>\n                        <div class="item-info">\n                            <div class="item-name">'+d((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.node),null==c||!1===c?c:c.name),"function"===typeof c?c.apply(b):c))+"</div>\n                            ";if((c=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(5,e),inverse:this.program(10,e),data:e}))||0===c)g+=c;g+="\n                        </div>\n                        ";if((c=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(15,e),inverse:this.noop,data:e}))||0===c)g+=c;g+="\n                    </div>\n                </div>\n                ";if((c=a["if"].call(b,b&&b.hasSupportingText,{name:"if",hash:{},fn:this.program(17,e),inverse:this.noop,data:e}))||0===c)g+=c;return g+"\n            "},5:function(b,a,d,e){d="\n                                ";if((b=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(6,e),inverse:this.program(8,e),data:e}))||0===b)d+=b;return d+"\n                            "},6:function(b,a,d,e){var c;a=this.escapeExpression;return"\n                                    <div class=\"product-price\">\n                                        <span class='normal-price img-position'><img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'><span class=\"item-info-price\">"+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.vcoin_normal_price_formatted),"function"===typeof c?c.apply(b):c))+"</span></span>\n                                        <span class='sale-price' img-position><img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'><span class=\"item-info-price\">"+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.vcoin_sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</span></span>\n                                    </div>\n                                "},8:function(b,a,d,e){var c;a=this.escapeExpression;return"\n                                    <div class='product-price img-position'><img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'><span class=\"item-info-price\">"+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.vcoin_sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</span></div>\n                                "},10:function(b,a,d,e){d="\n                                ";if((b=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(11,e),inverse:this.program(13,e),data:e}))||0===b)d+=b;return d+"\n                            "},11:function(b,a,d,e){var c;a=this.escapeExpression;return"\n                                    <div class=\"product-price\">\n                                        <span class='normal-price'>"+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.normal_price_formatted),"function"===typeof c?c.apply(b):c))+"</span>\n                                        <span class='sale-price'>"+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</span>\n                                    </div>\n                                "},13:function(b,a,d,e){var c;a=this.escapeExpression;return'\n                                    <div class="product-price">'+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</div>\n                                "},15:function(b,a,d,e){var c,g=a.helperMissing;d="\n                            <div class='product-sale'>\n                                <span>";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"SALE",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"4</span>\n                            </div>\n                        "},17:function(b,a,d,e){var c;a=this.escapeExpression;return'\n                    <div class="supporting-text">\n                        '+a((c=b&&b.supportingText,"function"===typeof c?c.apply(b):c))+"\n                    </div>\n                "},19:function(b,a,d,e){return"\n            <img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'>\n            <span class=\"order-total-converted\"></span>\n        "},21:function(b,a,d,e){return'\n            <span class="order-total"></span>\n        '},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="content-container">\n    <div class="content-container-content">\n        <legend class="system-info-header">\n            ',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Payment Method",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='\n        </legend>\n            <div class="info-block">\n                ';if((f=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===f)g+=f;g+='\n                <div class="billing-info"></div>\n            </div>\n\n        <legend class="system-info-header">\n            ';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Cart",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='\n        </legend>\n        <div class="multicart-order-list">\n            ';if((f=a.each.call(b,b&&b.cart,{name:"each",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)g+=f;g+='\n        </div>\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary buy-now">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"BUY",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n        <span class=\"item-count\"></span>\n        <span class='items-for'></span>\n        ";if((f=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(19,e),inverse:this.program(21,e),data:e}))||0===f)g+=f;return g+"\n    </button>\n<\/script>\n"},useData:!0})}({}),x=function(k){var b=k.MultiCartAbstractDialog;return b.extend("MultiCartCreditReviewDialog",{uiContextName:"multicart_credit_card_review_dialog",className:"multicart-credit-card-review-dialog dialog-type-B",dependencies:"cart channel dialogManager featureAccessManager globalStartupModel globalStringManager loginManager restModelFactory serviceProvider window".split(" "),trackedEvents:function(){return[{type:"click",selector:".buy-now.standard-purchase",name:"buy_now",handler:this.__onCheckout},{type:"click",selector:".buy-now.in-bypass-experiment",name:"buy_now_bypass_experiment",handler:this.__onCheckout},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(a){b.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.__isCoreDollarStoreBypassPurchase=null!==this.__getCoreDollarstoreProductOfferingUrlAndId().url;this.__getProductOfferingDataFromCoreDS();this.__eProtectResponse=IMVU.optionalProperty(a,"eProtectResponse",null);this.$el.removeClass("can-dismiss");this.__origin=IMVU.optionalProperty(a,"origin",null);this.__channel=IMVU.optionalProperty(a,"channel",null);this.__source=IMVU.optionalProperty(a,"source",null);this.__billingInfo=IMVU.optionalProperty(a,"billingInfo",null);this.title=this.__globalStringManager.get("credit_card_review_title");this.isVcoinAsAPaymentMethod=!1;this.__myself=this.__loginManager.getCurrentUser();this.addToDOM()},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&"pay_with_vcoin_cta"!==this.__source&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.__hostSubscriptionChanged=!1;var a=0,d=0;_.each(this.__cart.models,function(c){c.isCheckedoutModel&&(a+=c.attributes.edge.sale_price,c.hasDiscount=c.attributes.edge.normal_price>c.attributes.edge.sale_price,d++)}.bind(this));"vcoin"===this.__channel.attributes.channel_key?(a=parseFloat(250*a).toFixed(2),this.isVcoinAsAPaymentMethod=!0,this.setContent("body",k.template({cart:this.__cart.models,channel:this.__channel,isVcoinAsAPaymentMethod:this.isVcoinAsAPaymentMethod}))):(a="$"+parseFloat(a).toFixed(2),this.setContent("body",k.template({cart:this.__cart.models})),this.$(".billing-info").html(k.billingTemplate({last_four_digits:this.__billingInfo.last_four_digits,card_type:this.__globalStringManager.get("card_type_"+this.__billingInfo.card_type)})));var e=1===d?this.__stringManager.get("BUY FOR SINGULAR"):this.__stringManager.get("BUY FOR PLURAL");this.setContent("footer",this.$(".dialog-footer-template").text());this.$(".items-for").text(e);this.$(".item-count").text(d);"vcoin"===this.__channel.attributes.channel_key?this.$(".order-total-converted").text(a):this.$(".order-total").text(a);this.__isCoreDollarStoreBypassPurchase?this.$(".buy-now").addClass("in-bypass-experiment"):this.$(".buy-now").addClass("standard-purchase")},__onCheckout:function(){this.__channel.attributes.channel_key&&"vcoin"===this.__channel.attributes.channel_key?(this.__cart.isVcoinAsAPaymentMethod=!0,this.$(".buy-now").addClass("disabled"),this.vcoinCheckout(this.__cart).then(function(){this.promiseResolver.resolve();this.close()}.bind(this)).catch(function(){this.promiseResolver.resolve();this.close()}.bind(this))):(this.$(".buy-now").addClass("disabled"),this.creditCardCheckout(this.__cart).then(function(){this.promiseResolver.resolve();this.close()}.bind(this)).catch(function(){this.promiseResolver.resolve();this.close()}.bind(this)))},__goBack:function(){this.hide();this.promiseResolver.reject()}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],BillingInfo:F,MultiCartAbstractDialog:H,billingTemplate:w,template:jb}),kb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return'\n            <iframe id="eProtect-iframe" name="eProtect-iframe" frameborder="0" src="https://localhost.imvu.com/third_party/worldpay/eProtect_iframe/nextBig.html" height="150" width="100%"></iframe>\n        '},3:function(b,a,d,e){return'\n            <div class="input-row worldpay-eprotect-iframe" id="eProtectiframe"></div>\n        '},5:function(b,a,d,e){return' checked="checked" '},7:function(b,a,d,e){var c;a=this.escapeExpression;return'\n                    <option value="'+a((c=null==e||!1===e?e:e.key,"function"===typeof c?c.apply(b):c))+'">'+a("function"===typeof b?b.apply(b):b)+"</option>\n                    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="content-container">\n    <div class="error-block">\n        <ul>\n            <li class="error-message field-missing">',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_field_missing",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='</li>\n            <li class="error-message cardnumber-invalid">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_card_number_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message exp-date-expired">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_exp_date_expired",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message security-code-invalid">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_security_code_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message zip-invalid">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_zip_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message postal-invalid">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_postal_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message vip-checkbox-missing">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_vip_checkbox_unchecked",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message cardname-invalid">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_invalid_cc_name",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n        </ul>\n    </div>\n    <div class="payment-block">\n        <legend class="system-info-header">\n            ';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Payment Method",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n        </legend>\n\n        ";if((f=a["if"].call(b,b&&b.canSeeEprotectCss,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===f)g+=f;g+='\n\n        <div class="input-row save-cc-for-later">\n            <input id=\'save-for-later-checkbox\' class="save-for-later checkbox" tabindex=\'13\' type="checkbox"\n                ';if((f=a["if"].call(b,b&&b.saveCard,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===f)g+=f;g+=">\n            <label for='save-for-later-checkbox'>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Save For Later",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</label>\n        </div>\n    </div>\n    <div class="billing-address-block">\n        <legend class="system-info-header">\n            ';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Billing Information",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n        </legend>\n        <div class=\"input-row\">\n            <input class='name-on-card' maxlength='50' tabindex='5' required placeholder='";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Name on Card",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n        </div>\n        <div class=\"input-row\">\n            <input class='address' maxlength='50' tabindex='6' required placeholder='";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Address",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n        </div>\n        <div class=\"input-row\">\n            <input class='city' maxlength='20' tabindex='7' required placeholder='";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"City",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n            <div class='us-fields state-province-container input-container'>\n                <select class='state' tabindex='8' >\n                    <option selected value=\"\">";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"State",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</option>\n                    ";if((f=a.each.call(b,b&&b.states,{name:"each",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n                </select>\n            </div>\n            <div class='non-us-fields ca-province state-province-container input-container'>\n                <select class='province' tabindex='10'>\n                    <option selected value=\"\">";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Province",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</option>\n                    ";if((f=a.each.call(b,b&&b.provinces,{name:"each",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n                </select>\n            </div>\n            <input class='us-fields zip' maxlength='5' tabindex='9' placeholder='";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Zipcode",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n            <input class='non-us-fields postal' maxlength='12' tabindex='11' placeholder='";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Postal Code",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n            <div class='country-container input-container us'>\n                <select class='country' tabindex='12' required>\n                    <option value=''>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Country",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</option>\n                    ";if((f=a.each.call(b,b&&b.countries,{name:"each",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)g+=f;g+='\n                </select>\n            </div>\n        </div>\n    </div>\n</div>\n\n<footer class="dialog-footer">\n    <button class="btn btn-primary continue-checkout">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Continue to Checkout",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</button>\n</footer>\n"},useData:!0})}({}),I=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("MultiCartAddCreditCard",{uiContextName:"multicart_add_credit_card_dialog",className:"multicart-add-credit-card-dialog dialog-type-B",dependencies:"appMonitor cart channel currentLocale dialogManager featureAccessManager globalStringManager loginManager moment orderTotal prefsManager timer window".split(" "),trackedEvents:function(){return[{type:"click",selector:".continue-checkout",name:"continue_checkout",handler:this.__continueCheckout},{type:"keyup",selector:".name-on-card",name:"changing_name",handler:this.__isBlankNameOnCard},{type:"blur",selector:".name-on-card",name:"changed_name",handler:this.__validateNameOnCard},{type:"keyup",selector:".address",name:"changing_address",handler:this.__isBlankAddress},{type:"blur",selector:".address",name:"changed_address",handler:this.__validateAddress},{type:"keyup",selector:".city",name:"change_city",handler:this.__isBlankCity},{type:"blur",selector:".city",name:"change_city",handler:this.__validateCity},{type:"change",selector:".state",name:"change_state_select",handler:this.__validateState},{type:"keyup",selector:".zip",name:"changing_zip",handler:this.__isBlankZip},{type:"blur",selector:".zip",name:"changed_zip",handler:this.__validateZip},{type:"change",selector:".province",name:"change_province_select",handler:this.__validateProvince},{type:"keyup",selector:".postal",name:"changing_postal",handler:this.__isBlankPostal},{type:"blur",selector:".postal",name:"changed_postal",handler:this.__validatePostal},{type:"change",selector:".country",name:"change_country_select",handler:this.__validateCountry},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(a){b.prototype.initialize.call(this,a);this.shouldFocusOnPrimaryButton=!1;a.loginManager.isLoggedIn()||(this.__window.onbeforeunload=null,this.__window.location.href=this.__siteRoot);this.title=this.__globalStringManager.get("Add New Credit Card");this.__monthRange="01 02 03 04 05 06 07 08 09 10 11 12".split(" ");this.__getYearRange();this.__states=k.StateMap;this.__provinces=k.ProvinceMap;this.__countries=k.CountryMap;this.__CCValidator=k.CCValidator;this.__missingFields=[];this.__myself=a.loginManager.getCurrentUser();this.__origin=IMVU.optionalProperty(a,"origin",null);this.__isMobile=this.__featureAccessManager.isMobile();this.__eProtectData=this.__serviceProvider.get("worldpayEprotectData");this.__eProtectFailureCodesAccountNumber=this.__eProtectData.eProtectFailureCodesAccountNumber;this.__eProtectFailureCodesCCV=this.__eProtectData.eProtectFailureCodesCCV;this.__canSeeEprotectCss=!1;this.__currentLocale=this.__currentLocale||"en";this.__currentLocale="www"===this.__currentLocale?"en":this.__currentLocale;this.addToDOM()},delete:function(){b.prototype.delete.call(this);this.__tooltip&&this.__tooltip.delete()},close:function(){this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.__prefsManager.populated().then(function(){this.setContent("body",k.template,{monthRange:this.__monthRange,yearRange:this.__yearRange,states:this.__states,provinces:this.__provinces,countries:this.__countries,saveCard:!this.__prefsManager.getBool("next.payment.creditcard.save_card.disable"),canSeeEprotectCss:this.__canSeeEprotectCss});this.$(".non-us-fields").hide();this.$('.country option[value="US"]').prop("selected",!0);this.__stateWidget=this.createChildContext(k.Dropdown,{$replaceElement:this.$(".state")});this.createChildContext(k.Dropdown,{$replaceElement:this.$(".province")});this.createChildContext(k.Dropdown,{$replaceElement:this.$(".country")});this.$(".content-container").scrollbar();this.__tooltip=this.serviceProvider.create(k.Tooltip,{$replaceElement:this.$(".security-code-tooltip"),$tooltipTarget:this.$(".security-code-help-link")});this.__myself.get("is_adult")||this.$(".content-container .save-cc-for-later").addClass("hidden");try{$(document).ready(function(){var a=this.__currentLocale+"NextBig20201012b",d=this.__currentLocale+"NextSmall20201012b";a={paypageId:this.__eProtectData.payPageID,style:this.__isMobile?d:a,reportGroup:this.__eProtectData.reportGroup,timeout:this.__eProtectData.timeout,div:"eProtectiframe",callback:this.__eProtectIframeClientCallback.bind(this),checkoutIdMode:!0,showCvv:!0,months:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},numYears:20,tooltipText:this.__globalStringManager.get("worldpay_eProtext_ccv_tool_tip"),tabIndex:{cvv:1,accountNumber:2,expMonth:3,expYear:4},placeholderText:{cvv:this.__globalStringManager.get("worldpay_eProtext_ccv_text"),accountNumber:this.__globalStringManager.get("worldpay_eProtext_ccv_acc_num")},inputsEmptyCallback:this.__eProtectInputsEmptyCallback.bind(this),enhancedUxFeatures:{inlineFieldValidations:!0}};"undefined"===typeof EprotectIframeClient?(this.__eProtectIframeClient=null,this.__dialogManager.showDialog(k.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("worldpay_eProtext_alert_title"),text:this.__stringManager.get("worldpay_eProtext_alert_text"),ok:this.__stringManager.get("OK")}).finished.then(function(){this.close()}.bind(this)).catch(function(){this.close()}.bind(this))):(this.__eProtectIframeClient=new EprotectIframeClient(a),this.__isMobile?this.$("#eProtect-iframe").attr("height","195"):this.__eProtectIframeClient.autoAdjustHeight())}.bind(this))}catch(a){this.__window.console.error("MultiCartAddCreditCard::postRender - Failed to initialize eprotect",a),this.__appMonitor.reportCustomError("MultiCartAddCreditCard","postRender","web_perm_0011","MultiCartAddCreditCard::postRender - Failed to initialize eprotect",this.__appMonitor.buildErrorArray(a))}}.bind(this))},_test_getEProtectIframeClient:function(){return this.__eProtectIframeClient},__eProtectIframeClientCallback:function(a){var d=parseInt(a.response),e=!1;870!=d&&(this.__eProtectFailureCodesAccountNumber.includes(d)||this.__eProtectFailureCodesCCV.includes(d)||this.__window.console.error("MultiCartAddCreditCard::__eProtectIframeClientCallback - Unrecognized response code ("+String(d)+")"));this.$(".cardnumber-invalid").removeClass("error-visible");this.__eProtectFailureCodesAccountNumber.includes(d)&&(this.$(".cardnumber-invalid").addClass("error-visible"),e=!0);this.$(".security-code-invalid").removeClass("error-visible");this.__eProtectFailureCodesCCV.includes(d)&&(this.$(".security-code-invalid").addClass("error-visible"),e=!0);this.__updateErrorStatus();this.__ccLastFour=a.lastFour;this.__ccType=a.type;this.__eProtectResponse=JSON.stringify(a);0!==this.$(".error-visible").length||e||this.__dialogManager.showDialog(k.MultiCartReview,{billingInfo:this.__getBillingInfo(),channel:this.__channel,cart:this.__cart,origin:this.__origin,eProtectResponse:this.__eProtectResponse}).finished.then(function(c){this.promiseResolver.resolve(c);this.close()}.bind(this)).catch(function(c){"closing_all"===c&&this.close()}.bind(this))},__eProtectInputsEmptyCallback:function(a){this.$(".cardnumber-invalid").addClass("error-visible");this.$(".security-code-invalid").addClass("error-visible");this.$(".exp-date-expired").addClass("error-visible")},__getYearRange:function(){this.__yearRange=[];for(var a=this.__timer.getDate().getFullYear(),d=0;20>d;d++)this.__yearRange.push(d+a)},__validateInputs:function(){this.__billingInfoErrorDetected=!1;this.__validateNameOnCard();this.__validateCardName();this.__validateAddress();this.__validateCity();this.__validateCountry();"US"===this.$(".country select").val()?(this.__validateZip(),this.__validateState()):"CA"===this.$(".country select").val()&&(this.__validatePostal(),this.__validateProvince())},__errorIfBlank:function(a,d){d=d?""===this.$("."+a+" select").val():""===this.$("."+a).val().trim();this.__updateMissingFields(a,d);d&&(this.__billingInfoErrorDetected=!0);return d},__updateMissingFields:function(a,d){this.$("."+a).toggleClass("payment-error",d);var e=this.__missingFields.indexOf(a);d&&0>e?this.__missingFields.push(a):!d&&-1<e&&this.__missingFields.splice(e,1);this.$(".field-missing").toggleClass("error-visible",0!==this.__missingFields.length)},__validateCardName:function(){var a=this.$(".name-on-card").val().trim(),d=a.trim().split(/\s+/).length;/\d/.test(a)||2>d?(this.$(".cardname-invalid").addClass("error-visible"),this.$(".name-on-card").addClass("payment-error")):(this.$(".cardname-invalid").removeClass("error-visible"),this.$(".name-on-card").removeClass("payment-error"));this.__updateErrorStatus()},__isBlankNameOnCard:function(){-1<this.__missingFields.indexOf("name-on-card")&&this.__errorIfBlank("name-on-card");this.__updateErrorStatus()},__validateNameOnCard:function(){this.__errorIfBlank("name-on-card");this.__updateErrorStatus()},__isBlankAddress:function(){-1<this.__missingFields.indexOf("address")&&this.__errorIfBlank("address");this.__updateErrorStatus()},__validateAddress:function(){this.__errorIfBlank("address");this.__updateErrorStatus()},__isBlankCity:function(){-1<this.__missingFields.indexOf("city")&&this.__errorIfBlank("city");this.__updateErrorStatus()},__validateCity:function(){this.__errorIfBlank("city");this.__updateErrorStatus()},__validateState:function(){this.__errorIfBlank("state",!0);this.__updateErrorStatus()},__validateProvince:function(){this.__errorIfBlank("province",!0);this.__updateErrorStatus()},__isBlankZip:function(){-1<this.__missingFields.indexOf("zip")&&this.__errorIfBlank("zip");this.__updateErrorStatus()},__validateZip:function(){this.__errorIfBlank("zip")?this.$(".zip-invalid").removeClass("error-visible"):this.$(".zip").val().trim().match(/^\d\d\d\d\d$/)?(this.$(".zip-invalid").removeClass("error-visible"),this.$(".zip").removeClass("payment-error")):(this.$(".zip-invalid").addClass("error-visible"),this.$(".zip").addClass("payment-error"),this.__billingInfoErrorDetected=!0);this.__updateErrorStatus()},__isBlankPostal:function(){"CA"===this.$(".country select").val()&&-1<this.__missingFields.indexOf("postal")&&this.__errorIfBlank("postal");this.__updateErrorStatus()},__validatePostal:function(){"CA"===this.$(".country select").val()&&(this.__errorIfBlank("postal")?this.$(".postal-invalid").removeClass("error-visible"):this.$(".postal").val().trim().match(/^[A-Za-z]\d[A-Za-z]\s*\d[A-Za-z]\d$/)?(this.$(".postal-invalid").removeClass("error-visible"),this.$(".postal").removeClass("payment-error")):(this.$(".postal-invalid").addClass("error-visible"),this.$(".postal").addClass("payment-error"),this.__billingInfoErrorDetected=!0));this.__updateErrorStatus()},__validateCountry:function(){this.$(".zip-invalid").removeClass("error-visible");this.$(".postal-invalid").removeClass("error-visible");this.__updateMissingFields("zip",!1);this.__updateMissingFields("state",!1);this.__updateMissingFields("postal",!1);this.__updateMissingFields("province",!1);this.__errorIfBlank("country",!0);"US"===this.$(".country select").val()?(this.$(".us-fields").show(),this.$(".non-us-fields").hide(),this.$(".country-container").addClass("us"),this.$(".postal").val(""),this.$('.ca-province option[value=""]').prop("selected",!0)):(this.$(".country-container").removeClass("us"),this.$(".us-fields").hide(),this.$(".zip").val(""),this.$('.state option[value=""]').prop("selected",!0),this.$(".non-us-fields").show(),"CA"===this.$(".country select").val()?(this.$(".ca-province").show(),this.$(".country-container").addClass("canada"),this.$(".postal").removeClass("intl")):(this.$(".postal").addClass("intl"),this.$(".ca-province").hide(),this.$('.ca-province option[value=""]').prop("selected",!0),this.$(".country-container").removeClass("canada")));this.__updateErrorStatus()},__updateErrorStatus:function(){this.$(".error-block").toggleClass("has-error",0<this.$(".error-visible").length)},__continueCheckout:function(){this.__validateInputs();if(!this.__billingInfoErrorDetected&&!this.__missingFields.length){var a=this.__moment(new Date).format("YYYYMMDDhhmmss");a={id:String(this.__myself.get("legacy_cid"))+"e"+a,pciNonSensitive:!1};this.__eProtectIframeClient.getPaypageRegistrationId(a)}},__getBillingInfo:function(){var a=this.$(".country select").val(),d=this.$(".state select").val(),e=this.$(".zip").val().trim();"CA"===a?(d=this.$(".province select").val(),e=this.$(".postal").val().trim()):"US"!==a&&(d="",e=this.$(".postal").val().trim());var c=this.__eProtectResponse,g=this.__ccLastFour,f=this.__ccType;return{name:this.$(".name-on-card").val().trim(),address:this.$(".address").val().trim(),city:this.$(".city").val().trim(),state:d,postal_code:e,country:a,save_card:this.$("#save-for-later-checkbox").prop("checked"),eProtectResponse:c,last_four_digits:g,card_type:f}},__goBack:function(){this.hide();this.promiseResolver.reject()},__destroy:function(){this.hide();this.delete()}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],CCValidator:E,CountryMap:l["json!/common/js/JSON/Countries.json"],Dropdown:v,MultiCartReview:x,ProvinceMap:l["json!/common/js/JSON/Provinces.json"],StateMap:l["json!/common/js/JSON/States.json"],Tooltip:r,template:kb}),lb=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("MultiCartSavedCardsDialog",{uiContextName:"multicart_saved_cards_dialog",className:"multicart-saved-cards-dialog dialog-type-B",dependencies:"cart channel dialogManager globalStartupModel globalStringManager restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:".back-button",name:"back_button",handler:"__goBack"},{type:"click",selector:".add-new-credit-card",name:"add_new",handler:"__addNewCard"},{type:"click",selector:"li.saved-card-item",name:"select_saved_card",handler:"__selectSavedCard"},{type:"click",selector:".btn.btn-primary",name:"use_card",handler:"__useThisCard"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.$el.removeClass("can-dismiss");this.title=this.__globalStringManager.get("SAVED CREDIT CARDS");this.__origin=IMVU.optionalProperty(a,"origin",null);a=this.__globalStartupModel.get("savedCreditCardUrl");this.__saved_cards=this.track(this.__restModelFactory.readCollection(a,k.UiCore.NodeCollection));this.__saved_cards.populated().then(function(){this.addToDOM()}.bind(this))},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.setContent("body",k.template,{saved_cards:this.__saved_cards.models});this.$(".saved-card-list li:nth-of-type(1)").addClass("is-selected");this.__selectedCard=this.$(".saved-card-list li:nth-of-type(1)").prop("id");this.setContent("footer",this.$(".dialog-footer-template").text())},__addNewCard:function(){this.__dialogManager.showDialog(k.MultiCartAddCreditCard,{cart:this.__cart,channel:this.__channel,itemCount:this.__cart.length,orderTotal:this.__total,origin:this.__origin}).finished.then(function(a){"clear_cart"===a&&this.__window.location.reload();this.promiseResolver.resolve(a);this.close()}.bind(this)).catch(function(a){"closing_all"===a&&this.close()}.bind(this))},__useThisCard:function(){var a=this.__getCardFromId(this.__selectedCard);this.__dialogManager.showDialog(k.MultiCartReview,{billingInfo:{card_type:a.attributes.card_type,name:a.attributes.name,last_four_digits:a.attributes.card_last_digits,card_id:a.attributes.id,saved_card:!0},channel:this.__channel,cart:this.__cart,origin:this.__origin}).finished.then(function(d){"clear_cart"===d&&this.__window.location.reload();this.promiseResolver.resolve(d);this.close()}.bind(this)).catch(function(d){"closing_all"===d&&this.close()}.bind(this))},__onClose:function(a){a.preventDefault();this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},__goBack:function(){this.hide();this.promiseResolver.reject()},__selectSavedCard:function(a){this.__selectedCard=a.target.id;this.$(".saved-card-list li").removeClass("is-selected");this.$('.saved-card-list li[id="'+this.__selectedCard+'"]').addClass("is-selected")},__getCardFromId:function(a){return _.find(this.__saved_cards.models,function(d){if(a===d.attributes.id)return d})}})}({Dialogs:l["@Dialogs"],UiCore:l["@UiCore"],MultiCartAddCreditCard:I,MultiCartReview:x,template:ib}),mb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c,g=a.helperMissing;d=this.escapeExpression;var f="\r\n";if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"VIP RENEWS ON",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+"&nbsp;<span class='date'>"+d((c=a.renew_date||b&&b.renew_date,"function"===typeof c?c.call(b,{name:"renew_date",hash:{},data:e}):c))+"</span><span class='price'>"+d((c=a.price||b&&b.price,"function"===typeof c?c.call(b,{name:"price",hash:{},data:e}):c))+"</span>\r\n"},useData:!0})}({}),nb=function(k){var b=k.UiCore.UiContext;return b.extend("MultiCartVipStatus",{className:"multi-cart-vip-status",uiContextName:"multi_cart_vip_status",tagName:"p",dependencies:["globalStringManager","loginManager","model"],trackedEvents:function(){return[]},VIP_ONE_MONTH:12,VIP_THREE_MONTHS:13,VIP_ONE_YEAR:14,initialize:function(a){b.prototype.initialize.call(this,a);this.__myself=this.__loginManager.getCurrentUser();this.__months_to_add={};this.__months_to_add[this.VIP_ONE_MONTH]=1;this.__months_to_add[this.VIP_THREE_MONTHS]=3;this.__months_to_add[this.VIP_ONE_YEAR]=12;this.addToDOM()},render:function(){b.prototype.render.call(this);var a=this.__months_to_add[this.__model.attributes.node.product_packages_id];a||(a=1);a=(this.__myself.get("is_vip")?k.moment(this.__myself.get("vip_expires")):k.moment()).add("months",a);this.$el.html(k.template({price:this.__model.attributes.edge.sale_price_formatted,renew_date:a.format("MM/DD/YYYY")}))}})}({moment:l["@moment"],UiCore:l["@UiCore"],template:mb}),ob=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return"disabled"},3:function(b,a,d,e){var c,g;d=this.escapeExpression;return"\r\n            <div class='product-price'>\r\n                <span class='normal-price'>"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.edge),null==c||!1===c?c:c.normal_price_formatted),"function"===typeof c?c.apply(b):c))+"</span>\r\n                <span class='sale-price'>"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.edge),null==c||!1===c?c:c.sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</span>\r\n                <span class='renewal-period'> "+d((g=a.renewalPeriodText||b&&b.renewalPeriodText,"function"===typeof g?g.call(b,{name:"renewalPeriodText",hash:{},data:e}):g))+"</span>\r\n            </div>\r\n        "},5:function(b,a,d,e){var c,g;d=this.escapeExpression;return"\r\n            <div class='product-price'>\r\n                "+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.edge),null==c||!1===c?c:c.sale_price_formatted),"function"===typeof c?c.apply(b):c))+"<span class='renews-monthly'> "+d((g=a.renewalPeriodText||b&&b.renewalPeriodText,"function"===typeof g?g.call(b,{name:"renewalPeriodText",hash:{},data:e}):g))+"</span>\r\n            </div>\r\n        "},7:function(b,a,d,e){var c,g=a.helperMissing;d="\r\n        <div class='product-sale'>\r\n            ";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"SALE",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\r\n        </div>\r\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;var g="<div class='multi-cart-item-info'>\r\n\r\n    <input id='multi-cart-item-"+d((c=(c=b&&b.model,null==c||!1===c?c:c.cid),"function"===typeof c?c.apply(b):c))+"' class='checkbox product-select' type='checkbox' ";if((c=a["if"].call(b,(c=b&&b.model,null==c||!1===c?c:c.isDisabledModel),{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===c)g+=c;g+="/>\r\n    <label class='product-label' for='multi-cart-item-"+d((c=(c=b&&b.model,null==c||!1===c?c:c.cid),"function"===typeof c?c.apply(b):c))+"'>\r\n    </label>\r\n\r\n    <div class='product-img'>\r\n        <img src='"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.node),null==c||!1===c?c:c.img160x160),"function"===typeof c?c.apply(b):c))+"'>\r\n    </div>\r\n    <div class='product-info'>\r\n        <div class='product-name'>"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.node),null==c||!1===c?c:c.name),"function"===typeof c?c.apply(b):c))+"</div>\r\n        ";if((c=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(3,e),inverse:this.program(5,e),data:e}))||0===c)g+=c;g+="\r\n\r\n    </div>\r\n    ";if((c=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===c)g+=c;return g+"\r\n</div>\r\n"},useData:!0})}({}),pb=function(k){var b=k.UiCore.UiContext;return k.UiCore.UiContext.extend("MultiCartCheckoutItem",{className:"multi-cart-checkout-item",uiContextName:"multi_cart_checkout_item",tagName:"li",dependencies:["contextMenuManager","dollarStoreManager","globalStringManager","window"],trackedEvents:function(){return[{type:"click",selector:".checkbox.product-select",name:"product_toggle",handler:"__productToggle"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.model.isCheckedoutModel=!0;this.model.isDisabledModel=!1;this.model.listenTo(this.model,"cart_model_price_update",this.__updatePrice.bind(this));this.addToDOM()},render:function(){b.prototype.render.call(this);var a="",d=this.model.get("node");if(d){var e=d.category;e&&"hosting"===e?a=this.__globalStringManager.get("renews_monthly"):e&&"vip"===e&&(d=d.code_name,"vip_1_month_subscription"===d?a=this.__globalStringManager.get("renews_monthly"):"vip_3_month_subscription"===d?a=this.__globalStringManager.get("renews_quarterly"):"vip_1_year_subscription"===d&&(a=this.__globalStringManager.get("renews_yearly")))}this.$el.html(k.template({model:this.model,hasDiscount:this.model.attributes.edge.normal_price>this.model.attributes.edge.sale_price,renewalPeriodText:a}));this.$(".multi-cart-item-info").addClass(this.model.attributes.node.category);this.model.isCheckedoutModel?this.$(".product-select").attr("checked","checked"):this.$(".product-select").removeAttr("checked");this.model.get("node").disableCheckbox&&this.$(".product-label").expect(1).attr("disabled","disabled")},__productToggle:function(a){this.model.isCheckedoutModel=this.$(a.target).prop("checked");this.__dollarStoreManager.trigger("update_checkout_total_price")},__updatePrice:function(){this.render()}})}({Model:l["@Model"],UiCore:l["@UiCore"],template:ob}),qb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;a=this.escapeExpression;return"\n        <li id='"+a((c=b&&b.id,"function"===typeof c?c.apply(b):c))+"'>\n        <span class='name'>\n            "+a((c=(c=b&&b.attributes,null==c||!1===c?c:c.display_name),"function"===typeof c?c.apply(b):c))+"\n        </span>\n            <img src='"+a((c=(c=b&&b.attributes,null==c||!1===c?c:c.icon_url),"function"===typeof c?c.apply(b):c))+"'>\n        </li>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c,g=a.helperMissing;d="<ul class='other-payment-channel-list'>\n    <li id='other-payment-type'>\n    <span class='name'>";if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"OTHER PAYMENT TYPE PLURAL",{name:"i18n-g",hash:{},data:e})))||0===g)d+=g;d+="\n        <span class='down-arrow'></span>\n    </span>\n    </li>\n    ";if((g=a.each.call(b,b&&b.otherChannels,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===g)d+=g;return d+"\n</ul>\n\n"},useData:!0})}({}),rb=function(k){var b=k.UiCore.UiContext;return b.extend("OtherPaymentChannels",{className:"other-payment-channels",uiContextName:"other_payment_channels",dependencies:[],trackedEvents:function(){return[]},initialize:function(a){b.prototype.initialize.call(this,a);this.__otherChannels=IMVU.requireProperty(a,"otherChannels");this.addToDOM()},delete:function(){b.prototype.delete.call(this)},render:function(){this.$el.html(k.template({otherChannels:this.__otherChannels}))}})}({UiCore:l["@UiCore"],template:qb}),sb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){return"\r\n"},useData:!0})}({}),tb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;var g="\r\n        <div class=\"product-price\">\r\n            <span class='normal-price'>"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.edge),null==c||!1===c?c:c.normal_price_formatted),"function"===typeof c?c.apply(b):c))+"</span>\r\n            <span class='sale-price'>"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.edge),null==c||!1===c?c:c.sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</span>\r\n            ";if((c=a["if"].call(b,b&&b.hasRenews,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===c)g+=c;return g+"\r\n    </div>\r\n    "},2:function(b,a,d,e){var c;d=this.escapeExpression;return"\r\n            <span class='renews-text'> "+d((c=a.renewsText||b&&b.renewsText,"function"===typeof c?c.call(b,{name:"renewsText",hash:{},data:e}):c))+"</div>\r\n        "},4:function(b,a,d,e){var c;d=this.escapeExpression;d="\r\n    <div class='product-price'>"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.edge),null==c||!1===c?c:c.sale_price_formatted),"function"===typeof c?c.apply(b):c));if((c=a["if"].call(b,b&&b.hasRenews,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"</div>\r\n    "},5:function(b,a,d,e){var c;d=this.escapeExpression;return"<span class='renews-text'> "+d((c=a.renewsText||b&&b.renewsText,"function"===typeof c?c.call(b,{name:"renewsText",hash:{},data:e}):c))+"</span>"},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c,g;d=this.escapeExpression;var f=a.helperMissing,h="<div class='multi-cart-item-info'>\r\n    <div class='product-img'>\r\n        <img src='"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.node),null==c||!1===c?c:c.img160x160),"function"===typeof c?c.apply(b):c))+"'>\r\n    </div>\r\n    <div class='product-info'>\r\n        <div class='product-name'>\r\n            "+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.node),null==c||!1===c?c:c.name),"function"===typeof c?c.apply(b):c))+"\r\n        </div>\r\n\r\n        ";if((c=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(4,e),data:e}))||0===c)h+=c;h+="\r\n</div>\r\n<div class='product-remove'>\r\n    ";if((c=(g=a.icon||b&&b.icon||f,g.call(b,"icon-trash2",{name:"icon",hash:{},data:e})))||0===c)h+=c;return h+"\r\n</div>\r\n</div>"},useData:!0})}({}),ub=function(k){var b=k.UiCore.UiContext;return k.UiCore.UiContext.extend("MultiCartItem",{className:"multi-cart-item",uiContextName:"multi_cart_item",tagName:"li",dependencies:"contextMenuManager dialogManager dollarStoreManager featureAccessManager globalStringManager Promise".split(" "),trackedEvents:function(){return[{type:"click",selector:".product-remove",name:"multi_cart_remove",handler:"__onRemoveItem"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.model.listenTo(this.model,"cart_model_price_update",this.__updatePrice.bind(this));this.addToDOM()},render:function(){b.prototype.render.call(this);var a=this.model.attributes.edge.normal_price>this.model.attributes.edge.sale_price,d=this.model.get("node").category,e="hosting"===d||"vip"===d;a={model:this.model,hasDiscount:a,hasRenews:e};e&&(e=this.__globalStringManager.get("renews_monthly"),"vip"===d&&(d=this.model.get("node").code_name,"vip_3_month_subscription"===d?e=this.__globalStringManager.get("renews_quarterly"):"vip_1_year_subscription"===d&&(e=this.__globalStringManager.get("renews_yearly"))),a.renewsText=e);this.$el.html(k.template(a));this.$(".product-info").addClass(this.model.attributes.node.category)},__onRemoveItem:function(){this.collection.remove(this.model);0===this.collection.length&&this.__dollarStoreManager.trigger("empty_multi_cart");this.__dollarStoreManager.trigger("update_cart_total_price");this.model.attributes.productModel.trigger("removed_from_cart",this.collection);this.model.get("edge").rules.includes("is_vcoin")&&this.__dollarStoreManager.trigger("update_cart_vcoin_total")},__updatePrice:function(){this.render()}})}({Model:l["@Model"],UiCore:l["@UiCore"],template:tb}),J=function(k){var b=k.UiCore.ListPresenter;return b.extend("MultiCartList",{className:"multi-cart-list",uiContextName:"multi_cart_list",tagName:"ul",dependencies:["dollarStoreManager","globalStringManager","modeManager"],trackedEvents:function(){return[]},initialize:function(a){this.itemFactory=a.itemFactory||k.MultiCartItem;b.prototype.initialize.call(this,a)},render:function(){b.prototype.render.call(this);this.$el.html(k.template())}})}({UiCore:l["@UiCore"],MultiCartItem:ub,template:sb}),vb=function(k){var b=k.MultiCartAbstractDialog;return b.extend("MultiCartCheckout",{uiContextName:"multicart_checkout_dialog",className:"multicart-checkout-dialog dialog-type-B",dependencies:"cart defaultChannel dialogManager dollarStoreManager externalNextRoot featureAccessManager globalStartupModel globalStringManager loginManager modeManager nextRoot paymentChannels prefsManager Promise restModelFactory urlManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".btn-primary.checkout",name:"checkout",handler:"__checkout",attributes:this.__getAttributes.bind(this)},{type:"click",selector:"input[id=vip_checkbox]",name:"vip_checkbox",handler:"__vipCheckbox"},{type:"click",selector:".terms .link",name:"general_tos",handler:"__generalTOS"},{type:"click",selector:".payment-channel-list li",name:"select_payment",handler:"__selectPayment"},{type:"click",selector:".other-checkout-container.active .other-payment-channel-list li",name:"select_extended_payment",handler:"__selectPaymentExtended"},{type:"click",selector:".back-button",name:"back_to_primary_channels",handler:this.__backToPrimaries},{type:"click",selector:".vcoin-terms-and-conditions-link",name:"vcoin_terms_and_conditions_link",handler:"__vcoinTOS"},{type:"click",selector:"input[id=vcoin_terms_and_conditions_checkbox]",name:"vcoin_terms_and_conditions_checkbox",handler:"__vcoinTermsCheckbox"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.restModelFactory=a.restModelFactory;var d=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=d.url;this.__coreDollarstoreProductOfferingId=d.id;this.__getProductOfferingDataFromCoreDS();this.__prefsManager=a.prefsManager;this.__featureAccessManager=a.featureAccessManager;this.__paymentChannels=IMVU.requireProperty(a,"paymentChannels");this.__origin=IMVU.optionalProperty(a,"origin",null);this.__afterAction=IMVU.optionalProperty(a,"afterAction",null);this.title=this.__globalStringManager.get("CART SUMMARY");this.__vipModel=IMVU.optionalProperty(a,"vipModel",null);this.__hostModel=IMVU.optionalProperty(a,"hostModel",null);this.__which=IMVU.optionalProperty(a,"which",null);this.__hostModel&&(this.__afterAction="close");this.__addRoomTile=a.addRoomTile;this.__hostingSelfCancel=this.__hasTieredVipInCart=this.__hasVIPInCart=!1;this.__total=0;_.each(this.__cart.models,function(e){this.__total+=e.attributes.edge.sale_price;e.attributes.edge.rules.includes("is_vcoin")&&(this.__hasVcoinInCart=!0);e.attributes.edge.rules.includes("hosting_self_cancel")&&(this.__hostingSelfCancel=!0);"vip"==e.attributes.node.category&&(this.__vipModel=e,this.__hasVIPInCart=!0,e=this.__vipModel.get("node"),this.__hasTieredVipInCart=["vip_web_tier_1","vip_web_tier_2","vip_web_tier_3"].includes(e.code_name))}.bind(this));this.__cartTotalInVcoin=(250*this.__total).toFixed(2);this.__total="$"+parseFloat(this.__total).toFixed(2);this.listenTo(this.__dollarStoreManager,"update_checkout_total_price",this.__updateCheckoutTotal);d=[];this.__defaultChannel&&d.push(this.__defaultChannel.populated());d.push(this.__paymentChannels.populated());this.__Promise.every(d).then(function(){this.addToDOM()}.bind(this));this.__autoLaunchReview=IMVU.optionalProperty(a,"autoLaunchReview",!1)},postRender:function(){var a=this;this.__saved_card=null;this.$(".dialog-header").prepend('<div class="back-button hidden"></div>');this.__vantiv_ch=this.__getVantivChannel();var d=this.__globalStartupModel.get("savedCreditCardUrl"),e=this.track(this.__restModelFactory.readCollection(d,k.UiCore.NodeCollection));e.invalidate();e.populated().then(function(){a.__hasVIPInCart&&4===a.__myself.get("vip_platform")&&a.__dialogManager.confirm({title:a.__globalStringManager.get("vip_upsell_previous_subscription_title"),text:a.__globalStringManager.get("vip_upsell_previous_subscription_body"),no:a.__globalStringManager.get("CANCEL"),yes:a.__globalStringManager.get("OKAY")}).finished.catch(function(){a.close()})}).then(function(){if(a.__hasVIPInCart&&[2,3].includes(a.__myself.get("vip_platform"))){var c=[a.__globalStringManager.get("vip_upsell_company_1"),a.__globalStringManager.get("vip_upsell_company_2")][a.__myself.get("vip_platform")],g=[a.__globalStringManager.get("vip_upsell_platform_1"),a.__globalStringManager.get("vip_upsell_platform_2")][a.__myself.get("vip_platform")];c=a.__globalStringManager.get("vip_upsell_previous_subscription_mobile_body",{company:c?c:a.__globalStringManager.get("vip_upsell_company_3"),platform:g?g:a.__globalStringManager.get("vip_upsell_platform_3")});a.__dialogManager.alert({title:a.__globalStringManager.get("vip_upsell_previous_subscription_title"),text:c,ok:a.__globalStringManager.get("OKAY")}).finished.then(function(){a.__dialogManager.closeAll()}).catch(function(){a.__dialogManager.closeAll()})}}).then(function(){a.__hasVIPInCart&&a.__myself.get("is_host")&&(a.__hostingSelfCancel?a.__dialogManager.alert({title:a.__globalStringManager.get("vip_upsell_previous_host_subscription_title"),text:a.__globalStringManager.get("vip_upsell_previous_host_subscription_mobile_body"),ok:a.__globalStringManager.get("OKAY")}):a.__dialogManager.confirm({title:a.__globalStringManager.get("vip_upsell_previous_host_subscription_title"),html:a.__globalStringManager.get("vip_upsell_previous_host_subscription_desktop_body"),yes:a.__globalStringManager.get("OKAY"),no:a.__globalStringManager.get("CANCEL")}).finished.catch(function(){a.close()}))}).then(function(){var c=_.filter(e.models,function(h){return!0===h.attributes.is_primary&&"co"===h.attributes.system}.bind(this));_.isEmpty(c)&&(c=_.filter(e.models,function(h){return"co"===h.attributes.system}.bind(this)));!_.isEmpty(c)&&this.__vantiv_ch&&(this.__saved_card=c[0]);if(this.__saved_card){this.__saved_card.attributes.saved_card=!0;this.__saved_card.attributes.channel_key="saved_card";this.__saved_card.attributes.payment_method="vantiv";this.__saved_card.attributes["metadata.credit_card"]=1;c={id:"different_card",attributes:{display_name:this.__globalStringManager.get("USE DIFFERENT CARD"),icon_url:"/common/withme/img/store/payment/payment-creditcard.png",channel_key:"different_card",payment_method:"vantiv"},populated:function(){return new this.__Promise(function(h){h.accept(!0)}.bind(this))}.bind(this)};c.attributes["metadata.credit_card"]=1;var g=_.filter(this.__paymentChannels.models,function(h){return"saved_card"===h.attributes.channel_key});_.isEmpty(g)?(this.__paymentChannels.models.splice(0,0,c),this.__paymentChannels.models.splice(0,0,this.__saved_card)):this.__paymentChannels.models.splice(0,1,this.__saved_card)}c={total:this.__total,vcoinInCart:this.__hasVcoinInCart,tieredVIPInCart:this.__hasTieredVipInCart,helpCenterURL:this.__urlManager.get("imvu_help_privacy_policy"),subscriptionURL:this.__urlManager.get("manage_subscription"),vipTermsURL:this.__urlManager.get("policy_hub_vip")};this.setContent("body",k.template,c);var f=!1;_.each(this.__cart.models,function(h){0===h.get("edge").normal_price&&"credits"===h.get("node").code_name&&1===h.get("node").credits&&(f=!0)}.bind(this));_.each(this.__cart.models,function(h){h.attributes.node.disableCheckbox=f}.bind(this));this.__cartList=this.createChildContext(k.MultiCartList,{$replaceElement:this.$(".multi-cart-list-placehoder"),itemFactory:k.MultiCartCheckoutItem,collection:this.__cart});this.__updateAvailablePaymentMethods();this.setContent("footer",this.$(".dialog-footer-template").text());this.__vipModel&&(this.__vipWidget=this.createChildContext(k.MultiCartVipStatus,{$parentElement:this.$(".vip-status-widget"),model:this.__vipModel}),this.$(".agreement .vip-panel").removeClass("hidden"),this.$(".btn-primary.checkout").addClass("disabled"),this.createChildContext(k.Tooltip,{$replaceElement:this.$(".vip-toc-tooltip"),$tooltipTarget:this.$(".vip-toc-link"),tooltipPosition:"bottom"}));this.__hasVcoinInCart&&this.__availablePaymentChannels.length&&(c=1===this.__prefsManager.getInt("next.user_accepted_vcoin_tc"),this.$(".btn-primary.checkout").prop("disabled",!c),c&&this.$(".vcoin-checkbox").attr("checked","checked"));this.__selectPayment({target:{id:this.__availablePaymentChannels[0].id}});this.__autoLaunchReview&&this.__validateChannelPayoutPromise.then(function(){this.__checkout()}.bind(this))}.bind(this))},__destroy:function(){this.hide();this.delete()},__getAttributes:function(){return{which:this.__which}},__updateAvailablePaymentMethods:function(){var a=this;this.__availablePaymentChannels=this.__paymentChannels.models;var d=!1;_.each(this.__cart.models,function(e){e.attributes.edge.rules.includes("credit_card_only")&&e.isCheckedoutModel&&(d=!0)});d?(this.__creditCardPayemntChannels=_.filter(this.__availablePaymentChannels,function(e){if(1===e.attributes["metadata.credit_card"])return e}),this.__creditCardPayemntChannels.length?(this.$(".notice-credit-card-only-message").removeClass("hidden"),this.__availablePaymentChannels=this.__creditCardPayemntChannels):(this.$(".notice-credit-card-only-message").addClass("hidden"),this.$(".items-unavailable-for-purchase").addClass("error-visible"),_.each(this.__cartList.collection.models,function(e){e.attributes.edge.rules.includes("credit_card_only")&&(e.isCheckedoutModel=!1,e.isDisabledModel=!0,a.$(".multi-cart-item-info input[id=multi-cart-item-"+e.cid+"].checkbox").prop({checked:!1,disabled:!0}));e.isCheckedoutModel&&(a.__total+=e.attributes.edge.sale_price)}))):this.$(".notice-credit-card-only-message").addClass("hidden");this.__hasVcoinInCart&&(this.__vcoinPayemntChannels=_.filter(this.__availablePaymentChannels,function(e){if(1===e.attributes["metadata.sells_vcoin"])return e}),this.__vcoinPayemntChannels.length?(this.__availablePaymentChannels=this.__vcoinPayemntChannels,this.$(".notice-credit-card-only-message").removeClass("hidden")):(this.$(".notice-credit-card-only-message").addClass("hidden"),this.$(".items-unavailable-for-purchase").addClass("error-visible"),_.each(this.__cartList.collection.models,function(e){e.attributes.edge.rules.includes("is_vcoin")&&(e.isCheckedoutModel=!1,e.isDisabledModel=!0,a.$(".multi-cart-item-info input[id=multi-cart-item-"+e.cid+"].checkbox").prop({checked:!1,disabled:!0}));e.isCheckedoutModel&&(a.__total+=e.attributes.edge.sale_price)})));this.__checkForPaymentsOverride().then(function(e){a.$(".payment-channels-wrapper").empty();a.$(".other-checkout-container").empty();a.__paymentChannelsList=a.createChildContext(k.PaymentChannels,{$parentElement:a.$(".payment-channels-wrapper"),channels:e.slice(0,3),otherchannels:e.slice(3),hasOtherChannels:0<e.slice(3).length});0<e.slice(3).length&&(a.__otherPaymentChannelsList=a.createChildContext(k.OtherPaymentChannels,{$parentElement:a.$(".other-checkout-container"),otherChannels:e.slice(3)}));a.$('.payment-channel-list li[id="'+e[0].id+'"]').addClass("is-selected");a._currentPaymentChannels=e})},__updateCheckoutTotal:function(){var a=this;this.__total=0;this.__hostModel=this.__vipModel=null;this.__hasAtLeastOneSubscription=this.__hasVcoinInCart=!1;_.each(this.__cartList.collection.models,function(d){d.isCheckedoutModel&&("vip"===d.attributes.node.category?this.__vipModel=d:"hosting"===d.attributes.node.category&&(this.__hostModel=d),!0===d.attributes.edge.rules.includes("is_subscription")&&1<this.__cartList.collection.models.length&&!1===this.__hasAtLeastOneSubscription&&(this.__hasAtLeastOneSubscription=!0),d.attributes.edge.rules.includes("is_vcoin")&&(this.__hasVcoinInCart=!0))}.bind(this));this.__total=0;this.$("notice-credit-card-only-message").addClass("hidden");this.$(".notice-subscription-message").addClass("hidden");this.__hasVcoinInCart&&this.$(".notice-credit-card-only-message").removeClass("hidden");this.__hasVcoinInCart?_.each(this.__cartList.collection.models,function(d){d.isDisabledModel=!1;a.$(".multi-cart-item-info input[id=multi-cart-item-"+d.cid+"].checkbox").prop({disabled:!1});d.isCheckedoutModel&&(a.__total+=d.attributes.edge.sale_price)}):!1===this.__hasAtLeastOneSubscription?(_.each(this.__cartList.collection.models,function(d){!0!==d.attributes.edge.rules.includes("is_subscription")&&(!d.attributes.edge.rules.includes("is_vcoin")||d.attributes.edge.rules.includes("is_vcoin")&&1<=a.__vcoinPayemntChannels.length)&&(!d.attributes.edge.rules.includes("credit_card_only")||d.attributes.edge.rules.includes("credit_card_only")&&1<=a.__creditCardPayemntChannels.length)&&(d.isDisabledModel=!1,a.$(".multi-cart-item-info input[id=multi-cart-item-"+d.cid+"].checkbox").prop({disabled:!1}));d.isCheckedoutModel&&(a.__total+=d.attributes.edge.sale_price)}),this.$(".notice-subscription-message").addClass("hidden")):(this.__hasAtLeastOneSubscription=!1,_.each(this.__cart.models,function(d){!0===d.attributes.edge.rules.includes("is_subscription")&&!1===a.__hasAtLeastOneSubscription?(a.__hasAtLeastOneSubscription=!0,a.$(".notice-subscription-message").removeClass("hidden")):d.attributes.edge.rules.includes("is_vcoin")?d.isCheckedoutModel=!1:(d.isCheckedoutModel=!1,d.isDisabledModel=!0,a.$(".multi-cart-item-info input[id=multi-cart-item-"+d.cid+"].checkbox").prop({checked:!1,disabled:!0}));d.isCheckedoutModel&&(a.__total+=d.attributes.edge.sale_price)}));this.__updateAvailablePaymentMethods();0===this.__total?this.$(".btn.btn-primary.checkout").addClass("disabled"):this.$(".btn.btn-primary.checkout").removeClass("disabled");this.__vipWidget&&this.__vipWidget.delete();this.__vipModel?(this.__vipWidget=this.createChildContext(k.MultiCartVipStatus,{$parentElement:this.$(".vip-status-widget"),model:this.__vipModel}),this.$(".agreement .vip-panel").removeClass("hidden"),this.$("input[id=vip_checkbox]").prop("checked")?this.$(".btn-primary.checkout").removeClass("disabled"):this.$(".btn-primary.checkout").addClass("disabled")):this.$(".agreement .vip-panel").addClass("hidden");this.__cartTotalInVcoin=(250*this.__total).toFixed(2);this.__total="$"+parseFloat(this.__total).toFixed(2);this.$(".checkout-bottom-container .price-summary .price").text(this.__total)},__selectPayment:function(a){var d=a.target.id;"other-payment-type"===d?this.__vipModel&&!this.$("input[id=vip_checkbox]").prop("checked")?this.$(".vip-checkbox-missing").addClass("error-visible"):this.__hasVcoinInCart&&!this.$("input[id=vcoin_terms_and_conditions_checkbox]").prop("checked")?this.$(".vcoin-checkbox-missing").addClass("error-visible"):this.__showExtendedPaymentOptions():this.__validateChannelPayoutPromise=this.__validateChannelPayout(this.__getChannel(d),this.__defaultChannel,this.__vantiv_ch).then(function(){this.$(".other-payment-channel-list li").removeClass("is-selected");this.__updateCheckoutTotal();this.$(".payment-channel-list li").removeClass("is-selected");this.$('.payment-channel-list li[id="'+d+'"]').addClass("is-selected")}.bind(this))},__showExtendedPaymentOptions:function(){this.$(".vip-checkbox-missing").removeClass("error-visible");this.$(".vcoin-checkbox-missing").removeClass("error-visible");this.$(".checkout-container").addClass("hidden");this.$(".other-checkout-container").addClass("active");this.$(".dialog-header .back-button").removeClass("hidden")},__showPrimaryPaymentOptions:function(){this.$(".checkout-container").removeClass("hidden");this.$(".other-checkout-container").removeClass("active");this.$(".dialog-header .back-button").addClass("hidden")},__selectPaymentExtended:function(a){var d=a.target.id;"other-payment-type"===d?this.__showPrimaryPaymentOptions():this.__validateChannelPayout(this.__getChannel(d),this.__defaultChannel,this.__vantiv_ch).then(function(){this.__updateCheckoutTotal();this.$(".payment-channel-list li").removeClass("is-selected");this.$(".other-payment-channel-list li").removeClass("is-selected");this.$('.other-payment-channel-list li[id="'+d+'"]').addClass("is-selected")}.bind(this))},__backToPrimaries:function(){this.__showPrimaryPaymentOptions()},__generalTOS:function(){var a=this.__urlManager.get("policy_hub_terms");this.__featureAccessManager.isElectronClient()?(this.__electron=this.__window.electronRequire("electron"),this.__electron.shell.openExternal(a)):this.__window.open(a,"_blank")},__vcoinTOS:function(a){this.__generalTOS();a.stopImmediatePropagation()},__vipCheckbox:function(){this.$("input[id=vip_checkbox]").prop("checked")?(this.$(".vip-checkbox-missing").removeClass("error-visible"),this.$(".btn-primary.checkout").removeClass("disabled")):this.$(".btn-primary.checkout").addClass("disabled")},__vcoinTermsCheckbox:function(){this.$("input[id=vcoin_terms_and_conditions_checkbox]").prop("checked")?(this.__prefsManager.setInt("next.user_accepted_vcoin_tc",1),this.$(".vcoin-checkbox-missing").removeClass("error-visible"),this.$(".btn-primary.checkout").prop("disabled",!1)):(this.__prefsManager.setInt("next.user_accepted_vcoin_tc",0),this.$(".btn-primary.checkout").prop("disabled",!0))},__getVantivChannel:function(){return _.find(this.__paymentChannels.models,function(a){if("vantiv"===a.attributes.channel_key)return a})},__getChannel:function(a){return _.find(this.__paymentChannels.models,function(d){if(a===d.id)return d})},__checkout:function(){var a=".checkout-container";this.$(".vip-checkbox-missing").removeClass("error-visible");this.$(".vcoin-checkbox-missing").removeClass("error-visible");this.$(".checkout-container").hasClass("hidden")&&(a=".other-checkout-container");var d=this.$(a+" li.is-selected").prop("id");d||(".other-checkout-container"===a?d=this.$(".checkout-container li.is-selected").prop("id"):".checkout-container"===a&&(d=this.$(".other-checkout-container li.is-selected").prop("id")));d=this.__getChannel(d);var e=this.__dollarStoreManager.validateMultiCartCheckoutRules(d,this.__cart);if(_.isEmpty(e))this.__checkoutValidCart(d);else{var c=_.filter(e,function(g){return"credit_card_only"===g.type});_.isEmpty(c)||this.__dialogManager.showDialog(k.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("CART CONTENTS WILL CHANGE"),text:this.__globalStringManager.get("CART CONTENTS WILL CHANGE DESC"),yes:this.__globalStringManager.get("OK"),no:this.__globalStringManager.get("CANCEL")}).finished.then(function(){_.each(c,function(g){var f="multi-cart-item-"+g.target.cid;this.$("input[id="+f+"]").prop("checked",!1);g.target.isCheckedoutModel=!1;this.__dollarStoreManager.trigger("update_checkout_total_price");this.$('label[for="'+f+'"]').addClass("removed")}.bind(this));".other-checkout-container"===a&&this.__showPrimaryPaymentOptions()}.bind(this)).catch(function(){}.bind(this))}},__checkoutValidCart:function(a){"vantiv"===a.attributes.payment_method?"vantiv"===a.attributes.channel_key?this.__checkoutVantivNewCard(a):"saved_card"===a.attributes.channel_key?this.__checkoutVantivSavedCard(a):"different_card"===a.attributes.channel_key&&this.__checkoutVantivManageCards(a):"paypal"===a.attributes.payment_method?this.__checkoutPaypal(a):"paymentwall"===a.attributes.payment_method?this.__checkoutPaymentWall(a):"test"===a.attributes.payment_method?this.__checkoutTestChannel(a,this.__cart):"vcoin"===a.attributes.payment_method&&(this.__wallet=this.track(this.__myself.getSingleEdge("wallet")),this.__dollarStoreManager.storeCheckoutWithVcoin({cartCollection:this.__cart,cartTotalInVcoin:this.__cartTotalInVcoin,paymentChannels:this.__paymentChannels,source:"multicart_checkout",wallet:this.__wallet}))},__validateChannelPayout:function(a,d,e){return new this.__Promise(function(c){var g=!1,f=a.attributes.payout,h=d.attributes.payout,m=this.__dollarStoreManager.getDefaultCategories();f||(f=e.attributes.payout,g=!0);h||(h=e.attributes.payout);f<h&&70>f?this.__dialogManager.showDialog(k.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("PRICE ADJUSTMENT TITLE"),text:this.__globalStringManager.get("PRICE ADJUSTMENT DESC"),yes:this.__globalStringManager.get("OK"),no:this.__globalStringManager.get("CANCEL")}).finished.then(function(){this.__window.$("body").addClass("waiting");this.__dollarStoreManager.getProductsOffered(m,a).then(function(n){this.__updateCartModels(this.__cart.models,n.models);this.__window.$("body").removeClass("waiting");return c.accept()}.bind(this))}.bind(this)).catch(function(){return c.reject()}.bind(this)):f>h&&70>h?this.__dialogManager.showDialog(k.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("PRICE ADJUSTMENT TITLE"),text:this.__globalStringManager.get("PRICE ADJUSTMENT LOWER DESC"),yes:this.__globalStringManager.get("OK"),no:this.__globalStringManager.get("CANCEL")}).finished.then(function(){this.__window.$("body").addClass("waiting");g&&(a=e);this.__dollarStoreManager.getProductsOffered(m,a).then(function(n){this.__updateCartModels(this.__cart.models,n.models);this.__window.$("body").removeClass("waiting");return c.accept()}.bind(this))}.bind(this)).catch(function(){return c.reject()}.bind(this)):(this.__window.$("body").addClass("waiting"),g&&(a=e),this.__dollarStoreManager.getProductsOffered(m,a).then(function(n){this.__updateCartModels(this.__cart.models,n.models);this.__window.$("body").removeClass("waiting");return c.accept()}.bind(this)))}.bind(this))},__updateCartModels:function(a,d){_.each(a,function(e){_.each(d,function(c){var g=this.__coreDollarstoreProductOfferingId?this.__coreDollarstoreProductOfferingId:c.edge.attributes.product_offering_id,f=c.edge.attributes.sale_price,h=c.edge.attributes.sale_price_formatted;this.__oldDollarstoreProductOfferingUrl&&(e.attributes.edge.normal_price<c.edge.attributes.normal_price||e.attributes.edge.normal_price<e.attributes.edge.sale_price)&&(f=e.attributes.edge.normal_price,h=e.attributes.edge.normal_price_formatted);e.attributes.node.id===c.node.id&&(e.productModel=c,e.attributes.edge.normal_price=c.edge.attributes.normal_price,e.attributes.edge.normal_price_formatted=c.edge.attributes.normal_price_formatted,e.attributes.edge.product_offering_id=g,e.attributes.edge.sale_price=f,e.attributes.edge.sale_price_formatted=h,e.trigger("cart_model_price_update"))}.bind(this))}.bind(this))},__getReloadURL:function(){for(var a=this.__window.location.href,d=this.__serviceProvider.get("acceptedDollarStorePermaLinkProducts"),e=0;e<d.length;e++)if(a.endsWith("/store/"+d[e]+"/")){a=this.__window.location.origin+"/next/store/";break}return a},__handleAfterAction:function(a){"close"===this.__afterAction?this.close():"closeAll"===this.__afterAction?this.__dialogManager.closeAll():"reload"===this.__afterAction?this.__window.location=this.__getReloadURL():"closeToEditRoomSettings"===this.__afterAction?this.__dialogManager.closeTo("edit-room-settings"):"restWebGiftingDialog"===this.__afterAction?this.__dialogManager.closeTo("rest-web-gifting-dialog"):"upsellShell"===this.__afterAction?this.__modeManager.openMode({mode:{id:"shop"},submode:{id:"rooms"}}):"selectPrivateRoom"===this.__afterAction?this.__addRoomTile&&this.__addRoomTile.callOpenSelectRoomDialog({isPublicOverride:!0}):"clear_cart"===a?this.__window.location.reload():this.close()},__checkoutVantivNewCard:function(a){this.__dialogManager.showDialog(k.MultiCartAddCreditCard,{cart:this.__cart,channel:a,orderTotal:this.__total,origin:this.__origin}).finished.then(function(d){this.promiseResolver.resolve();this.__handleAfterAction(d)}.bind(this)).catch(function(d){"closing_all"===d&&this.close()}.bind(this))},__checkoutVantivSavedCard:function(a){this.__dialogManager.showDialog(k.MultiCartReview,{billingInfo:{card_type:this.__saved_card.attributes.card_type,name:this.__saved_card.attributes.name,last_four_digits:this.__saved_card.attributes.card_last_digits,card_id:this.__saved_card.id,saved_card:!0},channel:this.__vantiv_ch,cart:this.__cart,origin:this.__origin}).finished.then(function(d){this.promiseResolver.resolve();this.__handleAfterAction(d)}.bind(this)).catch(function(d){"closing_all"===d&&(this.promiseResolver.resolve(d),this.close())}.bind(this))},__checkoutVantivManageCards:function(a){this.__dialogManager.showDialog(k.MultiCartSavedCards,{billingInfo:{card_type:this.__saved_card.attributes.card_type,name:this.__saved_card.attributes.name,last_four_digits:this.__saved_card.attributes.card_last_digits,card_id:this.__saved_card.id,saved_card:!0},channel:this.__vantiv_ch,cart:this.__cart,origin:this.__origin}).finished.then(function(d){this.promiseResolver.resolve();this.__handleAfterAction(d)}.bind(this)).catch(function(d){"closing_all"===d&&this.close()}.bind(this))},__checkoutPaypal:function(a){this.__paypalCheckout(a,this.__cart).then(function(d){"finished_order_success"===d?this.promiseResolver.resolve("clear_cart"):this.promiseResolver.reject("clear_cart")}.bind(this)).catch(function(d){this.close()}.bind(this))},__checkoutPaymentWall:function(a){this.__paymentWallCheckout(a,this.__cart).then(function(d){this.close()}.bind(this))},__checkoutTestChannel:function(a,d){a=this.__buildOrderSelection(d.models);a={total:this.__calculateTotal(d.models),product_offering_id:d.models[0].attributes.edge.product_offering_id,selected:a};var e=this.__globalStartupModel.get("cashOrderTrans");this.__restModelFactory.createModel(e,k.UiCore.NodeModel,a).then(function(c){this.__dialogManager.showDialog(k.MultiCartSuccess,{cart:d.models,orderResponse:c,channel:"test",origin:this.__origin}).finished.then(function(g){this.promiseResolver.resolve("clear_cart")}.bind(this))}.bind(this)).catch(function(c){this.promiseResolver.reject()}.bind(this))},__checkForPaymentsOverride:function(){var a=this;return new this.__Promise(function(d){d.resolve(_.reject(a.__availablePaymentChannels,function(e,c){var g=e.attributes.override_with;return void 0!==g&&_.find(a.__availablePaymentChannels,function(f){return f.attributes.channel_key===g})?!0:!1}))})}})}({Dialogs:l["@Dialogs"],Model:l["@Model"],UiCore:l["@UiCore"],MultiCartAbstractDialog:H,MultiCartAddCreditCard:I,MultiCartCheckoutItem:pb,MultiCartList:J,MultiCartReview:x,MultiCartSavedCards:lb,MultiCartSuccess:G,MultiCartVipStatus:nb,OtherPaymentChannels:rb,PaymentChannels:gb,Tooltip:r,template:hb}),wb=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("MultiCartUpsellDialog",{className:"multicart-upsell-dialog dialog-type-B",uiContextName:"multicart_upsell_dialog",dependencies:"dialogManager featureAccessManager globalStartupModel globalStringManager loginManager urlManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".checkout-cta:not(.disabled)",name:"add_to_cart",handler:"__handleCheckout"},{type:"click",selector:".greeter-cta",name:"greeter_cta",handler:"__handleGreeterCTA"},{type:"click",selector:".learn",name:"learn_more",handler:this.__handleLearnMore}]},initialize:function(a){b.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.__singleItemCart=new k.CartCollection([]);if(this.__isLoggedIn=this.__loginManager.isLoggedIn())this.__dollarStoreManager=this.__serviceProvider.get("dollarStoreManager"),this.__myself=this.__loginManager.getCurrentUser();this.__upsellProduct=IMVU.requireProperty(a,"upsellProduct","credits");this.__isCreatorLanding=IMVU.optionalProperty(a,"isCreatorLanding",!1);this.__customSubtitle=IMVU.optionalProperty(a,"customSubtitle",!1);this.__customDlg_name=IMVU.optionalProperty(a,"customDlg_name",!1);this.__customDescription=IMVU.optionalProperty(a,"customDescription",!1);this.upsellAfterGift=IMVU.optionalProperty(a,"upsellAfterGift",!1);this.__customProductAdUrl=IMVU.optionalProperty(a,"customProductAdUrl",!1);this.__giftRecipient=IMVU.optionalProperty(a,"giftRecipient",!1);this.__isContextual=IMVU.optionalProperty(a,"contextual",!1);this.__afterAction=IMVU.optionalProperty(a,"afterAction",null);this.__vipForWhisper=IMVU.optionalProperty(a,"vipForWhisper",!1);this.__vipTrigger=IMVU.optionalProperty(a,"vipTrigger",null);this.__vipTriggerLocation=IMVU.optionalProperty(a,"vipTriggerLocation",null);this.__model=null;this.__simulated=!1;this.__packageMap=this.__getPackageMap();this.__categories=this.__getCategories().categories;this.__storeType=this.__getCategories().storeType;this.__disabledProducts=IMVU.optionalProperty(a,"disabledProducts",[]);this.__selectedProduct=IMVU.optionalProperty(a,"selectedProduct",!1);this.__isTieredVIP="vip"===this.__upsellProduct;this.addToDOM()},postRender:function(){var a=this;this.$el.addClass("product-"+this.__upsellProduct);if(this.__isLoggedIn&&"greeter"!==this.__upsellProduct)this.__dollarStoreManager.getPaymentChannels(this.__categories,this.__storeType).then(function(e){a.__paymentChannels=e;if(e.at(0)&&"vantiv"===e.at(0).attributes.payment_method){var c=_.find(e.models,function(g){if("vantiv"===g.attributes.channel_key)return g});a.__defaultPaymentChannel=c?c:e.at(0)}else a.__defaultPaymentChannel=e.at(0)}).then(function(){"vcoin"===a.__upsellProduct&&a.listenTo(a,"vcoin_product_selected_in_blocked_region",function(){this.__showVcoinUnavailableOnCheckout=!0});if(void 0===a.__defaultPaymentChannel&&"vcoin"==a.__upsellProduct){var e='<a href="'+a.__urlManager.get("unavailable_vcoin")+'" target="_blank">'+a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_link")+"</a>";e="<p>"+a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_part1")+" "+e+". "+a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_part2")+"</p>";a.__dialogManager.alert({title:a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_title"),html:e,ok:a.__globalStringManager.get("OKAY"),dark_text:!0}).finished.then(function(){a.hide()})}else a.__dollarStoreManager.getProductsOffered(a.__categories,a.__defaultPaymentChannel,void 0,!0).then(function(c){var g=!1;a.__upsellProductModel=null;a.__upsellProductCollection=c;for(var f=c.models,h=f.length,m,n=0;n<h;n++)if(m=f[n],"access_pass"===m.node.get("code_name")&&"ap"===a.__upsellProduct||"marriage_license"===m.node.get("code_name")&&"marriage_package"===a.__upsellProduct||"age_verification"===m.node.get("code_name")&&"age_verification"===a.__upsellProduct||"shared_room"===m.node.get("code_name")&&"shared_room"===a.__upsellProduct||"name_change_tokens"===m.node.get("code_name")&&"name_change"===a.__upsellProduct||"name_change_and_registration"===m.node.get("code_name")&&"name_change"===a.__upsellProduct||"chat_room_slot"===m.node.get("code_name")&&"room_slot"===a.__upsellProduct){a.__upsellProductModel=m;break}a.__upsellProductModel?g=!0:("host_subscription"===a.__upsellProduct||"credits"===a.__upsellProduct||"vcoin"===a.__upsellProduct)&&0<f.length?(a.__upsellProductModel=c.models[0],g=!0):"vip"===a.__upsellProduct&&0<f.length?(a.__upsellProductModel=c.models[0],g=!0):"vip"===a.__upsellProduct&&0===f.length&&(g=!1);a.__model=a.__upsellProductModel;a.__model&&g?a.__getPackageMapOverrides():a.__getSimulatedModel()}).catch(function(c){}).then(function(){a.title=a.__model.node.attributes.name;a.__getPackageMapOverrides();a.__isTieredVIP&&(a.__isCreatorLanding?(a.title=a.__globalStringManager.get("vip_upsell_creator_landing_title"),a.__subtitle=a.__globalStringManager.get("vip_upsell_creator_landing_subtitle")):(a.title=a.__globalStringManager.get("vip_upsell_title"),a.__subtitle=a.__globalStringManager.get("vip_upsell_subtitle")));a.__renderTitle();a.upsellAfterGift&&a.__adjustDialogSize();a.setContent("body",k.template,{product_ad_url:a.__customProductAdUrl?a.__customProductAdUrl:a.__model.node.attributes.dlg_background_url,subtitle:a.__subtitle,loggedIn:a.__isLoggedIn,greeter:"greeter"===a.__upsellProduct,sale_price:a.__model.edge.attributes.sale_price_formatted,upsellAfterGift:a.upsellAfterGift,giftRecipient:a.__giftRecipient,simulated:a.__simulated});if("vip"===a.__upsellProduct&&a.__vipTrigger&&a.__vipTriggerLocation){var c={vipTriggerLocation:a.__vipTriggerLocation,vipTrigger:a.__vipTrigger,clientIp:a.__globalStartupModel.get("clientIPAddress")};a.recordShowTieredVipUpsell(c)}a.$(".description").html(a.__isTieredVIP?k.multiProductUpsellVipTiers({vip_web_tier_1:1,vip_web_tier_2:1,vip_web_tier_3:1,isCreatorLanding:a.__isCreatorLanding,canSeeYouTube:a.__featureAccessManager.canSeeYouTubePreRecorded()}):a.__description);a.setContent("footer",a.$(".dialog-footer-template").text());a.__isLoggedIn&&("credits"===a.__upsellProduct||"host_subscription"===a.__upsellProduct||"vip"===a.__upsellProduct)||"vcoin"===a.__upsellProduct?(a.__disableCheckoutButton(),a.upsellAfterGift&&a.__enableCheckoutButton(),c=a.$(".product-selectors").expect(1),c.addClass("go-link"),c.html(""),a.__simulated?a.__enableSimulatedCheckoutButton():a.productsList=a.createChildContext(k.MultiProductList,{$parentElement:c,collection:a.__upsellProductCollection,cartCollection:a.__singleItemCart,category:a.__upsellProduct,upsellDialog:a,isUpsell:!0,disabledProducts:a.__disabledProducts,selectedProduct:a.__selectedProduct})):a.__simulated?a.__enableSimulatedCheckoutButton():a.__enableCheckoutButton();a.$el.is(".dialog-type-B, .dialog-type-B-flexible")&&a.$el.closest("body").is(".mobile")&&a.__adjustTitlePosition();a.$(".dialog-body-scroller").scrollbar()}).catch(function(c){a.__window.console.error("HostSubUpsellDialog::render - Failed to render BuyUpgradeHostSubList",c)})}).catch(function(){a.__window.console.error("HostSubUpsellDialog::render - Failed to get payment channels")});else{var d="vcoin"===this.__upsellProduct;this.__getSimulatedModel();this.setContent("body",k.template,{product_ad_url:this.__customProductAdUrl?this.__customProductAdUrl:this.__model.node.attributes.dlg_background_url,subtitle:this.__subtitle,loggedIn:this.__isLoggedIn,greeter:"greeter"===this.__upsellProduct,sale_price:this.__model.edge.attributes.sale_price_formatted,simulated:!0,vcoinUpsell:d,upsellAfterGift:this.upsellAfterGift,giftRecipient:this.__giftRecipient});d&&this.$(".dialog-body").addClass("vcoin-logged-out");"vip"===this.__upsellProduct&&(!1===this.__selectedProduct&&(this.__selectedProduct=1),d={},this.__description=k.multiProductUpsellVipTiers((d["vip_web_tier_"+(1+this.__selectedProduct)]=1,d.canSeeYouTube=this.__featureAccessManager.canSeeYouTubePreRecorded(),d)));this.$(".description").html(this.__description);this.setContent("footer",this.$(".dialog-footer-template").text());this.__enableSimulatedCheckoutButton();this.$(".dialog-body-scroller").scrollbar()}},__directToLogin:function(){this.__loginManager.setLoginDestination(this.__nextRoot+"store/"+this.__upsellProduct);this.__window.location="/welcome/login/";this.forwardedToLogin=!0},aProductClicked:function(a){this.__model=a;null===a?this.__disableCheckoutButton():(this.__enableCheckoutButton(),this.upsellAfterGift&&this.__addToCart(!0))},switchDescription:function(a){this.$("."+a+"-description").show().siblings().hide()},__getErrorString:function(){var a="",d=!1===this.__myself.get("is_adult");switch(this.__upsellProduct){case"ap":a=d?this.__globalStringManager.get("oops_minor_ap"):this.__globalStringManager.get("oops_already_have_ap");break;case"marriage_package":a=d?this.__globalStringManager.get("oops_minor_marriage_package"):this.__globalStringManager.get("oops_already_have_this_upgrade");break;case"age_verification":a=d?this.__globalStringManager.get("oops_minor_age_verification"):this.__globalStringManager.get("oops_already_have_this_upgrade");break;case"vip":a=this.__globalStringManager.get("oops_already_have_vip");break;default:this.__window.console.error("MultiCartUpsellDialog::__getErrorString - __upsellProduct not accepted",this.__upsellProduct)}return a},__handleCheckout:function(){this.__isLoggedIn&&"vcoin"===this.__upsellProduct&&this.__showVcoinUnavailableOnCheckout?this.__showVcoinUnavailableDialog():this.__addToCart()},__showVcoinUnavailableDialog:function(){var a=this,d='<a href="'+this.__urlManager.get("unavailable_vcoin")+'" target="_blank">'+this.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_link")+"</a>";d="<p>"+this.__globalStringManager.get("vcoin_unavailable_error_text")+" "+d+"</p>";this.__dialogManager.showDialog(k.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("vcoin_unavailable_error_title"),text:this.__globalStringManager.get("vcoin_unavailable_error_text"),html:d,yes:this.__globalStringManager.get("Continue"),no:this.__globalStringManager.get("CANCEL"),dark_text:!0}).finished.then(function(){a.__addToCart()}).catch(function(e){})},__determineAfterAction:function(){var a=this.__afterAction;if(null===a)switch(this.__upsellProduct){case"ap":case"marriage_package":case"age_verification":case"vip":a=this.__isContextual?this.__vipForWhisper?"close":"closeAll":"reload";break;default:a="closeAll"}return a},__addToCart:function(a){var d=this;if(this.__isLoggedIn)if(!this.__simulated||"ap"!==this.__upsellProduct&&"marriage_package"!==this.__upsellProduct&&"age_verification"!==this.__upsellProduct&&"vip"!==this.__upsellProduct)if(this.__upsellProduct){this.$(".checkout-cta").addClass("disabled");var e=new IMVU.NamedModel({node:this.__model.node.attributes,edge:this.__model.edge.attributes,productModel:this.__model});this.__singleItemCart.add(e);if(this.__isCreatorLanding){e=[];e.push({product_name:this.__model.node.attributes.code_name,product_id:this.__model.node.attributes.product_packages_id.toString(),product_category:this.__model.node.attributes.category,product_price:this.__model.edge.attributes.sale_price,product_quantity:1});try{this.__window.pintrk("track","AddToCart",{value:this.__model.edge.attributes.sale_price,order_quantity:1,currency:"USD",line_items:e},function(c,g){c||this.__appMonitor.reportCustomError("MultiCartUpsellDialog","__addToCart","web_perm_0005k","Error returned from pintrk callback",["Reported Error: "+g])}.bind(this))}catch(c){this.__appMonitor.reportCustomError("MultiCartUpsellDialog","__addToCart","web_perm_0005d","Error thrown in call to window.pintrk",["Reported Error: "+c.message])}}this.__dollarStoreManager.validateAccountStatus().then(function(){this.__dialogManager.showDialog(k.MultiCartCheckout,{cart:this.__singleItemCart,paymentChannels:this.__paymentChannels,defaultChannel:this.__defaultPaymentChannel,origin:"dollar",which:this.__vipTrigger,afterAction:this.__determineAfterAction()}).finished.then(function(){this.close()}.bind(this)).catch(function(){this.close()}.bind(this))}.bind(this)).then(function(){this.$(".checkout-cta").removeClass("disabled");this.upsellAfterGift&&!a&&this.__dialogManager.closeAll()}.bind(this))}else this.close();else this.__myself.populated().then(function(){var c=d.__getErrorString();d.__dialogManager.showDialog(k.Dialogs.AlloyAlertDialog,{title:d.__globalStringManager.get("oops"),text:c,ok:d.__globalStringManager.get("OKAY")}).finished.then(function(){d.__dialogManager.closeAll()})});else this.__directToLogin()},__enableCheckoutButton:function(){this.$(".checkout-cta").removeClass("disabled");this.upsellAfterGift?this.$(".checkout-cta").html(this.__globalStringManager.get("upsell_after_gift_cta")):this.$(".checkout-cta").html(this.__globalStringManager.get("buy_now_for")+" "+this.__model.edge.attributes.sale_price_formatted)},__enableSimulatedCheckoutButton:function(){this.$(".checkout-cta").removeClass("disabled");this.$(".checkout-cta").html(this.__globalStringManager.get("buy_now"))},__disableCheckoutButton:function(){this.$(".checkout-cta").addClass("disabled");this.$(".checkout-cta").html(this.__globalStringManager.get("buy_now"))},__clearCart:function(){this.__singleItemCart=new k.CartCollection([])},show:function(){this.__clearCart();b.prototype.show.call(this)},hide:function(){if(this.__isLoggedIn){b.prototype.hide.call(this);var a=new CustomEvent("multiCartUpsellDialog:closed");this.__window.dispatchEvent(a)}else this.__directToLogin()},close:function(){if(this.__isLoggedIn){var a=new CustomEvent("multiCartUpsellDialog:clickedCancel");this.__window.dispatchEvent(a);b.prototype.close.call(this)}else this.__directToLogin()},__handleLearnMore:function(){this.$(".description-short").addClass("hidden");this.$(".learn").addClass("hidden");this.$(".description-long").removeClass("hidden");this.$(".lines").removeClass("hidden")},__handleGreeterCTA:function(){this.__featureAccessManager.isElectronClient()?this.__serviceProvider.get("externalWindow").open(this.__urlManager.get("greeter_program_info")):this.__window.location=this.__urlManager.get("greeter_program_info")},__renderTitle:function(){this.$(".dialog-header .dialog-title").text(this.title)},__adjustDialogSize:function(){this.$(".dialog-container").removeClass(this.title);this.$(".dialog-container").addClass("upsell_after_gift_"+this.__upsellProduct)},__getSimulatedModel:function(){this.__simulated=!0;var a={node:{}};a.node.attributes={dlg_name:"",name:"",dlg_background_url:"",sale_price_formatted:""};a.edge={};a.edge.attributes={sale_price_formatted:null};switch(this.__upsellProduct){case"ap":a.node.attributes.dlg_name="dlg_accesspass";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_ap");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-access-pass-2021-01-15.jpg";break;case"marriage_package":a.node.attributes.dlg_name="dlg_marriagepackage";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_marriage_package");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-marriage-package-2021-01-15.jpg";break;case"age_verification":a.node.attributes.dlg_name="dlg_ageverify";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_age_verification");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-age-verification-2021-01-15.jpg";break;case"shared_room":a.node.attributes.dlg_name="dlg_sharedroom";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_shared_room");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-shared-room-2021-01-15.jpg";break;case"name_change":a.node.attributes.dlg_name="dlg_namechange";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_name_change");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-name-change-token-2021-01-15.jpg";break;case"room_slot":a.node.attributes.dlg_name="dlg_chatroomslot";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_room_slot");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-chat-room-slot-2021-01-15.jpg";break;case"credits":a.node.attributes.dlg_name="dlg_credits";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_credits");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-buy-credits-2021-01-15.jpg";break;case"vip":a.node.attributes.dlg_name="dlg_vip";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_vip");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/vip/products/upsell_large_art.png";break;case"host_subscription":a.node.attributes.dlg_name="dlg_host_subscription";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_host_subscription");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-become-a-host-2021-01-15.jpg";break;case"greeter":a.node.attributes.dlg_name="dlg_greeter";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_greeter");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-greeter-program-2021-01-15.jpg";break;case"vcoin":a.node.attributes.dlg_name="vcoin";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_vcoin");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-buy-vcoin-2021-01-15.jpg";break;default:a=null,this.__window.console.error("MultiCartSubmode::__getSimulatedModel - Unknown product",this.__upsellProduct)}a.on=function(){};this.__model=a;this.title=this.__model.node.attributes.name;this.__getPackageMapOverrides();this.__renderTitle();this.upsellAfterGift&&this.__adjustDialogSize()},__getPackageMap:function(){return{dlg_namechange:{subtitle_key:"UPGRADE_NAME_CHANGE_TOKEN_TITLE",desc_key:"UPGRADE_NAME_CHANGE_TOKEN_DESC",dlg_title:"MCS_Simulated_Model_Name_name_change"},dlg_accesspass:{subtitle_key:"UPGRADE_ACCESS_PASS_TITLE",desc_key:"UPGRADE_ACCESS_PASS_DESC"},dlg_namereg:{subtitle_key:"UPGRADE_NAME_REGISTRATION_TITLE",desc_key:"UPGRADE_NAME_REGISTRATION_DESC"},dlg_ageverify:{subtitle_key:"UPGRADE_AGE_VERIFICATION_TITLE",desc_key:"UPGRADE_AGE_VERIFICATION_DESC"},dlg_sharedroom:{subtitle_key:"UPGRADE_SHARED_ROOM_TITLE",desc_key:"UPGRADE_SHARED_ROOM_DESC"},dlg_chatroomslot:{subtitle_key:"UPGRADE_CHATROOM_SLOT_TITLE",desc_key:"UPGRADE_CHATROOM_SLOT_DESC"},dlg_marriagepackage:{subtitle_key:"UPGRADE_MARRIAGE_LICENSE_TITLE",desc_key:"UPGRADE_MARRIAGE_LICENSE_DESC"},dlg_vip:{subtitle_key:"UPGRADE_VIP_TITLE",desc_key:"UPGRADE_VIP_DESC",dlg_title:"MCS_Simulated_Model_Name_vip"},dlg_host_subscription:{subtitle_key:"UPGRADE_HOST_SUB_TITLE",desc_key:"UPGRADE_HOST_SUB_DESC",dlg_title:"UPGRADE_HOST_SUB_DLG_TITLE"},dlg_credits:{subtitle_key:"UPGRADE_CREDITS_TITLE",desc_key:"UPGRADE_CREDITS_DESC",dlg_title:"MCS_Simulated_Model_Name_credits"},dlg_greeter:{subtitle_key:"UPGRADE_GREETER_TITLE",desc_key:"UPGRADE_GREETER_DESC",dlg_title:"MCS_Simulated_Model_Name_greeter"},vcoin:{subtitle_key:"UPGRADE_VCOIN_TITLE",desc_key:"UPGRADE_VCOIN_DESC",dlg_title:"MCS_Simulated_Model_Name_vcoin"},upsell_after_gift_subtitle_credits:{subtitle_key:"upsell_after_gift_subtitle_credits",desc_key:"UPGRADE_CREDITS_DESC",dlg_title:"upsell_after_gift_title"},upsell_after_gift_subtitle_vcoin:{subtitle_key:"upsell_after_gift_subtitle_vcoin",desc_key:"UPGRADE_VCOIN_DESC",dlg_title:"upsell_after_gift_title"},upsell_after_gift_subtitle_product:{subtitle_key:"upsell_after_gift_subtitle_product",desc_key:"UPGRADE_CREDITS_DESC",dlg_title:"upsell_after_gift_title"}}},__getCategories:function(){switch(this.__upsellProduct){case"ap":case"marriage_package":case"age_verification":case"shared_room":case"name_change":case"room_slot":var a=["upgrade"],d="next";break;case"credits":a=["credits"];d="next";break;case"vip":a=["vip"];d="next";break;case"host_subscription":a=["hosting"];d="next";break;case"greeter":break;case"vcoin":a=["vcoin"];d="vcoin";break;case"product":this.__upsellProduct="credits";a=["credits"];d="next";break;default:this.__window.console.error("MultiCartUpsellDialog::getCategories - Unknown product",this.__upsellProduct,". Setting default to credits."),this.__upsellProduct="credits",a=["credits"],d="next"}return{categories:a,storeType:d}},__setDialogText:function(a){this.__subtitle=this.__isCreatorLanding||this.__customDlg_name?this.__customSubtitle:this.__globalStringManager.get(a.subtitle_key);this.__description=this.__isCreatorLanding?this.__customDescription:this.__globalStringManager.get(a.desc_key)},__getPackageMapOverrides:function(){this.__dlgName=this.__model.node.attributes.dlg_name;this.$(".dialog-container").addClass(this.__dlgName);this.__customDlg_name&&(this.__dlgName=this.__customDlg_name);var a=this.__packageMap[this.__dlgName];a?(this.__setDialogText(a),this.__isLoggedIn?"host_subscription"===this.__upsellProduct&&(this.__description='<p class="description">'+this.__globalStringManager.get("host_subscription_upsell_dialog_description")+'</p><ul class="lines"><li class="line1 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line1")+'</li><li class="line2 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line2")+'</li><li class="line3 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line3")+'</li><li class="line4 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line4")+"</li></ul>"):"host_subscription"===this.__upsellProduct?this.__description+='<div class="spacer"></div><div class="spacer"></div>'+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_prompt")+'<br><div class="spacer"></div><ul><li>'+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_line1")+"</li><li>"+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_line2")+"</li><li>"+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_line3")+"</li></ul>":"vip"===this.__upsellProduct&&(this.__description+='<div class="spacer"></div><div class="spacer"></div>'+this.__globalStringManager.get("vip_upsell_dialog_extension_prompt")+'<br><div class="spacer"></div><ul><li>'+this.__globalStringManager.get("vip_upsell_dialog_extension_line1")+"</li><li>"+this.__globalStringManager.get("vip_upsell_dialog_extension_line2")+"</li><li>"+this.__globalStringManager.get("vip_upsell_dialog_extension_line3")+"</li></ul>"),a.dlg_title&&(this.title=this.__isCreatorLanding?this.__globalStringManager.get("buyupgrade_creator_title"):this.__globalStringManager.get(a.dlg_title))):(this.__subtitle=this.__globalStringManager.get("UPGRADE_CREDITS_TITLE"),this.__description=this.__globalStringManager.get("UPGRADE_CREDITS_DESC"))},_testGetCart:function(){return this.__singleItemCart},_testGetErrorString:function(){return this.__getErrorString()},_testGetDeterminedAfterAction:function(){return this.__determineAfterAction()}})}({Dialogs:l["@Dialogs"],Model:l["@Model"],UiCore:l["@UiCore"],CartCollection:Za,MultiCartCheckout:vb,MultiCartList:J,MultiProductList:Ya,multiProductUpsellVipTiers:B,template:La}),xb=function(k){var b=function(f){var h=Math.round(f/1e6*10)/10;if(1<=h)return h+"M views";h=Math.round(f/1e3);return 1<=h?h+"K views":f+" views"},a=function(f){var h=$jscomp.makeIterator(f.match(/((\d+)H)?((\d+)M)?((\d+)S)?$/));h.next();h.next();f=h.next().value;h.next();var m=h.next().value;h.next();h=h.next().value;var n="";f&&(n=""+f);n=m?(n?n+":":"")+m.padStart(2,"0"):n?n+":00":"00";return n=h?n+":"+h.padStart(2,"0"):n+":00"},d=function(f){return function(h){return f.reduce(function(m,n){return n(m)},h)}},e=function(f){f=f.toString().split(".");f[0]=f[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");return f.join(".")},c=function(f){return isNaN(f)||Math.floor(f)===f?0:f.toString().split(".")[1].length||0},g=function(f,h){if(c(f)<=h)return parseFloat(f).toFixed(h);var m=Math.pow(10,h);return(Math.trunc(f*m)/m).toFixed(h)};return{getTimeFormat:function(f,h){var m=Math.floor(f/3600),n=Math.floor(f/60)-60*m;f%=60;h&&(f=f.toFixed(h));h=10>f?"0":"";return m?m+":"+(10>n?"0":"")+n+":"+h+f:n+":"+h+f},formatCredits:function(f){return f.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},zeroPad:function(f,h){return(Array(h).join("0")+f).substr(-h,h)},formatMini:function(f,h){var m=[{base:1e3,letter:"K"},{base:1e6,letter:"M"},{base:1e9,letter:"B"}];if(f<(h?h:1e3))return e(f);for(var n=m.length-1;0<=n;n--){h=m[n];var p=h.base;if(f>=p)return m=Math.floor(f/p),f=Math.floor((f-p*m)/(p/10)),m+(f?"."+f:"")+h.letter}return""+f},addComma:e,formatDecimal:g,formatVCOIN:function(f){return e(g(f,2))},countDecimals:c,durationParser:a,viewFormatter:b,formatYouTubeVideoMetaData:function(f){return f.items.map(function(h){var m=h.snippet,n=h.contentDetails,p=h.id,q=h.status;return{imageUrl:m.thumbnails.medium.url,videoTitle:m.title,videoAuthor:m.channelTitle,videoDescription:m.description,totalViews:b(h.statistics.viewCount),duration:a(n.duration),isoDuration:n.duration,published:k.moment(m.publishedAt).fromNow(),videoId:p,embeddable:q.embeddable}})},getSuggestionsFromResponse:function(f){return d([function(h){return JSON.parse(h.match(/\((.*)\)/)[1])},function(h){return h[1]},function(h){return h.map(function(m){return m[0]})}])(f)},getTokenFromResponse:function(f){return d([function(h){return JSON.parse(h.match(/\((.*)\)/)[1])},function(h){return h[2]},function(h){return h.q}])(f)}}}({moment:l["@moment"]}),yb=function(k){var b=k.UiCore.UiContext;return b.extend("AvailableBalance",{className:"available-balance",uiContextName:"available_balance",dependencies:["dialogManager","featureAccessManager","iconManager","securitySettingsManager","window"],trackedEvents:function(){return[{type:"click",selector:".btn-open-upsell-dialog",name:"open_upsell_dialog",handler:this.__handleClick.bind(this)}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__formatNumber=k.FormatNumber;this.__type=IMVU.requireProperty(a,"type");this.__wallet=IMVU.requireProperty(a,"wallet");this.addToDOM()},delete:function(){b.prototype.delete.call(this)},render:function(){this.$el.html(k.template({isVcoin:"vcoin"===this.__type,isCredits:"credits"===this.__type||"product"===this.__type}));this.$el.addClass("vcoin"===this.__type?"vcoin":"credits");this.__wallet.populated().then(function(){this.__updateBalance();this.listenTo(this.__wallet,"change",this.__updateBalance)}.bind(this)).catch(function(a){this.__window.console.log("something went wrong:",a)}.bind(this))},__updateBalance:function(){var a="vcoin"===this.__type?this.__wallet.get("vcoin_total"):this.__wallet.get("credits");this.$(".balance-wrapper .balance").text(this.__numberAbbreviator(a,1))},__numberAbbreviator:function(a){return 1e5<=a?Math.floor(a/1e3).toFixed(0)+"k":this.__formatNumber.addComma(Math.floor(a))},__handleClick:function(){this.__securitySettingsManager.requireVcoin2FACheck(this.__wallet).then(function(){return this.__upsellDialog=this.__dialogManager.showDialog(k.MultiCartUpsellDialog,{upsellProduct:this.__type,contextual:!0})}.bind(this))}})}({UiCore:l["@UiCore"],FormatNumber:xb,MultiCartUpsellDialog:wb,template:Ka}),zb=function(k){$.event.special.destroyed={remove:function(b){b.handler&&b.handler.apply(this,arguments)}}}({}),Ab=function(k){return k.Timestamp.extend("MessageDrawerTimestamp",{className:"timestamp-widget message-drawer-timestamp system-info-drawer",uiContextName:"message_drawer_timestamp",render:function(){this.$el.text(this.__timestampHelper.messageDrawerDateTime())}})}({UiCore:l["@UiCore"],Timestamp:t}),Bb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c,g=a.helperMissing;d='\n    <fieldset>\n        <legend class="system-info-header-no-divider">';if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"LANGUAGE",{name:"i18n-g",hash:{},data:e})))||0===g)d+=g;d+='</legend>\n        <div class="filter-options">\n            <select class="id-language">\n                ';if((g=a.each.call(b,b&&b.languageMap,{name:"each",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===g)d+=g;return d+"\n            </select>\n        </div>\n    </fieldset>\n    "},2:function(b,a,d,e){var c,g;d=this.escapeExpression;var f=a.helperMissing;return'\n                <option value="'+d((c=null==e||!1===e?e:e.key,"function"===typeof c?c.apply(b):c))+'">'+d((g=a["i18n-gwd"]||b&&b["i18n-gwd"]||f,g.call(b,b,b,{name:"i18n-gwd",hash:{},data:e})))+"</option>\n                "},4:function(b,a,d,e){var c,g=a.helperMissing;d='\n    <fieldset>\n        <legend class="system-info-header-no-divider">';if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"OCCUPANCY",{name:"i18n-g",hash:{},data:e})))||0===g)d+=g;d+='</legend>\n        <div class="filter-options">\n            <select class="id-occupancy">\n                ';if((g=a.each.call(b,b&&b.occupancyMap,{name:"each",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===g)d+=g;return d+"\n            </select>\n        </div>\n    </fieldset>\n    "},6:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='\n    <fieldset class="gender-filter">\n        <legend class="system-info-header">',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"GENDER",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+='</legend>\n        <div class="filter-options">\n            <input id=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-female\' class="checkbox id-female id-gender" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-female'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Female",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</label>\n            <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-male\' class="checkbox id-male id-gender" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-male'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Male",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"</label>\n        </div>\n    </fieldset>\n    "},8:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='\n    <fieldset>\n        <legend class="system-info-header">',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"RATING",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+='\n            <a class="rating-icon">';if((h=(c=a.icon||b&&b.icon||d,c.call(b,"icon-tooltip-icon",{name:"icon",hash:{},data:e})))||0===h)f+=h;f+='</a>\n        </legend>\n        <div class="filter-options">\n            <input id=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-ap\' class="checkbox id-ap" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-ap'>Access Pass</label>\n            <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-ga\' class="checkbox id-ga" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-ga'>"+g((c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"General Access",{name:"i18n-g",hash:{},data:e})))+'</label>\n        </div>\n\n        <div class="rating-tooltip">\n            <div class="tooltip-body">\n                <p>';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Rating_Tooltip_1",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</p>\n                <p class="tooltip-last-paragraph">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Rating_Tooltip_2",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='\n                    <a data-external class="p-tooltip-cta cta">\n                        ';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Rating_Tooltip_Link",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"\n                    </a>\n                </p>\n            </div>\n        </div>\n\n    </fieldset>\n    "},10:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='\n        <fieldset class="filter-distinguish">\n            <legend class="system-info-header">',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Distinguish_Filter_Title",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+='</legend>\n            <div class="filter-options">\n                <input id=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-distinguish\' class="checkbox id-distinguish" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-distinguish'><strong>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Distinguish_Filter_Label_Name",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</strong> ";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Distinguish_Filter_Label_Products",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</label>\n            </div>\n            ";if((h=a["if"].call(b,b&&b.canSeeNFT,{name:"if",hash:{},fn:this.program(11,e),inverse:this.noop,data:e}))||0===h)f+=h;return f+"\n        </fieldset>\n    "},11:function(b,a,d,e){var c,g=this.escapeExpression;d=a.helperMissing;var f='\n            <div class="filter-options">\n                <input id=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-nft\' class="checkbox id-nft" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-nft'><strong>";if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"NFT_Filter_Label_Name",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;f+="</strong> ";if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"NFT_Filter_Label_Products",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+"</label>\n            </div>\n            "},13:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='\n    <fieldset>\n        <legend class="system-info-header">',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"STATUS",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+='</legend>\n        <div class="filter-options">\n            <input id=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-vip\' class="checkbox id-vip" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-vip'>"+g((c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"VIP",{name:"i18n-g",hash:{},data:e})))+"</label>\n            ";if((h=a["if"].call(b,b&&b.isAdult,{name:"if",hash:{},fn:this.program(14,e),inverse:this.noop,data:e}))||0===h)f+=h;return f+"\n        </div>\n    </fieldset>\n    "},14:function(b,a,d,e){var c;d=this.escapeExpression;var g=a.helperMissing;return"\n            <input id='"+d((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-age_verified\' class="checkbox id-age_verified" type="checkbox"><label for=\''+d((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-age_verified'>"+d((c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"Age Verified",{name:"i18n-g",hash:{},data:e})))+"</label>\n            "},16:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='\n    <fieldset>\n        <legend class="system-info-header">',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"ONLINE",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;return f+'</legend>\n        <div class="filter-options">\n            <input id=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-online\' class="checkbox id-online" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-online'>"+g((c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Online",{name:"i18n-g",hash:{},data:e})))+"</label>\n        </div>\n    </fieldset>\n    "},18:function(b,a,d,e){var c,g=a.helperMissing;d="\n    <fieldset class='filter-sort'>\n        <legend class=\"system-info-header-no-divider\">";if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"SORT BY",{name:"i18n-g",hash:{},data:e})))||0===g)d+=g;d+='</legend>\n        <div class="filter-options">\n            <select class="id-sort">\n                ';if((g=a.each.call(b,b&&b.sortMap,{name:"each",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===g)d+=g;return d+"\n            </select>\n        </div>\n    </fieldset>\n    "},20:function(b,a,d,e){var c,g=a.helperMissing;d="\n    <fieldset class='filter-pricing'>\n        <legend class=\"system-info-header-no-divider\">";if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"PRICING",{name:"i18n-g",hash:{},data:e})))||0===g)d+=g;d+='</legend>\n        <div class="filter-options">\n            <select class="id-pricing">\n                ';if((g=a.each.call(b,b&&b.pricingMap,{name:"each",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===g)d+=g;return d+"\n            </select>\n        </div>\n    </fieldset>\n    "},22:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='\n    <fieldset>\n        <legend class="system-info-header">',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"PLATFORM",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+='</legend>\n        <div class="filter-options">\n            <input id=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-web\' class="checkbox id-web" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-web'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Web",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</label>\n            <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-ios\' class="checkbox id-ios" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-ios'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"iOS",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</label>\n            <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-android\' class="checkbox id-android" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-android'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Android",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"</label>\n        </div>\n    </fieldset>\n    "},24:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='\n    <fieldset>\n        <legend class="system-info-header">',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Filters",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+='</legend>\n        <div class="filter-options">\n            <input id=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-likes\' class="checkbox id-likes" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-likes'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Likes",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</label>\n            <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-comments\' class="checkbox id-comments" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-comments'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Comments",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</label>\n            <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-eci\' class="checkbox id-eci" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-eci'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Chat Invites",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</label>\n        ";if((h=a["if"].call(b,b&&b.canSeeShopTogether,{name:"if",hash:{},fn:this.program(25,e),inverse:this.noop,data:e}))||0===h)f+=h;f+="\n            <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-follows\' class="checkbox id-follows" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-follows'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Follows",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</label>\n            <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-friend_activity\' class="checkbox id-friend_activity" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-friend_activity'>"+g((c=a.friendActivity||b&&b.friendActivity,"function"===typeof c?c.call(b,{name:"friendActivity",hash:{},data:e}):c))+"</label>\n            <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-room_moderation\' class="checkbox id-room_moderation" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-room_moderation'>"+g((c=a.roomModeration||b&&b.roomModeration,"function"===typeof c?c.call(b,{name:"roomModeration",hash:{},data:e}):c))+"</label>\n            <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-vcoin_gifting\' class="checkbox id-vcoin_gifting" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-vcoin_gifting'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin-gifting",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</label>\n            <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-credit_gifting\' class="checkbox id-credit_gifting" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-credit_gifting'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"credit-gifting",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</label>\n            <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-product_gifting\' class="checkbox id-product_gifting" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-product_gifting'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"product-gifting",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</label>\n        ";if((h=a["if"].call(b,b&&b.canSeeVcoinPay,{name:"if",hash:{},fn:this.program(27,e),inverse:this.noop,data:e}))||0===h)f+=h;return f+"\n        </div>\n    </fieldset>\n    "},25:function(b,a,d,e){var c,g=this.escapeExpression,f=a.helperMissing;d="\n            <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-shop_together_invite\' class="checkbox id-shop_together_invite" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-shop_together_invite'>";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||f,c.call(b,"shop_together_invite",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</label>\n        "},27:function(b,a,d,e){var c;d=this.escapeExpression;var g=a.helperMissing,f="\n            <input id='"+d((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-payme_received\' class="checkbox id-payme_received" type="checkbox"><label for=\''+d((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-payme_received'>",h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"payme-received",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+="</label>\n            <input id='"+d((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-payme_requested\' class="checkbox id-payme_requested" type="checkbox"><label for=\''+d((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-payme_requested'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"payme-requested",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"</label>\n        "},29:function(b,a,d,e){var c,g=a.helperMissing;d='\n    <fieldset>\n        <legend class="system-info-header-no-divider">';if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"Prepaid Card Value",{name:"i18n-g",hash:{},data:e})))||0===g)d+=g;d+='</legend>\n         <div class="filter-options">\n            <select class="id-prepaid_card_value">\n                ';if((g=a.each.call(b,b&&b.ppcValueMap,{name:"each",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===g)d+=g;return d+"\n            </select>\n        </div>\n    </fieldset>\n    "},31:function(b,a,d,e){var c,g=a.helperMissing;d='\n    <fieldset>\n        <legend class="system-info-header-no-divider">';if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"Country",{name:"i18n-g",hash:{},data:e})))||0===g)d+=g;d+='</legend>\n        <div class="filter-options">\n            <select class="id-prepaid_card_country">\n                ';if((g=a.each.call(b,b&&b.ppcCountryMap,{name:"each",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===g)d+=g;return d+"\n            </select>\n        </div>\n    </fieldset>\n    "},33:function(b,a,d,e){d="\n        ";if((b=a["if"].call(b,b&&b.isAdult,{name:"if",hash:{},fn:this.program(34,e),inverse:this.noop,data:e}))||0===b)d+=b;return d+"\n    "},34:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='\n            <fieldset>\n                <legend class="system-info-header">',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"RATING",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+='</legend>\n                <div class="filter-options">\n                    <input id=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-ga\' class="checkbox id-ga" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-ga'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"GA",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</label>\n                    <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-ap\' class="checkbox id-ap" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-ap'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"AP",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"</label>\n                </div>\n            </fieldset>\n        "},36:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='\n        <fieldset>\n            <legend class="system-info-header">',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"ENTRY REQUIREMENT",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+='</legend>\n            <div class="filter-options">\n                <input id=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-vip\' class="checkbox id-vip" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-vip'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"VIP",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</label>\n                <input id='"+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+'-checkbox-friends-only\' class="checkbox id-friends-only" type="checkbox"><label for=\''+g((c=a.uniqueFilterId||b&&b.uniqueFilterId,"function"===typeof c?c.call(b,{name:"uniqueFilterId",hash:{},data:e}):c))+"-checkbox-friends-only'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"friends_only",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"</label>\n            </div>\n        </fieldset>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d='<form class="id-filter">\n    ';var c=a["if"].call(b,b&&b.language,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(c||0===c)d+=c;d+="\n    ";if((c=a["if"].call(b,b&&b.occupancy,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n    ";if((c=a["if"].call(b,b&&b.gender,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n    ";if((c=a["if"].call(b,b&&b.ap_ga,{name:"if",hash:{},fn:this.program(8,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n    ";if((c=a["if"].call(b,b&&b.canDistinguish,{name:"if",hash:{},fn:this.program(10,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n    ";if((c=a["if"].call(b,b&&b.special_user_status,{name:"if",hash:{},fn:this.program(13,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n    ";if((c=a["if"].call(b,b&&b.online_status,{name:"if",hash:{},fn:this.program(16,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n    ";if((c=a["if"].call(b,b&&b.sort,{name:"if",hash:{},fn:this.program(18,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n    ";if((c=a["if"].call(b,b&&b.pricing,{name:"if",hash:{},fn:this.program(20,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n    ";if((c=a["if"].call(b,b&&b.platform,{name:"if",hash:{},fn:this.program(22,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n    ";if((c=a["if"].call(b,b&&b.activities,{name:"if",hash:{},fn:this.program(24,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n    ";if((c=a["if"].call(b,b&&b.prepaid_card_value,{name:"if",hash:{},fn:this.program(29,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n    ";if((c=a["if"].call(b,b&&b.prepaid_card_country,{name:"if",hash:{},fn:this.program(31,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n    ";if((c=a["if"].call(b,b&&b.rating,{name:"if",hash:{},fn:this.program(33,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n    ";if((c=a["if"].call(b,b&&b.entry_requirement,{name:"if",hash:{},fn:this.program(36,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"\n\n</form>\n"},useData:!0})}({}),Cb=function(k){var b=k.UiCore.UiContext,a=0,d=function(g){return-1<_.indexOf(["checkbox","radio"],g.prop("type"))},e=function(g,f){this.model.set(g,d($(f.target))?!!$(f.target).prop("checked"):$(f.target).val())},c=function(g){return{type:"change",handler:$.proxy(e,this,g),selector:".id-"+g,name:this.uiContextName+"_filter_set_"+g,attributes:function(f){var h={};"select"===f[0].tagName.toLowerCase()?h.value=f.val():f.attr("type")&&"checkbox"===f.attr("type").toLowerCase()&&(h.value=!!f.prop("checked"));return h}.bind(this)}};return b.extend("FilterWidget",{uiContextName:"filter_widget",className:"filter-widget filter-widget",dependencies:"featureAccessManager globalStringManager loginManager modeManager nextRoot window".split(" "),initialize:function(g){this.template=g.template||k.template;g.prefix&&(this.uiContextName=g.prefix+"_"+this.uiContextName,this.className=g.prefix+"-"+this.className);this.__window=g.window;this.__modeManager=g.modeManager;this.__filterList=g.filterList;this.__forceApGa=g.forceApGa||!1;this.__uniqueFilterId="filter"+a++;this.__loginManager=g.loginManager;this.__globalStringManager=g.globalStringManager;this.model=g.model||g.serviceProvider.create(k.Model.FilterModel,g.filterList,{});this.submode=g.submode;this.listenTo(this.model.disabledFilters,"change",this.SetInputsToReflectModel.bind(this));b.prototype.initialize.call(this,g);this.__loginManager.isLoggedIn()?(this.__myself=this.__loginManager.getCurrentUser(),this.__myself.populated().then(function(){this.__isAdult=this.__myself.get("is_adult")?1:0;this.__postInit()}.bind(this))):this.__postInit()},__postInit:function(){this.addToDOM();this.SetInputsToReflectModel()},trackedEvents:function(){var g=_.map(_.keys(this.model.attributes),c.bind(this));g.push({type:"change",selector:".id-nft",name:"shop_filter_widget_set_nft",handler:this.__handleNFTFilter});return g},clearInputs:function(){this.$("input").prop("checked",!1)},SetInputsToReflectModel:function(){var g=this.model.toJSON();_.each(g,function(f,h){if(0===h.indexOf("disabled."))return this.$(".id-"+h.replace("disabled.","")).prop("disabled",f);h=this.$(".id-"+h).not("div");d(h)?h.prop("checked",f):h.val(f).trigger("change")}.bind(this))},validFilters:function(){return _.filter(this.__filterList,function(g){return"ap_ga"===g?this.__myself.get("is_adult")?this.__forceApGa||this.__myself.get("is_ap")?!0:!1:!1:!0}.bind(this))},__translateStrings:function(g,f){var h={};_.each(g,function(m,n){if(f)h[n]=this.__globalStringManager.getWithDefault(m,m);else{m=m.split(" ");for(var p=0;p<m.length;p++)m[p]=Number(m[p])?m[p]:this.__globalStringManager.getWithDefault(m[p],m[p]||"");h[n]=m.join(" ")}}.bind(this));return h},render:function(){var g=this.validFilters(),f=this.__translateStrings(k.PricingMap),h=this.__translateStrings(k.SortingMap,!0);this.$el.html(this.template(_.extend({isAdult:this.__isAdult,languageMap:k.LanguageMap,occupancyMap:k.OccupancyMap,sortMap:h,pricingMap:f,uniqueFilterId:this.__uniqueFilterId,ppcValueMap:k.PPCValueMap,ppcCountryMap:k.PPCCountryMap,pricingHeader:"system-info-header-no-divider",friendActivity:this.__globalStringManager.getWithDefault("Friend Activity","Friend Activity"),roomModeration:this.__globalStringManager.getWithDefault("Room Moderation","Room Moderation"),canSeeVcoinPay:this.__featureAccessManager.canSeeVcoinPay(),canDistinguish:g.includes("distinguish"),canSeeNFT:this.__featureAccessManager.canSeeNFT(),canSeeShopTogether:this.__featureAccessManager.canSeeShopTogether()},_.object(g,g))));"nft"===this.model.get("category")&&(this.$(".checkbox.id-nft").prop("checked",!0),this.$(".id-pricing")[0].classList.add("disabled"),this.$(".id-pricing").prop("disabled",!0));this.$("select").each(function(m,n){this.createChildContext(k.Dropdown,{$replaceElement:$(n)})}.bind(this));this.__tooltip=this.createChildContext(k.Tooltip,{$replaceElement:this.$(".rating-tooltip"),$tooltipTarget:this.$(".rating-icon"),trackedEvents:[{type:"click",selector:".cta",name:"rating_tooltip",handler:this.__onTooltipClick.bind(this)}]})},__onTooltipClick:function(){this.__modeManager.openMode({mode:{id:"policyhub"},submode:{id:"virtualgoodspolicy"}})},__handleNFTFilter:function(){this.$(".checkbox.id-nft").prop("checked")?this.submode.displayProducts({filteredOnNFT:!0}):(this.$(".checkbox.id-nft").prop("checked",!1),this.submode.displayProducts())}})}({Model:l["@Model"],UiCore:l["@UiCore"],Dropdown:v,LanguageMap:l["json!/common/js/JSON/LanguageMap.json"],OccupancyMap:l["json!/common/js/JSON/RoomsOccupancy.json"],PPCCountryMap:l["json!/common/js/JSON/PPCCountries.json"],PPCValueMap:l["json!/common/js/JSON/PPCValue.json"],PricingMap:l["json!/common/js/JSON/ProductPricing.json"],SortingMap:l["json!/common/js/JSON/SortOptions.json"],Tooltip:r,template:Bb}),Db=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e,c){var g,f=this.escapeExpression;d="\n    <fieldset>\n        <legend class='system-info-header'>"+f((g=a.title||b&&b.title,"function"===typeof g?g.call(b,{name:"title",hash:{},data:e}):g))+"</legend>\n        <div class='filter-options' data-filter='"+f((g=a.name||b&&b.name,"function"===typeof g?g.call(b,{name:"name",hash:{},data:e}):g))+"' >\n\n        ";if((c=a["if"].call(b,b&&b.checkbox,{name:"if",hash:{},fn:this.programWithDepth(2,e,c),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n        ";if((c=a["if"].call(b,b&&b.toggle,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"\n\n        </div>\n    </fieldset>\n"},2:function(b,a,d,e,c){d="\n            ";if((b=a.each.call(b,b&&b.options,{name:"each",hash:{},fn:this.programWithDepth(3,e,b,c),inverse:this.noop,data:e}))||0===b)d+=b;return d+"\n        "},3:function(b,a,d,e,c,g){var f,h;d=this.escapeExpression;return"\n                <input data-value='"+d((h=a.value||b&&b.value,"function"===typeof h?h.call(b,{name:"value",hash:{},data:e}):h))+"' id='"+d((f=g&&g.cid,"function"===typeof f?f.apply(b):f))+"-filter-"+d((f=c&&c.name,"function"===typeof f?f.apply(b):f))+"-"+d((h=a.value||b&&b.value,"function"===typeof h?h.call(b,{name:"value",hash:{},data:e}):h))+"' type='checkbox' class=\"checkbox\">\n                <label for='"+d((f=g&&g.cid,"function"===typeof f?f.apply(b):f))+"-filter-"+d((f=c&&c.name,"function"===typeof f?f.apply(b):f))+"-"+d((h=a.value||b&&b.value,"function"===typeof h?h.call(b,{name:"value",hash:{},data:e}):h))+"'>"+d((h=a.title||b&&b.title,"function"===typeof h?h.call(b,{name:"title",hash:{},data:e}):h))+"</label>\n            "},5:function(b,a,d,e){var c;d=this.escapeExpression;return'\n            <div class="segmented-control-placeholder-'+d((c=a.name||b&&b.name,"function"===typeof c?c.call(b,{name:"name",hash:{},data:e}):c))+'"></div>\n        '},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d="<form>\n";if((b=a.each.call(b,b&&b.filters,{name:"each",hash:{},fn:this.programWithDepth(1,e,b),inverse:this.noop,data:e}))||0===b)d+=b;return d+"\n\n</form>"},useData:!0})}({}),Eb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;a=this.escapeExpression;return'\n    <li class="segmented-control-item" data-value="'+a((c=null==e||!1===e?e:e.key,"function"===typeof c?c.apply(b):c))+'">\n        '+a("function"===typeof b?b.apply(b):b)+"\n    </li>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d='<ul class="disable-text-selection">\n    ';if((b=a.each.call(b,b&&b.options,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)d+=b;return d+"\n</ul>\n"},useData:!0})}({}),Fb=function(k){var b=k.UiCore.UiContext;return b.extend("SegmentedControl",{className:"segmented-control",uiContextName:"segmented_control",dependencies:["loginManager","name","options","window"],trackedEvents:function(){return[{type:"click",selector:".segmented-control-item",name:"segmented_control_item_click",handler:this.__onClickItem.bind(this),allowBubble:!0}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__name=a.name;this.__options=a.options;this.__loginManager=a.loginManager;this.__isLoggedIn=this.__loginManager.isLoggedIn();this.addToDOM();this.$(".segmented-control-item").first().addClass("is-selected")},render:function(){this.$el.html(k.template({name:this.__name,options:this.__options}))},__select:function(a){if(!this.__isLoggedIn){var d=this.$(".segmented-control-item[data-value=comments] .counter .count");d.removeClass("count");d.addClass("hidden");d=this.$(".segmented-control-item[data-value=likes] .counter .count");d.removeClass("count");d.addClass("hidden");d=this.$(".segmented-control-item[data-value=tags] .counter .count");d.removeClass("count");d.addClass("hidden")}a=$(a);a.hasClass("is-selected")||(k.NextUtil.DomHelper.radioClass(a,"is-selected"),a.trigger("change"))},__onClickItem:function(a){this.__select(a.currentTarget)},toggleOption:function(a,d){this.$(".segmented-control-item[data-value="+a+"]").prop("disabled",!d)},val:function(a){if(!a)return this.$(".segmented-control-item.is-selected").attr("data-value");this.__select(this.$(".segmented-control-item[data-value="+a+"]"))}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:Eb}),Gb=function(k){var b=k.UiCore.UiContext;return b.extend("SimpleFilter",{uiContextName:"simple_filter",className:"simple-filter id-filter",dependencies:["localStorage"],trackedEvents:function(){return[{type:"click",selector:".segmented-control-item",name:"toggle",handler:"__onClickToggle",attributes:function(a){return{value:a.attr("data-value")}}},{type:"change",selector:"input[type=checkbox]",name:"check",handler:"__onChangeCheckbox",attributes:function(a){return{value:a.attr("data-value")}}}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__localStorage=a.localStorage;this.__filters=a.filters;this.__storeAt=a.storeAt;this.__segmentedControls={};this.model=a.serviceProvider.create(IMVU.NamedModel,{});this.__populateModel();this.addToDOM()},__populateModel:function(){_.each(this.__filters,function(a){var d=this.__storeAt?this.__localStorage.getItem(this.__storageName(a.name)):null;a.checkbox&&d&&(d=d.split(","));this.model.set(a.name,d||a.default)}.bind(this))},syncWithStorage:function(){this.__storeAt&&(this.__populateModel(),this.__refreshUI())},__refreshUI:function(){_.each(this.__filters,function(a){var d=this.model.get(a.name),e=this.$("[data-filter="+a.name+"]");_.each(a.options,function(c){var g=e.find("[data-value="+c.value+"]");a.checkbox?g.prop("checked",_.contains(d,c.value)):g.toggleClass("is-selected",d===c.value)}.bind(this))}.bind(this))},render:function(){this.$el.html(k.template({filters:this.__filters,cid:this.model.cid}));_.each(this.__filters,function(a){if(a.toggle){var d=this.$(".segmented-control-placeholder-"+a.name);if(!this.__segmentedControls[a.name]){var e=_.pluck(a.options,"value");this.__segmentedControls[a.name]=this.createChildContext(k.SegmentedControl,{$replaceElement:d,name:"",options:_.object(e,[])})}}}.bind(this));this.__refreshUI()},__onClickToggle:function(a){a=$(a.currentTarget);k.NextUtil.DomHelper.radioClass(a,"is-selected");this.__write(a.closest("[data-filter]").attr("data-filter"),a.data("value"))},__storageName:function(a){return this.__storeAt+"."+a},__write:function(a,d){this.model.set(a,d);this.__storeAt&&this.__localStorage.setItem(this.__storageName(a),_.isArray(d)?d.join(","):d)},__onChangeCheckbox:function(a){a=$(a.currentTarget).closest("[data-filter]");var d=a.find(":checked").map(function(){return $(this).attr("data-value")});this.__write(a.attr("data-filter"),d.get())}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],SegmentedControl:Fb,template:Db}),Hb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression;return g((c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"see_details",{name:"i18n-g",hash:{},data:e})))},useData:!0})}({}),Ib=function(k){var b=k.UiCore.UiContext;return b.extend("SeeDetails",{className:"btn btn-ghost btn-dark see-details-button",uiContextName:"see_details_button",tagName:"button",dependencies:"dialogManager globalStringManager loginManager modeManager Promise window".split(" "),trackedEvents:function(){return[{type:"click",selector:"",name:"see_details_button_click",handler:this.__clickHandler}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__type=a.type;this.__myself=this.__loginManager.getCurrentUser();this.addToDOM()},render:function(){this.$el.html(k.template({}))},__clickHandler:function(){"payme_received"===this.__type||"payme_requested"===this.__type?this.__myself.populated().then(function(){this.__modeManager.openMode({mode:{id:"vcoin"},submode:{id:this.__myself.get("username")}})}.bind(this)):this.__window.location="/home"}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],template:Hb}),Jb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression;return g((c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"say-thanks",{name:"i18n-g",hash:{},data:e})))},useData:!0})}({}),Kb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c,g=this.escapeExpression;d=a.helperMissing;g="<p>"+g((c=a.text||b&&b.text,"function"===typeof c?c.call(b,{name:"text",hash:{},data:e}):c))+'</p>\n<button class="btn btn-primary btn-dark send-gift">';var f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"gift-thanking-dialog-send-gift",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='</button>\n<button class="btn btn-ghost btn-dark send-message">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"gift-thanking-dialog-send-message",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</button>\n<button class="btn btn-ghost btn-dark cancel">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Cancel",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</button>"},useData:!0})}({}),Lb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c,g=a.helperMissing,f=this.escapeExpression;d='<p class="section-title">'+f((c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"gift-thanking-dialog-add-message",{name:"i18n-g",hash:{},data:e})))+'</p>\n<textarea name="message" class="thank-you-message" placeholder="'+f((c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"gift-thanking-dialog-add-message-placeholder",{name:"i18n-g",hash:{},data:e})))+'"></textarea>\n<div class="canned-responses-wrapper"></div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary btn-dark send-message" disabled>';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"say-thanks",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</button>\n<\/script>"},useData:!0})}({}),Mb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){return'<div class="canned-responses-list"></div>'},useData:!0})}({}),Nb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;return d((c=a.text||b&&b.text,"function"===typeof c?c.call(b,{name:"text",hash:{},data:e}):c))},useData:!0})}({}),Ob=function(k){var b=k.UiCore.UiContext;return b.extend("CannedResponsesItem",{className:"canned-responses-item",uiContextName:"canned_responses_item",dependencies:["timer"],trackedEvents:function(){return[{type:"click",selector:"",name:"response_selected",handler:"__handleClick"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__text=IMVU.requireProperty(a,"text");this.addToDOM()},delete:function(){this.__timer.clearTimeout(this.__animationTimeout);b.prototype.delete.call(this)},render:function(){this.$el.html(k.template({text:this.__text}))},__handleClick:function(){this.trigger("response_selected",this.__text);this.__timer.clearTimeout(this.__animationTimeout);this.$el.hasClass("animate")&&this.$el.removeClass("animate");this.$el.addClass("animate");this.__animationTimeout=this.__timer.setTimeout(function(){this.$el.removeClass("animate")}.bind(this),1e3)}})}({UiCore:l["@UiCore"],template:Nb}),Pb=function(k){var b=k.UiCore.UiContext;return b.extend("CannedResponses",{className:"canned-responses",uiContextName:"canned_responses",dependencies:[],initialize:function(a){b.prototype.initialize.call(this,a);this.__responses=IMVU.requireProperty(a,"responses");this.addToDOM()},render:function(){this.$el.html(k.template({}));this.__responses.forEach(function(a){a=this.createChildContext(k.CannedResponsesItem,{$parentElement:this.$(".canned-responses-list"),text:a});this.listenTo(a,"response_selected",this.__responseSelected)}.bind(this))},__responseSelected:function(a){this.trigger("response_selected",a)}})}({UiCore:l["@UiCore"],CannedResponsesItem:Ob,template:Mb}),Qb=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("GiftThankingMessageDialog",{uiContextName:"gift_thanking_message_dialog",className:"gift-thanking-message-dialog dialog-type-B",dependencies:["dialogManager","globalStringManager","loginManager","window"],trackedEvents:function(){return[{type:"click",selector:".send-gift",name:"send_thank_you_gift",handler:"__sendGift"},{type:"input",selector:".thank-you-message",name:"thank_you_message",handler:"__updateSendMessageButton"},{type:"click",selector:".send-message",name:"send_thank_you_message",handler:"__sendMessage"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__myself=this.__loginManager.getCurrentUser();this.__recipient=IMVU.requireProperty(a,"recipient");this.title=this.__globalStringManager.get("say-thanks");this.addToDOM()},postRender:function(){this.setContent("body",k.template,{});k.NextUtil.DomHelper.enhanceTextarea(this.$(".thank-you-message"),500,100);this.__responses=[this.__globalStringManager.get("gift-thanking-dialog-canned-text-response1"),this.__globalStringManager.get("gift-thanking-dialog-canned-text-response2"),"🙏🙏🙏",this.__globalStringManager.get("gift-thanking-dialog-canned-text-response2"),"❤️❤️❤️","😘","😻","😊"];this.__cannedResponses=this.createChildContext(k.CannedResponses,{$parentElement:this.$(".canned-responses-wrapper"),responses:this.__responses});this.listenTo(this.__cannedResponses,"response_selected",this.__addResponseToMessage);this.setContent("footer",this.$(".dialog-footer-template").text())},__addResponseToMessage:function(a){var d=this.$(".thank-you-message").val();this.$(".thank-you-message").val(d+" "+a);this.__updateSendMessageButton()},hasInput:function(){return this.$(".thank-you-message").val().trim()},__updateSendMessageButton:function(){this.$("button.send-message").prop("disabled",!this.hasInput())},__sendMessage:function(){var a;return this.__myself.populated().then(function(){a=this.__myself.searchEdgeCollection("conversations",{limit:0},k.Model.ConversationCollection);return a.populated()}.bind(this)).then(function(){var d={participants:[this.__recipient.id],payloads:[{type:"text",content:this.$(".thank-you-message").val()}]};return a.create(d).then(function(){var e=this;this.__myself.getEdgeCollection("conversations",k.Model.ConversationCollection).populated().then(function(c){c=c.find(function(g){return g.node.attributes.participants.find(function(f){return f.user===e.__recipient.id})});c.invalidate();c.populated().then(function(g){if(g.get("last_message.payloads").find(function(f){return"moderation"===f.type}))return e.promiseResolver.resolve(),e.__dialogManager.alert({title:e.__stringManager.getWithDefault("gift-thanking-dialog-message-moderated-title","Message Not Sent"),text:e.__stringManager.getWithDefault("gift-thanking-dialog-message-moderated-text","Your message was not delivered due to a possible Community Guidelines violation."),ok:e.__stringManager.getWithDefault("gift-thanking-dialog-message-moderated-cta","Okay")}).finished;e.promiseResolver.resolve();e.__recipient.populated().then(function(){return this.__dialogManager.alert({title:this.__stringManager.get("gift-thanking-dialog-message-success-title"),text:this.__stringManager.get("gift-thanking-dialog-message-success-text",{name:this.__recipient.get("display_name")}),ok:this.__stringManager.get("gift-thanking-dialog-message-success-ok")}).finished}.bind(e))})})}.bind(this)).catch(function(e){this.__window.console.log("something went wrong",e);return this.__dialogManager.alert({title:this.__stringManager.get("oops"),text:this.__stringManager.get("dialog_generic_chat_error_text"),ok:this.__stringManager.get("OKAY")}).finished}.bind(this))}.bind(this))}})}({Dialogs:l["@Dialogs"],Model:l["@Model"],NextUtil:l["@NextUtil"],CannedResponses:Pb,template:Lb}),Rb=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("GiftThankingDialog",{uiContextName:"gift_thanking_dialog",className:"gift-thanking-dialog",dependencies:["dialogManager","globalStringManager","loginManager","window"],trackedEvents:function(){return[{type:"click",selector:".send-gift",name:"send_thank_you_gift",handler:"__sendGift"},{type:"click",selector:".send-message",name:"send_thank_you_message",handler:"__sendMessage"},{type:"click",selector:".cancel",name:"cancel",handler:"close"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__myself=this.__loginManager.getCurrentUser();this.__recipient=IMVU.requireProperty(a,"recipient");this.title=this.__globalStringManager.get("say-thanks");this.addToDOM()},postRender:function(){this.__recipient.populated().then(function(){var a=this.__globalStringManager.get("gift-thanking-dialog-send-text",{name:this.__recipient.get("display_name")});this.setContent("body",k.template,{text:a})}.bind(this));this.$(".dialog-footer").hide();this.$(".dialog-x").remove()},__sendGift:function(){this.__dialogManager.showGiftingDialog({isThankYou:!0,recipient:this.__recipient,source:this.uiContextName}).finished.then(function(){this.promiseResolver.resolve()}.bind(this))},__sendMessage:function(){this.__dialogManager.showDialog(k.GiftThankingMessageDialog,{recipient:this.__recipient}).finished.then(function(){this.promiseResolver.resolve()}.bind(this))}})}({Dialogs:l["@Dialogs"],Model:l["@Model"],NextUtil:l["@NextUtil"],GiftThankingMessageDialog:Qb,template:Kb}),Sb=function(k){var b=k.UiCore.UiContext;return b.extend("SayThanks",{className:"btn btn-ghost btn-dark say-thanks-button",uiContextName:"say_thanks_button",tagName:"button",dependencies:["dialogManager","globalStringManager","Promise","window"],trackedEvents:function(){var a=this;return[{type:"click",selector:"",name:"say_thanks_button_click",handler:this.__showGiftThankingDialog,attributes:function(){return{which:a.__type}}}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__user=a.user;this.__type=a.type;this.$el.addClass("hidden");this.addToDOM()},render:function(){this.__user.populated().then(function(){this.$el.removeClass("hidden");this.$el.html(k.template({}))}.bind(this))},__showGiftThankingDialog:function(){this.__dialogManager.showDialog(k.GiftThankingDialog,{recipient:this.__user})}})}({NextUtil:l["@NextUtil"],UiCore:l["@UiCore"],GiftThankingDialog:Rb,template:Jb}),Tb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="edge-collection-init-error">\n    ',f=(c=a.icon||b&&b.icon||d,c.call(b,"icon-feed_error",{name:"icon",hash:{},data:e}));if(f||0===f)g+=f;g+="\n    <div class='error-title'>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"feed-error-title",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</div>\n    <div class='error-text'>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"feed-error-text",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</div>\n</div>"},useData:!0})}({}),Ub=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c,g=a.helperMissing;d='<div class="notation page-error">';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"edge_collection_page_error",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</div>"},useData:!0})}({}),Vb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;return'<div class="notation reached-end">'+d((c=a.text||b&&b.text,"function"===typeof c?c.call(b,{name:"text",hash:{},data:e}):c))+"</div>"},useData:!0})}({}),Wb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return'<span class="tool-tip">?</span>'},3:function(b,a,d,e){var c;d=this.escapeExpression;return'<div class="tool-tip-content">'+d((c=a.toolTipContent||b&&b.toolTipContent,"function"===typeof c?c.call(b,{name:"toolTipContent",hash:{},data:e}):c))+"</div>"},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;var g='<div class="no-results notation">\n    <span class="standard-text">'+d((c=a.standard||b&&b.standard,"function"===typeof c?c.call(b,{name:"standard",hash:{},data:e}):c)),f=a["if"].call(b,b&&b.hasToolTip,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)g+=f;g+='</span>\n    <span class="concise-text">'+d((c=a.concise||b&&b.concise,"function"===typeof c?c.call(b,{name:"concise",hash:{},data:e}):c));if((f=a["if"].call(b,b&&b.hasToolTip,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="</span>\n    ";if((f=a["if"].call(b,b&&b.hasToolTip,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)g+=f;return g+"\n</div>"},useData:!0})}({}),Xb=function(k){var b=k.UiCore.EdgeCollectionPresenter;return b.extend("EdgeCollectionPresenter",{dependencies:["appMonitor","multiGetManager","timer","window"],multiGetCollection:function(){this.__multiGetManager.queue(this.collection);this.__multiGetManager.requestReact(this.__multiGetManager.USER_END_POINT);this.__multiGetManager.request()},initialize:function(a){var d=this;this.__manuallyPage=!!a.manuallyPage;b.prototype.initialize.call(this,a);this.__pagingDisabled="undefined"===typeof this.__pagingDisabled?!1:this.__pagingDisabled;this.__isRecommended="undefined"===typeof this.__isRecommended?null:this.__isRecommended;this.__nextPageRequested=!1;this.$el.addClass("is-list");this.__addRenderGatingPromise(this.collection.populated());this.collection.populated().then(function(){for(var e=d.getItems(),c=0;c<e.length;c++)d.__addRenderGatingPromise(e[c].getHasRenderedPromise())});this.__waitOnRenderGatingPromises()},_testDisablePaging:function(){this.__pagingDisabled=!0},renderTemplate:function(){var a=this;this.doWork([function(){a.__updateEmpty();a.__updateReachedEnd();a.collection.on("add remove reset",a.__updateEmpty.bind(a))}])},__updateEmpty:function(){if(0!==this.collection.models.length||this.__$empty)this.collection.models.length&&this.__$empty&&(this.__$empty.remove(),this.__$empty=null);else{var a=this.__emptyText();a&&(this.__$empty=$(k.emptyTemplate({standard:a.standard,concise:a.concise,hasToolTip:"hasToolTip"in a&&void 0!==a.hasToolTip?1:0,toolTipText:"toolTipText"in a&&void 0!==a.toolTipText?a.toolTipText:"",toolTipContent:"toolTipContent"in a&&void 0!==a.toolTipContent?a.toolTipContent:""})),this.$el.append(this.__$empty),this.__tooltip=this.createChildContext(k.Tooltip,{$replaceElement:this.$(".tool-tip-content"),$tooltipTarget:this.$(".tool-tip")}))}},__updateReachedEnd:function(){if(!this.__$reachedEnd&&this.collection.length&&!this.collection.hasNextPage()){var a=this.__reachedEndText();a&&(this.__$reachedEnd=$(k.reachedEndTemplate({text:a})),this.$el.append(this.__$reachedEnd))}},__onPaged:function(){this.__nextPageRequested=!1;this.multiGetCollection();this.__manuallyPage||b.prototype.__onPaged.call(this);this.$el.removeClass("loading");this.__updateReachedEnd()},__onScroll:function(){this.collection.hasNextPage()&&"undefined"!==typeof this.collection.relations.next&&!this.__nextPageRequested&&(this.__nextPageRequested=!0,this.__multiGetManager.getReact(this.collection.relations.next));this.__manuallyPage||b.prototype.__onScroll.call(this)},__ensureContainerFilled:function(){this.__manuallyPage||b.prototype.__ensureContainerFilled.call(this)},viewMore:function(){this.__maybePage()},__shouldPage:function(){return this.__pagingDisabled?!1:this.__manuallyPage?this.__readyToPage():b.prototype.__shouldPage.call(this)},__arrangeAndReattach:function(a){b.prototype.__arrangeAndReattach.call(this,a);this.__$reachedEnd&&this.__$reachedEnd.detach().appendTo(this.$el)},onInitError:function(){this.__appMonitor.waypoint("ProfileList::onInitError");this.__setInitError();this.__loadFailureTimeout=this.__timer.setTimeout(this.__recoverFromLoadFail.bind(this,0),5e3)},onPageError:function(){this.__appMonitor.waypoint("ProfileList::onPageError");this.__setPageError();this.__pageFailureTimeout=this.__timer.setTimeout(this.__recoverFromPageFail.bind(this,0),6e4)},__recoverFromLoadFail:function(a){var d=this;this.doWork([function(){d.__removeInitError();d.collection.invalidate();return d.collection.enumerated()},function(){return d.render()}]).catch(function(){var e=a&&0<a?15===a?45:180<=a?180:2*a:15;window.console.log("Waiting "+e+" seconds to reload");d.__setInitError();d.__loadFailureTimeout=d.__timer.setTimeout(d.__recoverFromLoadFail.bind(d,e),1e3*e)})},__recoverFromPageFail:function(){this.__removePageError();this.__noVisibilityChecks=!1;this.__maybePage()},__setInitError:function(){this.__$initError=$(k.initErrorTemplate({}));this.$el.append(this.__$initError)},__removeInitError:function(){this.__$initError&&(this.__$initError.remove(),this.__$initError=null)},__setPageError:function(){this.__$pageError=$(k.pageErrorTemplate({}));this.$el.append(this.__$pageError)},__removePageError:function(){this.__$pageError&&(this.__$pageError.remove(),this.__$pageError=null)},delete:function(){b.prototype.delete.call(this);this.__timer.clearTimeout(this.__loadFailureTimeout);this.__timer.clearTimeout(this.__pageFailureTimeout)},__emptyText:function(){},__reachedEndText:function(){}})}({Model:l["@Model"],UiCore:l["@UiCore"],Tooltip:r,emptyTemplate:Wb,initErrorTemplate:Tb,pageErrorTemplate:Ub,reachedEndTemplate:Vb}),Yb=function(k){var b=k.UiCore.UiContext;return b.extend("SmartAdSlot",{uiApplication:"SmartAdSlot",uiContextName:"smart_ad_slot",className:"smart-ad-slot",tagName:"div",dependencies:"activityHelper appMonitor featureAccessManager loginManager parentElement platform smartAdHelper timestampHelper uiContext window".split(" "),trackedEvents:function(){return[{type:"click",selector:"",name:"smart_ad",attributes:function(){return{timestamp:this.__timestampHelper.now(),cid:this.__myself.get("legacy_cid"),page:this.__page}}.bind(this)}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__appMonitor.waypoint("SmartAdSlot::initialize");this.$el.addClass(this.__type+" "+this.__uiContextName);this.__parentElement.append(this.$el);this.__myself=this.__loginManager.getCurrentUser();this.__formatId=this.__smartAdHelper.getFormat("native_top").id;this.__tagId=this.__smartAdHelper.getTagId();this.$el.attr("id",this.__tagId);this.__parentElement[0].classList.value.includes("grid")?this.__targetKeywords="layout=grid":this.__targetKeywords="layout=list";"shop-list"===a.parentClassList?(this.__page="native_shop",this.__targetKeywords="layout=grid"):this.__page="native_feed";a=["","gold","platinum","diamond"];this.__targetKeywords=this.__myself.get("is_vip")?this.__targetKeywords+";vip="+(this.__myself.get("has_legacy_vip")?"legacy":a[this.__myself.get("vip_tier")]):this.__targetKeywords;this.trigger("shown");this.__requestAdFromSmart()},__requestAdFromSmart:function(){var a=this;try{this.__window.sas.cmd.push(function(){a.__window.sas.call("std",{siteId:a.__smartAdHelper.getSiteId(a.__platform),pageId:a.__smartAdHelper.getPageId(a.__platform,a.__page),formatId:a.__formatId,target:a.__targetKeywords,tagId:a.__tagId})})}catch(d){this.__appMonitor.reportCustomError("SmartAdSlot","__requestAdFromSmart","web_perm_0012e","Error thrown while std",this.__appMonitor.buildErrorArray(d))}},__destroy:function(){250<this.$el.height()&&this.$el.css("height",this.$el.height());try{this.__window.sas.clean(this.__formatId)}catch(a){this.__appMonitor.reportCustomError("SmartAdSlot","__destroy","web_perm_0012f","Error thrown while clean",this.__appMonitor.buildErrorArray(a))}},__onWindowScroll:function(){try{this.__adRequested||(this.__adRequested=!0,this.__window.requestAnimationFrame(this.__toggleAds.bind(this)))}catch(a){this.__appMonitor.reportCustomError("SmartAdSlot","__onWindowScroll","web_perm_0013","Failed onWindowScroll",this.__appMonitor.buildErrorArray(a))}},__toggleAds:function(){var a=this.$el[0].getBoundingClientRect();0<a.bottom&&a.top<$(this.__window).height()?this.__requestAdFromSmart():this.__destroy();this.__adRequested=!1},__testClick:function(){alert("clicked smart ad");this.__recordEvent("click",{timestamp:this.__timeStampHelper.now()})}})}({UiCore:l["@UiCore"]}),Zb=function(k){var b=k.EdgeCollectionPresenter;return b.extend("AdsListPresenter",{dependencies:["featureAccessManager","globalStartupModel","loginManager","platform","smartAdHelper"],initialize:function(a){var d=this;this.__tagIds=[];this.itemFactory=this.itemFactory||a.itemFactory;this.__showAds=IMVU.optionalProperty(a,"showAds",!0);this._showedUnloadWarning=!1;if("You May Also Like"===a.category||"Complete Your Look"===a.category||"featured"===a.category||"wishlist"===a.category)this.__showAds=!1;this.__adsCategory="NonVIP";b.prototype.initialize.call(this,a);this.doWork([function(){return a.loginManager.getCurrentUser().populated()},function(e){d.__cid=e.get("legacy_cid")}]);if(this.__showAds)switch(this.__isMobile="mobile"===a.platform,this.__firstAdPositionInColumnView=a.firstAdPositionInColumnView||4,this.__showAdEveryNItemsInColumnView=IMVU.optionalProperty(a,"showAdEveryNItemsInColumnView",a.globalStartupModel.get("showAdEveryNColumns")),this.__showAdAfterEveryNRowsInGridView=IMVU.optionalProperty(a,"showAdAfterEveryNRowsInGridView",a.globalStartupModel.get("showAdEveryNRows")),this.__firstAdAfterNRow=IMVU.optionalProperty(a,"firstAdAfterNRow",a.globalStartupModel.get("showAdEveryNRows")),this.__viewType=IMVU.optionalProperty(a,"viewType","grid"),this.__isMobile&&"feed_list"===this.uiContextName&&(this.__viewType="column"),this._isUnitTest=IMVU.optionalProperty(a,"isUnitTest",!1),this._itemCountPerRow=IMVU.optionalProperty(a,"itemCountPerRow",4),this.__lastViewType=this.__viewType,this._isUnitTest&&(this.uiContextName=a.uiContextName),this.uiContextName){case"feed_list":this.__itemSelector="article.feed-item";break;case"shop_list":this.__itemSelector='article.tile:not(".hidden")';break;default:this.__itemSelector=null}if(this.__showAds){if(a.featureAccessManager.canSeePopup())$(this.__window).on("beforeunload",function(e){e.returnValue="leaving IMVU";this._setUnloadWarning();return"leaving IMVU"}.bind(this));$(this.__window).on("resize."+this.className,this.__onResize.bind(this));this.doWork([function(){return d.collection.enumerated()},function(){return d.__insertAds()}])}},__canDecideAdsPosition:function(){return this.$(this.__itemSelector).width()&&this.$el.width()?!0:!1},__decidePositionsByView:function(){"column"===this.__viewType?(this.__firstAdPosition=this.__firstAdPositionInColumnView-1,this.__showAdEveryNItems=this.__showAdEveryNItemsInColumnView-1):(this.__itemCountPerRow=this.__itemCountPerRow||this.__getItemCountPerRow(),this.__firstAdPosition=this.__itemCountPerRow*this.__firstAdAfterNRow,this.__showAdEveryNItems=this.__itemCountPerRow*this.__showAdAfterEveryNRowsInGridView)},__getItemCountPerRow:function(){if(this._isUnitTest)return this._itemCountPerRow;var a=this.$el.width(),d=this.$(this.__itemSelector).width();return Math.floor(a/d)},__createAdSlot:function(a,d){a=_.find(d[0].classList,function(c){return"shop-list"===c});var e=this.__smartAdHelper.getTagId();this.__tagIds.push(e);d.attr("id",e);this.__serviceProvider.create(k.SmartAdSlot,{uiContext:this.uiContextName,parentElement:d,parentClassList:a})},getTagIds:function(){return this.__tagIds},__insertAds:function(){if((this.__itemSelector||0!==this.$(this.__itemSelector).length)&&this.__canDecideAdsPosition()){this.__decidePositionsByView();var a=this.$(this.__itemSelector).parent(),d=this.$("div.smart-ad-slot"),e=d.length;d.toggleClass("hidden",!0);for(var c=this.$(this.__itemSelector).detach(),g=c.length,f=0,h=this.__firstAdPosition;h<g;h+=this.__showAdEveryNItems){var m=c.splice(0,0===f?this.__firstAdPosition:this.__showAdEveryNItems);f<e?(_.each(m,function(n){a[0].insertBefore(n,d[f])}),d[f].classList.remove("hidden")):(_.each(m,function(n){a.append(n)}),this.__createAdSlot(f,a));f++;if(0===this.__showAdEveryNItems)return}0<c.length&&_.each(c,function(n){a.append(n)});this.__lastItemCountPerRow=this.__itemCountPerRow;this.__lastViewType=this.__viewType}},__onResize:function(){"column"!==this.__viewType&&(this.__itemCountPerRow=this.__getItemCountPerRow(),this.__lastItemCountPerRow!==this.__itemCountPerRow&&this.__rearrangeAdSlots(this.__viewType))},__rearrangeAdSlots:function(a){this.__showAds&&(this.__lastViewType=this.__viewType,this.__viewType=a,this.__viewChanged()&&this.$("div.smart-ad-slot").remove(),this.__insertAds())},__viewChanged:function(){return this.__lastViewType!==this.__viewType},delete:function(){this.__showAds&&($(this.__window).off("resize."+this.className),$(this.__window).off("beforeunload"));b.prototype.delete.call(this)},__detach:function(){if(!this.__showAds)return b.prototype.__detach.call(this)},__arrangeAndReattach:function(a){b.prototype.__arrangeAndReattach.call(this,a);this.__showAds&&this.__insertAds()},__onPaged:function(){b.prototype.__onPaged.call(this);this.__showAds&&this.__insertAds()},rearrangeAdSlots:function(){this.__showAds&&this.__insertAds()},removeAds:function(){this.$("div.smart-ad-slot").remove()},_setItemCountPerRow:function(a){this._itemCountPerRow=a},_setIsUnitTest:function(a){this._isUnitTest=a},_setUnloadWarning:function(){this._showedUnloadWarning=!0}})}({EdgeCollectionPresenter:Xb,SmartAdSlot:Yb});return{ActivityDetailTimestamp:Ja,ActivityHeaderTimestamp:Da,AdsListPresenter:Zb,AvailableBalance:yb,ChatDrawerTimestamp:Ea,Filter:Cb,FollowButton:na,GiftingOptionsGrid:Ia,JQSpecialEvents:zb,LoadingPlaceholderList:qa,MessageDrawerTimestamp:Ab,MessageHeaderTimestamp:ua,ProfileIconGrid:sa,SayThanksButton:Sb,SeeDetailsButton:Ib,SimpleFilter:Gb,SocialShare:Ca,Timestamp:t}});