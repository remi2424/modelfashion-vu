module({"@UiCore":"@UiCore","@Model":"@Model","css!/build/withme/model.css":"css!/asset/d41d8cd98f00b204/build/withme/model.css"},function(k){var t=function(e){var d=e.UiCore.NodeModel;return d.extend("ProductNode",{initialize:function(){d.prototype.initialize.apply(this,arguments);this.listenTo(this,"change:relations",this.__triggerChanges.bind(this))},__triggerChanges:function(a,b){a=a||{};b=b||{};a.viewer_inventory!=b.viewer_inventory&&this.trigger("change:is_owned",this,b.viewer_inventory);a.viewer_wishlist!=b.viewer_wishlist&&this.trigger("change:is_wished",this,b.viewer_wishlist)},isAvatar:function(){return _.contains(this.get("categories"),"Avatars")},isCompatibleWithBodyPatterns:function(a){var b=_.contains(this.get("is"),"clothing_product"),f=_.contains(this.get("is"),"avatar_attachment");a=0<_.intersection(a,this.get("compatible_body_patterns")).length;return b&&(f||a)},getPrices:function(){return{full:this.get("product_price"),discounted:this.get("discount_price")?this.get("discount_price"):this.get("product_price")}},get:function(a){switch(a){case"is_owned":return!!this.relations.viewer_inventory;case"is_wished":return!!this.relations.viewer_wishlist;default:return d.prototype.get.apply(this,arguments)}}})}({UiCore:k["@UiCore"]}),C=function(e){return e.UiCore.NodeCollection.extend("ProductCollection",{model:e.ProductNode})}({UiCore:k["@UiCore"],ProductNode:t}),x=k["@UiCore"].NodeModel.extend("NotificationNode",{}),u=function(e){var d=IMVU.NamedModel,a={};return d.extend("LookModelManager",_.extend({dependencies:"featureAccessManager fetchResponseHandler lookModelId modelCache Promise rest window".split(" "),initialize:function(b){this.__serviceProvider=b.serviceProvider;_.each(this.dependencies,function(f){this["__"+f]=b[f]}.bind(this));a[this.__lookModelId]=this;d.prototype.initialize.call(this,{pending_adds:[],pending_removes:[]});this.__changeNum=0;this.__changeToPendingSet={};this.__changeToPendingSet[this.__changeNum]={pending_adds:[],pending_removes:[]};this.__lastShownRequest=this.__requestCount=0;this.__initialRequestSent=this.__populated=!1;this.__outstandingRequests=0},resetLookModelId:function(b){a[b]=this;delete a[this.__lookModelId];this.__lookModelId=b},isSyncing:function(){return 0<this.__outstandingRequests},fetch:function(b){b=b||{};var f=b.add||[],h=b.remove||[];b=b.baseProductList||[];f=_(this.get("pending_adds")).concat(f);var l=_(this.get("pending_removes")).concat(h);_.each([f,l,b],function(g){_.each(g,function(m,p){_.isString(g[p])&&(g[p]=parseInt(g[p].replace(/^(.*\/product[\-\/])*(\d+)$/,"$2"),10))}.bind(this))}.bind(this));f=_.uniq(f);l=_.uniq(l);var c=_.intersection(f,l);h=_(f).difference(c);f=_(l).difference(c);b=this.__buildLookModelUrl(this.__lookModelId,h,f,b);l=++this.__changeNum;this.__changeToPendingSet[l]={pending_adds:h,pending_removes:f,url:b};this.set({pending_adds:h,pending_removes:f});return this.__fetch(b)},__buildLookModelUrl:function(b,f,h,l){var c={};0<f.length&&(c.add=f.join(","));0<h.length&&(c.remove=h.join(","));0<l.length&&(c.base_product_list=l.join(","));return IMVU.URI.build(b,c,{prune:!0})},__fetch:function(b){this.__modelCache.invalidate(b);var f=++this.__requestCount;this.__outstandingRequests++;this.trigger("syncing",this.isSyncing());return this.__rest.get(b).then(function(h){this.__outstandingRequests--;this.trigger("syncing",this.isSyncing());h=h.response.data;f>this.__lastShownRequest&&(this.__lastShownRequest=f,this.__fetchResponseHandler(h),this.__modelCache.invalidate(b),f===this.__requestCount&&this.set({pending_adds:[],pending_removes:[]}));return this.__Promise.resolve()}.bind(this)).catch(function(h){this.__window.console.log(h);this.__outstandingRequests--;this.trigger("syncing",this.isSyncing());return this.__Promise.reject(h)}.bind(this))},post:function(b){this.set({pending_adds:[],pending_removes:[]});var f=++this.__requestCount;this.__outstandingRequests++;this.trigger("syncing",this.isSyncing());this.__featureAccessManager.failLookModelPost()&&(b={look_url:"justfail"});return this.__rest.post(this.__lookModelId,b).then(function(h){this.__outstandingRequests--;this.trigger("syncing",this.isSyncing());h=h.response.data;f>this.__lastShownRequest&&(this.__lastShownRequest=f,this.__fetchResponseHandler(h))}.bind(this)).catch(function(h){this.__window.console.log(h);this.__outstandingRequests--;this.trigger("syncing",this.isSyncing());return this.__Promise.reject(h)}.bind(this))}},Backbone.events),{getManager:function(b){return a[b]}})}({Model:k["@Model"],UiCore:k["@UiCore"]});u=function(e){var d=IMVU.NamedModel;return d.extend("LookModel",{dependencies:["globalStartupModel","Promise","typeId"],initialize:function(a){this.__serviceProvider=a.serviceProvider;_.each(this.dependencies,function(b){this["__"+b]=a[b]}.bind(this));this.__Promise=a.Promise;this.__globalStartupModel=a.globalStartupModel;this.__typeId=this.parseTypeId(a.typeId);this.__populatedResolver=null;this.__populatedPromise=new this.__Promise(function(b){this.__populatedResolver=b}.bind(this));this.__lookModelBase=this.__globalStartupModel.get("lookModelUrl");this.id=this.__globalStartupModel.get("starterAvatars."+this.__typeId);if(_.isNull(this.id)||_.isUndefined(this.id))this.id=this.__lookModelBase+"/look_model-"+this.__typeId;d.prototype.initialize.call(this,{url:this.id});this.__managerClass=IMVU.optionalProperty(a,"managerClass",e.LookModelManager);this.__manager=this.__serviceProvider.create(this.__managerClass,{lookModelId:this.id,fetchResponseHandler:this.__fetchResponseHandler.bind(this)});this.fetch()},parseTypeId:function(a){return a.split(/\//).pop()},setLookModelId:function(a){this.__typeId=this.parseTypeId(a);this.id=this.__globalStartupModel.get("starterAvatars."+this.__typeId);if(_.isNull(this.id)||_.isUndefined(this.id))this.id=this.__lookModelBase+"/look_model-"+this.__typeId;this.set({url:this.id});this.__manager.resetLookModelId(this.id)},setChatTypeId:function(a,b){a=a.id.split("/").pop();b=b.id.split("/").pop();this.setLookModelId(a+":participants:"+b)},setShopTogetherTypeId:function(a,b){a=a.id.split("/").pop();b=b.id.split("/").pop();a="shop_together-"+a.replace("chat-","");this.setLookModelId(a+":participants:"+b)},populated:function(){return this.__populatedPromise},isSyncing:function(){return this.__manager.isSyncing()},getProducts:function(){return this.get("products")},getGender:function(){var a=this.get("body_pattern_ids");return null===a||void 0===a?null:_.contains(a,80)?"female":_.contains(a,191)?"male":null},getLookUrl:function(){return decodeURIComponent(this.get("look_url"))},getLookPids:function(a){return a?_.map(decodeURIComponent(a.split("/").pop()).split(","),function(b){return parseInt(b,10)}.bind(this)):_.pluck(this.get("products"),"product_id")},getTypeId:function(){return this.__typeId},__fetchResponseHandler:function(a){var b=["look_url","asset_url","avatar_image"];this.__lastResponse=a=_.mapObject(a,function(f,h){return _.isNull(f)||_.isUndefined(f)||!_.contains(b,h)?f:decodeURIComponent(f)}.bind(this));this.set(a)},getChangePromise:function(){return this.__changePromise},fetch:function(a){this.__changeResolver=null;this.__changePromise=new this.__Promise(function(b){this.__changeResolver=b}.bind(this));return this.__manager.fetch(a).then(function(){"accepted"!==this.__populatedPromise.state&&this.__populatedResolver.resolve();this.__changeResolver.resolve(this.__lastResponse);this.trigger("change");return this.__Promise.accept()}.bind(this)).catch(function(b){"accepted"!==this.__populatedPromise.state&&"rejected"!==this.__populatedPromise.state&&this.__populatedResolver.reject(b);this.__changeResolver.reject(b);this.trigger("change");return this.__Promise.reject(b)}.bind(this))},save:function(a){return this.__manager.post(a).then(function(){this.trigger("change");return this.__Promise.accept()}.bind(this)).catch(function(b){window.console.log(b);return this.fetch().then(function(){return this.__Promise.reject(b)}.bind(this)).catch(function(f){return this.__Promise.reject({message:"LookModel failed to refetch after POST failure",originalError:b,newError:f})}.bind(this))}.bind(this))}})}({UiCore:k["@UiCore"],LookModelManager:u});var r=k["@UiCore"].NodeModel.extend("OutfitNode",{});r=function(e){return e.UiCore.EdgeDerefModel.extend("OutfitEdgeDeref",{nodeFactory:e.UiCore.NodeModel,sorted:function(){return this.isPopulated()}})}({UiCore:k["@UiCore"],OutfitNode:r});var D=function(e){var d=e.UiCore.EdgeCollection;return d.extend("OutfitCollection",{model:e.OutfitEdgeDeref,initialize:function(a,b){d.prototype.initialize.call(this,a,b);this.on("add",this.__checkSort.bind(this));this.on("reset",function(){this.each(this.__checkSort.bind(this))}.bind(this))},__checkSort:function(a){a.sorted()||a.populated().then(this.sort.bind(this))},comparator:function(a){return a.node?-new Date(a.node.get("created")).getTime():0}})}({UiCore:k["@UiCore"],OutfitEdgeDeref:r}),E=function(e){var d=e.UiCore.NodeModel;return d.extend("RouletteNode",{dependencies:["moment","Promise","timer"],initialize:function(a,b){d.prototype.initialize.apply(this,arguments);this.__moment=b.moment;this.__timer=b.timer;this.__Promise=b.Promise;this.populated().then(function(){this.__setupClock();this.trigger("init");this.on("change:next_available_datetime",this.__scheduleAvailabilityChange.bind(this));this.on("change:current_datetime",this.__setupClock.bind(this))}.bind(this))},delete:function(){this.__becomeAvailableTimer&&this.__timer.clearTimeout(this.__becomeAvailableTimer)},__setupClock:function(){this.__calculateClockDrift();this.__scheduleAvailabilityChange()},__calculateClockDrift:function(){this.__secondsBehindServer=Math.floor(this.__moment(this.__timer.getTime()).diff(this.get("current_datetime"))/1e3)},__scheduleAvailabilityChange:function(){this.__becomeAvailableTimer&&this.__timer.clearTimeout(this.__becomeAvailableTimer);this.isAvailable()||(this.__becomeAvailableTimer=this.__timer.setTimeout(this.trigger.bind(this,"becomeAvailable"),1e3*this.secondsUntilAvailable()))},secondsUntilAvailable:function(){return Math.max(0,Math.ceil(-this.__moment(this.__timer.getTime()).diff(this.get("next_available_datetime"))/1e3)-this.__secondsBehindServer)},isAvailable:function(){var a=this.get("status"),b=this.secondsUntilAvailable();return"available"===a||0>=b}})}({UiCore:k["@UiCore"]}),y=function(e){var d=e.UiCore.NodeModel;e=e.UiCore.EdgeCollection.extend("MessageCollection",{comparator:function(a){if(a.edge&&a.edge.get("message_order"))return a.edge.get("message_order")}});return d.extend("ConversationNode",{initialize:function(a,b){d.prototype.initialize.call(this,a,b)},collectionFactories:{messages:e}})}({UiCore:k["@UiCore"]}),z=function(e){return e.UiCore.EdgeDerefModel.extend("ConversationEdgeDerefModel",{nodeFactory:e.ConversationNode})}({UiCore:k["@UiCore"],ConversationNode:y}),A=function(e){return e.UiCore.NodeModel.extend("FeedNode",{like:function(){return this.waitForLikedBy(!0).then(function(d){if(null===d.getMyEdge())return d.create({})})},unlike:function(){return this.whenHasLikedByEdge(!0).then(function(d){if(d)return d.populated().then(function(){return d.edge.destroy()})})},waitForLikedBy:function(d){return this.populated().then(function(){var a=this.getLikedBy();d&&a.invalidate();return a.populated()}.bind(this))},getLikedBy:function(){return this.searchEdgeCollection("liked_by_profile",{limit:0},e.UiCore.EdgeCollection)},whenHasLikedByEdge:function(d){return this.waitForLikedBy(d).then(function(a){return a.getMyEdge()})}})}({UiCore:k["@UiCore"]}),v=function(e){return e.UiCore.EdgeDerefModel.extend("ProductEdgeDeref",{nodeFactory:e.ProductNode})}({UiCore:k["@UiCore"],ProductNode:t}),F=function(e){var d=e.UiCore.EdgeCollection;return d.extend("ProductEdgeCollection",{model:e.ProductEdgeDeref,get:function(a){switch(a){case"is_owned":return this.all(function(b){return b.node&&b.node.relations&&b.node.get("is_owned")});default:return d.prototype.get.apply(this,arguments)}}})}({UiCore:k["@UiCore"],ProductEdgeDeref:v}),G=function(e){var d=e.UiCore.EdgeCollection;return d.extend("CartProductCollection",{model:e.ProductEdgeDeref,populated:function(a){a=a||{};return a.ignoreBadProducts?this.enumerated().then(function(){return this.Promise.every(this.map(function(b){return b.populated().catch(function(){})}))}.bind(this)).then(function(){return this}.bind(this)):d.prototype.populated.call(this)},checkCartContains:function(a){return this.populated({ignoreBadProducts:!0}).then(function(){var b=_.any(this.models,function(f){return f.node&&f.node.id==a});return this.Promise.resolve(b)}.bind(this))}})}({UiCore:k["@UiCore"],ProductEdgeDeref:v}),H=function(e){var d={language:{language:"all"},occupancy:{occupancy:""},gender:{female:!1,male:!1},ap_ga:{ap:!1,ga:!1},distinguish:{distinguish:!1},nft:{nft:!1},filter_text:{filter_text:""},dressup_category:{category:"outfits"},dressup_supercategory:{supercategory:"dna"},shop_category:{category:"tops"},online_status:{online:!1},special_user_status:{vip:!1,age_verified:!1},pricing:{pricing:"0"},platform:{web:!1,ios:!1,android:!1},activities:{likes:!1,comments:!1,eci:!1,shop_together_invite:!1,follows:!1,friend_activity:!1,room_moderation:!1,vcoin_gifting:!1,credit_gifting:!1,product_gifting:!1,payme_received:!1,payme_requested:!1},prepaid_card_value:{prepaid_card_value:"0"},prepaid_card_country:{prepaid_card_country:"AE"},sort:{sort:"best_match"}},a={dna:{supercategory:"dna",category:"skins"},outfits:{supercategory:"outfits",category:"outfits"},clothes:{supercategory:"clothes",category:"tops"}},b={tops:"69,128",bottoms:"70,78",shoes:"101,102",accessories:"71,153,425,1877,2057,1646,1719,2362,1648,97,98",hairstyles:"67,75",eyes:"89,90,91,92",heads:"295,296",skins:"68,76,3096,3097",skin:"68,76,3096,3097",all:"40,41,108,366,1027",in_use:"40,41",recent:"40,41,108,366,1027",furniture:"1027",seating:"906,909",tables:"1199",lighting:"949",televisions:"917",positions:"3102",women_all:"40",women_looks:"3090",women_clothing_all:"78,101,128",women_tops:"128",women_bottoms:"78",women_shoes:"101",women_body_all:"75,76,89,90,295,3096",women_hair:"75",women_eyes:"89",women_eyebrows:"90",women_heads:"295",women_skins:"76,3096",women_accessories:"153,425,97",women_misc:"3092",men_all:"41",men_looks:"3091",men_clothing_all:"69,70,102",men_tops:"69",men_bottoms:"70",men_shoes:"102",men_body_all:"67,68,91,92,296,3097",men_hair:"67",men_eyes:"91",men_eyebrows:"92",men_heads:"296",men_skins:"68,3097",men_accessories:"71,425,98",men_misc:"3093",avatars:"108",rooms:"366",decorated_rooms:"3100,1940",poses_and_actions:"3102",wishlist:"106,108,425,3088"},f=["316","324"],h={best_match:{},newest_products:{sort:"date_added",sortorder:"desc"},oldest_products:{sort:"date_added",sortorder:"asc"},price_low_high:{sort:"price",sortorder:"asc"},price_high_low:{sort:"price",sortorder:"desc"}},l=IMVU.NamedModel;return l.extend("FilterModel",{dependencies:["featureAccessManager","Promise"],initialize:function(c,g){this.Promise=g.Promise;this.disabledFilters=new Backbone.Model;this.__populatedPromise=new this.Promise(function(m){this.__populatedResolver=m}.bind(this));this.__categoryBlacklist=IMVU.optionalProperty(g,"categoryBlacklist",f);g.featureAccessManager.canSeeRoomFurnitureCategories()&&-1===b.wishlist.indexOf("366,1027")&&(b.wishlist+=",366,1027");c=_.extend.apply(_,[{}].concat(_.map(c,function(m){return m.match(/_supercategory/)?a[d[m].supercategory]:d[m]})));l.prototype.initialize.call(this,c,g);this.on("change:supercategory",this.__updateFromSupercategory,this);g.dressUpAvatarManager?g.dressUpAvatarManager.getGender().then(function(m){"female"===m?this.set({female:!0,male:!1}):"male"===m&&this.set({male:!0,female:!1});this.__populatedResolver.accept()}.bind(this)):this.__populatedResolver.accept()},delete:function(){this.off(null,null,this);l.prototype.delete.call(this)},populated:function(){return this.__populatedPromise},disableFilter:function(c){this.disabledFilters.set(c,!0)},enableFilter:function(c){this.disabledFilters.set(c,!1)},toggleDisabled:function(c,g){this.disabledFilters.set(c,void 0!==g?g:!this.disabledFilters.get(c))},isDisabled:function(c){return!!this.disabledFilters.get(c)},setCategoryByProduct:function(c){c.populated().then(function(){var g=_.map(_.pluck(c.get("category_path"),"id"),String);c.get("category_path")||(g=_.map(_.pluck(c.get("categories"),"id"),String));var m=0,p;_.each(b,function(q,n){q=_.intersection(g,q.split(",")).length;0<q&&q>=m&&"nft"!==n&&"wishlist"!==n&&"all"!==n&&"women_all"!==n&&"women_clothing_all"!==n&&"women_body_all"!==n&&"men_all"!==n&&"men_clothing_all"!==n&&"men_body_all"!==n&&(p=n,m=q)});p&&this.set({category:p})}.bind(this))},toQueryParamsMap:function(){var c={};"language"in this.attributes&&"all"!==this.get("language")&&(c.language=this.get("language"));if("occupancy"in this.attributes&&this.get("occupancy")){var g=this.get("occupancy").split("-");c.low=g[0];c.high=g[1]}"supports_audience"in this.attributes&&null!==this.get("supports_audience")&&(c.supports_audience=this.get("supports_audience"));"female"in this.attributes&&!this.isDisabled("gender")&&this.get("female")!==this.get("male")&&(this.get("female")&&!this.isDisabled("female")?(c.gender="female",c.no_cat="41"):this.get("male")&&!this.isDisabled("male")&&(c.gender="male",c.no_cat="40"));"category"in this.attributes&&"rooms"===this.attributes.category&&(c.no_cat=b.decorated_rooms);"ap"in this.attributes&&this.get("ap")!==this.get("ga")&&(c.ap=this.get("ap")?1:0,c.rating=this.get("ap")?"ap":"ga",c.product_rating=this.get("ap")?1:0,this.get("ap")?c.has_access_pass=this.get("ap")?1:0:this.get("ga")&&(c.ga_only=this.get("ga")?1:0));"vip"in this.attributes&&this.get("vip")&&(c.has_vip_pass=!0);"age_verified"in this.attributes&&this.get("age_verified")&&(c.age_verified=!0);"distinguish"in this.attributes&&this.get("distinguish")&&(c.plus_filter=!0);"nft"in this.attributes&&this.get("nft")&&(c.plus_filter=!0);"online"in this.attributes&&this.get("online")&&(c.status="online",c.online=!0);"filter_text"in this.attributes&&this.get("filter_text")&&(c.filter_text=this.get("filter_text"),c.name_filter=this.get("filter_text"),c.partial_avatar_name=this.get("filter_text"),c.keywords=this.get("filter_text"));"category"in this.attributes&&"outfits"!==this.get("category")&&(c.cat=b[this.get("category")]||"106,108,3088,425",this.__categoryBlacklist&&(c.no_cat=this.__categoryBlacklist.join(",")+(c.no_cat?","+c.no_cat:"")));"category"in this.attributes&&"furniture"===this.get("category")&&(c.no_cat+=c.no_cat&&""!==c.no_cat?","+b.poses_and_actions:b.poses_and_actions);"pricing"in this.attributes&&this.get("pricing")&&0<this.get("pricing")&&!this.isDisabled("pricing")&&(c.product_price=this.get("pricing"));"sort"in this.attributes&&this.get("sort")&&!this.isDisabled("sort")&&(g=h[this.get("sort")],_.isEmpty(g)||"category"in this.attributes&&"wishlist"===this.attributes.category?(delete c.sort,delete c.sortorder):Object.assign(c,g));"limit"in this.attributes&&(c.limit=this.get("limit"));g=[];"web"in this.attributes&&this.get("web")&&g.push("webgl");"ios"in this.attributes&&this.get("ios")&&g.push("ios");"android"in this.attributes&&this.get("android")&&g.push("android");_.isEmpty(g)||(c.platform=g.join(","));"likes"in this.attributes&&this.get("likes")&&(c.feed_like=this.get("likes"));"comments"in this.attributes&&this.get("comments")&&(c.feed_comment=this.get("comments"));"eci"in this.attributes&&this.get("eci")&&(c.chat_invite=this.get("eci"));"shop_together_invite"in this.attributes&&this.get("shop_together_invite")&&(c.shop_together_invite=this.get("shop_together_invite"));"friends-only"in this.attributes&&this.get("friends-only")&&(c.friends_only=this.get("friends-only"));"follows"in this.attributes&&this.get("follows")&&(c.timelines_follow=this.get("follows"));"friend_activity"in this.attributes&&this.get("friend_activity")&&(c.friend_accept=this.get("friend_accept"),c.friend_request=this.get("friend_request"));"room_moderation"in this.attributes&&this.get("room_moderation")&&(c.moderator_add=this.get("moderator_add"),c.moderator_remove=this.get("moderator_remove"));"credit_gifting"in this.attributes&&this.get("credit_gifting")&&(c.credit_gift_received=this.get("credit_gift_received"));"vcoin_gifting"in this.attributes&&this.get("vcoin_gifting")&&(c.vcoin_gift_received=this.get("vcoin_gift_received"));"product_gifting"in this.attributes&&this.get("product_gifting")&&(c.product_gift_received=this.get("product_gift_received"));"payme_received"in this.attributes&&this.get("payme_received")&&(c.payme_received=this.get("payme_received"));"payme_requested"in this.attributes&&this.get("payme_requested")&&(c.payme_requested=this.get("payme_requested"));"creator"in this.attributes&&this.get("creator")&&(c.creator=this.get("creator"));return c},toJSON:function(){return _.extend(l.prototype.toJSON.apply(this,arguments),_.reduce(this.disabledFilters.toJSON(),function(c,g,m){c["disabled."+m]=g;return c},{}))},rawToJSON:function(){return l.prototype.toJSON.apply(this,arguments)},__updateFromSupercategory:function(){var c=this.get("supercategory");this.set(a[c])}})}({}),B=function(e){return e.UiCore.EdgeDerefModel.extend("NotificationEdgeDeref",{nodeFactory:e.NotificationNode,sorted:function(){return this.isPopulated()}})}({UiCore:k["@UiCore"],NotificationNode:x}),w=function(e){return e.UiCore.EdgeDerefModel.extend("FeedEdgeDeref",{nodeFactory:e.FeedNode})}({UiCore:k["@UiCore"],FeedNode:A}),I=function(e){return e.UiCore.EdgeCollection.extend("ConversationCollection",{model:e.ConversationEdgeDerefModel,initialize:function(){e.UiCore.EdgeCollection.prototype.initialize.apply(this,arguments);this.on("edge:change:last_message.created",function(){this.sort()},this)},comparator:function(d,a){d=d.edge.get("last_message.created");a=a.edge.get("last_message.created");return d===a?0:d<a?1:-1}})}({UiCore:k["@UiCore"],ConversationEdgeDerefModel:z}),J=function(e){var d=e.UiCore.EdgeCollection;return d.extend("FeedCollection",{model:e.FeedEdgeDeref,initialize:function(a,b){d.prototype.initialize.call(this,a,b);this.on("add",this.__sortCollection.bind(this));this.on("reset",function(){this.each(this.__sortCollection.bind(this))}.bind(this))},__sortCollection:function(a){a.populated().then(this.sort.bind(this))},comparator:function(a){return a.node?-new Date(a.node.get("time")).getTime():0}})}({UiCore:k["@UiCore"],FeedEdgeDeref:w}),K=k["@UiCore"].EdgeCollection.extend("FriendRequestCollection",{}),L=function(e){var d=e.UiCore.RestCollection;return d.extend("MetaCollection",{dependencies:["collections","Promise","restModelFactory"],initialize:function(a){this.__Promise=a.Promise;this.__filters=Array(a.collections.length);this.setCollections(a.collections)},delete:function(){this.stopListening()},__findPageCollection:function(){return _.findIndex(this.__collections,function(a){return a.hasNextPage()}.bind(this))},__setModels:function(){var a=this.__findPageCollection(),b=[];_.each(_.range(0,-1===a?this.__collections.length:a+1),function(f){this.__filters[f]?b.push(_.filter(this.__collections[f].models,this.__filters[f])):b.push(this.__collections[f].models)}.bind(this));d.prototype.reset.call(this,_.flatten(b))},setCollections:function(a){this.__collections&&_.each(this.__collections,function(b){this.stopListening(b)}.bind(this));this.models=[];this.__collections=a;this.__setModels();this.url="meta_"+_.pluck(this.__collections.url).join("_");_.each(this.__collections,function(b){this.listenTo(b,"add reset remove",this.__setModels)}.bind(this))},setFilter:function(a,b){var f=_.findIndex(this.__collections,function(h){return h.url===a}.bind(this));if(0>f)throw Error('No collection found for "'+a+'"');this.__filters[f]=b;this.__setModels()},reset:function(a,b){throw Error("Reset meta collection not allowed.")},isSyncing:function(){for(var a=0;a<this.__collections.length;a++){if(this.__collections[a].isSyncing())return!0;if(this.__collections[a].hasNextPage())break}return!1},hasNextPage:function(){return-1!==this.__findPageCollection()},getNextPage:function(a){if(!this.isSyncing()&&this.hasNextPage()){a=this.__findPageCollection();var b=this.__Promise.accept();-1!==a&&(b=this.__collections[a].getNextPage());b.then(function(){this.__setModels()}.bind(this));return b}},getPreviousPage:function(a){throw Error("getPreviousPage on meta collection not allowed")},fetch:function(a){throw Error("fetch on meta collection not allowed")},invalidate:function(){throw Error("invalidate on meta collection not allowed")},release:function(){throw Error("release on meta collection not allowed")},sync:function(){throw Error("sync on meta collection not allowed")},populated:function(){return this.__Promise.every(_.map(this.__collections,function(a){return a.populated()}.bind(this)))},enumerated:function(){return this.__Promise.every(_.map(this.__collections,function(a){return a.enumerated()}.bind(this)))}})}({UiCore:k["@UiCore"]}),M=function(e){var d=e.UiCore.EdgeCollection;return d.extend("NotificationCollection",{model:e.UiCore.EdgeDerefModel,initialize:function(a,b){d.prototype.initialize.call(this,a,b);this.on("add",this.__checkSort.bind(this));this.on("reset",function(){this.each(this.__checkSort.bind(this))}.bind(this))},__checkSort:function(a){a.isPopulated()||a.populated().then(this.sort.bind(this))},comparator:function(a){return a.node?-new Date(a.node.get("timestamp")).getTime():0}})}({UiCore:k["@UiCore"],NotificationEdgeDeref:B}),N=function(e){var d=e.UiCore.NodeModel;return d.extend("RoomNode",{initialize:function(){d.prototype.initialize.apply(this,arguments);this.listenTo(this,"change:relations",this.__triggerChanges.bind(this))},__triggerChanges:function(a,b){},get:function(a){return d.prototype.get.apply(this,arguments)}})}({UiCore:k["@UiCore"]});k=function(e){return e.UiCore.EdgeCollection.extend("FeedCommentCollection",{comparator:function(d){return d.node?-new Date(d.node.get("time")).getTime():-Number.MAX_VALUE}})}({UiCore:k["@UiCore"],FeedEdgeDeref:w});return{CartProductCollection:G,ConversationCollection:I,ConversationEdgeDerefModel:z,ConversationNode:y,FeedCollection:J,FeedCommentCollection:k,FeedEdgeDeref:w,FeedNode:A,FilterModel:H,FriendRequestCollection:K,LookModel:u,MetaCollection:L,NotificationCollection:M,NotificationEdgeDeref:B,NotificationNode:x,OutfitCollection:D,OutfitEdgeDeref:r,ProductCollection:C,ProductEdgeCollection:F,ProductEdgeDeref:v,ProductNode:t,RoomNode:N,RouletteNode:E}});