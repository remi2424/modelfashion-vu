module({"json!/common/waf/js/manager/PerfReportManagerBudgetSandbox.json":"json!/asset/82d1872a3626230a/common/waf/js/manager/PerfReportManagerBudgetSandbox.json","@Leanplum":"@Leanplum","json!/common/waf/js/manager/PerfReportManagerTags.json":"json!/asset/61cfae863b1d964d/common/waf/js/manager/PerfReportManagerTags.json","json!/common/waf/js/manager/BlankImageList.json":"json!/asset/a84a82ed3040d931/common/waf/js/manager/BlankImageList.json","@FastClick":"@FastClick","@SHA512":"@SHA512","json!/common/withme/js/manager/OnboardingGamificationManagerTasks.json":"json!/asset/2f56a49f8f2f1230/common/withme/js/manager/OnboardingGamificationManagerTasks.json","@ScrollBar":"@ScrollBar","json!@globalDictionary":"json!@globalDictionary","json!/common/waf/js/manager/PerfReportManagerBudgetWebBig.json":"json!/asset/288fa407a68b6982/common/waf/js/manager/PerfReportManagerBudgetWebBig.json","@globalCSS":"@globalCSS","@moment":"@moment","json!/common/waf/js/dialog/tutorialTemplate/node_room_1_tutorial.json":"json!/asset/b6269d9849207781/common/waf/js/dialog/tutorialTemplate/node_room_1_tutorial.json","text!@IconLibrary":"text!@IconLibrary","@Dialogs":"@Dialogs","@WAFWidgets":"@WAFWidgets","@exif":"@exif","json!/common/waf/js/manager/PerfBudgetUnitTests.json":"json!/asset/5308d6fda8a1aadd/common/waf/js/manager/PerfBudgetUnitTests.json","@NextUtil":"@NextUtil","json!/common/waf/js/AppMonitorCustomErrorCodes.json":"json!/asset/b31027f181ca89a2/common/waf/js/AppMonitorCustomErrorCodes.json","json!/common/pure/util/profile.json":"json!/asset/996b43a0c80f13b9/common/pure/util/profile.json","@Model":"@Model","@SmartBanner":"@SmartBanner","@UiCore":"@UiCore","json!/common/waf/js/manager/UrlManager.json":"json!/asset/ca612eb34cc3ef34/common/waf/js/manager/UrlManager.json","@IMQ":"@IMQ","json!/common/waf/js/manager/PerfReportManagerBudgetClient.json":"json!/asset/8660b1a28a102a9c/common/waf/js/manager/PerfReportManagerBudgetClient.json","json!/common/waf/js/manager/PerfReportManagerBudgetWebSmall.json":"json!/asset/ad6a32b67e671744/common/waf/js/manager/PerfReportManagerBudgetWebSmall.json","@Lightboxes":"@Lightboxes","css!/build/welcome/welcome-desktop-app.css":"css!/asset/3126f374fd3ff53f/build/welcome/welcome-desktop-app.css"},function(m){var F=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(b,a,c,d){return"hidden"},3:function(b,a,c,d){return'\n    <div class="update-indicator-placeholder"></div>\n    '},compiler:[5,">= 2.0.0"],main:function(b,a,c,d){c='<div class="system-tray">\n    <div class="logo ';var e=a.unless.call(b,b&&b.showLogo,{name:"unless",hash:{},fn:this.program(1,d),inverse:this.noop,data:d});if(e||0===e)c+=e;c+='">\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30">\n            <title>IMVU logo</title>\n            <path fill="#FFF" fill-rule="evenodd" d="M23.246 23.369a5.379 5.379 0 0 1-2.14.673c-1.773.179-3.252-.427-4.484-1.689-.012-.012-.024-.025-.038-.036-.005-.004-.013-.003-.031-.007-.06.227-.116.456-.182.682-.437 1.486-1.418 2.404-2.932 2.703-1.277.252-2.403-.113-3.33-1.024-.326-.322-.593-.703-.882-1.063-.551-.685-1.1-1.373-1.645-2.062a3.676 3.676 0 0 1-.79-2.027c-.07-.843.141-1.612.598-2.319l.023-.038c-.154-.116-.31-.225-.456-.346-.651-.541-1.048-1.236-1.226-2.059-.184-.853-.364-1.707-.547-2.561a3.609 3.609 0 0 1-.074-.939.615.615 0 0 0-.067-.336 3.555 3.555 0 0 1-.394-1.963c.079-1.014.521-1.858 1.281-2.53.586-.52 1.284-.799 2.056-.877 1.148-.117 2.134.256 2.969 1.039.303.283.541.618.726.989.009.019.021.036.029.052.191-.203.37-.413.569-.602.698-.665 1.53-1.074 2.47-1.27.47-.099.946-.14 1.426-.087a.51.51 0 0 0 .31-.077 4.947 4.947 0 0 1 1.884-.58c1.411-.144 2.669.246 3.78 1.12 1.033.811 1.649 1.877 1.908 3.158.109.544.238 1.084.34 1.629.175.938-.004 1.814-.505 2.626l-.071.115c.244.209.496.395.715.616.519.523.816 1.164.962 1.882.114.561.244 1.118.347 1.682a5.001 5.001 0 0 1-.403 3.126c-.487 1.022-1.205 1.838-2.196 2.4M15.002 0C6.92 0 .369 6.552.369 14.634c0 3.704 1.377 7.086 3.646 9.664L.36 27.22A23.311 23.311 0 0 0 11.433 30c2.913 0 5.7-.533 8.272-1.506 5.775-1.959 9.93-7.424 9.93-13.86C29.635 6.552 23.084 0 15.002 0m6.644 11.614a.802.802 0 0 1-.978-.19c-.126-.14-.168-.316-.205-.494-.101-.48-.201-.962-.304-1.44-.08-.367-.368-.62-.716-.634a.765.765 0 0 0-.784.56c-.066.212 0 .412.04.615.097.464.205.925.29 1.391.08.44-.214.84-.66.923-.413.08-.82-.206-.911-.638-.113-.53-.222-1.059-.34-1.586-.088-.392-.457-.663-.814-.61-.435.061-.736.403-.7.827.02.227.086.451.134.675.073.346.155.69.219 1.038.08.432-.208.862-.617.94-.444.083-.851-.195-.946-.648-.118-.555-.243-1.11-.35-1.669-.242-1.256.572-2.503 1.816-2.749a2.319 2.319 0 0 1 1.644.261c.205-.189.39-.39.606-.554.337-.258.735-.365 1.155-.409 1.084-.112 2.248.677 2.489 1.935.1.52.219 1.037.33 1.555.082.374-.078.74-.398.901m1.763-1.138c-.11-.518-.222-1.036-.328-1.554a4.123 4.123 0 0 0-.468-1.253 3.605 3.605 0 0 0-1.02-1.117 3.487 3.487 0 0 0-.144-.103 3.561 3.561 0 0 0-2.294-.63 3.602 3.602 0 0 0-1.926.706.31.31 0 0 1-.041.026.274.274 0 0 1-.04.015.206.206 0 0 1-.092-.002 3.845 3.845 0 0 0-.77-.092 3.049 3.049 0 0 0-.466.031 4.03 4.03 0 0 0-.993.268 3.467 3.467 0 0 0-1.139.772 3.98 3.98 0 0 0-.514.654c-.066.104-.127.21-.183.317a3.596 3.596 0 0 0-.4 2.042c.012.121.029.242.052.364.11.575.24 1.147.36 1.72.014.062.029.122.046.181a2.166 2.166 0 0 0 .676 1.052c.26.225.556.381.864.465a2.101 2.101 0 0 0 1.975-.472 2.788 2.788 0 0 0 .222-.235c.07-.084.14-.172.216-.259a2.323 2.323 0 0 0 .382.213c.197.086.402.141.615.164.212.021.433.01.662-.039.304-.066.57-.186.8-.353.23-.167.424-.382.587-.638h.022c.03.017.062.034.092.053a2.081 2.081 0 0 0 1.535.291 2.034 2.034 0 0 0 .976-.463 2.268 2.268 0 0 0 .781-1.692c0-.144-.015-.288-.045-.432m-.506 9.195c-.49.579-1.134.822-1.638.835-1.39 0-2.352-.811-2.59-1.98-.106-.521-.222-1.043-.327-1.565-.087-.435.259-.884.7-.921.484-.041.824.22.922.698.103.505.214 1.009.319 1.514a.816.816 0 0 0 .907.622c.376-.057.697-.415.66-.801-.024-.261-.097-.52-.15-.78-.068-.327-.143-.655-.204-.984a.82.82 0 0 1 .612-.926c.433-.1.879.15.977.572.14.603.278 1.206.38 1.816.119.716-.103 1.35-.568 1.9m1.947-2.296c-.11-.548-.234-1.092-.343-1.64-.314-1.587-2.211-2.355-3.57-1.297-.201.158-.36.375-.55.575-.528-.358-1.12-.466-1.764-.321-1.144.258-1.914 1.458-1.664 2.605.11.515.219 1.03.326 1.545.136.653.389 1.256.845 1.747.965 1.04 2.146 1.505 3.568 1.265.989-.166 1.805-.63 2.416-1.432.69-.906.96-1.92.736-3.047m-9.93.833c-.293 1.13-.593 2.26-.888 3.392a.756.756 0 0 1-.605.586c-.337.075-.61-.028-.827-.3a997.432 997.432 0 0 0-2.213-2.777c-.21-.262-.27-.552-.138-.864.134-.318.395-.474.732-.498a.711.711 0 0 1 .625.278c.392.485.78.974 1.17 1.46.026.034.053.065.093.114l.503-1.92c.106-.406.463-.642.895-.594.362.039.682.379.697.758.005.12-.013.247-.043.365m.592-2.084a2.19 2.19 0 0 0-2.781.09c-.171.149-.308.339-.466.517a.544.544 0 0 1-.048-.03c-.636-.404-1.314-.46-2.013-.206A2.215 2.215 0 0 0 9.275 20c.719.892 1.43 1.789 2.143 2.686.562.708 1.284 1.02 2.186.89a2.23 2.23 0 0 0 1.813-1.643c.296-1.128.59-2.255.89-3.382.252-.948-.046-1.865-.794-2.428m-5.496-2.009c-.45.092-.855-.174-.957-.64a249.29 249.29 0 0 1-.543-2.569.785.785 0 0 1 .79-.96.797.797 0 0 1 .78.616c.187.863.373 1.726.552 2.59a.81.81 0 0 1-.622.963M8.035 8.577a.812.812 0 0 1 .802-.818c.447-.002.809.372.81.836a.792.792 0 0 1-.812.801.808.808 0 0 1-.8-.819m3.985 4.258c-.056-.25-.108-.502-.163-.753-.108-.502-.214-1.004-.316-1.507-.091-.453-.22-.887-.53-1.243a.147.147 0 0 1-.04-.132c.002-.01.002-.019.005-.03a2.163 2.163 0 0 0-.219-1.719 2.172 2.172 0 0 0-.68-.722 2.298 2.298 0 0 0-.635-.294 2.197 2.197 0 0 0-1.455.093 2.34 2.34 0 0 0-.455.258c-.516.377-.868.964-.91 1.604-.04.6.12 1.143.516 1.606.043.05.05.091.032.15a2.076 2.076 0 0 0-.09.634c.002.128.017.256.044.384.185.886.372 1.77.562 2.654.03.143.074.277.128.403.38.881 1.29 1.341 1.999 1.322l.175-.015a2.26 2.26 0 0 0 1.048-.334 2.2 2.2 0 0 0 .858-1.002c.176-.41.23-.88.126-1.357"/>\n        </svg>\n    </div>\n    ';if((e=a["if"].call(b,b&&b.showUpdateIndicator,{name:"if",hash:{},fn:this.program(3,d),inverse:this.noop,data:d}))||0===e)c+=e;return c+'\n</div>\n<ul class="main-nav center-nav"></ul>\n<div class="fragment-placeholder"></div>\n'},useData:!0})}({}),U=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(b,a,c,d){var e;c=a.helperMissing;var f="\n    <fieldset class=\"has-textarea-above\">\n        <legend class='system-info-header'>",g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"creator",{name:"i18n-g",hash:{},data:d}));if(g||0===g)f+=g;f+='</legend>\n        <div class="edit-profile-attribute background-container show-label">\n            <input id=\'profile-checkbox-show-creator-tier\' type="checkbox" class="toggle-switch" data-pref="avwidget_show_creator_tier" data-pref-default=1>\n            <label id="display-creator-tier-toggle" for=\'profile-checkbox-show-creator-tier\'>\n                <div>\n                    ';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"show creator tier",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;return f+"<br>\n                </div>\n            </label>\n        </div>\n    </fieldset>\n    "},3:function(b,a,c,d){return' class="has-textarea-above"'},compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e;c=a.helperMissing;var f=this.escapeExpression,g='<div class=\'profile\'>\n    <fieldset>\n        <div class="change-profile background-container">\n            <div class="profile-icon-placeholder"></div>\n            <form class="customProfileImage">\n                <label class="change-profile-image" for="custom-profile-image">',k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"change profile image",{name:"i18n-g",hash:{},data:d}));if(k||0===k)g+=k;g+='</label>\n                <input class="change-profile-image-input" type="file" accept="image/*" name="custom-profile-image" id="custom-profile-image" />\n            </form>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"name",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</legend>\n        <div class=\'edit-profile-attribute displayName\'>\n            <textarea id="display_name" type="text" class="value" placeholder="';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"display name",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset class="has-textarea-above">\n        <legend class=\'system-info-header\'>';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"bio",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</legend>\n        <div class=\'edit-profile-attribute tagline\'>\n            <textarea id="tagline" type="text" class="value" placeholder="';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"profile_bio",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='"></textarea>\n        </div>\n    </fieldset>\n\n    <fieldset class="has-textarea-above">\n        <legend class=\'system-info-header\'>';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"interests",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</legend>\n        <div class=\'edit-profile-attribute interests\'>\n            <textarea id="interests" class="value" placeholder="';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"profile_interests",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='"></textarea>\n        </div>\n    </fieldset>\n\n    ';if((k=a["if"].call(b,b&&b.is_creator,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d}))||0===k)g+=k;g+="\n\n    <fieldset ";if((k=a.unless.call(b,b&&b.is_creator,{name:"unless",hash:{},fn:this.program(3,d),inverse:this.noop,data:d}))||0===k)g+=k;g+=">\n        <legend class='system-info-header'>";if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"show age",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</legend>\n        <div class="edit-profile-attribute background-container show-label">\n            <input id=\'profile-checkbox-show-age\' type="checkbox" class="toggle-switch" data-pref="avwidget_show_age" data-pref-default=1>\n            <label id="display-age-toggle" for=\'profile-checkbox-show-age\'>\n                <div>\n                    ';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"show age",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+="\n                </div>\n            </label>\n        </div>\n        <span class='description'>"+f((e=a.age_description||b&&b.age_description,"function"===typeof e?e.call(b,{name:"age_description",hash:{},data:d}):e))+' <a class="help-center" href="'+f((e=a.helpUrl||b&&b.helpUrl,"function"===typeof e?e.call(b,{name:"helpUrl",hash:{},data:d}):e))+'" target="_blank">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"help center",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+=".</a></span>\n    </fieldset>\n\n    <fieldset>\n        <legend class='system-info-header'>";if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"gender",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+="</legend>\n        <div class='edit-profile-attribute gender show-label background-container'>\n            <input id='profile-checkbox-show-gender' type=\"checkbox\" class=\"toggle-switch\" data-pref=\"avwidget_show_gender\" data-pref-default=1><label for='profile-checkbox-show-gender'>";if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"show gender",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</label>\n        </div>\n        <div class="separator"></div>\n        <div class=\'edit-profile-attribute gender\'>\n            <select id="gender" class="value"></select>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"location",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+="</legend>\n        <div class='edit-profile-attribute geo-location show-label background-container'>\n            <input id='profile-checkbox-show-geo-location' type=\"checkbox\" class=\"toggle-switch\" data-pref=\"avwidget_show_geo_location\" data-pref-default=1><label for='profile-checkbox-show-geo-location'>";if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"show location",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</label>\n        </div>\n        <div class="separator"></div>\n        <div class=\'edit-profile-attribute location background-container\' id="location"></div>\n        <div class=\'location-container hidden\'>\n            <div class=\'edit-profile-attribute country\'>\n                <select id="country" class="value"></select>\n            </div>\n             <div class="separator"></div>\n            <div class=\'edit-profile-attribute state not-applicable\'>\n                <select id="state" class="value"></select>\n            </div>\n        </div>\n    </fieldset>\n\n    <fieldset>\n        <legend class=\'system-info-header\'>';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"affinity",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+="</legend>\n        <div class='edit-profile-attribute relationship_status affinity'>\n            <span class=\"descriptor\">";if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"relationship",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+=':</span>\n            <select id="relationship_status" class="value"></select>\n        </div>\n        <div class="separator"></div>\n        <div class=\'edit-profile-attribute looking_for affinity\'>\n            <span class="descriptor">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"here for",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+=':</span>\n            <select id="looking_for" class="value"></select>\n        </div>\n    </fieldset>\n\n</div>\n<option class="dropdown-item hidden"></option>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary btn-dark submit">\n        ';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"Save",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;return g+"\n    </button>\n<\/script>"},useData:!0})}({}),V=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e,f=a.helperMissing;c='<a class="header-button save-profile">';if((a=(e=a["i18n-g"]||b&&b["i18n-g"]||f,e.call(b,"Save",{name:"i18n-g",hash:{},data:d})))||0===a)c+=a;return c+"</a>"},useData:!0})}({}),W=function(h){var b=h.UiCore.UiContext;return b.extend("UploadCurtain",{uiContextName:"upload_curtain",className:"upload-curtain",dependencies:["Promise","timer"],initialize:function(a){b.prototype.initialize.call(this,a);this.serviceProvider=a.serviceProvider;this.Promise=a.Promise;this.timer=a.timer;this.__completeDelay=a.completeDelay||1e3;this.addToDOM()},show:function(){this.$el.addClass("loading");b.prototype.show.call(this)},complete:function(){this.$el.removeClass("loading");return new this.Promise(function(a){this.__completeTimer=this.timer.setTimeout(function(){a.accept();this.hide()}.bind(this),this.__completeDelay)}.bind(this))},delete:function(){this.timer.clearTimeout(this.__completeTimer)}})}({UiCore:m["@UiCore"]}),X=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){return'<footer class="dialog-footer">\n    <a href="javascript:;" class="post footer-post-btn btn btn-primary"></a>\n</footer>'},useData:!0})}({}),Y=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){return'<div class="back-button"></div>'},useData:!0})}({}),Z=function(h){var b=h.Dialogs.AlloyModalDialog;return b.extend("EditProfileImageDialog",{uiContextName:"edit_profile_image_dialog",className:"edit-profile-image-dialog dialog-type-B can-dismiss",dependencies:["dialogManager","globalStringManager","modeManager","timer"],trackedEvents:function(){return[{type:"click",selector:".post",name:"post",handler:this.__post},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__stringManager=a.globalStringManager;this.title=this.__stringManager.get("dialog_edit_profile_image_title");this.__file=IMVU.requireProperty(a,"file",null);this.__modeManager=a.modeManager;_.has(this.__serviceProvider.services,"editProfileImage")||_.has(a,"editProfileImage")?(this.__editProfileImage=a.editProfileImage||this.__serviceProvider.get("editProfileImage"),this.addToDOM()):module.run({EditProfile:"@EditProfileImage"},this.__completeInit.bind(this))},__completeInit:function(a,c){this.__editProfileImage=this.__modeManager.createChildContext(a.EditProfile,{$parentElement:this.__modeManager.$el});this.__serviceProvider.register("editProfileImage",this.__editProfileImage);this.addToDOM()},postRender:function(){this.setContent("body",h.template);"mobile"===this.serviceProvider.get("platform")&&(this.$(".dialog-header").prepend(h.backButtonTemplate({})),this.$(".dialog-x").remove());this.$post=this.$(".footer-post-btn").text(this.__stringManager.get("dialog_profile_image_edit_post"));this.__editProfileImage.attach(this.$(".dialog-body"));this.__editProfileImage.restoreScrollValues();this.__editProfileImage.on("exit",this.hide,this);this.__editProfileImage.on("uploadError",this.__uploadError,this);this.__editProfileImage.on("canPost",this.setPostStatus,this);this.__editProfileImage.changeCustomProfile(this.__file)},__uploadError:function(){this.__timer.setTimeout(function(){this.promiseResolver.resolve(!0);this.__dialogManager.alert({title:this.__stringManager.get("dialog_edit_profile_invalid_image_title"),text:this.__stringManager.get("dialog_edit_profile_invalid_image_text")})}.bind(this),0)},setPostStatus:function(a){this.$post.toggleClass("disabled",!a)},__post:function(){this.__editProfileImage.post()},delete:function(){this.__editProfileImage.reset();this.__editProfileImage.saveScrollValues();this.__editProfileImage.detach();this.__editProfileImage.off(null,null,this);b.prototype.delete.call(this)},__goBack:function(){this.promiseResolver.resolve(!0)}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],backButtonTemplate:Y,template:X}),aa=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){return'<div class="dropdown-label is-truncated"><span>&nbsp;</span></div>\n<div class="dropdown-option-list-container">\n    <div class="dropdown-scroll-up"></div>\n    <div class="dropdown-scroll-down"></div>\n    <ul class="dropdown-option-list">\n        <li class="dropdown-option is-truncated" data-value="" tabindex="-1"></li>\n    </ul>\n</div>\n'},useData:!0})}({}),G=function(h){function b(d){d=$(d.target).closest(".dropdown");$(".dropdown").not(d).each(function(e,f){$(f).data("dropdown-instance").__hide()})}var a=h.UiCore.UiContext,c=h.NextUtil.Keys;return a.extend("Dropdown",{globalSetup:function(){document.addEventListener("click",b,!0);document.addEventListener("touchend",b,!0)},globalTearDown:function(){document.removeEventListener("click",b,!0);document.removeEventListener("touchend",b,!0)},uiContextName:"dropdown",className:"dropdown disable-text-selection",ITEM_HEIGHT:40,AUTO_SCROLL_BY:2,dependencies:["timer","window"],trackedEvents:function(){return[{type:"click",selector:".dropdown-label",name:"dropdown_label_click",handler:"toggleOpen"},{type:"click",selector:".dropdown-option",name:"dropdown_option_click",handler:"clickOption"},{type:"keydown",selector:"",name:"dropdown_keydown",handler:this.__onKeydown.bind(this,[])},{type:"mousemove",selector:".dropdown-option",name:"dropdown_option_mouseenter",handler:this.__onMousemove.bind(this,{x:0,y:0})},{type:"mouseenter",selector:".dropdown-label",name:"dropdown_label_mouseenter",handler:"__onMouseenterLabel"},{type:"mouseenter",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseenter",handler:"__onScrollUpMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseleave",handler:"__onScrollUpMouseleave"},{type:"mouseenter",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseenter",handler:"__onScrollDownMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseleave",handler:"__onScrollDownMouseleave"}]},__onMousemove:function(d,e){if(d.x!=e.screenX||d.y!=e.screenY)d.x=e.screenX,d.y=e.screenY,this.$el.focus(),this.setActiveElement($(e.target))},__onBlur:function(d){this.$el.removeClass("is-open")},__onMouseenterLabel:function(d){this.$(".is-selected").removeClass("is-selected")},initialize:function(d){this.$select=IMVU.requireProperty(d,"$replaceElement");if(!this.$select.is("select"))throw Error("$replaceElement must be a <select> element. got: "+this.$select[0].tagName);if(this.$select.closest("label").length)throw Error("do not wrap custom dropdowns with <label> tags; it disrupts event handling");a.prototype.initialize.call(this,d);this.window=d.window;this.timer=d.timer;this.boundingBox=d.boundingBox||this.getDefaultBoundingBox();this.document=d.document||document;this.__keyArray=[];if(this.dismissOnScroll=d.dismissOnScroll)$(d.dismissOnScroll).on("scroll.dropdown",function(){this.__hide()}.bind(this));$(".dropdown-layer").length||$("body").append('<div class="dropdown-layer"/>');this.$dropdownLayer=$(".dropdown-layer");d.dimNoValue&&this.$el.addClass("dim-no-value");d.lightText&&this.$el.addClass("light-text");d.hideArrow&&this.$el.addClass("hide-arrow");this.$el.data("dropdown-instance",this);this.addToDOM()},delete:function(){this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray);this.dismissOnScroll&&$(this.dismissOnScroll).off("scroll.dropdown");$(this.window).off("resize.dropdown");a.prototype.delete.call(this)},__onHidden:function(){this.$el.is(":visible")&&this.remove();a.prototype.__onHidden.apply(this,arguments)},getDefaultBoundingBox:function(){var d=this.$el.position().top-5*this.ITEM_HEIGHT,e=d+11*this.ITEM_HEIGHT;0>d&&(d=0);e>$(this.window).height()&&(e=$(this.window).height());return{x:0,y:d,w:$(this.window).width(),h:e-d}},render:function(){this.$placeholder=$("<div/>");this.$el.html(h.template);this.$label=this.$(".dropdown-label");this.$optionList=this.$(".dropdown-option-list");this.$optionListContainer=this.$(".dropdown-option-list-container");var d=this.$optionList.find(".dropdown-option");this.$select.addClass("is-enhanced");this.refreshLabel(this.$select.find(":selected"));d.remove();this.$select.children().each(function(e,f){e=d.clone(!0);e.text($(f).text());e.attr("data-text",$(f).text().toLowerCase());e.attr("data-value",$(f).val());this.$optionList.append(e)}.bind(this));this.$el.addClass(this.$select[0].className).removeClass("dropdown-template").addClass("dropdown");this.$label.append(this.$select);this.$el.attr("tabindex",this.$select.attr("tabindex")||"0");this.$select.attr("tabindex",-1);this.$optionList.on("scroll",this.__onScroll.bind(this));this.$select.on("change",this.__changedOption.bind(this));this.$el.addClass("is-ready")},__fullHeight:function(){return this.$select.children().length*this.ITEM_HEIGHT},__getSelectedIndex:function(){return this.$select[0].selectedIndex},__getTopEdgeInViewport:function(d){return d.offset().top-$(this.document).scrollTop()},__getComputedInfo:function(){var d=this.__getTopEdgeInViewport(this.$el),e=this.__fullHeight(),f=this.__getSelectedIndex()*this.ITEM_HEIGHT,g=this.getDefaultBoundingBox().y,k=this.getDefaultBoundingBox().y+this.getDefaultBoundingBox().h,l=d-f,n=l+e;l<g&&(l=g);if(n>k){var p=n-k;n=k;l>g&&(l-=Math.min(l-g,p))}return{projectedTopDiff:l-d,computedHeight:n-l,selectedTop:f,maxTop:g,maxBottom:k,fullHeight:e}},__refreshScrollers:function(){var d=this.$optionList[0].scrollHeight-this.$optionList.innerHeight(),e=0<this.$optionList.scrollTop();d=Math.round(this.$optionList.scrollTop())<d;this.$el.toggleClass("can-scroll-up",e).toggleClass("can-scroll-down",d)},isOpen:function(){return this.$el.hasClass("is-open")},__hide:function(){this.isOpen()&&($(this.window).off("resize.dropdown"),this.$el.removeClass("is-open"),this.$placeholder.before(this.$el).detach(),this.$el.removeAttr("style"))},__show:function(){if(!this.isOpen()){$(this.window).on("resize.dropdown",b);var d=this.$el.offset(),e=this.$el.width(),f=this.$el.height(),g=this.$el.css("margin-left"),k=this.$el.css("margin-right"),l=this.$el.css("margin-top"),n=this.$el.css("margin-bottom"),p=this.$el.css("float");this.$placeholder.css({width:e,height:f,"margin-left":g,"margin-right":k,"margin-top":l,"margin-bottom":n,float:p});this.$el.addClass("is-open").css({top:this.__getTopEdgeInViewport(this.$el),left:d.left,width:e,height:f,"margin-left":0,"margin-right":0,"margin-top":0,"margin-bottom":0});this.$el=this.$el.before(this.$placeholder).detach();this.$dropdownLayer.append(this.$el)}},toggleOpen:function(d){this.isOpen()?this.__hide():(this.__show(),d=this.__getComputedInfo(),this.$optionListContainer.css({top:d.projectedTopDiff,height:d.computedHeight}),this.$el.focus(),d=d.selectedTop+d.projectedTopDiff,this.$optionList.scrollTop(d),this.__lastScrollTop=d,this.setActiveElement(this.$(".dropdown-option").eq(this.__getSelectedIndex())),this.__refreshScrollers());return!1},refreshLabel:function(d){this.$label.find("> span").text(d.text()).toggleClass("no-value",""===d.val())},clickOption:function(d){this.__hide();this.$select.val($(d.target).attr("data-value"));this.$select.trigger("change");b(d)},selectByValue:function(d){this.$(".is-selected").removeClass("is-selected");this.$('.dropdown-option[data-value="'+d+'"]').addClass("is-selected");this.$("select").val(d);d=this.$("select").find(":selected");this.refreshLabel(d)},val:function(){return this.$("select").val()},__changedOption:function(d){d=$(d.target).find(":selected");this.refreshLabel(d)},__maybeScrollOptionIntoView:function(d,e){if(d[0]){var f=this.$el.hasClass("can-scroll-up"),g=this.$el.hasClass("can-scroll-down"),k=this.$optionList,l=k.height(),n=k.offset().top,p=n+l,q=d.outerHeight();d=d.offset().top;var t=d+q,r=d-n+k.scrollTop(),u=l/2-q/2*3;d<n+(f?q:0)?(e&&(r-=u),k.scrollTop(r-(f?this.ITEM_HEIGHT:0))):t>p-(g?q:0)&&(e&&(r+=u),k.scrollTop(r-(l-q)+(g?q:0)))}},__open:function(d){this.isOpen()&&this.$select.val(this.$optionList.find(".is-selected").attr("data-value")).change();this.toggleOpen(d);d=this.$optionList.children().eq(this.$select[0].selectedIndex);h.NextUtil.DomHelper.radioClass(d,"is-selected");return d},__moveSelection:function(d){d=this.$optionList.children().index(this.$optionList.find(".is-selected"))+d;0>d?d=0:d>this.$select.children().length-1&&(d=this.$select.children().length-1);d=this.$optionList.children().eq(d);h.NextUtil.DomHelper.radioClass(d,"is-selected");return d},setActiveElement:function(d){this.__activeElement=d;h.NextUtil.DomHelper.radioClass(d,"is-selected")},__onKeydown:function(d,e){if(!this.isOpen()&&c.is(e,"VK_ENTER")||!this.isOpen()&&c.is(e,"VK_DOWN"))b(this.$el),this.__open(e);else{var f=this.__activeElement&&this.__activeElement.parent()[0]===this.$optionList[0]?this.__activeElement:this.$(".dropdown-option").first();if(c.is(e,"VK_DOWN"))this.__maybeScrollOptionIntoView(f.next()),f.next()[0]&&this.setActiveElement(f.next());else if(c.is(e,"VK_UP"))this.__maybeScrollOptionIntoView(f.prev()),f.prev()[0]&&this.setActiveElement(f.prev());else if(c.is(e,"VK_ENTER"))this.__hide(),this.$select.val(this.__activeElement.attr("data-value")),this.$select.trigger("change"),b(e);else if(c.is(e,"VK_ESC"))b(this.$el);else{var g=c.getAlphaNumericChar(e);if(!1!==g){var k=f[0];this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray);d.push(g);g=d.join("").toLowerCase();for(this.__keyValueArray=this.timer.setTimeout(function(){d.length=0}.bind(this),1e3);k.nextSibling;){k=k.nextSibling;var l=$(k);if(l.attr("data-text")[0]&&h.NextUtil.string.startsWith(l.attr("data-text"),g)){this.isOpen()||this.toggleOpen(e);this.setActiveElement(l);this.__maybeScrollOptionIntoView(l,l[0]!=f[0].nextSibling&&l[0]!=f[0].prevSibling);return}}for(k=this.$(".dropdown-option")[0];k&&k!=f[0];){l=$(k);if(l.attr("data-text")[0]&&h.NextUtil.string.startsWith(l.attr("data-text"),g)){this.isOpen()||this.toggleOpen(e);this.setActiveElement(l);this.__maybeScrollOptionIntoView(l,l[0]!=f[0].nextSibling&&l[0]!=f[0].prevSibling);break}k=k.nextSibling}}}}},__onScroll:function(d){d=this.$optionList.scrollTop();this.__refreshScrollers();this.__lastScrollTop=d},__doScrollUp:function(d,e){d=this.__getComputedInfo();var f=void 0===e?this.AUTO_SCROLL_BY:e;this.$optionListContainer.offset().top+this.$optionListContainer.height()+f<d.maxBottom?(e=this.$optionListContainer.height()+f,e>d.fullHeight&&(e=d.fullHeight),this.$optionListContainer.css({height:e}),this.$optionList[0].scrollTop-=f,this.__refreshScrollers(this.$dropdown)):void 0===e&&(this.$optionList[0].scrollTop-=this.AUTO_SCROLL_BY)},__onScrollUpMouseenter:function(d){this.timer.clearInterval(this.__autoScrollInterval);this.__autoScrollIntervalCounter=0;this.__autoScrollInterval=this.timer.setInterval(function(){this.__doScrollUp(d)}.bind(this),1)},__onScrollUpMouseleave:function(d){this.timer.clearInterval(this.__autoScrollInterval)},__doScrollDown:function(d,e){d=this.__getComputedInfo();var f=void 0===e?this.AUTO_SCROLL_BY:e;if(this.$optionListContainer.offset().top-f>d.maxTop){var g=this.$optionListContainer.height()+f;e=this.$optionListContainer.position().top-f;g>d.fullHeight?g=d.fullHeight:this.$optionListContainer.css({top:e});this.$optionListContainer.css({height:g});this.$optionList[0].scrollTop+=f;this.__refreshScrollers(this.$dropdown)}else void 0===e&&(this.$optionList[0].scrollTop+=this.AUTO_SCROLL_BY)},__onScrollDownMouseenter:function(d){this.timer.clearInterval(this.__autoScrollDownInterval);this.__autoScrollDownIntervalCounter=0;this.__autoScrollDownInterval=this.timer.setInterval(function(){this.__doScrollDown(d)}.bind(this),1)},__onScrollDownMouseleave:function(d){this.timer.clearInterval(this.__autoScrollDownInterval)}})}({NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],template:aa}),ba=function(h){var b=h.Dialogs.AlloyModalDialog;return b.extend("EditProfileDialog",{uiContextName:"edit_profile_dialog",className:"edit-profile-dialog dialog-type-B",dependencies:"dialogManager featureAccessManager globalStringManager loginManager platform prefsManager Promise urlManager".split(" "),trackedEvents:function(){return[{type:"change",selector:".change-profile-image-input",name:"change_profile_image",handler:this.__changeProfileImage},{type:"click",selector:"button.submit",name:"submit",handler:this.__submitChanges},{type:"click",selector:"button.cancel",name:"cancel",handler:this.__cancel},{type:"change",selector:"#country",name:"country",handler:this.__handleCountryChange},{type:"change",selector:"#state",name:"state",handler:this.__handleFieldChange},{type:"click",selector:"#location",name:"location",handler:this.__showLocationDropdown},{type:"change",selector:"#gender",name:"gender",handler:this.__handleFieldChange},{type:"change",selector:"#looking_for",name:"looking_for",handler:this.__handleFieldChange},{type:"change",selector:"#relationship_status",name:"relationship_status",handler:this.__handleFieldChange},{type:"input",selector:"#display_name",name:"display_name",handler:this.__handleFieldChange,repeats:1},{type:"input",selector:"#interests",name:"interests",handler:this.__handleFieldChange,repeats:1},{type:"input",selector:"#tagline",name:"tagline",handler:this.__handleFieldChange,repeats:1},{type:"change",selector:"input[data-pref]",name:"preference",handler:this.__handleFieldChange,attributes:function(a){return{pref:a.data("pref")}}}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__stringManager=a.globalStringManager;this.__myself=a.loginManager.getCurrentUser();this.__curtainDelay=a.curtainDelay||700;this.__initialUserData={};this.__initialUserPrefs={};this.title=this.__stringManager.get("dialog_edit_profile_title");this.userFieldsToPopulate="country state gender looking_for relationship_status tagline".split(" ");this.addToDOM()},postRender:function(){this.setContent("body",h.template({age_description:this.__globalStringManager.get("age_description",{age:this.__myself.get("age")}),is_creator:this.__myself.get("is_creator"),helpUrl:this.__urlManager.get("imvu_help")}));this.$(".profile").scrollbar();this.__setupDropDowns();h.NextUtil.DomHelper.enhanceTextarea(this.$("#tagline"),100,90);h.NextUtil.DomHelper.enhanceTextarea(this.$("#interests"),255,90);h.NextUtil.DomHelper.enhanceTextarea(this.$("#display_name"),30,40);this.setContent("footer",this.$(".dialog-footer-template").text());this.__uploadCurtain=this.createChildContext(h.UploadCurtain,{$parentElement:this.$el,completeDelay:this.__curtainDelay});this.__postRenderCompletePart1Resolver=null;this.__postRenderCompletePart1Promise=new this.__Promise(function(a){this.__postRenderCompletePart1Resolver=a}.bind(this));this.__postRenderCompletePart2Resolver=null;this.__postRenderCompletePart2Promise=new this.__Promise(function(a){this.__postRenderCompletePart2Resolver=a}.bind(this));this.__myself.populated().then(function(){this.__profileIcon=this.createChildContext(h.WAFWidgets.ProfileIcon,{$replaceElement:this.$(".profile-icon-placeholder"),user:this.__myself});this.__myself.get("is_adult")||this.$("#display-age-toggle").closest("fieldset").remove();this.$(".age").text(this.__myself.get("age"));this.__populateUserFields();this.__handleCountryChange();this.__toggleHasChanges(!1);this.__postRenderCompletePart1Resolver.resolve()}.bind(this));this.__prefsManager.populated().then(function(){this.__populatePrefs();this.__toggleHasChanges(!1);this.__postRenderCompletePart2Resolver.resolve()}.bind(this));this.__Promise.every([this.__postRenderCompletePart1Promise,this.__postRenderCompletePart2Promise]).then(function(){}.bind(this))},__populatePrefs:function(){this.$("input[data-pref]").each(function(a,c){a=$(c);c=a.attr("data-pref");var d=this.__prefsManager.getBool(c,!!a.attr("data-pref-default"));a.attr("data-pref-invert")&&(d=!d);a.prop("checked",d);this.__initialUserPrefs[c]=d}.bind(this))},__populateUserFields:function(){_.each(this.userFieldsToPopulate,function(a){var c=this.__myself.get(a);""!==c&&(this.$("select#"+a).val(c).trigger("change"),this.__initialUserData[a]=c)}.bind(this));this.__initialUserData.username=this.__myself.get("username");this.__initialUserData.country=this.__myself.get("country");this.__initialUserData.state=this.__myself.get("state");this.$("#username").text(this.__initialUserData.username.replace("Guest_","")).trigger("input");this.$("#location").text(this.__initialUserData.country+(this.__initialUserData.state?" - "+this.__initialUserData.state:""));_.each(["display_name","interests","tagline"],function(a){""!==this.__myself.get(a)?(this.__initialUserData[a]=this.__myself.get(a),this.$("#"+a).val(this.__initialUserData[a]).trigger("input")):this.__initialUserData[a]=""}.bind(this))},__setupDropDowns:function(){_.each(this.userFieldsToPopulate,function(a){var c=this.$("select#"+a);c.length&&(_.each(h.profileJSON[a],function(d,e){var f=this.$(".dropdown-item").clone().removeClass("hidden dropdown-item");c.append(f.attr("value",e).text(this.__globalStringManager.getWithDefault(d,d||"")))}.bind(this)),this.createChildContext(h.Dropdown,{$replaceElement:c,dismissOnScroll:this.$(".profile"),lightText:!0,hideArrow:!0}))}.bind(this))},__getFormValues:function(){var a={gender:this.$("#gender").val(),country:this.$("#country").val(),relationship_status:this.$("#relationship_status").val(),looking_for:this.$("#looking_for").val(),interests:this.$("#interests").val(),tagline:this.$("#tagline").val(),display_name:this.$("#display_name").val()};this.__countryIsUSA()&&(a.state=this.$("#state").val());return a},__getFormPrefs:function(){var a=[];document.querySelectorAll("input[data-pref]").forEach(function(c){var d=c.getAttribute("data-pref");c=c.getAttribute("data-pref-invert")?!c.checked:c.checked;a[d]=c});return a},__getChanges:function(a,c){var d={};Object.keys(c).forEach(function(e){var f=c[e]||"",g=a[e]||"";typeof g!==typeof f&&(g=g.toString(),f=f.toString());f!==g&&(d[e]=f)});return d},__changeProfileImage:function(a){this.__dialogManager.showDialog(h.EditProfileImageDialog,{file:a.target.files[0]});this.$(".customProfileImage")[0].reset()},__collectChanges:function(){var a=this,c=[],d=this.__getChanges(this.__initialUserData,this.__getFormValues());0!==Object.keys(d).length&&(c=[this.__myself.save(d,{error:this.__myself.invalidate.bind(this.__myself)})]);var e=this.__getChanges(this.__initialUserPrefs,this.__getFormPrefs());0!==Object.keys(e).length&&Object.keys(e).forEach(function(f){c.push(a.__prefsManager.setBool(f,e[f]))});return c},__submitChanges:function(){var a=this;this.__removeMultipleConsecutiveSpaces(this.$("#display_name"));this.__uploadCurtain.show();var c=this.__collectChanges();0<c.length&&this.__Promise.every(c).then(function(){a.__toggleHasChanges(!1);a.__uploadCurtain.complete();a.__myself.get("is_creator")&&a.__myself.getSingleEdge("creator_details").invalidate();a.__myself.invalidate()}).catch(function(d){var e=a.__stringManager.get("dialog_generic_save_error_text"),f={minimum:"1",maximum:"30"},g="msg_blank msg_display_name_not_string msg_display_name_length msg_display_name_inappropriate msg_display_name_registered msg_display_name_wrapping_spaces msg_display_name_at_sign msg_display_name_persona msg_display_name_multiple_spaces".split(" ");d.message&&-1<g.indexOf(d.message)&&(e=a.__stringManager.get("edit_profile_error_"+d.message,f));a.__uploadCurtain.hide();a.__dialogManager.alert({title:a.__stringManager.get("dialog_generic_save_error_title"),text:e,ok:a.__stringManager.get("dialog_generic_save_error_ok")})});this.close()},__toggleHasChanges:function(a){this.$("button.submit").prop("disabled",!a)},__handleFieldChange:function(){""!==this.$("#display_name").val()?this.__toggleHasChanges(!0):this.$("button.submit").prop("disabled",!0)},__removeMultipleConsecutiveSpaces:function(a){a.val(a.val().replace(/\s\s+/g," "))},__cancel:function(){this.close();this.promiseResolver.reject()},__countryIsUSA:function(){return"US"===this.$("#country").val()},__handleCountryChange:function(){this.$(".edit-profile-attribute.state").toggleClass("not-applicable",!this.__countryIsUSA());this.__handleFieldChange()},__showLocationDropdown:function(){this.$("#location").toggleClass("hidden",!0);this.$(".location-container").toggleClass("hidden",!1)}})}({Dialogs:m["@Dialogs"],NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],WAFWidgets:m["@WAFWidgets"],Dropdown:G,EditProfileImageDialog:Z,profileJSON:m["json!/common/pure/util/profile.json"],UploadCurtain:W,SaveButtonTemplate:V,template:U}),z=function(h){function b(c,d){var e=c.get("bootstrapParams").is_app;c.get("window").open(d,e?"_system":"_blank")}function a(c){return-1!==c.indexOf("iPad")||-1!==c.indexOf("iPhone")||-1!==c.indexOf("iPod")}return{openExternal:b,externalizeA:function(c,d){d=$(d);var e=d.attr("href");d.attr("href","");d.click(function(){b(c,e);return!1})},isAndroid:function(c){return-1!==c.get("window").navigator.userAgent.indexOf("Android")},isAndroidChrome:function(c){c=c.get("window").navigator.userAgent;return-1!==c.indexOf("Android")&&-1!==c.indexOf("Chrome/")&&-1===c.indexOf("Version/")},isAndroidWebApp:function(c){c=c.get("window");return-1!==c.navigator.userAgent.indexOf("Android")&&c.navigator.standalone?!0:!1},isIOS:function(c){c=c.get("window").navigator.userAgent;return a(c)},isIOSSafari:function(c){c=c.get("window").navigator.userAgent;return a(c)&&-1===c.indexOf("CriOS/")?-1!==c.indexOf("Safari/")?!0:-1!==c.indexOf("AppleWebKit/")&&-1===c.indexOf("Chrome/"):!1},getVersionIOS:function(c){c=c.get("window").navigator.userAgent;return a(c)?(c=/(iphone|ipad)(; CPU)? OS ((\d+)_(\d+)(_(\d+))?)/i.exec(c),null===c?null:{raw:c[3],major:parseInt(c[4],10),minor:parseInt(c[5],10),revision:c[7]?parseInt(c[7],10):null}):null}}}({}),ca=function(h){var b=h.UiCore.UiContext;return b.extend("TopNavBase",{className:"global-nav-base bar disable-text-selection",uiContextName:"global_nav_base",tagName:"nav",dependencies:"cookieManager dialogManager externalWindow featureAccessManager globalStringManager loginManager modeManager siteRoot storePlatform timer urlManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".clickable-logo",name:"nav_go_home",handler:this.goHome.bind(this)},{type:"click",selector:"[data-mode]",name:"mode_button",handler:this.onClickModeButton.bind(this),attributes:function(a){return{category:a.data("mode")}},allowBubble:!0},{type:"click",selector:"[data-drawer]",name:"drawer_button",handler:this.__onClickDrawerButton.bind(this),attributes:function(a){return{category:a.data("drawer")}},allowBubble:!0},{type:"click",selector:"[data-action]",name:"nav_action",handler:"onClickActionButton",attributes:function(a){return{category:a.data("action")}},allowBubble:!0}]},__actions:{profile:function(){(this.__user=this.__loginManager.getCurrentUser())&&this.__user.populated().then(function(){this.__isLoggedIn?this.__dialogManager.showLightbox("ProfileLightbox",{user:this.__user,activeChat:this.__activeChat}):this.__modeManager.openMode({mode:{id:"av"},submode:{id:this.__user.get("id")}})}.bind(this))},feedback:function(){this.__electronSensitiveWindowOpener("https://im.vu/a1_rate","_blank",void 0)},credits:function(){this.__window.open(IMVU.URI.build("/store/index/",{platform:this.__storePlatform}),"_blank")},signout:function(){this.__cookieManager.set("prefer_alloy",1);this.__cookieManager.set("alloy_landing_cookie",1);this.__loginManager.logout().then(function(){this.__window.onbeforeunload=null;this.__window.location.href=this.__siteRoot}.bind(this))},mobileapp:function(){h.MobileBrowser.isAndroid(this.__serviceProvider)?this.__window.open("https://play.google.com/store/apps/details?id=com.imvu.mobilecordova","_blank"):h.MobileBrowser.isIOS(this.__serviceProvider)?this.__window.open("https://itunes.apple.com/us/app/imvu-mobile/id919745844?mt=8","_blank"):this.__window.open("https://about.imvu.com/mobile/","_blank")},download:function(){this.__modeManager.openMode({openDefaultView:!0,mode:{id:"download"}})},helpcenter:function(){this.__electronSensitiveWindowOpener(this.__urlManager.get("imvu_help"),"_blank")},marketplace:function(){this.__electronSensitiveWindowOpener(this.__urlManager.get("vcoin_marketplace"),"_blank")},creatoreducation:function(){this.__electronSensitiveWindowOpener(this.__urlManager.get("imvu_create"),"_blank")},becomecreator:function(){this.__electronSensitiveWindowOpener(this.__urlManager.get("creator_landing"),"_blank")},adchoices:function(){this.__electronSensitiveWindowOpener(this.__urlManager.get("opt_out_third_party"),"_blank")}},setVisibility:function(a){this.$el.toggleClass("hide",!a)},initialize:function(a){var c=this;b.prototype.initialize.call(this,a);this.__perfStartTime=a.perfStartTime;this.__window=a.window;this.__externalWindow=a.externalWindow;this.__electronSensitiveWindowOpener=function(d,e,f){var g=this.__window;"_blank"===e&&(g=this.__externalWindow);g.open(d,e,f)};this.__cookieManager=a.cookieManager;this.__siteRoot=a.siteRoot;this.__modeManager=a.modeManager;this.__loginManager=a.loginManager;this.__isLoggedIn=this.__loginManager.isLoggedIn();this.__dialogManager=a.dialogManager;this.__globalStringManager=a.globalStringManager;this.__storePlatform=a.storePlatform;this.__dollarStoreCtx=null;this.__saleFlag=!1;this.__activeChat=IMVU.optionalProperty(a,"activeChat",null);this.__hasRendered=new this.__Promise(function(d){return c.__hasRenderedResolver=d});this.__featureAccessManager.isElectronClient()&&(this.__electron=this.__window.electronRequire("electron"),this.__electron.ipcRenderer.on("system-tray-signout",this.__actions.signout.bind(this)))},hasRendered:function(){return this.__hasRendered},toggleLogo:function(a){this.$(".logo").toggleClass("hidden",!a)},render:function(){throw Error("You must implement render() for your GlobalNav.")},markActiveMode:function(a){throw Error("You must implement markActiveMode() for your GlobalNav.")},goHome:function(){this.__modeManager.openMode({openDefaultView:!0,mode:{id:"home"}})},onClickModeButton:function(a){var c=$(a.currentTarget).data("mode");a=$(a.currentTarget).data("submode");var d={openDefaultView:!0,mode:{id:c}};a&&(d=_.extend(d,{openDefaultView:!1,submode:{id:a}}));"messages"===c&&(d=_.extend(d,{openDefaultView:!0,mode:{id:c}}));this.__modeManager.openMode(d)},onClickActionButton:function(a){a=$(a.currentTarget).data("action");this.__actions[a]&&this.__actions[a].call(this)},__onClickDrawerButton:function(a){throw Error("You must implement __onClickDrawerButton() if you want to use drawers in your GlobalNav.")},drillDown:function(a){},switchToOriginal:function(){this.__window.open("/switch_to/classic/","_blank")},openTermsOfService:function(){this.__modeManager.openMode({openDefaultView:!0,mode:{id:"policyhub"}})},openPeerReview:function(){this.__electronSensitiveWindowOpener(this.__urlManager.get("peer_review"),"_blank")},revealSubmodeSpecificItems:function(){this.$el.addClass("reveal-submode-specific")},setText:function(a){if(this.$el){var c=this.$(".main-nav.center-nav");c.length&&c.text(a)}},clearText:function(){this.setText("")},toggleSignupButton:function(a){this.$("button.sign-up").toggleClass("hidden",!a)},setDollarStoreContext:function(a){this.__dollarStoreCtx=a},isSale:function(){return this.__saleFlag},__subscribeToSales:function(){this.__imqManager.subscribeMessage("/user/"+this.__imqManager.config.userId,"web_msg",function(a,c){this.listenTo(c,"message",function(d){try{if("offerEnable"===d.message.substr(0,11)){var e=JSON.parse(d.message.substring(12));if(e.type&&"sale"===e.type){var f=1e3*e.duration;this.$(".urgent-offer-badge")&&this.$(".urgent-offer-badge").addClass("hidden");this.$(".sale-badge").removeClass("hidden");this.__dollarStoreCtx&&this.__dollarStoreCtx.updateSaleItems();this.__saleTimer=this.__timer.setInterval(function(){this.__timer.clearInterval(this.__saleTimer);this.$(".sale-badge").addClass("hidden")}.bind(this),f)}}}catch(g){}}.bind(this))}.bind(this))},__checkForSales:function(){this.__paymentChannels&&this.__paymentChannels.invalidate();var a=this.__globalStartupModel.get("paymentChannelNextUrl");this.__paymentChannels=this.track(this.__restModelFactory.readCollection(a,h.UiCore.NodeCollection));this.__paymentChannels.populated().then(function(){var c=null,d=_.filter(this.__paymentChannels.models,function(e){if(0<e.get("duration"))return e}.bind(this));_.isEmpty(d)||(c=_.min(d,function(e){return e.get("duration")}.bind(this)));c&&(this.$(".urgent-offer-badge")&&this.$(".urgent-offer-badge").addClass("hidden"),this.__saleFlag=!0,this.$(".sale-badge").removeClass("hidden"),c=1e3*c.get("duration"),this.__timer.setTimeout(function(){this.$(".sale-badge").addClass("hidden");this.$(".urgent-offer-badge")&&this.$(".urgent-offer-badge").removeClass("hidden");this.__saleFlag=!1}.bind(this),c))}.bind(this))}})}({UiCore:m["@UiCore"],MobileBrowser:z}),da=function(h){var b=h.GlobalNavBase;return b.extend("TopNav",{className:"global-nav bar disable-text-selection",uiContextName:"global_nav",initialize:function(a){b.prototype.initialize.call(this,a);this.__actions.edit_profile=function(){this.__dialogManager.showDialog(h.EditProfileDialog,{})};var c=this.__actions.signout;this.__actions.signout=function(){this.__serviceProvider.get("localStorage").removeItem("filterSettings");c.apply(this,arguments)}}})}({UiCore:m["@UiCore"],EditProfileDialog:ba,GlobalNavBase:ca}),ea=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){return'<div>\n    <button class="btn btn-primary add">&#10010;</button>\n    <ul class="error-emulation-list"></ul>\n</div>\n<footer class="dialog-footer">\n    <label class="write-toggle-container">\n        <input class="write-toggle" type="checkbox">\n        Write to localStorage?\n    </label>\n    <button class="btn btn-primary submit">Update</button>\n</footer>\n'},useData:!0})}({}),fa=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){return"<div class='error-emulation-fields'>\n    <button class=\"remove\">&#10006;</button>\n    <div class='error-emulation-input'>\n        <input class='error-emulation-path-match' type=\"text\" minlength=1 placeholder=\"Path Match\" required></input>\n    </div>\n    <div class='error-emulation-input'>\n        <input class='error-emulation-error' type=\"text\" pattern=\"\\d\\d\\d\" placeholder=\"Error\" required></input>\n    </div>\n    <div class='error-emulation-input'>\n        <input class='error-emulation-message' type=\"text\" minlength=1 placeholder=\"Message\" required></input>\n    </div>\n    <button class=\"update\" disabled>&#10004;</button>\n    <div class='query-match-arrow'>\n        <div class='query-match-closed'>&#8963;</div>\n        <div class='query-match-opened hidden'>&#8964;</div>\n    </div>\n</div>\n<div class='query-match-container hidden'>\n</div>\n"},useData:!0})}({}),ha=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){return'<button class="btn btn-primary add">&#10010;</button>\n<ul class="query-match-list"></ul>\n'},useData:!0})}({}),ia=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){return'<input type="text" minlength=1 placeholder="Key" required></input>\n<button class="remove">&#10006;</button>\n'},useData:!0})}({}),ja=function(h){var b=h.UiCore.UiContext;return b.extend("QueryMatchItem",{className:"query-match-item",uiContextName:"query_match_item",trackedEvents:function(){return[{type:"click",selector:"button.remove",name:"remove",handler:"__remove"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__matchItem=a.matchItem||"";this.addToDOM()},render:function(){this.$el.html(h.template);this.__matchItem&&this.$("input").val(this.__matchItem);this.$("input").on("change",this.__updateItem.bind(this))},getModel:function(){return this.$("input").is(":valid")?this.__matchItem=this.$("input").val():null},__updateItem:function(a){this.$("input").is(":valid")&&"change"===a.type&&(this.__matchItem=this.$("input").val(),this.trigger("update",this))},__remove:function(){this.trigger("remove",this)}})}({UiCore:m["@UiCore"],template:ia}),ka=function(h){var b=h.UiCore.UiContext;return b.extend("QueryMatch",{className:"query-match",uiContextName:"query_match",trackedEvents:function(){return[{type:"click",selector:"button.submit",name:"submit",handler:"__submitChanges"},{type:"click",selector:"button.add",name:"add",handler:"__addItem"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__queryMatch=a.queryMatch||[];this.addToDOM()},render:function(){this.$el.html(h.template);_.each(this.__queryMatch,function(a){this.__addItem(null,a)}.bind(this))},getModel:function(){return 0<this.__queryMatch.length?this.__queryMatch:null},__addItem:function(a,c){c=c||"";a=this.createChildContext(h.QueryMatchItem,{$parentElement:this.$(".query-match-list"),matchItem:c});this.listenTo(a,"remove",this.__removeItem.bind(this));this.listenTo(a,"update",this.__submitChanges.bind(this))},__removeItem:function(a){a.delete();this.__submitChanges()},__submitChanges:function(a){this.__queryMatch=_.filter(_.map(this.children(),function(c){return c.getModel()}.bind(this)),function(c){return null!==c}.bind(this));this.trigger("change",this)}})}({UiCore:m["@UiCore"],QueryMatchItem:ja,template:ha}),la=function(h){var b=h.UiCore.UiContext;return b.extend("ErrorEmulationItem",{className:"error-emulation-item",uiContextName:"error_emulation_item",dependencies:["model"],trackedEvents:function(){return[{type:"click",selector:"button.update",name:"update",handler:"__updateChanges"},{type:"click",selector:"button.remove",name:"remove",handler:"__remove"},{type:"click",selector:".query-match-arrow",name:"toggle_query_match",handler:"__toggleQueryMatch"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__dirty=!0;this.addToDOM()},render:function(){this.$el.html(h.template);this.__queryMatchList=this.createChildContext(h.QueryMatch,{$parentElement:this.$(".query-match-container"),queryMatch:this.__model.queryMatch||[]});this.$(".error-emulation-path-match").val(this.__model.pathMatch);this.$(".error-emulation-error").val(this.__model.error);this.$(".error-emulation-message").val(this.__model.message);this.__validate()&&(this.__dirty=!1,this.$("button.update").prop("disabled",!0));this.$("input").on("change",this.__validate.bind(this));this.listenTo(this.__queryMatchList,"change",this.__updateChanges.bind(this))},isDirty:function(){return this.__dirty},getModel:function(){return this.__updateChanges()?this.__model:null},__validate:function(){this.__dirty=!0;this.trigger("update",this);var a=this.$("input:valid").length===this.$("input").length;this.$("button.update").prop("disabled",!a);return a},__updateChanges:function(){if(this.__validate()){this.__model.pathMatch=this.$(".error-emulation-path-match").val();this.__model.error=this.$(".error-emulation-error").val();this.__model.message=this.$(".error-emulation-message").val();var a=this.__queryMatchList.getModel();a?this.__model.queryMatch=a:delete this.__model.queryMatch;this.__dirty=!1;this.$("button.update").prop("disabled",!0);this.trigger("update",this);return!0}return!1},__remove:function(){this.trigger("remove",this)},__toggleQueryMatch:function(){this.$(".query-match-closed").toggleClass("hidden");this.$(".query-match-opened").toggleClass("hidden");this.$(".query-match-container").toggleClass("hidden")}})}({UiCore:m["@UiCore"],QueryMatch:ka,template:fa}),ma=function(h){var b=h.UiCore.UiContext;return b.extend("InsertErrorEmulation",{className:"insert-error-emulation",uiContextName:"insert_error_emulation",dependencies:["localStorage","rest"],trackedEvents:function(){return[{type:"click",selector:"button.submit",name:"submit",handler:"__submitChanges"},{type:"click",selector:"button.add",name:"add",handler:"__addItem"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__emulation=this.__rest.getErrorEmulation();this.addToDOM()},render:function(){this.$el.html(h.template);_.each(this.__emulation,function(a){this.__addItem(null,a)}.bind(this));this.__validateItems();this.__toggleSubmitButton(!0);this.$(".write-toggle").on("click",function(){this.$(".write-toggle").is(":checked")&&this.__toggleSubmitButton(!1)}.bind(this))},__addItem:function(a,c){c=c||{};a=this.createChildContext(h.ErrorEmulationItem,{$parentElement:this.$(".error-emulation-list"),model:c});this.listenTo(a,"remove",this.__removeItem.bind(this));this.listenTo(a,"update",this.__updateItem.bind(this));this.__updateItem(a)},__validateItems:function(){if(0<this.children().length){var a=_.filter(this.children(),function(c){return c.isDirty()}.bind(this));this.__toggleSubmitButton(0!==a.length)}else this.__toggleSubmitButton(!1)},__removeItem:function(a){a.delete();this.__validateItems()},__updateItem:function(a){this.__validateItems()},__submitChanges:function(){this.__emulation=_.filter(_.map(this.children(),function(a){return a.getModel()}.bind(this)),function(a){return null!==a}.bind(this));this.__toggleSubmitButton(!0);0<this.__emulation.length?(this.__rest.setErrorEmulation(this.__emulation),this.__serviceProvider.register("emulateNetworkError",this.__emulation),this.$(".write-toggle").is(":checked")&&this.__localStorage.setItem("emulateNetworkError",JSON.stringify(this.__emulation))):(this.__rest.clearErrorEmulation(),this.__serviceProvider.register("emulateNetworkError",null),this.$(".write-toggle").is(":checked")&&this.__localStorage.removeItem("emulateNetworkError"))},__toggleSubmitButton:function(a){void 0===a&&(a=!this.$("button.submit").prop("disabled"));this.$("button.submit").prop("disabled",a)}})}({UiCore:m["@UiCore"],ErrorEmulationItem:la,template:ea}),na=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){return"<div class='insert-error-emulation-placeholder'></div>\n"},useData:!0})}({}),oa=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(b,a,c,d){return""},3:function(b,a,c,d){return" no-header"},5:function(b,a,c,d){var e,f=a.helperMissing;c='\n            <div class="wh-20">';if((a=(e=a.icon||b&&b.icon||f,e.call(b,"icon-chatwindow_close",{name:"icon",hash:{class:"wh-full"},data:d})))||0===a)c+=a;return c+"</div>\n        "},7:function(b,a,c,d){var e,f=a.helperMissing;c='\n            <div class="wh-20">';if((a=(e=a.icon||b&&b.icon||f,e.call(b,"icon-dialog_close",{name:"icon",hash:{class:"wh-full"},data:d})))||0===a)c+=a;return c+"</div>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e;c=a.helperMissing;var f=this.escapeExpression,g='<div class="dialog-container ',k=a["if"].call(b,b&&b.headerIsVisible,{name:"if",hash:{},fn:this.program(1,d),inverse:this.program(3,d),data:d});if(k||0===k)g+=k;g+='">\n    <a href="#" class="dialog-x">\n        ';if((k=(e=a.platform||b&&b.platform||c,e.call(b,"mobile",{name:"platform",hash:{},fn:this.program(5,d),inverse:this.program(7,d),data:d})))||0===k)g+=k;return g+'\n    </a>\n    <header class="dialog-header">\n        <h3 class="dialog-title nowrap">'+f((e=a.title||b&&b.title,"function"===typeof e?e.call(b,{name:"title",hash:{},data:d}):e))+'</h3>\n    </header>\n    <div class="aux-header"></div>\n    <section class="dialog-body"></section>\n    <footer class="dialog-footer"></footer>\n</div>\n'},useData:!0})}({}),H=function(h){var b=h.UiCore.UiContext;return b.extend("UIContextExtension",{dependencies:"browserInfo currentLocale featureAccessManager loginManager timestampHelper window".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__appMonitor=null;this.__browserInfo=a.browserInfo;this.__featureAccessManager=a.featureAccessManager;this.__loginManager=a.loginManager;this.__timestampHelper=a.timestampHelper;this.__currentLocale=this.__currentLocale||"en";this.__currentLocale="www"===this.__currentLocale?"en":this.__currentLocale;this.serviceProvider=a.serviceProvider;this.__userIsLoggedIn=this.__loginManager.isLoggedIn();this.__myCid=0;this.__userIsLoggedIn&&(this.__myself=this.__loginManager.getCurrentUser(),this.__loginType=this.__loginManager.getLoginType(),this.__myself.populated().then(function(){this.__myCid=this.__myself.get("legacy_cid");if("string"===typeof this.__myCid)if(/^\d+$/.test(this.__myCid))this.__myCid=parseInt(this.__myCid);else{if(!this.__appMonitor&&this.serviceProvider.has("appMonitor")){var c=this.serviceProvider.get("appMonitor");c&&(this.__appMonitor=c)}this.__appMonitor?this.__appMonitor.reportCustomError("UIContextExtension","initialize","web_perm_0017","Bad CID detected",["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]):this.__window.appMonitorPending.push(["UIContextExtension","initialize","web_perm_0017","Bad CID detected",["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]]);this.__myCid=0}this.__myCid=this.__myCid?this.__myCid:0;this.__myCountry=this.__myself.get("country")}.bind(this)));this.__perfReportManager=this.serviceProvider.get("perfReportManager");this.__perfReportManager.setUIContext(this)},getActivityGroupID:function(){return this.__activityGroup.id},getClientSessionID:function(){},packageAppDeviceData:function(){var a=this.__browserInfo.getPlatformData();return{is_test_data:String(this.__window.location).includes("localhost")?"test":"production",app_instance_id:a.appInstanceID,device_platform:a.devicePlatform,device_model:a.deviceModel,app_version:a.appVersion,customer_id:this.__myCid}},__packageEventData:function(a,c){var d=this.__timestampHelper.now().unix().toString();return _.extend({event:null,event_class:null,event_transaction_id:c,event_timestamp:d,event_source:"user",event_reason:null,location:null},a)},__packageTaxonomyData:function(a,c){return{payload_format:"taxonomy",taxonomy:{tenant_id:"IMVU",schema_version:1,app_device_data:this.packageAppDeviceData(),event_data:this.__packageEventData(a,c)}}},__recordTaxonomyEvent:function(a,c){var d=h.NextUtil.DomHelper.createGUID();a=this.__packageTaxonomyData(a,d);this.__recordEvent("taxonomy",a,c||"","soma_taxonomy");return d},recordSentWhisper:function(a){return this.__recordTaxonomyEvent({event:"whisper_sent",event_class:"chat",event_reason:"click",string_one:navigator.language,integer_one:a.receiverCid,integer_two:a.senderVipStatus,integer_three:a.receiverVipStatus,location:a.location,level_one:a.roomType,level_two:a.roomId,level_three:a.startOrReply,client_ip:a.clientIp})},recordShowTieredVipUpsell:function(a){return this.__recordTaxonomyEvent({event:"vip_upsell",event_class:"vip",event_reason:"click",string_one:navigator.language,string_two:a.vipTriggerLocation,event_source:"user",location:a.vipTrigger,user_agent:navigator.userAgent,client_ip:a.clientIp})},recordYouTubePlaylistClick:function(a){var c=a.playlistId;c.includes("list=")&&(c=c.split("list=")[1]);return this.__recordTaxonomyEvent({event:"youtube_imvu_curated_playlist_started",event_class:"youtube",event_reason:"click",string_one:c,client_ip:a.clientIp})},recordYouTubeSearch:function(a){return this.__recordTaxonomyEvent({event:"youtube_video_search",event_class:"youtube",event_reason:"click",string_one:a.searchString,client_ip:a.clientIp})},recordGuestExperiencesYouTube:function(a){var c=parseInt(a.hostCid.match(/\d+$/)[0],10);return this.__recordTaxonomyEvent({event:"youtube_video_viewed_by_non_host",event_class:"youtube",event_reason:a.alreadyPlaying?"playing":"started",integer_one:c,level_one:a.roomId,client_ip:a.clientIp})},recordProductTaxonomyEvent:function(a,c){a=a.get("product_id");if("number"!==typeof a||0>=a)return null;c.systemError=""===c.systemError?null:c.systemError;var d=a.toString(),e={event:IMVU.requireProperty(c,"event"),event_class:IMVU.requireProperty(c,"eventClass"),event_reason:IMVU.requireProperty(c,"eventReason"),location:IMVU.requireProperty(c,"location"),string_one:IMVU.requireProperty(c,"status")};"product_purchased"===c.event?(e.string_two=IMVU.requireProperty(c,"currencyType"),e.string_three=IMVU.requireProperty(c,"systemError"),e.string_four=this.__loginType,e.string_five=this.__getLanguangeSetting()):(e.string_two=IMVU.requireProperty(c,"systemError"),e.integer_one=a);return this.__recordTaxonomyEvent(e,d)},recordPerformanceTaxonomyEvent:function(a,c,d){if(-1===this.__perfReportManager.getBudget(a))return this.__window.console.error("UIContextExtension::recordPerformanceTaxonomyEvent - tage("+String(a)+") not recognized"),null;var e=this.__perfReportManager.getBudget(a);d=d||{};d.submode="__default__"===d.submode?"default":d.submode;var f=IMVU.optionalProperty(d,"northstar",null);f=f?JSON.stringify(f):"";var g=this.__serviceProvider.get("systemMetrics");g=g?JSON.stringify(g):"";var k=this.__featureAccessManager.getMarketingPlatform(),l=this.__serviceProvider.get("appVersion"),n=0,p=0,q=0;"@DEV"===l?k="desktop-client-dev":l&&(k="desktop-client-"+l,q=l.split("."),n=parseInt(q[0]),p=parseInt(q[1]),q=parseInt(q[2]));l=this.__serviceProvider.get("appName");a=a+"__"+k+"__"+l+"__"+(d.type+"_Mode-"+d.mode+"_Submode-"+d.submode);k=-1;"undefined"===typeof d.sessionDuration?this.__window.console.error("UiContextExtension::recordPerformanceTaxonomyEvent - Event data missing sessionDuration"):k=d.sessionDuration;return this.__recordTaxonomyEvent({event:"performance",event_class:"measurement",event_reason:"dna",location:"dna",decimal_one:e,decimal_two:c,string_one:a,string_two:f,string_three:g,integer_one:n,integer_two:p,integer_three:q,integer_four:k},"")},__getLanguangeSetting:function(){return this.__currentLocale+"-"+this.__myCountry}})}({NextUtil:m["@NextUtil"],UiCore:m["@UiCore"]}),pa=function(h){var b=h.UIContextExtension;return b.extend("AlloyModalDialog",{uiContextName:"modal_dialog_alloy",className:"alloy-modal-dialog",dependencies:["appMonitor","globalStringManager","nextRoot","Promise","window"],hasCloseButton:!0,headerIsVisible:!0,contentAreas:{header:".dialog-header",auxHeader:".aux-header",body:".dialog-body",footer:".dialog-footer"},initialize:function(a){b.prototype.initialize.call(this,a);"undefined"!==typeof a.hasCloseButton&&(this.hasCloseButton=a.hasCloseButton);"undefined"!==typeof a.headerIsVisible&&(this.headerIsVisible=a.headerIsVisible);this.serviceProvider=a.serviceProvider;this.__appMonitor=a.appMonitor;this.dialogManager=a.dialogManager;this.__stringManager=a.globalStringManager;this.__nextRootBase=this.__nextRoot.replace("/next/","");this.__postToParent="undefined"===typeof a.postToParent?!0:a.postToParent;this.canCloseWithOverlayClick=IMVU.optionalProperty(a,"canCloseWithOverlayClick",!0);this.__appMonitor.waypoint("AlloyModalDialog::initialize:"+this.constructor.name);this.finished=new a.Promise(function(c){this.promiseResolver=c}.bind(this));this.shouldFocusOnPrimaryButton=!0;a=this.delete.bind(this);this.finished.then(a,a);this.$el.attr("data-ui-role","modal-dialog");this.$el.on("focusin",function(c){this.$el.closest("html").addClass("dialog-focused")}.bind(this));this.$el.on("focusout",function(c){this.$(c.target).closest(".dropdown").length||this.$el.closest("html").removeClass("dialog-focused")}.bind(this));this.$el.trigger("focusout");this.__postToParent&&this.__window.parent&&this.__window.parent.postMessage&&this.__window.parent.postMessage({message:"opening_modal_dialog",type:this.uiContextName},"*")},render:function(){var a=this;this.doWork([function(){a.$el.html(h.template({title:a.title||"",headerIsVisible:a.headerIsVisible}));a.$(".dialog-x").on("click",a.__onClose.bind(a));a.$el.toggleClass("can-dismiss",a.hasCloseButton);a.postRender();a.$el.closest("html").attr("data-dialog",a.uiContextName);a.__focusPrimaryButton();a.$el.is(".dialog-type-B, .dialog-type-B-flexible")&&a.$el.closest("body").is(".mobile")&&470>a.$el.width()&&(a.$el.is(".text-close")?a.$(".dialog-x").text("Close"):a.$el.is(".text-done")?a.$(".dialog-x").text("Done"):a.$el.is(".text-none")?a.$(".dialog-x").text(""):a.$(".dialog-x").text("Cancel"),a.__adjustTitlePosition())}])},__adjustTitlePosition:function(){this.$(".dialog-title").removeClass("overflowed");var a=this.$(".dialog-title").width(),c=this.$(".dialog-header").width();a<=c-160?this.$(".dialog-title").toggleClass("overflowed",!1):this.$(".dialog-title").toggleClass("overflowed",!0)},linkToDetailsSubmode:function(a,c){this.serviceProvider.get("historyManager").setState({fragment:this.__urlId(c.id),mode:{id:a},submode:{id:c.id,summary:{model:c}}})&&(a=function(){this.serviceProvider.get("historyManager").silentMoveHistory(-1)}.bind(this),this.finished.then(a,a))},show:function(){this.__appMonitor.waypoint("AlloyModalDialog::show:"+this.constructor.name);b.prototype.show.call(this);this.__focusPrimaryButton()},hide:function(){this.__appMonitor.waypoint("AlloyModalDialog::hide:"+this.constructor.name);b.prototype.hide.call(this);this.$el.closest("html").removeAttr("data-dialog")},close:function(){this.__appMonitor.waypoint("AlloyModalDialog::close:"+this.constructor.name);this.hide();this.promiseResolver.reject()},closeAll:function(a){a.preventDefault();this.__recordEvent("click",{name:"dialog_close"});this.__dialogManager.closeAll()},showHeader:function(){this.headerIsVisible=!0;this.$(".dialog-container").removeClass("no-header")},hideHeader:function(){this.headerIsVisible=!1;this.$(".dialog-container").addClass("no-header")},toggleHeader:function(){this.headerIsVisible?this.hideHeader():this.showHeader()},__onClose:function(a){a.preventDefault();this.__recordEvent("click",{name:"dialog_close"});this.close()},__focusPrimaryButton:function(){if(this.shouldFocusOnPrimaryButton){var a=this.$(".btn-primary");1<a.length?a.trigger("blur"):a.first().focus()}},updateDialogTitle:function(a){this.$(".dialog-header .dialog-title").text(a);this.__adjustTitlePosition()},delete:function(){this.__appMonitor.waypoint("AlloyModalDialog::delete:"+this.constructor.name);this.__postToParent&&this.__window.parent&&this.__window.parent.postMessage&&this.__window.parent.postMessage({message:"deleting_modal_dialog",type:this.uiContextName},"*");b.prototype.delete.call(this)}})}({UiCore:m["@UiCore"],UIContextExtension:H,template:oa}),qa=function(h){var b=h.AlloyModalDialog;return b.extend("ErrorEmulationDialog",{initialize:function(a){b.prototype.initialize.call(this,a);this.title="Error Emulation";this.addToDOM()},postRender:function(){this.setContent("body",h.template);this.createChildContext(h.InsertErrorEmulation,{$replaceElement:this.$(".insert-error-emulation-placeholder")})}})}({UiCore:m["@UiCore"],AlloyModalDialog:pa,InsertErrorEmulation:ma,template:na}),ra=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(b,a,c,d){return'<span class="qa-nav-is-qa">QA</span>'},3:function(b,a,c,d){var e;c=this.escapeExpression;return' <span class="qa-nav-web-pool">'+c((e=a.qaWeb||b&&b.qaWeb,"function"===typeof e?e.call(b,{name:"qaWeb",hash:{},data:d}):e))+"</span>"},5:function(b,a,c,d){return'\n<div class="qa-nav-emulate-errors">Errors Emulated</div>\n'},compiler:[5,">= 2.0.0"],main:function(b,a,c,d){c="";var e=a["if"].call(b,b&&b.isQA,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d});if(e||0===e)c+=e;if((e=a["if"].call(b,b&&b.qaWeb,{name:"if",hash:{},fn:this.program(3,d),inverse:this.noop,data:d}))||0===e)c+=e;c+='\n<div class="qa-nav-force-production">\n    <div class="qa-nav-row qa-nav-force-production-row">\n        <input id="qa-nav-force-production" class="toggle-switch" type="checkbox">\n        <label class="qa-nav-force-production-label" for="qa-nav-force-production">Force production?</label>\n    </div>\n    <div class="qa-nav-row qa-nav-error-emulation-row">\n        <button class="btn qa-nav-error-emulation full-width">Error Emulation</button>\n    </div>\n    <div class="qa-nav-row qa-nav-error-emulation-row">\n       <button class="btn qa-nav-go-to-perf full-width">UI Perf</button>\n    </div>\n</div>\n';if((e=a["if"].call(b,b&&b.emulateNetworkErrors,{name:"if",hash:{},fn:this.program(5,d),inverse:this.noop,data:d}))||0===e)c+=e;return c+"\n"},useData:!0})}({}),I=function(h){var b=h.UiCore.UiContext;return b.extend("QANav",{uiContextName:"qa_nav",className:"qa-nav",dependencies:["dialogManager","featureAccessManager","localStorage","modeManager"],initialize:function(a){b.prototype.initialize.call(this,a);this.__modeManager=a.modeManager;this.addToDOM()},render:function(){this.$el.html(h.template({isQA:this.__featureAccessManager.canSeeQA(),qaWeb:this.__serviceProvider.get("qaWeb"),emulateNetworkErrors:this.__serviceProvider.has("emulateNetworkError")}));var a=this.$("#qa-nav-force-production").expect(1);a.prop("checked","true"===this.__localStorage.getItem("forceProduction"));a.on("change",function(){this.__localStorage.setItem("forceProduction",""+a.prop("checked"))}.bind(this));this.$(".qa-nav-error-emulation").expect(1).off("click").on("click",this.__showErrorEmulationDialog.bind(this));this.$(".qa-nav-go-to-perf").expect(1).off("click").on("click",this.__goToPerf.bind(this))},__showErrorEmulationDialog:function(){this.__dialogManager.showDialog(h.ErrorEmulationDialog)},__goToPerf:function(){this.__modeManager.openMode({mode:{id:"ui"},submode:{id:"perf"}})}})}({UiCore:m["@UiCore"],ErrorEmulationDialog:qa,template:ra}),sa=function(h){var b=h.GlobalNav;return b.extend("LoggedOutTopNav",{className:"global-nav logged-out bar",dependencies:"browserInfo cookieManager dialogManager globalStringManager googleAnalytics loginManager platform window".split(" "),trackedEvents:function(){return _.union([{type:"click",selector:"#top-nav-signup",name:"sign_up",handler:this.__onClickTopNavSignUp},{type:"click",selector:"#nag-bar-signup",name:"sign_up",handler:this.__onClickNagBarSignUp},{type:"click",selector:".logo",name:"logo_home_click",handler:this.__onLogoClick},{type:"click",selector:".secondary-nav",name:"secondary_nav_log_in_click",handler:this.__onSecNavClick}],b.prototype.trackedEvents.call(this))},initialize:function(a){a="undefined"===typeof a?{}:a;b.prototype.initialize.call(this,a);this.__window=a.window;this.__loginManager=a.loginManager;this.__dialogManager=a.dialogManager;this.__googleAnalytics=a.googleAnalytics;this.__globalStringManager==a.globalStringManager;this.__loginCookieName=this.__serviceProvider.get("loginCookieName");this.__cookieManager=this.__serviceProvider.get("cookieManager");"undefined"!==typeof a.modeManager&&(this.__modeManager=a.modeManager);this.__showLogo=!("/next/"===this.__window.location.pathname||"/next/ftux/"===this.__window.location.pathname);this.addToDOM();this.__window.location.pathname.match(/^\/next/)&&this.__loginManager.setLoginDestination(this.__window.location.href);this.$el.closest("body").addClass("logged-out");(this.__window.location.pathname.match(/^\/next\/feed\/feed_element/)||this.__window.location.pathname.match(/^\/next\/policyhub/))&&this.__cookieManager.set(this.__loginCookieName,"")},render:function(){this.$el.html(h.template({showLogo:this.__showLogo,showLogin:this.__showLogin,showUpdateIndicator:this.__window.autoUpdate?!0:!1}));this.__hasRenderedResolver.resolve();this.__serviceProvider.get("qaWeb")&&(this.__qaNav=this.createChildContext(h.QANav,{$parentElement:this.$(".system-tray").expect(1),emulateNetworkErrors:this.__serviceProvider.has("emulateNetworkError")}))},markActiveMode:function(a){},__onClickTopNavSignUp:function(){this.__doSignUp("logged out top nav large")},__onClickNagBarSignUp:function(){this.__doSignUp("logged out nag bar large")},__doSignUp:function(a){"mobile"===this.__platform?"iOS"===this.__browserInfo.getMobileOS()?this.__window.location="itms-apps://itunes.apple.com/us/app/imvu/id919745844?mt=8":"Android"===this.__browserInfo.getMobileOS()?this.__window.location="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova":this.__window.location="/mobile":(this.__googleAnalytics.recordSignUpClick(a),this.__directToWelcomeSignup())},__showLoginDialog:function(){this.__dialogManager.showLoginOrSignupDialog()},__onLogoClick:function(){this.__directToWelcomeSignup()},__onSecNavClick:function(){this.__directToWelcomeLoginDialog()},setBridgeOn:function(a){this.__isBridgePage=a},__directToWelcomeLoginDialog:function(){this.__dialogManager.showLoginOrSignupDialog()},__directToWelcomeSignup:function(){this.__loginManager.setLoginDestination("");this.__cookieManager.set(this.__loginCookieName,"");"1"==this.__cookieManager.get("test_logo_click")?this.__directToWelcomeLoginDialog():this.__isBridgePage?this.__dialogManager.confirm({title:this.__globalStringManager.get("download_bridge_dialog_warning_title"),text:this.__globalStringManager.get("download_bridge_dialog_warning_text"),yes:this.__globalStringManager.get("download_bridge_dialog_warning_confirm"),no:this.__globalStringManager.get("CANCEL")}).finished.then(function(){this.__recordEvent("click",{name:"bridge_logo_click"});this.trigger("bridgeRedirect");this.__window.location="/welcome/ftux/"}.bind(this)):(this.__recordEvent("click",{name:"bridge_logo_click"}),this.__window.location="/welcome/ftux/")}})}({GlobalNav:da,QANav:I,template:F}),ta=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(b,a,c,d){return"hidden"},compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e;c=a.helperMissing;var f='<ul class="secondary-nav ',g=a.unless.call(b,b&&b.showLogin,{name:"unless",hash:{},fn:this.program(1,d),inverse:this.noop,data:d});if(g||0===g)f+=g;f+='">\n    <div class="have-an-account">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_have_an_account",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='</div><a class="sign-in">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_login_link",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;return f+"</a>\n</ul>\n"},useData:!0})}({}),ua=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(b,a,c,d){var e,f=a.helperMissing;c='\n    <div class="label label-fb">\n        <a class="btn btn-fb id-fb">';if((a=(e=a["i18n-g"]||b&&b["i18n-g"]||f,e.call(b,"continue_with_facebook",{name:"i18n-g",hash:{},data:d})))||0===a)c+=a;return c+"</a>\n    </div>\n"},3:function(b,a,c,d){var e;a=this.escapeExpression;return"\n        <a class='px-5 language language-"+a((e=b&&b.code,"function"===typeof e?e.apply(b):e))+"' data-code='"+a((e=b&&b.code,"function"===typeof e?e.apply(b):e))+"' href=\""+a((e=b&&b.url,"function"===typeof e?e.apply(b):e))+'">'+a((e=b&&b.name,"function"===typeof e?e.apply(b):e))+"</a>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e;c=a.helperMissing;var f=this.escapeExpression,g='<form name="login_form" method="GET" action="#" class="login">\n    <div class="label login_avatarname label-first" data-holder="',k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"welcome_dialog_username_placeholder",{name:"i18n-g",hash:{},data:d}));if(k||0===k)g+=k;g+='">\n        <input type="text" tabindex="1" name="avatarname" placeholder=\'';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"welcome_dialog_username_placeholder",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='\'  autocapitalize="none" autocorrect="off" autocomplete="off" spellcheck="false" value="'+f((e=a.username||b&&b.username,"function"===typeof e?e.call(b,{name:"username",hash:{},data:d}):e))+'" />\n    </div>\n    <div class="label login_password label-second" data-holder="';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"welcome_dialog_password_placeholder",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='">\n        <div style="position:relative">\n            <input tabindex="1" type="password" name="password" placeholder=\'';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"welcome_dialog_password_placeholder",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='\'/>\n            <div class="toggle-password-visibility icon icon-password-show"></div>\n        </div>\n    </div>\n\n    <label class="submit">\n        <div class="error-message-container">\n            <div class="error-message try-again-later">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_try_again_later_error",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</div>\n            <div class="error-message try-again-later-server-load">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_try_again_later_error_server_load",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</div>\n            <div class="error-message client-2fa-not-supported">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_client_2fa_not_supported",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</div>\n            <div class="error-message credentials">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_credentials_error",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</div>\n            <div class="error-message disabled">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_disabled_error",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</div>\n            <div class="error-message unknown">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_unknown_login_error",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</div>\n            <div class="error-message 2fa-email-sent-rate-limit">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_2fa_email_sent_rate_limit",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</div>\n            <div class="error-message wrong-code-rate-limit">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_wrong_code_rate_limit",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</div>\n        </div>\n    </label>\n\n    <div class="label label-forgot">\n        <a data-external class="forgot-password-link" href="'+f((e=a.forgotPasswordUrl||b&&b.forgotPasswordUrl,"function"===typeof e?e.call(b,{name:"forgotPasswordUrl",hash:{},data:d}):e))+'">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_forgot_credentials",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</a>\n    </div>\n    <div class="label label-log-in">\n        <button class="btn btn-primary" >';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_signin_button",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</button>\n    </div>\n    <div class="label label-or">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_or",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</div>\n        <div class="label label-apple">\n            <a class="btn btn-apple id-apple">Continue with Apple</a>\n        </div>\n';if((k=a["if"].call(b,b&&b.showFBButton,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d}))||0===k)g+=k;g+='\n\n    <div class="label signup">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"welcome_dialog_no_account",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='&nbsp;<a class="id-signup">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"welcome_dialog_signup",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</a></div>\n    <div class="label need-help">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_need_help",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='<a data-external href="https://help.imvu.com/">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_help_center",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</a></div>\n\n    <div class="label languages flex items-center justify-center">\n        <a class=\'px-5 language current_language language-'+f((k=(k=b&&b.currentLocale,null==k||!1===k?k:k.code),"function"===typeof k?k.apply(b):k))+"' data-code='"+f((k=b&&b.code,"function"===typeof k?k.apply(b):k))+"' href=\""+f((k=(k=b&&b.currentLocale,null==k||!1===k?k:k.url),"function"===typeof k?k.apply(b):k))+'">'+f((k=(k=b&&b.currentLocale,null==k||!1===k?k:k.name),"function"===typeof k?k.apply(b):k))+"</a>\n        ";if((k=a.each.call(b,b&&b.otherLocales,{name:"each",hash:{},fn:this.program(3,d),inverse:this.noop,data:d}))||0===k)g+=k;g+='\n        <div class="px-5 inline-block more-locales right text-charcoal cursor-pointer">\n            <div class="w-25 h-18">\n                ';if((k=(e=a.icon||b&&b.icon||c,e.call(b,"icon-action_more",{name:"icon",hash:{class:"wh-full"},data:d})))||0===k)g+=k;g+='\n            </div>\n        </div>\n    </div>\n\n    <p class="app-store-buttons text-spacing">\n        <a data-external href="https://itunes.apple.com/us/app/imvu-mobile/id919745844?mt=8" class="ios-button" target="_blank">\n            ';if((k=(e=a.icon||b&&b.icon||c,e.call(b,"icon-app-store",{name:"icon",hash:{},data:d})))||0===k)g+=k;g+='\n        </a>\n        <a data-external href="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova" class="last android-button" target="_blank">\n            ';if((k=(e=a.icon||b&&b.icon||c,e.call(b,"icon-google-play",{name:"icon",hash:{},data:d})))||0===k)g+=k;g+='\n        </a>\n    </p>\n\n    <p class="privacy-agreements">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_privacy_agreements_description",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='<a target="_blank" href="'+f((e=a.policyHubUrl||b&&b.policyHubUrl,"function"===typeof e?e.call(b,{name:"policyHubUrl",hash:{},data:d}):e))+'">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_terms_of_conditions",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='</a><a target="_blank" href="'+f((e=a.arbitrationAgreementUrl||b&&b.arbitrationAgreementUrl,"function"===typeof e?e.call(b,{name:"arbitrationAgreementUrl",hash:{},data:d}):e))+'">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_arbitration_agreement",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+="</a>";if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login__dialog_privacy_agreements_and",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+='<a target="_blank" href="'+f((e=a.privacyPolicyUrl||b&&b.privacyPolicyUrl,"function"===typeof e?e.call(b,{name:"privacyPolicyUrl",hash:{},data:d}):e))+'">';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_dialog_privacy_policy",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;return g+"</a></p>\n</form>\n"},useData:!0})}({}),va=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(b,a,c,d){return"show-label"},3:function(b,a,c,d){var e;return(a=(e=a.defaultLabel||b&&b.defaultLabel,"function"===typeof e?e.call(b,{name:"defaultLabel",hash:{},data:d}):e))||0===a?a:""},5:function(b,a,c,d){return"&nbsp"},7:function(b,a,c,d){var e;return(a=(e=a.content||b&&b.content,"function"===typeof e?e.call(b,{name:"content",hash:{},data:d}):e))||0===a?a:""},compiler:[5,">= 2.0.0"],main:function(b,a,c,d){c='<div class="holder-label">\n    <div class="info ';var e=a["if"].call(b,b&&b.defaultLabel,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d});if(e||0===e)c+=e;c+='">';if((e=a["if"].call(b,b&&b.defaultLabel,{name:"if",hash:{},fn:this.program(3,d),inverse:this.program(5,d),data:d}))||0===e)c+=e;c+='</div>\n    <div class="content">';if((e=a["if"].call(b,b&&b.content,{name:"if",hash:{},fn:this.program(7,d),inverse:this.noop,data:d}))||0===e)c+=e;return c+"</div>\n</div>\n"},useData:!0})}({}),B=function(h){Handlebars.registerPartial("InputMixinHolderLabel",h.HolderLabelTemplate);return{dependencies:[],trackedEvents:function(){return[{type:"focus",selector:".label[data-holder] input",name:"focus_input",handler:"__onHolderInputFocus"},{type:"blur",selector:".label[data-holder] input",name:"blur_input",handler:"__onHolderInputBlur"}]},initialize:function(){this.render=function(b){return function(){b.apply(this,arguments);this.__insertLabelTemplate(this.$(".label[data-holder]"))}}(this.render)},__insertLabelTemplate:function(b){b=(b instanceof $?b:this.$(b)).not(":has(>.holder-label)");b.prepend(h.HolderLabelTemplate());b.filter("[data-dropdown]").each(function(a,c){this.__setInputLabelMsg(c,$(c).attr("data-holder"))}.bind(this))},__onHolderInputFocus:function(b){b=$(b.currentTarget);b.attr("placeholder","");b=b.closest(".label[data-holder]").removeClass("error");this.__insertLabelTemplate(b);b.find(">.holder-label >.info").html(b.attr("data-holder")).addClass("show-label")},__onHolderInputBlur:function(b){b=$(b.currentTarget);if(!b.val()){var a=b.closest(".label[data-holder]");b.attr("placeholder",a.attr("data-holder"));a.hasClass("error")||a.find(">.holder-label >.info").html("&nbsp;").removeClass("show-label")}},__clearError:function(b){b=$(b).closest(".label[data-holder]").removeClass("error");var a=b.find("input");!a[0]||a.val()?this.__setInputLabelMsg(b,b.attr("data-holder")):(a.attr("placeholder",b.attr("data-holder")),b.find(">.holder-label >.info").html("&nbsp;").removeClass("show-label"))},__setInputLabelMsg:function(b,a){b=b instanceof $?b:this.$(b);b.find(">.holder-label >.info").html(a).toggleClass("show-label",!!b.attr("data-holder")||b.hasClass("error"))},__setInputErrorLabelMsg:function(b,a){this.__setInputLabelMsg(this.$(b).addClass("error"),a)}}}({UiCore:m["@UiCore"],HolderLabelTemplate:va}),wa=function(h){return h.UiCore.RestCollection.extend("PrefCollection",{model:h.UiCore.EdgeModel})}({UiCore:m["@UiCore"]}),J=function(h){return IMVU.BaseClass.extend("PrefsManager",{dependencies:["loginManager","Promise","rest"],initialize:function(b){this.Promise=b.Promise;this.rest=b.rest;this.__pendingSets={};var a=b.userModel||b.loginManager.getCurrent().getSingleEdge("user");this.__populated=a.populated().then(function(){var c=this.Promise.resolve();a.relations&&a.relations.preferences||(a.invalidate(),c=a.populated());return c.then(function(){return a.getEdgeCollection("preferences",h.PrefCollection)})}.bind(this)).then(function(c){this.collection=c;return c.populated()}.bind(this)).then(function(){this.collection.on("change",this.__cleanPendingSet.bind(this))}.bind(this))},__cleanPendingSet:function(b){var a=b.get("name");b=b.get("value");this.__pendingSets[a]===b&&delete this.__pendingSets[a]},populated:function(){return this.__populated},__ensurePopulated:function(){if("pending"===this.__populated.state)throw Error("Cannot perform preference operation until preferences are populated")},get:function(b,a){this.__ensurePopulated();if(this.__pendingSets[b])return this.__pendingSets[b];for(var c=0;c<this.collection.length;c++){var d=this.collection.at(c);if(d.get("name")===b)return d.get("value")}return a},getBool:function(b,a){b=this.get(b,null);return _.isNull(b)?a:!!parseInt(b,10)},getInt:function(b,a){b=this.get(b,null);return _.isNull(b)?a:parseInt(b,10)},setBool:function(b,a){return this.set(b,a?"1":"0")},setInt:function(b,a){return this.set(b,String(a))},set:function(b,a){this.__ensurePopulated();if("string"!==typeof a)throw Error("Tried to set pref with non-string value: "+typeof a);if(this.get(b)===a)return new this.Promise(function(c){c.accept()});this.__pendingSets[b]=a;a=this.rest.post(this.collection.url,{id:"/preferences/preference-"+b,data:{value:a}});a.catch(function(){delete this.__pendingSets[b]}.bind(this));return a}})}({UiCore:m["@UiCore"],PrefCollection:wa}),xa=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e;c=a.helperMissing;var f='<div class="copy-body">\n    ',g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_pending_guardian_approval_1",{name:"i18n-g",hash:{},data:d}));if(g||0===g)f+=g;f+="\n    ";if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_pending_guardian_approval_2",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+="\n    ";if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_pending_guardian_approval_3",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='\n    <a href="https://help.imvu.com" target="_blank">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"Help Center",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='.</a></div>\n</div>\n<div class="privacy-policy-link"><a href="https://secure.imvu.com/next/policyhub/privacypolicy/">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"view_privacy_policy",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='</a></div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary full-width">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"close pending policy",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;return f+"</button>\n<\/script>\n\n"},useData:!0})}({}),ya=function(h){var b=h.Dialogs.AlloyModalDialog;return b.extend("TooltipDialog",{uiContextName:"tooltip_dialog",className:"tooltip-dialog dialog-type-B text-close",trackedEvents:function(){return this.__customTrackedEvents},initialize:function(a){this.__customTrackedEvents=a.trackedEvents||[];b.prototype.initialize.call(this,a);this.title=a.title;this.__tooltipContent=a.tooltipContent;this.addToDOM()},postRender:function(){this.setContent("body",this.__tooltipContent)}})}({Dialogs:m["@Dialogs"]}),K=function(h){var b=h.UiCore.UiContext;return b.extend("Tooltip",{className:"tooltip",uiContextName:"tooltip",dependencies:["dialogManager","timer","tooltipLayer","window"],trackedEvents:function(){return[{type:"click",selector:"a",name:"link_click",handler:"__clickedLink",allowBubble:!0}].concat(this.__customTrackedEvents)},__installTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.on("mouseenter.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.$target.off("mouseleave.tooltip")}.bind(this));this.__tooltipLayer.$el.on("mouseleave.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__tooltipTimeout);this.__tooltipTimeout=this.__timer.setTimeout(function(){this.setVisible(!1);this.__timer.clearTimeout(this.__tooltipTimeout);this.__tooltipTimeout=this.__timer.setTimeout(function(){this.__hide();this.__installTargetMouseleave()}.bind(this),125)}.bind(this),250)}.bind(this))},__removeTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.off(".tooltip")},initialize:function(a){this.$tooltip=IMVU.requireProperty(a,"$replaceElement");this.$target=IMVU.requireProperty(a,"$tooltipTarget");this.tooltipTitle=IMVU.optionalProperty(a,"title",!1);this.__tooltipStyle=IMVU.optionalProperty(a,"tooltipStyle","default");this.__tooltipPosition=IMVU.optionalProperty(a,"tooltipPosition","default");this.__positionDelta=IMVU.optionalProperty(a,"positionDelta",0);this.__forceTargetToUseOuterWidth=IMVU.optionalProperty(a,"forceTargetToUseOuterWidth",!1);this.__customTrackedEvents=a.trackedEvents||[];b.prototype.initialize.call(this,a);this.$body=$("body");this.$globalNav=$("nav.global-nav:visible");if("mobile"===this.__serviceProvider.get("platform"))this.$target.on("click.tooltip",function(c){c.stopPropagation();this.__openTooltipDialog()}.bind(this));else this.$target.on("mouseenter.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.__timer.clearTimeout(this.__targetFadeinTimeout);this.__installTargetMouseleave();this.__targetFadeinTimeout=this.__timer.setTimeout(function(){this.setVisible(!0);this.__show()}.bind(this),250)}.bind(this));"snug"===this.__tooltipStyle&&this.$el.addClass("tooltip-snug");this.$el.append(this.$tooltip);this.setParentUiContext(this.__tooltipLayer);this.__tooltipLayer.$el.append(this.$el);this.__setAsRendered()},setVisible:function(a){this.$el.toggleClass("tooltip-open",!!a)},__installTargetMouseleave:function(){this.$target.on("mouseleave.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__targetTimeout=this.__timer.setTimeout(function(){this.setVisible(!1);this.__timer.clearTimeout(this.__targetTimeout);this.__targetTimeout=this.__timer.setTimeout(function(){this.__hide()}.bind(this),125)}.bind(this),250)}.bind(this))},__show:function(){this.__installTooltipLayerEventHandlers();this.__trackTooltip();$(this.__window).on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this));this.$body.find(".transparent-overlay").on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this))},trackTooltip:function(){this.__trackTooltip()},__trackTooltip:function(){var a=this.$globalNav.height()||0,c=this.$target[0].getBoundingClientRect().top,d=this.$target[0].getBoundingClientRect().left,e=$(window).width()-(d+this.$target.outerWidth()/2),f=this.$el[0].offsetWidth;0<this.$target.parents(".dialog-manager").length&&(a=0);var g=this.$target.width();this.__forceTargetToUseOuterWidth&&(g=this.$target.outerWidth());e=e>f?d+g/2:d+g/2-f;"bottom"===this.__tooltipPosition?(e=d-this.$tooltip.outerWidth()/2,c=this.$target[0].getBoundingClientRect().bottom-this.__positionDelta):"above"===this.__tooltipPosition?(e=d+g/2-f,c=this.$target[0].getBoundingClientRect().top-this.$el[0].offsetHeight):"left"===this.__tooltipPosition?(e=d-g-f-this.__positionDelta,c=this.$target[0].getBoundingClientRect().top):"bottom-left-edge"===this.__tooltipPosition&&(e=d,c=0);this.$el.css({"margin-top":Math.max(c,a),"margin-left":e})},__hide:function(){this.__removeTooltipLayerEventHandlers();this.setVisible(!1)},__openTooltipDialog:function(){return this.__dialogManager.showDialog(h.TooltipDialog,{title:this.tooltipTitle||this.$target.text(),tooltipContent:this.$tooltip.html(),trackedEvents:this.__customTrackedEvents})},delete:function(){this.$el.removeAttr("style");this.__timer.clearTimeout(this.__targetFadeinTimeout);this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.$target.off(".tooltip");this.__removeTooltipLayerEventHandlers();$(this.__window).off("scroll.tooltip");this.$body.find(".transparent-overlay").off("scroll.tooltip");b.prototype.delete.call(this)},__clickedLink:function(a){this.__hide()}})}({UiCore:m["@UiCore"],TooltipDialog:ya}),za=function(h){var b=h.Dialogs.AlloyModalDialog;return b.extend("PrivacyPolicyMinorsPendingDialog",{uiContextName:"privacy_policy_minors_pending_dialog",className:"privacy-policy-minors-pending-dialog dialog-type-B",dependencies:["cookieManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_adult_okay",handler:"__onClose"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("privacy_pending_guardian_approval_title");this.addToDOM();this.$(".dialog-x").remove()},postRender:function(){this.setContent("body",h.template,{});this.setContent("footer",this.$(".dialog-footer-template").text())},__onClose:function(a){b.prototype.__onClose.call(this,a)}})}({Dialogs:m["@Dialogs"],Tooltip:K,template:xa}),Aa=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e;c=a.helperMissing;var f='<div class="copy-body">\n    ',g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_policy_adult_dialog_body_1",{name:"i18n-g",hash:{},data:d}));if(g||0===g)f+=g;f+='\n    <a href="https://secure.imvu.com/next/policyhub/gdprconsent/" class="tooltip-target">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_policy_adult_dialog_body_2",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+="</a>\n    ";if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_policy_adult_dialog_body_3",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='\n    <a href="https://secure.imvu.com/next/policyhub/privacypolicy/" target="_blank">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_policy_adult_dialog_body_4",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+="</a>\n    ";if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_policy_adult_dialog_body_5",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+="\n    <br>\n    ";if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_policy_adult_dialog_body_6",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='\n\n    <div class="accept-button">\n        <button class="btn btn-primary accept-cookies">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"accept all cookies",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;return f+'</button>\n    </div> \n</div>\n\n\n<div class="tooltip-content cookie-tooltip">\n    <div class="tooltip-body">\n        To give you the best possible experience, personalize content and ads, this site uses Cookies. Continuing to use the site you agree we may place these cookies on your device. You can view our Privacy Policy for more details.\n\n        <div class="tooltip-header">Strictly Necessary Cookies:</div>\n            <div>These cookies are necessary for the website to function and cannot be switched off in our systems. </div>\n            <ul>\n                <li>prefer_alloy - Used to determine if you see IMVU Next or Core.</li>\n                <li>alloy_landing_cookie - Used to determine if you see IMVU Next or Core.</li>\n                <li>in_ux - Assigned to a "unique user" experiment.</li>\n                <li>osCsid - Session cookie; required for login to function.</li>\n            </ul>\n        <div class="tooltip-header">Performance Cookies:</div>\n            <div>These cookies allow us to count visits and traffic sources, so we can measure and improve the performance of our site. They help us know which pages are the most and least popular and see how visitors move around the site.</div>\n            <ul>\n                <li>browser_session - Tracks statistics about your IMVU session.</li>\n                <li>window_session - Tracks statistics about a specific IMVU window.</li>\n                <li>Targeting Cookies</li>\n                <li>These cookies are set through our site by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant ads on other sites. They work by uniquely identifying your browser and device.</li>\n                <li>login_interstitial_seen - tracks the last time you saw an interstitial, for aggregate analytics purposes.</li>\n                <li>sncd - Tracks CIDs you have logged into, for detecting if a new account is an alt.</li>\n                <li>nunu - Tracks if we believe you are a new new user.</li>\n                <li>preLogID - Used to connect incoming users with their subsequent login or registration.</li>\n                <li>imvua - Tracks which acquisition partner you came from.</li>\n                <li>datetime_entered - Tracks when you first landed on our site.</li>\n                <li>linkshare_site_id - If acquired through a specific partner, tracks which ad you followed.</li>\n                <li>lpip - Stores the IP you hit a landing page with.</li>\n            </ul>\n        <div class="tooltip-header">Presentation Cookies:</div>\n            <div>These cookies are set to help enhance your experience and for example, allow us to show you IMVU in the language of your choice.</div>\n            <ul>\n                <li>imvu_avnm - stores your avatarname for display purposes.</li>\n                <li>saved_locale - stores which language you prefer to see IMVU in.</li>\n            </ul>\n        <div class="tooltip-header">Third Party Partners:</div>\n            <div>We also have third party partners who may set cookies including this list below:</div>\n            <ul>\n                <li>Amazon</li>\n                <li>Doubleverify</li>\n                <li>Facebook</li>\n                <li>Google</li>\n                <li>Peanutlabs</li>\n                <li>Revenue Universe</li>\n                <li>AppNexus</li>\n                <li>Google Analytics</li>\n                <li>Threat Metrix</li>​\n            </ul>\n    </div>\n</div>'},useData:!0})}({}),Ba=function(h){var b=h.Dialogs.AlloyModalDialog;return b.extend("PrivacyPolicyAdultDialog",{uiContextName:"privacy_policy_adult_dialog",className:"privacy-policy-adult-dialog dialog-type-B",dependencies:["cookieManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:".accept-button",name:"submit_privacy_policy_adult_okay",handler:"__onClose"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("privacy_policy_adult_dialog_title");this.isUncancellableDialog=!0;this.addToDOM();this.$(".dialog-x").remove()},postRender:function(){this.setContent("body",h.template,{});this.tooltip=this.createChildContext(h.Tooltip,{$replaceElement:this.$(".tooltip-content"),$tooltipTarget:this.$(".tooltip-target")});this.tooltip.$el.addClass("tooltip-wide")},__onClose:function(a){this.__cookieManager.set("accepted_all_cookies","true");b.prototype.__onClose.call(this,a)}})}({Dialogs:m["@Dialogs"],Tooltip:K,template:Aa}),Ca=function(h){var b=h.UiCore.UiContext;return b.extend("ContextMenu",{uiContextName:"context_menu",tagName:"ul",className:"context-menu",trackedEvents:function(){return[{type:"click",selector:"li",name:"context_menu_item",handler:"__chooseMenuItem",attributes:function(a){return{which:a.attr("data-menu-item")}}}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__items=IMVU.requireProperty(a,"items");this.location=IMVU.requireProperty(a,"location");this.mouseMargin=IMVU.optionalProperty(a,"mouseMargin","");this.__showCaret=IMVU.optionalProperty(a,"showCaret",!1);this.__isChatStreamProfileMenu=IMVU.optionalProperty(a,"chatStreamProfile",null);this.__closeOnScroll=void 0!==a.closeOnScroll?a.closeOnScroll:!0;this.addToDOM()},render:function(){_.each(this.__items,function(a){var c=$("<li />");c.attr("data-menu-item",a.name).text(a.text).addClass(a.classNames).toggleClass("divider",!!a.divider);_.has(a,"title")&&_.isString(a.title)&&c.attr("title",a.title);this.$el.append(c)}.bind(this));this.__showCaret&&(this.__isChatStreamProfileMenu?($('<div class="caret"></div>').insertAfter(".context-menu li:first-of-type"),this.$(".caret").css({bottom:82,left:-16})):this.$el.append('<div class="caret"></div>'))},__chooseMenuItem:function(a){var c=$(a.currentTarget).data("menu-item"),d=_.find(this.__items,function(e){return e.name===c}).handler;d&&d.call(this,a);this.trigger("item-chosen")},shouldCloseOnScroll:function(){return!this.__closeOnScroll}})}({UiCore:m["@UiCore"]}),Da=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e;c=a.helperMissing;var f='<div class="content">\n    <div class="privacy-policy-minors-body">',g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_policy_minors_dialog_body",{name:"i18n-g",hash:{},data:d}));if(g||0===g)f+=g;f+='</div>\n    <div class="privacy-policy-minors-form">\n        <div class="privacy-policy-minors-form-title">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_policy_minors_dialog_form_title",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='</div>\n        <div class="fieldset">\n            <label>';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"Name",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='</label>\n            <input type="text" class="privacy-policy-minors-avatarname full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"your name",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='</label>\n            <input type="text" class="privacy-policy-minors-name full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"email address",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+="<span> (";if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_policy_minors_email_note",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+=')</span></label>\n            <input type="text" class="privacy-policy-minors-email full-width"></input>\n            <div class="input-error"></div>\n        </div>\n        <div class="fieldset">\n            <label>';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_policy_minors_guardian_name",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='</label>\n            <input type="text" class="privacy-policy-minors-guardian-name full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_policy_minors_guardian_email",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='</label>\n            <input type="text" class="privacy-policy-minors-guardian-email full-width"></input>\n            <div class="input-note">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_policy_minors_guardian_email_note",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='</div>\n            <div class="input-error"></div>\n        </div>\n    </div>\n    <div class="privacy-policy-link"><a href="https://secure.imvu.com/next/policyhub/privacypolicy/">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"view_privacy_policy",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='</a></div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary minors-guardian-form-submit full-width disabled">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"submit",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;return f+"</button>\n<\/script>"},useData:!0})}({}),Ea=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e;c=a.helperMissing;var f="<div>\n    <p>",g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_policy_minors_guardian_dialog_body_1",{name:"i18n-g",hash:{},data:d}));if(g||0===g)f+=g;f+="</p>\n    <p>";if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"privacy_policy_minors_guardian_dialog_body_2",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='</p>\n</div>\n<div class="privacy-policy-link"><a href="https://secure.imvu.com/next/policyhub/privacypolicy/">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"view_privacy_policy",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;f+='</a></div>\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary ok full-width">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"OK",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;return f+"</button>\n<\/script>"},useData:!0})}({}),Fa=function(h){var b=h.Dialogs.AlloyModalDialog;return b.extend("PrivacyPolicyMinorsGuardianDialog",{uiContextName:"privacy_policy_minors_guardian_dialog",className:"privacy-policy-minors-guardian-dialog dialog-type-B",dependencies:["globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_minors_okay",handler:"__onClose"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("privacy_policy_minors_guardian_dialog_title");this.addToDOM()},postRender:function(){this.setContent("body",h.template,{});this.setContent("footer",this.$(".dialog-footer-template").text())}})}({Dialogs:m["@Dialogs"],template:Ea}),Ga=function(h){return{validateEmail:function(b){return/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,3}$/.test(b)}}}({}),Ha=function(h){var b=h.Dialogs.AlloyModalDialog;return b.extend("PrivacyPolicyMinorsDialog",{uiContextName:"privacy_policy_minors_dialog",className:"privacy-policy-minors-dialog dialog-type-B",dependencies:["dialogManager","globalStringManager","rest"],trackedEvents:function(){return[{type:"keyup",selector:"input.privacy-policy-minors-avatarname",name:"change_avatarname",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-name",name:"change_username",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-email",name:"change_email",handler:"__validateMinorsEmail"},{type:"keyup",selector:"input.privacy-policy-minors-guardian-name",name:"change_guardian_name",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-guardian-email",name:"change_guardian_email",handler:"__validateGuardiansEmail"},{type:"click",selector:"button",name:"submit_privacy_policy_minors_form",handler:"__submit"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__GUARDIAN_VERIFICATION_URL=this.__serviceProvider.get("root")+"/guardian_verification";this.title=this.__globalStringManager.get("privacy_policy_minors_dialog_title");this.__formValidator=h.FormValidator;this.addToDOM();this.$(".dialog-x").remove();this.__hasError=!1},postRender:function(){this.setContent("body",h.template,{});this.setContent("footer",this.$(".dialog-footer-template").text());this.$(".content").scrollbar()},__toggleButton:function(){var a=!1;this.$("input").each(function(d){$(this).val()||(a=!0)});var c=this.__minorsEmailError||this.__guardiansEmailError;this.$(".minors-guardian-form-submit").toggleClass("disabled",a||c)},__validateMinorsEmail:function(a){this.__minorsEmailError=!1;var c=$(a.currentTarget);a=c.siblings(".input-error");a.text("");c=this.__validateEmail(c.val());null!==c&&(this.__minorsEmailError=!0,a.text(c));this.__toggleButton()},__validateGuardiansEmail:function(a){this.__guardiansEmailError=!1;a=$(a.currentTarget);a.siblings(".input-note").toggleClass("hidden",!1);var c=a.siblings(".input-error");c.text("");var d=this.__validateEmail(a.val());null===d&&this.$("input.privacy-policy-minors-email").val()===this.$("input.privacy-policy-minors-guardian-email").val()&&(d=this.__globalStringManager.get("privacy_policy_minors_guardian_email_note"));null!==d&&(this.__guardiansEmailError=!0,c.text(d),a.siblings(".input-note").toggleClass("hidden",!0));this.__toggleButton()},__validateEmail:function(a){return a?this.__formValidator.validateEmail(a)?null:this.__globalStringManager.get("error_message_email_invalide_format"):this.__globalStringManager.get("error_message_email_empty")},__submit:function(a){this.__rest.post(this.__GUARDIAN_VERIFICATION_URL,{avatarname:this.$("input.privacy-policy-minors-avatarname").val(),user_name:this.$("input.privacy-policy-minors-name").val(),user_email:this.$("input.privacy-policy-minors-email").val(),guardian_name:this.$("input.privacy-policy-minors-guardian-name").val(),guardian_email:this.$("input.privacy-policy-minors-guardian-email").val()}).then(function(c){});this.__onClose(a);this.__dialogManager.showDialog(h.PrivacyPolicyMinorsGuardianDialog)}})}({Dialogs:m["@Dialogs"],FormValidator:Ga,PrivacyPolicyMinorsGuardianDialog:Fa,template:Da}),C=function(h){return{mixin:function(){var b=$jscomp.getRestArguments.apply(0,arguments),a=b[0],c=[],d=function(){for(var g=$jscomp.getRestArguments.apply(0,arguments),k=c.length;0<k--;)c[k].apply(this,g)},e=[],f=function(){for(var g=$jscomp.getRestArguments.apply(0,arguments),k=[],l=e.length;0<l--;)k=k.concat(e[l].apply(this,g));return k};_.each(b,function(g){g.initialize&&c.push(g.initialize);g.trackedEvents&&e.push(g.trackedEvents);if(g!==a){var k=a.dependencies||[];_.each(g.dependencies,function(l){-1===_.indexOf(k,l)&&k.push(l)});k.sort();_.extend(a,g,{dependencies:k})}});c.length&&(a.initialize=1<c.length?d:c[0]);e.length&&(a.trackedEvents=1<e.length?f:e[0]);return a}}}({}),L=function(h){var b=h.Dialogs.AlloyModalDialog;return b.extend("LoginDialog",h.Mixin.mixin({uiContextName:"login_dialog",className:"login-dialog dialog-type-B-flexible",dependencies:"browserInfo contextMenuManager cookieManager counterHelper dialogManager featureAccessManager globalStringManager googleAnalytics localStorage loginManager modeManager prefsManager Promise restModelFactory urlManager window".split(" "),trackedEvents:function(){return[{type:"submit",selector:"form.login",name:"login",handler:"__onLogin"},{type:"click",selector:".id-signup",name:"signup",handler:"__onClickSignup"},{type:"click",selector:".id-fb",name:"fb_login",handler:this.__onClickFB},{type:"click",selector:".id-apple",name:"apple_login",handler:"__onClickApple"},{type:"click",selector:".toggle-password-visibility",name:"toggle_password_visibility",handler:"__togglePasswordVisibility"},{type:"click",selector:".forgot-password-link",name:"forgot_password",handler:"__forgotPassword"},{type:"click",selector:".language",name:"language",handler:this.__changeLanguage},{type:"click",selector:".more-locales",name:"more_locales",handler:this.__showMoreLocalesMenu}]},initialize:function(a){this.__browserInfo=a.browserInfo;this.title=a.globalStringManager.get("welcome_login_dialog_signin");"undefined"!==typeof a.globalStringManager&&(this.__globalStringManager=a.globalStringManager);this.hasCloseButton=_.isUndefined(a.hasCloseButton)?!0:a.hasCloseButton;this.__loginMode=a.loginMode;b.prototype.initialize.call(this,a);this.__loginCookieName=this.__serviceProvider.get("loginCookieName");this.__cookieManager=this.__serviceProvider.get("cookieManager");this.__hasSignupButton=_.isUndefined(a.hasSignupButton)?!0:a.hasSignupButton;this.__loginUsername=this.__cookieManager.get("login_username")?this.__cookieManager.get("login_username"):"";this.__refreshOnLogin=a.refreshOnLogin||"mobile"===this.__serviceProvider.get("platform");this.__loginDestination=a.loginDestination?this.__getLoginDestination(a.loginDestination):null;this.__contextMenuManager=a.contextMenuManager;this.shouldFocusOnPrimaryButton=!1;this.__socialLogin=this.__loginManager.getSocialLogin();this.__socialLogin.checkLoginState();(this.__hadSocialLogin=this.__socialLogin.hadEverLoggedIn())&&this.__socialLogin.logout();(a=this.__serviceProvider.get("currentLocale"))&&"en"!=a||(a="www");var c=this.__serviceProvider.get("locales");this.__currentLocaleInfo=void 0;this.__otherLocaleInfo=[];this.__remainderLocaleInfo=[];var d=0;c=$jscomp.makeIterator(c);for(var e=c.next();!e.done;e=c.next())(e=e.value)&&e.url&&(e.url=decodeURIComponent(e.url)),e.code==a?this.__currentLocaleInfo=e:2>d&&-1!=["es","pt","www"].indexOf(e.code)?(this.__otherLocaleInfo.push(e),++d):this.__remainderLocaleInfo.push(e);a=this.__serviceProvider.get("siteRoot").replace("welcome/","").replace("next/","");this.__featureAccessManager.isElectronClient()&&(a="https://secure.imvu.com/");this.__forgotPasswordUrl=a+"welcome/forgotpassword/";this.addToDOM()},postRender:function(){this.__loginUsername="undefined"===typeof this.__loginUsername?"":this.__loginUsername;this.__loginUsername="undefined"===this.__loginUsername?"":this.__loginUsername;this.__loginUsername=null===this.__loginUsername?"":this.__loginUsername;this.__showFBButton=this.__featureAccessManager.canSeeFacebookLogin();this.setContent("body",h.template,{username:this.__loginUsername,forgotPasswordUrl:this.__forgotPasswordUrl,currentLocale:this.__currentLocaleInfo,otherLocales:this.__otherLocaleInfo,canSeeAppleSignIn:this.__featureAccessManager.canSeeAppleSignIn(),policyHubUrl:this.__urlManager.get("policy_hub"),arbitrationAgreementUrl:this.__urlManager.get("arbitration_agreement"),privacyPolicyUrl:this.__urlManager.get("privacy_policy"),showFBButton:this.__showFBButton});this.$(".login_avatarname input").focus();this.__loginUsername&&this.$(".login_password input").focus();this.$(".login").toggleClass("can-signup",this.__hasSignupButton);if(this.__loginUsername){var a=this.$('input[name="avatarname"]').closest(".label[data-holder]");this.__insertLabelTemplate(a);if(a.hasClass("ignore-placeholder-behavior"))return;a.find(">.holder-label >.info").html(a.attr("data-holder"))}this.__counterHelper.increment("welcome_login_dialog")},__showMoreLocalesMenu:function(a){a.preventDefault();for(var c=[],d={},e=$jscomp.makeIterator(this.__remainderLocaleInfo),f=e.next();!f.done;d={$jscomp$loop$prop$localeInfo$3:d.$jscomp$loop$prop$localeInfo$3},f=e.next())d.$jscomp$loop$prop$localeInfo$3=f.value,c.push({name:d.$jscomp$loop$prop$localeInfo$3.code,text:d.$jscomp$loop$prop$localeInfo$3.name,handler:function(g){return function(){var k=g.$jscomp$loop$prop$localeInfo$3.code;if(this.__featureAccessManager.isElectronClient())this.__localStorage.setItem("lang",k),this.__window.location.reload();else{""===k?this.__cookieManager.clear("saved_locale"):this.__cookieManager.set("saved_locale",k);var l=new URL(this.__window.location.href);3<l.host.split(".").length&&(l.host=l.host.split(".").splice(1).join("."));l.host=[k,l.host].join(".");this.__window.location.href=l}}}(d).bind(this)});this.__contextMenuManager.showMenu(a,h.ContextMenu,{items:c,displayOptions:{above:!0,right:!0}})},__changeLanguage:function(a){a.preventDefault();var c=a.target.getAttribute("data-code");this.__featureAccessManager.isElectronClient()?(this.__localStorage.setItem("lang",c),this.__window.location.reload()):(""===c?this.__cookieManager.clear("saved_locale"):this.__cookieManager.set("saved_locale",c),this.__window.location.href=a.target.getAttribute("href"))},__onLogin:function(a){null!==a&&a.preventDefault();a="true"===this.__cookieManager.get("accepted_all_cookies")?!0:!1;var c={username:this.$('[name="avatarname"]').val(),password:this.$('[name="password"]').val(),gdpr_cookie_acceptance:a};this.$("label.submit").addClass("loading");this.__loginManager.performLoginFromCredentials(this.__serviceProvider,c).then(function(d){this.__googleAnalytics.recordSuccessfulAuthentication("true");this.$("label.submit").removeClass("loading");this.$(".error-message").removeClass("active").css("height","");this.__cookieManager.set(this.__loginCookieName,"true");this.__cookieManager.set("prefer_alloy","1");this.__cookieManager.set("login_username",c.username);this.__cookieManager.set("password_changed","0");var e=this.__restModelFactory.readModel(d.relations.user,h.UiCore.NodeModel);e.relations&&e.relations.preferences||e.invalidate();e.populated().then(function(){e.get("is_on_hold")?this.__dialogManager.alert({title:this.__globalStringManager.get("welcome_login_banned_user_title"),text:this.__globalStringManager.get("welcome_login_banned_user_text")}).finished.then(function(){this.hide();this.__featureAccessManager.isElectronClient()?(this.__externalWindow=this.__serviceProvider.get("externalWindow"),this.__externalWindow.newElectronWindow({width:1024,height:768}).loadURL("https://help.imvu.com/s/contactus"),this.__onLoginContinue(e)):this.__window.location="https://help.imvu.com/s/contactus"}.bind(this)):this.__onLoginContinue(e)}.bind(this))}.bind(this),function(d){var e="credentials";d===this.__loginManager.ERROR_TRY_AGAIN_LATER?e="try-again-later":d===this.__loginManager.ERROR_DISABLED?e="disabled":d===this.__loginManager.ERROR_UNDERAGE||d===this.__loginManager.ERROR_COOKIE_UNACCEPT||d===this.__loginManager.ERROR_UNDERAGE_PENDING_CONSENT?(e="disabled",this.__showPrivacyPolicyDialog(d)):d===this.__loginManager.ERROR_EXCESSIVE_SERVER_LOAD?e="try-again-later-server-load":d===this.__loginManager.ERROR_CODE_EMAIL_RATE_LIMIT?e="2fa-email-sent-rate-limit":d===this.__loginManager.ERROR_WRONG_CODE_RATE_LIMIT?e="wrong-code-rate-limit":d===this.__loginManager.ERROR_CLIENT_2FA_NOT_SUPPORTED&&(e="client-2fa-not-supported");h.NextUtil.DomHelper.radioClass(this.$(".error-message."+e),"active");d=this.$(".error-message.active").height();this.$(".error-message.active").css("height",0);this.$("label.submit").removeClass("loading");this.$(".error-message.active").height();this.$(".error-message.active").css("height",d)}.bind(this))},__onLoginContinue:function(a){var c=this,d=this.__Promise.resolve();this.__featureAccessManager.isElectronClient()&&(d=new this.__Promise(function(e){c.__LoggedInPrefsManager=c.__serviceProvider.create(h.LoggedInPrefsManager,{userModel:a});c.__LoggedInPrefsManager.populated().then(function(){this.__LoggedInPrefsManager.setBool("next.has_signed_onto_client",!0);e.resolve()}.bind(c)).catch(function(f){window.console.error("Unable to save next.has_signed_onto_client",f);e.resolve()})}));d.then(function(){var e=new URL(c.__window.location.href).searchParams;e&&e.get("next")?(e=e.get("next"),c.__window.location.href=decodeURIComponent(e)):c.__loginDestination?c.__window.location.href=decodeURIComponent(c.__loginDestination):c.__loginManager.getLoginDestination()?c.__window.location.href=c.__loginManager.getLoginDestination():c.__serviceProvider.services.overrideMode&&"ftux"!==c.__serviceProvider.services.overrideMode?(e=c.__serviceProvider.get("siteRoot"),e+=c.__serviceProvider.get("startMode")+"/",c.__serviceProvider.services.startSubmode&&(e+=c.__urlId(c.serviceProvider.get("startSubmode"))+"/"),c.__window.location.href=e):c.__refreshOnLogin?c.__window.location.reload():a.populated().then(function(){return a.getEdgeCollection("preferences",h.UiCore.RestCollection)}.bind(c)).then(function(f){this.__prefs=f;return this.__prefs.populated()}.bind(c)).then(function(){for(var f=!1,g=0;g<this.__prefs.length;g++){var k=this.__prefs.at(g);"registered_through_alloy"!==k.get("name")&&"registered_through_mobile"!==k.get("name")&&"pure_mobile_access"!==k.get("name")||!k.get("value")||(f=!0,this.__window.location.reload())}f||(this.__window.location.href="/switch_to/classic/")}.bind(c))})},__onClickSignup:function(a){a.preventDefault();this.__googleAnalytics.recordSignUpClick("login");this.promiseResolver.resolve("signup");if("iOS"===this.__browserInfo.getMobileOS())this.__window.location="itms-apps://itunes.apple.com/us/app/imvu/id919745844?mt=8";else if("Android"===this.__browserInfo.getMobileOS())this.__window.location="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova";else if((a=new URL(this.__window.location.href).searchParams)&&a.get("next")){var c=a.get("next");a=null!==this.__window.location.host.match(/localhost\.imvu\.com$/)===!0?new URL("https://localhost.imvu.com/welcome/ftux/gender/"):new URL("https://secure.imvu.com/welcome/ftux/gender/");a.searchParams.append("next",c);this.__window.open(a,"_self")}else this.__window.location="/welcome/ftux/gender/"},__redirectToFtux:function(){this.$el.fadeOut(300,function(){this.__modeManager.openMode({mode:{id:"ftux"},submode:{id:"gender"}})}.bind(this))},__onClickCta:function(){"mobile"===this.__serviceProvider.get("platform")?"iOS"===this.__browserInfo.getMobileOS()?this.__window.location="itms-apps://itunes.apple.com/us/app/imvu/id919745844?mt=8":"Android"===this.__browserInfo.getMobileOS()?this.__window.location="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova":this.__window.location="https://about.imvu.com/mobile/":this.__redirectToFtux()},__onClickFB:function(){var a=this;"mobile"===this.__serviceProvider.get("platform")?this.__socialLogin.fbSDKLogin(this.__imvuLoginCallback.bind(this),function(){a.__dialogManager.confirm({title:a.__globalStringManager.get("ftux_frontpage_get_the_app"),text:a.__globalStringManager.get("ftux_frontpage_best_mobile_experience"),yes:a.__globalStringManager.get("ftux_frontpage_get_the_app_yes_btn"),no:a.__globalStringManager.get("ftux_frontpage_get_the_app_cancel_btn")}).finished.then(function(){this.__onClickCta()}.bind(a))}):this.__featureAccessManager.isElectronClient()?this.__window.navigator.onLine?this.__socialLogin.fbOauthLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this)):this.__dialogManager.alert({title:this.__globalStringManager.get("generic_offline_error_title"),text:this.__globalStringManager.get("generic_offline_error_message")}):this.__socialLogin.fbSDKLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this))},__onClickApple:function(){var a=this;"mobile"===this.__serviceProvider.get("platform")?this.__socialLogin.appleSDKLogin(this.__imvuLoginCallback.bind(this),function(){a.__dialogManager.confirm({title:a.__globalStringManager.get("ftux_frontpage_get_the_app"),text:a.__globalStringManager.get("ftux_frontpage_best_mobile_experience"),yes:a.__globalStringManager.get("ftux_frontpage_get_the_app_yes_btn"),no:a.__globalStringManager.get("ftux_frontpage_get_the_app_cancel_btn")}).finished.then(function(){this.__onClickCta()}.bind(a))},this.__appleErrorCallback.bind(this)):this.__featureAccessManager.isElectronClient()?this.__window.navigator.onLine?this.__socialLogin.appleOauthLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this),this.__appleErrorCallback.bind(this)):this.__dialogManager.alert({title:this.__globalStringManager.get("generic_offline_error_title"),text:this.__globalStringManager.get("generic_offline_error_message")}):this.__socialLogin.appleSDKLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this),this.__appleErrorCallback.bind(this))},__imvuLoginCallback:function(){var a=new URL(this.__window.location.href).searchParams;a&&a.get("next")?(a=a.get("next"),this.__window.location.href=decodeURIComponent(a)):this.__loginDestination?this.__window.location.href=decodeURIComponent(this.__loginDestination):this.__loginManager.getLoginDestination()?this.__window.location.href=this.__loginManager.getLoginDestination():this.__serviceProvider.services.overrideMode&&"ftux"!==this.__serviceProvider.services.overrideMode?(a=this.__serviceProvider.get("siteRoot"),a+=this.__serviceProvider.get("startMode")+"/",this.__serviceProvider.services.startSubmode&&(a+=this.__urlId(this.serviceProvider.get("startSubmode"))+"/"),this.__window.location.href=a):this.__window.location.reload()},__appleErrorCallback:function(a){var c=this.__globalStringManager.get("Error"),d=this.__globalStringManager.get("login_dialog_unknown_login_error");"user-disabled"===a?d=this.__globalStringManager.get("login_dialog_disabled_error"):"user-velocity"===a?d=this.__globalStringManager.get("login_dialog_try_again_later_error"):"user-service"===a&&(d=this.__globalStringManager.get("login_dialog_try_again_later_error_server_load"));this.__dialogManager.alert({title:c,text:d})},__togglePasswordVisibility:function(){var a=this.$(".login_password input"),c="password"==a.attr("type");a[0].setAttribute("type",c?"text":"password");this.$(".toggle-password-visibility").toggleClass("icon-password-show",!c).toggleClass("icon-password-hide",c);a.focus()},__forgotPassword:function(){this.__featureAccessManager.isElectronClient()||(this.__window.location=this.__forgotPasswordUrl)},__showPrivacyPolicyDialog:function(a){var c=h.PrivacyPolicyAdultDialog;a===this.__loginManager.ERROR_UNDERAGE?c=h.PrivacyPolicyMinorsDialog:a===this.__loginManager.ERROR_UNDERAGE_PENDING_CONSENT&&(c=h.PrivacyPolicyMinorsPendingDialog);return this.__dialogManager.showDialog(c)},__getLoginDestination:function(a){for(var c=["logoff"],d=0;d<c.length;d++)if(-1<a.indexOf(c[d])){a="/next";break}return a}},h.InputMixin))}({Dialogs:m["@Dialogs"],NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],ContextMenu:Ca,InputMixin:B,LoggedInPrefsManager:J,Mixin:C,PrivacyPolicyAdultDialog:Ba,PrivacyPolicyMinorsDialog:Ha,PrivacyPolicyMinorsPendingDialog:za,template:ua}),M=function(h){var b=h.LoggedOutTopNav;return b.extend("LoggedOutTopNavDesktop",{dependencies:"cookieManager dialogManager featureAccessManager googleAnalytics historyManager loginManager modeManager window".split(" "),trackedEvents:function(){return _.union([{type:"click",selector:".sign-in",name:"sign_in",handler:this.showLoginDialog},{type:"click",selector:".logo",name:"logo_click",handler:"__goToNext"}],b.prototype.trackedEvents.call(this))},render:function(){this.__showLogo=!0;this.$el.html(h.template({showLogo:this.__showLogo,showUpdateIndicator:this.__window.autoUpdate?!0:!1}));(this.__showLogin="/welcome/ftux/download/"!==this.__window.location.pathname)&&this.$(".fragment-placeholder").replaceWith(h.fragmentTemplate);this.listenTo(this.__historyManager,"stateChange",this.toggleLoginBasedOnState);this.toggleLoginBasedOnState();this.__serviceProvider.get("qaWeb")&&(this.__qaNav=this.createChildContext(h.QANav,{$parentElement:this.$(".system-tray").expect(1),emulateNetworkErrors:this.__serviceProvider.has("emulateNetworkError")}))},toggleLoginBasedOnState:function(){"/welcome/"!==this.__window.location.pathname&&"/welcome/ftux/download/"!=this.__window.location.pathname?this.$(".secondary-nav").removeClass("hidden"):this.$(".secondary-nav").addClass("hidden")},getLoginDialogFactory:function(){return h.LoginDialog},__showLoginDialog:$.noop,showLoginDialog:function(a){a.loginMode=a.loginMode||"ftux";this.__googleAnalytics.recordClick("welcome","show login");var c=this.__serviceProvider.get("loginDestination")||this.__serviceProvider.get("siteRoot").replace("welcome","next");this.__loginDialogFactory=this.getLoginDialogFactory();this.__loginDialog=this.__loginDialogFactory.default.prototype;return this.__dialogManager.showDialog(this.__loginDialogFactory,_.extend({loginDestination:c},a||{})).finished},__goToNext:function(a){this.__loginManager.isLoggedIn()?this.__window.location="/next/home/explore":this.showLoginDialog()}})}({LoggedOutTopNav:sa,LoginDialog:L,QANav:I,fragmentTemplate:ta,template:F}),N=function(h){var b=h.UiCore.UiEventReporter;return b.extend("WAFUiEventReporter",{dependencies:["modeManager","timestampHelper"],initialize:function(a){b.prototype.initialize.call(this,a);this.__modeManager=a.modeManager;this.__SESSION_TIME_LIMIT=1800;this.__lastEventRecordedTimestamp=null;this.__sessionGUID=h.NextUtil.DomHelper.createGUID();this.__timestampHelper=a.timestampHelper||this.__serviceProvider.get("timestampHelper")},recordEvent:function(a,c,d,e,f){if(this.__lastEventRecordedTimestamp){var g=this.__timestampHelper.now().unix();g-this.__lastEventRecordedTimestamp>this.__SESSION_TIME_LIMIT&&(this.__sessionGUID=h.NextUtil.DomHelper.createGUID());this.__lastEventRecordedTimestamp=g}else this.__lastEventRecordedTimestamp=this.__timestampHelper.now().unix();f.client_session_id=this.__sessionGUID;if(g=this.__modeManager.getCurrentMode())f.current_mode=g.id;c.match(/default/i)&&(c="next_default");b.prototype.recordEvent.call(this,a,c,d,e,f)},getServiceUrl:function(){return this.__serviceUrl},_setSessionGUID:function(a){this.__sessionGUID=a},_setLastRecordedTimestamp:function(a){this.__lastEventRecordedTimestamp=a}})}({NextUtil:m["@NextUtil"],UiCore:m["@UiCore"]}),Ia=function(h){return h.UiCore.ServiceProvider.extend("RealServiceProvider",{dependencies:["globalStartupModel"],initialize:function(b){h.UiCore.ServiceProvider.prototype.initialize.call(this);_.each(b,function(d,e){this.register(e,d)}.bind(this));var a=-1!==location.host.indexOf("localhost."),c="true"===localStorage.getItem("forceProduction");_.each({root:function(){return a&&!c?"https://api.localhost.imvu.com":"https://api.imvu.com"},uiEventReporter:function(){return this.create(h.UiCore.UiEventReporter)},localStorage:function(){return window.localStorage},defer:function(){return _.defer}},function(d,e){this.has(e)||this.register(e,d.call(this))}.bind(this))}})}({UiCore:m["@UiCore"]}),Ja=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e;c=this.escapeExpression;var f=a.helperMissing,g='<form class="social_login_service_failure_form" name="social_login_service_failure_form" method="GET" action="#">\n    <div class="label failure_warning">'+c((e=a.social_login_service||b&&b.social_login_service,"function"===typeof e?e.call(b,{name:"social_login_service",hash:{},data:d}):e))+" ",k=(e=a["i18n-g"]||b&&b["i18n-g"]||f,e.call(b,"social_login_service_failure_warning",{name:"i18n-g",hash:{},data:d}));if(k||0===k)g+=k;return g+'</div>\n</form>\n<footer class="dialog-footer">\n    <button class="btn btn-primary btn-dark" data-confirm="ok">'+c((e=a["i18n-g"]||b&&b["i18n-g"]||f,e.call(b,"social_login_service_failure_button",{name:"i18n-g",hash:{},data:d})))+"</button>\n</footer>"},useData:!0})}({}),Ka=function(h){var b=h.Dialogs.AlloyModalDialog;return b.extend("SocialLoginServiceFailureDialog",h.Mixin.mixin({uiContextName:"social_login_service_failure_dialog",className:"social-login-service-failure-dialog dialog-type-A",dependencies:["dialogManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:'[data-confirm="ok"]',name:"ok",handler:this.__onClose}]},initialize:function(a){this.__dialogManager=a.dialogManager;this.hasCloseButton=!1;this.__social_login_service=a.social_login_service;this.title=this.__social_login_service+a.globalStringManager.get("social_login_service_failure_title");b.prototype.initialize.call(this,a);this.addToDOM()},postRender:function(){this.setContent("body",h.template,{social_login_service:this.__social_login_service})}},h.InputMixin))}({Dialogs:m["@Dialogs"],NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],InputMixin:B,Mixin:C,template:Ja}),La=function(h){return IMVU.BaseClass.extend("GlobalVariablesManager",{initialize:function(b){this.__variables={}},add:function(b,a){if(this.__variables.hasOwnProperty(b))throw Error('Key "'+b+'" is already defined.');this.__variables[b]=a},set:function(b,a){if(this.__variables.hasOwnProperty(b))this.__variables[b]=a;else throw Error('Key "'+b+'" is not exist.')},has:function(b){return this.__variables.hasOwnProperty(b)},get:function(b){if(this.__variables.hasOwnProperty(b))return this.__variables[b];throw Error('Key "'+b+'" is not exist.')}})}({}),Ma=function(h){var b=IMVU.BaseClass;return b.extend("UrlManager",_.extend({dependencies:["window"],initialize:function(a){b.prototype.initialize.call(this,a);this.__window=a.window;this.__globalStartupModel=a.globalStartupModel;this.__library=h.UrlManagerLibrary},get:function(a){a=this.__library[a];return"undefined"===typeof a?null:a}}))}({Model:m["@Model"],UiCore:m["@UiCore"],UrlManagerLibrary:m["json!/common/waf/js/manager/UrlManager.json"]}),Na=function(h){var b=IMVU.BaseClass;return b.extend("TimestampHelper",{dependencies:["globalStringManager","Promise"],initialize:function(a){b.prototype.initialize.call(this,a);this.__serviceProvider=a.serviceProvider;this.__globalStringManager=a.globalStringManager;this.__moment=this.__serviceProvider.get("moment");a.now&&(this._now=a.now);this.setDifference(this.now())},_setNow:function(a){this._now=this.__moment(a)},_getDiffDate:function(){return this.__diffDate},_setDiffDate:function(a){this.__diffDate=a},now:function(){return this._now||this.__moment()},preMultipliedNowInUnix:function(){return 1e3*this.now().unix()},setDifference:function(a){this.__diffDate=this.__moment(a);this.__calcResult=this.__calcDiff(this.__diffDate,!1)},formatSingleUnit:function(a){a=void 0===a?this.__calcResult:a;var c=this.__calcDiff(this.__moment(a),!0);return this.__formatSingleUnit(this.__moment(a),c)},formatDaysOrWeeks:function(a){a=void 0===a?this.__calcResult:a;a=this.__calcDiff(this.__moment(a),!1);return this.__formatDaysOrWeeks(a)},sameGroup:function(a,c){a=this.__calcDiff(this.__moment(a),!1);c=this.__calcDiff(this.__moment(c),!1);return a.today&&c.today?!0:a.number===c.number&&a.text===c.text?!0:!1},sameDay:function(a,c){return this.__moment(a).isSame(this.__moment(c),"day")},formatDateAndTime:function(a){a&&this.setDifference(a);return this.__formatDateAndTime(this.__diffDate)},formatTime:function(a){a&&this.setDifference(a);return this.__formatTime(this.__diffDate)},feedItem:function(a){return a?this.__formatSingleUnitAgo(this.__diffDate,this.__calcResult):this.__formatSingleUnit(this.__diffDate,this.__calcResult)},messageHeaderDay:function(){return this.__calcResult.today?this.__formatDaysOrWeeks(this.__calcResult):"day"===this.__calcResult.text?1===this.__calcResult.number?this.__formatDaysOrWeeks(this.__calcResult):this.__getLongDayName():"year"===this.__calcResult.text?this.__diffDate.format("ll"):this.__getShortDayName()+", "+this.__getShortMonthName()+this.__diffDate.format(" D")},activityCenterHeader:function(){return this.__formatDaysOrWeeks(this.__calcResult)},activityCenterDetail:function(){if(this.__calcResult.today)return this.__formatSingleUnit(this.__diffDate,this.__calcResult);var a=this.__formatShortDate(this.__diffDate)+",",c=this.formatTime(this.__diffDate);if("day"===this.__calcResult.text){if(1===this.__calcResult.number)return c;a=this.__getLongDayName()}else"year"===this.__calcResult.text&&(a=this.__diffDate.format("ll"));return a+" "+c},chatDrawerTimestamp:function(){if(this.__calcResult.today)return this.formatTime(this.__diffDate);var a=this.__formatShortDate(this.__diffDate)+",",c=this.formatTime(this.__diffDate);if("day"===this.__calcResult.text){if(1===this.__calcResult.number)return c;a=this.__getLongDayName()}else"year"===this.__calcResult.text&&(a=this.__diffDate.format("ll"));return a+" "+c},messageDrawerDateTime:function(){return this.__calcResult.today?this.formatTime(this.__diffDate):"day"===this.__calcResult.text?1===this.__calcResult.number?this.__formatDaysOrWeeks(this.__calcResult):this.__getLongDayName():this.__diffDate.format("l")},orderDate:function(a){return this.__moment(a).format("LLLL")},formatTransactionHistoryDate:function(a,c){a=this.__moment(1e3*a);return a.format(c||"ll")},__getLongDayName:function(){return this.__diffDate.format("dddd")},__getShortDayName:function(){return this.__diffDate.format("ddd")},__getLongMonthName:function(){return this.__diffDate.format("MMMM")},__getShortMonthName:function(){return this.__diffDate.format("MMM")},formatActivityTimestamp:function(a){a=this.__moment(a);var c=this.__calcDiff(a,!1);if(c.today)return this.__formatSingleUnit(a,c);var d=this.__formatShortDate(a)+",",e=this.formatTime(a);"day"===c.text?d=1===c.number?this.__formatDaysOrWeeks(c):this.__getLongDayName():"year"===c.text&&(d=a.format("ll"));return d+" "+e},__formatDate:function(a){return a.format("LL")},__formatShortDate:function(a){return a.format("MMM D")},__formatTime:function(a){return a.format("LT")},__formatDateAndTime:function(a){return a.format("LLL")},__dayThreshold:function(a,c){return a.hours()<c.hours()||a.hours()===c.hours()&&a.minutes()<c.minutes()||a.minutes()===c.minutes()&&a.seconds<=c.seconds()},__calcDiff:function(a,c){var d=this.now(),e=d.diff(a,"minutes"),f=Math.floor(e/60);if(c||d.date()===a.date()){if(1>e)return{number:0,text:"minute",today:!0};if(60>e)return{number:e,text:"minute",today:!0};if(24>f)return{number:f,text:"hour",today:!0}}f=d.diff(a,"hour");e=c?Math.floor(f/24):d.diff(a,"day");c||this.__dayThreshold(d,a)&&e++;d.diff(a,"week");var g=d.diff(a,"month");if(7>e)return{number:e,text:"day",today:!1};c?30>e?e=d.diff(a,"day"):g=Math.floor(f/720):d.date()===a.date()&&this.__dayThreshold(d,a)&&g++;if(0===g)return a=Math.floor(e/7),{number:a,text:"week",today:!1};if(12>g)return{number:g,text:"month",today:!1};g=Math.round(e/30);return{number:Math.floor(g/12),text:"year",today:!1}},_setCalcResult:function(a){this.__calcResult=a},__formatSingleUnit:function(a,c){c=void 0===c?this.__calcResult:c;return 0===c.number&&"minute"===c.text?this.__globalStringManager.get("Just now"):_.contains(["week","month"],c.text)?a.format("MMM D"):"year"===c.text?a.format("l"):this.__globalStringManager.get("ts_short_"+c.text,{howMany:c.number})},__formatSingleUnitAgo:function(a,c){c=void 0===c?this.__calcResult:c;return 0===c.number&&"minute"===c.text?this.__globalStringManager.get("Just now"):_.contains(["week","month"],c.text)?a.format("MMM D"):"year"===c.text?a.format("l"):this.__globalStringManager.get("ts_short_ago_"+c.text,{howMany:c.number})},__formatDaysOrWeeks:function(a){a=void 0===a?this.__calcResult:a;return a.today?this.__globalStringManager.getPluralized("ts_timebreak_day",{howMany:0}):this.__globalStringManager.getPluralized("ts_timebreak_"+a.text,{howMany:a.number})}})}({UiCore:m["@UiCore"]}),Oa=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e;c=a.helperMissing;var f='<p class="status"></p>\n<p class="timer">',g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"Retry in",{name:"i18n-g",hash:{},data:d}));if(g||0===g)f+=g;f+=' <span class="clock"></span></p>\n<button class="btn retry">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"Try Now",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;return f+"</button>"},useData:!0})}({}),Pa=function(h){var b=h.UiCore.UiContext;return b.extend("ImqStatus",{className:"imq-status",uiContextName:"imq_status",dependencies:["globalStringManager","imqManager","timer"],trackedEvents:function(){return[{type:"click",selector:"button.retry",name:"retry",handler:this.__reconnect}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__serviceProvider=a.serviceProvider;this.__imqManager=a.imqManager;this.__globalStringManager=a.globalStringManager;this.__timer=a.timer;this.__imqManager.state.on("change:status",this.__update,this);this.__update()},delete:function(){this.__timer.clearTimeout(this.__tickTimeout);b.prototype.delete.call(this)},render:function(){this.$el.html(h.template)},__update:function(){var a=this.__imqManager.state.get("status");if(!this.__hasEverDisconnected)if("disconnected"===a)this.__hasEverDisconnected=!0,this.addToDOM();else return;this.__timer.clearTimeout(this.__tickTimeout);switch(a){case"connected":var c=this.__globalStringManager.get("Connected!");break;case"disconnected":c=this.__globalStringManager.get("Not connected");this.__tick();break;default:c=this.__globalStringManager.get("Connecting")}this.$(".status").text(c);this.$el.toggleClass("connected","connected"===a);this.$el.toggleClass("connecting","connecting"===a);this.$("button.retry").prop("disabled","disconnected"!==a)},__tick:function(){var a=this.__imqManager.state.get("connectAt");a=Math.round((a-this.__timer.getTime())/1e3);var c=Math.floor(a/60);a%=60;this.$(".timer .clock").text(c+":"+(10>a?"0":"")+a);this.__tickTimeout=this.__timer.setTimeout(this.__tick.bind(this),1e3)},__reconnect:function(){this.__imqManager.connect()}})}({UiCore:m["@UiCore"],template:Oa}),Qa=function(h){return IMVU.BaseClass.extend("TouchEventHelper",{dependencies:["timer","window"],initialize:function(b){this.__window=b.window;this.__timer=b.timer;_.bindAll(this,"__touchStart","__touchEvent","__touchChanged","__touchMove","__touchEnd","generateTrackedEvents")},__touchStart:function(b,a){null===b.touchStartId&&(b.touchStartId=a.originalEvent.changedTouches[0].identifier,b.touchStartX=a.originalEvent.changedTouches[0].pageX,b.touchStartY=a.originalEvent.changedTouches[0].pageY,b.movedX=!1,b.movedY=!1,b.timeStart=this.__timer.getTime(),b.hasFiredLongPress=!1,b.trackLongPress&&(b.longPressTimer=this.__timer.setTimeout(function(){b.hasFiredLongPress||(b.hasFiredLongPress=!0,$(a.target).trigger("longpress"))},500)),$(a.target).trigger("swipestart"))},__touchEvent:function(b,a){b=jQuery.Event(b);b.swipeDistance=Math.abs(a);return b},__touchChanged:function(b,a,c){if(null!==b.touchStartId){var d=!0,e=null;_.each(a.originalEvent.changedTouches,function(n){n.identifier===b.touchStartId&&(e=n)});if(null!==e){var f=e.pageX-b.touchStartX,g=Math.abs(f),k=e.pageY-b.touchStartY,l=Math.abs(k);(10<g||10<l)&&this.__timer.clearTimeout(b.longPressTimer);!b.movedY&&(c||b.trackHorizontalMoves)&&(b.movedX||g>l||10>=l)&&(10<f?($(a.target).trigger(this.__touchEvent("swiperight",f)),b.touchStartX=e.pageX,b.movedX=!0,d=!1,b.triggeredSwipe=!0,this.__timer.clearTimeout(b.longPressTimer)):-10>f&&($(a.target).trigger(this.__touchEvent("swipeleft",f)),b.touchStartX=e.pageX,b.movedX=!0,d=!1,b.triggeredSwipe=!0,this.__timer.clearTimeout(b.longPressTimer)));!b.movedX&&(c||b.trackVerticalMoves)&&(b.movedY||l>g||10>=g)&&(10<k?($(a.target).trigger(this.__touchEvent("swipedown",k)),b.touchStartY=e.pageY,b.movedY=!0,d=!1,b.triggeredSwipe=!0,this.__timer.clearTimeout(b.longPressTimer)):-10>k&&($(a.target).trigger(this.__touchEvent("swipeup",k)),b.touchStartY=e.pageY,b.movedY=!0,d=!1,b.triggeredSwipe=!0,this.__timer.clearTimeout(b.longPressTimer)));b.trackLongPress&&(a=500<=this.__timer.getTime()-b.timeStart,10>=g&&10>=l&&c&&a&&(d=!1))}else d=null;return d}return null},__touchMove:function(b,a){this.__touchChanged(b,a,!1)},__touchEnd:function(b,a){var c=this.__touchChanged(b,a,!0);null!==c&&(b.touchStartId=null,c||a.preventDefault(),this.__timer.clearTimeout(b.longPressTimer));b.triggeredSwipe&&$(a.target).trigger("swipeend")},generateTrackedEvents:function(b,a){var c={touchStartId:null,touchStartX:null,trackVerticalMoves:!1,trackHorizontalMoves:!1,trackLongPress:!1},d=[{type:"touchstart",selector:b,name:"touch_start",handler:this.__touchStart.bind(null,c)},{type:"touchend",selector:b,name:"touch_end",handler:this.__touchEnd.bind(null,c)},{type:"touchcancel",selector:b,name:"touch_cancel",handler:this.__touchEnd.bind(null,c)}];a&&(c.trackVerticalMoves=!!a.trackVerticalMoves,c.trackHorizontalMoves=!!a.trackHorizontalMoves,c.trackLongPress=!!a.trackLongPress);(c.trackVerticalMoves||c.trackHorizontalMoves||c.trackLongPress)&&d.push({type:"touchmove",selector:b,name:"touch_move",handler:this.__touchMove.bind(null,c)});return d}})}({}),Ra=function(h){var b=IMVU.BaseClass;return b.extend("SubscriptionManager",{dependencies:["Promise"],log:function(){$jscomp.getRestArguments.apply(0,arguments)},initialize:function(a){b.prototype.initialize.call(this,a);this.__Promise=a.Promise;this.__subMap={};this.STATE_OPEN_ROOM_INFO=1;this.STATE_CLOSE_ROOM_INFO=2;this.STATE_JOIN=3;this.STATE_LEAVE=4},validateRoomId:function(a){if("string"!==typeof a)throw Error("Expecting a string roomId but got "+IMVU.repr(a))},getSub:function(a){a=a.roomId;this.validateRoomId(a);a in this.__subMap||(this.__subMap[a]={});return this.__subMap[a]},setState:function(a){var c=a.roomId;a=a.state;this.validateRoomId(c);c=this.getSub({roomId:c});switch(a){case this.STATE_OPEN_ROOM_INFO:if(c.state===this.STATE_JOIN)return;break;case this.STATE_JOIN:break;case this.STATE_LEAVE:this.unsubscribeFromRoomExperience(c.config);break;case this.STATE_CLOSE_ROOM_INFO:if(c.state!==this.STATE_JOIN&&c.config)this.unsubscribeFromRoomExperience(c.config);else return;break;default:throw Error("Unknown state: "+a)}c.state=a},waitForMounts:function(a){var c=a.roomId,d=a.imqManager,e=a.queueName,f=a.mountName,g=a.callback,k=a.sub,l=a.stateMount;this.log("Waiting for mounts "+c+" "+e+" "+f,l);var n=0,p=function(){l.queue.messageMounts.audience_message_mount&&l.queue.messageMounts.scene_message_mount&&l.queue.stateMounts.audience_state_mount&&l.queue.stateMounts.scene_state_mount?(k.config={roomId:c,imqManager:d,queueName:e,mountName:f,stateMount:l},k.subscribed=!0,k.resolver.resolve({queueName:l.queue.name})):e in d.queues&&7200>n++&&window.requestAnimationFrame(p)};p();k.resolver.promise.then(function(){return g({stateMount:l})})},subscribeToRoomExperience:function(a){var c=this,d=a.roomId,e=a.imqManager,f=a.queueName,g=a.mountName,k=a.callback,l=this.getSub({roomId:d});this.log("Subscribing to "+d+" "+f+" "+g,l);this.validateRoomId(d);if(l.subscribed)return this.log("Already subscribed to "+d+" "+f+" "+g),k({stateMount:l.config.stateMount}),l.resolver.promise;l.subscribed=!1;new this.__Promise(function(n){return l.resolver=n});e.subscribeState(f,g,function(n,p){c.log("Successfully subscribed to "+d+" "+f+" "+g,p);c.waitForMounts({roomId:d,imqManager:e,queueName:f,mountName:g,callback:k,sub:l,stateMount:p})});return l.resolver.promise},unsubscribeFromRoomExperience:function(a){var c=this;if(a&&a.roomId){var d=a.roomId,e=this.getSub({roomId:d});this.log("Request unsubscription from "+d,e);this.validateRoomId(d);if(!e||!e.subscribed)throw Error("Attempted to unsubscribe from "+d+" but not subscribed!");e.resolver.promise.then(function(){c.log("Unsubscribing from "+d+" "+e.config.queueName);e.config.imqManager.unsubscribeQueue(e.config.queueName);delete c.__subMap[d]})}}})}({}),Sa=function(h){var b={native_top:{id:93999,width:470,height:250},leaderboard:{id:93998,width:728,height:90},top_banner:{id:96840,width:970,height:250},side_banner:{id:96841,width:300,height:600},mobile:{id:96780,width:320,height:50}},a=IMVU.BaseClass;return a.extend("SmartAdHelper",{dependencies:["random","window"],initialize:function(c){a.prototype.initialize.call(this,c);this.__serviceProvider=c.serviceProvider;this.__appMonitor=null;this.__random=c.random;this.__window=c.window},__logWaypoint:function(c,d){if(null===this.__appMonitor&&this.__serviceProvider.has("appMonitor")){var e=this.__serviceProvider.get("appMonitor");this.__appMonitor=e?e:null}this.__appMonitor&&this.__appMonitor.waypoint(c,d)},getSiteId:function(c){this.__logWaypoint("SmartAdHelper::getSizeID - ENTER",c);var d="";switch(c){case"darwin_app":d=411292;break;case"win64_app":d=411292;break;case"desktop":d=367683;break;case"mobile":d=349686}return d},getTagId:function(){var c="sas_"+this.__random.getUUID();this.__logWaypoint("SmartAdHelper::getTagId",c);return c},getFormat:function(c){return b[c]},getPageId:function(c,d){var e="";if("darwin_app"===c||"win64_app"===c)switch(d){case"native_feed":e=1381988;break;case"native_shop":e=1381989;break;case"messages":e=1381990;break;case"daily_spin":e=1381991;break;case"featured_offers":e=1381992;break;case"offers":e=1381993;break;case"surveys":e=1381994;break;case"videos":e=1381995}else if("desktop"===c)switch(d){case"native_feed":e=1309107;break;case"native_shop":e=1335845;break;case"messages":e=1335844;break;case"daily_spin":e=1382004;break;case"featured_offers":e=1382005;break;case"offers":e=1382006;break;case"surveys":e=1382006;break;case"videos":e=1382008}else if("mobile"===c)switch(d){case"native_feed":e=1226941;break;case"native_shop":e=1381997;break;case"messages":e=1381998;break;case"daily_spin":e=1381999;break;case"featured_offers":e=1382e3;break;case"offers":e=1382001;break;case"surveys":e=1382002;break;case"videos":e=1382003}this.__logWaypoint("SmartAdHelper::getPageId",e);return e}})}({UiCore:m["@UiCore"]}),Ta=function(h){var b=IMVU.BaseClass;return b.extend("CounterHelper",{dependencies:["featureAccessManager","globalStartupModel","rest","window"],initialize:function(a){b.prototype.initialize.call(this,a);this.__serviceProvider=a.serviceProvider;this.__featureAccessManager=a.featureAccessManager;this.__globalStartupModel=a.globalStartupModel;this.__rest=a.rest;this.__marketingPlatform=this.__featureAccessManager.getMarketingPlatform();this.__marketingPlatform="string"!==typeof this.__marketingPlatform?null:this.__marketingPlatform.replace("-","_");this.__counterURL=null;this.__enabled=!1;this.__globalStartupModel.populated().then(function(){this.__counterURL=this.__globalStartupModel.get("nextCounterURL");this.__enabled=this.__featureAccessManager.canSeeCounterHelper()}.bind(this))},increment:function(a){if(!this.__enabled)return!0;switch(a){case"eperm_write_error":case"report_error_failure":case"worker_thread_launch_failure":case"preview_timeout_error":case"javascript_window_error":case"new_high_rate_window_error":a="app_monitor."+a+"."+this.__marketingPlatform;break;case"creator_landing":case"next_dashboard":case"next_dollar_store":case"next_web_download":case"welcome_ftux_account":case"welcome_ftux_bridge":case"welcome_login_dialog":case"permalink_room_logged_in":case"permalink_room_logged_out":case"permalink_feed_logged_in":case"permalink_feed_logged_out":case"permalink_profile_logged_in":case"permalink_profile_logged_out":case"permalink_product_logged_in":case"permalink_product_logged_out":a="app_monitor."+a+".loaded";break;default:return this.__window.error("CounterHelper::increment - Invalid eventName specified:",a),!1}this.__rest.post(this.__counterURL,{event_name:a});return!0}})}({UiCore:m["@UiCore"]}),Ua=function(){var h=new Uint32Array(80);return function(b){function a(r){t[n]|=(r&255)<<p;p?p-=8:(n++,p=24);16===n&&c()}function c(){for(var r=16;80>r;r++){var u=t[r-3]^t[r-8]^t[r-14]^t[r-16];t[r]=u<<1|u>>>31}u=e;var v=f,w=g,x=k,D=l;for(r=0;80>r;r++){if(20>r)var y=x^v&(w^x),A=1518500249;else 40>r?(y=v^w^x,A=1859775393):60>r?(y=v&w|x&(v|w),A=2400959708):(y=v^w^x,A=3395469782);y=(u<<5|u>>>27)+y+D+A+(t[r]|0);D=x;x=w;w=v<<30|v>>>2;v=u;u=y}e=e+u|0;f=f+v|0;g=g+w|0;k=k+x|0;l=l+D|0;for(r=n=0;16>r;r++)t[r]=0}function d(r){for(var u="",v=28;0<=v;v-=4)u+=(r>>v&15).toString(16);return u}var e=1732584193,f=4023233417,g=2562383102,k=271733878,l=3285377520,n=0,p=24,q=0,t=b?h:new Uint32Array(80);return{update:function(r){if("string"===typeof r){var u=r.length;q+=8*u;for(var v=0;v<u;v++)a(r.charCodeAt(v))}else for(u=r.length,q+=8*u,v=0;v<u;v++)a(r[v])},digest:function(){a(128);(14<n||14===n&&24>p)&&c();n=14;p=24;a(0);a(0);a(0xffffffffff<q?q/1099511627776:0);a(4294967295<q?q/4294967296:0);for(var r=24;0<=r;r-=8)a(q>>r);return d(e)+d(f)+d(g)+d(k)+d(l)}}}}({}),Va=function(h){return IMVU.BaseClass.extend("ImageManager",{dependencies:["dataUrlCache","Promise","timer","window"],initialize:function(b){this.Promise=b.Promise;this.__dataUrlCache=b.dataUrlCache;this.__imageErrorEvent=b.imageErrorEvent||"error";this.__timer=b.timer;this.__window=b.window;this.__BLANK_IMAGES=h.BlankImageList;this.__imageClass=IMVU.optionalProperty(b,"imageClass",Image)},load:function(b,a,c){c=void 0===c?{}:c;a.match(/\/rendered_image\//)&&(a=a.replace(/\.localhost/,""));b=this.__getImageAndContainer(b,a,c);var d=b.img,e=b.container;a=b.src;"furniture"===c.category&&(d[0].crossOrigin="Anonymous");return new this.Promise(function(f){d.on("load",this.__finishImageLoad.bind(this,d,e,c,f));d.on(this.__imageErrorEvent,this.__handleImageError.bind(this,d,e,c,f));e.addClass("loading");d.addClass("is-loading");d.attr({src:a})}.bind(this))},__getImageAndContainer:function(b,a,c){b=$(b);var d=c.container?$(c.container):b;b!==d||b.siblings().length||(d=b.parent());c.cacheBuster&&(c=-1<a.indexOf("?")?"&":"?",a=a+c+this.__timer.getTime());return{img:b,container:d,src:a}},__finishImageLoad:function(b,a,c,d,e){var f=this,g=b[0].naturalWidth,k=b[0].naturalHeight;b.removeClass("is-loading");this.__detectingBlankImage=!1;"furniture"===c.category&&(this.__detectingBlankImage=!0,this.__detectBlankImage(b,g,k,a,c,d));var l=b[0],n=l.src;if(c.forceStaticImage&&!n.startsWith("data:")){var p=g,q=k;c.forceStaticImage.resize&&(p=c.forceStaticImage.resize.width,q=c.forceStaticImage.resize.height);if(this.__dataUrlCache.get(n,p,q))l.src=this.__dataUrlCache.get(n,p,q);else{var t=new Image;t.crossOrigin="Anonymous";t.src=n;t.onload=function(){var r=0,u=p,v=q;"cover"===c.forceStaticImage.fit&&(g<k?v=Math.round(q/g*k):g>k&&(u=p/k,r=-(g/2-k/2)*u,u=Math.round(g*u)));var w=document.createElement("canvas");w.width=p;w.height=q;w.getContext("2d").drawImage(t,r,0,u,v);r=w.toDataURL("image/png");f.__dataUrlCache.set(n,r,u,v);l.src=r;l.onload=function(){a.removeClass("loading").addClass("loaded")}}}}else a.removeClass("loading").addClass("loaded");this.__detectingBlankImage||d.accept()},__handleImageError:function(b,a,c,d){a.removeClass("loading").addClass("error");a.addClass("placeholder-error");c.defaultImage&&b.attr({src:c.defaultImage});d.reject()},__makeBackgroundImage:function(b,a){b.addClass(a.attr("class")).css("background-image","url("+a.attr("src")+")");a.off().remove()},getExifData:function(b){var a=this.__window.EXIF;return new this.Promise(function(c){a.getData(b,function(){c.accept(a.getAllTags(this))})}.bind(b))},loadAsBackgroundImage:function(b,a,c){var d=document.createElement("img");this._$lastDummyImage=$(d);b=this.__makeBackgroundImage.bind(this,$(b),$(d));return this.load($(d),a,c).then(b).catch(b)},_spyOnLoadAsBackgroundImage:function(){var b=this.loadAsBackgroundImage;this.loadAsBackgroundImage=function(){var a=b.apply(this,arguments);this._$lastDummyImage.trigger("load");return a};this.loadAsBackgroundImage.cleanUpSpy=function(){this.loadAsBackgroundImage=b}},__detectBlankImage:function(b,a,c,d,e,f){a=b[0];c=document.createElement("canvas");var g=c.getContext("2d");c.width=b[0].naturalWidth;c.height=b[0].naturalHeight;g.drawImage(a,0,0);a=g.getImageData(0,0,150,150);c=h.sha1();c.update(a.data);a=c.digest();this.__BLANK_IMAGES.blacklist.includes(a)&&this.__handleImageError(b,d,e,f);this.__detectingBlankImage=!1},getImageSizeFromSrc:function(b,a,c){return new this.Promise(function(d){if(a&&c)d.resolve({dimX:a,dimY:c});else if(_.isUndefined(b)||_.isNull(b))d.resolve({dimX:a||0,dimY:c||0});else{var e=new this.__imageClass;e.onload=function(){d.resolve({dimX:a||e.width,dimY:c||e.height})};e.onerror=function(){d.resolve({dimX:0,dimY:0})};e.src=b}}.bind(this))},resizeImage:function(b,a,c){var d=document.createElement("canvas");d.width=a;d.height=c;d.getContext("2d").drawImage(b,0,0,a,c);return d.toDataURL()},cropImage:function(b,a,c,d,e){var f=document.createElement("canvas");f.width=a;f.height=c;var g=f.getContext("2d");if(d&&(0>d||d>b.width))throw Error("The crop source origin X should be in the range (0, "+b.width+").");if(e&&(0>e||e>b.height))throw Error("The crop source origin Y should be in the range (0, "+b.height+").");g.drawImage(b,d||(b.width<=a?0:(b.width-a)/2),e||(b.height<=c?0:(b.height-c)/2),b.width>=a?a:b.width,b.height>=c?c:b.height,0,0,b.width>=a?a:b.width,b.height>=c?c:b.height);return f.toDataURL()},createColorImage:function(b,a,c){var d=document.createElement("canvas");d.width=a;d.height=c;var e=d.getContext("2d");e.fillStyle=b;e.fillRect(0,0,a,c);return d.toDataURL()},combineImages:function(b,a,c){a=void 0===a?270:a;c=void 0===c?180:c;var d=b.$canvas[0].getContext("2d");d.clearRect(0,0,d.canvas.width,d.canvas.height);a=Math.min(a/b.width,c/b.height);b.$canvas[0].width=b.width*a;b.$canvas[0].height=b.height*a;d.drawImage(b.baseImg,0,0,b.$canvas[0].width,b.$canvas[0].height);d.globalAlpha=b.opacity?b.opacity:1;b.posX=b.posX||0;b.posY=b.posY||0;b.FGWidth=b.FGWidth||100;b.FGHeight=b.FGHeight||100;d.drawImage(b.overlayImg,b.posX,b.posY,b.FGWidth,b.FGHeight);this.__drawResizeBox(b)},__drawResizeBox:function(b){var a=b.$canvas[0].getContext("2d");a.globalAlpha=1;a.strokeStyle="red";a.lineWidth=2;a.setLineDash([6]);a.strokeRect(b.posX,b.posY,b.FGWidth,b.FGHeight);a.fillStyle="red";a.fillRect(b.posX-3,b.posY-3,6,6);a.fillRect(b.posX+b.FGWidth-3,b.posY-3,6,6);a.fillRect(b.posX-3,b.posY+b.FGHeight-3,6,6);a.fillRect(b.posX+b.FGWidth-3,b.posY+b.FGHeight-3,6,6)}})}({exif:m["@exif"],Model:m["@Model"],BlankImageList:m["json!/common/waf/js/manager/BlankImageList.json"],sha1:Ua}),O=function(h){return IMVU.BaseClass.extend("StringManager",{dependencies:["cookieManager","dictionary","window"],initialize:function(b){this.__cookieManager=b.cookieManager;this.__dictionary=b.dictionary;this.__window=b.window;if(!this.__dictionary)throw Error("StringManager requires a dictionary");this.__appMonitor=null;this.serviceProvider=b.serviceProvider},__getAppMonitor:function(){if(!this.__appMonitor&&this.serviceProvider.has("appMonitor")){var b=this.serviceProvider.get("appMonitor");b&&(this.__appMonitor=b)}return this.__appMonitor},__process_placeholders:function(b,a){_.each(a,function(c,d){b=b.replace(new RegExp("{{\\s*"+d+"\\s*}}","g"),c)});return b},isImvuese:function(){return"1"===this.__cookieManager.get("imvuese")},get:function(b,a){if(this.isImvuese())return"{"+b+"}";var c=this.__dictionary[b];if(!_.isString(c))throw a='Unable to find text: "'+b+'" in translation dictionary. Use getWithDefault to set default value.',this.__getAppMonitor()?this.__appMonitor.reportCustomError("StringManager","get","web_perm_0018",a,["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]):this.__window.appMonitorPending.push(["UIContextExtension","initialize","web_perm_0018",a,["Bad key["+b+"]"]]),Error(a);return this.__process_placeholders(c,a)},getWithDefault:function(b,a,c){if(this.isImvuese())return"{"+b+"}";if("string"!==typeof a)throw Error("defaultText must be a string, but got "+IMVU.repr(a));b=this.__dictionary[b];return _.isString(b)?this.__process_placeholders(b,c):a},getPluralized:function(b,a){if(this.isImvuese())return"{"+b+"}";var c=parseInt(a.howMany,10);return 0===c?this.get(b+"_none",a):this.get(b+(2>c?"_singular":"_plural"),a)},handlebarsHelper:function(b,a){return this.get(b,a.hash)},handlebarsHelperWithDefault:function(b,a,c){return this.getWithDefault(b,a,c)}})}({}),Wa=function(h){var b=h.UiCore.UiContext;return b.extend("ContextMenuManager",{uiContextName:"context_menu_manager",tagName:"section",className:"context-menu-manager",MOUSE_MARGIN:10,initialize:function(a){b.prototype.initialize.call(this,a);this.__serviceProvider=a.serviceProvider;this.__mouseMargin=_.isUndefined(a.mouseMargin)?this.MOUSE_MARGIN:a.mouseMargin;this.__$parentElement=a.$parentElement;this.__boundOnScroll=this.__onScroll.bind(this);this.addToDOM()},toggleMenu:function(a,c,d){this.isContextMenuOpen()?this.closeMenu(a):this.showMenu(a,c,d)},showMenu:function(a,c,d){d=void 0===d?{}:d;this.closeMenu();this.$el.addClass("in-use");var e=d.displayOptions||{};d.location={mousePos:[a.clientX,a.clientY],mirror:[e.right,e.above]};this.__menu=this.createChildContext(c,_.extend({$parentElement:this.$el},d));this.__menu.on("item-chosen",this.closeMenu.bind(this));this.__menu.on("resize",this.__positionMenu.bind(this));h.NextUtil.DomHelper.dismissible({dismissibleEl:this.__menu.$el,dismissHandler:this.closeMenu.bind(this),openerEl:a.target});this.__positionMenu(a,d.chatStreamProfile);$("body").append(this.$el);_.bindAll(this,"closeMenu");document.addEventListener("scroll",this.__boundOnScroll,!0)},__positionMenu:function(a,c){var d=this.__menu.location.mirror,e=this.__menu.location.mousePos;if(c){c=a.target.getBoundingClientRect();var f=[c.right+22,c.top+a.target.height/2+-18];a=_.times(2,function(n){return Math.max(0,f[n])}.bind(this))}else{var g=""!==this.__menu.mouseMargin?this.__menu.mouseMargin:this.__mouseMargin,k=[this.$el.width(),this.$el.height()],l=[this.__menu.$el.width(),this.__menu.$el.height()];a=_.times(2,function(n){return Math.max(0,Math.min(k[n]-l[n],d[n]?e[n]-l[n]-g:e[n]+g))}.bind(this))}this.__menu.$el.css({left:a[0],top:a[1]})},__onScroll:function(a){this.__menu&&(this.__menu.$el.is(a.target)||0<this.__menu.$el.has(a.target).length)||this.__menu.shouldCloseOnScroll()||this.closeMenu()},closeMenu:function(a){document.removeEventListener("scroll",this.__boundOnScroll,!0);this.$el.removeClass("in-use");this.__menu&&(this.__menu.delete(),this.__menu=null);this.__$parentElement.append(this.$el)},getMenu:function(){return this.__menu},isContextMenuOpen:function(){return!!this.__menu},delete:function(){$("body").off("click.contextMenuManager");b.prototype.delete.call(this)}})}({NextUtil:m["@NextUtil"],UiCore:m["@UiCore"]}),P=function(h){var b=IMVU.BaseClass;return b.extend("LoggedOutFeatureAccessManager",{dependencies:"browserInfo cookieManager globalStartupModel localStorage platform serviceProvider window".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__browserInfo=a.browserInfo;this.__cookieManager=a.cookieManager;this.__globalStartupModel=a.globalStartupModel;this.__localStorage=a.localStorage;this.__platform=a.platform;this.__serviceProvider=a.serviceProvider;this.__window=a.window},__logFB:function(){var a=$jscomp.getRestArguments.apply(0,arguments);null!==this.__localStorage.getItem("debug.fb")&&this.__window.console.log.apply(this.__window.console,$jscomp.arrayFromIterable(a))},__compareToAppVersion:function(a,c){c=c||this.__serviceProvider.get("appVersion");if("@DEV"===c)return"dev";0===c.indexOf("Electron/")&&(c=c.substring(9));var d=c.split(".");c=parseInt(d[0]);var e=parseInt(d[1]),f=parseInt(d[2]);d=(this.__globalStartupModel.get(a)||"99999.99999.99999").split(".");a=parseInt(d[0]);var g=parseInt(d[1]);d=parseInt(d[2]);return c<a?-1:c>a?1:e<g?-1:e>g?1:f<d?-1:f>d?1:0},__getBool:function(a){return"1"===this.__localStorage.getItem(a)},getPlatform:function(){return this.__platform},getMarketingPlatform:function(){var a=this.getPlatform();return"studio"===this.__serviceProvider.get("appName")?"studio-client":this.isElectronClient()?"desktop-client":"mobile"===a?"web-small":"desktop"===a?"web-big":""},canSeeQA:function(){return this.__getBool("is_qa")},isElectronClient:function(){var a=!1;try{a=this.__window.parent&&this.__window.parent.electronRequire?!0:!1}catch(c){}return"win64_app"===this.__platform||"darwin_app"===this.__platform||a},isMobile:function(){return"mobile"===this.__platform||"desktop"===this.__platform&&1<this.__window.navigator.maxTouchPoints&&"MacIntel"===this.__window.navigator.platform&&"undefined"!==typeof this.__window.navigator.standalone},isInDollarStoreIframe:function(){return this.__window.parent.location!==this.__window.location},canRenderIframe:function(){return!this.isElectronClient()},canSeeFacebookLogin:function(){if(parseInt(this.__globalStartupModel.get("nextFBLoginKillSwitchAll")))return this.__logFB("LoggedOutFeatureAccessManager::canSeeFacebookLogin - Facebook login all kill switch on"),!1;var a=this.isElectronClient();return parseInt(this.__globalStartupModel.get("nextFBLoginKillSwitchWeb"))&&!a||parseInt(this.__globalStartupModel.get("nextFBLoginKillSwitchDesktop"))&&a?(this.__logFB("LoggedOutFeatureAccessManager::canSeeFacebookLogin - Facebook login web kill switch on"),!1):!0},canSeeAppMonitor:function(){if(parseInt(this.__globalStartupModel.get("nextAppMonitorKillSwitch")))return this.__window.console.log("LoggedOutFeatureAccessManager::canSeeAppMonitor - AppMonitor master kill switch on"),!1;if(parseInt(this.__globalStartupModel.get("nextAppMonitorKillSwitchWeb")))return this.__window.console.log("LoggedOutFeatureAccessManager::canSeeAppMonitor - AppMonitor web kill switch on"),!1;var a=this.__serviceProvider.get("appName");if("studio"===a&&parseInt(this.__globalStartupModel.get("nextAppMonitorKillSwitchStudio")))return this.__window.console.log("LoggedOutFeatureAccessManager::canSeeAppMonitor - AppMonitor studio kill switch on for  appName ("+a+")"),!1;if(this.isElectronClient()){a=this.__compareToAppVersion("nextAppMonitorMinVersion");if("dev"===a)return this.__window.console.log("LoggedOutFeatureAccessManager::canSeeAppMonitor - returning true since this is a development client"),!0;if(-1===a)return this.__window.console.log("LoggedOutFeatureAccessManager::canSeeAppMonitor - returning false due to diff ("+String(a)+") showing less than minimum version"),!1}this.__window.console.log("LoggedOutFeatureAccessManager::canSeeAppMonitor - returning default true");return!0},canSeeAppMonitorHeartbeat:function(){return!1},canSeeCounterHelper:function(){return parseInt(this.__globalStartupModel.get("nextCounterHelperKillSwitch"))?!1:!0},canSeeRoomBridge:function(){return!1},hasWhitelistAccess:function(){return!1},hasTeenRecommendedAccess:function(){return!1},canSeeRoomFurnitureCategories:function(){return!1},canSeeLiveRoomEdits:function(){return!1},canSeeTutorials:function(){return!1},canSeeDiagnostics:function(){return!1},canSeeRoomRecommender:function(){return!1},forceShowYellowServiceBar:function(){return this.__getBool("next.show_yellow_service_bar")},forceShowYellowCSBar:function(){return this.__getBool("next.show_yellow_cs_bar")},forceShowPurpleEventBar:function(){return this.__getBool("next.show_purple_event_bar")},forceShowPerformanceErrorBar:function(){return this.__getBool("next.show_red_performance_bar")},forceShowSlowInternetErrorBar:function(){return this.__getBool("next.show_red_slow_internet_bar")},canSeeProductRecommender:function(){return this.__getBool("next.can_see_product_recommender")},shouldPauseLiveRooms:function(){return!0},canSee3D:function(){return this.__webGL.canUse3d()},canGet3DroomLoadingStats:function(){return!1},canSeeSyncedMedia:function(){return!1},isSandboxOrTesting:function(){return-1!==location.host.indexOf("localhost.")},canSeeLiveRooms:function(){return!1},canSeeWindows5050:function(){return!0},canSeeAppleSignIn:function(){return!0},canSetDynamicTexture:function(){return!1},canSeeAppLaunch:function(){return!1},canEveryoneSeeRoomDeco2:function(){return!1},canSeeRoomDeco2:function(){return!1},canSeeRoomDeco2Toolbar:function(){return!1},canSeeRoomDeco2ToolbarFloating:function(){return!1},canSaveSceneSpec:function(){return!1},canSeeFreeplay:function(){return!1},canSeeOnboardingGamification:function(){var a=this.__globalStartupModel.get("onboardingGamificationEnabled"),c=this.__globalStartupModel.get("onboardingGamificationGroup");c=["group_a","group_b","group_c","group_d"].includes(c);return this.__getBool("is_qa")&&!!this.__localStorage.getItem("onboardingGamification.forceGroup")||a&&c},canSeeShopTogether:function(){return this.isMobile()?!1:!0},canSeeVcoinPay:function(){return this.__getBool("next:can_see_vcoin_pay")},canSeeNFT:function(){return this.__getBool("next.can_see_nft_phase_1")},canSeeYouTubePreRecorded:function(){return!1},canSeeVivox:function(){return!1},stillShowingWhisperIntroduction:function(){return!1}})}({UiCore:m["@UiCore"]}),Xa=function(h){var b=function(g){var k=Math.round(g/1e6*10)/10;if(1<=k)return k+"M views";k=Math.round(g/1e3);return 1<=k?k+"K views":g+" views"},a=function(g){var k=$jscomp.makeIterator(g.match(/((\d+)H)?((\d+)M)?((\d+)S)?$/));k.next();k.next();g=k.next().value;k.next();var l=k.next().value;k.next();k=k.next().value;var n="";g&&(n=""+g);n=l?(n?n+":":"")+l.padStart(2,"0"):n?n+":00":"00";return n=k?n+":"+k.padStart(2,"0"):n+":00"},c=function(g){return function(k){return g.reduce(function(l,n){return n(l)},k)}},d=function(g){g=g.toString().split(".");g[0]=g[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");return g.join(".")},e=function(g){return isNaN(g)||Math.floor(g)===g?0:g.toString().split(".")[1].length||0},f=function(g,k){if(e(g)<=k)return parseFloat(g).toFixed(k);var l=Math.pow(10,k);return(Math.trunc(g*l)/l).toFixed(k)};return{getTimeFormat:function(g,k){var l=Math.floor(g/3600),n=Math.floor(g/60)-60*l;g%=60;k&&(g=g.toFixed(k));k=10>g?"0":"";return l?l+":"+(10>n?"0":"")+n+":"+k+g:n+":"+k+g},formatCredits:function(g){return g.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},zeroPad:function(g,k){return(Array(k).join("0")+g).substr(-k,k)},formatMini:function(g,k){var l=[{base:1e3,letter:"K"},{base:1e6,letter:"M"},{base:1e9,letter:"B"}];if(g<(k?k:1e3))return d(g);for(var n=l.length-1;0<=n;n--){k=l[n];var p=k.base;if(g>=p)return l=Math.floor(g/p),g=Math.floor((g-p*l)/(p/10)),l+(g?"."+g:"")+k.letter}return""+g},addComma:d,formatDecimal:f,formatVCOIN:function(g){return d(f(g,2))},countDecimals:e,durationParser:a,viewFormatter:b,formatYouTubeVideoMetaData:function(g){return g.items.map(function(k){var l=k.snippet,n=k.contentDetails,p=k.id,q=k.status;return{imageUrl:l.thumbnails.medium.url,videoTitle:l.title,videoAuthor:l.channelTitle,videoDescription:l.description,totalViews:b(k.statistics.viewCount),duration:a(n.duration),isoDuration:n.duration,published:h.moment(l.publishedAt).fromNow(),videoId:p,embeddable:q.embeddable}})},getSuggestionsFromResponse:function(g){return c([function(k){return JSON.parse(k.match(/\((.*)\)/)[1])},function(k){return k[1]},function(k){return k.map(function(l){return l[0]})}])(g)},getTokenFromResponse:function(g){return c([function(k){return JSON.parse(k.match(/\((.*)\)/)[1])},function(k){return k[2]},function(k){return k.q}])(g)}}}({moment:m["@moment"]}),Ya=function(h){var b=Object.freeze({feed_like:{iconClass:"icon-activity_post",thumbnailClass:"general-post",i18n:"liked_your_post"},feed_comment:{iconClass:"icon-activity_post",thumbnailClass:"general-post",i18n:"commented_your_post"},chat_invite:{iconClass:"icon-activity_chatrooms",thumbnailClass:"chat-room",i18n:"invited_you_to_chat"},shop_together_invite:{iconClass:"icon-activity_shoptogether",thumbnailClass:"shop_together",i18n:"invited_you_to_shop_together"},experience_invite_v2:{iconClass:"icon-is-presenter",thumbnailClass:"live-room",i18n:"sent_you_a_live_room_invite"},friend_accept:{iconClass:"icon-activity_acceptedfriend",thumbnailClass:"friend-accept",i18n:"friend_accept"},friend_request:{iconClass:"icon-nav_friends",thumbnailClass:"friend-request",i18n:"sent_you_a_friend_request"},timelines_follow:{iconClass:"icon-activity_post",thumbnailClass:"follow-notification",i18n:"started_following_you"},moderator_add:{iconClass:"icon-activity_chatrooms",thumbnailClass:"chat-room",i18n:"added_as_moderator"},moderator_remove:{iconClass:"icon-activity_chatrooms",thumbnailClass:"chat-room",i18n:"removed_as_moderator"},payme_received:{iconClass:"icon-payme_new",thumbnailClass:"payme-notification",i18n:"payme_received_message"},payme_requested:{iconClass:"icon-payme_new",thumbnailClass:"payme-notification",i18n:"payme_requested_message"},product_gift_received:{iconClass:"icon-gift_new",thumbnailClass:"gift-notification",i18n:"gifted_you_product"},credit_gift_received:{iconClass:"icon-gift_new",thumbnailClass:"gift-notification",i18n:"gifted_you_credits"},vcoin_gift_received:{iconClass:"icon-gift_new",thumbnailClass:"gift-notification",i18n:"gifted_you_vcoin"}});return IMVU.BaseClass.extend("ActivityHelper",{dependencies:["featureAccessManager","globalStringManager","Promise","restModelFactory","window"],initialize:function(a){this.__featureAccessManager=a.featureAccessManager;this.__formatNumber=h.FormatNumber;this.__globalStringManager=a.globalStringManager;this.__Promise=a.Promise;this.__restModelFactory=a.restModelFactory;this.__window=a.window},getSupportedActivities:function(){return _.keys(b)},isSupported:function(a){return"shop_together_invite"!==a||this.__featureAccessManager.canSeeShopTogether()?_.has(b,a):!1},getMetadata:function(a){return b[a]},getRenderData:function(a,c){var d=this.getMetadata(a);return new this.__Promise(function(e){switch(a){case"moderator_add":case"moderator_remove":var f=this.__restModelFactory.readModel(c.relations.activity_reference_node,h.UiCore.NodeModel);f.populated().then(function(){e.resolve({text:this.__globalStringManager.get(d.i18n,{name:f.get("name")}),thumbnailClass:d.thumbnailClass,iconClass:d.iconClass})}.bind(this)).catch(function(p){this.__window.console.error("Uh oh",p,arguments)}.bind(this));break;case"feed_like":case"feed_comment":e.resolve({text:this.__globalStringManager.get(d.i18n),thumbnailClass:d.thumbnailClass,iconClass:d.iconClass,referenceNode:c.relations.activity_reference_node});break;case"experience_invite_v2":this.__featureAccessManager.canSeeLiveRooms()?e.resolve({text:this.__globalStringManager.get(d.i18n),thumbnailClass:d.thumbnailClass,iconClass:d.iconClass}):e.reject();break;case"product_gift_received":if(c.relations.activity_reference_node){var g=this.__restModelFactory.readModel(c.relations.activity_reference_node,h.UiCore.NodeModel);g.populated().then(function(){var p=g.get("product_url");this.__restModelFactory.readModel(p,h.Model.ProductNode).populated().then(function(q){e.resolve({text:this.__globalStringManager.get(d.i18n),thumbnailClass:d.thumbnailClass,iconClass:d.iconClass,product:q})}.bind(this))}.bind(this)).catch(function(p){this.__window.console.error("Uh oh",p,arguments)}.bind(this))}else e.resolve({text:this.__globalStringManager.get(d.i18n),thumbnailClass:d.thumbnailClass,iconClass:d.iconClass});break;case"credit_gift_received":case"vcoin_gift_received":var k=this.__restModelFactory.readModel(c.relations.activity_reference_node,h.UiCore.NodeModel),l="vcoin_gift_received"===a?"vcoin_net_amount":"credit_net_amount";k.populated().then(function(){var p="vcoin_gift_received"===a?this.__formatNumber.addComma(this.__formatNumber.formatDecimal(k.get(l),2)):this.__formatNumber.addComma(k.get(l),2);e.resolve({text:this.__globalStringManager.get(d.i18n,{amount:p}),thumbnailClass:d.thumbnailClass,iconClass:d.iconClass})}.bind(this)).catch(function(p){this.__window.console.error("Uh oh",p,arguments)}.bind(this));break;case"payme_requested":case"payme_received":var n=this.__restModelFactory.readModel(c.relations.activity_reference_node,h.UiCore.NodeModel);n.populated().then(function(){var p=this.__formatNumber.addComma(this.__formatNumber.formatDecimal(n.get("amount"),2));e.resolve({text:this.__globalStringManager.get(d.i18n,{amount:p}),thumbnailClass:d.thumbnailClass,iconClass:d.iconClass})}.bind(this)).catch(function(p){this.__window.console.error("Uh oh",p,arguments)}.bind(this));break;default:this.isSupported(a)?e.resolve({text:this.__globalStringManager.get(d.i18n),thumbnailClass:d.thumbnailClass,iconClass:d.iconClass}):e.reject()}}.bind(this))}})}({Model:m["@Model"],UiCore:m["@UiCore"],FormatNumber:Xa}),Za=function(h){var b=h.LoggedOutFeatureAccessManager;return b.extend("LoggedInFeatureAccessManager",{dependencies:"geolocation globalStartupModel leanplum loginManager prefsManager webGL window".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__isCreator=this.__isDev=this.__isQA=!1;this.__leanplum=a.leanplum;this.__webGL=a.webGL;this.__geolocation=a.geolocation;this.__globalStartupModel=a.globalStartupModel;this.__loginManager=a.loginManager;this.__qaWeb=a.qaWeb;this.__prefsManager=a.prefsManager;this.__loginManager&&this.__loginManager.isLoggedIn()&&(this.__myself=this.__loginManager.getCurrentUser(),this.__isCreator=this.__myself.get("is_creator"));if(this.__prefsManager.collection)this.__prefsManager.collection.on("change add remove reset update",this.__updateFlags.bind(this))},__getBool:function(a){var c="1"===this.__localStorage.getItem(a);a=!!this.__prefsManager.getBool(a);return c||a},__getInt:function(a,c){return this.__prefsManager.getInt(a,c)},__updateFlags:function(){this.__isQA=this.__getBool("is_qa")&&!this.__getBool("next.hide_qa");this.__isDev=this.__getBool("is_dev");this.__shouldSeeDisplayNames=this.__getBool("next.should_see_display_names")},canSeeQA:function(){return this.__isQA},isDev:function(){return this.__isDev},isCreator:function(){return this.__isCreator},shouldPauseLiveRooms:function(){return this.__serviceProvider.get("shouldPauseLiveRooms")},tempChatOnWeb:function(){return this.__getBool("temp_chat_on_web")},canSeeAppMonitorHeartbeat:function(){return this.__prefsManager.getBool("next.user_pref.can_see_app_monitor_heartbeat")},canSeeClientUpsell:function(){return!this.isElectronClient()},canSeeChatDrawer:function(){return"desktop"===this.__platform||this.isElectronClient()},shouldSeeQACarouselSlides:function(){return this.__isQA},canGet3DroomLoadingStats:function(){return this.__getInt("show_loading_stats",0)},canSee3D:function(){return this.__webGL.canUse3d()},canSetDynamicTexture:function(){return this.isElectronClient()&&this.__prefsManager.getBool("next.can_set_dynamic_texture")},canSeeSyncedMedia:function(){return this.isElectronClient()&&this.__prefsManager.getBool("next.can_see_synced_media")},stillShowingLiveAudioIntroduction:function(){return!0},canEveryoneSeeRoomDeco2:function(){return this.__globalStartupModel.get("canEveryoneSeeRoomDeco2")},canSeeRoomDeco2:function(){var a=this.__prefsManager.getBool("next.can_see_roomdeco2"),c=this.__globalStartupModel.get("isWhitelistedForRoomDeco2");return a||c||this.canEveryoneSeeRoomDeco2()},canSeeRoomDeco2Toolbar:function(){return this.canSeeRoomDeco2()},canSeeRoomDeco2ToolbarFloating:function(){return this.__prefsManager.getBool("next.can_see_roomdeco2_toolbar_floating")},canSaveSceneSpec:function(){return this.__prefsManager.getBool("next.can_save_scene_spec")},canSeeVcoinAsPaymentMethod:function(){return this.__globalStartupModel.get("isInVcoinAsPaymentMethod")},canSeeNFT:function(){return this.__prefsManager.getBool("next.can_see_nft_phase_1")},canSeeVcoinPay:function(){return this.__globalStartupModel.get("isInVcoinPay")},canSeeVivox:function(){return this.isElectronClient()}})}({UiCore:m["@UiCore"],LoggedOutFeatureAccessManager:P}),$a=function(h){var b=function(){function a(c,d,e,f,g){return g.relativeTime(d||1,!!e,c,f)}return function(c){var d=+this;var e=this.lang();var f=Math.round(Math.abs(d)/1e3),g=Math.round(f/60),k=Math.round(g/60),l=Math.round(k/24),n=Math.round(l/365);f=45>f&&["s",f]||1===g&&["m"]||45>g&&["mm",g]||1===k&&["h"]||22>k&&["hh",k]||1===l&&["d"]||345>=l&&["dd",l]||1===n&&["y"]||["yy",n];f[2]=!c;f[3]=0<d;f[4]=e;e=a.apply({},f);c&&(e=this.lang().pastFuture(d,e));return e}}();h.moment.lang("IOSRelativeTime",{relativeTime:{future:"in %s",past:"%s ago",s:"Just now",m:"1m",mm:"%dm",h:"1h",hh:"%dh",d:"1d",dd:function(a){return 7>a?a+"d":Math.floor(a/7)+"w"},y:"1y",yy:"%dy"}});h.moment.lang("en");return function(a){var c=h.moment.apply(this,Array.prototype.slice.call(arguments,1));c.lang("IOSRelativeTime");c.from=function(d,e){d=b.call(h.moment.duration(this.diff(d)).lang(this.lang()._abbr),!e);return a.get("globalStringManager").getWithDefault(d,d||"")};return c}}({moment:m["@moment"]}),ab=function(h){return function(b){var a=function(){var c=b.get("localStorage");c=c.getItem("qaTimeLocale")?c.getItem("qaTimeLocale"):b.get("currentLocale");h.moment.lang(c);return h.moment.apply({},arguments)};a.IOSRelativeTime=h.IOSRelativeTime.bind({},b);h.moment.standardize=function(c){if("undefined"===typeof c)return"";c=c.trim();return""===c?"":h.moment(c,"YYYY-MM-DD").format("l")};return a}}({moment:m["@moment"],IOSRelativeTime:$a}),Q=function(h){return IMVU.BaseClass.extend("HistoryManager",_.extend({dependencies:"localStorage modeManager restModelFactory siteRoot timer window".split(" "),initialize:function(b){this.__appMonitor=null;this.__window=b.window;this.__serviceProvider=b.serviceProvider;this.__modeManager=b.modeManager;this.__siteRoot=b.siteRoot;this.__restModelFactory=b.restModelFactory;this.__localStorage=b.localStorage;this.__needsInitialState=!0;this.__currentStateIndex=this.__INITIAL_HISTORY_COUNT=-1;this.__sessionId=b.timer.getTime();this.__window.history.scrollRestoration="manual";this.__window.addEventListener("popstate",this.__onPopState.bind(this));this.__popInterceptionCallback=null},noHistory:function(){return this.__currentStateIndex===this.__INITIAL_HISTORY_COUNT},__updateAppMonitor:function(b,a){if(!this.__appMonitor)try{this.__appMonitor=this.__serviceProvider.get("appMonitor")}catch(c){this.__appMonitor=null}this.__appMonitor&&this.__appMonitor.setModeAndSubmode(b,"__default__"===a?"":a)},setState:function(b){this.__updateAppMonitor(b.mode&&b.mode.id?b.mode.id:"",b.submode&&b.submode.id?b.submode.id:"");var a="pushState";if(this.__needsInitialState||b.replace)this.__needsInitialState=!1,a="replaceState";else if(this.compareStates(this.__window.history.state,b))return!1;this.__setState(b,a);return!0},compareStates:function(b,a){return!(b&&a&&b.mode&&b.mode.id&&a.mode&&a.mode.id)||b.mode.id!==a.mode.id||b.submode&&a.submode&&b.submode.id!==a.submode.id?!1:!0},__prepareStateForStorage:function(b){var a={};_.each(b,function(c,d){if(c instanceof h.Model.FeedNode)a.__feedNodes=a.__feedNodes||{},a.__feedNodes[d]=c.id;else if(c instanceof h.Model.ProductNode)a.__productNodes=a.__productNodes||{},a.__productNodes[d]=c.id;else if(c instanceof h.Model.ConversationNode)a.__conversationNode=a.__conversationNode||{},a.__conversationNode[d]=c.id;else if(c instanceof h.UiCore.NodeModel)a.__nodes=a.__nodes||{},a.__nodes[d]=c.id;else if(c instanceof h.UiCore.EdgeCollection)a.__edgecollections=a.__edgecollections||{},a.__edgecollections[d]=c.url;else if(c instanceof Object){try{JSON.stringify(b)}catch(e){throw window.console.error("state must be serializable but found",b),Error("state must be serializable into a string")}a[d]=this.__prepareStateForStorage(c)}else"replace"!==d&&(a[d]=c)}.bind(this));return a},__prepareStateForUse:function(b){var a={};_.each(b,function(c,d){"__feedNodes"===d?_.each(b[d],function(e,f){a[f]=this.__restModelFactory.readModel(e,h.Model.FeedNode)}.bind(this)):"__productNodes"===d?_.each(b[d],function(e,f){a[f]=this.__restModelFactory.readModel(e,h.Model.ProductNode)}.bind(this)):"__nodes"===d?_.each(b[d],function(e,f){a[f]=this.__restModelFactory.readModel(e,h.UiCore.NodeModel)}.bind(this)):"__conversationNode"===d?_.each(b[d],function(e,f){a[f]=this.__restModelFactory.readModel(e,h.Model.ConversationNode)}.bind(this)):"__edgecollections"===d?_.each(b[d],function(e,f){a[f]=this.__restModelFactory.readCollection(e,h.UiCore.EdgeCollection)}.bind(this)):a[d]=c instanceof Object?this.__prepareStateForUse(c):c}.bind(this));return a},__setState:function(b,a){var c=this.__window.document.title,d=this.__siteRoot+b.mode.id+"/";this.__localStorage.getItem("history.debugger")&&this.__window.eval("debugger;");b.fragment&&(d+=b.fragment+"/");b.replace||++this.__currentStateIndex;b=this.__prepareStateForStorage(b);b.index=this.__currentStateIndex;b.sessionId=this.__sessionId;this.__window.history[a](_.clone(b),c,d);this.trigger("stateChange")},silentMoveHistory:function(b){this.__modeManager.isOpeningMode()||(this.__silentlyMoving=!0,this.__window.history.go(b))},__finishHistoryChange:function(b){this.__currentStateIndex=b;this.__silentlyMoving=!1;this.trigger("stateChange")},setPopInterception:function(b){this.__popInterceptionCallback=b},unsetPopInterception:function(){this.__popInterceptionCallback=null},__onPopState:function(b){if(null!==this.__popInterceptionCallback)this.__popInterceptionCallback();else if(!this.__serviceProvider.has("globalNav"))this.__window.console.log("globalNav has not been registered");else if(b.state&&(b.state.index!==this.__currentStateIndex||b.state.sessionId!==this.__sessionId)||!b.state&&this.__window.history.state){var a=this.__prepareStateForUse(b.state||this.__window.history.state);if(this.__silentlyMoving)this.__finishHistoryChange(a.index);else{var c=this.__currentStateIndex;this.__currentStateIndex=a.index;this.__modeManager.openMode(_.extend({poppingHistory:!0},a)).then(this.__finishHistoryChange.bind(this,a.index)).catch(function(){this.__currentStateIndex=c;this.__openingMode=!1;this.__window.history.go(this.__currentStateIndex-a.index)}.bind(this))}}}},Backbone.Events))}({Model:m["@Model"],UiCore:m["@UiCore"]}),bb=function(h){var b=IMVU.BaseClass;return b.extend("OnlineHelper",{dependencies:["globalStartupModel","rest","window"],initialize:function(a){b.prototype.initialize.call(this,a);this.__serviceProvider=a.serviceProvider;this.__globalStartupModel=a.globalStartupModel;this.__window=a.window;this.__rest=a.rest;this.__window.addEventListener("load",this.__handleLoad.bind(this),!0);this.__online=!1;this.__globalStartupModel.populated().then(function(){this.__hasNetwork(!0)}.bind(this))},delete:function(){this.__window.removeEventListener("online",this.__handleOnline.bind(this),!0);this.__window.removeEventListener("offline",this.__handleOffline.bind(this),!0)},isOnline:function(){return this.__online},__handleLoad:function(){this.__window.removeEventListener("load",this.__handleLoad.bind(this),!0);this.__globalStartupModel.populated().then(function(){this.__hasNetwork(navigator.onLine)}.bind(this))},__handleOnline:function(){this.__hasNetwork(!0)},__handleOffline:function(){this.__hasNetwork(!1)},__hasNetwork:function(a){!1===a?(this.__online=!1,this.__window.console.log("OnlineHelper - offline")):(a=this.__globalStartupModel.get("baseApiURI")+"login/me",this.__rest.invalidate(a),this.__rest.get(a).then(function(){this.__online=!0;this.__window.console.log("OnlineHelper - online")}.bind(this)).catch(function(){this.__online=!1;this.__window.console.log("OnlineHelper - offline")}.bind(this)))}})}({UiCore:m["@UiCore"]}),cb=function(h){var b=h.UIContextExtension;return b.extend("AppMonitor",{dependencies:"counterHelper featureAccessManager globalStartupModel loginManager Promise rest timer window".split(" "),__log:function(){var a=$jscomp.getRestArguments.apply(0,arguments);this.__canSeeHeartBeat&&this.__window.console.log.apply(this.__window.console,$jscomp.arrayFromIterable(a))},initialize:function(a){this.__canSeeHeartBeat=!1;b.prototype.initialize.call(this,a);this.__serviceProvider=a.serviceProvider;this.__featureAccessManager=a.featureAccessManager;this.__globalStartupModel=a.globalStartupModel;this.__rest=a.rest;this.__timer=a.timer;this.Promise=a.Promise;this.__counterHelper=a.counterHelper;this.__window=a.window;this.__loginManager=a.loginManager;this.__appMonitorQueue=null;this.__reportedAppMonitorQueueError=!1;this.__heartBeatTimer=this.__heartBeatInterval=null;this.__tailSize=500;this.__crashed=!1;this.__cpu=null;this.__uiEventReporter=this.__serviceProvider.get("uiEventReporter");this.__prefsManager=this.__serviceProvider.get("prefsManager");this.__lastSubModeID=this.__lastModeID="";this.__highRateReports={};this.__Promise.every([this.__globalStartupModel.populated(),this.__prefsManager.populated()]).then(function(){if(this.__window.console&&void 0===this.__window.console.everything){this.__window.console.everything=[];var c=null;try{var d=this.__serviceProvider.get("appVersion"),e=!this.__globalStartupModel.get("isLocalHost")&&!this.__globalStartupModel.get("isQA")&&!this.__globalStartupModel.get("isDev")&&"@DEV"!==d,f=this.__prefsManager.getBool("next.appMonitor.force_console_intercept",!1);c=e||f}catch(g){c=!1}c&&(this.__window.console.log&&(this.__window.console.defaultLog=this.__window.console.log.bind(this.__window.console),this.__window.console.log=function(){var g=h.moment().format("YYYY-MM-DD hh:mm:ss"),k=this.__getCaller();this.__window.console.everything.push({type:"log",time:g,where:k,value:Array.from(arguments)});this.__trimEverything();arguments[0]=k+":  "+arguments[0];this.__window.console.defaultLog.apply(this.__window.console,arguments)}.bind(this)),this.__window.console.error&&(this.__window.console.defaultError=this.__window.console.error.bind(this.__window.console),this.__window.console.error=function(){var g=h.moment().format("YYYY-MM-DD hh:mm:ss"),k=this.__getCaller();this.__window.console.everything.push({type:"error",time:g,where:k,value:Array.from(arguments)});this.__trimEverything();arguments[0]=k+":  "+arguments[0];this.__window.console.defaultError.apply(this.__window.console,arguments)}.bind(this)),this.__window.console.warn&&(this.__window.console.defaultWarn=this.__window.console.warn.bind(this.__window.console),this.__window.console.warn=function(){var g=h.moment().format("YYYY-MM-DD hh:mm:ss"),k=this.__getCaller();this.__window.console.everything.push({type:"warn",time:g,where:k,value:Array.from(arguments)});this.__trimEverything();arguments[0]=k+":  "+arguments[0];this.__window.console.defaultWarn.apply(this.__window.console,arguments)}.bind(this)),this.__window.console.debug&&(this.__window.console.defaultDebug=this.__window.console.debug.bind(this.__window.console),this.__window.console.debug=function(){var g=h.moment().format("YYYY-MM-DD hh:mm:ss"),k=this.__getCaller();this.__window.console.everything.push({type:"debug",time:g,where:k,value:Array.from(arguments)});this.__trimEverything();arguments[0]=k+":  "+arguments[0];this.__window.console.defaultDebug.apply(this.__window.console,arguments)}.bind(this)))}try{this.__heartBeatInterval=parseInt(this.__globalStartupModel.get("nextAppMonitorHeartBeatPeriod"))}catch(g){this.__heartBeatInterval=5e3}this.__worker=null;if(this.__window.Worker)if(this.__featureAccessManager.canSeeAppMonitor()){c=this.__window.location.origin+"/common/js/workers/AppMonitorWorker.js";try{this.__worker=new this.__window.Worker(c)}catch(g){this.__window.console.error("AppMonitor::initialize - FAILED TO LAUNCH THE WORKER with url ("+c+") and error message ("+g.message+") - e:",g);this.__counterHelper.increment("worker_thread_launch_failure");return}if(this.__worker){this.__worker.onmessage=function(g){this.__handleReceivedMessage(g)}.bind(this);this.__window.onerror=function(g,k,l,n,p){this.__handleWindowError(g,k,l,n,p)}.bind(this);this.__worker.postMessage(["set_heart_beat_period",this.__heartBeatInterval]);c="";navigator&&navigator.connection&&navigator.connection.effectiveType&&(c+="effectiveType="+navigator.connection.effectiveType+"   ");navigator&&navigator.connection&&navigator.connection.rtt&&(c+="rtt="+navigator.connection.rtt+"   ");navigator&&navigator.connection&&navigator.connection.downlink&&(c+="downlink="+navigator.connection.downlink+"   ");c=c.trim();this.__worker.postMessage(["set_network_details",""===c?"network details not available":c]);c="";navigator&&navigator.userAgent&&(c=navigator.userAgent);this.__worker.postMessage(["set_user_agent",c]);c=this.__featureAccessManager.getMarketingPlatform();this.__worker.postMessage(["set_platform",c]);this.__worker.postMessage(["set_cli_ver",this.__serviceProvider.get("appVersion")]);this.__worker.postMessage(["set_app_name",this.__serviceProvider.get("appName")]);this.__worker.postMessage(["set_is_mobile",this.__featureAccessManager.isMobile()]);c=0<String(this.__window.location.href).indexOf("localhost")&&!this.__featureAccessManager.isElectronClient()?"true":"false";this.__worker.postMessage(["set_is_localhost",c]);this.__worker.postMessage(["set_degraded_buffer",this.__globalStartupModel.get("nextAppMonitorDegradedBuffer",3e3)]);c=this.__globalStartupModel.get("crashReportUrl");d=this.__globalStartupModel.get("uiEventUrl");this.__worker.postMessage(["set_reporting_urls",c,d]);this.__worker.postMessage(["set_activity_group_id",this.__uiEventReporter.getActivityGroup().id]);if(this.__systemMetrics=this.__serviceProvider.get("systemMetrics"))this.__cpu=0<this.__systemMetrics.cpus.count?this.__systemMetrics.cpus.model:"",this.__worker.postMessage(["set_system",this.__systemMetrics.arch,this.__cpu,this.__systemMetrics.memory.total,this.__systemMetrics.memory.free,this.__systemMetrics.os.type,this.__systemMetrics.os.release,this.__systemMetrics.os.platform]);this.__worker.postMessage(["set_device_memory",navigator.deviceMemory?navigator.deviceMemory:null]);e=d=c=null;this.__window.performance&&this.__window.performance.memory&&(c=this.__window.performance.memory.jsHeapSizeLimit?this.__window.performance.memory.jsHeapSizeLimit:null,d=this.__window.performance.memory.totalJSHeapSize?this.__window.performance.memory.totalJSHeapSize:null,e=this.__window.performance.memory.usedJSHeapSize?this.__window.performance.memory.usedJSHeapSize:null);this.__worker.postMessage(["set_js_heap",c,d,e]);this.__loginManager.isLoggedIn()?(this.__myself=this.__loginManager.getCurrentUser(),this.__myself.populated().then(function(){this.__canSeeHeartBeat=this.__featureAccessManager.canSeeAppMonitorHeartbeat();this.__worker.postMessage(["set_can_see_heartbeat",this.__canSeeHeartBeat?"true":"false"]);this.__worker.postMessage(["set_app_device_data",this.packageAppDeviceData()])}.bind(this))):(this.__worker.postMessage(["set_can_see_heartbeat","false"]),this.__worker.postMessage(["set_app_device_data",this.packageAppDeviceData()]));this.__window.addEventListener("visibilitychange",function(g){this.__handleVisibilityStateChange(document.visibilityState)}.bind(this));this.__window.addEventListener("pagehide",function(g){this.__handleVisibilityStateChange(document.visibilityState)}.bind(this));this.__window.addEventListener("pageshow",function(g){this.__handleVisibilityStateChange(document.visibilityState)}.bind(this));this.__sendHeartBeat();if(this.__window.appMonitorPending)for(;0<this.__window.appMonitorPending.length;)c=this.__window.appMonitorPending.pop(),this.reportCustomError(c[0],c[1],c[2],c[3],c[4]);this.__loginManager.isLoggedIn()&&this.__featureAccessManager.isElectronClient()&&(this.__myself=this.__loginManager.getCurrentUser(),this.__myself.populated().then(function(){this.__featureAccessManager.canSeeQA()&&(this.reportCustomError("AppMonitor","initialize","web_perm_0000","appMonitor initialized"),this.__window.console.log("AppMonitor::initialize - appMonitor initialized"))}.bind(this)))}else this.__window.console.error("AppMonitor::initialize - FAILED TO LAUNCH THE WORKER with url ("+c+") and an unspecified error"),this.__counterHelper.increment("worker_thread_launch_failure")}else this.__log("AppMonitor::initialize - FAM indicates no access");else this.__log("AppMonitor::initialize - Web worker not available on window")}.bind(this))},__trimEverything:function(){this.__window.console.everything&&100<this.__window.console.everything.length&&this.__window.console.everything.shift()},__getCaller:function(){var a=Error().stack.split("\n")[3],c=a.indexOf("    at ");-1!==c&&(a=a.substring(c+7));c=a.indexOf("imvu.com/");-1!==c&&(a=a.substring(c+9),a.endsWith(")")&&(a=a.substring(0,a.length-1)));c=a.indexOf("imvunext://client/");-1!==c&&(a=a.substring(c+18),a.endsWith(")")&&(a=a.substring(0,a.length-1)));return a},delete:function(){this.__heartBeatTimer&&this.__timer.clearTimeout(this.__heartBeatTimer);this.__worker&&this.__worker.terminate()},buildErrorArray:function(a){var c=[];"undefined"!==typeof a&&("string"===typeof a.message&&(c.push("e.message..."),c.push(a.message)),"string"===typeof a.error&&(c.push("e.error..."),c.push(a.error)));"undefined"!==typeof a&&"undefined"!==typeof a.error&&"string"!==typeof a.error&&("string"===typeof a.error.message&&(c.push("e.error.message..."),c.push(a.error.message)),"string"===typeof a.error.error&&(c.push("e.error.error..."),c.push(a.error.error)));return c},isCrashed:function(){return this.__crashed},setModeAndSubmode:function(a,c){this.__worker&&this.__worker.postMessage(["set_mode_and_submode",a,"__default__"===c?"":c])},__handleVisibilityStateChange:function(a){this.__log("AppMonitor::__handleVisibilityStateChange - visibilityState="+a);"hidden"===a?this.__worker.postMessage(["set_monitor","off"]):"visible"===a?this.__worker.postMessage(["set_monitor","on"]):this.__log("AppMonitor::__handleVisibilityStateChange - Unrecognized visibilityState",a)},__sendHeartBeat:function(){this.__log("AppMonitor::__sendHeartBeat - hbhbhbhbhb");var a=String(this.__window.location.href),c=a.indexOf("imvu.com/");-1!==c&&(a=a.substring(c+9));c=a.indexOf("imvunext://");-1!==c&&(a=a.substring(c+11));c=a.indexOf("?");-1!==c&&(a=a.substring(0,c));var d=a.split("/");a=d[0]||"dna";c=d[1]||"dna";d=d[2]||"dna";this.__worker.postMessage(["heart_beat",(new Date).getTime(),a,c,d,this.__uiEventReporter.getActivityGroup().id]);this.__heartBeatTimer=this.__timer.setTimeout(this.__sendHeartBeat.bind(this),this.__heartBeatInterval);if(!this.__appMonitorQueue){try{this.__appMonitorQueue=this.__serviceProvider.get("appMonitorQueue")}catch(e){this.__appMonitorQueue=null}this.__appMonitorQueue?(this.__appMonitorQueue.setEngine(this),this.__log("AppMonitor::__sendHeartBeat - appMonitor found appMonitorQueue")):(this.__window.console.warn("AppMonitor::__sendHeartBeat - appMonitor failed to get appMonitorQueue from serviceProvider"),this.__reportedAppMonitorQueueError||(this.reportCustomError("AppMonitor","initialize","web_error_0005","appMonitor failed to get appMonitorQueue from serviceProvider",[]),this.__reportedAppMonitorQueueError=!0))}},__handleReceivedMessage:function(a){var c=a.data[0];"refresh"===c?this.__handleRefresh():"counter_report_error"===c?this.__counterHelper.increment("report_error_failure"):"check_for_new_high_rate_error"===c&&this.__handleCheckForNewHighRateAlert(a.data[1])},__trimFileName:function(a,c){var d=a.search(c);-1!==d&&(a=a.substring(d+c.length));return a},__postErrorPayloadToWorker:function(a){this.__log("AppMonitor::__postErrorPayloadToWorker - payload",a);a.push(this.__uiEventReporter.getActivityGroup().id);this.postPackage=a;null!==this.__worker&&this.__worker.postMessage(a)},__parseTheHighlight:function(a,c,d){c=a.split("\n")[c-1];a=c.substring(0,d-1);if(a.length>this.__tailSize){var e=a.length-this.__tailSize;0>=e||(a="..."+a.substring(e))}a=a.replace(";",";\n");a=a.replace("{","\n{\n");a=a.replace("}","\n}\n");d=c.substring(d-1);d.length>this.__tailSize&&(d=d.substring(0,this.__tailSize)+"...");d=d.replace(";",";\n");d=d.replace("{","\n{\n");d=d.replace("}","\n}\n");return("Code snippet...\n"+a+"\n[***HERE==>>]"+d).replace("\n\n[***HERE==>>]","\n[***HERE==>>]")},_testParseTheHighlight:function(a,c,d){return this.__parseTheHighlight(a,c,d)},__addConsoleToStack:function(a){if(this.__window.console&&this.__window.console.everything){a.push("Console...");for(var c,d=0;d<this.__window.console.everything.length;d++)c=this.__window.console.everything[d],1===c.value.length&&"string"===typeof c.value[0]?a.push(c.type+" - "+c.time+" - "+c.where+":  "+c.value[0]):a.push(c.type+" - "+c.time+" - "+c.where+":  "+JSON.stringify(c.value));a.push("")}return a},__handleWindowError:function(a,c,d,e,f){this.__log("AppMonitor::__handleWindowError - arguments",arguments);this.__counterHelper.increment("javascript_window_error");if(a.startsWith("appMonitor///")||a.startsWith("Uncaught Error: appMonitor///")){var g=a.split("///"),k=g[1],l=g[2],n=g[3],p=g[4];g=g[5].split("\n");this.reportCustomError(k,l,n,p,g)}else{this.waypoint("AppMonitor::__handleWindowError - msg: "+a);var q=[];f&&f.stack?(q.push("Error stack trace..."),q=null!==f?f.stack.split("\n").map(function(r){return r.trim()}):[]):f&&q.push("Error stack trace:  Not Available");l=p=n=l=k=null;for(k=q.length-1;0<k;k--)if(l=q[k],!(l.startsWith("at C (")||l.startsWith("at c.accept (")||l.startsWith("at c.reject (")||l.startsWith("at c.resolve (")||l.startsWith("at CallbacksRegistry.")||l.startsWith("at electron")||l.startsWith("at EventEmitter.")||l.startsWith("at l._scheduleCallbacks (")||l.startsWith("at northstar::Promise")||l.startsWith("at Object.")||l.startsWith("at std::__2")||l.includes("ui-core.min.js"))){n=null;l.startsWith("at ")&&(l=l.substring(3));k="";l.startsWith("imvunext://")||l.startsWith("https://")||(k=l,k.startsWith("at ")&&(k=k.substring(3)),n=k.indexOf("("),-1!==n&&(k=k.substring(0,n),k=k.trim()));g=l;n=g.indexOf("imvunext://");-1!==n&&(g=g.substring(n));l=g.split("/");l=l[l.length-1];p=$jscomp.makeIterator(l.split(":"));l=p.next().value;n=p.next().value;p=p.next().value;g=RegExp("^[0-9]*$");n=0==g.test(n)?null:"undefined"===typeof n?null:parseInt(n);p=0==g.test(p)?null:"undefined"===typeof p?null:parseInt(p);g=k+"/"+l+"/"+String(n)+"/"+String(p);q.push("rootFunction="+k);q.push("rootFile="+l);q.push("rootLineNumber="+n);q.push("rootColumnNumber="+p);break}q.length&&q.push("");q=this.__addConsoleToStack(q);q.push("");k=q.join("\n");l=this.__trimFileName(c,".imvu.com/");l=this.__trimFileName(l,"//client/build/");n=l.split("/");var t=n[n.length-1];if(l.endsWith(".min.js")&&0<d&&0<e)try{fetch(c).then(function(r){return r.text()}).then(function(r){r="\n"+this.__parseTheHighlight(r,d,e);q.push(r);r=q.join("\n");this.__postErrorPayloadToWorker(["window_error",a,t,d,e,r,"undetermined"])}.bind(this))}catch(r){this.__log("AppMonitor::__handleWindowError - recognize failed to read .min.js file - e",r),this.__postErrorPayloadToWorker(["window_error",a,t,d,e,k,"undetermined"])}else this.__log("AppMonitor::__handleWindowError - recognize failure is in non-minified js"),this.__postErrorPayloadToWorker(["window_error",a,t,d,e,k,"undetermined"])}},reportCustomError:function(a,c,d,e,f){f=void 0===f?[]:f;this.__log("AppMonitor::reportCustomError - arguments",arguments);if(h.errorCodes[d]){this.waypoint("AppMonitor::reportCustomError - "+d);var g=[];a&&g.push("Where:  "+a+"::"+c+"\n");e&&g.push("Error Message:  "+e+"\n");if("object"!==typeof f)this.__window.console.error("AppMonitor::reportCustomError - Error stack parameter is not an array");else{g.push("Developer provided error stack...");g=g.concat(f);g.push("");g.push("Stack trace...");var k=(Error().stack||"").split("\n").map(function(l){return l.trim()});g=g.concat(k);g.push("");g=this.__addConsoleToStack(g);g=g.join("\n");this.__postErrorPayloadToWorker(["custom_error",d,e,g])}}else this.__window.console.error("AppMonitor::reportCustomError - Error code ("+d+") not found in AppMonitorCustomErrorCodes.json")},_testHandleWindowError:function(a,c,d,e,f){this.__handleWindowError(a,c,d,e,f)},_testSetTailSize:function(a){this.__tailSize=a},__handleRefresh:function(){this.__window.location.reload()},__handleCheckForNewHighRateAlert:function(a){var c=this,d=this.__highRateReports[String(a)];d=d?d:0;var e=(new Date).getTime();d&&d>e-36e5||(d=this.__globalStartupModel.get("crashReportUrl")+"/crash_report-"+String(a),this.__rest.get(d).then(function(f){f=f.response.data;var g=new Date(f.first_timestamp).getTime();g=Math.floor((e-g)/864e5)+1;10>=g?(f=parseInt(f.incident_count),10>=g&&200<=f/g&&(c.__highRateReports[String(a)]=e,c.__counterHelper.increment("new_high_rate_window_error"),c.__log("AppMonito::__handleCheckForNewHighRateAlert - High rate report",a))):c.__highRateReports[String(a)]=9999999999999}))},logNav:function(a,c){this.__lastModeID=a;this.__lastSubModeID=c;var d=h.moment().format("YYYY-MM-DD hh:mm:ss"),e=this.__getCaller();this.__window.console.everything.push({type:"nav",time:d,where:e,value:["Navigating to ModeID["+a+"], SubmodeID["+c+"]"]});this.__trimEverything()},waypoint:function(a,c){var d=h.moment().format("YYYY-MM-DD hh:mm:ss"),e=this.__getCaller();c=JSON.stringify(c);this.__window.console.everything.push({type:"waypoint",time:d,where:e,value:["Marker["+a+"], Value["+c+"], ModeID["+this.__lastModeID+"], SubmodeID["+this.__lastSubModeID+"]"]});this.__trimEverything()}})}({moment:m["@moment"],UiCore:m["@UiCore"],errorCodes:m["json!/common/waf/js/AppMonitorCustomErrorCodes.json"],UIContextExtension:H}),db=function(h){return IMVU.BaseClass.extend("LoginSentinel",_.extend({dependencies:["loginManager","timer","window"],initialize:function(b){this.__timer=b.timer;this.__loginManager=b.loginManager;this.__window=b.window;this.__checkLogoutInterval=3e5;(this.__myself=this.__loginManager.isLoggedIn()?this.__loginManager.getCurrentUser():null)?this.__checkLogoutTimer=this.__timer.setTimeout(this.__checkLogout.bind(this),this.__checkLogoutInterval):(this.__checkTimeout=5e3,this.__checkLoginTimer=this.__timer.setTimeout(this.__checkLogin.bind(this),this.__checkTimeout))},delete:function(){this.__checkLoginTimer&&(this.__timer.clearTimeout(this.__checkLoginTimer),this.__checkLoginTimer=null);this.__checkLogoutTimer&&(this.__timer.clearTimeout(this.__checkLogoutTimer),this.__checkLogoutTimer=null);this.__myself&&(this.__myself.off(null,null,this),this.__myself=null)},__checkLogin:function(){this.__loginManager.createFromCookie().then(function(){this.__loginManager.isLoggedIn()?(this.__window.console.hasOwnProperty("trace")&&this.__window.console.trace("Reload after login"),this.__window.location.reload()):window.console.log(Date()+":Check for login, still logged out")}.bind(this));this.__checkTimeout*=2;6e5<this.__checkTimeout&&(this.__checkTimeout=6e5);this.__checkLoginTimer=this.__timer.setTimeout(this.__checkLogin.bind(this),this.__checkTimeout)},__checkLogout:function(){this.__loginManager.createFromCookie().then(function(){this.__loginManager.isLoggedIn()?this.__window.console.log(Date()+":Check for logout, still logged in"):(this.__window.console.hasOwnProperty("trace")&&this.__window.console.trace("Reload after logout - createFromCookie resolved"),this.__window.location.reload())}.bind(this)).catch(function(){this.__window.console.hasOwnProperty("trace")&&this.__window.console.trace("Reload after logout");this.__window.location.reload()}.bind(this));this.__checkLogoutTimer=this.__timer.setTimeout(this.__checkLogout.bind(this),this.__checkLogoutInterval)}},Backbone.Events))}({UiCore:m["@UiCore"]}),eb=function(h){return IMVU.BaseClass.extend("CookieManager",{dependencies:["cookieDomain","platform","serviceProvider","window"],initialize:function(b){this.__window=b.window;this.__cookieDomain=b.cookieDomain;this.__featureAccessManager=b.featureAccessManager;this.__serviceProvider=b.serviceProvider;this.__isElectronClient="win64_app"===b.platform||"darwin_app"===b.platform},set:function(b,a){this.__isElectronClient?(this.__localStorageManager||(this.__localStorageManager=this.__serviceProvider.get("localStorage")),this.__localStorageManager.setItem(b,a)):(b=b+"="+a+";expires=Fri, 31 Dec 9999 23:59:59 GMT;domain="+(this.__cookieDomain+";"),b+="path=/",this.__window.document.cookie=b)},get:function(b){return this.__isElectronClient?(this.__localStorageManager||(this.__localStorageManager=this.__serviceProvider.get("localStorage")),this.__localStorageManager.getItem(b)):IMVU.getCookies(this.__window.document)[b]},clear:function(b){this.__isElectronClient?(this.__localStorageManager||(this.__localStorageManager=this.__serviceProvider.get("localStorage")),localStorage.removeItem(b)):(b=b+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;domain="+(this.__cookieDomain+";"),b+="path=/",this.__window.document.cookie=b)}})}({}),fb=function(){return function(h,b,a){return h==b?a.fn(this):a.inverse(this)}}({}),gb=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e,f=a.helperMissing;c='<div class="imvu-loading">\n    <div class="spinner"></div>\n    <div class="error-message"></div>\n</div>\n\n<div class="notification-bar-placeholder"></div>\n<div class="nav-placeholder"></div>\n<div class="mode-container"></div>\n\n<div class="scene-manager-placeholder"></div>\n<div class="conversation-manager"></div>\n\n<div class="toasters">\n    <div class="notification-toaster-placeholder"></div>\n    <div class="error-toaster-container"></div>\n    <div class="subs-toaster-container-placeholder"></div>\n    <div class="pill-toaster-placeholder"></div>\n</div>\n\n<div class="logout-overlay">\n    <div class="loading"></div>\n    <div class="logout-overlay-text">\n        ';if((a=(e=a["i18n-g"]||b&&b["i18n-g"]||f,e.call(b,"logout-overlay-text",{name:"i18n-g",hash:{},data:d})))||0===a)c+=a;return c+"\n    </div>\n</div>\n"},useData:!0})}({}),R=function(h){var b=h.UiCore.UiContext;return b.extend("ModeManager",{id:"imvu",uiApplication:"alloy",uiContextName:"application",uiPlatform:"next",_isTest:!1,_setIsTest:function(){this._isTest=!0},dependencies:"appTitle availableModes featureAccessManager globalStringManager leanplum localStorage Promise restModelFactory root seenBefore timer uiEventReporter webGL window".split(" "),getSmartBannerAttributes:function(){var a="other";h.MobileBrowser.isIOS(this.__serviceProvider)?a="ios":h.MobileBrowser.isAndroid(this.__serviceProvider)&&(a="android");return{device:a,UA:this.__window.navigator.userAgent}},trackedEvents:function(){var a=this.getSmartBannerAttributes.bind(this);return[{type:"click",selector:"#smartbanner .sb-close",name:"smartbanner_close",handler:function(){},attributes:a},{type:"click",selector:"#smartbanner .sb-button",name:"smartbanner_go_native",handler:function(){},attributes:a}]},initialize:function(a){var c=this;b.prototype.initialize.call(this,a);this.el.dataset.lock=0;this.__module=a.module||module;this.__serviceProvider=a.serviceProvider;this.uiPlatform+="_"+this.__serviceProvider.get("platform");this.__window=a.window;this.__timer=a.timer;this.__uiEventReporter=a.uiEventReporter;this.__restModelFactory=a.restModelFactory;this.__Promise=a.Promise;this.__globalStringManager=a.globalStringManager;this.__seenBefore=a.seenBefore;this.__campaign=a.campaign;this.__root=a.root;this.__availableModes=a.availableModes;this.__modes={};this.__currentModeId=null;this.submodesOpened=this.__modesOpened=0;this.__pageReadyRecorded=!1;this.__dismissibles=[];this.__openingMode=!1;this.__webOnlyModes=["earn_credits","policyhub"];this.__excludedFromIdStyleSubmodes=["withdraw_ticket-"];this.__modeChangeConfirmers=[];this.__readyPromiseObj={};this.__readyPromiseObj.finished=new this.__Promise(function(d){c.__readyPromiseObj.promiseResolver=d});this.addToDOM();this.show();this.__recordBrowserInformation();this.__recordUserStats();this.__animationManagerSetup();this.__inputFieldSetup();this.__whisperChangeConfirmerName="bound __onModeChangeAttempt";h.Dropdown.prototype.globalSetup();h.NextUtil.DomHelper.dismissibleSetUp();h.NextUtil.DomHelper.goLinkSetUp(this.__serviceProvider)},recordPageReady:function(){var a=this;if(!(this.__pageReadyRecorded||!this.__window.performance||1<this.__modesOpened)){var c=this.__timer.getTime();c={record:!0,mode:this.__currentModeId,fetchTime:(this.__window.performance.timing.responseEnd-this.__window.performance.timing.navigationStart)/1e3,domConstructionTime:(this.__window.performance.timing.loadEventEnd-this.__window.performance.timing.domLoading)/1e3,contentDisplayTime:(c-this.__window.performance.timing.loadEventEnd)/1e3,totalTime:(c-this.__window.performance.timing.navigationStart)/1e3};this.__recordEvent("page_ready",c);var d={};_.each("redirectStart redirectEnd fetchStart domainLookupStart domainLookupEnd connectStart secureConnectionStart connectEnd requestStart responseStart responseEnd".split(" "),function(e,f){a.__window.performance.timing[e]&&(d[e]=(a.__window.performance.timing[e]-a.__window.performance.timing.navigationStart)/1e3)});this.__window.console.log("Page load stats:");this.__window.console.log(JSON.stringify(c));this.__window.console.log(JSON.stringify(d));this.__pageReadyRecorded=!0}},__recordBrowserInformation:function(){var a=this.__serviceProvider.get("platform"),c=0,d="<unknown>",e=document.createElement("canvas").getContext("webgl");if(e){c=1;d={renderer:[e.getParameter(e.RENDERER)],vendor:[e.getParameter(e.VENDOR)]};var f=e.getExtension("WEBGL_debug_renderer_info");f&&(d.renderer.push(e.getParameter(f.UNMASKED_RENDERER_WEBGL)),d.vendor.push(e.getParameter(f.UNMASKED_VENDOR_WEBGL)));"test"===a&&(d="test");document.createElement("canvas").getContext("webgl2")&&(c=2)}a={record:!0,appName:this.__window.navigator.appName,appVersion:this.__window.navigator.appVersion,cookieEnabled:this.__window.navigator.cookieEnabled,language:this.__window.navigator.language,platform:this.__window.navigator.platform,standalone:this.__window.navigator.standalone||!1,userAgent:this.__window.navigator.userAgent,vendor:this.__window.navigator.vendor,deviceMemory:this.__window.navigator.deviceMemory||"unknown",webgl:c,webglDebug:d,canUse3d:this.__webGL.canUse3d(),nextPlatform:a};this.__recordEvent("browserInfo",a)},__recordUserStats:function(){this.__recordEvent("userStats",{record:!0,referer:document.referrer,is_new_new:!this.__seenBefore,campaign:this.__campaign})},addDismissible:function(a){_.contains(this.__dismissibles,a)||this.__dismissibles.push(a)},removeDismissible:function(a){this.__dismissibles=_.without(this.__dismissibles,a)},dismissAllDismissibles:function(){h.NextUtil.DomHelper.dismissAllDismissibles();this.__serviceProvider.get("dialogManager").closeAll(!0);$("#qa-3d-info-panel").hide();_.invoke(this.__dismissibles,"call")},__inputFieldSetup:function(){var a=this,c=this;$(document).on("keyup",'.search > [type="text"], .signup-dialog input, .login-dialog input',function(d){$(this).toggleClass("is-filled",!!$(this).val());d.keyCode===h.NextUtil.Keys.VK_ENTER&&(c.__serviceProvider.get("featureAccessManager").canSeeRoomDeco2()?c.getCurrentMode():$(this).blur())});$(document).on("click",'.search > [type="reset"]',function(){$(a).parent().find('[type="text"]').removeClass("is-filled").focus()});$(document).on("click",'.signup-dialog [type="reset"]',function(){$(a).prev('[type="text"]').removeClass("is-filled").focus()})},__animationManagerSetup:function(){var a=this;$(document).on("click","nav > ul > li, button",function(c){c=$(c.currentTarget);c.addClass("clicked");h.NextUtil.DomHelper.applyTemporaryClass(a.__timer,c,"animating-delayed-fadein")});$(document).on("mouseleave","nav > ul > li, button",function(c){$(c.currentTarget).removeClass("clicked")})},delete:function(){h.Dropdown.prototype.globalTearDown();h.NextUtil.DomHelper.dismissibleTearDown();$(document).off("click mouseleave keyup");b.prototype.delete.call(this)},ready:function(){return this.__readyPromiseObj.finished.then.apply(this.__readyPromiseObj.finished,arguments)},render:function(){this.$el.html(h.template());this.__readyPromiseObj.promiseResolver.resolve("test")},isOpeningMode:function(){return this.__openingMode},getNodeModelForType:function(a){switch(a){case"feed_element":a=h.Model.FeedNode;break;case"product":a=h.Model.ProductNode;break;default:a=h.UiCore.NodeModel}return a},isIdStyleSubmode:function(a){return!this.__excludedFromIdStyleSubmodes.some(function(c){return-1!==a.indexOf(c)})},openModeFromPath:function(a){a=_.rest(_.compact(a.split("/")));var c=1<a.length?a[1]:null;this.openMode({openDefaultView:c?!1:!0,mode:{id:a[0]},submode:{id:c}})},openMode:function(a){var c=this;this.__handleSyncedMediaRoomSupport=a.handleSyncedMediaRoomSupport;if(this.__openingMode)return this.__Promise.reject({openingMode:!0});this.__openingMode=!0;this.__modesOpened&&this.dismissAllDismissibles();var d=IMVU.requireProperty(a,"mode"),e=IMVU.optionalProperty(a,"submode",{id:""});e.id=String(e.id).trim();var f=this.__serviceProvider.get("loginManager"),g=this.__serviceProvider.get("featureAccessManager");"store"!==d.id||""!==e.id&&"__default__"!==e.id?"dressup"===d.id?d.id="inventory":"shop"===d.id&&"skin"===e.id?e.id="skins":"discover_rewards"!==d.id||g.canSeeOnboardingGamification()||(d.id="home"):(g=String(this.__window.location.hash),g=0===g.search("#")?g.substring(1):g,"host_subscription"===g?(e={id:g},a.openDefaultView=!1):f.isLoggedIn()||(this.__window.location="/welcome/login/"));if(this.__webOnlyModes.includes(d.id)&&this.__featureAccessManager.isElectronClient())return"undefined"!==typeof e&&e.id||(e={id:""}),this.__serviceProvider.get("externalWindow").open(this.__serviceProvider.get("externalNextRoot")+d.id+"/"+e.id,"_blank"),this.__openingMode=!1,this.__Promise.reject();var k=!0;e&&""!==e.id&&(k=IMVU.optionalProperty(a,"openDefaultView",!1));this.__availableModes[d.id]?e&&e.id?this.__leanplum.setState(d.id,{submode:e.id}):this.__leanplum.setState(d.id):this.__leanplum.setState("unknown_mode",{mode:d.id});f=this.getCurrentMode();f=!(!f||f.id!==d.id||!f.isCurrentSubmode(k?"__default__":e.id));return this.doWork([].concat($jscomp.arrayFromIterable(f?[]:this.__modeChangeConfirmers))).then(function(){c.__modesOpened++;c.setTitle(c.__globalStringManager.get("Loading"));c.__serviceProvider.get("globalNav").markActiveMode({id:d.id});$("#qa-3d-info-panel").hide();var l=null,n=new c.__Promise(function(v){return l=v});n.then(function(){return c.__openingMode=!1});if(c.__currentModeId!==d.id&&c.__modes[c.__currentModeId]){var p=c.getCurrentMode();null!==p&&p.hide();c.clearModeChangeConfirmers()}if(c.__modes[d.id]){var q=c.__currentModeId!==d.id||a.showAlways;c.__currentModeId!==d.id&&(c.__currentModeId=d.id,c.__registerHandlebarsHelper(d.id));p=c.getCurrentMode();if(!p)return c.__Promise.reject();p.$el.show();e=_.extend({poppingHistory:!!a.poppingHistory},e||{});k?p.openDefaultView():p.openSubmode(e);q?p.show(_.extend(d,e)):(c.__serviceProvider.get("globalNav").markActiveMode(p),c.setTitle(p.getTitle()));++c.el.dataset.lock;l.resolve(p)}else{var t=IMVU.optionalProperty(c.__availableModes,d.id,c.__availableModes["default"]);c.__modes[d.id]={};var r=c.__currentModeId;c.__currentModeId=d.id;p=t.startupUrl;"true"===c.__localStorage.getItem("forceProduction")&&(p=p.replace("localhost.",""));var u=c.track(c.__restModelFactory.readModel(p,h.UiCore.NodeModel));"rejected"===u.populated().state&&u.invalidate();u.populated().then(function(){c.__modes[d.id].nestedProvider=c.__serviceProvider.nestedProvider();c.__modes[d.id].nestedProvider.register("startupModel",u);c.__modes[d.id].nestedProvider.register("startMode",c.__serviceProvider.get("startMode"));c.__modes[d.id].nestedProvider.register("startSubmode",c.__serviceProvider.get("startSubmode"));a=_.extend(d,{$parentElement:c.$(".mode-container"),parentUiContext:c,submode:e});var v={mode:t.alias};c.__window.$$STRINGTABLE||(v.dictionary="json!"+t.dictionaryAlias);c.__module.run(v,function(w){this.__window.$$STRINGTABLE&&(w.dictionary=this.__window.$$STRINGTABLE[t.dictionaryAlias.slice(1)]);this.__modes[a.id].stringManager=this.__modes[a.id].nestedProvider.create(h.StringManager,{dictionary:w.dictionary});this.__modes[a.id].nestedProvider.register("stringManager",this.__modes[a.id].stringManager);this.__registerHandlebarsHelper(d.id);this.__modes[a.id].mode=this.__modes[a.id].nestedProvider.create(w.mode,a);this.children().push(this.__modes[a.id].mode);this.__modes[a.id].mode.show();k?this.__modes[a.id].mode.openDefaultView():(e=_.extend({handleSyncedMediaRoomSupport:this.__handleSyncedMediaRoomSupport},e||{}),this.__modes[a.id].mode.openSubmode(e));++this.el.dataset.lock;l.resolve(this.__modes[a.id].mode)}.bind(c))})["catch"](function(v){_.isEqual(c.__modes[d.id],{})&&delete c.__modes[d.id];c.__currentModeId===d.id&&(c.__currentModeId=r);l.reject(v);c.untrack(u);c.__openingMode=!1})}c.__recordEvent("load_"+c.__currentModeId+"_mode",{});c.trigger("mode:change");return n}).catch(function(l){c.__openingMode=!1;c.__window.console.error(l);return c.__Promise.reject(l)})},togglePermalink:function(a){!0===a?(this.$(".mode-container").addClass("is-permalink"),this.$(".magic-line-menu").addClass("hidden"),this.$(".rooms-mode .magic-line-menu").css("display","")):(this.$(".mode-container").removeClass("is-permalink"),this.$(".magic-line-menu").removeClass("hidden"))},deleteMode:function(a){this.__modes[a]&&(this.__modes[a].mode.delete(),delete this.__modes[a])},getCurrentMode:function(){return this.__currentModeId&&this.__modes[this.__currentModeId]?this.__modes[this.__currentModeId].mode||null:null},getCurrentActiveChat:function(){return this.getCurrentMode()&&this.getCurrentMode().__currentSubmode?(this.getCurrentMode().__currentSubmode.__activeChat||"chat"!==this.getCurrentMode().id||this.__window.console.warn('getCurrentActiveChat: You are in a chat room, but there is no "__activeChat" on the submode.'),this.getCurrentMode().__currentSubmode.__activeChat):null},getCurrentModeAndSubmodeIDs:function(){var a=this.getCurrentMode().id,c=this.getCurrentMode().__currentSubmode.id;return{modeID:a,submodeID:c}},__registerHandlebarsHelper:function(a){a=this.__modes[a].stringManager;Handlebars.registerHelper("i18n",a.handlebarsHelper.bind(a));Handlebars.registerHelper("i18n-gwd",a.handlebarsHelperWithDefault.bind(a))},setNotificationCount:function(a){var c=this.__window.document.title,d=/(\(\d+\))+/;c.match(d)?this.__window.document.title=0<a?c.replace(d,"("+a+")"):c.replace(d,"").trim():0<a&&(this.__window.document.title="("+a+") "+c)},setTitle:function(a){this.__window.document.title=this.__makeTitle(a);this.__serviceProvider.get("globalNav").trigger("titleUpdate")},__makeTitle:function(a){return"Download"===a?"IMVU : "+this.__globalStringManager.get("title_overwrite_download"):""!==a?a+" : "+this.__appTitle:this.__appTitle},setModeChangeConfirmer:function(a){this.__modeChangeConfirmers.push(a)},clearModeChangeConfirmers:function(){this.__modeChangeConfirmers=[]},getModeChangeConfirmers:function(){return this.__modeChangeConfirmers},createSmartBanner:function(){$.smartbanner({title:"IMVU",appendToSelector:"#imvu"})}})}({globalCSS:m["@globalCSS"],Model:m["@Model"],NextUtil:m["@NextUtil"],ScrollBar:m["@ScrollBar"],SmartBanner:m["@SmartBanner"],UiCore:m["@UiCore"],Dropdown:G,MobileBrowser:z,StringManager:O,template:gb}),S=function(h){return function(b){b=void 0===b?{}:b;this.window=b.window||window;this.canvas=b.canvas||$("<canvas width=800, height=600></canvas>")[0];b=null;var a=!1;try{b=this.canvas.getContext("webgl")}catch(d){b=null}if(!b)try{b=this.canvas.getContext("experimental-webgl"),a=!0}catch(d){b=null}if(b){var c=b.createShader(b.VERTEX_SHADER);b.shaderSource(c,"struct Vertex {lowp float f;}; void main() { gl_Position = vec4(0, 0, 0, 0); }");b.compileShader(c)}return{canGetContext:!!b,canCompileShader:!(!b||!b.getShaderParameter(c,b.COMPILE_STATUS)),isExperimental:a}}}({}),hb=function(h){return IMVU.BaseClass.extend("WebGL",{dependencies:["cookieManager","deviceType","platform"],initialize:function(b){this.__platform=b.platform;this.__deviceType=b.deviceType;this.__webGLInfo=b.webGLInfo||h.WebGLInfo();this.__cookieManager=b.cookieManager;this.__enable3d="undefined"!==typeof b.enable3d?b.enable3d:_.reduce(["mobile"===this.__platform,"tablet"===this.__deviceType||"phone"===this.__deviceType,!this.__webGLInfo.canCompileShader],function(a,c){return a&&!c},!0)},canUse3d:function(){return this.__enable3d},use3d:function(){return"0"!==this.__cookieManager.get("prefer_3d")?this.__enable3d:!1}})}({WebGLInfo:S}),ib=function(h){return IMVU.BaseClass.extend("GoogleAnalytics",{dependencies:["window"],initialize:function(b){this.__serviceProvider=b.serviceProvider;this.__window=b.window},recordPageView:function(){this.recordPageView=function(b){"undefined"!==typeof this.__window.gaTrack&&this.__window.gaTrack("send","pageview","/"===b.substr(0,1)?b:"/"+b)}},recordModeChange:function(b){this.__sendEvent("mode","show",b)},recordSubModeChange:function(b){this.__sendEvent("submode","show",b)},recordSignUpClick:function(b){this.__sendEvent("sign up","show dialog",b)},recordRegistrationComplete:function(b){this.__sendEvent("sign up","registration complete",b)},recordSuccessfulAuthentication:function(b){this.__sendEvent("logging in","authenticate",b)},recordProfileImageChanged:function(b){this.__sendEvent("profile image","changed",b)},recordBuyAnItem:function(b){this.__sendEvent("catalog","purchased item",b)},recordFeedItemCreated:function(b){this.__sendEvent("feed item","created",b)},recordFeedItemAction:function(b){this.__sendEvent("feed item","action",b)},recordFriendRequest:function(b){this.__sendEvent("friends","requests",b)},recordEnterChatRoom:function(b){this.__sendEvent("chat rooms","enter",b)},recordChatSend:function(b){this.__sendEvent("chat","send message",b)},recordMessagingEvents:function(b){this.__sendEvent("messaging","messages",b)},recordDollarStore:function(b,a){this.__sendEvent("dollar store",b,a)},recordClick:function(b,a){this.__sendEvent(b,"click",a)},recordPerformance:function(b,a,c){if("undefined"!==typeof this.__window.gaTrack){if(c!==parseInt(c,10))throw Error('google analytics expects an integer value for the field: "eventValue"');this.__window.gaTrack("send","event","performance",b,a,c)}},__sendEvent:function(b,a,c){"undefined"!==typeof this.__window.gaTrack&&this.__window.gaTrack("send","event",b,a,c)}})}({UiCore:m["@UiCore"]}),jb=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e,f=a.helperMissing;c=this.escapeExpression;var g="<div class='dialog-content'>\n    ";if((f=(e=a.icon||b&&b.icon||f,e.call(b,"icon-imvu-logo",{name:"icon",hash:{},data:d})))||0===f)g+=f;return g+'\n    <p class="dialog-content-heading">'+c((e=a.header||b&&b.header,"function"===typeof e?e.call(b,{name:"header",hash:{},data:d}):e))+"</p>\n    <p>"+c((e=a.text||b&&b.text,"function"===typeof e?e.call(b,{name:"text",hash:{},data:d}):e))+'</p>\n</div>\n<footer class="dialog-footer">\n    <button class="btn btn-primary full-width downlaod-app">'+c((e=a.ctaText||b&&b.ctaText,"function"===typeof e?e.call(b,{name:"ctaText",hash:{},data:d}):e))+"</button>\n</footer>"},useData:!0})}({}),kb=function(h){var b=h.Dialogs.AlloyModalDialog;return b.extend("downloadAppDialog",{uiContextName:"download_app_dialog",className:"download_app_dialog dialog-type-B",dependencies:"dialogManager featureAccessManager globalStringManager loginManager modeManager nextRoot platform prefsManager Promise window".split(" "),trackedEvents:function(){return[{type:"click",selector:"button.cancel",name:"cancel",handler:this.__cancel},{type:"click",selector:"button.downlaod-app",name:"download_app",handler:this.__goToDownloadPage}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__stringManager=a.globalStringManager;this.__modeManager=a.modeManager;this.__app=IMVU.optionalProperty(a,"app","new");"new"===this.__app?(this.title=this.__stringManager.get("dialog_download_app_title"),this.__header=this.__stringManager.get("dialog_download_app_text_header"),this.__text=this.__stringManager.get("dialog_download_app_text_body"),this.__ctaText=this.__stringManager.get("dialog_download_app_button")):"original"===this.__app&&(this.title=this.__stringManager.get("dialog_download_original_app_title"),this.__header=this.__stringManager.get("dialog_download_original_app_text_header"),this.__text=this.__stringManager.get("dialog_download_original_app_text_body"),this.__ctaText=this.__stringManager.get("dialog_download_original_app_button"));this.addToDOM()},postRender:function(){this.setContent("body",h.template({header:this.__header,text:this.__text,ctaText:this.__ctaText}))},__goToDownloadPage:function(){h.MobileBrowser.isIOSSafari(this.serviceProvider)?this.__window.location="https://itunes.apple.com/us/app/imvu-mobile/id919745844?mt=8":h.MobileBrowser.isAndroid(this.serviceProvider)?this.__window.location="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova":this.__modeManager.openMode({mode:{id:"download"},openDefaultView:!0})}})}({Dialogs:m["@Dialogs"],NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],MobileBrowser:z,template:jb}),lb=function(h){var b=h.UiCore.UiContext;return b.extend("ProtocolLinksManager",{dependencies:["dialogManager","featureAccessManager","modeManager","timer","window"],initialize:function(a){b.prototype.initialize.call(this,a);this.__dialogManager=a.dialogManager;this.__featureAccessManager=a.featureAccessManager;this.__modeManager=a.modeManager;this.__timer=a.timer;this.__window=a.window;this.__desktopRedirectHandler=a.desktopRedirectHandler||this.__defaultDesktopRedirectHandler},makeProtocolLink:function(a,c,d){switch(a.id){case"chat":if("undefined"!==typeof d&&"chat_now"===d.id)var e=this.__featureAccessManager.isMobile()?"imvu://go.imvu.com/chat/start_chat_now/":"imvu:showMode?mode=chatNow";else e=c.get("customers_id")+"-"+c.get("customers_room_id"),c=c.get("supports_audience")&&this.__featureAccessManager.canSeeWindows5050()?"imvudesktop://JoinPublicRoom?room_instance_id="+e:"imvu:JoinPublicRoom?room_instance_id="+e,e=this.__featureAccessManager.isMobile()?"imvu://go.imvu.com/chat/room-"+e:c;break;case"chatRooms":e=this.__featureAccessManager.isMobile()?"imvu://go.imvu.com/chat/":"imvu:showMode?mode=chatRooms";break;case"decorate":e=c.attributes.customers_id+"-"+c.attributes.customers_room_id;e=this.__featureAccessManager.isMobile()?"imvu://go.imvu.com/chat/room-"+e:"imvu:JoinPublicRoom?room_instance_id="+e+"&mode=decorate";break;case"shop":"shop_together"!==d.id||this.__featureAccessManager.isMobile()||(e="imvu:JoinShopTogetherRoom",d.model?(c=d.model.get("customers_id")+"-"+d.model.get("customers_room_id"),e+="?invite_room_instance_id="+c):d.invitedUser&&(c=d.invitedUser.get("legacy_cid"),e+="?invited_user_id="+c))}return e},__defaultDesktopRedirectHandler:function(a){var c=document.createElement("iframe");c.setAttribute("src",a);c.style.display="none";document.body.appendChild(c)},handleProtocolLink:function(a){var c="undefined"!==typeof a.evt?a.evt:a,d=a.currentSubmode,e=a.parent,f=a.mode,g=a.submode,k=a.model,l=a.launchOrDownload||"download";a=a.handleSyncedMediaRoomSupport;"undefined"===typeof f&&c.preventDefault();if(this.__featureAccessManager.isElectronClient()||!this.__featureAccessManager.canSeeClientUpsell()||this.__featureAccessManager.isDev()||this.__featureAccessManager.tempChatOnWeb())"chat"===f.id?null===d||"undefined"===typeof d?(this.__modeManager.openMode({mode:f,submode:g}),this.__serviceProvider.get("windowManager").removeWindow(g.id)):(d.joinRoom(),e.removeIfInASubmode()):"decorate"!==f.id&&"shop_together"!==g.id||this.__modeManager.openMode({mode:f,submode:g,handleSyncedMediaRoomSupport:a});else{c=c.target;f=("undefined"===typeof c?void 0:c.href)||this.makeProtocolLink(f,k,g);if("launch"!==l)var n=this.__timer.setTimeout(function(){this.__window.console.log("time out expired");return this.__dialogManager.showDialog(h.downloadAppDialog)}.bind(this),2e3);this.__window.addEventListener("focusout",function(){this.__window.console.log("blur event triggered");"launch"!==l&&(this.__window.console.log("timeout: ",n),this.__timer.clearTimeout(n))}.bind(this));this.__featureAccessManager.isMobile()?this.__window.location=f:this.__desktopRedirectHandler(f)}}})}({UiCore:m["@UiCore"],downloadAppDialog:kb,MobileBrowser:z}),mb=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){return"<img class='silhouette' src='/common/withme/img/loading_avatar.png'>"},useData:!0})}({}),nb=function(h){var b=h.UiCore.UiContext;return b.extend("Avatar2d",{uiContextName:"avatar_2d",className:"avatar-2d",dependencies:["dialogManager","globalStringManager","model","timer"],initialize:function(a){b.prototype.initialize.call(this,a);this.__width=IMVU.optionalProperty(a,"width",800);this.__height=IMVU.optionalProperty(a,"height",800);this.__vanishDelay=IMVU.optionalProperty(a,"vanishDelay",800);this.__imageError=IMVU.optionalProperty(a,"imageError","error");this.__imageFactory=IMVU.optionalProperty(a,"imageFactory",function(){return new Image});this.__lookModel=this.__model;this.addToDOM();this.__lookModel.on("syncing",this.__refreshLoading,this);this.__refreshLoading();a.filterModel?(this.__filterModel=a.filterModel,this.listenTo(this.__filterModel,"change:category",this.__updateAvatarImage.bind(this))):a.view&&(this.__view=a.view);this.listenTo(this.__lookModel,"change",this.__updateAvatarImage.bind(this));this.__lookModel.populated().then(this.__updateAvatarImage.bind(this))},getSceneLoadedPromise:function(){return this.__lookModel.populated()},delete:function(){this.__destroyInFlightImage();this.$(".avatar-image").off();this.__timer.clearTimeout(this.__vanishTimer);b.prototype.delete.call(this)},__refreshLoading:function(){this.$el.toggleClass("loading",this.__lookModel.isSyncing()||!!this.__$inFlightImage)},__destroyInFlightImage:function(){this.__$inFlightImage&&(this.__$inFlightImage.off(),this.__$inFlightImage=null)},__vanishCurrentImage:function(){if(this.__$currentImage){var a=this.__$currentImage;a.addClass("vanishing");this.__$currentImage=null;this.__vanishTimer=this.__timer.setTimeout(function(){a.remove()},this.__vanishDelay)}},__maybeFadeIn:function(a){this.$el.is(":visible")&&a.addClass("fade-in")},__onImageLoad:function(){this.__setAsRendered();this.__vanishCurrentImage();this.__$currentImage=this.__$inFlightImage;this.__maybeFadeIn(this.__$inFlightImage);this.$el.addClass("populated").removeClass("error").append(this.__$inFlightImage);this.__$inFlightImage=null;this.__refreshLoading()},__onImageFail:function(){this.__setAsRenderFailed();this.trigger("avatar_load_fail");this.__destroyInFlightImage();this.__recordEvent("avatar_image_load_error",{url:this.__lookModel.get("avatar_image"),record:!0});this.$el.addClass("error");this.__refreshLoading();this.__dialogManager.alert({title:this.__globalStringManager.get("dialog_avatar_error_title"),text:this.__globalStringManager.get("dialog_avatar_error_text"),ok:this.__globalStringManager.get("dialog_avatar_error_button")})},__buildFilterView:function(){var a=this.__filterModel.get("category");return"dressup_front_"+(_.contains("wearing all accessories skins avatars outfits".split(" "),a)?"all":a)},__buildImageSrc:function(){return IMVU.URI.build(this.__lookModel.get("avatar_image"),{width:this.__width,height:this.__height,view:this.__filterModel?this.__buildFilterView():this.__view})},__updateAvatarImage:function(){if(void 0!==this.__lookModel.get("avatar_image")&&null!==this.__lookModel.get("avatar_image")){var a=this.__buildImageSrc();a!==this.__currentImageSrc&&(this.__currentImageSrc=a,this.__destroyInFlightImage(),this.__$inFlightImage=$(this.__imageFactory()),this.__$inFlightImage.attr("src",a).addClass("avatar-image avatar-2d-ie11-fix").on("load",this.__onImageLoad.bind(this)).on(this.__imageError,this.__onImageFail.bind(this)),this.__refreshLoading())}},isRendering:function(){return!0},render:function(){this.$el.html(h.template());this.__maybeFadeIn(this.$(".silhouette"))}})}({UiCore:m["@UiCore"],template:mb}),ob=IMVU.BaseClass.extend("Manager",Backbone.Events),pb=function(h){var b=h.Manager;return b.extend("SceneManager",{dependencies:"featureAccessManager loginManager module moduleBundle Promise webGL window".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__featureAccessManager=a.featureAccessManager;this.__loginManager=a.loginManager;this.__module=a.module||module;this.__moduleBundle=a.moduleBundle;this.__Promise=a.Promise;this.__window=a.window;this.__soloScenes={};this.__avatarRaceConditionFlag={};this.__sceneLoaderPromise=null;this.__view=a.view||"**unknown**";this.__webGL=a.webGL;this.__sceneFactories=a.sceneFactories||{SoloScene:a.soloSceneFactory,ChatSceneModule:a.scenePresenterFactory,FtuxSceneModule:a.ftuxSceneFactory}},delete:function(){},pauseScene:function(a){this.__soloScenes[a.context.cid]&&this.__soloScenes[a.context.cid].pause()},resumeScene:function(a){this.__soloScenes[a.context.cid]&&this.__soloScenes[a.context.cid].resume()},__resetLoadEvents:function(){var a=this;this.__loadEvents={};_.each(["sceneCreated","sceneLoaded"],function(c){new a.__Promise(function(d){return a.__loadEvents[c]=d})})},getInitProfileScenePromise:function(){return this.__initProfileScenePromise},initProfileScene:function(a){var c=this;this.__initProfileScenePromise=new this.__Promise(function(e){this.__initProfileSceneResolver=e}.bind(this));this.__resetLoadEvents();this.__sceneArgs=a;var d=this.__sceneArgs.context.cid;if(this.__webGL.use3d())if(this.__avatarRaceConditionFlag[d]||"undefined"!==typeof this.__soloScenes[d]&&!_.isNull(this.__soloScenes[d])){if(this.__initProfileSceneResolver.resolve(),!this.__featureAccessManager.isElectronClient())return this.__soloScenes[d]}else this.__avatarRaceConditionFlag[d]=!0,this.showSolo(_.extend(a,{avatarNode:a.model,view:this.__view,filterModel:IMVU.optionalProperty(a,"filterModel",null),size:"match-parent",enableThumbs:!1,camParams:a.camParams||{},sceneContext:a.sceneContext,soloSceneCid:d})).then(function(e){this.__soloScenes[d]=e;this.__loadEvents.sceneCreated.accept();this.listenTo(this.__soloScenes[d],"assetChanged",this.trigger.bind(this,"assetChanged"));return this.__soloScenes[d].loadedEverything()}.bind(this)).then(function(){this.__initProfileSceneResolver.resolve();this.__loadEvents.sceneLoaded.accept()}.bind(this)).catch(function(e){c.__initProfileSceneResolver.reject();c.trigger("avatar_load_fail");return c.__Promise.reject(e)});else a.context.createChildContext(h.Avatar2d,a).getHasRenderedPromise().then(function(){c.__initProfileSceneResolver.resolve();c.__loadEvents.sceneLoaded.accept()});return this},__loadedLazyDependencies:function(){this.__loadedLazyDependenciesResolver||new this.__Promise(function(a){this.__loadedLazyDependenciesResolver=a;this.__module.run({bundle:this.__moduleBundle},function(c){this.__sceneFactories=c.bundle;a.resolve()}.bind(this))}.bind(this));return this.__loadedLazyDependenciesResolver.promise},showScene:function(a,c){c=void 0===c?{}:c;var d=IMVU.optionalProperty(c,"showDefaultLoadingBar",!0);_.each(["context","$parentElement"],function(e){c[e]=IMVU.requireProperty(c,e,'showScene requires a "'+e+'" arg')});return this.__loadedLazyDependencies().then(function(){if(!this.__sceneFactories[a]){var e=Object.getOwnPropertyNames(this.__sceneFactories).join(", ");throw Error('Tried to show a Scene of unrecognized type "'+a+'" from the list of those expected:  '+e)}try{e=c.context.createChildContext(this.__sceneFactories[a],c)}catch(g){return this.__window.console.warn(g),this.__Promise.reject(g)}if(d){var f=c.progressPromises||[e.loadedEverything()];e.showLoadingProgress(c.context,{$parentElement:c.$parentElement,progressPromises:f})}e.loadingBarPromiseResolver.resolve();return e}.bind(this))},showSolo:function(a){a=void 0===a?{}:a;this.__resetLoadEvents();_.each(["avatarNode"],function(c){a[c]=IMVU.requireProperty(a,c,'showSolo requires a "'+c+'" arg')});a=_.extend({size:"match-parent"},a);return this.showScene("SoloScene",a).then(function(c){return c.loadedEverything()}.bind(this))},initChatScene:function(a){this.__resetLoadEvents();this.__roomTutorialAnimation=a.roomTutorialAnimation;return this.__getSceneSpec(a.sceneNode).then(function(c){return this.showScene("ChatSceneModule",_.extend({sceneSpec:c},a))}.bind(this))},initRoomDecoScene:function(a){this.__resetLoadEvents();return this.__getSceneSpec(a.sceneNode).then(function(c){return this.showScene("ChatSceneModule",_.extend({sceneSpec:c,typeOfScene:"editRoomDecoration"},a))}.bind(this))},initShopTogetherScene:function(a){this.__resetLoadEvents();return this.__getSceneSpec(a.sceneNode).then(function(c){return this.showScene("ChatSceneModule",_.extend({sceneSpec:c,typeOfScene:"shopTogether"},a))}.bind(this))},initProductPreviewScene:function(a){this.__resetLoadEvents();return this.__getSceneSpec(a.sceneNode,{roomModelType:h.Model.ProductNode}).then(function(c){return this.showScene("ChatSceneModule",_.extend({sceneSpec:c},a))}.bind(this))},initFtuxScene:function(a){this.__resetLoadEvents();return this.showScene("FtuxSceneModule",_.extend({showDefaultLoadingBar:!1},a))},generateFurnitureSpecs:function(a){var c=[];a.each(function(d){var e={instanceId:d.node.get("instance_id").toString(),assetUrl:d.node.get("asset_url"),attachmentNodeName:d.node.get("node").toString(),x:d.node.get("x"),y:d.node.get("y"),z:d.node.get("z"),yaw:d.node.get("yaw"),pitch:d.node.get("pitch"),roll:d.node.get("roll"),scale:d.node.get("scale"),lock:d.node.get("lock"),syncPropActions:d.node.get("sync_prop_actions"),syncSeatStances:d.node.get("sync_seat_stances"),isPoseProduct:void 0!==d.node.get("is_pose_product")?d.node.get("is_pose_product"):!1};this.__featureAccessManager.canSeeRoomDeco2()&&d.node.get("free_play.enabled")&&(e.freePlay={enabled:!0});c.push(e)}.bind(this));return c},__getSceneSpec:function(a,c){c=_.extend({roomModelType:h.Model.NodeModel},c);this.__myCid="0";this.__loginManager.isLoggedIn()&&(this.__myself=this.__loginManager.getCurrentUser(),this.__myCid=this.__myself.get("legacy_cid").toString());var d,e=new this.__Promise(function(p){d=p}.bind(this)),f=a.attributes.room_asset_url,g=[],k=[],l=a.getSingleEdge("room",c.roomModelType),n=a.getEdgeCollection("furniture");this.__Promise.every([l.populated(),n.populated()]).then(function(){var p=this;g=this.generateFurnitureSpecs(n);l.relations.chat?l.getSingleEdge("chat").populated().then(function(q){return q.getEdgeCollection("participants").populated()}).then(function(q){q.each(function(t){t={participantKey:t.node.get("legacy_cid").toString(),assetUrl:t.edge.get("asset_url"),seatNodeAddress:{furnitureInstanceId:t.edge.get("seat_furni_id").toString(),seatNumber:t.edge.get("seat_number")},isPrimary:t.node.get("legacy_cid").toString()===this.__myCid?!0:!1};k.push(t)}.bind(this));d.resolve({roomAssetUrl:f,furnitureSpecs:g,participantSpecs:k})}.bind(this)).catch(function(q){p.__window.console.error(q);p.__loginManager.isLoggedIn()||d.resolve({roomAssetUrl:f,furnitureSpecs:g,participantSpecs:k})}):d.resolve({roomAssetUrl:f,furnitureSpecs:g,participantSpecs:k})}.bind(this));return e},getRoomTutorialAnimation:function(){return this.__roomTutorialAnimation},getSceneLoadedPromise:function(){return this.__loadEvents.sceneLoaded.promise},isRendering:function(a){return!_.isNull(this.__soloScenes[a.context.cid])},toggleRendering:function(a,c){var d=c.context.cid;this.__soloScenes[d]&&!a?(this.__soloScenes[d].delete(),this.__soloScenes[d]=null,this.__avatarRaceConditionFlag[d]=!1):a&&!this.__soloScenes[d]&&this.initProfileScene(c)},playTriggeredAction:function(a,c){c=c.context.cid;this.__soloScenes[c]?this.__soloScenes[c].playTriggeredAction(a):this.__window.console.log("scene for view ",this.__soloScenes[c]," does not exist")},getSoloScene:function(a){return this.__soloScenes[a.context.cid]},getSoloSceneId:function(a){return this.__soloScenes[a.context.cid].cid}})}({Model:m["@Model"],UiCore:m["@UiCore"],Avatar2d:nb,ChatAnimationJson:m["json!/common/waf/js/dialog/tutorialTemplate/node_room_1_tutorial.json"],Manager:ob}),qb=function(h){function b(d){return void 0!==d?decodeURIComponent(d.replace(/\+/g,"%20")):""}function a(d){var e={};0<d.length&&(d=d.substring(1),d=d.split("&"),_.each(d,function(f){var g=f.split("=");f=b(g[0]);g=b(g[1]);if(c.test(f))if(c.exec(f)[1]){var k=f.replace(c,"");k in e||(e[k]={});e[k][c.exec(f)[1]]=g}else f=f.replace(c,""),f in e||(e[f]=[]),e[f].push(g);else e[f]=g}));return e}var c=/\[(.*?)\]/;return{fetch:function(d,e){var f=a(d.location.search),g=_.pick(f,e);e=_.omit(f,e);f=d.location.pathname;_.size(e)&&(f+="?"+$.param(e));d.history.replaceState(d.history.state,document.title,f);return g},get:function(d,e){return a(d.location.search)[e]},getAllParams:a}}({}),rb=function(h){return IMVU.BaseClass.extend("LoginManager",{dependencies:"Promise random rest restModelFactory root timer uiEventReporter window".split(" "),enablePing:!0,pingImmediately:!0,initialize:function(b){this.__serviceProvider=b.serviceProvider;this.root=b.root;this.rest=b.rest;this.restModelFactory=b.restModelFactory;this.random=b.random;this.Promise=b.Promise;this.timer=b.timer;this.uiEventReporter=b.uiEventReporter;this.enablePing=IMVU.optionalProperty(b,"enablePing",this.enablePing);this.__pingTimeout=null;this.__restCacheManager=this.__serviceProvider.has("restCacheManager")?this.__serviceProvider.get("restCacheManager"):null;this.userURL=void 0;this.__setClientSession();this.__logoutWorkItems=[];this.addLogoutWork(this.uiEventReporter.flush,this.uiEventReporter);this.__window=b.window},delete:function(){this.timer.clearTimeout(this.__pingTimeout)},__ping:function(){this.enablePing&&(this.__loginModel.getSingleEdge("user").save({online:!0}),this.__pingTimeout=this.timer.setTimeout(this.__ping.bind(this),11e4))},createFromCookie:function(){return new this.Promise(function(b){this.__loginModel=this.restModelFactory.readModel(this.root+"/login/me",h.UiCore.NodeModel);this.__loginModel.populated().then(function(){null===this.__pingTimeout&&(this.pingImmediately?this.__ping():this.__pingTimeout=this.timer.setTimeout(this.__ping.bind(this),11e4));this.__serviceProvider.get("sauce")||this.__serviceProvider.register("sauce",this.__loginModel.get("sauce"));b.resolve(this.__loginModel)}.bind(this)).catch(function(a){this.__serviceProvider.get("modelCache").release(this.__loginModel);b.reject(a)}.bind(this))}.bind(this))},createFromCredentials:function(b,a){a=_.clone(a||{});a.wait=!0;return new this.Promise(function(c){var d=function(e,f,g){void 0===e?202===g.status?c.resolve({model:null,xhr:g,response:f}):(this.__loginModel=this.restModelFactory.readModel(f.data.id,h.UiCore.NodeModel),this.__loginModel.populated().then(function(){this.__serviceProvider.register("sauce",f.data.sauce);c.resolve({model:this.__loginModel,xhr:g})}.bind(this)).catch(function(k){c.reject(k)},this.__loginModel)):c.reject(e)}.bind(this);this.rest.post(this.root+"/login",b,d)}.bind(this))},getCurrent:function(){return this.__loginModel},addLogoutWork:function(b,a){this.__logoutWorkItems.push([b,a])},logout:function(){this.timer.clearTimeout(this.__pingTimeout);return new this.Promise(function(b){this.Promise.every(_.map(this.__logoutWorkItems,function(a){return a[0].bind(a[1])()})).then(function(){return this.rest.delete(this.__loginModel.id)}.bind(this)).then(function(a){if(this.__restCacheManager)return this.__restCacheManager.clear();b.resolve()}.bind(this)).then(function(a){this.__loginModel=void 0;this.__window.ipcRenderer&&this.__window.ipcRenderer.send("close-child-windows","");b.resolve()}.bind(this)).catch(function(a){b.reject(a)}.bind(this))}.bind(this))},__setClientSession:function(){var b=new Date;b="client_"+this.random.getInteger(100,1e4).toString(36).substr(2,16)+b.getTime();document.cookie="client_session="+escape(b)+";domain="+(-1!==this.root.indexOf("localhost"))?"localhost.":"imvu.com;path=/"}})}({UiCore:m["@UiCore"],QueryParams:qb}),sb=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({1:function(b,a,c,d){var e;c=this.escapeExpression;return"\n            <p class='desc'>"+c((e=a.email_msg||b&&b.email_msg,"function"===typeof e?e.call(b,{name:"email_msg",hash:{},data:d}):e))+"</p>\n        "},3:function(b,a,c,d){var e;c=a.helperMissing;var f=this.escapeExpression;return"\n            <p class='desc'>"+f((e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"TwoFactorChallenge.desc",{name:"i18n-g",hash:{},data:d})))+"</p>\n        "},5:function(b,a,c,d){var e;c=a.helperMissing;var f=this.escapeExpression;return"\n                <p class='new-code'>\n                    "+f((e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"TwoFactorChallenge.need_another_code",{name:"i18n-g",hash:{},data:d})))+"\n                    <span class='new-code'>"+f((e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"TwoFactorChallenge.send_a_new_code",{name:"i18n-g",hash:{},data:d})))+"</span>\n                </p>\n            "},compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e;c=this.escapeExpression;var f=a.helperMissing,g='<div class="content-container">\n    <div class="content-block">\n        ',k=a["if"].call(b,b&&b.email_msg,{name:"if",hash:{},fn:this.program(1,d),inverse:this.program(3,d),data:d});if(k||0===k)g+=k;g+="\n\n        <div class='input-panel'>\n            <input class='two-factor-code' maxlength='6' placeholder=\""+c((e=a.placeholder||b&&b.placeholder,"function"===typeof e?e.call(b,{name:"placeholder",hash:{},data:d}):e))+'">\n            <div class=\'challenge-error\'></div>\n\n            <div class=\'remember-device\'>\n                <input type="checkbox" class="checkbox" data-name="remember_this_device" id=\'remember-device\'>\n                <label class="toggle-label" for=\'remember-device\'>\n                    <span>';if((k=(e=a["i18n-g"]||b&&b["i18n-g"]||f,e.call(b,"TwoFactorChallenge.remember_device",{name:"i18n-g",hash:{},data:d})))||0===k)g+=k;g+="</span>\n                </label>\n            </div>\n        </div>\n\n        <div class='link-panel'>\n            ";if((k=a["if"].call(b,b&&b.showResend,{name:"if",hash:{},fn:this.program(5,d),inverse:this.noop,data:d}))||0===k)g+=k;return g+'\n        </div>\n\n    </div>\n</div>\n\n<footer class="dialog-footer">\n    <button class="btn btn-primary disabled submit">'+c((e=a["i18n-g"]||b&&b["i18n-g"]||f,e.call(b,"Continue",{name:"i18n-g",hash:{},data:d})))+"</button>\n</footer>\n"},useData:!0})}({}),T=function(h){var b=h.Dialogs.AlloyModalDialog;return b.extend("TwoFactorChallenge",{uiContextName:"two_factor_challenge_dialog",className:"two-factor-challenge-dialog dialog-type-B",dependencies:["dialogManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:".btn-primary",name:"continue",handler:this.__clickContinue},{type:"input",selector:".two-factor-code",name:"typing_code",handler:this.__onTypingCode},{type:"keyup",selector:".two-factor-code",name:"typing_code",handler:this.__onKeyUp},{type:"click",selector:"span.new-code",name:"new_code",handler:this.__clickSendNewCode}]},initialize:function(a){b.prototype.initialize.call(this,a);this.shouldFocusOnPrimaryButton=this.canCloseWithOverlayClick=!1;this.title=this.__globalStringManager.get("TwoFactorChallenge.title");this.__email_msg=IMVU.optionalProperty(a,"email_msg",null);this.__fncbResendCode=IMVU.optionalProperty(a,"fncbResendCode",null);this.__fncbSubmitCode=IMVU.optionalProperty(a,"fncbSubmitCode",null);this.__optparams=IMVU.optionalProperty(a,"optparams",null);this.__regex_not_allowed=/[ ]/gi;this.addToDOM()},close:function(){this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},postRender:function(){this.setContent("body",h.template,{email_msg:this.__email_msg,placeholder:this.__globalStringManager.get("TwoFactorChallenge.code_placeholder"),showResend:null!==this.__fncbResendCode?!0:!1})},__onKeyUp:function(a){a.keyCode===h.NextUtil.Keys.VK_ENTER&&(this.$(".btn-primary").hasClass("disabled")||this.__clickContinue())},__onTypingCode:function(){var a=this.$("input.two-factor-code").val();-1<a.search(this.__regex_not_allowed)&&(a=a.replace(this.__regex_not_allowed,""),this.$("input.two-factor-code").val(a));a&&a.length===this.$("input.two-factor-code")[0].maxLength?this.$(".btn-primary").removeClass("disabled"):this.$(".btn-primary").hasClass("disabled")||(this.$(".btn-primary").addClass("disabled"),this.$(".challenge-error").removeClass("error-visible"),this.$(".two-factor-code").removeClass("error-visible"))},__clickContinue:function(){var a=this.$("input.two-factor-code").val();if(this.__fncbSubmitCode){var c=!0===this.$("input[id=remember-device]").prop("checked");this.__optparams?this.__optparams.remember_device=c:this.__optparams={remember_device:c};this.__fncbSubmitCode(a,this.__optparams).then(function(){this.promiseResolver.resolve({entered_code:a})}.bind(this)).catch(function(d){this.$(".challenge-error").addClass("error-visible");d&&d.error?"LOGIN-016"===d.error.error?this.$(".challenge-error").text(this.__globalStringManager.get("TwoFactorEnrollment.incorrect_code")):"ENTRY-POINT-001"===d.error.error?this.$(".challenge-error").text(this.__globalStringManager.get("message_error.generic_title")):this.$(".challenge-error").text(d.error.message):this.$(".challenge-error").text(this.__globalStringManager.get("message_error.generic_title"));this.$(".two-factor-code").addClass("error-visible")}.bind(this))}else this.promiseResolver.resolve({entered_code:a})},__clickSendNewCode:function(){this.__fncbResendCode&&this.__fncbResendCode().then(function(){this.__dialogManager.alert({title:this.__globalStringManager.get("TwoFactorNewCode.title"),text:this.__globalStringManager.get("TwoFactorNewCode.desc"),ok:this.__globalStringManager.get("OKAY")})}.bind(this)).catch(function(a){var c=this.__globalStringManager.get("message_error.generic_title");a&&a.error&&(c=a.error.message);this.__dialogManager.alert({title:this.__globalStringManager.get("oops"),text:c,ok:this.__globalStringManager.get("OKAY")})}.bind(this))}})}({Dialogs:m["@Dialogs"],NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],template:sb}),tb=function(h){var b=h.UiCore.UiContext;return b.extend("SocialLogin",{dependencies:"dialogManager featureAccessManager globalStringManager localStorage Promise rest root window".split(" "),initialize:function(a){var c=this;this.__appMonitor=null;this.__dialogManager=a.dialogManager;b.prototype.initialize.call(this,a);this.__authPromise=new this.__Promise(function(d){return c.__authPromiseResolver=d});this.__window.FB||this.__authPromiseResolver.resolve();this.setCallbacks(a);this.__profile={};this.__loggedIn=this.__hadEverLoggedIn=!1;this.__accessToken="";this.__url=a.url||void 0;this.populateCredentials();this.__fbOauthBaseUrl="https://www.facebook.com/v4.0/dialog/oauth?";this.__fbClientId="client_id=283260995344734";this.__fbResponseType="&response_type=token";this.__fbRedirectUrl="&redirect_uri=https://www.facebook.com/connect/login_success.html";this.__fbState="&state=IMVULogin";this.__fbScope="&scope=email,public_profile";this.__fbOauthUrl=this.__fbOauthBaseUrl+this.__fbClientId+this.__fbResponseType+this.__fbRedirectUrl+this.__fbState+this.__fbScope;this.__fbBaseUrl="https://www.facebook.com";this.__fbSessionCookie="c_user";this.__appleUserId=this.__appleRefreshToken=this.__appleWindow=null;this.__appleEmail="";this.__appleInit()},__appMonitorReport:function(a,c,d,e,f){if(!this.__appMonitor){try{this.__appMonitor=this.__serviceProvider.get("appMonitor")}catch(g){this.__appMonitor=null}if(!this.__appMonitor){"undefined"!==typeof this.__window.appMonitorPending&&this.__window.appMonitorPending.push([a,c,d,e,f]);return}}this.__appMonitor.reportCustomError(a,c,d,e,this.__appMonitor.buildErrorArray(f))},__appleInit:function(){try{this.__appleRedirectURI="https://secure.imvu.com/apple_redirect","en"!==this.__serviceProvider.get("currentLocale")&&""!==this.__serviceProvider.get("currentLocale")&&(this.__appleRedirectURI="https://"+this.__serviceProvider.get("currentLocale")+".secure.imvu.com/apple_redirect"),this.__window.AppleID&&this.__window.AppleID.auth.init({clientId:"com.imvu.web.signin.app",scope:"name email",redirectURI:this.__appleRedirectURI,state:"apple_web",usePopup:!0})}catch(a){this.__window.console.error("SocialLogin::__appleInit - Failed apple init",a),this.__appMonitorReport("SocialLogin","__appleInit","desktop_perm_0004g1","SocialLogin::__appleInit - Failed apple init",a)}},appleSDKLogin:function(a,c,d){try{this.__appleRefreshToken="",this.__window.AppleID.auth.signIn().then(function(e){this.__log("apple sign in data: ",e);this.__rest.post(this.__appleRedirectURI,{state:e.authorization.state,code:e.authorization.code,id_token:e.authorization.id_token}).then(function(f){this.__log(f);this.__handleAppleRedirect(a,c,d,!0,f.response)}.bind(this))["catch"](function(f){this.__log("Something went wrong posting to the redirect url: ",f);this.__window.console.error("SocialLogin::appleSDKLogin - Failed apple init",f);this.__appMonitorReport("SocialLogin","appleSDKLogin","desktop_perm_0004g2","SocialLogin::appleSDKLogin - Failed apple init",f)}.bind(this))}.bind(this))["catch"](function(e){this.__log("apple sign in error: ",e);"popup_closed_by_user"!==e.error&&"user_trigger_new_signin_flow"!==e.error&&(d(),this.__window.console.error("SocialLogin::appleSDKLogin - Failed apple init",e),this.__appMonitorReport("SocialLogin","appleSDKLogin","desktop_perm_0004g3v3","SocialLogin::appleSDKLogin - Failed apple init",e))}.bind(this))}catch(e){this.__window.console.error("SocialLogin::appleSDKLogin - Failed apple init",e),this.__appMonitorReport("SocialLogin","appleSDKLogin","desktop_perm_0004g4","SocialLogin::appleSDKLogin - Failed apple init",e)}},__log:function(){var a=$jscomp.getRestArguments.apply(0,arguments);(null!==this.__localStorage.getItem("debug.fb")||this.__localStorage.getItem("debug.social"))&&this.__window.console.log.apply(this.__window.console,["SocialLogin: "].concat($jscomp.arrayFromIterable(a)))},getPlatform:function(){return null!==this.__appleRefreshToken?this.__featureAccessManager.isElectronClient()?"apple_desktop":"apple_web":this.__window.FB?"facebook_web":"facebook_desktop"},getAppleRefreshToken:function(){return this.__appleRefreshToken},getAppleUserId:function(){return this.__appleUserId},getAppleEmail:function(){return this.__appleEmail},setCallbacks:function(a){this.__onBanned=IMVU.optionalProperty(a,"onBanned",function(){});this.__onError=IMVU.optionalProperty(a,"onError",function(){});this.__onServiceFailure=IMVU.optionalProperty(a,"onServiceFailure",function(){})},__setAuth:function(a){this.__log("__setAuth",JSON.stringify(a),"response.status",a.status);(this.__hadEverLoggedIn=this.__loggedIn="connected"===a.status)&&"undefined"!==typeof a.authResponse&&(this.__log("__setAuth: setting __fbAuthResponse to",a.authResponse),this.__fbAuthResponse=a.authResponse);"undefined"!==typeof this.__fbAuthResponse&&"undefined"!==typeof this.__fbAuthResponse.userID&&this.__log("Social external userID:  "+String(this.__fbAuthResponse.userID));this.__authPromiseResolver.resolve()},getAuth:function(){var a=this;this.__log("getAuth (async) START");return this.__authPromise.then(function(){a.__log("getAuth (async) __authPromise resolved",a.__fbAuthResponse);return a.__fbAuthResponse})},__fetchProfile:function(){if(this.__window.FB)try{this.__window.FB.api("/me?fields=id,name,email,first_name,last_name,middle_name",function(a){this.__parseProfileResponse(a)}.bind(this))}catch(a){this.__window.console.error("SocialLogin::__fetchProfile - Failed to fetch profile from Facebook",a),this.__appMonitorReport("SocialLogin","__fetchProfile","desktop_perm_0004o","SocialLogin::__fetchProfile - Failed to fetch profile from Facebook",a)}else this.__rest.get("https://graph.facebook.com/me?fields=id,name,email,first_name,last_name,middle_name&access_token="+this.__accessToken,{withCredentials:!1}).then(function(a){this.__parseProfileResponse(JSON.parse(a.xhr.responseText))}.bind(this)).catch(function(a){this.__log("There was an error fetching profile information: ",a);this.__window.console.error("SocialLogin::__fetchProfile - Failed to fetch profile",a);this.__appMonitorReport("SocialLogin","__fetchProfile","desktop_perm_0004h1","SocialLogin::__fetchProfile - Failed to fetch profile",a)}.bind(this))},__parseProfileResponse:function(a){this.__profile.id=a.id;this.__profile.name="string"===typeof a.name?a.name:"";this.__profile.first_name="string"===typeof a.first_name?a.first_name:"";this.__profile.middle_name="string"===typeof a.middle_name?a.middle_name:"";this.__profile.last_name="string"===typeof a.last_name?a.last_name:"";this.__profile.short_name="string"===typeof a.short_name?a.short_name:"";this.__profile.email="string"===typeof a.email?a.email:"";this.__profile.permissions=a.permissions},__statusCallback:function(a,c,d){this.__setAuth(a);this.__loggedIn&&c?(this.__log("__statusCallback logged in",this.__loggedIn,c),c()):!this.__loggedIn&&d&&(this.__log("__statusCallback: not logged in",this.__loggedIn,d),d())},checkLoginState:function(a,c){if(this.__window&&this.__window.FB){this.__log("checkLoginState: ",a,c);try{this.__window.FB.getLoginStatus(function(d){this.__log("checkLoginState: getLoginStatus response",d);this.__statusCallback(d,a,c)}.bind(this))}catch(d){this.__window.console.error("SocialLogin::checkLoginState - Failed to retrieve login status from Facebook",d),this.__appMonitorReport("SocialLogin","checkLoginState","desktop_perm_0004h1","SocialLogin::checkLoginState - Failed to retrieve login status from Facebook",d)}}else this.__log("checkLoginState: no FB object found on window"),this.__loggedIn=!1},isLoggedIn:function(){this.__log("isLoggedIn",this.__loggedIn,typeof this.__loggedIn);return this.__window.FB?void 0!==this.__loggedIn&&!0===this.__loggedIn:this.__localStorage.getItem("fbLogin")?!0:!1},hadEverLoggedIn:function(){return!0===this.__hadEverLoggedIn},populateCredentials:function(){this.__log("populateCredentials");if(this.isLoggedIn())this.__log("populateCredentials: logged in");else{this.__log("populateCredentials: not logged in");var a=function(){this.__log("populateCredentials: actionLoggedIn A");this.isLoggedIn()?(this.__log("populateCredentials: actionLoggedIn B"),this.__fetchProfile()):this.__log("populateCredentials: actionLoggedIn C")}.bind(this);this.checkLoginState(a)}},isPermitted:function(a){this.__profile.permissions.data.forEach(function(c){if(c.permission==a)return!0});return!1},getProfileItem:function(a){if("string"===typeof a)switch(a){case"name":return this.__profile.name;case"first_name":return this.__profile.first_name;case"middle_name":return this.__profile.middle_name;case"last_name":return this.__profile.last_name;case"short_name":return this.__profile.short_name;case"id":return this.__profile.id;case"email":return this.__profile.email}},getAccessToken:function(){return this.__accessToken},__captureUserNode:function(a){this.__loginNode=a.response;this.__userNode=this.__loginNode.data.user},__handleAppleRedirect:function(a,c,d,e,f){try{var g=f;if(!e){if("https://www.imvu.com"!==f.origin&&"https://secure.imvu.com"!==f.origin){this.__log("Invalid Origin Error: ",f.origin);return}try{g=JSON.parse(f.data)}catch(k){this.__log("invalid json received from server: ",f.data);return}}"authSuccess"===g.status?(this.__appleWindow&&this.__appleWindow.close(),this.__log("Auth Success with data: ",g.data),a()):"error"===g.status?(this.__log("Apple Sign In Error: ",g.data),this.__appleWindow&&this.__appleWindow.close(),"user_cancelled_authorize"!==g.data&&d(g.data)):"ftuxReady"===g.status?(this.__appleRefreshToken=g.data.refreshToken,this.__appleUserId=g.data.appleId,this.__appleEmail=g.data.appleEmail,this.__appleWindow&&this.__appleWindow.close(),this.__log("Ftux ready with data: ",g.data),c()):this.__log("Unexpected status received: ",g.status)}catch(k){this.__window.console.error("SocialLogin::__handleAppleRedirect - Failed to redirect",k),this.__appMonitorReport("SocialLogin","__handleAppleRedirect","desktop_perm_0004g5","SocialLogin::__handleAppleRedirect - Failed to redirect",k)}},_testAppleWindowPost:function(a){this.__window.postMessage(a,"https://www.imvu.com")},appleOauthLogin:function(a,c,d){var e=this;try{this.__appleRefreshToken="";var f="com.imvu.web.signin.app";this.__featureAccessManager.isElectronClient()&&(f="com.imvu.desktop.signin.app",this.__externalWindow||(this.__externalWindow=this.__serviceProvider.get("externalWindow")));var g="https://appleid.apple.com/auth/authorize?client_id="+f+"&redirect_uri=https%3A%2F%2Fsecure.imvu.com%2Fapple_redirect&state="+this.getPlatform()+"&scope=name%20email&response_mode=form_post&response_type=code%20id_token";null===this.__appleWindow?(this.__featureAccessManager.isElectronClient()?(this.__appleWindow=this.__externalWindow.newElectronWindow({width:700,height:600,webPreferences:{preload:this.__serviceProvider.get("appPath")+"/src/socialLoginPreloader.js"},show:!1}),this.__appleWindow.on("closed",function(){e.__appleWindow=null}),this.__appleWindow.loadURL(g),this.__window.parent.electronRequire("electron").ipcRenderer.on("appleData",function(k,l,n){e.__handleAppleRedirect(a,c,d,!1,{data:l,origin:n})}),this.__appleWindow.show()):this.__appleWindow=this.__window.open(g,"_blank","width=700,height=600  "),this.__window.addEventListener("message",this.__handleAppleRedirect.bind(this,a,c,d,!1),!1)):this.__appleWindow.closed?this.__appleWindow=this.__window.open(g,"_blank","width=auto,height=auto"):this.__appleWindow.location=g}catch(k){this.__window.console.error("SocialLogin::appleOauthLogin - Failed apple oauth",k),this.__appMonitorReport("SocialLogin","appleOauthLogin","desktop_perm_0004g6","SocialLogin::appleOauthLogin - Failed apple oauth",k)}},fbSDKLogin:function(a,c){try{this.__appleRefreshToken=null,this.logout(),"undefined"!==typeof this.__window&&"undefined"!==typeof this.__window.FB?this.__window.FB.getLoginStatus(function(d){"connected"===d.status?(this.__fetchProfile(),this.__setAuth(d),this.__statusCallback(d,a,c)):this.__window.FB.login(function(e){"connected"===e.status?(this.__setAuth(e),this.__fetchProfile(),this.__accessToken=this.__fbAuthResponse.accessToken,this.__imvuLogin(a,c)):this.__statusCallback(e)}.bind(this),{scope:"email,public_profile",return_scopes:!0})}.bind(this)):(this.__window.console.log("WARNING: Improper fb login method called"),this.__onError(this))}catch(d){this.__window.console.error("SocialLogin::fbSDKLogin - Failed FB SDK login",d),this.__appMonitorReport("SocialLogin","fbSDKLogin","desktop_perm_0004h2","SocialLogin::fbSDKLogin - Failed FB SDK login",d)}},fbOauthLogin:function(a,c){try{this.__appleRefreshToken=null;this.__featureAccessManager||(this.__featureAccessManager=this.__serviceProvider.get("featureAccessManager"));if(!this.__featureAccessManager.isElectronClient())return this.fbSDKLogin(a,c);this.__url||(this.__url=this.__window.parent.electronRequire("url"));this.__externalWindow||(this.__externalWindow=this.__serviceProvider.get("externalWindow"));var d=function(f){f.hash&&(f=f.hash.substr(1).split("&").reduce(function(g,k){k=k.split("=");g[k[0]]=k[1];return g},{}).access_token)&&(this.__loggedIn=!0,this.__accessToken=f,e.close(),this.__fetchProfile(f),this.__imvuLogin(a,c))}.bind(this),e=this.__externalWindow.newElectronWindow({width:800,height:800});e.webContents.on("will-navigate",function(f,g){f=this.__url.parse(g,!0);f.query.error&&"user_denied"===f.query.error_reason&&(this.__externalWindow.clearStorageData(this.__fbBaseUrl,this.__fbSessionCookie),e.close());"/connect/login_success.html"===f.path&&d(f)}.bind(this));e.webContents.on("did-redirect-navigation",function(f,g){f=this.__url.parse(g,!0);"/connect/login_success.html"===f.path&&d(f)}.bind(this));e.loadURL(this.__fbOauthUrl);e.show()}catch(f){this.__window.console.error("SocialLogin::fbOauthLogin - Failed FB oauth login",f),this.__appMonitorReport("SocialLogin","fbOauthLogin","desktop_perm_0004h3","SocialLogin::fbOauthLogin - Failed FB oauth login",f)}},__imvuLogin:function(a,c){var d={};this.__fbAuthResponse?(this.__accessToken=this.__fbAuthResponse.accessToken,d={platform:this.getPlatform(),platform_token:this.__fbAuthResponse.accessToken,platform_uid:this.__fbAuthResponse.userID}):d={platform:this.getPlatform(),platform_token:this.__accessToken};var e=["remember_device_token-social-",d.platform_uid].join("");if(e=this.__localStorage.getItem(e))d.remember_device_token=e;this.__rest.post(this.__root+"/login",d).then(function(f){if(202===f.xhr.status){var g=null;if(f.response&&f.response.message&&f.response.details)try{g=f.response.message.replace("%email_address",f.response.details.email_address)}catch(k){this.__window.console.error(k)}this.__credentials=d;this.__loggedInCallback=a;this.__dialogManager.showDialog(h.TwoFactorChallenge,{fncbResendCode:this.__resendCode.bind(this),fncbSubmitCode:this.__submitCode.bind(this),email_msg:g,optparams:d})}else this.__localStorage.setItem("fbLogin",this.__accessToken),this.__captureUserNode(f),a&&a()}.bind(this)).catch(function(f){f.error&&"LOGIN-018"===f.error.error?this.__dialogManager.alert({title:this.__globalStringManager.get("oops"),text:f.error.message,ok:this.__globalStringManager.get("OKAY")}):(c?(this.__localStorage.setItem("fbLogin",this.__accessToken),c()):"LOGIN-008"===f.error.error?this.__onBanned(this):this.__onError(this),this.__window.console.error("SocialLogin::__imvuLogin - Failed imvu login",f),this.__appMonitorReport("SocialLogin","__imvuLogin","desktop_perm_0004i1v2","SocialLogin::__imvuLogin - Failed imvu login",f))}.bind(this))},__resendCode:function(){return new this.__Promise(function(a){this.__rest.post(this.__root+"/login",this.__credentials).then(function(c){202===c.xhr.status?a.resolve():a.reject()}.bind(this)).catch(function(c){a.reject(c)}.bind(this))}.bind(this))},__submitCode:function(a,c){return new this.__Promise(function(d){c["2fa_code"]=a;this.__rest.post(this.__root+"/login",c).then(function(e){this.__captureUserNode(e);this.__localStorage.setItem("fbLogin",this.__accessToken);if(e.response.data.remember_device_token&&null!==e.response.data.remember_device_token){var f=["remember_device_token-social-",c.platform_uid].join("");this.__localStorage.setItem(f,e.response.data.remember_device_token)}this.__loggedInCallback&&this.__loggedInCallback();d.resolve()}.bind(this)).catch(function(e){d.reject(e)}.bind(this))}.bind(this))},logout:function(a,c){try{this.__localStorage.removeItem("fbLogin"),this.__window.FB?this.__window.FB.getLoginStatus(function(d,e,f){"connected"===d.status?(this.__fbAuthResponse=void 0,this.__profile={},this.__window.FB.logout(function(g){this.__statusCallback(g,e,f)}.bind(this))):this.__statusCallback(d,e,f)}.bind(this)):(this.__featureAccessManager||(this.__featureAccessManager=this.__serviceProvider.get("featureAccessManager")),this.__featureAccessManager.isElectronClient()&&(this.__externalWindow||(this.__externalWindow=this.__serviceProvider.get("externalWindow")),this.__externalWindow.clearStorageData(this.__fbBaseUrl,this.__fbSessionCookie)))}catch(d){this.__window.console.error("SocialLogin::logout - Failed logout",d),this.__appMonitorReport("SocialLogin","logout","desktop_perm_0004i2","SocialLogin::logout - Failed logout",d)}}})}({UiCore:m["@UiCore"],TwoFactorChallenge:T}),ub=function(h){var b=h.LoginManager;return b.extend("NextLoginManager",{dependencies:"dialogManager globalStringManager leanplum localStorage Promise rest window".split(" "),ERROR_CREDENTIALS:0,ERROR_LOGIN_ME:1,ERROR_IMQ_CONNECT_OR_USER_FETCH:2,ERROR_TRY_AGAIN_LATER:3,ERROR_DISABLED:4,ERROR_UNDERAGE:5,ERROR_COOKIE_UNACCEPT:6,ERROR_UNDERAGE_PENDING_CONSENT:7,ERROR_EXCESSIVE_SERVER_LOAD:8,ERROR_CLIENT_2FA_NOT_SUPPORTED:9,ERROR_CODE_EMAIL_RATE_LIMIT:10,ERROR_WRONG_CODE_RATE_LIMIT:11,ERROR_NETWORK_ERROR:99,pingImmediately:!1,initialize:function(a){var c=this;this.window=a.window;this.__localStorage=a.localStorage;this.__leanplum=a.leanplum;this.__dialogManager=a.dialogManager;this.__globalStringManager=a.globalStringManager;this.__Promise=a.Promise;b.prototype.initialize.call(this,a);this.__logoutConfirmer=function(){return c.Promise.accept()};this.__socialLogin=this.__serviceProvider.create(h.SocialLogin)},getSocialLogin:function(){return this.__socialLogin},setLogoutConfirmer:function(a){this.__logoutConfirmer=a},logout:function(){var a=this;this.__socialLogin.logout();return this.__logoutConfirmer().then(function(){document.body.classList.add("is-logging-out");return a.__Promise.resolve()}).then(b.prototype.logout.bind(this)).then(function(){a.window.console.hasOwnProperty("trace")&&a.window.console.trace("Reload after logout LIM");document.body.classList.remove("is-logging-out");a.window.location.replace("/next/ftux/")}).catch(function(){return document.body.classList.remove("is-logging-out")})},logoutInPlace:function(){this.__socialLogin.logout();return b.prototype.logout.call(this)},isLoggedIn:function(){return void 0!==this.getCurrent()&&void 0!==this.getCurrent().get("session_id")?!0:!1},getLoginType:function(){return this.getCurrent().get("source")},getCurrentUser:function(){try{var a=this.getCurrent().getSingleEdge("user")}catch(c){this.__window.console.error(c),-1!==location.host.indexOf("localhost.")&&"true"===this.__localStorage.getItem("forceProduction")&&(this.__window.location.href="/next?forceLogout=true")}return a},setLoginDestination:function(a){this.__loginDestination=a},getLoginDestination:function(){return this.__loginDestination||null},setSignUpDestination:function(a){this.__signUpDestination=a},getSignUpDestination:function(){return this.__signUpDestination||null},getCoreUserModelAndConnectToIMQ:function(a,c,d){var e=c.getSingleEdge("user"),f=a.create(d,{url:c.relations.imq,metadata:{app:"imvu"},httpUrl:c.relations.imqHttp,onPreReconnectCallback:function(g,k){11e4<k?a.get("window").location.reload():g(null,null)},userId:e.get("legacy_cid").toString(),sessionId:c.get("session_id")});a.register("imqManager",f);c=f.connect().then(function(){var g=a.get("errorModel");if(g)f.state.on("change:status",function(){var k=f.state.get("status");"disconnected"===k?g.set("imqDisconnect",!0):"connected"===k&&g.set("imqDisconnect",!1)}.bind(this));a.create(h.UiCore.ModelInvalidator)});return a.get("Promise").every([c,e.populated()]).then(function(){a.get("loginStatus").set("authenticated",!0)})},performLoginFromCredentials:function(a,c){var d=a.get("loginManager"),e=a.get("Promise");return new e(function(f){var g=["remember_device_token-",c.username].join("");if(g=this.__localStorage.getItem(g))c.remember_device_token=g;d.createFromCredentials(c).then(function(k){if(202===k.xhr.status){var l=null;if(k.response&&k.response.message&&k.response.details)try{l=k.response.message.replace("%email_address",k.response.details.email_address)}catch(n){this.__window.console.error(n)}this.__credentials=c;this.__dialogManager.showDialog(h.TwoFactorChallenge,{fncbResendCode:this.__resendCode.bind(this),fncbSubmitCode:this.__submitCode.bind(this),email_msg:l}).finished.then(function(n){this.__credentials=null;f.resolve(this.__loginModel)}.bind(this))}else return d.createFromCookie()}.bind(this),function(k){"LOGIN-002"===k.error?f.reject(this.ERROR_TRY_AGAIN_LATER):"LOGIN-008"===k.error?f.reject(this.ERROR_DISABLED):"LOGIN-010"===k.error?f.reject(this.ERROR_UNDERAGE):"LOGIN-011"===k.error?f.reject(this.ERROR_COOKIE_UNACCEPT):"LOGIN-012"===k.error?f.reject(this.ERROR_UNDERAGE_PENDING_CONSENT):"LOGIN-014"===k.error?f.reject(this.ERROR_EXCESSIVE_SERVER_LOAD):"LOGIN-015"===k.error?f.reject(this.ERROR_CLIENT_2FA_NOT_SUPPORTED):"LOGIN-018"===k.error?f.reject(this.ERROR_CODE_EMAIL_RATE_LIMIT):"LOGIN-019"===k.error?f.reject(this.ERROR_WRONG_CODE_RATE_LIMIT):"NetworkError"===k.error?f.reject(this.ERROR_NETWORK_ERROR):f.reject(this.ERROR_CREDENTIALS);return e.reject()}.bind(this)).then(function(k){k&&f.resolve(k)},function(){f.reject(this.ERROR_LOGIN_ME);return e.reject()}.bind(this))}.bind(this))},__resendCode:function(){return new this.Promise(function(a){this.rest.post(this.root+"/login",{username:this.__credentials.username,password:this.__credentials.password,gdpr_cookie_acceptance:this.__credentials.gdpr_cookie_acceptance}).then(function(c){202===c.xhr.status?a.resolve():a.reject()}.bind(this)).catch(function(c){a.reject(c)}.bind(this))}.bind(this))},__submitCode:function(a,c){return new this.Promise(function(d){this.__credentials["2fa_code"]=a;c&&(this.__credentials.remember_device=c.remember_device);this.rest.post(this.root+"/login",this.__credentials).then(function(e){this.__loginModel=this.restModelFactory.readModel(this.root+"/login/me",h.UiCore.NodeModel);this.__loginModel.populated().then(function(){var f=this.__serviceProvider.get("loginManager");if(e.response.data.remember_device_token&&null!==e.response.data.remember_device_token){var g=["remember_device_token-",this.__credentials.username].join("");this.__localStorage.setItem(g,e.response.data.remember_device_token)}this.__serviceProvider.register("sauce",this.__loginModel.attributes.sauce);f.createFromCookie();d.resolve(this.__loginModel)}.bind(this))}.bind(this)).catch(function(e){d.reject(e)}.bind(this))}.bind(this))},setSemaphore:function(){this.__ongoingActiveChat=!0},unsetSemaphore:function(){this.__ongoingActiveChat=!1},__ping:function(){if(this.enablePing){var a={availability:"Available",online:!0};"DoNotDisturb"===this.__loginModel.getSingleEdge("user").get("availability")&&(a={availability:"DoNotDisturb"});this.__loginModel.getSingleEdge("user").save(a).catch(function(){this.window.console.hasOwnProperty("trace")&&this.window.console.trace("Reload after logout during ping");this.__ongoingActiveChat||this.window.location.reload()}.bind(this));this.__pingTimeout=this.timer.setTimeout(this.__ping.bind(this),11e4)}}})}({Dialogs:m["@Dialogs"],IMQ:m["@IMQ"],UiCore:m["@UiCore"],LoginManager:rb,SocialLogin:tb,TwoFactorChallenge:T}),vb=function(h){var b=h.UiCore.IndexedDBManager;return b.extend("RestCacheManager",{dependencies:"cid disableRestCache modelCache Promise timer window".split(" "),__AUTO_SAVE_INTERVAL:9e5,__EXPIRATION_TIME:86400,__TABLE_NAME:"rest_cache",__TABLE_SCHEMA:[{name:"idURL",is_key:!0},{name:"dataType"},{name:"attributes"},{name:"relations"},{name:"updates"},{name:"ownerId"},{name:"updateTime"}],__defaultUrlWhitelists:["ftux"],__defaultUrlBlacklists:["avatar","login","startup"],__defaultModelMap:{NodeModel:h.UiCore.NodeModel,EdgeModel:h.UiCore.EdgeModel,EdgeDerefModel:h.UiCore.EdgeDerefModel},onInitialize:function(a){this.__disableRestCache=a.disableRestCache;this.__disableRestCache||(a.tableName=this.__TABLE_NAME,a.tableSchema=this.__TABLE_SCHEMA,b.prototype.onInitialize.call(this,a),this.__cid=a.cid,this.__timer=a.timer,this.__modelCache=a.modelCache,this.__serviceProvider=a.serviceProvider,this.__whitelists=this.__defaultUrlWhitelists.concat(this.__urlWhitelists||[]),this.__blacklists=this.__defaultUrlBlacklists.concat(this.__urlBlacklists||[]),this.__modelMap=_.extend(this.__defaultModelMap,this.__modelMap||{}),this.__loadToModelCache().then(this.__autoSave.bind(this)))},resetAutoSaveTimer:function(){this.__disableRestCache||(this.__autoSaveTimer&&this.__timer.clearInterval(this.__autoSaveTimer),this.__autoSave())},__isBlacklisted:function(a){var c=!1;this.__blacklists.forEach(function(d){-1<a.indexOf(d)&&(c=!0)});return c},__isOwned:function(a){return 0===a?!0:this.__cid===a},__isExpired:function(a){a=a.getTime();return(new Date).getTime()-a>=1e3*this.__EXPIRATION_TIME},__loadToModelCache:function(){var a,c=new this.__Promise(function(d){a=d}.bind(this));this.getAll().then(function(d){d&&d.forEach(function(e){if(this.__isOwned(e.ownerId)&&!this.__isExpired(e.updated)){var f=this.__modelMap[e.dataType];if(f){var g={};-1<e.dataType.indexOf("EdgeDeref")&&(g.edgeUrl=e.idURL.replace("deref:",""));f=this.__serviceProvider.create(f,{id:e.idURL},g);f.attributes=e.attributes;"object"===typeof e.attributes&&delete e.attributes.id;f.changed=e.attributes;f.relations=e.relations;f.updates=e.updates;f.trigger("successfulResponseReceived");f.dirty=!0;this.__modelCache.importModel(e.idURL,f)}}else this.remove(e.idURL)}.bind(this));a.accept()}.bind(this)).catch(function(){a.reject()}.bind(this));return c},store:function(a){var c=this;this.__disableRestCache||this.__isBlacklisted(a.idURL)||(this.__modelMap[a.dataType]?(a.ownerId=this.__cid,a.updated=new Date,this.get(a.idURL).then(function(d){d||c.add(a)})):this.__window.console.log("RestCacheManager - Can't find the original model \""+a.dataType+'" in mapping'))},__autoSave:function(){this.__autoSaveTimer=this.__timer.setInterval(function(){this.saveFromModelCache()}.bind(this),this.__AUTO_SAVE_INTERVAL)},saveFromModelCache:function(){this.__disableRestCache||this.clear().then(function(){var a=this.__modelCache.exportModels(),c;for(c in a)a.hasOwnProperty(c)&&a[c].populated().then(function(d){this.store({idURL:d.id,dataType:d.constructor.name,attributes:d.attributes,relations:d.relations,updates:d.updates})}.bind(this))}.bind(this)).catch(function(){}.bind(this))},delete:function(){this.__timer.clearInterval(this.__autoSaveTimer)},clear:function(){return this.__disableRestCache?function(){return Promise.resolve()}:b.prototype.clear.call(this)}})}({UiCore:m["@UiCore"]}),wb=function(h){var b=IMVU.BaseClass;return b.extend("BrowserInfoManager",{dependencies:["platform","window"],initialize:function(a){b.prototype.initialize.call(this,a);this.serviceProvider=IMVU.requireProperty(a,"serviceProvider");this.__appVersion=this.__featureAccessManager=null;this.__startupModel=IMVU.optionalProperty(a,"globalStartupModel",null);this.__platformGeneral=a.platform;null===this.__startupModel&&this.serviceProvider.has("globalStartupModel")&&(this.__startupModel=this.serviceProvider.get("globalStartupModel"));this.__window=IMVU.optionalProperty(a,"window",this.__window);var c=a.userAgent||navigator.userAgent,d=a.appName||navigator.appName,e=""+parseFloat(a.appVersion||navigator.appVersion),f,g;var k=parseInt(a.appVersion||navigator.appVersion,10);this.userAgent=c;-1!==(f=c.indexOf("OPR/"))?(d="Opera",e=c.substring(f+4)):-1!==(f=c.indexOf("Opera"))?(d="Opera",e=c.substring(f+6),-1!==(f=c.indexOf("Version"))&&(e=c.substring(f+8))):-1!==(f=c.indexOf("MSIE"))?(d="IE",e=c.substring(f+5)):-1!==(f=c.indexOf("Trident/"))?(d="IE",e=c.indexOf("rv:"),e=c.substring(e+3,c.indexOf(".",e))):-1!==(f=c.indexOf("Edge/"))?(d="IE",e=c.substring(f+5,c.indexOf(".",f))):-1!==(f=c.indexOf("Chrome"))?(d="Chrome",e=c.substring(f+7)):-1!==(f=c.indexOf("Safari"))?(d="Safari",e=c.substring(f+7),-1!==(f=c.indexOf("Version"))&&(e=c.substring(f+8))):-1!==(f=c.indexOf("Firefox"))?(d="Firefox",e=c.substring(f+8)):(k=c.lastIndexOf(" ")+1)<(f=c.lastIndexOf("/"))&&(d=c.substring(k,f),e=c.substring(f+1),d.toLowerCase()===d.toUpperCase()&&(d=a.appName||navigator.appName));-1!==(g=e.indexOf(";"))?e=e.substring(0,g):-1!==(g=e.indexOf(" "))&&(e=e.substring(0,g));k=parseInt(""+e,10);isNaN(k)&&(e=""+parseFloat(a.appVersion||navigator.appVersion),k=parseInt(a.appVersion||navigator.appVersion,10));this.__browserName=d;this.__majorVersion=k;this.__os=this.__parseOS(this.__window.navigator.platform||navigator.platform,c);this.__appInstanceID="";this.__startupModel&&this.__startupModel.populated().then(function(){this.__appInstanceID=this.__startupModel.get("sessionID")}.bind(this)).catch(function(l){}.bind(this));this.__deviceModel=this.__parseDeviceModel();this.__extractDevicePlatform();this.__navigator=navigator;this.__vendor=this.__navigator.vendor},__getFeatureAccessManager:function(){this.__featureAccessManager||(this.__featureAccessManager=(this.__featureAccessManager=this.serviceProvider.get("featureAccessManager"))?this.__featureAccessManager:null);return this.__featureAccessManager},__extractDevicePlatform:function(){this.__devicePlatform="unknown";var a=this.userAgent.indexOf("(");-1<a&&(this.__devicePlatform=this.userAgent.substr(a+1),a=this.__devicePlatform.indexOf(")"),-1<a&&(this.__devicePlatform=this.__devicePlatform.substr(0,a)))},__isElectronClient:function(){var a=!1;try{a=this.__window.parent&&this.__window.parent.electronRequire?!0:!1}catch(c){}return"win64_app"===this.__platformGeneral||"darwin_app"===this.__platformGeneral||a},getPlatformGeneral:function(){return this.__platformGeneral},__parseDeviceModel:function(){var a=null,c=null;this.__extractDevicePlatform();var d=this.__devicePlatform;if("unknown"===d)return"unknown";if(0===d.indexOf("Linux;")&&0<d.indexOf("Android"))c="Android",a=d.indexOf(";")+1,d=d.substr(a),a=d.indexOf(";"),0<=a&&(d=d.substr(a+1));else{if(0===d.indexOf("Macintosh;")&&0<d.indexOf("Intel"))return"Macintosh Intel";d=d.replace("X11; CrOS","X11 CrOS");a=d.indexOf(";");if(0<=a)return d=d.substr(0,a)}a=d.indexOf("iPhone;");0===a&&(c="iPhone",d=d.substr(a+7));a=d.indexOf("iPad;");0===a&&(c="iPad",d=d.substr(a+5));a=d.indexOf("Android ");0===a&&(c="Android",d=" "+d.substr(a));a=d.indexOf("Windows ");0===a&&(c="Windows",d=" "+d.substr(a));a=d.indexOf("Macintosh; ");0===a&&(c="Macintosh",d=" "+d.substr(10));a=d.indexOf("X11 CrOS ");0===a&&(c="Chrome",d=d.substr(8).trim(),a=d.indexOf(" "),d=d.substr(0,a));a=d.indexOf("Build/");0<=a&&(d=d.substr(0,a));a=null;a=/Android \d{1,2}.\d{1,2}.\d{1,2}[;]{0,1}/;d=d.replace(a," ");a=/Android \d{1,2}.\d{1,2}[;]{0,1}/;d=d.replace(a," ");"af sq ar-dz ar-bh ar-eg ar-iq ar-jo ar-kw ar-lb ar-ly ar-ma ar-om ar-qa ar-sa ar-sy ar-tn ar-ae ar-ye eu be bg ca zh-hk zh-cn zh-sg zh-tw zh-CN hr cs da nl-be nl en en-au en-bz en-ca en-ie en-jm en-nz en-za en-tt en-gb en-us et fo fa fi fr-be fr-ca fr-lu fr fr-ch gd de-at de-li de-lu de de-ch de-de el he hi hu is id ga it it-ch ja ko ko ku lv lt mk ml ms mt no nb nn pl pt-br pt pa rm ro ro-md ru ru-md sr sk sl sb es-ar es-bo es-cl es-co es-cr es-do es-ec es-sv es-gt es-hn es-mx es-ni es-pa es-py es-pe es-pr es es-uy es-ve sv sv-fi th ts tn tr uk ur ve vi cy xh ji zu".split(" ").forEach(function(e){d=d.replace(" "+e+";"," ")});a=d.indexOf(";");0<=a&&(d=d.substr(0,a));d=d.trim();""!==c&&(a=d.indexOf(c),0!==a&&(d=c+" "+d));d=d.trim();return this.__deviceModel=(this.__deviceModel=""===d?"unknown":d)||"unknown"},getPlatformData:function(){this.__appVersion||(this.__appVersion=(this.__appVersion=this.__getFeatureAccessManager().getMarketingPlatform())?this.__appVersion:null);return{userAgent:this.userAgent,appInstanceID:this.__appInstanceID,appVersion:this.__appVersion,deviceModel:this.__deviceModel,devicePlatform:this.__devicePlatform}},__parseOS:function(a,c){var d={Win:"windows",Mac:"mac"};if(a)for(var e in d)if(-1!==a.indexOf(e))return d[e];return"string"===typeof c&&c.includes("(X11; CrOS")?"chrome":"unknown"},getBrowserName:function(){return this.__browserName},getMajorVersion:function(){return this.__majorVersion},getBrowserValidation:function(){var a=!0,c=!0,d=this.__browserName.toLowerCase();"chrome"==d&&66>=this.__majorVersion?c=!1:"ie"==d&&"windows"===this.getOS()?c=a=!1:"edge"==d&&15>=this.__majorVersion?c=!1:"opera"==d?c=!1:"safari"==d&&"windows"===this.getOS()?c=!1:"firefox"==d&&92>=this.__majorVersion&&(c=!1);return{browser:d,version:this.__majorVersion,validBrowser:a,validBrowserVersion:c}},getPlatform:function(){return navigator.platform},getOS:function(){return this.__os},getMobileOS:function(){return this.userAgent.match(/iPad/i)||this.userAgent.match(/iPhone/i)||this.userAgent.match(/iPod/i)?"iOS":this.userAgent.match(/Android/i)?"Android":"unknown"},_setUserAgent:function(a){this.userAgent=a},_setBrowserName:function(a){this.__browserName=a},isIE:function(){return"IE"===this.getBrowserName()},isSafari:function(){return"Safari"===this.getBrowserName()},_setOS:function(a){this.__os=a}})}({}),xb=function(h){var b=IMVU.BaseClass;return b.extend("MultiGetManager",_.extend({dependencies:"globalStartupModel loginManager Promise rest restModelFactory window".split(" "),__initializeRestModelFactory:function(){this.__restModelFactory.multiGetSetParams({multiGetBatchSize:this.__globalStartupModel.get("multiGetBatchSize")})},initialize:function(a){b.prototype.initialize.call(this,a);this.__serviceProvider="undefined"!==typeof a.serviceProvider?a.serviceProvider:null;this.__globalStartupModelPromise=this.__serviceProvider.get("globalStartupModel");this.__isDev=this.__isQA=!1;this.__globalStartupModelPromise.populated().then(function(c){this.__globalStartupModel=c;this.__isQA=this.__globalStartupModel.get("isQA");this.__isDev=this.__globalStartupModel.get("isDev");this.USER_END_POINT=this.__globalStartupModel.get("userEndpoint");this.USER_PRESENCE_END_POINT=this.__globalStartupModel.get("presenceEndpoint");this.PRODUCT_END_POINT=this.__globalStartupModel.get("productEndpoint");this.PHOTO_END_POINT=this.__globalStartupModel.get("photoUrl");this.PHOTO_DETAILS_END_POINT=this.__globalStartupModel.get("photoDetailsUrl");this.CHAT_END_POINT=this.__globalStartupModel.get("chatEndPoint");this.__BASE_API_URI=this.__globalStartupModel.get("baseApiURI");this.__USER_PREFIX=this.__BASE_API_URI+"user/user-";this.__USER_PRESENCE_PREFIX=this.__BASE_API_URI+"presence/presence-";this.__PRODUCT_PREFIX=this.__BASE_API_URI+"product/product-";this.__PHOTO_PREFIX=this.__BASE_API_URI+"photo/photo-";this.__PHOTO_DETAILS_PREFIX=this.__BASE_API_URI+"photo_details/photo_details-";this.__CHAT_PREFIX=this.__BASE_API_URI+"chat/chat-";this.__restModelFactory="undefined"!==typeof this.__restModelFactory?typeof this.__restModelFactory:this.__serviceProvider.get("restModelFactory");this.__initializeRestModelFactory()}.bind(this));this.__window=a.window;this.__rest=a.rest;this.__Promise=a.Promise;this.__startupModel=a.startupModel;this.__loginManager=a.loginManager;this.__userNodeType=h.UiCore.NodeModel;this.__productNodeType=h.Model.ProductNode;this.__chatNodeType=this.__photoDetailsNodeType=this.__photoNodeType=h.UiCore.NodeModel;this.autoRequestPlease=!0},__isID:function(a,c){return new RegExp(c).test(a)},__isIdUser:function(a){return this.__isID(a,"^"+this.__BASE_API_URI+"user/user-[0-9]*$")},__isIdPresence:function(a){return this.__isID(a,"^"+this.__BASE_API_URI+"presence/presence-[0-9]*$")},__isIdProduct:function(a){return this.__isID(a,"^"+this.__BASE_API_URI+"product/product-[0-9]*$")},__isIdPhoto:function(a){return this.__isID(a,"^"+this.__BASE_API_URI+"photo/photo-[0-9]*-[0-9]*$")},__isIdPhotoDetails:function(a){return this.__isID(a,"^"+this.__BASE_API_URI+"photo_details/photo_details-[0-9]*-[0-9]*$")},__isIdChat:function(a){return this.__isID(a,"^"+this.__BASE_API_URI+"chat/chat-[0-9]*$")},canQueueId:function(a){return this.__isIdUser(a)||this.__isIdPresence(a)||this.__isIdProduct(a)||this.__isIdPhoto(a)||this.__isIdPhotoDetails(a)||this.__isIdChat(a)},queue:function(a,c){"undefined"===typeof this.enabled&&(this.enabled=this.__loginManager.isLoggedIn(),this.__window.console.log("MultiGetManager::queue - 1 - this.enabled",this.enabled));this.enabled?(c="undefined"===typeof c?!1:!0===c,"string"===typeof a?this.__isIdUser(a)?this.__restModelFactory.multiGetQueueElement(this.USER_END_POINT,a):this.__isIdPresence(a)?this.__restModelFactory.multiGetQueueElement(this.USER_PRESENCE_END_POINT,a):this.__isIdProduct(a)?this.__restModelFactory.multiGetQueueElement(this.PRODUCT_END_POINT,a):this.__isIdPhoto(a)?this.__restModelFactory.multiGetQueueElement(this.PHOTO_END_POINT,a):this.__isIdPhotoDetails(a)?this.__restModelFactory.multiGetQueueElement(this.PHOTO_DETAILS_END_POINT,a):this.__isIdChat(a)&&this.__restModelFactory.multiGetQueueElement(this.CHAT_END_POINT,a):this.__parseGraph(a)&&c&&this.request()):this.__window.console.log("MultiGetManager::queue - 2 - this.enabled",this.enabled)},reset:function(a){a="undefined"===typeof a?null:a;null!==a&&a!==this.USER_END_POINT||this.__restModelFactory.multiGetReset(this.USER_END_POINT);null!==a&&a!==this.USER_PRESENCE_END_POINT||this.__restModelFactory.multiGetReset(this.USER_PRESENCE_END_POINT);null!==a&&a!==this.PRODUCT_END_POINT||this.__restModelFactory.multiGetReset(this.PRODUCT_END_POINT);null!==a&&a!==this.PHOTO_END_POINT||this.__restModelFactory.multiGetReset(this.PHOTO_END_POINT);null!==a&&a!==this.PHOTO_DETAILS_END_POINT||this.__restModelFactory.multiGetReset(this.PHOTO_DETAILS_END_POINT);null!==a&&a!==this.CHAT_END_POINT||this.__restModelFactory.multiGetReset(this.CHAT_END_POINT)},__requestSpecific:function(a){switch(a){case this.USER_END_POINT:return this.__restModelFactory.multiGetRequest(this.USER_END_POINT,this.__userNodeType);case this.USER_PRESENCE_END_POINT:return this.__restModelFactory.multiGetRequest(this.USER_PRESENCE_END_POINT,this.__userNodeType);case this.PRODUCT_END_POINT:return this.__restModelFactory.multiGetRequest(this.PRODUCT_END_POINT,this.__productNodeType);case this.PHOTO_END_POINT:return this.__restModelFactory.multiGetRequest(this.PHOTO_END_POINT,this.__photoNodeType);case this.PHOTO_DETAILS_END_POINT:return this.__restModelFactory.multiGetRequest(this.PHOTO_DETAILS_END_POINT,this.__photoDetailsNodeType);case this.CHAT_END_POINT:return this.__restModelFactory.multiGetRequest(this.CHAT_END_POINT,this.__chatNodeType);default:return this.__startupModel.get("isDev")&&this.__window.console.log("MultiGetManager::__requestSpecific - Unsupported end point ("+a+")"),!1}},request:function(){var a=[],c=this.__requestSpecific(this.USER_END_POINT);"object"===typeof c&&a.push(c);c=this.__requestSpecific(this.USER_PRESENCE_END_POINT);"object"===typeof c&&a.push(c);c=this.__requestSpecific(this.PRODUCT_END_POINT);"object"===typeof c&&a.push(c);c=this.__requestSpecific(this.PHOTO_END_POINT);"object"===typeof c&&a.push(c);c=this.__requestSpecific(this.PHOTO_DETAILS_END_POINT);"object"===typeof c&&a.push(c);c=this.__requestSpecific(this.CHAT_END_POINT);"object"===typeof c&&a.push(c);return a},__reactToGetPromise:function(a){a.then(function(c){if("undefined"!==typeof c.xhr){var d="";"undefined"!==typeof c.xhr.response&&c.xhr.response.length>d.length&&(d=c.xhr.response);"undefined"!==typeof c.xhr.responseText&&c.xhr.responseText.length>d.length&&(d=c.xhr.responseText);d=d.trim();if(""!==d){c=JSON.parse(d).denormalized;var e,f;for(f in c)if(c.hasOwnProperty(f)&&"undefined"!==typeof c[f].relations){d=c[f];if("undefined"!==typeof d.data&&"undefined"!==typeof d.data.actor){var g=d.data.actor.length;for(e=0;e<g;e++){var k=d.data.actor[e];"undefined"!==typeof k.user_url&&this.queue(k.user_url)}}d=c[f].relations;for(var l in d)d.hasOwnProperty(l)&&this.queue(d[l])}this.request()}}}.bind(this)).catch(function(c){if(!c.xhr||404!==c.xhr.status)throw c})},requestReact:function(a){var c=_.uniq(this.__restModelFactory.multiGetQueued(a)),d=this.__requestSpecific(a);if(!1===d)return this.__window.console.log("MultiGetManager::requestReact - Recognize __requestSpecific failure for the end point ("+a+")"),!1;if(!0===d&&0===c.length)return!0;if(!0===d){d=[];for(var e in c)c.hasOwnProperty(e)&&(a=c[e],d.push(this.__rest.get(a)))}c=0;for(e=d.length;c<e;c++)a=d[c],this.__reactToGetPromise(a);return d},actOnPromises:function(a,c){if(!0===a||!1===a)c();else{for(var d=[],e=a.length,f=0,g=null;f<e;f++)g=a[f],"object"===typeof g&&"Promise"===g.constructor.name&&d.push(g);this.__Promise.every(d).then(function(){c()}.bind());return d}},getReact:function(a){a=a.trim();if(""===a)return!1;a=this.__rest.get(a);this.__reactToGetPromise(a);return a},__parseGraph:function(a){var c=typeof a;if("undefined"!==c&&"object"===c)switch(c=a.constructor.name,c="undefined"===typeof c?"":c.trim(),c){case"FeedCommentCollection":return this.__parseFeedCommentCollection(a);case"FeedCollection":return this.__parseFeedCollection(a);case"NotificationCollection":return this.__parseNotificationCollection(a);case"EdgeCollection":return this.__parseEdgeCollection(a);case"CartProductCollection":return this.__parseCartProductCollection(a);case"ProductCollection":return this.__parseProductCollection(a);case"NodeModel":return this.__parseNodeModel(a);case"ConversationCollection":return this.__parseConversationCollection(a);case"NodeCollection":return this.__parseNodeCollection(a);case"":break;case"OutfitCollection":break;default:(this.__isQA||this.__isDev)&&this.__window.console.log("MultiGetManager::__parseGraph - Unrecognized graph type ("+c+")")}return!1},__parseFeedCommentCollection:function(a){if("object"!==typeof a||"FeedCommentCollection"!==a.constructor.name)return!1;if("object"===typeof a.models&&"number"===typeof a.models.length&&0<a.models.length&&"EdgeDerefModel"===a.models[0].constructor.name&&"object"===typeof a.models[0].node&&"NodeModel"===a.models[0].node.constructor.name&&"object"===typeof a.models[0].node.relations&&"string"===typeof a.models[0].node.relations.author){for(var c=a.models.length,d=0;d<c;d++)this.queue(a.models[d].node.relations.author);return!0}return!1},__parseFeedCollection:function(a){if("object"!==typeof a||"FeedCollection"!==a.constructor.name)return!1;var c=!1;if("object"===typeof a.models&&"number"===typeof a.models.length&&0<a.models.length&&"FeedEdgeDeref"===a.models[0].constructor.name&&"object"===typeof a.models[0].node&&"FeedNode"===a.models[0].node.constructor.name&&"object"===typeof a.models[0].node.relations){a=a.models;for(var d=a.length,e=0,f;e<d;e++)f=a[e].node.relations,"string"===typeof f.actor&&(this.queue(f.actor),c=!0),"string"===typeof f.photo&&(this.queue(f.photo),c=!0),"string"===typeof f.photo_details&&(this.queue(f.photo_details),c=!0)}return c},__parseNotificationCollection:function(a){if("object"!==typeof a||"NotificationCollection"!==a.constructor.name)return!1;if("object"===typeof a.models&&"number"===typeof a.models.length&&0<a.models.length&&"EdgeDerefModel"===a.models[0].constructor.name&&"object"===typeof a.models[0].node&&"NodeModel"===a.models[0].node.constructor.name&&"object"===typeof a.models[0].node.attributes&&"object"===typeof a.models[0].node.attributes.actor&&"number"===typeof a.models[0].node.attributes.actor.length&&0<a.models[0].node.attributes.actor.length){a=a.models;for(var c=a.length,d=0;d<c;d++){var e=a[d];"object"===typeof e.node.relations&&"string"===typeof e.node.relations.activity_reference_node&&this.queue(e.node.relations.activity_reference_node);e=e.node.attributes.actor;for(var f=0,g=e.length;f<g;f++)this.queue(e[f].user_url)}return!0}return!1},__parseEdgeCollection:function(a){if("object"!==typeof a||"EdgeCollection"!==a.constructor.name)return!1;var c=!1;if("object"===typeof a.models&&"number"===typeof a.models.length&&0<a.models.length&&"EdgeDerefModel"===a.models[0].constructor.name&&"object"===typeof a.models[0].node&&"NodeModel"===a.models[0].node.constructor.name){a=a.models;for(var d=a.length,e=0,f;e<d;e++)f=a[e],f=f.node,"undefined"!==typeof f&&"undefined"!==typeof f.relations&&("undefined"!==typeof f.relations.presence&&(this.queue(f.relations.presence),c=!0),"undefined"!==typeof f.relations.owner&&(this.queue(f.relations.owner),c=!0),"undefined"!==typeof f.relations.restgraph_entity&&(this.queue(f.relations.restgraph_entity),c=!0),"undefined"!==typeof f.relations.creator&&(this.queue(f.relations.creator),c=!0),"undefined"!==typeof f.relations.chat&&(this.queue(f.relations.chat),c=!0),"undefined"!==typeof f.relations.shell_product&&(this.queue(f.relations.shell_product),c=!0))}return c},__parseNodeModelArray:function(a){for(var c=!1,d=a.length,e=0,f;e<d;e++)f=a[e],f=f.node,"undefined"!==typeof f&&"undefined"!==typeof f.relations&&("undefined"!==typeof f.relations.creator&&(this.queue(f.relations.creator),c=!0),"undefined"!==typeof f.relations.parent&&(this.queue(f.relations.parent),c=!0));return c},__parseCartProductCollection:function(a){if("object"!==typeof a||"CartProductCollection"!==a.constructor.name)return!1;var c=!1;"object"===typeof a.models&&"number"===typeof a.models.length&&0<a.models.length&&"ProductEdgeDeref"===a.models[0].constructor.name&&"object"===typeof a.models[0].node&&"ProductNode"===a.models[0].node.constructor.name&&(c=this.__parseNodeModelArray(a.models));return c},__parseProductCollection:function(a){if("object"!==typeof a||"ProductCollection"!==a.constructor.name)return!1;var c=!1;"object"===typeof a.models&&"number"===typeof a.models.length&&0<a.models.length&&"ProductNode"===a.models[0].constructor.name&&"object"===typeof a.models[0]&&(c=this.__parseNodeModelArray(a.models));return c},__parseNodeModel:function(a){if("object"!==typeof a||"NodeModel"!==a.constructor.name)return!1;var c=!1;if("undefined"!==typeof a.attributes){var d=a.attributes["room.products"],e;if("object"===typeof d&&"number"===typeof d.length&&0<d.length){var f=d.length;for(e=0;e<f;e++)"undefined"!==typeof d[e].id?this.queue(d[e].id):this.queue(d[e]);c=!0}d=a.attributes.products;if("object"===typeof d&&"number"===typeof d.length&&0<d.length){f=d.length;for(e=0;e<f;e++)"undefined"!==typeof d[e].id?this.queue(d[e].id):this.queue(d[e]);c=!0}var g=a.attributes.users;if("object"===typeof g&&"number"===typeof g.length&&0<g.length){c=g.length;for(var k=0;k<c;k++)if(d=g[k],"string"===typeof d.id&&this.queue(d.id),d=g[k].products,"object"===typeof d&&"number"===typeof d.length&&0<d.length)for(f=d.length,e=0;e<f;e++)"undefined"!==typeof d[e].id?this.queue(d[e].id):this.queue(d[e]);c=!0}}"undefined"!==typeof a.relations&&"undefined"!==typeof a.relations.owner&&(this.queue(a.relations.owner),c=!0);return c},__parseConversationCollection:function(a){if("object"!==typeof a||"ConversationCollection"!==a.constructor.name)return!1;var c=!1;if("object"===typeof a.models&&"number"===typeof a.models.length&&0<a.models.length&&"ConversationEdgeDerefModel"===a.models[0].constructor.name&&"object"===typeof a.models[0].node&&"ConversationNode"===a.models[0].node.constructor.name){a=a.models;for(var d=a.length,e=0,f;e<d;e++)if(f=a[e],"undefined"!==typeof f.node&&("undefined"!==typeof f.node.attributes&&"string"===typeof f.node.attributes["last_message.sent_by"]&&(this.queue(f.node.attributes["last_message.sent_by"]),c=!0),"undefined"!==typeof f.node.changed&&"string"===typeof f.node.changed["last_message.sent_by"]&&(this.queue(f.node.changed["last_message.sent_by"]),c=!0),"undefined"!==typeof f.node.attributes&&"object"===typeof f.node.attributes.participants&&"number"===typeof f.node.attributes.participants.length&&0<f.node.attributes.participants.length)){f=f.node.attributes.participants;for(var g=f.length,k=0,l;k<g;k++)l=f[k],"string"===typeof l.user&&(this.queue(l.user),c=!0)}}return c},__parseNodeCollection:function(a){if("object"!==typeof a||"NodeCollection"!==a.constructor.name)return!1;var c=!1;if("object"===typeof a.models&&"number"===typeof a.models.length&&0<a.models.length&&"NodeModel"===a.models[0].constructor.name){a=a.models;for(var d=a.length,e=0,f;e<d;e++)f=a[e],"object"===typeof f.relations&&("string"===typeof f.relations.creator&&(this.queue(f.relations.creator),c=!0),"string"===typeof f.relations.presence&&(this.queue(f.relations.presence),c=!0))}return c}}))}({Model:m["@Model"],UiCore:m["@UiCore"]}),yb=function(h){return IMVU.BaseClass.extend("LocalStorageManager",_.extend({dependencies:["cookieManager"],initialize:function(b){this.__cookieManager=b.cookieManager;this.broken=!1;if(void 0===localStorage.getItem)this.broken=!0;else try{localStorage.setItem("breakage_test",42),localStorage.removeItem("breakage_test")}catch(a){this.broken=!0}},getItem:function(b){return this.broken?(b=this.__cookieManager.get(b),"null"===b?null:b):localStorage.getItem(b)},getWithDefault:function(b,a){b=this.getItem(b);return null===b?a:b},setItem:function(b,a){this.broken?this.__cookieManager.set(b,a):(localStorage.setItem(b,a),this.trigger("change:"+b,a))},removeItem:function(b){this.broken?this.__cookieManager.set(b,null):(localStorage.removeItem(b),this.trigger("remove:"+b))},clear:function(){this.broken||localStorage.clear()}},Backbone.Events))}({}),zb=function(h){return IMVU.BaseClass.extend("Leanplum",_.extend({dependencies:["Promise"],initialize:function(b){},startSession:function(b){},started:function(){},endSession:function(){},setState:function(b,a){},recordEvent:function(b,a){},registerUser:function(b){},setUser:function(b){},__onVarChange:function(){},getVars:function(b){},get:function(b){}},Backbone.Events))}({leanplumSDK:m["@Leanplum"],UiCore:m["@UiCore"]}),Ab=function(h){return IMVU.BaseClass.extend("UrlHelpers",{dependencies:["globalStartupModel","window"],initialize:function(b){var a=this;this.__serviceProvider=b.serviceProvider;this.__globalStartupModel=b.globalStartupModel;this.__window=b.window;this.__globalStartupModel.populated().then(function(){a.__youTubeBaseUrl=a.__globalStartupModel.get("baseYouTubeProxyUrl")})},getBaseURI:function(){var b=this.__serviceProvider.get("root")||this.__globalStartupModel.get("baseApiURI");"/"===b.charAt(b.length-1)&&(b=b.substr(0,b.length-1));return b},getProductDescriptionUrl:function(b,a){var c=this.__validateAndReturnStartupValue("creatorAssetServerBaseUrl");this.__validateProductId(b);this.__validateQueryParams(a);return IMVU.URI.build(c+"/product_description/"+b,a||{})},getAssetUrl:function(b,a,c){var d=this.__validateAndReturnStartupValue("creatorAssetServerBaseUrl");this.__validateQueryParams(c);a=Array.isArray(a)?a.join(","):a;return IMVU.URI.build(d+"/"+b+"/"+a,c||{})},getProductMetadataUrl:function(b){this.__validateProductId(b);return this.__globalStartupModel.get("baseApiURI")+"product_metadata/product_metadata-"+b},getProductUrl:function(b){this.__validateProductId(b);return this.__getProductUrlBase()+"/product-"+b},getProductSearchUrl:function(b){b=void 0===b?{}:b;return IMVU.URI.build(this.__getProductUrlBase(),b)},getProductAncestorUrl:function(b){this.__validateProductId(b);return this.__getProductUrlBase()+"/product-"+b+"/ancestor_products"},removeQuery:function(b){b=new IMVU.URI(b);b.setQuery();return b.toString()},getYouTubeVideoStatsUrl:function(b){var a=this.__youTubeBaseUrl+"/videos?part=status%2Csnippet%2CcontentDetails%2Cstatistics";b=b.join("%2C");return a+"&id="+b},getYouTubeSearchUrl:function(b,a){var c=this.__youTubeBaseUrl+"/search?part=snippet&order=viewCount";c=c+"&q="+b+"&maxResults=16";return a?c+"&pageToken="+a:c},getYouTubePlaylistItemUrl:function(b,a){var c=this.__youTubeBaseUrl+"/playlistItems?part=contentDetails";c=c+"&playlistId="+b+"&maxResults=50";a&&(c=c+"&pageToken="+a);return c},getYouTubePlaylistUrl:function(b){var a=this.__youTubeBaseUrl+"/playlists?part=snippet%2CcontentDetails&maxResults=25";b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next())a=a+"&id="+c.value;return""+a},getProductSnapshotsCategoryUrl:function(){return this.getBaseURI()+"/product_preview_category"},getBaseProductSnapshotsImageUrl:function(){return this.__validateAndReturnStartupValue("creatorAssetServerBaseUrl")+"/product_preview_image"},getProductSnapshotsImageUrl:function(b,a,c,d,e){b=new URLSearchParams({project_id:b,preview_category_id:a,scene_id:c,mannequin_id:d,gender:e}).toString();return this.getBaseProductSnapshotsImageUrl()+"?"+b},__getProductUrlBase:function(){var b=this.__globalStartupModel.get("productUrl");return"true"===localStorage.getItem("forceProduction")?b.replace(/localhost./,""):b},__validateAndReturnStartupValue:function(b){if(this.__globalStartupModel.get(b))return this.__globalStartupModel.get(b);throw Error('No "'+b+'" found in startup')},__validateProductId:function(b){if(!b||!/^([0-9]\d*)$/.test(b.toString()))throw Error("UrlHelpers Error: invalid product id "+b)},__validateQueryParams:function(b){if(b&&"object"!==typeof b)throw Error("UrlHelpers Error: invalid query params "+b)}})}({}),Bb=function(h){var b=h.UiCore.DialogManager;return b.extend("DialogManager",{dependencies:["contextMenuManager","globalStringManager","timer","window"],initialize:function(a){b.prototype.initialize.call(this,a);this.__appMonitor=null;this.contextMenuManager=a.contextMenuManager;this.__timer=a.timer;this.__globalStringManager=a.globalStringManager;$(document).on("keyup.dialogManager",this.__handleKeyup.bind(this));this.$container.on("mousedown",function(c){$(c.target).closest(".dialog-container").length||$(c.target).children().hasClass("tutorial-template")||$(c.target).children().hasClass("transparent-avatar")||!_.last(this.__stack).canCloseWithOverlayClick||(this.serviceProvider.get("window").console.warn("Debug: Clicked overlay...",c.target,c.currentTarget),this.closeActive())}.bind(this))},__logWaypoint:function(a,c){if(null===this.__appMonitor&&this.__serviceProvider.has("appMonitor")){var d=this.__serviceProvider.get("appMonitor");this.__appMonitor=d?d:null}this.__appMonitor&&this.__appMonitor.waypoint(a,c)},delete:function(){b.prototype.delete.call(this);$(document).off("keyup.dialogManager")},__handleKeyup:function(a){a.keyCode===h.NextUtil.Keys.VK_ESC&&this.closeActive()},alert:function(a){return this.showDialog(h.Dialogs.AlloyAlertDialog,a)},standardAlert:function(a){"CART_PRODUCT-003"===a?this.alert({title:this.__globalStringManager.get("add_to_cart_error_title"),text:this.__globalStringManager.get("add_to_cart_error_003_text"),ok:this.__globalStringManager.get("add_to_cart_error_ok")}):"CART_PRODUCT-004"===a?this.alert({title:this.__globalStringManager.get("add_to_cart_error_title"),text:this.__globalStringManager.get("add_to_cart_error_004_text"),ok:this.__globalStringManager.get("add_to_cart_error_ok")}):"CART_PRODUCT-007"===a?this.alert({title:this.__globalStringManager.get("add_to_cart_error_title"),text:this.__globalStringManager.get("add_to_cart_error_007_text"),ok:this.__globalStringManager.get("add_to_cart_error_ok")}):"CART_PRODUCT-008"===a||"CART_PRODUCT-006"===a?this.alert({title:this.__globalStringManager.get("add_to_cart_error_title"),text:this.__globalStringManager.get("add_to_cart_error_006_or_008_text"),ok:this.__globalStringManager.get("add_to_cart_error_ok")}):this.alert({title:this.__globalStringManager.get("add_to_cart_error_title"),text:this.__globalStringManager.get("add_to_cart_error_text"),ok:this.__globalStringManager.get("add_to_cart_error_ok")})},confirm:function(a){return this.showDialog(h.Dialogs.AlloyConfirmDialog,a)},closeAll:function(a){this.__logWaypoint("DialogManager::closeAll");for(var c=!1,d=this.__stack.length-1;0<=d;d--){var e=this.__stack[d];"undefined"!==typeof e&&((e.$el.hasClass("interstitial")||e.$el.hasClass("persistent"))&&!0===a?c=!0:(e.hide(),e.promiseResolver.reject()))}c||(this.hide(),this.__stack=[])},hideAll:function(a){this.__logWaypoint("DialogManager::hideAll");for(var c=!1,d=this.__stack.length-1;0<=d;d--){var e=this.__stack[d];"undefined"!==typeof e&&((e.$el.hasClass("interstitial")||e.$el.hasClass("persistent"))&&!0===a?c=!0:e.hide())}c||(this.hide(),this.__stack=[])},closeTo:function(a){this.__logWaypoint("DialogManager::closeTo - "+a);for(var c=this.__stack.length-1;0<=c;c--){var d=this.__stack[c];"undefined"!==typeof d&&(d.$el.hasClass(a)?d.show():(this.__stack.splice(c,1),d.hide(),d.promiseResolver.reject()))}},closeActive:function(){this.__logWaypoint("DialogManager::closeActive");var a=_.last(this.__stack);!a||"undefined"!==typeof a.isUncancellableDialog&&a.isUncancellableDialog||(a.$el.hasClass("product-lightbox")||a.$el.hasClass("profile-lightbox")||a.$el.hasClass("feed-lightbox")||a.$el.hasClass("room-detail-lightbox")?this.__timer.setTimeout(function(){return a.hide()},0):a.hide(),this.contextMenuManager.isContextMenuOpen()&&this.contextMenuManager.closeMenu(),a.promiseResolver.reject())},show:function(){document.querySelector("body").classList.add("open-dialog");var a=document.documentElement.scrollTop||document.body.scrollTop;this.__undoScrollTop=document.documentElement.scrollTop?function(){$("html").scrollTop(a)}:document.body.scrollTop?function(){$("body").scrollTop(a)}:function(){};b.prototype.show.call(this);$("#imvu").scrollTop(a)},hide:function(){document.querySelector("body").classList.remove("open-dialog");b.prototype.hide.call(this);this.__undoScrollTop&&(this.__undoScrollTop(),delete this.__undoScrollTop)},hasDialog:function(a){return this.__stack.find(function(c){return c.$el.hasClass(a)})},toggleTransparentOverlaySize:function(a){this.$el.hasClass("contextual-dialogs")&&(this.__contextualDialogsRemoved=!0);this.$el.toggleClass("contextual-dialogs",a);return this.__contextualDialogsRemoved},showMultiCartUpsellDialog:function(a){this.__window.console.error("WAF::DialogManager::showMultiCartUpsellDialog - Do not call this function from the WAF DialogManager");return!1},showUserDoesNotExistAlert:function(a){this.alert({title:this.__globalStringManager.get("Error"),text:this.__globalStringManager.get("ERROR.NODE-001"),ok:this.__globalStringManager.get("OK")}).finished.then(function(){this.__showUserDoesNotExistAlertRedirection()}.bind(this)).catch(function(){this.__showUserDoesNotExistAlertRedirection()}.bind(this))},__showUserDoesNotExistAlertRedirection:function(){this.__serviceProvider.get("loginManager").isLoggedIn()?this.__serviceProvider.get("modeManager").openMode({mode:{id:"friends"},submode:{id:"search"}}):this.__window.location.href="/welcome/login/"}})}({Dialogs:m["@Dialogs"],NextUtil:m["@NextUtil"],UiCore:m["@UiCore"]}),Cb=function(h){var b=h.UiCore.UiContext;return b.extend("TooltipLayer",{className:"tooltip-layer",uiContextName:"tooltip_layer",initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM()}})}({UiCore:m["@UiCore"]}),Db=function(){return function(h){return function(b,a){return a?h.get("platform")===b?a.fn(this):a.inverse(this):b.data.root.platform}}}({}),Eb=function(h){return IMVU.BaseClass.extend("NullPrefsManager",{dependencies:["Promise"],initialize:function(b){this.Promise=b.Promise},populated:function(){return this.Promise.resolve()},get:function(b,a){return a},getBool:function(b,a){return a},set:function(b,a){}})}({}),Fb=function(h){return IMVU.BaseClass.extend("VcoinHelper",{dependencies:["prefsManager","Promise","restModelFactory","timestampHelper","window"],initialize:function(b){this.__prefsManager=b.prefsManager;this.__Promise=b.Promise;this.__restModelFactory=b.restModelFactory;this.__timestampHelper=b.timestampHelper;this.__window=b.window},getUpdatedWallet:function(b){var a=this;return new this.__Promise(function(c){var d=a.__prefsManager.getInt("next.vcoin.user_last_checked_kyc",0);1===b.get("verification_status")&&36e5<a.__timestampHelper.now()-d?(a.__prefsManager.setInt("next.vcoin.user_last_checked_kyc",a.__timestampHelper.now()),b=a.__restModelFactory.readModel(b.id+"?check_verification_status=1",h.UiCore.NodeModel),b.populated().then(function(){c.accept(b)}).catch(function(e){a.__window.console.log("Something went wrong",e);c.reject()})):c.accept(b)})}})}({Model:m["@Model"],UiCore:m["@UiCore"]}),Gb=function(){function h(c){c.startsWith("//")?c="https:"+c:c.startsWith("http:")&&(c="https:"+c.substring(5));return c}function b(c,d){window.console.error(c,d);throw Error(c)}var a={};return{get:function(c,d,e){c.startsWith("data:")&&b("get: url is already a data url",{url:c,width:d,height:e});var f=typeof d,g=typeof e;"number"!==f&&"number"!==g&&b("width and height must be numeric. width: "+IMVU.repr(d)+" ("+f+"), height: "+IMVU.repr(e)+" ("+g+")",{url:c,width:d,height:e});d&&e||b("width and height must be non-zero. width: "+d+", height: "+e,{url:c,width:d,height:e});c=h(c);if(c=a[c])var k=c[d+"x"+e];return k},set:function(c,d,e,f){c.startsWith("data:")&&b("set: url is already a data url",{url:c,dataUrl:d,width:e,height:f});c=h(c);a[c]||(a[c]={});a[c][e+"x"+f]=d}}}({}),Hb=function(h){var b=IMVU.BaseClass;return b.extend("PerfReportManager",_.extend({dependencies:"featureAccessManager globalStartupModel loginManager modeManager timer window".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__featureAccessManager=a.featureAccessManager;this.__modeManager=a.modeManager;this.__timer=a.timer;this.__window=a.window;this.__loginManager=a.loginManager;this.__globalStartupModel=a.globalStartupModel;this.__sessionStart=this.getTimeSeconds();this.__uiContext=null;this.__clearData();this.__budget=h.PerfBudgetWebBig;"undefined"!==typeof a.unitTests&&!0===a.unitTests?this.__budget=h.PerfBudgetUnitTests:this.__featureAccessManager.isSandboxOrTesting()?this.__budget=h.PerfBudgetSandbox:this.__featureAccessManager.isMobile()?this.__budget=h.PerfBudgetWebSmall:this.__featureAccessManager.isElectronClient()&&(this.__budget=h.PerfBudgetClient);this.__serviceProvider="undefined"!==typeof a.serviceProvider?a.serviceProvider:null;this.__uiEventReporter=this.__serviceProvider.get("uiEventReporter");this.tags=h.PerfReportManagerTags},on:function(){this.__state="on"},off:function(){this.__state="off"},hasMetrics:function(){return 0<this.__window.perfHistory.length},getState:function(){return this.__state},getTime:function(){return parseFloat((this.__timer.getTime()/1e3).toFixed(3))},getTimeSeconds:function(){return parseInt(this.__timer.getTime()/1e3)},startTimer:function(a){this.__timers[a]=this.getTime();return this.__timers[a]},getBudget:function(a){return"undefined"===typeof this.__budget[a]?("undefined"!==typeof this.__window.console.error&&this.__window.console.error("PerfReportManager - Budget not defined for:  "+a),-1):parseFloat(this.__budget[a])},setPhase:function(a){this.__phase=a},setUIContext:function(a){this.__uiContext=a},record:function(a,c,d){"undefined"===typeof this.__state&&this.reset();if("off"!==this.__state){d="undefined"===typeof d?this.__uiEventReporter.getLastEventTime(c):d;d=parseFloat((this.getTime()-d).toFixed(3));var e=this.__modeManager.getCurrentMode(),f=null===e||"undefined"===typeof e.id?"":e.id;e=e&&e.getCurrentSubmode()?e.getCurrentSubmode().id:void 0;if(this.__uiContext){var g=this.getTimeSeconds()-this.__sessionStart;this.__uiContext.recordPerformanceTaxonomyEvent(a,d,{type:c,mode:f,submode:e,sessionDuration:g})}this.__window.perfHistory||(this.__window.perfHistory=[]);var k=this.getBudget(a);this.__window.perfHistory.push({name:a,type:c,actual:d,budget:k,phase:this.__phase,mode:f,submode:e});this.__window.perfSummary[a]="undefined"===typeof this.__window.perfSummary[a]?{elapsed:d,budget:k,sum:d,count:1,name:a,type:c}:{elapsed:d,budget:k,sum:this.__window.perfSummary[a].sum+d,count:this.__window.perfSummary[a].count+1,name:a,type:c};d>k&&(g="PerfReportManager name("+a+") type("+c+")",d=["PerfReportManager...",'{"name":"'+a+'", "type":"'+c+'", "actual":"'+String(d)+'", "budget":"'+String(k)+'", "phase":"'+this.__phase+'", "mode":"'+f+'", "submode":"'+e+'"}'],this.__serviceProvider.get("appMonitor").reportCustomError(a,c,"web_perf_report_manager",g,d))}},toJsonStr:function(){for(var a='{"events":[',c=this.__window.perfHistory.length,d,e=0;e<c;e++)d=this.__window.perfHistory[e],a+='{"name":"'+d.name+'", "type":"'+d.type+'", "actual":"'+String(d.actual)+'", "budget":"'+String(d.budget)+'", "phase":"'+d.phase+'", "mode":"'+d.mode+'", "submode":"'+d.submode+'"}',e<c-1&&(a+=", ");return a+"]}"},toJsonObj:function(){var a=this.toJsonStr();return JSON.parse(a)},__clearData:function(){this.__timers=[];this.__window.perfHistory=[];this.__window.perfSummary={};this.__phase=""},reset:function(){this.__clearData();if("undefined"===typeof this.__state)this.on()},getPrevious:function(){return"undefined"===typeof this.__window.perfHistory?(this.reset(),null):0===this.__window.perfHistory.length?null:this.__window.perfHistory[this.__window.perfHistory.length-1]},getAverage:function(a){return parseFloat((this.__window.perfSummary[a].sum/this.__window.perfSummary[a].count).toFixed(3))}}))}({Model:m["@Model"],UiCore:m["@UiCore"],PerfBudgetClient:m["json!/common/waf/js/manager/PerfReportManagerBudgetClient.json"],PerfBudgetSandbox:m["json!/common/waf/js/manager/PerfReportManagerBudgetSandbox.json"],PerfBudgetUnitTests:m["json!/common/waf/js/manager/PerfBudgetUnitTests.json"],PerfBudgetWebBig:m["json!/common/waf/js/manager/PerfReportManagerBudgetWebBig.json"],PerfBudgetWebSmall:m["json!/common/waf/js/manager/PerfReportManagerBudgetWebSmall.json"],PerfReportManagerTags:m["json!/common/waf/js/manager/PerfReportManagerTags.json"]}),Ib=function(){return IMVU.BaseClass.extend("JQueryExpectElement",{initialize:function(h){var b=h.serviceProvider;$.fn.expect=function(a){if(this.length!==a){var c=b.get("window"),d=-1!==c.location.host.indexOf("localhost.");a="expecting exactly "+a+" elements but got "+this.length;if(d)throw Error(a);c.console.error(a)}return this}}})}({}),Jb=function(h){return IMVU.BaseClass.extend("BaseApp",{__getTime:function(){return parseFloat(((new Date).getTime()/1e3).toFixed(3))},__installJQueryPlugins:function(b){b=IMVU.requireProperty(b,"serviceProvider");b.create(h.JQueryExpectElement,{serviceProvider:b})},registerQaWeb:function(b){var a=b.get("globalStartupModel").get("qaWeb");a&&b.get("window").console.log("QA web",a);b.register("qaWeb",a)},launch:function(b){b=void 0===b?{}:b;this.__importsModeManager=h.ModeManager;this.__installJQueryPlugins(b);this.__synchronousStartupDependencies(b);var a=this.__launchWithLoginInfo(b);this.__serviceProvider=this.__serviceProvider||b.serviceProvider;this.__args=b;this.__chatHelper=null;return a},__launchAppMonitor:function(b){this.__serviceProvider=this.__serviceProvider||b;this.__window=this.__serviceProvider.get("window");this.__serviceProvider.register("perfReportManager",this.__serviceProvider.create(h.PerfReportManager,{}));if(!this.__serviceProvider.has("appMonitor")){b=null;try{b=this.__serviceProvider.create(h.AppMonitor,{args:this.__args})}catch(a){this.__serviceProvider.get("window").console.error("BaseApp::__launchAppMonitor - Failed to create appMonitor:  "+a.message)}this.__serviceProvider.register("appMonitor",b)}this.__appMonitor=this.__serviceProvider.get("appMonitor")},__maybeApplySmartlingMarkers:function(b){var a=["ar"],c=b.get("currentLocale");b.get("featureAccessManager").isElectronClient()&&a.includes(c)&&(document.querySelector("html").setAttribute("dir","rtl"),document.querySelector("body").classList.add("smartling-"+c))},__synchronousStartupDependencies:function(b){var a=IMVU.requireProperty(b,"serviceProvider");a.register("dataUrlCache",h.DataUrlCache);a.register("appPath",b.appPath||"");a.register("appVersion",b.appVersion||null);a.register("systemMetrics",b.systemMetrics||null);a.get("window").alloyDebug={serviceProvider:a};void 0!==b.startSubmode&&(b.startSubmode=decodeURIComponent(b.startSubmode));var c=IMVU.optionalProperty(b,"applicationName","next");a.register("appName",c);b.suppressPlatform||(c+="_"+b.platform);var d="1";if("darwin_app"===b.platform||"win64_app"===b.platform)d=b.appVersion;this.__appVersion=d;a.get("rest").precache(b.denormalizedRest||{});a.get("rest").setApplicationHeader(c+"/"+d);a.register("cid",b.cid);a.register("disableRestCache",b.disableRestCache);a.register("restCacheManager",a.create(b.restCacheManager||h.RestCacheManager));a.register("globalStartupModel",a.get("restModelFactory").readModel(b.globalStartupUrl,h.UiCore.NodeModel));a.register("showNavCore",!!b.showNavCore);a.register("baseRoot",b.baseRoot);a.register("siteRoot",b.siteRoot);a.register("params",b.params);a.register("locales",b.locales);a.register("currentLocale",b.current_locale);"desktop"===b.platform&&1<window.navigator.maxTouchPoints&&"MacIntel"===window.navigator.platform&&"undefined"!==typeof window.navigator.standalone?(a.register("platform","mobile"),document.getElementsByTagName("body")[0].classList.remove("desktop"),document.getElementsByTagName("body")[0].classList.add("mobile")):a.register("platform",b.platform);a.register("storePlatform",b.storePlatform);a.register("deviceType",b.deviceType);a.register("touchEventHelper",a.create(h.touchEventHelper));a.register("startMode",b.startMode);a.register("startSubmode",b.startSubmode);a.register("overrideMode",b.overrideMode);a.register("overrideSubmode",b.overrideSubmode);a.register("campaign",b.campaign);a.register("moment",h.Moment(a));a.register("seenBefore",b.seen_before);h.FastClick.attach(document.body);a.register("cookieDomain",IMVU.optionalProperty(b,"cookieDomain",".imvu.com"));a.register("cookieManager",a.create(b.cookieManager||h.CookieManager));a.register("webGL",a.create(b.WebGLFactory||h.WebGL,{enable3d:b.enable3d}));c=a.create(h.StringManager,{dictionary:h.dictionary,serviceProvider:a});a.register("globalStringManager",c);a.register("onlineHelper",a.create(h.OnlineHelper));a.register("timestampHelper",a.create(h.TimestampHelper));a.register("globalVariablesManager",a.create(h.GlobalVariablesManager));a.register("subscriptionManager",a.create(h.SubscriptionManager));a.register("browserInfo",a.create(b.browserInfo||h.BrowserInfo));_.has(b,"appTitle")?a.register("appTitle",c.getWithDefault(b.appTitle,b.appTitle)):a.register("appTitle","IMVU");a.register("leanplumAppId",b.leanplumAppId);a.register("leanplumApiKey",b.leanplumApiKey);a.register("leanplum",a.create(b.Leanplum||h.Leanplum,{possibleAlt:b.possibleAlt}));Handlebars.registerHelper("i18n-g",c.handlebarsHelper.bind(c));Handlebars.registerHelper("i18n-gwd",c.handlebarsHelperWithDefault.bind(c));Handlebars.registerHelper("platform",h.handlebarsHelperPlatform(a));Handlebars.registerHelper("ifEqual",h.handlebarsHelperIfEqual);a.register("localStorage",a.create(h.LocalStorageManager));a.register("featureAccessManager",a.create(b.loggedOutFeatureAccessManager||h.LoggedOutFeatureAccessManager));var e=a.create(b.ModeManagerFactory||this.__importsModeManager,{$parentElement:b.$parentElement||$("body"),availableModes:IMVU.requireProperty(b,"availableModes")});a.register("modeManager",e);a.register("contextMenuManager",e.createChildContext(b.contextMenuManagerFactory||h.ContextMenuManager,{$parentElement:e.$el}));a.get("contextMenuManager").show();a.register("dialogManager",e.createChildContext(b.dialogManagerFactory||h.DialogManager,{$parentElement:e.$el}));a.register("tooltipLayer",e.createChildContext(h.TooltipLayer,{$parentElement:e.$el}));b.WindowManager&&e.ready(function(){a.register("windowManager",e.createChildContext(b.WindowManager,{$parentElement:e.$el}))});a.register("geolocation",b.geolocation);a.register("uiEventReporter",a.create(IMVU.optionalProperty(b,"UiEventReporterFactory",h.WAFUiEventReporter)));a.register("cookieManager",a.create(b.cookieManager||h.CookieManager));a.register("localStorage",a.create(h.LocalStorageManager));a.register("historyManager",a.create(b.historyManagerFactory||h.HistoryManager));c=a.create(b.loginManagerFactory||h.LoginManager);a.register("loginManager",c);"ftux"==b.startMode&&b.params.from&&(d=decodeURIComponent(b.params.from),d.substr(0,b.siteRoot.length)===b.siteRoot&&c.setSignUpDestination(d));a.register("googleAnalytics",a.create(b.googleAnalytics||h.GoogleAnalytics));a.register("imageManager",a.create(b.imageManagerFactory||h.ImageManager));a.register("loginCookieName","LoggedInWithAlloy");$(a.get("window")).resize(function(){$(a.get("window")).scroll()});a.register("multiGetManager",a.create(h.MultiGetManager,{}));a.register("urlManager",a.create(h.UrlManager,{}));a.register("urlHelpers",a.create(h.UrlHelpers,{}));a.register("acceptedDollarStorePermaLinkProducts","ap marriage_package room_slot name_change shared_room age_verification vip host_subscription credits vcoin".split(" "));a.register("worldpayEprotectData",{payPageID:"gvsGCrbuiv7FEtvz",reportGroup:"Default Report Group",timeout:15e3,eProtectFailureCodesAccountNumber:[871,872,873,874,875,876],eProtectFailureCodesCCV:[881,882,883,884,885,889]});a.has("counterHelper")||a.register("counterHelper",a.create(h.CounterHelper))},__launchWithLoginInfo:function(b){b.perfStartTime=this.__getTime();var a=IMVU.requireProperty(b,"serviceProvider");a.get("Promise");return a.get("loginManager").createFromCookie().then(function(){return a.get("globalStartupModel").populated()}.bind(this)).then(function(){return a.get("loginManager").getCurrentUser().populated()}).then(this.__registerLoggedInServices.bind(this,b,a,IMVU.requireProperty(b,"LoggedInNavFactory")),this.__registerLoggedOutServices.bind(this,b,a,IMVU.requireProperty(b,"LoggedOutNavFactory")))},__registerLoggedInServices:function(b,a,c,d){this.registerQaWeb(a);var e=b.imqMetadata?b.imqMetadata:{app:"imvu_next",platform_type:"mobile"===a.get("platform")?"small":"big"};e=a.create(h.IMQ.ImqManager,{url:a.get("loginManager").getCurrent().relations.imq,metadata:e,userId:d.get("legacy_cid").toString(),sessionId:a.get("loginManager").getCurrent().get("session_id")});a.register("loggedInUser",d);a.register("imqManager",e);a.get("modeManager").createSmartBanner();return e.connect().then(function(){a.get("modeManager").createChildContext(h.ImqStatus,{$parentElement:a.get("modeManager").$el});a.create(h.UiCore.ModelInvalidator);a.register("sceneManager",a.get("modeManager").createChildContext(h.SceneManager,{$replaceElement:a.get("modeManager").$(".scene-manager-placeholder"),moduleBundle:"@lazySceneBundle",module:b.module}));a.register("prefsManager",a.create(b.PrefsManager||h.PrefsManager));return a.get("prefsManager").populated().then(function(){var f=a.get("globalStartupModel").get("shouldPauseLiveRooms"),g=a.get("prefsManager").get("next.pause_live_rooms"),k=void 0!==g?a.get("prefsManager").getBool("next.pause_live_rooms"):!!parseInt(f,10);a.register("shouldPauseLiveRooms",k);var l=a.get("globalStartupModel");this.__chatHelper&&(l=this.__chatHelper.getPauseLiveRoomsInterval(l),a.get("window").console.log("Live room status",JSON.stringify({config:void 0===f?"<not set>":f,pref:void 0===g?"<not set>":g,pause:k}),"Update interval",l,"ms"));"1"!==this.__appVersion&&((f=a.get("prefsManager").get("next.leanplum_device_id"))||(f=a.get("localStorage").getItem("__leanplum_device_id")),f&&(a.get("prefsManager").set("next.leanplum_device_id",f),a.get("localStorage").setItem("__leanplum_device_id",f)),a.get("leanplum").startSession(d.get("legacy_cid").toString()));a.get("featureAccessManager").isElectronClient()&&"login"===b.startMode&&a.get("loginManager").isLoggedIn()&&(a.get("window").console.log("Already logged in, go to home mode"),b.startMode="home",b.startSubmode="__default__");a.get("featureAccessManager").isElectronClient()&&"home"===b.startMode&&(f=a.get("globalStartupModel").get("optedOutMaxCount"),g=a.get("moment"),a.get("prefsManager").getInt("next.notifications.login_counter")>=f&&a.get("prefsManager").setInt("next.notifications.login_counter",0),a.get("prefsManager").setInt("next.notifications.login_counter",a.get("prefsManager").getInt("next.notifications.login_counter",0)+1),a.get("prefsManager").set("next.notifications.last_logged_in",g(Date.now()).toString()));f={serviceProvider:a};b.qaWeb&&(f.qaWeb=b.qaWeb);a.register("featureAccessManager",a.create(b.featureAccessManager||h.LoggedInFeatureAccessManager,f));this.__maybeApplySmartlingMarkers(a);a.register("protocolLinksManager",a.create(h.protocolLinksManager,{}));a.register("vcoinHelper",a.create(h.VcoinHelper));a.register("smartAdHelper",a.create(h.SmartAdHelper));a.register("activityHelper",a.create(h.ActivityHelper));a.register("globalNav",a.get("modeManager").createChildContext(c,{$replaceElement:a.get("modeManager").$(".nav-placeholder"),perfStartTime:this.__getTime()}));a.get("window").autoUpdate&&IMVU.optionalProperty(b,"module",module).run({UpdateManager:"@UpdateManager"},function(n){a.register("updateManager",a.create(n.UpdateManager,{}))});a.register("loginSentinel",a.create(b.loginSentinelFactory||h.LoginSentinel));f=b.startMode;g=a.get("overrideSubmode")||b.startSubmode||"__default__";a.get("overrideMode")&&(f=a.get("overrideMode")||b.startMode,g=a.get("overrideSubmode")||"__default__");a.get("modeManager").openMode({openDefaultView:b.startSubmode?!1:!0,mode:{id:f},submode:{id:g}}).then(function(){b.appReadyCallback&&b.appReadyCallback(a)});a.get("modeManager").$(".imvu-loading").remove();this.__launchAppMonitor(a)}.bind(this))}.bind(this))},__registerLoggedOutServices:function(b,a,c){this.registerQaWeb(a);a.get("localStorage").getItem("__alt_signup")||(a.get("localStorage").removeItem("__leanplum_device_id"),a.get("localStorage").removeItem("__leanplum_user_id"));b.featureAccessManager&&a.register("featureAccessManager",a.create(b.featureAccessManager));a.get("localStorage").removeItem("__alt_signup");a.get("leanplum").startSession();a.register("prefsManager",a.create(h.NullPrefsManager));this.__maybeApplySmartlingMarkers(a);a.register("protocolLinksManager",a.create(h.protocolLinksManager,{}));a.register("smartAdHelper",a.create(h.SmartAdHelper));a.register("globalNav",a.get("modeManager").createChildContext(c,{$replaceElement:a.get("modeManager").$(".nav-placeholder"),startSubmode:b.startSubmode,perfStartTime:this.__getTime()}));a.get("window").autoUpdate&&IMVU.optionalProperty(b,"module",module).run({UpdateManager:"@UpdateManager"},function(d){a.register("updateManager",a.create(d.UpdateManager,{}))});c={mode:{id:b.startMode},submode:{id:b.startSubmode}};b.overrideMode?(c.mode.id=b.overrideMode,c.submode.id=b.overrideSubmode||"__default__"):b.overrideSubmode&&(c.submode.id=b.overrideSubmode);a.get("modeManager").openMode(c);a.get("modeManager").$(".imvu-loading").remove();a.register("loginSentinel",a.create(b.loginSentinelFactory||h.LoginSentinel));b.instantiateSceneManager&&a.register("sceneManager",a.get("modeManager").createChildContext(h.SceneManager,{$replaceElement:a.get("modeManager").$(".scene-manager-placeholder"),moduleBundle:"@lazySceneBundle",module:b.module}));b.loggedOutCallback&&b.loggedOutCallback(a);this.__launchAppMonitor(a)}})}({FastClick:m["@FastClick"],IMQ:m["@IMQ"],UiCore:m["@UiCore"],ActivityHelper:Ya,AppMonitor:cb,BrowserInfo:wb,ContextMenuManager:Wa,CookieManager:eb,CounterHelper:Ta,DataUrlCache:Gb,DialogManager:Bb,dictionary:m["json!@globalDictionary"],GlobalVariablesManager:La,GoogleAnalytics:ib,handlebarsHelperIfEqual:fb,handlebarsHelperPlatform:Db,HistoryManager:Q,ImageManager:Va,ImqStatus:Pa,JQueryExpectElement:Ib,Leanplum:zb,LocalStorageManager:yb,LoggedInFeatureAccessManager:Za,LoggedOutFeatureAccessManager:P,LoginManager:ub,LoginSentinel:db,MobileBrowser:z,ModeManager:R,Moment:ab,MultiGetManager:xb,NullPrefsManager:Eb,OnlineHelper:bb,PerfReportManager:Hb,PrefsManager:J,protocolLinksManager:lb,RestCacheManager:vb,SceneManager:pb,SmartAdHelper:Sa,StringManager:O,SubscriptionManager:Ra,TimestampHelper:Na,TooltipLayer:Cb,touchEventHelper:Qa,UrlHelpers:Ab,UrlManager:Ma,VcoinHelper:Fb,WAFUiEventReporter:N,WebGL:hb}),Kb=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e;c='<div class="diagnostics-title">\n    <div class="system-info-header">Diagnostics</div>\n    <div class="font-mono color-pumice">next.can_see_diagnostics</div>\n</div>\n\n<div>\n    <div>Northstar instances: <span class="northstar-instance-count">';if((a=(e=a.northstarInstanceCount||b&&b.northstarInstanceCount,"function"===typeof e?e.call(b,{name:"northstarInstanceCount",hash:{},data:d}):e))||0===a)c+=a;return c+"</span></div>\n</div>\n"},useData:!0})}({}),Lb=function(h){var b=h.UiCore.UiContext;return b.extend("Diagnostics",{className:"diagnostics",uiContextName:"diagnostics",initialize:function(a){b.prototype.initialize.call(this,a);this.addToDOM();this.__northstarInstanceCount=0},render:function(){this.__serviceProvider.has("featureAccessManager")&&(this.__serviceProvider.get("featureAccessManager").canSeeDiagnostics()?(this.show(),this.$el.html(h.template({northstarInstanceCount:this.__northstarInstanceCount||"0"}))):this.hide())},bumpNorthstarInstances:function(a){this.__northstarInstanceCount+=a;this.render()}})}({UiCore:m["@UiCore"],template:Kb}),Mb=function(h){return h.HistoryManager.extend("HistoryManager",_.extend({dependencies:["modeManager","restModelFactory","siteRoot","timer","window"],__setState:function(b,a){var c=this.__window.document.title,d=this.__siteRoot+b.mode.id+"/";b.fragment&&(d+=b.fragment+"/");this.__window.location.search&&(d+=this.__window.location.search);b.replace||++this.__currentStateIndex;b=this.__prepareStateForStorage(b);b.index=this.__currentStateIndex;b.sessionId=this.__sessionId;try{this.__window.history[a](_.clone(b),c,d)}catch(e){}this.trigger("stateChange")}},Backbone.Events))}({Model:m["@Model"],UiCore:m["@UiCore"],HistoryManager:Q}),Nb=function(h){return IMVU.BaseClass.extend("IconManager",{dependencies:["iconLibrary","window"],initialize:function(b){this.__serviceProvider=b.serviceProvider;this.__window=b.window;this.__containerParent=IMVU.optionalProperty(b,"parent",this.__window.document.body);Handlebars.registerHelper("icon",this.handlebarsHelper.bind(this));this.$__svgContainer=$("<div></div>");this.$__svgContainer.addClass("svg-icon-container");this.$__svgContainer.html(b.iconLibrary);$(this.__containerParent).prepend(this.$__svgContainer)},getListOfSymbols:function(){var b=[];this.$__svgContainer.find("svg > defs > symbol").each(function(a,c){b.push(c.id)});return b.sort()},iconHtml:function(b,a){var c="";a?(a.hash.class=a.hash.class?a.hash.class+(" "+b):b,c=" "+Object.keys(a.hash).map(function(d){return d+'="'+a.hash[d]+'"'}).join(" ")):c=' class="'+b+'"';b=this.$__svgContainer.find("svg > defs > symbol#"+b);b.attr("width")&&(c+=' width="'+b.attr("width")+'"');b.attr("height")&&(c+=' height="'+b.attr("height")+'"');b.attr("viewBox")&&(c+=' viewBox="'+b.attr("viewBox")+'"');b=b.html();return"<svg"+c+">"+b+"</svg>"},handlebarsHelper:function(b,a){return this.iconHtml(b,a)}})}({}),Ob=function(h){return IMVU.BaseClass.extend("WindowMessageManager",{dependencies:"dialogManager historyManager loginManager modelCache modeManager Promise rest window".split(" "),initialize:function(b){this.__dialogManager=b.dialogManager;this.__historyManager=b.historyManager;this.__loginManager=b.loginManager;this.__modelCache=b.modelCache;this.__modeManager=b.modeManager;this.__Promise=b.Promise;this.__rest=b.rest;this.__window=b.window;this.__window.addEventListener("message",this.__receiveMessage.bind(this),!0)},__receiveMessage:function(b){if("iframe_switching_submodes"===b.data.message)if("external_click"===b.data.action)this.__modeManager.openMode({mode:{id:b.data.mode.id},submode:{id:b.data.submode.id}});else{var a=b.data.submode.id;"__default__"===b.data.submode.id&&(a="");this.__historyManager.setState({fragment:a,mode:{id:b.data.mode.id},submode:{id:b.data.submode.id}})}else"iframe_switching_mode_and_submode"===b.data.message?this.__modeManager.openMode({mode:{id:b.data.params.mode.id},submode:{id:b.data.params.submode.id}}):"iframe_open_new_window"===b.data.message?this.__window.open(b.data.params.url,b.data.params.name?b.data.params.name:"_blank"):"click"===b.data.message&&h.NextUtil.DomHelper.dismissAllDismissibles()}})}({NextUtil:m["@NextUtil"],UiCore:m["@UiCore"]}),Pb=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e;c=a.helperMissing;var f='<form class="login_fb_banned_form" name="login_fb_banned_form" method="GET" class="login_fb_banned">\n    <div class="label banned_exclamation">',g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_fb_banned_exclamation",{name:"i18n-g",hash:{},data:d}));if(g||0===g)f+=g;f+='</div>\n    <div class="label banned_explanation">';if((g=(e=a["i18n-g"]||b&&b["i18n-g"]||c,e.call(b,"login_fb_banned_explanation",{name:"i18n-g",hash:{},data:d})))||0===g)f+=g;return f+"</div>\n</form>\n"},useData:!0})}({}),Qb=function(h){var b=h.Dialogs.AlloyModalDialog;return b.extend("LoginFBBannedDialog",h.Mixin.mixin({uiContextName:"login_fb_banned_dialog",className:"login-fb-banned-dialog dialog-type-B-flexible",dependencies:["dialogManager","globalStringManager","loginManager","modeManager","window"],trackedEvents:function(){return[{type:"click",selector:".id-email",name:"login_with_email",handler:"__onClickEmail"},{type:"click",selector:".id-fb",name:"register_with_facebook",handler:"__onClickFB"}]},initialize:function(a){this.__dialogManager=a.dialogManager;this.title=a.globalStringManager.get("login_fb_error_choose");this.hasCloseButton=_.isUndefined(a.hasCloseButton)?!0:a.hasCloseButton;b.prototype.initialize.call(this,a);this.__socialLogin="undefined"!==typeof a.socialLogin?a.socialLogin:this.__loginManager.getSocialLogin();this.__socialLogin.logout();this.addToDOM()},postRender:function(){this.setContent("body",h.template,{})}},h.InputMixin))}({Dialogs:m["@Dialogs"],NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],InputMixin:B,LoginDialog:L,Mixin:C,template:Pb}),E=function(h){return{NAG_WINDOW_THRESHOLD:864e6,GOLD_BAR_THRESHOLD:864e6,NEW_USER_GOLD_BAR_THRESHOLD:1,NEW_USER_NAG_WINDOW_THRESHOLD:1,CP:{flags:{EVER_OPTED_IN:"next.notifications.has_ever_opted_in",FRIEND_REQUESTS:"next.notifications.friend_requests",NEW_CHAT_INVITE_FRIENDS:"next.notifications.new_chat_invites_from_friends",NEW_CHAT_INVITE_ALL:"next.notifications.new_chat_invites_from_anyone",NEW_MESSAGES:"next.notifications.new_messages",NEW_FEED_COMMENTS:"next.notifications.new_feed_comments",NEW_FEED_LIKES:"next.notifications.new_feed_likes",NEW_VCOIN_GIFTS:"next.notifications.new_vcoin_gift_received",NEW_CREDIT_GIFTS:"next.notifications.new_credit_gift_received",NEW_PRODUCT_GIFTS:"next.notifications.new_product_gift_received",NEW_PAYME:"next.notifications.new_payme_received",DAILY_SPIN:"next.notifications.daily_spin",EARNED_CREDITS:"next.notifications.earned_credits",SCHEDULED_EVENTS:"next.notifications.scheduled_events"},TIMESTAMP_SAW_GOLD_BAR:"next.notifications.timestamp_saw_gold_bar",TIMESTAMP_DISMISSED_NAG_WINDOW:"next.notifications.timestamp_dismissed_nag_window",CUSTOMIZED_NAG_WINDOW_THRESHOLD:"next.notifications.customized_nag_window_threshold"},SD_DAYS_SINCE_REGISTRATION:"daysSinceRegistration",saveTimestamp:function(b,a){var c=(new Date).toISOString();b.set(a,c)},saveTimestampSawGoldBar:function(b){this.saveTimestamp(b,this.CP.TIMESTAMP_SAW_GOLD_BAR)},saveTimestampDismissedNagWindow:function(b){this.saveTimestamp(b,this.CP.TIMESTAMP_DISMISSED_NAG_WINDOW)},isoTimestampToMilliseconds:function(b){return+new Date(b)},getTimestampSawGoldBar:function(b){return this.isoTimestampToMilliseconds(b.get(this.CP.TIMESTAMP_SAW_GOLD_BAR))},getTimestampDismissedNagWindow:function(b){return this.isoTimestampToMilliseconds(b.get(this.CP.TIMESTAMP_DISMISSED_NAG_WINDOW))},getDaysSinceRegistration:function(b){return b.get(this.SD_DAYS_SINCE_REGISTRATION)},optIn:function(b){for(var a=$jscomp.makeIterator(_.values(this.CP.flags)),c=a.next();!c.done;c=a.next())b.setBool(c.value,!0)},validatePrefName:function(b){if(!_.values(this.CP.flags).includes(b)){var a=_.values(this.CP.flags).join(", ");throw Error("unrecognized pref name: "+IMVU.repr(b)+". valid prefs are: "+a)}},setBool:function(b,a,c){if("boolean"!==typeof c)throw Error("setBool value must be a boolean. got "+typeof c+": "+IMVU.repr(c));this.validatePrefName(a);window.console.log("Set DARN pref",a,c);b.setBool(a,c)},getBool:function(b,a){this.validatePrefName(a);b=b.getBool(a);window.console.log("Get DARN pref",a,b);return b},getInt:function(b,a){return b.getInt(a)},isTimeToShowGoldBar:function(b){var a=b.timestampDismissedNagWindow,c=b.timestampSawGoldBar,d=b.timestampNow;return b.hasEverOptedIn||a&&d-a<this.NAG_WINDOW_THRESHOLD||c&&d-c<this.GOLD_BAR_THRESHOLD?!1:b.daysSinceRegistration>=this.NEW_USER_GOLD_BAR_THRESHOLD},isTimeToShowNagWindow:function(b){var a=b.timestampDismissedNagWindow,c=b.timestampNow,d=b.customizedNagWindowThreshold;return b.hasEverOptedIn||a&&c-a<(864e5*d||this.NAG_WINDOW_THRESHOLD)?!1:b.daysSinceRegistration>=this.NEW_USER_NAG_WINDOW_THRESHOLD}}}({}),Rb=function(h){var b=h.OnboardingGamificationManagerTasks.onboarding_tasks,a=h.UiCore.UiContext;return a.extend("OnboardingGamificationManager",{uiApplication:"alloy",uiContextName:"onboarding_gamification_manager",dependencies:"featureAccessManager globalStartupModel localStorage loginManager prefsManager rest root serviceProvider window".split(" "),initialize:function(c){var d=this;a.prototype.initialize.call(this,c);this.__experimentGroup=null;this.__ftuxRewards={};this.__completedTasks=[];this.__myself=null;this.__isShown=!0;this.__globalStartupModel.populated().then(function(){d.__featureAccessManager.canSeeOnboardingGamification()&&(d.__localStorage.getItem("onboardingGamification.forceGroup")?d.__experimentGroup=d.__localStorage.getItem("onboardingGamification.forceGroup"):d.__experimentGroup=d.__globalStartupModel.get("onboardingGamificationGroup"),d.__ftuxRewards=JSON.parse(d.__globalStartupModel.get("onboardingGamificationFTUXRewards")),d.__loginManager.isLoggedIn()&&(d.__myself=d.__loginManager.getCurrentUser(),d.__myself.populated().then(function(){return d.updateCompletedTasks()})))})},getGroup:function(){this.__logActivity("in branch '"+this.__experimentGroup+"'");return this.__experimentGroup},getFTUXRewards:function(){var c=this.__ftuxRewards[this.__experimentGroup];this.__logActivity("FTUX rewards:",Object.assign({},c));return c},updateCompletedTasks:function(){var c=this;return new this.__Promise(function(d){c.__rest.get(c.__root+"/tutorial_reward").then(function(e){e.response.types&&(c.__completedTasks=[].concat($jscomp.arrayFromIterable(e.response.types)),c.__logActivity("Completed tasks updated:",Object.assign({},c.__completedTasks)),c.trigger("tasks:updated"));d.resolve()}).catch(function(e){d.reject(e);c.__error(e)})})},getTasks:function(){return b},getIncompleteTasks:function(){var c=this,d=b.filter(function(e){return!c.__completedTasks.includes(e.name)});this.__logActivity("Incomplete tasks:",Object.assign({},d));return d},getCompletedTasks:function(){this.__logActivity("Completed tasks:",Object.assign({},this.__completedTasks));return this.__completedTasks},getCompletedPhaseOneTasks:function(){var c=this,d=b.filter(function(f){return!0===f.phase_one}),e=d.filter(function(f){return c.__completedTasks.includes(f.name)});d=d.filter(function(f){return!c.__completedTasks.includes(f.name)});this.__logActivity("Completed phase 1 tasks:",Object.assign({},e),"Incomplete:",Object.assign({},d));return e},isTaskCompleted:function(c){var d=this.__completedTasks.includes(c);this.__logActivity("Task '"+c+"' is "+(d?"complete":"incomplete"));return d},handleTaskCompletion:function(c,d){var e=this;this.isTaskCompleted(c)||(this.__completedTasks.push(c),this.__loginManager.isLoggedIn()?this.__rest.post(this.__root+"/tutorial_reward",{event_type:c}).then(function(f){e.trigger("task:complete",Object.assign({},{task:c},f));d&&d();e.__logActivity("Task '"+c+"' completed")}).catch(function(f){return e.__error(f)}):(this.trigger("task:complete",{task:c}),this.__logActivity("Task '"+c+"' completed")))},__recordLoggedInEvent:function(c){var d=this;this.__myself?this.__recordEvent("onboarding",{name:"grant_reward",event_type:c,cid:this.__myself.get("legacy_cid"),record:!0}):(this.__myself=this.__loginManager.getCurrentUser(),this.__myself.populated().then(function(){d.__recordEvent("onboarding",{name:"grant_reward",event_type:c,cid:d.__myself.get("legacy_cid"),record:!0})}))},__massageTheState:function(){"function"===typeof this.__prefsManager.getInt&&this.isTaskCompleted("dashboard_complete")&&5>this.__prefsManager.getInt("next.onboarding.dashboard_step")&&(this.__prefsManager.setInt("next.onboarding.dashboard_step",5),this.__prefsManager.setInt("next.onboarding.chat_step",3),this.__prefsManager.setInt("next.onboarding.dressup_step",2),this.__prefsManager.setInt("next.onboarding.shop_step",2))},getModeStep:function(c){var d=0;this.__massageTheState();"function"===typeof this.__prefsManager.getInt&&(d=this.__prefsManager.getInt("next.onboarding."+c+"_step"),d||(this.__prefsManager.setInt("next.onboarding."+c+"_step",0),d=0));return d},setModeStep:function(c,d){this.__prefsManager.setInt("next.onboarding."+c+"_step",d);this.__logActivity("Updated '"+c+"' mode to step '"+d+"'");this.trigger("mode:set",{mode:c,step:d})},getPhaseOneStep:function(){return 2>this.getModeStep("shop")?"shop":2>this.getModeStep("dressup")?"dressup":3>this.getModeStep("chat")?"chat":9===this.getCompletedPhaseOneTasks().length?"home":null},__error:function(c){this.__localStorage.getItem("onboardingGamification.debug")&&this.__window.console.error("ERROR: Onboarding Gamification Service Provider:",c)},__logActivity:function(){this.__localStorage.getItem("onboardingGamification.debug")&&this.__window.console.log.apply(this.__window.console,["INFO: Onboarding Gamification:"].concat($jscomp.arrayFromIterable(arguments)))},_setCompletedTasks:function(c){var d=this;this.__completedTasks=[].concat($jscomp.arrayFromIterable(c));c.forEach(function(e){return d.trigger("task:complete",{task:e})})}})}({UiCore:m["@UiCore"],NotificationsHelper:E,OnboardingGamificationManagerTasks:m["json!/common/withme/js/manager/OnboardingGamificationManagerTasks.json"]}),Sb=function(){var h=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return h({compiler:[5,">= 2.0.0"],main:function(b,a,c,d){var e;c=a.helperMissing;var f=this.escapeExpression,g='<div class="bar-icon-hitbox bar-info">',k=(e=a.icon||b&&b.icon||c,e.call(b,b&&b.barIcon,{name:"icon",hash:{},data:d}));if(k||0===k)g+=k;g+=' </div>\n<div class="bar-message">\n    <div class="bar-title">'+f((k=b&&b.__barItemTitle,"function"===typeof k?k.apply(b):k))+'</div>\n    <div class="bar-text">'+f((k=b&&b.__barItemText,"function"===typeof k?k.apply(b):k))+'</div>\n</div>\n<div class="bar-icon-hitbox bar-dismiss">';if((k=(e=a.icon||b&&b.icon||c,e.call(b,"icon-close",{name:"icon",hash:{},data:d})))||0===k)g+=k;return g+"</div>"},useData:!0})}({}),Tb=function(h){var b=h.UiCore.UiContext,a=h.NotificationsHelper,c={YELLOW_SERVICE:"yellow_service",YELLOW_CS:"yellow_cs",GOLD_BAR:"gold_bar",SLOW_NETWORK:"slow_network",PERFORMANCE_ALERT:"performance_alert",PURPLE_EVENT:"purple_event"};return b.extend("NotificationBarItem",{className:"bar-item",uiContextName:"bar_item",dependencies:["localStorage","prefsManager","timestampHelper"],trackedEvents:function(){return[{type:"click",selector:".bar-dismiss",name:"bar_dismiss",handler:this.__onDismiss.bind(this)},{type:"click",selector:".notification-bar-link",name:"bar_link",handler:this.__handleGoldBarLink.bind(this)}]},initialize:function(d){b.prototype.initialize.call(this,d);this.__barItemTitle=d.barItemTitle;this.__barItemText=d.barItemText;this.__barType=d.barType;this.__barIcon=this.__barType===c.PURPLE_EVENT?"icon-event_bar":"icon-notification-bar-info";this.addToDOM()},render:function(){this.$el.html(h.template({barIcon:this.__barIcon}));this.$(".bar-title").text(this.__barItemTitle);this.$(".bar-text").text(this.__barItemText);switch(this.__barType){case c.YELLOW_SERVICE:case c.YELLOW_CS:this.$el.addClass("service-bar");this.$(".bar-text").linkify({target:"_blank"});break;case c.GOLD_BAR:this.$(".bar-text").html(this.__barItemText);this.$el.addClass("gold-bar");break;case c.PURPLE_EVENT:this.$el.addClass("event-bar");this.__localStorage.setItem("eventNotificationBarText",this.__barItemText);this.$(".bar-text").linkify({target:"_blank"});break;case c.PERFORMANCE_ALERT:this.$el.addClass("performance-bar");this.$(".bar-text").html(this.__barItemText);this.$el.addClass("error-bar");break;case c.SLOW_NETWORK:this.$el.addClass("error-bar");break;default:this.$el.removeClass("service-bar"),this.$el.removeClass("gold-bar"),this.$el.removeClass("event-bar"),this.$el.removeClass("error-bar")}},setText:function(d){this.__barItemText=d;this.addToDOM()},showBar:function(){this.__barType===c.GOLD_BAR&&a.saveTimestampSawGoldBar(this.__prefsManager);this.$el.removeClass("hidden")},__onDismiss:function(){switch(this.__barType){case c.YELLOW_SERVICE:this.__localStorage.setItem("yellowServiceBarDismissed",1e3*this.__timestampHelper.now().unix());break;case c.YELLOW_CS:this.__localStorage.setItem("yellowCSBarDismissed",1e3*this.__timestampHelper.now().unix());break;case c.SLOW_NETWORK:this.trigger("dismissed:slow-network-bar"),this.__parentUiContext.trigger("dismissed:slow-network-bar")}this.$el.addClass("hidden")},_dismiss:function(){this.__onDismiss()},__handleGoldBarLink:function(){this.$el.addClass("hidden");a.optIn(this.__prefsManager);this.__serviceProvider.get("uiEventReporter").recordEvent("app",this.__getUiPlatform(),"parent.notification_bar","DARN_gold_bar")}},{BARS:c})}({UiCore:m["@UiCore"],NotificationsHelper:E,template:Sb}),Ub=function(){return IMVU.BaseClass.extend("TargetingHelper",{dependencies:["browserInfo","featureAccessManager","platform","window"],initialize:function(h){this.__featureAccessManager=h.featureAccessManager;this.__browserInfo=h.browserInfo;this.__window=h.window;this.__platform=h.platform;h.userPlatform?this.__userPlatform=h.userPlatform:this.__featureAccessManager.isElectronClient()?this.__userPlatform="desktop":this.__userPlatform="mobile"===this.__platform?"web_small":"web_big";h.userOS?this.__userOS=h.userOS:(this.__userOS=this.__browserInfo.getMobileOS(),this.__userOS="unknown"===this.__userOS?this.__browserInfo.getOS():this.__userOS);h.userVersion?this.__userVersion=h.userVersion:this.__featureAccessManager.isElectronClient()&&(this.__electron=this.__window.electronRequire("electron"),this.__electronRemote=this.__window.electronRequire("@electron/remote"),this.__userVersion=this.__electron&&this.__electronRemote&&this.__electronRemote.app?this.__electronRemote.app.getVersion():this.__electron&&this.__electronRemote&&this.__electronRemote.remote.app?this.__electronRemote.remote.app.getVersion():"")},isWithinTargeting:function(h){if(!h||_.isEmpty(h))return!0;var b=h.minVersion,a=h.maxVersion,c=h.versions,d=h.platform,e=h.os;h=(h=this.isTargetedPlatform(d))&&this.isTargetedOS(e);if(d||e){var f=!0;d&&(d=d.replace(/\s/g,"").toLowerCase().split(","),f=f&&d.includes("desktop"));e&&(d=e.replace(/\s/g,"").toLowerCase().split(","),f=f&&(d.includes("windows")||d.includes("mac")));f&&(h=h&&this.isTargetedVersion(c,b,a))}else if(this.__featureAccessManager.isElectronClient())h=this.isTargetedVersion(c,b,a);else return!1;return h},isTargetedPlatform:function(h){return h?h.replace(/\s/g,"").toLowerCase().split(",").includes(this.__userPlatform):!0},isTargetedOS:function(h){return h?h.replace(/\s/g,"").toLowerCase().split(",").includes(this.__userOS.toLowerCase()):!0},isTargetedVersion:function(h,b,a){if(!this.__featureAccessManager.isElectronClient()||!h&&!b&&!a)return!0;var c=this.__userVersion.split("."),d=!1,e=!1;if(h){h=h.replace(/\s/g,"").split(",");h=$jscomp.makeIterator(h);for(var f=h.next();!f.done;f=h.next())if(f=f.value.split("."),!f||3===f.length){for(var g=!0,k=0;k<c.length;k++)if("x"!==f[k]&&f[k]!==c[k]){g=!1;break}d=d||g}}if(b||a){h=e=!0;if(b&&(b=b.split("."),3===b.length))for(e=!1,f=0;f<c.length;f++)if(g=parseInt(b[f]),k=parseInt(c[f]),g<k){e=!0;break}else if(g>k)break;else if(f===c.length-1){e=!0;break}if(a&&(a=a.split("."),3===a.length))for(h=!1,b=0;b<c.length;b++)if(f=parseInt(a[b]),g=parseInt(c[b]),f>g){h=!0;break}else if(f<g)break;else b===c.length-1&&(h=!0);e=e&&h}return d||e}})}({}),Vb=function(h){var b=h.UiCore.UiContext,a=h.NotificationsHelper;return b.extend("NotificationBar",{className:"notification-bar",uiContextName:"notification_bar",dependencies:"browserInfo featureAccessManager globalStartupModel globalStringManager localStorage loginManager modeManager platform prefsManager timer timestampHelper urlManager window".split(" "),initialize:function(c){b.prototype.initialize.call(this,c);if(!this.__featureAccessManager.isInDollarStoreIframe()){this.__barItem=h.BarItem;this.__globalStartupModel=this.track(c.globalStartupModel);this.__webGLInfo=c.webGLInfo||h.WebGLInfo();this.__targetingHelper=this.__serviceProvider.create(h.TargetingHelper);this.__performanceBarItem=null;this.__performanceBarTitle=this.__globalStringManager.get("performance_alert_title");this.__performanceBarText=this.__globalStringManager.get("performance_alert_tip");this.__yellowServiceBarItem=this.__redBarItem=null;this.__showYellowServiceBar=[!0,"true",1,"1"].includes(this.__globalStartupModel.get("showYellowServiceBar"));this.__yellowServiceBarText=this.__globalStartupModel.get("yellowServiceBarText");try{this.__yellowServiceBarTarget=JSON.parse(this.__globalStartupModel.get("yellowServiceBarTarget"))}catch(d){this.__yellowServiceBarTarget={}}this.__yellowCSBarItem=null;this.__showYellowCSBar=[!0,"true",1,"1"].includes(this.__globalStartupModel.get("showYellowCSBar"));this.__yellowCSBarText=this.__globalStartupModel.get("yellowCSBarText");try{this.__yellowCSBarTarget=JSON.parse(this.__globalStartupModel.get("yellowCSBarTarget"))}catch(d){this.__yellowCSBarTarget={}}this.__goldBarItem=null;this.__goldBarTitle=this.__globalStringManager.getWithDefault("gold_optIn_bar_title","Opt in for notifications");this.__goldBarText=this.__globalStringManager.getWithDefault("gold_optIn_bar_text","<a class='notification-bar-link'>Click here</a> to receive notifications to keep up to date with your friends!");this.__eventNotificationBarItem=null;this.__showEventNotificationBar=[!0,"true",1,"1"].includes(this.__globalStartupModel.get("showEventBar"));this.addToDOM();this.__maybeShowServiceBars();this.__maybeShowPerformanceAlert();this.__featureAccessManager.forceShowSlowInternetErrorBar()&&this.toggleRedBar(!1,this.__globalStringManager.get("slow_internet_title"),this.__globalStringManager.get("slow_internet_tip"));this.__maybeShowGoldBar();this.__maybeShowEventBar();this.__maybeShowBrowserBar();"mobile"===this.__platform&&(this.__globalNav=this.__serviceProvider.get("globalNav"),this.listenTo(this.__globalNav,"globalNav:drawerToggle",this.__toggleHidden.bind(this)))}},__toggleHidden:function(c){this.$el.toggleClass("hidden",c)},__maybeShowServiceBars:function(){this.__maybeShowYellowCSBar();this.__maybeShowYellowServiceBar()},__maybeShowPerformanceAlert:function(){if("mobile"!==this.__platform&&!this.__webGLInfo.canCompileShader||this.__featureAccessManager.forceShowPerformanceErrorBar())this.__performanceBarItem||(this.__performanceBarItem=this.createChildContext(this.__barItem,{$parentElement:this.$el,barItemTitle:this.__performanceBarTitle,barItemText:this.__performanceBarText,barType:this.__barItem.BARS.PERFORMANCE_ALERT})),this.__performanceBarItem.showBar()},__maybeShowYellowServiceBar:function(){if((this.__showYellowServiceBar||this.__featureAccessManager.forceShowYellowServiceBar())&&this.__targetingHelper.isWithinTargeting(this.__yellowServiceBarTarget)){var c=parseInt(this.__localStorage.getItem("yellowServiceBarDismissed"));this.__timestampHelper.sameDay(this.__timestampHelper.preMultipliedNowInUnix(),c)||(this.__yellowServiceBarItem||(this.__yellowServiceBarItem=this.createChildContext(this.__barItem,{$parentElement:this.$el,barItemTitle:"",barItemText:this.__yellowServiceBarText,barType:this.__barItem.BARS.YELLOW_CS})),this.__yellowServiceBarItem.showBar())}},__maybeShowYellowCSBar:function(){if((this.__showYellowCSBar||this.__featureAccessManager.forceShowYellowCSBar())&&this.__targetingHelper.isWithinTargeting(this.__yellowCSBarTarget)){var c=parseInt(this.__localStorage.getItem("yellowCSBarDismissed"));this.__timestampHelper.sameDay(this.__timestampHelper.preMultipliedNowInUnix(),c)||(this.__yellowCSBarItem||(this.__yellowCSBarItem=this.createChildContext(this.__barItem,{$parentElement:this.$el,barItemTitle:"",barItemText:this.__yellowCSBarText,barType:this.__barItem.BARS.YELLOW_CS})),this.__yellowCSBarItem.showBar())}},__maybeShowGoldBar:function(){this.__loginManager.isLoggedIn()&&this.__featureAccessManager.canSeeDesktopNotifications()&&this.__loginManager.getCurrentUser().populated().then(function(){return this.__prefsManager.populated()}.bind(this)).then(function(){var c=a.getBool(this.__prefsManager,a.CP.flags.EVER_OPTED_IN),d=a.getTimestampDismissedNagWindow(this.__prefsManager),e=a.getTimestampSawGoldBar(this.__prefsManager),f=Date.now(),g=a.getDaysSinceRegistration(this.__globalStartupModel);a.isTimeToShowGoldBar({hasEverOptedIn:c,timestampDismissedNagWindow:d,timestampSawGoldBar:e,timestampNow:f,daysSinceRegistration:g})&&(this.__goldBarItem||(this.__goldBarItem=this.createChildContext(this.__barItem,{$parentElement:this.$el,barItemTitle:this.__goldBarTitle,barItemText:this.__goldBarText,barType:this.__barItem.BARS.GOLD_BAR})),this.__goldBarItem.showBar())}.bind(this))},__maybeShowBrowserBar:function(){if(!this.__featureAccessManager.isMobile()&&!this.__featureAccessManager.isElectronClient()){var c=this.__browserInfo.getBrowserValidation(),d=null;c.validBrowser&&c.validBrowserVersion||(d=this.__globalStringManager.get("browser_invalid")+" <a className='notification-bar-link' href='"+this.__urlManager.get("google_chrome_download")+"' target='_blank'>"+this.__globalStringManager.get("common_here")+"</a>.");null!==d&&(this.__browserYellowBarItem=this.createChildContext(this.__barItem,{$parentElement:this.$el,barItemTitle:"",barItemText:d,barType:this.__barItem.BARS.PERFORMANCE_ALERT}),this.__browserYellowBarItem.showBar())}},showGoldBar:function(){this.__featureAccessManager.canSeeDesktopNotifications()&&this.__maybeShowGoldBar()},showTimedRedBar:function(c){var d=this;this.hideTimedRedBar();var e=IMVU.requireProperty(c,"title"),f=IMVU.requireProperty(c,"text");c=IMVU.requireProperty(c,"timeoutMilliseconds");this.toggleRedBar(!1,e,f);this.__timer.clearTimeout(this.redBarTimeout);this.redBarTimeout=this.__timer.setTimeout(function(){d.hideTimedRedBar()},c)},hideTimedRedBar:function(){this.toggleRedBar(!0);this.__timer.clearTimeout(this.redBarTimeout);this.__redBarItem.delete();this.__redBarItem=null},toggleRedBar:function(c,d,e){this.__redBarItem||(this.__redBarItem=this.createChildContext(this.__barItem,{$parentElement:this.$el,barItemTitle:d,barItemText:e,barType:this.__barItem.BARS.SLOW_NETWORK}));this.__redBarItem.$el.toggleClass("hidden",c)},__maybeShowEventBar:function(){if(this.__showEventNotificationBar||this.__featureAccessManager.forceShowPurpleEventBar())this.__eventNotificationChangeTimer=this.__timer.setInterval(function(){this.__showEventBarHandler()}.bind(this),6e4)},__showEventBarHandler:function(){var c=this.__globalStartupModel.get("eventBarText");try{var d=JSON.parse(this.__globalStartupModel.get("eventBarTarget"))}catch(e){d={}}this.__localStorage.getItem("eventNotificationBarText")!==c&&this.__targetingHelper.isWithinTargeting(d)&&(this.__eventNotificationBar?this.__eventNotificationBar.setText(c):this.__eventNotificationBar=this.createChildContext(h.BarItem,{$parentElement:this.$el,barItemTitle:"",barItemText:c,barType:h.BarItem.BARS.PURPLE_EVENT}),this.__eventNotificationBar.showBar());"false"===this.__globalStartupModel.get("showEventBar")&&!this.__featureAccessManager.forceShowPurpleEventBar()&&this.__eventNotificationChangeTimer&&this.__timer.clearInterval(this.__eventNotificationChangeTimer);this.__globalStartupModel.invalidate()},delete:function(){this.__eventNotificationChangeTimer&&this.__timer.clearInterval(this.__eventNotificationChangeTimer);b.prototype.delete.call(this)}})}({moment:m["@moment"],UiCore:m["@UiCore"],BarItem:Tb,NotificationsHelper:E,TargetingHelper:Ub,WebGLInfo:S}),Wb=function(h){var b=h.BaseApp;return b.extend("WelcomeApp",{supported_app_paths:["/creatorlanding/"],__synchronousStartupDependencies:function(a){var c=a.serviceProvider;a.historyManagerFactory=h.HistoryManager;c.register("diagnostics",c.create(h.Diagnostics,{$parentElement:$(document.body)}));c.register("externalWindow",a.externalWindow||c.get("window"));c.register("Sha512",h.Sha512);c.register("nextRoot",a.nextRoot);c.register("externalNextRoot",a.externalNextRoot);c.register("isWin5050ExperimentClosed",a.isWin5050ExperimentClosed,!1);c.register("showSurveyPopup",a.showSurveyPopup,"0");b.prototype.__synchronousStartupDependencies.call(this,a);c.get("featureAccessManager").canRenderIframe()&&c.register("windowMessageManager",c.create(a.windowMessageManager||h.WindowMessageManager));a.loginDestination&&this.__registerApplicationName(a.serviceProvider,a.loginDestination);c.get("loginManager").getSocialLogin().setCallbacks({onBanned:function(d){c.get("dialogManager").showDialog(h.LoginFBBannedDialog)},onError:function(d){},onServiceFailure:function(d){c.get("dialogManager").showDialog(h.SocialLoginServiceFailureDialog,{social_login_service:"Facebook"})}})},__registerLoggedOutServices:function(a,c,d){a.instantiateSceneManager=!0;b.prototype.__registerLoggedOutServices.apply(this,[a,c,d]);c.register("iconManager",c.create(h.IconManager,{iconLibrary:h.IconLibrary}));c.register("notificationBar",c.get("modeManager").createChildContext(h.NotificationBar,{$replaceElement:c.get("modeManager").$(".notification-bar-placeholder")}));c.register("onboardingGamificationManager",c.create(h.OnboardingGamificationManager))},__registerApplicationName:function(a,c){c=new IMVU.URI(c);var d=c.getPath();if(-1!==_.indexOf(this.supported_app_paths,d)){a=a.get("modeManager");var e=null,f=null;c.getQuery()&&(e=c.parseQuery());e&&e.params.appId&&1===e.params.appId.length&&(f=encodeURI(e.params.appId[0]));c=d.replace(/[/]/g,"");f&&(c+="_"+f);a.uiApplication=c}},__registerLoggedInServices:function(a,c,d,e){b.prototype.__registerLoggedInServices.apply(this,arguments);c.register("iconManager",c.create(h.IconManager,{iconLibrary:h.IconLibrary}));c.register("onboardingGamificationManager",c.create(h.OnboardingGamificationManager))}})}({Sha512:m["@SHA512"],BaseApp:Jb,Diagnostics:Lb,HistoryManager:Mb,IconLibrary:m["text!@IconLibrary"],IconManager:Nb,LoginFBBannedDialog:Qb,NotificationBar:Vb,OnboardingGamificationManager:Rb,SocialLoginServiceFailureDialog:Ka,WindowMessageManager:Ob}),Xb=function(h){return IMVU.BaseClass.extend("NorthstarLoader",{dependencies:["Promise","timer","window"],initialize:function(b){this.__timer=b.timer;this.__window=b.window;this.__Promise=b.Promise;this.__northstarPackage=new this.__Promise(function(a){module.run({Northstar:"@Northstar"},function(c){c={Northstar:c.Northstar,network:(new c.Northstar.XHRNetwork).deleteLater(),preciseTimer:(new c.Northstar.PreciseTimer).deleteLater(),frameTimer:new c.Northstar.RequestAnimationFrameTimer};a.resolve(c)}.bind(this))}.bind(this))},getNorthstar:function(){return this.__northstarPackage}})}({}),Yb=function(h){var b=h.ModeManager;return b.extend("ModeManager",{initialize:function(a){var c=this;b.prototype.initialize.call(this,a);document.addEventListener("capturedElectronGoLink",function(d){c.openModeFromGoLink(d.detail)})},openModeFromGoLink:function(a){var c=a.url;a=new URL(a.goLink).pathname;var d=$jscomp.makeIterator(a.split("/"));d.next();a=d.next().value;d=d.next().value;c&&fetch(c);a&&(c={mode:{id:a}},d&&(c.submode={id:d}),this.openMode(c))},openModeFromPath:function(a){var c=this;a=_.rest(_.compact(a.split("/")));var d=a[0];a=1<a.length?a[1]:null;if("av"===d){var e=this.__restModelFactory.searchCollection(this.__root+"/user",{username:a},h.UiCore.NodeCollection);e.populated().then(function(){c.__serviceProvider.get("dialogManager").showLightbox("ProfileLightbox",{user:e.at(0)})})}else{if(a&&a.includes("-")&&this.isIdStyleSubmode(a)){var f=a.split("-")[0],g={feed_element:h.Lightboxes.FeedLightbox,product:h.Lightboxes.ProductLightbox,user:h.Lightboxes.ProfileLightbox,room:h.Lightboxes.RoomDetailLightbox};a=[this.__root,f,a].join("/");if(("shop"!==d||"user"!==f)&&g[f]){d=this.getNodeModelForType(f);this.__serviceProvider.get("dialogManager").showDialog(g[f],{model:this.track(this.__restModelFactory.readModel(a,d))});return}}this.openMode({openDefaultView:a?!1:!0,mode:{id:d},submode:{id:a}})}}})}({Lightboxes:m["@Lightboxes"],Model:m["@Model"],UiCore:m["@UiCore"],ModeManager:R}),Zb=function(h){return function(b){-1!==location.host.indexOf("localhost.")&&"true"===localStorage.getItem("forceProduction")&&(b.globalStartupUrl=b.globalStartupUrl.replace(".localhost",""));var a=b.serviceProvider||new h.ServiceProvider;a.register("useEventWhitelist",!0);var c=new h.WelcomeApp;a.register("showFuncaptcha",b.showFuncaptcha);a.register("language",b.language);a.register("registrationFlow",b.registrationFlow);a.register("ftuxNextPageCallback",b.ftuxNextPageCallback);a.register("queryParams",b.params);var d=a.get("Promise");a.register("PromiseResolver",{get:function(){var e;new d(function(f){e=f});return e},getRejected:function(e){var f;new d(function(g){f=g;g.reject(e)});return f},getAccepted:function(e){var f;new d(function(g){f=g;g.accept(e)});return f}});a.register("connectionSpeedTimeout",b.connectionSpeedTimeout);a.register("speedTestImages",b.speedTestImages);a.register("loginDestination",b.loginDestination);a.register("registrationDestination",b.registrationDestination);c.launch(_.extend({serviceProvider:a,LoggedInNavFactory:h.LoggedInNav,loginSentinelFactory:$.noop,applicationName:"welcome",suppressPlatform:!0,UiEventReporterFactory:h.WAFUiEventReporter.extend("WelcomeUiEventReporter",{maxBatchSize:30,maxWaitTime:3e4}),ModeManagerFactory:h.ModeManager.extend("WelcomeModeManager",{uiApplication:"welcome",uiPlatform:"nafd",__makeTitle:function(){return this.__globalStringManager.get("welcome_title")}})},b));a.get("webGL").use3d()&&a.register("northstarLoader",a.create(h.NorthstarLoader))}}({LoggedInNav:M,ModeManager:Yb,NorthstarLoader:Xb,ServiceProvider:Ia,WAFUiEventReporter:N,WelcomeApp:Wb});return function(h){return function(b){b.LoggedOutNavFactory=b.LoggedOutNavFactory||h.LoggedOutGlobalNav;return h.Main.apply(this,arguments)}}({LoggedOutGlobalNav:M,Main:Zb})});