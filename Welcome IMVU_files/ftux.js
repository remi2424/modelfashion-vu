module({"json!/common/withme/i18n/settings.json":"json!/asset/6de7917171955166/common/withme/i18n/settings.json","@Dialogs":"@Dialogs","@WAFWidgets":"@WAFWidgets","json!/common/js/JSON/States.json":"json!/asset/581385bf78983508/common/js/JSON/States.json","@PasswordStrength":"@PasswordStrength","@NextUtil":"@NextUtil","json!/common/js/JSON/Provinces.json":"json!/asset/1e80a06c565197b7/common/js/JSON/Provinces.json","json!@StoreModeDictionary":"json!@StoreModeDictionary","@Model":"@Model","@UiCore":"@UiCore","json!/common/js/JSON/Countries.json":"json!/asset/82bbf3f0be07c92d/common/js/JSON/Countries.json","@Northstar":"@Northstar","@moment":"@moment","css!/build/welcome/mode/desktop/ftux.css":"css!/asset/12d748812b97cd4d/build/welcome/mode/desktop/ftux.css"},function(m){var Y=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){return'<div class="canvas-container"><canvas width="1024" height="768"></canvas></div>\n'},useData:!0})}({}),Z=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){return'<div class="progress">\n    <div class="bar">\n        <div class="value"></div>\n        <div class="percentage"></div>\n    </div>\n    <div class="border"></div>\n</div>\n'},useData:!0})}({}),C=function(k){var b=k.UiCore.UiContext;return b.extend("LoadingProgress",{uiContextName:"loading_progress",className:"loading-progress",dependencies:"dialogManager globalStringManager progressPromises Promise timer window".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__timer=a.timer;this.__lingerTime=a.lingerTime||500;this.finished=new a.Promise(function(e){this.__finishedResolver=e}.bind(this));var d=a.weighting||_.map(_.range(this.__progressPromises.length),function(){return 1}.bind(this));this.__initTime=+new Date;this.__progressControls=_.map(this.__progressPromises,function(e,c){return{promise:e,weight:d[c],progress:0}}.bind(this));this.__progressTotal=_.reduce(this.__progressControls,function(e,c){return e+c.weight}.bind(this),0);this.addToDOM();this.__updateBar=this.__createUpdateBarFunction();_.each(this.__progressControls,function(e){e.promise.then(this.__onProgress.bind(this),this.__onProgress.bind(this))}.bind(this));this.__onProgress()},delete:function(){this.__timer.clearTimeout(this.__timeoutFade);this.__timer.clearTimeout(this.__timeoutDelete);b.prototype.delete.call(this)},render:function(){this.$el.html(k.template).addClass("animated");this.$(".percentage").show()},partialProgress:function(a,d){"pending"===this.__progressControls[a].promise.state&&(this.__progressControls[a].progress=d,this.__onProgress())},passive:function(){this.$el.addClass("passive")},__onProgress:function(){var a=_.reduce(this.__progressControls,function(d,e){"pending"!==e.promise.state&&(e.progress=1);return d+e.progress*e.weight},0);this.__updateBar(a/this.__progressTotal);a===this.__progressTotal&&this.__finish()},__finish:function(){this.__finishedResolver.accept();this.__timer.clearTimeout(this.__timeout);this.__timeoutFade=this.__timer.setTimeout(function(){this.$el.fadeOut(.25*this.__lingerTime)}.bind(this),.75*this.__lingerTime);this.__timeoutDelete=this.__timer.setTimeout(this.delete.bind(this),this.__lingerTime);this.trigger("timeCompleted",+new Date-this.__initTime)},__createUpdateBarFunction:function(){this.$(".percentage").show();return function(a){var d=this;this.__window.requestAnimationFrame(function(){d.$(".value").css("width",100*a+"%");d.$(".percentage").text(d.__globalStringManager.get("loading_bar_text",{percentage:Math.floor(100*a)}))})}.bind(this)}})}({NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],template:Z}),aa=function(k){return k.Northstar.Network.extend("WrappedNetwork",{__construct:function(b){this.__parent.__construct.call(this);this.__northstar=b.ns;this.__network=new this.__northstar.XHRNetwork},setTimeout:function(b){this.__network.setTimeout(b)},GET:function(b,a,d,e){a&&a.toString().includes("creator_assetserver")&&(b=b||{},b.withCredentials=!0);return this.__network.GET(b,a,d,e)}})}({Northstar:m["@Northstar"]}),ba=function(k){var b=k.UiCore.UiContext;return b.extend("NorthstarModule",{uiContextName:"northstar_module",className:"northstar-module",dependencies:"diagnostics globalStartupModel prefsManager Promise timer window".split(" "),initialize:function(a){var d=this;a=void 0===a?{}:a;b.prototype.initialize.call(this,a);this.loadingBarPromise=new this.__Promise(function(f){d.loadingBarPromiseResolver=f});this.__diagnostics.bumpNorthstarInstances(1);this.__prefsManager.populated().then(function(){var f=this.__prefsManager.get("next.northstarLoggingPrefs");this.__loggingPref=f?f.split(","):[]}.bind(this));this.__northstar=k.Northstar;this.__globalStartupModel.get("id")&&this.__globalStartupModel.get("id").includes("creator")?this.__network=new k.WrappedNetwork({ns:this.__northstar}):this.__network=new this.__northstar.XHRNetwork;this.__preciseTimer=new this.__northstar.PreciseTimer;this.__frameTimer=new this.__northstar.RequestAnimationFrameTimer;this.__prefsManager.populated().then(function(){var f=d.__prefsManager.getBool("next.high_fps_mode")?60:30;window.console.log("Target frame rate",f,"FPS");d.__frameTimer.setTargetFrameRate(f)});this.__document=a.document||document;this.addToDOM();new this.__Promise(function(f){this.__logEvents("northstar","got loadedEverything resolver");this.__loadedEverythingResolver=f}.bind(this));a=a.canvas||this.$("canvas");this.canvas=a[0];this.__logEvents("northstar","NorthstarModule.canvas ",a);this.__canvas=a[0];this.__setupInput();a[0].id="northstar-canvas-"+Date.now().toString();this.__gl=new this.__northstar.WebGL(a[0].id);var e=new this.__northstar.WebGLGraphicsConduit(this.__gl).deleteLater(),c=new this.__northstar.HttpConduit(this.__network).deleteLater(),g=this.__globalStartupModel.get("polarisUrl");this.scaleHDPi=1;this.__session3dAggregate=this.__northstar.Session3dAggregate.create(e,c,g,this.__preciseTimer,a[0].scrollWidth,a[0].scrollHeight,this.scaleHDPi);this.__canvasGestureAdapter=new this.__northstar.CanvasGestureAdapter({canvasElement:a[0],documentObj:this.__document,session3dAggregate:this.__session3dAggregate,scaleHDPi:this.scaleHDPi});this.__canvasGestureAdapter.setCallbackMouseDoubleClick(function(f,h){h=1;d.__session3dAggregate.getCurrentPolicy().deleteLater().handleGestureTapAtRasterCoordinates(f,h)});$(this.__window).on("resize.NorthstarModule"+this.cid,this.__onWindowResize.bind(this));this.__onWindowResize();this.__frameTimer.onUpdate(function(f){this.__session3dAggregate.tickByDeltaSeconds(f);this.__session3dAggregate.processCompletions()}.bind(this));this.__frameTimer.run()},pause:function(){this.__session3dAggregate.enableRendering(!1);this.__session3dAggregate.conserveMemory()},resume:function(){this.__session3dAggregate.enableRendering(!0)},loadedEverything:function(){return this.__loadedEverythingResolver.promise},delete:function(a){if(this.isDeleted()&&"undefined"===typeof a)return this.__window.console.warn("NorthstarModule::delete  - Double deletion of module??"),!1;this.__diagnostics.bumpNorthstarInstances(-1);b.prototype.delete.call(this);$(this.__window).off("resize.NorthstarModule"+this.cid);this.__canvasGestureAdapter.delete();this.__session3dAggregate.delete();this.__session3dAggregate=null;this.__gl.delete();this.__gl=null;this.__frameTimer.stop();this.__frameTimer.delete();this.__frameTimer=null;this.__network.delete();this.__network=null;this.__preciseTimer.delete();this.__preciseTimer=null},__logEvents:function(a){if(_.contains(this.__loggingPref,a)||"error"==a){var d=Array.prototype.slice.call(arguments,1);d.unshift(this.uiContextName+"("+a+")>>");d.unshift((new Date).toISOString()+":");_.contains(this.__loggingPref,"stacktrace")||"error"==a?(this.__window.console.groupCollapsed("Stack trace"),this.__window.console.trace.apply(this.__window.console,d),this.__window.console.groupEnd()):this.__window.console.log.apply(this.__window.console,d)}},__onWindowResize:function(){var a=this.$el.width(),d=this.$el.height();if(0===a||0===d)this.__logEvents("northstar_debug","Zero canvas size ",a,":",d);else{this.__canvas.width=a;this.__canvas.height=d;this.__session3dAggregate.setCanvasSize(a,d);var e=[this.__canvas.scrollWidth,this.__canvas.scrollHeight];this.__logEvents("northstar_debug","__onWindowResize ",a,":",d,"-",e[0],":",e[1]);this.trigger("resize")}},__documentOnKeyDown:function(a){this.__altKeyDown=a.altKey;this.__ctrlKeyDown=a.ctrlKey;this.__shiftKeyDown=a.shiftKey},__documentOnKeyUp:function(a){this.__altKeyDown=a.altKey;this.__ctrlKeyDown=a.ctrlKey;this.__shiftKeyDown=a.shiftKey},__setupInput:function(){this.__shiftKeyDown=this.__ctrlKeyDown=this.__altKeyDown=this.__isContextMenuDown=!1;this.__document.addEventListener("keydown",this.__documentOnKeyDown.bind(this),!0);this.__document.addEventListener("keyup",this.__documentOnKeyUp.bind(this),!0)},__onValidSceneDo:function(a){this.__session3dAggregate&&a.call(this,this.__session3dAggregate.getCurrentPolicy())},__scrubTriggeredAction:function(a){a=a.match(/[\x00-\x7F]/g);return a=null===a?"":a.join("")},logLoadCompletionError:function(a,d,e,c,g,f){this.__logEvents("error",a,d,e,c);this.__logEvents("northstar_load_response",a,g,f)},showLoadingProgress:function(a,d){this.__loadingProgress=a.createChildContext(k.LoadingProgress,d)},makeLoadCompletion:function(a){a=(a=void 0===a?{}:a)||{};var d=a.source||"Northstar";a=_.extend({onAllAssetsSuccess:function(){this.__logEvents("northstar_load_response",d," - All assets loaded - Scene load complete")}.bind(this),onCriticalAssetFailure:function(e,c,g,f,h){this.logLoadCompletionError(d+" - A critical asset failed to load:",e,c,g,f,h)}.bind(this),onAllActionsReady:function(){this.__logEvents("northstar_load_response","All Action ready")}.bind(this),onCriticalAssetsReady:function(){this.__logEvents("northstar_load_response",d+" - All critical assets loaded")}.bind(this),onProgress:function(e){this.__logEvents("northstar_load_response",d+" - Scene load is "+parseInt(100*e,10)+"% complete")}.bind(this),onNonCriticalAssetFailure:function(e,c,g,f,h){this.logLoadCompletionError(d+" - A non-critical asset failed to load:",e,c,g,f,h)}.bind(this)},_.pick(a,"onAllAssetsSuccess onCriticalAssetFailure onAllActionsReady onCriticalAssetsReady onProgress onNonCriticalAssetFailure".split(" ")));return this.__northstar.LoadCompletion.implement(a).deleteLater()},makeAsyncCompletion:function(a){a=(a=void 0===a?{}:a)||{};var d=a.source||"Northstar";a=_.extend({onSuccess:function(){this.__logEvents("northstar_load_response",d," - Async call success")}.bind(this),onFailure:function(e,c,g,f,h){this.logLoadCompletionError(d+" - Async call failure:",e,c,g,f,h)}.bind(this)},_.pick(a,["onSuccess","onFailure"]));return this.__northstar.AsyncCompletion.implement(a).deleteLater()}})}({Northstar:m["@Northstar"],UiCore:m["@UiCore"],LoadingProgress:C,WrappedNetwork:aa}),ca=function(k){var b=k.NorthstarModule;return b.extend("FtuxModule",{uiContextName:"ftux_module",className:"ftux-module",dependencies:"femaleUrl ftuxState globalStartupModel maleUrl Northstar Promise roomUrl window".split(" "),FTUX_MODE_GENDER:0,FTUX_MODE_LOOK:1,trackedEvents:function(){return b.prototype.trackedEvents.call(this).concat([{type:"click",selector:"canvas",name:"change_gender",handler:this.__onChangeGender}])},initialize:function(a){a=void 0===a?{}:a;this.__window=a.window;this.__roomUrl=a.roomUrl;this.__femaleUrl=a.femaleUrl;this.__maleUrl=a.maleUrl;this.__Promise=a.Promise;this.__ftuxMode=this.FTUX_MODE_GENDER;this.__globalStartupModel=a.globalStartupModel;this.ftuxState=a.ftuxState;this.document=document;b.prototype.initialize.call(this,a);this.__policyFtux=this.__session3dAggregate.acquirePolicyFtux();this.__policyFtux.configureAssetsUrls(this.__roomUrl,this.__maleUrl,this.__femaleUrl);a={source:"FtuxModule.initialize",onAllAssetsSuccess:this.__onSession3dLoaded.bind(this),onCriticalAssetFailure:this.__onSession3dError.bind(this)};a=this.makeLoadCompletion(a);var d=(new this.__northstar.PolicyConfig).deleteLater();d.useAntiAlias=!0;this.__policyFtux.establishScene(d,a)},delete:function(){this.__policyFtux.delete();b.prototype.delete.call(this)},render:function(){b.prototype.render.call(this);this.$el.html(k.template)},setModeToLook:function(a){this.__ftuxMode!==this.FTUX_MODE_LOOK&&(this.setGender(this.ftuxState.getGender()),this.__policyFtux.setModeToLook(),this.__ftuxMode=this.FTUX_MODE_LOOK,this.ftuxState.getAssetUrl()?this.changeAssetsByUrlString(this.ftuxState.getAssetUrl(),a):this.__window.console.log("there was no url in setModeToLook for ",this.ftuxState.getGender()))},setModeToGender:function(){this.__policyFtux.setModeToGender();this.__ftuxMode=this.FTUX_MODE_GENDER;this.ftuxState.clearAssets()},changeAssetsByUrlString:function(a,d){var e={onAllAssetsSuccess:function(){d()}.bind(this),onCriticalAssetFailure:function(){this.__recordEvent("change_assets_url_error",{record:!0});d()}.bind(this)};this.ftuxState.setAssetUrl(a);this.__policyFtux&&this.__policyFtux.changeAvatar(a,this.makeLoadCompletion(e))},focusOnBodyRegion:function(a){if(null!==this.__policyFtux&&this.__ftuxMode===this.FTUX_MODE_LOOK){var d=this.__northstar.EnumHumanoidBodyRegion;this.__policyFtux.focusOnBodyRegion({skins:d.SKIN,heads:d.HEAD,eyes:d.EYES,hair:d.HAIR,facial_hair:d.FACIALHAIR,tops:d.TORSO,bottoms:d.LEGS,shoes:d.FEET,accessories:d.TORSO}[a]||d.ALL)}},setGender:function(a){window.policyFtux=this.__policyFtux;this.__ftuxMode!==this.FTUX_MODE_LOOK&&("male"===a?(this.ftuxState.setGender("male"),this.__policyFtux.selectGenderByOrdinal(1)):(this.ftuxState.setGender("female"),this.__policyFtux.selectGenderByOrdinal(2)))},__onChangeGender:function(a){this.__ftuxMode!==this.FTUX_MODE_LOOK&&(this.ftuxState.clearAssets(),a.offsetX<this.$("canvas").width()/2?this.setGender("female"):this.setGender("male"),this.trigger("change:gender"))},__onSession3dLoaded:function(a){this.$el.addClass("is-ready");this.__loadedEverythingResolver.resolve(this)},__onSession3dError:function(a){this.__recordEvent("ftux_3d_async_completion_error",{record:!0});this.__window.console.log("jsSession3dAsyncCompletion.onError",a)},noJQResizeToContainer:function(){this.__session3dAggregate.setCanvasSize(this.$el[0].offsetWidth,this.$el[0].offsetHeight)},reparent:function(a){this.$el.appendTo(a);this.__onWindowResize()},_getPolicy:function(){return this.__policyFtux}})}({UiCore:m["@UiCore"],NorthstarModule:ba,template:Y}),da=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='<div class="ftux-body fixed-position-ghost-layout loading">\n    <div class="avatar-container-2d"></div>\n    <div class="avatar-container" data-gender></div>\n    <div class="main-content">\n        <div class="download-container is-scrollable">\n            <div class="download-intro-container">\n                <div class="profile-icon-placeholder"></div>\n                <div class="download-intro-text-container">\n                    <span class="download-intro">',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"welcome_download_intro",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+=' <span class="username"></span>!</span>\n                    <div class="download-intro-credits-container hidden">\n                        <div class="download-intro-credits-icon wh-15 mr-5">';if((h=(c=a.icon||b&&b.icon||d,c.call(b,"icon-credits",{name:"icon",hash:{class:"wh-full"},data:e})))||0===h)f+=h;f+='</div>\n                        <span class="download-intro-credits"></span>\n                    </div>\n                </div>\n            </div>\n            <div class="download-title">\n                <p>';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"welcome_download_title",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</p>\n            </div>\n\n            <div class="download-body">\n                <p>';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"download_bridge_body",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</p>\n            </div>\n\n            <div class="download-widgets">\n                <div id='+g((c=a.mainDownloadContainerId||b&&b.mainDownloadContainerId,"function"===typeof c?c.call(b,{name:"mainDownloadContainerId",hash:{},data:e}):c))+' class="download-client-container"></div>\n            </div>\n\n            <div class="security-badges">                    \n                <a href="https://www.paypal.com/webapps/mpp/paypal-popup" data-badge="paypal" title="How PayPal Works" onclick="javascript:window.open(\'https://www.paypal.com/webapps/mpp/paypal-popup\',\'WIPaypal\',\'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, width=1060, height=700\'); return false;">\n                    <img class="paypal-icon" src="https://www.paypalobjects.com/digitalassets/c/website/marketing/na/us/logo-center/9_bdg_secured_by_pp_2line.png" border="0" alt="Secured by PayPal">\n                </a>\n            </div>\n\n            <div class="privacy-policy">\n                <a target="_blank" href="'+g((c=a.privacyPolicyUrl||b&&b.privacyPolicyUrl,"function"===typeof c?c.call(b,{name:"privacyPolicyUrl",hash:{},data:e}):c))+'">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"download_bridge_privacy_policy",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</a>\n            </div>\n            <div class="social-links-container">\n                <div class="social-links-header"><span>';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"download_bridge_social_links_header",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</span></div>\n                <div class="social-links">\n                    <a class="social-link facebook" data-social="facebook" target="_blank" href="'+g((c=a.facebookUrl||b&&b.facebookUrl,"function"===typeof c?c.call(b,{name:"facebookUrl",hash:{},data:e}):c))+'">';if((h=(c=a.icon||b&&b.icon||d,c.call(b,"icon-facebook",{name:"icon",hash:{},data:e})))||0===h)f+=h;f+='</a>\n                    <a class="social-link instagram" data-social="instagram" target="_blank" href="'+g((c=a.instagramUrl||b&&b.instagramUrl,"function"===typeof c?c.call(b,{name:"instagramUrl",hash:{},data:e}):c))+'">';if((h=(c=a.icon||b&&b.icon||d,c.call(b,"icon-instagram",{name:"icon",hash:{},data:e})))||0===h)f+=h;f+='</a>\n                    <a class="social-link twitter" data-social="twitter" target="_blank" href="'+g((c=a.twitterUrl||b&&b.twitterUrl,"function"===typeof c?c.call(b,{name:"twitterUrl",hash:{},data:e}):c))+'">';if((h=(c=a.icon||b&&b.icon||d,c.call(b,"icon-twitter",{name:"icon",hash:{},data:e})))||0===h)f+=h;f+='</a>\n                    <a class="social-link youtube" data-social="youtube" target="_blank" href="'+g((c=a.youtubeUrl||b&&b.youtubeUrl,"function"===typeof c?c.call(b,{name:"youtubeUrl",hash:{},data:e}):c))+'">';if((h=(c=a.icon||b&&b.icon||d,c.call(b,"icon-youtube",{name:"icon",hash:{},data:e})))||0===h)f+=h;return f+'</a>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="download-reminder-container"></div>\n    <div class="survey-popup-container"></div>\n</div>\n'},useData:!0})}({}),ea=function(k){var b=function(f){var h=Math.round(f/1e6*10)/10;if(1<=h)return h+"M views";h=Math.round(f/1e3);return 1<=h?h+"K views":f+" views"},a=function(f){var h=$jscomp.makeIterator(f.match(/((\d+)H)?((\d+)M)?((\d+)S)?$/));h.next();h.next();f=h.next().value;h.next();var l=h.next().value;h.next();h=h.next().value;var n="";f&&(n=""+f);n=l?(n?n+":":"")+l.padStart(2,"0"):n?n+":00":"00";return n=h?n+":"+h.padStart(2,"0"):n+":00"},d=function(f){return function(h){return f.reduce(function(l,n){return n(l)},h)}},e=function(f){f=f.toString().split(".");f[0]=f[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");return f.join(".")},c=function(f){return isNaN(f)||Math.floor(f)===f?0:f.toString().split(".")[1].length||0},g=function(f,h){if(c(f)<=h)return parseFloat(f).toFixed(h);var l=Math.pow(10,h);return(Math.trunc(f*l)/l).toFixed(h)};return{getTimeFormat:function(f,h){var l=Math.floor(f/3600),n=Math.floor(f/60)-60*l;f%=60;h&&(f=f.toFixed(h));h=10>f?"0":"";return l?l+":"+(10>n?"0":"")+n+":"+h+f:n+":"+h+f},formatCredits:function(f){return f.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},zeroPad:function(f,h){return(Array(h).join("0")+f).substr(-h,h)},formatMini:function(f,h){var l=[{base:1e3,letter:"K"},{base:1e6,letter:"M"},{base:1e9,letter:"B"}];if(f<(h?h:1e3))return e(f);for(var n=l.length-1;0<=n;n--){h=l[n];var p=h.base;if(f>=p)return l=Math.floor(f/p),f=Math.floor((f-p*l)/(p/10)),l+(f?"."+f:"")+h.letter}return""+f},addComma:e,formatDecimal:g,formatVCOIN:function(f){return e(g(f,2))},countDecimals:c,durationParser:a,viewFormatter:b,formatYouTubeVideoMetaData:function(f){return f.items.map(function(h){var l=h.snippet,n=h.contentDetails,p=h.id,q=h.status;return{imageUrl:l.thumbnails.medium.url,videoTitle:l.title,videoAuthor:l.channelTitle,videoDescription:l.description,totalViews:b(h.statistics.viewCount),duration:a(n.duration),isoDuration:n.duration,published:k.moment(l.publishedAt).fromNow(),videoId:p,embeddable:q.embeddable}})},getSuggestionsFromResponse:function(f){return d([function(h){return JSON.parse(h.match(/\((.*)\)/)[1])},function(h){return h[1]},function(h){return h.map(function(l){return l[0]})}])(f)},getTokenFromResponse:function(f){return d([function(h){return JSON.parse(h.match(/\((.*)\)/)[1])},function(h){return h[2]},function(h){return h.q}])(f)}}}({moment:m["@moment"]}),fa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;return"\n                <span>"+d((c=a.left_column_subtitle||b&&b.left_column_subtitle,"function"===typeof c?c.call(b,{name:"left_column_subtitle",hash:{},data:e}):c))+"</span>\n            "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;var g='<div class="top-row"></div>\n<div class="column-container">\n    <div class="left-column column">\n        <div class="back-bar">\n            <div class="icon">\n                <svg class="icon-back" width="20" height="20" viewBox="0 0 25 25"><title>back</title><path d="M8.9 12.5l6.82-7.25c.18-.2.28-.44.28-.7 0-.28-.1-.53-.28-.72-.4-.44-1.13-.44-1.54 0l-8.1 8.57-.08.1 8.2 8.67c.2.2.47.33.75.33s.54-.12.74-.33c.18-.2.28-.46.28-.74 0-.28-.1-.54-.3-.74l-6.8-7.2z" fill-rule="evenodd"/></svg>\n            </div>\n            <span>'+d((c=a.left_column_title||b&&b.left_column_title,"function"===typeof c?c.call(b,{name:"left_column_title",hash:{},data:e}):c))+"</span>\n            ",f=a["if"].call(b,b&&b.left_column_subtitle,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)g+=f;return g+'\n        </div>\n        <div class="left-sidebar"></div>\n    </div>\n    <div class="main-column column">\n        <div class="main-content"></div>\n    </div>\n    <div class="right-column column">\n        <div class="back-bar">\n            <div class="icon">\n                <svg class="icon-back" width="20" height="20" viewBox="0 0 25 25"><title>back</title><path d="M8.9 12.5l6.82-7.25c.18-.2.28-.44.28-.7 0-.28-.1-.53-.28-.72-.4-.44-1.13-.44-1.54 0l-8.1 8.57-.08.1 8.2 8.67c.2.2.47.33.75.33s.54-.12.74-.33c.18-.2.28-.46.28-.74 0-.28-.1-.54-.3-.74l-6.8-7.2z" fill-rule="evenodd"/></svg>\n            </div>\n            <span>'+d((c=a.right_column_title||b&&b.right_column_title,"function"===typeof c?c.call(b,{name:"right_column_title",hash:{},data:e}):c))+'</span>\n        </div>\n        <div class="right-sidebar"></div>\n    </div>\n</div>\n<div class="fixed-position-ghost-layout">\n    <div class="top-row"></div>\n    <div class="column-container">\n        <div class="left-column column">\n            <div class="left-sidebar"></div>\n        </div>\n        <div class="main-column column">\n            <div class="main-content"></div>\n        </div>\n        <div class="right-column column">\n            <div class="right-sidebar"></div>\n        </div>\n    </div>\n</div>'},useData:!0})}({}),D=function(k){var b=k.UiCore.UiContext;return b.extend("UIContextExtension",{dependencies:"browserInfo currentLocale featureAccessManager loginManager timestampHelper window".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__appMonitor=null;this.__browserInfo=a.browserInfo;this.__featureAccessManager=a.featureAccessManager;this.__loginManager=a.loginManager;this.__timestampHelper=a.timestampHelper;this.__currentLocale=this.__currentLocale||"en";this.__currentLocale="www"===this.__currentLocale?"en":this.__currentLocale;this.serviceProvider=a.serviceProvider;this.__userIsLoggedIn=this.__loginManager.isLoggedIn();this.__myCid=0;this.__userIsLoggedIn&&(this.__myself=this.__loginManager.getCurrentUser(),this.__loginType=this.__loginManager.getLoginType(),this.__myself.populated().then(function(){this.__myCid=this.__myself.get("legacy_cid");if("string"===typeof this.__myCid)if(/^\d+$/.test(this.__myCid))this.__myCid=parseInt(this.__myCid);else{if(!this.__appMonitor&&this.serviceProvider.has("appMonitor")){var d=this.serviceProvider.get("appMonitor");d&&(this.__appMonitor=d)}this.__appMonitor?this.__appMonitor.reportCustomError("UIContextExtension","initialize","web_perm_0017","Bad CID detected",["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]):this.__window.appMonitorPending.push(["UIContextExtension","initialize","web_perm_0017","Bad CID detected",["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]]);this.__myCid=0}this.__myCid=this.__myCid?this.__myCid:0;this.__myCountry=this.__myself.get("country")}.bind(this)));this.__perfReportManager=this.serviceProvider.get("perfReportManager");this.__perfReportManager.setUIContext(this)},getActivityGroupID:function(){return this.__activityGroup.id},getClientSessionID:function(){},packageAppDeviceData:function(){var a=this.__browserInfo.getPlatformData();return{is_test_data:String(this.__window.location).includes("localhost")?"test":"production",app_instance_id:a.appInstanceID,device_platform:a.devicePlatform,device_model:a.deviceModel,app_version:a.appVersion,customer_id:this.__myCid}},__packageEventData:function(a,d){var e=this.__timestampHelper.now().unix().toString();return _.extend({event:null,event_class:null,event_transaction_id:d,event_timestamp:e,event_source:"user",event_reason:null,location:null},a)},__packageTaxonomyData:function(a,d){return{payload_format:"taxonomy",taxonomy:{tenant_id:"IMVU",schema_version:1,app_device_data:this.packageAppDeviceData(),event_data:this.__packageEventData(a,d)}}},__recordTaxonomyEvent:function(a,d){var e=k.NextUtil.DomHelper.createGUID();a=this.__packageTaxonomyData(a,e);this.__recordEvent("taxonomy",a,d||"","soma_taxonomy");return e},recordSentWhisper:function(a){return this.__recordTaxonomyEvent({event:"whisper_sent",event_class:"chat",event_reason:"click",string_one:navigator.language,integer_one:a.receiverCid,integer_two:a.senderVipStatus,integer_three:a.receiverVipStatus,location:a.location,level_one:a.roomType,level_two:a.roomId,level_three:a.startOrReply,client_ip:a.clientIp})},recordShowTieredVipUpsell:function(a){return this.__recordTaxonomyEvent({event:"vip_upsell",event_class:"vip",event_reason:"click",string_one:navigator.language,string_two:a.vipTriggerLocation,event_source:"user",location:a.vipTrigger,user_agent:navigator.userAgent,client_ip:a.clientIp})},recordYouTubePlaylistClick:function(a){var d=a.playlistId;d.includes("list=")&&(d=d.split("list=")[1]);return this.__recordTaxonomyEvent({event:"youtube_imvu_curated_playlist_started",event_class:"youtube",event_reason:"click",string_one:d,client_ip:a.clientIp})},recordYouTubeSearch:function(a){return this.__recordTaxonomyEvent({event:"youtube_video_search",event_class:"youtube",event_reason:"click",string_one:a.searchString,client_ip:a.clientIp})},recordGuestExperiencesYouTube:function(a){var d=parseInt(a.hostCid.match(/\d+$/)[0],10);return this.__recordTaxonomyEvent({event:"youtube_video_viewed_by_non_host",event_class:"youtube",event_reason:a.alreadyPlaying?"playing":"started",integer_one:d,level_one:a.roomId,client_ip:a.clientIp})},recordProductTaxonomyEvent:function(a,d){a=a.get("product_id");if("number"!==typeof a||0>=a)return null;d.systemError=""===d.systemError?null:d.systemError;var e=a.toString(),c={event:IMVU.requireProperty(d,"event"),event_class:IMVU.requireProperty(d,"eventClass"),event_reason:IMVU.requireProperty(d,"eventReason"),location:IMVU.requireProperty(d,"location"),string_one:IMVU.requireProperty(d,"status")};"product_purchased"===d.event?(c.string_two=IMVU.requireProperty(d,"currencyType"),c.string_three=IMVU.requireProperty(d,"systemError"),c.string_four=this.__loginType,c.string_five=this.__getLanguangeSetting()):(c.string_two=IMVU.requireProperty(d,"systemError"),c.integer_one=a);return this.__recordTaxonomyEvent(c,e)},recordPerformanceTaxonomyEvent:function(a,d,e){if(-1===this.__perfReportManager.getBudget(a))return this.__window.console.error("UIContextExtension::recordPerformanceTaxonomyEvent - tage("+String(a)+") not recognized"),null;var c=this.__perfReportManager.getBudget(a);e=e||{};e.submode="__default__"===e.submode?"default":e.submode;var g=IMVU.optionalProperty(e,"northstar",null);g=g?JSON.stringify(g):"";var f=this.__serviceProvider.get("systemMetrics");f=f?JSON.stringify(f):"";var h=this.__featureAccessManager.getMarketingPlatform(),l=this.__serviceProvider.get("appVersion"),n=0,p=0,q=0;"@DEV"===l?h="desktop-client-dev":l&&(h="desktop-client-"+l,q=l.split("."),n=parseInt(q[0]),p=parseInt(q[1]),q=parseInt(q[2]));l=this.__serviceProvider.get("appName");a=a+"__"+h+"__"+l+"__"+(e.type+"_Mode-"+e.mode+"_Submode-"+e.submode);h=-1;"undefined"===typeof e.sessionDuration?this.__window.console.error("UiContextExtension::recordPerformanceTaxonomyEvent - Event data missing sessionDuration"):h=e.sessionDuration;return this.__recordTaxonomyEvent({event:"performance",event_class:"measurement",event_reason:"dna",location:"dna",decimal_one:c,decimal_two:d,string_one:a,string_two:g,string_three:f,integer_one:n,integer_two:p,integer_three:q,integer_four:h},"")},__getLanguangeSetting:function(){return this.__currentLocale+"-"+this.__myCountry}})}({NextUtil:m["@NextUtil"],UiCore:m["@UiCore"]}),ha=function(k){var b=k.UIContextExtension,a=function(){var d=function(e){e.preventDefault()};return function(){this.$el.on(_.map(arguments,function(e,c){return c+"."+e}.bind(this,this._listenerId)).join(" "),d)}}();(function(){var d=function(e){e.stopPropagation()};return function(){this.$el.on(_.map(arguments,function(e,c){return c+"."+e}.bind(this,this._listenerId)).join(" "),d)}})();return b.extend("WAFContext",{"static preventScroll":function(){window.jQueryScrollbarOptions&&window.jQueryScrollbarOptions.disableBodyScroll&&(this.prototype.initialize=_.wrap(this.prototype.initialize,function(d,e){d.call(this,e);a.call(this,"wheel","mousewheel","MozMousePixelScroll")}));return this},dependencies:["timer"],initialize:function(d){b.prototype.initialize.call(this,d)},__recoverFromLoadError:function(d,e,c){this.__loadFailureTimeout=this.__timer.setTimeout(this.__recoverFromLoadFail.bind(this,d,e,c,0),5e3)},__recoverFromLoadFail:function(d,e,c,g){d.invalidate();d.populated().then(function(){e()}.bind(this)).catch(function(){c();var f=g&&0<g?15===g?45:180<=g?180:2*g:15;window.console.log("Waiting "+f+" seconds to reload");this.__loadFailureTimeout=this.__timer.setTimeout(this.__recoverFromLoadFail.bind(this,d,e,c,f),1e3*f)}.bind(this))},delete:function(){this.$el.off("."+this._listenerId);this.__loadFailureTimeout&&this.__timer.clearTimeout(this.__loadFailureTimeout);b.prototype.delete.call(this)}})}({UIContextExtension:D}),u=function(k){var b=k.WAFContext;return b.extend("Submode",{__id:"",layout:"",dependencies:"appMonitor googleAnalytics loginManager mode modeManager multiGetManager platform window".split(" "),__recordShown:!0,drillDownFrom:null,initialize:function(a){this.__perfStartTime=IMVU.optionalProperty(a,"perfStartTime",null);a.id&&(this.__id=a.id);this.__window=a.serviceProvider.get("window");b.prototype.initialize.call(this,a);this.__modeManager=a.modeManager;this.__googleAnalytics=a.googleAnalytics;this.__parentMode=a.mode;this.__parentMode.setLayout(this.layout);this.__appMonitor=a.appMonitor;this.__loginManager.isLoggedIn()&&(this.__myself=this.__loginManager.getCurrent().getSingleEdge("user"));this.__slideIns=[]},render:function(){this.$el.html(k.template({left_column_title:this.leftColumnTitle,right_column_title:this.rightColumnTitle,left_column_subtitle:this.leftColumnSubTitle}))},subId:function(){return this.__id},summarize:function(){return{}},getTitle:function(){},overrideMainNav:null,overrideAuxNav:null,overrideNavLabel:null,show:function(a){a=void 0===a?{}:a;b.prototype.show.call(this,a);this.__modeManager.togglePermalink(!0===a.isPermaLink);this.$el.css("display","");this.__parentMode.markActiveNav(this.subId());this.__parentMode.updateTitle();this.__googleAnalytics.recordPageView(this.__serviceProvider.get("appName")+"/"+this.__parentMode.modeId+"/"+("__default__"==this.subId()?"":this.subId()));"__default__"!==this.subId()&&this.__googleAnalytics.recordSubModeChange(this.subId());this.__toggleLeftColumnToggleVisibility()},__bringColumnToFront:function(a){a=a.closest(".column, .top-row");var d=a.parents(".fixed-position-ghost-layout");0<d.length&&d.addClass("in-use");a.addClass("has-content");a.hasClass("left-column")&&this.__toggleLeftColumnToggleVisibility()},__getWidgetContainer:function(a,d){return(d?this.$(".fixed-position-ghost-layout"):this.$el).find(a).first()},__addWidget:function(a,d,e,c){a=this.__getWidgetContainer(a,c);this.__bringColumnToFront(a);return this.createChildContext(d,_.extend({$parentElement:a},e))},addWidgetToTopRow:function(a,d,e){return this.__addWidget(".top-row",a,d,e)},addWidgetToBody:function(a,d,e){return this.__addWidget(".main-content",a,d,e)},addWidgetToLeftSidebar:function(a,d,e){return this.__addWidget(".left-sidebar",a,d,e)},addWidgetToRightSidebar:function(a,d,e){return this.__addWidget(".right-sidebar",a,d,e)},addWidgetToRightColumn:function(a,d,e){return this.__addWidget(".right-column",a,d,e)},addWidgetToLeftColumn:function(a,d,e){return this.__addWidget(".left-column",a,d,e)},addSlideIn:function(a,d,e){e=void 0===e?"right":e;d||(d={});d.whichSide=e;a=this.addWidgetToBody(a,d,!0);this.__slideIns[e]||(this.__slideIns[e]=[]);this.__slideIns[e].push(a);return a},hideAllSlideIns:function(){for(var a in this.__slideIns)this.hideSlideInsOnSide(a)},hideSlideInsOnSide:function(a){_.each(this.__slideIns[a],function(d){d.hide()})},getSlideIns:function(){return this.__slideIns},toggleMagicLineMenu:function(a){"undefined"===typeof this.__magicLine&&(this.__modeContainer=document.getElementsByClassName("mode-container")[0],this.__magicLine=this.__modeContainer.getElementsByClassName("magic-line-menu")[0]);"undefined"!==typeof this.__magicLine&&(!0===a?this.__magicLine.classList.add("hidden"):this.__magicLine.classList.remove("hidden"))},__toggleLeftColumnToggleVisibility:function(){var a=this.$(".left-column").hasClass("has-content");this.$el.parents(".mode").find('li[data-nav="toggle_left_column"]').toggleClass("hidden",!a)}})}({UiCore:m["@UiCore"],WAFContext:ha,template:fa}),ia=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){return'<button class="onboarding-progress__button">\n    <span class="onboarding-progress__button-text"></span>\n    <span class="onboarding-progress__button-shine shine-effect"></span>\n</button>\n<div class="onboarding-progress-tooltip-placeholder"></div>\n'},useData:!0})}({}),ja=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<h1 class="onboarding-discover-dialog__title">\n    ',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"onboarding_discover_title",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='\n</h1>\n<div class="onboarding-discover-dialog__progress">\n    <div class="onboarding-discover-dialog__progress-bar"></div>\n    <div class="onboarding-discover-dialog__progress-label"></div>\n    <div class="shine-effect"></div>\n</div>\n<ul class="onboarding-discover-dialog__p1-tasks"></ul>\n<h2 class="onboarding-discover-dialog__subtitle">\n    ';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"onboarding_discover_subtitle",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='\n</h2>\n<ul class="onboarding-discover-dialog__all-tasks"></ul>\n<footer class="onboarding-discover-dialog__footer">\n    <button class="onboarding-discover-dialog__close btn btn-primary">\n        ';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"onboarding_discover_button",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"\n    </button>\n</footer>\n"},useData:!0})}({}),ka=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;var g=a.helperMissing,f='\n            <img class="upsell_after_gift_product-ad" src="'+d((c=a.product_ad_url||b&&b.product_ad_url,"function"===typeof c?c.call(b,{name:"product_ad_url",hash:{},data:e}):c))+'">\n            <div class="upsell_after_gift_recipient_received">'+d((c=a.giftRecipient||b&&b.giftRecipient,"function"===typeof c?c.call(b,{name:"giftRecipient",hash:{},data:e}):c))+" ";if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"received_your_gift",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+'</div><br/>\n            <div class="upsell_after_gift_title">'+d((c=a.subtitle||b&&b.subtitle,"function"===typeof c?c.call(b,{name:"subtitle",hash:{},data:e}):c))+"</div>\n        "},3:function(b,a,d,e){var c;d=this.escapeExpression;return'\n            <img class="product-ad" src="'+d((c=a.product_ad_url||b&&b.product_ad_url,"function"===typeof c?c.call(b,{name:"product_ad_url",hash:{},data:e}):c))+'">\n            <div class="title">'+d((c=a.subtitle||b&&b.subtitle,"function"===typeof c?c.call(b,{name:"subtitle",hash:{},data:e}):c))+"</div>\n        "},5:function(b,a,d,e){var c;d=a.helperMissing;var g='\n        <div class="vcoin-bullet-wrapper">\n            <div>',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin_upsell_bullet_intro",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='</div>\n            <ul class="vcoin-upsell-points">\n                <li>';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin_upsell_bullet_point_1",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n                <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin_upsell_bullet_point_2",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n                <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin_upsell_bullet_point_3",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n            </ul>\n            <div>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin_upsell_description_2",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</div>\n            \n        </div>\n        "},7:function(b,a,d,e){var c,g=a.helperMissing;d='\n    <button class="btn btn-primary btn-dark greeter-cta">';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"JOIN NOW",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</button>\n"},9:function(b,a,d,e){d='\n    <button class="btn btn-primary checkout-cta disabled">\n        ';if((b=a["if"].call(b,b&&b.simulated,{name:"if",hash:{},fn:this.program(10,e),inverse:this.program(12,e),data:e}))||0===b)d+=b;return d+"\n    </button>\n"},10:function(b,a,d,e){var c,g=a.helperMissing;d="\n            ";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"buy_now",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n        "},12:function(b,a,d,e){d="\n            ";if((b=a["if"].call(b,b&&b.upsellAfterGift,{name:"if",hash:{},fn:this.program(13,e),inverse:this.program(15,e),data:e}))||0===b)d+=b;return d+"\n        "},13:function(b,a,d,e){var c,g=a.helperMissing;d="\n                ";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"upsell_after_gift_cta",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n            "},15:function(b,a,d,e){var c,g=a.helperMissing;d=this.escapeExpression;var f="\n                ";if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"buy_now_for",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+" "+d((c=a.sale_price||b&&b.sale_price,"function"===typeof c?c.call(b,{name:"sale_price",hash:{},data:e}):c))+"\n            "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d='<div class="dialog-body-scroller">\n    <div class="multicart-upsell-panel">\n        ';var c=a["if"].call(b,b&&b.upsellAfterGift,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(c||0===c)d+=c;d+='\n        <div class="description"></div>\n        ';if((c=a["if"].call(b,b&&b.vcoinUpsell,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===c)d+=c;d+='\n        <div class="product-selectors"></div>\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n';if((c=a["if"].call(b,b&&b.greeter,{name:"if",hash:{},fn:this.program(7,e),inverse:this.program(9,e),data:e}))||0===c)d+=c;return d+"\n<\/script>\n"},useData:!0})}({}),E=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=a.helperMissing;var g='\n<div class="vip_web_tier_1-description">\n    <p>',f=a["if"].call(b,b&&b.isCreatorLanding,{name:"if",hash:{},fn:this.program(2,e),inverse:this.program(4,e),data:e});if(f||0===f)g+=f;g+="</p>\n    <ul>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_host_shields",{name:"i18n-g",hash:{tier:"Gold"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_credits_per_month",{name:"i18n-g",hash:{credits:"2,000"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_live",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+=" or ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_chat",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_hours",{name:"i18n-g",hash:{hours:"2"},data:e})))||0===f)g+=f;g+=" ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_broadcasting",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n    </ul>\n    <ul>\n        ";if((f=a["if"].call(b,b&&b.canSeeYouTube,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_tips",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_support",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_gifts",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</li>\n    </ul>\n</div>\n"},2:function(b,a,d,e){var c,g=a.helperMissing;d="\n        ";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"vip_upsell_creator_landing_body",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n    "},4:function(b,a,d,e){var c,g=a.helperMissing;d="\n        ";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"vip_product_prop_description",{name:"i18n-g",hash:{tier:"Gold"},data:e})))||0===a)d+=a;return d+"\n    "},6:function(b,a,d,e){var c,g=a.helperMissing;d="\n        <li>";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"vip_product_prop_streaming",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</li>\n        "},8:function(b,a,d,e){var c;d=a.helperMissing;var g='\n<div class="vip_web_tier_2-description active">\n    <p>',f=a["if"].call(b,b&&b.isCreatorLanding,{name:"if",hash:{},fn:this.program(2,e),inverse:this.program(9,e),data:e});if(f||0===f)g+=f;g+="</p>\n    <ul>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_host_shields",{name:"i18n-g",hash:{tier:"Platinum"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_credits_per_month",{name:"i18n-g",hash:{credits:"5,000 - 7,400"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_rooms_and_live",{name:"i18n-g",hash:{live:"2",rooms:"5"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_hours",{name:"i18n-g",hash:{hours:"6"},data:e})))||0===f)g+=f;g+=" ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_broadcasting",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n    </ul>\n    <ul>\n        ";if((f=a["if"].call(b,b&&b.canSeeYouTube,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_loyalty_credits",{name:"i18n-g",hash:{url:"https://help.imvu.com/s/article/How-do-the-VIP-5000-Credits-Work?language=en_US",credits:"200"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_tips",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_support",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_gifts",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_whisper",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_no_ads",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_creator",{name:"i18n-g",hash:{url:"https://www.imvu.com/creatorlanding/explore"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_dressup",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_avatar_actions",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_percent_off_everything",{name:"i18n-g",hash:{percent:"5"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_percent_off_badges",{name:"i18n-g",hash:{percent:"10"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_shop_together",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</li>\n    </ul>\n</div>\n"},9:function(b,a,d,e){var c,g=a.helperMissing;d="\n        ";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"vip_product_prop_description",{name:"i18n-g",hash:{tier:"Platinum"},data:e})))||0===a)d+=a;return d+"\n    "},11:function(b,a,d,e){var c;d=a.helperMissing;var g='\n<div class="vip_web_tier_3-description">\n    <p>',f=a["if"].call(b,b&&b.isCreatorLanding,{name:"if",hash:{},fn:this.program(2,e),inverse:this.program(12,e),data:e});if(f||0===f)g+=f;g+="</p>\n    <ul>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_host_shields",{name:"i18n-g",hash:{tier:"Diamond"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_credits_per_month",{name:"i18n-g",hash:{credits:"6,000 - 8,400"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_rooms_and_live",{name:"i18n-g",hash:{live:"3",rooms:"10"},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_unlimited",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+=" ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_broadcasting",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n        <li><strong>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_unlimited",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+=" ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_friend_matches",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</strong></li>\n    </ul>\n    <ul>\n        ";if((f=a["if"].call(b,b&&b.canSeeYouTube,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_loyalty_credits",{name:"i18n-g",hash:{url:"https://help.imvu.com/s/article/How-do-the-VIP-5000-Credits-Work?language=en_US",credits:"200"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_tips",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_support",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_gifts",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_whisper",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_no_ads",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_creator",{name:"i18n-g",hash:{url:"https://www.imvu.com/creatorlanding/explore"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_dressup",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_avatar_actions",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_percent_off_everything",{name:"i18n-g",hash:{percent:"5"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_percent_off_badges",{name:"i18n-g",hash:{percent:"10"},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_shop_together",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</li>\n        <li>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_product_prop_daily_spin",{name:"i18n-g",hash:{spins:"2"},data:e})))||0===f)g+=f;return g+"</li>\n    </ul>\n</div>\n"},12:function(b,a,d,e){var c,g=a.helperMissing;d="\n        ";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"vip_product_prop_description",{name:"i18n-g",hash:{tier:"Diamond"},data:e})))||0===a)d+=a;return d+"\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d="";var c=a["if"].call(b,b&&b.vip_web_tier_1,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(c||0===c)d+=c;d+="\n\n";if((c=a["if"].call(b,b&&b.vip_web_tier_2,{name:"if",hash:{},fn:this.program(8,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n\n";if((c=a["if"].call(b,b&&b.vip_web_tier_3,{name:"if",hash:{},fn:this.program(11,e),inverse:this.noop,data:e}))||0===c)d+=c;return d},useData:!0})}({}),la=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;return"\n        "+d((c=a.header_text||b&&b.header_text,"function"===typeof c?c.call(b,{name:"header_text",hash:{},data:e}):c))+"\n    "},3:function(b,a,d,e){var c;d=this.escapeExpression;return"\n        "+d((c=a.category||b&&b.category,"function"===typeof c?c.call(b,{name:"category",hash:{},data:e}):c))+"\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d='\n<legend class="system-info-header">\n    ';if((b=a["if"].call(b,b&&b.header_text,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===b)d+=b;return d+"\n    <span class='more-items hidden'>\n        <span class='indicator'>+&nbsp;</span><span class='description'></span>\n    </span>\n</legend>\n"},useData:!0})}({}),ma=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;var g=a.helperMissing,f="\n        ",h=a["if"].call(b,b&&b.is_popular,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e});if(h||0===h)f+=h;f+='\n\n        <div class="left">\n            <div class="icon icon-wrapper"><img src="'+d((c=a.image||b&&b.image,"function"===typeof c?c.call(b,{name:"image",hash:{},data:e}):c))+'"></div>\n        </div>\n        <div class="middle">\n            <div class="line1">'+d((c=a.title||b&&b.title,"function"===typeof c?c.call(b,{name:"title",hash:{},data:e}):c))+'</div>\n            <div class="line2">'+d((c=a.line2_text||b&&b.line2_text,"function"===typeof c?c.call(b,{name:"line2_text",hash:{},data:e}):c))+'</div>\n            <div class="line3">\n                ';if((h=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n                <span class="sale-price">'+d((c=a.sale_price||b&&b.sale_price,"function"===typeof c?c.call(b,{name:"sale_price",hash:{},data:e}):c))+'</span>\n            </div>\n        </div>\n        <div class="right">\n            <div class="inner">\n                <span class="label-active hidden">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"ACTIVE",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"</span>\n            </div>\n        </div>\n    "},2:function(b,a,d,e){var c,g=a.helperMissing;d='\n            <div class="promo-banner most-popular"><span>';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"MOST POPULAR",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+'</span><div class="triangle"></div></div>\n        '},4:function(b,a,d,e){var c;d=this.escapeExpression;return'\n                    <span class="original-price">'+d((c=a.price||b&&b.price,"function"===typeof c?c.call(b,{name:"price",hash:{},data:e}):c))+"</span>\n                "},6:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f="\n\n        ",h=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e});if(h||0===h)f+=h;f+="\n\n        <span class='pend-multiplier hidden' pend-count='0'>\n            <div class=\"pend-tooltip\">\n                <div class=\"tooltip-header\">";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"PENDING_TOOLTIP_TITLE",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n                <div class="tooltip-body">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"PENDING_TOOLTIP_DESC",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</div>\n            </div>\n        </span>\n        <span class='multiplier' cart-count='0'></span>\n\n        ";if((h=a["if"].call(b,b&&b.is_popular,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===h)f+=h;f+="\n\n        ";if((h=a["if"].call(b,b&&b.is_best,{name:"if",hash:{},fn:this.program(9,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n        <div class="item-info">\n            <div class="image-container icon-wrapper"><span class="helper"></span><img src="'+g((c=a.image||b&&b.image,"function"===typeof c?c.call(b,{name:"image",hash:{},data:e}):c))+'"></div>\n            <div class="title">'+g((c=a.title||b&&b.title,"function"===typeof c?c.call(b,{name:"title",hash:{},data:e}):c))+'</div>\n            <div class="title2">'+g((c=a.title2||b&&b.title2,"function"===typeof c?c.call(b,{name:"title2",hash:{},data:e}):c))+'</div>\n            <div class="title3">'+g((c=a.title3||b&&b.title3,"function"===typeof c?c.call(b,{name:"title3",hash:{},data:e}):c))+'</div>\n            <div class="icon icon-ok"></div>\n        </div>\n        <div class="item-price">\n            ';if((h=a["if"].call(b,b&&b.isActive,{name:"if",hash:{},fn:this.program(11,e),inverse:this.program(13,e),data:e}))||0===h)f+=h;return f+"\n        </div>\n    "},7:function(b,a,d,e){var c;d=this.escapeExpression;return'\n            <div class="promo-banner sale">'+d((c=a.sale_copy||b&&b.sale_copy,"function"===typeof c?c.call(b,{name:"sale_copy",hash:{},data:e}):c))+'<div class="triangle"></div></div>\n        '},9:function(b,a,d,e){var c,g=a.helperMissing;d='\n            <div class="promo-banner best-value"><span>';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"BEST VALUE",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+'</span><div class="triangle"></div></div>\n        '},11:function(b,a,d,e){var c,g=a.helperMissing;d="\n                <span>";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"ACTIVE",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</span>\n            "},13:function(b,a,d,e){var c;d=this.escapeExpression;var g="\n                \x3c!-- sales_price is source of truth, if discount show original price with sales price --\x3e\n                ",f=a["if"].call(b,b&&b.has_discount,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e});if(f||0===f)g+=f;return g+'\n                <span class="sale-price">'+d((c=a.sale_price||b&&b.sale_price,"function"===typeof c?c.call(b,{name:"sale_price",hash:{},data:e}):c))+"</span>\n            "},15:function(b,a,d,e){return'\n    <div class="separator"></div>\n'},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d='<div class="wrapper">\n    ';var c=a["if"].call(b,b&&b.isMobileAndUpsell,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(6,e),data:e});if(c||0===c)d+=c;d+="\n</div>\n";if((c=a["if"].call(b,b&&b.isMobileAndUpsell,{name:"if",hash:{},fn:this.program(15,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"\n"},useData:!0})}({}),na=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;return'<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-ghost btn-dark" data-confirm="no">'+d((c=a.no||b&&b.no,"function"===typeof c?c.call(b,{name:"no",hash:{},data:e}):c))+'</button>\n    <button class="btn btn-primary btn-dark" data-confirm="yes">'+d((c=a.yes||b&&b.yes,"function"===typeof c?c.call(b,{name:"yes",hash:{},data:e}):c))+"</button>\n<\/script>\n"},useData:!0})}({}),oa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d='\n<div class="id-body-contents">';if((a=(c=a.html||b&&b.html,"function"===typeof c?c.call(b,{name:"html",hash:{},data:e}):c))||0===a)d+=a;return d+"</div>\n"},3:function(b,a,d,e){var c;d=this.escapeExpression;return'\n<p class="id-body-contents">'+d((c=a.text||b&&b.text,"function"===typeof c?c.call(b,{name:"text",hash:{},data:e}):c))+"</p>\n"},5:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='\n<p class="terms-of-service">\n    <span>',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"dialog_for_your_reference_terms_of_service",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+=' <a data-external href="'+g((c=a.policyHubUrl||b&&b.policyHubUrl,"function"===typeof c?c.call(b,{name:"policyHubUrl",hash:{},data:e}):c))+'" target="_blank">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Terms of Service",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"</a>.</span>\n</p>\n"},7:function(b,a,d,e){var c;d=this.escapeExpression;var g='\n<div class="dialog-checkbox-container">\n    <input id="dialog-checkbox" type="checkbox" class="checkbox" ',f=a["if"].call(b,b&&b.checkedByDefault,{name:"if",hash:{},fn:this.program(8,e),inverse:this.noop,data:e});if(f||0===f)g+=f;return g+'><label for="dialog-checkbox">'+d((c=a.checkbox||b&&b.checkbox,"function"===typeof c?c.call(b,{name:"checkbox",hash:{},data:e}):c))+"</label>\n</div>\n"},8:function(b,a,d,e){return"checked"},10:function(b,a,d,e){d='\n<div class="dialog-dropdown-container">\n    <select id="dialog-dropdown">\n        ';var c=a["if"].call(b,(c=b&&b.dropdown,null==c||!1===c?c:c.placeholder),{name:"if",hash:{},fn:this.program(11,e),inverse:this.noop,data:e});if(c||0===c)d+=c;return d+"\n    </select>\n</div>\n"},11:function(b,a,d,e){var c;a=this.escapeExpression;return'\n        <option class="dropdown-placeholder" value="" disabled selected>'+a((c=(c=b&&b.dropdown,null==c||!1===c?c:c.placeholder),"function"===typeof c?c.apply(b):c))+"</option>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;var g="",f=a["if"].call(b,b&&b.html,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(f||0===f)g+=f;g+="\n\n";if((f=a["if"].call(b,b&&b.termsOfService,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n\n";if((f=a["if"].call(b,b&&b.checkbox,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n\n";if((f=a["if"].call(b,b&&b.dropdown,{name:"if",hash:{},fn:this.program(10,e),inverse:this.noop,data:e}))||0===f)g+=f;return g+'\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary btn-dark" data-confirm="ok" disabled>'+d((c=a.ok||b&&b.ok,"function"===typeof c?c.call(b,{name:"ok",hash:{},data:e}):c))+"</button>\n<\/script>\n"},useData:!0})}({}),pa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){return'<div class="dropdown-label is-truncated"><span>&nbsp;</span></div>\n<div class="dropdown-option-list-container">\n    <div class="dropdown-scroll-up"></div>\n    <div class="dropdown-scroll-down"></div>\n    <ul class="dropdown-option-list">\n        <li class="dropdown-option is-truncated" data-value="" tabindex="-1"></li>\n    </ul>\n</div>\n'},useData:!0})}({}),w=function(k){function b(e){e=$(e.target).closest(".dropdown");$(".dropdown").not(e).each(function(c,g){$(g).data("dropdown-instance").__hide()})}var a=k.UiCore.UiContext,d=k.NextUtil.Keys;return a.extend("Dropdown",{globalSetup:function(){document.addEventListener("click",b,!0);document.addEventListener("touchend",b,!0)},globalTearDown:function(){document.removeEventListener("click",b,!0);document.removeEventListener("touchend",b,!0)},uiContextName:"dropdown",className:"dropdown disable-text-selection",ITEM_HEIGHT:40,AUTO_SCROLL_BY:2,dependencies:["timer","window"],trackedEvents:function(){return[{type:"click",selector:".dropdown-label",name:"dropdown_label_click",handler:"toggleOpen"},{type:"click",selector:".dropdown-option",name:"dropdown_option_click",handler:"clickOption"},{type:"keydown",selector:"",name:"dropdown_keydown",handler:this.__onKeydown.bind(this,[])},{type:"mousemove",selector:".dropdown-option",name:"dropdown_option_mouseenter",handler:this.__onMousemove.bind(this,{x:0,y:0})},{type:"mouseenter",selector:".dropdown-label",name:"dropdown_label_mouseenter",handler:"__onMouseenterLabel"},{type:"mouseenter",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseenter",handler:"__onScrollUpMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-up",name:"dropdown_scroll_up_mouseleave",handler:"__onScrollUpMouseleave"},{type:"mouseenter",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseenter",handler:"__onScrollDownMouseenter"},{type:"mouseleave",selector:".dropdown-scroll-down",name:"dropdown_scroll_down_mouseleave",handler:"__onScrollDownMouseleave"}]},__onMousemove:function(e,c){if(e.x!=c.screenX||e.y!=c.screenY)e.x=c.screenX,e.y=c.screenY,this.$el.focus(),this.setActiveElement($(c.target))},__onBlur:function(e){this.$el.removeClass("is-open")},__onMouseenterLabel:function(e){this.$(".is-selected").removeClass("is-selected")},initialize:function(e){this.$select=IMVU.requireProperty(e,"$replaceElement");if(!this.$select.is("select"))throw Error("$replaceElement must be a <select> element. got: "+this.$select[0].tagName);if(this.$select.closest("label").length)throw Error("do not wrap custom dropdowns with <label> tags; it disrupts event handling");a.prototype.initialize.call(this,e);this.window=e.window;this.timer=e.timer;this.boundingBox=e.boundingBox||this.getDefaultBoundingBox();this.document=e.document||document;this.__keyArray=[];if(this.dismissOnScroll=e.dismissOnScroll)$(e.dismissOnScroll).on("scroll.dropdown",function(){this.__hide()}.bind(this));$(".dropdown-layer").length||$("body").append('<div class="dropdown-layer"/>');this.$dropdownLayer=$(".dropdown-layer");e.dimNoValue&&this.$el.addClass("dim-no-value");e.lightText&&this.$el.addClass("light-text");e.hideArrow&&this.$el.addClass("hide-arrow");this.$el.data("dropdown-instance",this);this.addToDOM()},delete:function(){this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray);this.dismissOnScroll&&$(this.dismissOnScroll).off("scroll.dropdown");$(this.window).off("resize.dropdown");a.prototype.delete.call(this)},__onHidden:function(){this.$el.is(":visible")&&this.remove();a.prototype.__onHidden.apply(this,arguments)},getDefaultBoundingBox:function(){var e=this.$el.position().top-5*this.ITEM_HEIGHT,c=e+11*this.ITEM_HEIGHT;0>e&&(e=0);c>$(this.window).height()&&(c=$(this.window).height());return{x:0,y:e,w:$(this.window).width(),h:c-e}},render:function(){this.$placeholder=$("<div/>");this.$el.html(k.template);this.$label=this.$(".dropdown-label");this.$optionList=this.$(".dropdown-option-list");this.$optionListContainer=this.$(".dropdown-option-list-container");var e=this.$optionList.find(".dropdown-option");this.$select.addClass("is-enhanced");this.refreshLabel(this.$select.find(":selected"));e.remove();this.$select.children().each(function(c,g){c=e.clone(!0);c.text($(g).text());c.attr("data-text",$(g).text().toLowerCase());c.attr("data-value",$(g).val());this.$optionList.append(c)}.bind(this));this.$el.addClass(this.$select[0].className).removeClass("dropdown-template").addClass("dropdown");this.$label.append(this.$select);this.$el.attr("tabindex",this.$select.attr("tabindex")||"0");this.$select.attr("tabindex",-1);this.$optionList.on("scroll",this.__onScroll.bind(this));this.$select.on("change",this.__changedOption.bind(this));this.$el.addClass("is-ready")},__fullHeight:function(){return this.$select.children().length*this.ITEM_HEIGHT},__getSelectedIndex:function(){return this.$select[0].selectedIndex},__getTopEdgeInViewport:function(e){return e.offset().top-$(this.document).scrollTop()},__getComputedInfo:function(){var e=this.__getTopEdgeInViewport(this.$el),c=this.__fullHeight(),g=this.__getSelectedIndex()*this.ITEM_HEIGHT,f=this.getDefaultBoundingBox().y,h=this.getDefaultBoundingBox().y+this.getDefaultBoundingBox().h,l=e-g,n=l+c;l<f&&(l=f);if(n>h){var p=n-h;n=h;l>f&&(l-=Math.min(l-f,p))}return{projectedTopDiff:l-e,computedHeight:n-l,selectedTop:g,maxTop:f,maxBottom:h,fullHeight:c}},__refreshScrollers:function(){var e=this.$optionList[0].scrollHeight-this.$optionList.innerHeight(),c=0<this.$optionList.scrollTop();e=Math.round(this.$optionList.scrollTop())<e;this.$el.toggleClass("can-scroll-up",c).toggleClass("can-scroll-down",e)},isOpen:function(){return this.$el.hasClass("is-open")},__hide:function(){this.isOpen()&&($(this.window).off("resize.dropdown"),this.$el.removeClass("is-open"),this.$placeholder.before(this.$el).detach(),this.$el.removeAttr("style"))},__show:function(){if(!this.isOpen()){$(this.window).on("resize.dropdown",b);var e=this.$el.offset(),c=this.$el.width(),g=this.$el.height(),f=this.$el.css("margin-left"),h=this.$el.css("margin-right"),l=this.$el.css("margin-top"),n=this.$el.css("margin-bottom"),p=this.$el.css("float");this.$placeholder.css({width:c,height:g,"margin-left":f,"margin-right":h,"margin-top":l,"margin-bottom":n,float:p});this.$el.addClass("is-open").css({top:this.__getTopEdgeInViewport(this.$el),left:e.left,width:c,height:g,"margin-left":0,"margin-right":0,"margin-top":0,"margin-bottom":0});this.$el=this.$el.before(this.$placeholder).detach();this.$dropdownLayer.append(this.$el)}},toggleOpen:function(e){this.isOpen()?this.__hide():(this.__show(),e=this.__getComputedInfo(),this.$optionListContainer.css({top:e.projectedTopDiff,height:e.computedHeight}),this.$el.focus(),e=e.selectedTop+e.projectedTopDiff,this.$optionList.scrollTop(e),this.__lastScrollTop=e,this.setActiveElement(this.$(".dropdown-option").eq(this.__getSelectedIndex())),this.__refreshScrollers());return!1},refreshLabel:function(e){this.$label.find("> span").text(e.text()).toggleClass("no-value",""===e.val())},clickOption:function(e){this.__hide();this.$select.val($(e.target).attr("data-value"));this.$select.trigger("change");b(e)},selectByValue:function(e){this.$(".is-selected").removeClass("is-selected");this.$('.dropdown-option[data-value="'+e+'"]').addClass("is-selected");this.$("select").val(e);e=this.$("select").find(":selected");this.refreshLabel(e)},val:function(){return this.$("select").val()},__changedOption:function(e){e=$(e.target).find(":selected");this.refreshLabel(e)},__maybeScrollOptionIntoView:function(e,c){if(e[0]){var g=this.$el.hasClass("can-scroll-up"),f=this.$el.hasClass("can-scroll-down"),h=this.$optionList,l=h.height(),n=h.offset().top,p=n+l,q=e.outerHeight();e=e.offset().top;var v=e+q,t=e-n+h.scrollTop(),F=l/2-q/2*3;e<n+(g?q:0)?(c&&(t-=F),h.scrollTop(t-(g?this.ITEM_HEIGHT:0))):v>p-(f?q:0)&&(c&&(t+=F),h.scrollTop(t-(l-q)+(f?q:0)))}},__open:function(e){this.isOpen()&&this.$select.val(this.$optionList.find(".is-selected").attr("data-value")).change();this.toggleOpen(e);e=this.$optionList.children().eq(this.$select[0].selectedIndex);k.NextUtil.DomHelper.radioClass(e,"is-selected");return e},__moveSelection:function(e){e=this.$optionList.children().index(this.$optionList.find(".is-selected"))+e;0>e?e=0:e>this.$select.children().length-1&&(e=this.$select.children().length-1);e=this.$optionList.children().eq(e);k.NextUtil.DomHelper.radioClass(e,"is-selected");return e},setActiveElement:function(e){this.__activeElement=e;k.NextUtil.DomHelper.radioClass(e,"is-selected")},__onKeydown:function(e,c){if(!this.isOpen()&&d.is(c,"VK_ENTER")||!this.isOpen()&&d.is(c,"VK_DOWN"))b(this.$el),this.__open(c);else{var g=this.__activeElement&&this.__activeElement.parent()[0]===this.$optionList[0]?this.__activeElement:this.$(".dropdown-option").first();if(d.is(c,"VK_DOWN"))this.__maybeScrollOptionIntoView(g.next()),g.next()[0]&&this.setActiveElement(g.next());else if(d.is(c,"VK_UP"))this.__maybeScrollOptionIntoView(g.prev()),g.prev()[0]&&this.setActiveElement(g.prev());else if(d.is(c,"VK_ENTER"))this.__hide(),this.$select.val(this.__activeElement.attr("data-value")),this.$select.trigger("change"),b(c);else if(d.is(c,"VK_ESC"))b(this.$el);else{var f=d.getAlphaNumericChar(c);if(!1!==f){var h=g[0];this.__keyValueArray&&this.timer.clearTimeout(this.__keyValueArray);e.push(f);f=e.join("").toLowerCase();for(this.__keyValueArray=this.timer.setTimeout(function(){e.length=0}.bind(this),1e3);h.nextSibling;){h=h.nextSibling;var l=$(h);if(l.attr("data-text")[0]&&k.NextUtil.string.startsWith(l.attr("data-text"),f)){this.isOpen()||this.toggleOpen(c);this.setActiveElement(l);this.__maybeScrollOptionIntoView(l,l[0]!=g[0].nextSibling&&l[0]!=g[0].prevSibling);return}}for(h=this.$(".dropdown-option")[0];h&&h!=g[0];){l=$(h);if(l.attr("data-text")[0]&&k.NextUtil.string.startsWith(l.attr("data-text"),f)){this.isOpen()||this.toggleOpen(c);this.setActiveElement(l);this.__maybeScrollOptionIntoView(l,l[0]!=g[0].nextSibling&&l[0]!=g[0].prevSibling);break}h=h.nextSibling}}}}},__onScroll:function(e){e=this.$optionList.scrollTop();this.__refreshScrollers();this.__lastScrollTop=e},__doScrollUp:function(e,c){e=this.__getComputedInfo();var g=void 0===c?this.AUTO_SCROLL_BY:c;this.$optionListContainer.offset().top+this.$optionListContainer.height()+g<e.maxBottom?(c=this.$optionListContainer.height()+g,c>e.fullHeight&&(c=e.fullHeight),this.$optionListContainer.css({height:c}),this.$optionList[0].scrollTop-=g,this.__refreshScrollers(this.$dropdown)):void 0===c&&(this.$optionList[0].scrollTop-=this.AUTO_SCROLL_BY)},__onScrollUpMouseenter:function(e){this.timer.clearInterval(this.__autoScrollInterval);this.__autoScrollIntervalCounter=0;this.__autoScrollInterval=this.timer.setInterval(function(){this.__doScrollUp(e)}.bind(this),1)},__onScrollUpMouseleave:function(e){this.timer.clearInterval(this.__autoScrollInterval)},__doScrollDown:function(e,c){e=this.__getComputedInfo();var g=void 0===c?this.AUTO_SCROLL_BY:c;if(this.$optionListContainer.offset().top-g>e.maxTop){var f=this.$optionListContainer.height()+g;c=this.$optionListContainer.position().top-g;f>e.fullHeight?f=e.fullHeight:this.$optionListContainer.css({top:c});this.$optionListContainer.css({height:f});this.$optionList[0].scrollTop+=g;this.__refreshScrollers(this.$dropdown)}else void 0===c&&(this.$optionList[0].scrollTop+=this.AUTO_SCROLL_BY)},__onScrollDownMouseenter:function(e){this.timer.clearInterval(this.__autoScrollDownInterval);this.__autoScrollDownIntervalCounter=0;this.__autoScrollDownInterval=this.timer.setInterval(function(){this.__doScrollDown(e)}.bind(this),1)},__onScrollDownMouseleave:function(e){this.timer.clearInterval(this.__autoScrollDownInterval)}})}({NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],template:pa}),qa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return""},3:function(b,a,d,e){return" no-header"},5:function(b,a,d,e){var c,g=a.helperMissing;d='\n            <div class="wh-20">';if((a=(c=a.icon||b&&b.icon||g,c.call(b,"icon-chatwindow_close",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)d+=a;return d+"</div>\n        "},7:function(b,a,d,e){var c,g=a.helperMissing;d='\n            <div class="wh-20">';if((a=(c=a.icon||b&&b.icon||g,c.call(b,"icon-dialog_close",{name:"icon",hash:{class:"wh-full"},data:e})))||0===a)d+=a;return d+"</div>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='<div class="dialog-container ',h=a["if"].call(b,b&&b.headerIsVisible,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(h||0===h)f+=h;f+='">\n    <a href="#" class="dialog-x">\n        ';if((h=(c=a.platform||b&&b.platform||d,c.call(b,"mobile",{name:"platform",hash:{},fn:this.program(5,e),inverse:this.program(7,e),data:e})))||0===h)f+=h;return f+'\n    </a>\n    <header class="dialog-header">\n        <h3 class="dialog-title nowrap">'+g((c=a.title||b&&b.title,"function"===typeof c?c.call(b,{name:"title",hash:{},data:e}):c))+'</h3>\n    </header>\n    <div class="aux-header"></div>\n    <section class="dialog-body"></section>\n    <footer class="dialog-footer"></footer>\n</div>\n'},useData:!0})}({}),ra=function(k){var b=k.AlloyAlertDialog;return b.extend("AlloyConfirmDialog",{uiContextName:"confirm_dialog_alloy",className:"confirm-dialog-alloy",trackedEvents:function(){return[{type:"click",selector:'[data-confirm="yes"]',name:"confirm",handler:"__onConfirm",attributes:{which:this.__confirmDialogType}},{type:"click",selector:'[data-confirm="no"]',name:"deny",handler:"__onDeny",attributes:{which:this.__confirmDialogType}}]},initialize:function(a){a.title=a.title;a.text=a.text;this.yes=a.yes;this.no=a.no;this.__confirmDialogType=a.confirmDialogType;this.darkText=IMVU.optionalProperty(a,"dark_text",!1);this.eventAttributes=IMVU.optionalProperty(a,"eventAttributes",{});b.prototype.initialize.call(this,a)},postRender:function(){b.prototype.postRender.call(this);this.$el.attr("data-type","confirm");this.setContent("body",k.template,{yes:this.yes,no:this.no});var a=this.$(".dialog-footer-template");this.$(".dialog-footer").html("");this.setContent("footer",a.last().text());this.darkText&&this.$el.addClass("dark-text")},__onConfirm:function(){var a=_.extend(this.getResult(),{confirm:"yes"});this.promiseResolver.resolve(a);this.hide()},__onDeny:function(){var a=_.extend(this.getResult(),{confirm:"no"});this.promiseResolver.reject(a);this.hide()},__getUiAttributes:function(a){return _.extend(this.eventAttributes,b.prototype.__getUiAttributes.call(this,a))}})}({AlloyAlertDialog:function(k){var b=k.AlloyModalDialog;return b.extend("AlloyAlertDialog",{uiContextName:"alert_dialog_alloy",className:"alert-dialog-alloy",dependencies:["externalNextRoot"],trackedEvents:function(){return[{type:"click",selector:'[data-confirm="ok"]',name:"confirm",handler:"__onConfirm"},{type:"change",selector:"#dialog-dropdown",name:"option",handler:"__toggleConfirmButton"}]},initialize:function(a){this.title=a.title;this.text=a.text;this.html=a.html;this.darkText=IMVU.optionalProperty(a,"dark_text",!1);b.prototype.initialize.call(this,a);this.ok=a.ok||this.__stringManager.get("OK");this.checkbox=a.checkbox;this.dropdown=a.dropdown;this.termsOfService=a.termsOfService;this.checkedByDefault=_.isUndefined(a.checkedByDefault)?!0:a.checkedByDefault;this.addToDOM()},postRender:function(){this.setContent("body",k.template,{text:this.text,html:this.html,ok:this.ok,checkbox:this.checkbox,dropdown:this.dropdown,termsOfService:this.termsOfService,checkedByDefault:this.checkedByDefault,policyHubUrl:this.__externalNextRoot+"policyhub/"});this.setContent("footer",this.$(".dialog-footer-template").last().text());this.$("#dialog-dropdown").length&&(_.each(this.dropdown.options,function(a){this.$("#dialog-dropdown").append('<option value="'+a.value+'">'+a.label+"</option>")}.bind(this)),this.reasonDropDown=this.createChildContext(k.Dropdown,{$replaceElement:this.$("#dialog-dropdown")}));this.$(".dialog-title").toggleClass("long-title",this.title&&19<this.title.length);this.darkText&&this.$el.addClass("dark-text");this.__toggleConfirmButton()},getResult:function(){var a={},d=this.$("#dialog-checkbox"),e=this.$("#dialog-dropdown");d.length&&(a.checked=d.is(":checked"));e.length&&(a.dropdown=e.val());return a},__onConfirm:function(){this.$(".btn-primary").prop("disabled",!0);this.promiseResolver.resolve(this.getResult());this.hide()},__toggleConfirmButton:function(){this.$("#dialog-dropdown").length?this.$(".btn-primary").prop("disabled",!this.$("#dialog-dropdown").val()):this.$(".btn-primary").prop("disabled",!1)}})}({AlloyModalDialog:function(k){var b=k.UIContextExtension;return b.extend("AlloyModalDialog",{uiContextName:"modal_dialog_alloy",className:"alloy-modal-dialog",dependencies:["appMonitor","globalStringManager","nextRoot","Promise","window"],hasCloseButton:!0,headerIsVisible:!0,contentAreas:{header:".dialog-header",auxHeader:".aux-header",body:".dialog-body",footer:".dialog-footer"},initialize:function(a){b.prototype.initialize.call(this,a);"undefined"!==typeof a.hasCloseButton&&(this.hasCloseButton=a.hasCloseButton);"undefined"!==typeof a.headerIsVisible&&(this.headerIsVisible=a.headerIsVisible);this.serviceProvider=a.serviceProvider;this.__appMonitor=a.appMonitor;this.dialogManager=a.dialogManager;this.__stringManager=a.globalStringManager;this.__nextRootBase=this.__nextRoot.replace("/next/","");this.__postToParent="undefined"===typeof a.postToParent?!0:a.postToParent;this.canCloseWithOverlayClick=IMVU.optionalProperty(a,"canCloseWithOverlayClick",!0);this.__appMonitor.waypoint("AlloyModalDialog::initialize:"+this.constructor.name);this.finished=new a.Promise(function(d){this.promiseResolver=d}.bind(this));this.shouldFocusOnPrimaryButton=!0;a=this.delete.bind(this);this.finished.then(a,a);this.$el.attr("data-ui-role","modal-dialog");this.$el.on("focusin",function(d){this.$el.closest("html").addClass("dialog-focused")}.bind(this));this.$el.on("focusout",function(d){this.$(d.target).closest(".dropdown").length||this.$el.closest("html").removeClass("dialog-focused")}.bind(this));this.$el.trigger("focusout");this.__postToParent&&this.__window.parent&&this.__window.parent.postMessage&&this.__window.parent.postMessage({message:"opening_modal_dialog",type:this.uiContextName},"*")},render:function(){var a=this;this.doWork([function(){a.$el.html(k.template({title:a.title||"",headerIsVisible:a.headerIsVisible}));a.$(".dialog-x").on("click",a.__onClose.bind(a));a.$el.toggleClass("can-dismiss",a.hasCloseButton);a.postRender();a.$el.closest("html").attr("data-dialog",a.uiContextName);a.__focusPrimaryButton();a.$el.is(".dialog-type-B, .dialog-type-B-flexible")&&a.$el.closest("body").is(".mobile")&&470>a.$el.width()&&(a.$el.is(".text-close")?a.$(".dialog-x").text("Close"):a.$el.is(".text-done")?a.$(".dialog-x").text("Done"):a.$el.is(".text-none")?a.$(".dialog-x").text(""):a.$(".dialog-x").text("Cancel"),a.__adjustTitlePosition())}])},__adjustTitlePosition:function(){this.$(".dialog-title").removeClass("overflowed");var a=this.$(".dialog-title").width(),d=this.$(".dialog-header").width();a<=d-160?this.$(".dialog-title").toggleClass("overflowed",!1):this.$(".dialog-title").toggleClass("overflowed",!0)},linkToDetailsSubmode:function(a,d){this.serviceProvider.get("historyManager").setState({fragment:this.__urlId(d.id),mode:{id:a},submode:{id:d.id,summary:{model:d}}})&&(a=function(){this.serviceProvider.get("historyManager").silentMoveHistory(-1)}.bind(this),this.finished.then(a,a))},show:function(){this.__appMonitor.waypoint("AlloyModalDialog::show:"+this.constructor.name);b.prototype.show.call(this);this.__focusPrimaryButton()},hide:function(){this.__appMonitor.waypoint("AlloyModalDialog::hide:"+this.constructor.name);b.prototype.hide.call(this);this.$el.closest("html").removeAttr("data-dialog")},close:function(){this.__appMonitor.waypoint("AlloyModalDialog::close:"+this.constructor.name);this.hide();this.promiseResolver.reject()},closeAll:function(a){a.preventDefault();this.__recordEvent("click",{name:"dialog_close"});this.__dialogManager.closeAll()},showHeader:function(){this.headerIsVisible=!0;this.$(".dialog-container").removeClass("no-header")},hideHeader:function(){this.headerIsVisible=!1;this.$(".dialog-container").addClass("no-header")},toggleHeader:function(){this.headerIsVisible?this.hideHeader():this.showHeader()},__onClose:function(a){a.preventDefault();this.__recordEvent("click",{name:"dialog_close"});this.close()},__focusPrimaryButton:function(){if(this.shouldFocusOnPrimaryButton){var a=this.$(".btn-primary");1<a.length?a.trigger("blur"):a.first().focus()}},updateDialogTitle:function(a){this.$(".dialog-header .dialog-title").text(a);this.__adjustTitlePosition()},delete:function(){this.__appMonitor.waypoint("AlloyModalDialog::delete:"+this.constructor.name);this.__postToParent&&this.__window.parent&&this.__window.parent.postMessage&&this.__window.parent.postMessage({message:"deleting_modal_dialog",type:this.uiContextName},"*");b.prototype.delete.call(this)}})}({UiCore:m["@UiCore"],UIContextExtension:D,template:qa}),Dropdown:w,template:oa}),template:na}),sa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c,g=a.helperMissing;d='\n        <button class="btn btn-primary btn-dark disabled">\n            ';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"IN CART",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n        </button>\n    "},3:function(b,a,d,e){var c,g=a.helperMissing;d=this.escapeExpression;var f='\n        <button class="btn btn-primary btn-dark">\n            ';if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"ADD TO CART FOR",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+"&nbsp;<span>"+d((c=a.sale_price||b&&b.sale_price,"function"===typeof c?c.call(b,{name:"sale_price",hash:{},data:e}):c))+"</span>\n        </button>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c,g=this.escapeExpression;d='<div class="multicart-upgrade-panel">\n    <img class="product-ad" src="'+g((c=a.product_ad_url||b&&b.product_ad_url,"function"===typeof c?c.call(b,{name:"product_ad_url",hash:{},data:e}):c))+'">\n    <div class="title">\n        '+g((c=a.subtitle||b&&b.subtitle,"function"===typeof c?c.call(b,{name:"subtitle",hash:{},data:e}):c))+'\n    </div>\n    <div class="description"></div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    ';if((b=a["if"].call(b,b&&b.in_cart,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===b)d+=b;return d+"\n<\/script>\n"},useData:!0})}({}),ta=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("MultiCartUpgrade",{className:"multicart-upgrade-dialog dialog-type-B",uiContextName:"multicart_upgrade_dialog",dependencies:["dollarStoreManager","featureAccessManager","globalStringManager","model"],trackedEvents:function(){return[{type:"click",selector:".btn-primary",name:"add_to_cart",handler:"__addToCart"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__model.node.attributes.name;this.__cartCollection=IMVU.optionalProperty(a,"cartCollection",null);this.__inCart=!1;this.__package_map={};this.__package_map.dlg_namechange={subtitle_key:"UPGRADE_NAME_CHANGE_TOKEN_TITLE",desc_key:"UPGRADE_NAME_CHANGE_TOKEN_DESC"};this.__package_map.dlg_accesspass={subtitle_key:"UPGRADE_ACCESS_PASS_TITLE",desc_key:"UPGRADE_ACCESS_PASS_DESC"};this.__package_map.dlg_namereg={subtitle_key:"UPGRADE_NAME_REGISTRATION_TITLE",desc_key:"UPGRADE_NAME_REGISTRATION_DESC"};this.__package_map.dlg_ageverify={subtitle_key:"UPGRADE_AGE_VERIFICATION_TITLE",desc_key:"UPGRADE_AGE_VERIFICATION_DESC"};this.__package_map.dlg_sharedroom={subtitle_key:"UPGRADE_SHARED_ROOM_TITLE",desc_key:"UPGRADE_SHARED_ROOM_DESC"};this.__package_map.dlg_chatroomslot={subtitle_key:"UPGRADE_CHATROOM_SLOT_TITLE",desc_key:"UPGRADE_CHATROOM_SLOT_DESC"};this.__package_map.dlg_marriagepackage={subtitle_key:"UPGRADE_MARRIAGE_LICENSE_TITLE",desc_key:"UPGRADE_MARRIAGE_LICENSE_DESC"};this.__package_map.dlg_vip={subtitle_key:"UPGRADE_VIP_TITLE",desc_key:"UPGRADE_VIP_DESC"};this.__package_map.dlg_tiered_vip={subtitle_key:"UPGRADE_VIP_TITLE",desc_key:"UPGRADE_"+this.__model.node.get("code_name")};this.__package_map.dlg_host_subscription={subtitle_key:"UPGRADE_HOST_SUB_TITLE",desc_key:"UPGRADE_HOST_SUB_DESC",dlg_title:"UPGRADE_HOST_SUB_DLG_TITLE"};this.__package_map.dlg_credits={subtitle_key:"UPGRADE_CREDITS_TITLE",desc_key:"UPGRADE_CREDITS_DESC"};this.__package_map.vcoin={subtitle_key:"UPGRADE_VCOIN_TITLE",desc_key:"UPGRADE_VCOIN_DESC",dlg_title:"UPGRADE_VCOIN_DLG_TITLE"};this.__package_map.dlg_badge_canvas={subtitle_key:"UPGRADE_BADGE_CANVAS_SUBTITLE",desc_key:"UPGRADE_BADGE_CANVAS_DESC"};this.__dlgName=this.__model.node.get("dlg_name");(a=this.__package_map[this.__dlgName])?(this.__subtitle=this.__globalStringManager.get(a.subtitle_key),this.__description=this.__globalStringManager.get(a.desc_key),a.dlg_title&&(this.title=this.__globalStringManager.get(a.dlg_title))):(this.__subtitle=this.__globalStringManager.get("UPGRADE_CREDITS_TITLE"),this.__description=this.__globalStringManager.get("UPGRADE_CREDITS_DESC"));"dlg_tiered_vip"==this.__model.node.get("dlg_name")&&(a={},this.__description=k.multiProductUpsellVipTiers((a[this.__model.node.get("code_name")]=1,a.canSeeYouTube=this.__featureAccessManager.canSeeYouTubePreRecorded(),a)));this.addToDOM();this.$(".dialog-container").addClass(this.__dlgName)},postRender:function(){this.__cartCollection&&this.__package_map[this.__dlgName]&&("vip"===this.__model.node.attributes.category||"hosting"===this.__model.node.attributes.category)&&(this.__inCart=this.__isMatchingProductId());this.setContent("body",k.template,{product_ad_url:this.__model.node.get("dlg_background_url"),subtitle:this.__subtitle,sale_price:this.__model.edge.attributes.sale_price_formatted,in_cart:this.__inCart});this.$(".description").html(this.__description);this.setContent("footer",this.$(".dialog-footer-template").text())},__addToCart:function(){this.close();this.__model.trigger("select_and_add_item_to_cart")},__isMatchingProductId:function(){return!_.isEmpty(_.filter(this.__cartCollection.models,function(a){if(void 0!==this.__model.node.attributes.id&&void 0!==a.attributes.node.id)return this.__model.node.attributes.id===a.attributes.node.id}.bind(this)))}})}({Dialogs:m["@Dialogs"],Model:m["@Model"],UiCore:m["@UiCore"],multiProductUpsellVipTiers:E,template:sa}),ua=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;return"\n            <p class='desc'>"+d((c=a.email_msg||b&&b.email_msg,"function"===typeof c?c.call(b,{name:"email_msg",hash:{},data:e}):c))+"</p>\n        "},3:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression;return"\n            <p class='desc'>"+g((c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"TwoFactorChallenge.desc",{name:"i18n-g",hash:{},data:e})))+"</p>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;var g=a.helperMissing,f='<div class="content-container">\n    <div class="content-block">\n        ',h=a["if"].call(b,b&&b.email_msg,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(h||0===h)f+=h;return f+"\n        <div class='input-panel'>\n            <input class='two-factor-code' required maxlength='6' placeholder=\""+d((c=a.placeholder||b&&b.placeholder,"function"===typeof c?c.call(b,{name:"placeholder",hash:{},data:e}):c))+"\">\n            <div class='enrollment-error'></div>\n        </div>\n\n        <div class='link-panel'>\n            <p class='change-email'>\n                "+d((c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"TwoFactorEnrollment.cant_access_email",{name:"i18n-g",hash:{},data:e})))+"\n                <span class='change-email'>"+d((c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"TwoFactorEnrollment.change_email",{name:"i18n-g",hash:{},data:e})))+"</span>\n            </p>\n            <p class='new-code'>\n                "+d((c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"TwoFactorEnrollment.need_another_code",{name:"i18n-g",hash:{},data:e})))+"\n                <span class='new-code'>"+d((c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"TwoFactorEnrollment.send_a_new_code",{name:"i18n-g",hash:{},data:e})))+'</span>\n            </p>\n        </div>\n\n    </div>\n</div>\n\n<footer class="dialog-footer">\n    <button class="btn btn-primary disabled submit">'+d((c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"Continue",{name:"i18n-g",hash:{},data:e})))+"</button>\n</footer>\n"},useData:!0})}({}),va=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="content-container">\n    <div class="content-block">\n        <legend class="system-info-header">\n            ',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"email address",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='\n        </legend>\n\n        <div class=\'input-panel\'>\n            <input class=\'two-factor-email\' required placeholder="Email">\n            <ul class=\'email-error\'>\n                <li class="error-message hidden"></li>\n            </ul>\n            <input class=\'two-factor-password\' type="password" required placeholder="Password">\n            <ul class=\'password-error\'>\n                <li class="error-message hidden"></li>\n            </ul>\n        </div>\n\n    </div>\n</div>\n\n<footer class="dialog-footer">\n    <button class="btn btn-primary send-code disabled">\n        ';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"TwoFactorChangeEmail.button",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"\n    </button>\n</footer>\n"},useData:!0})}({}),G=function(k){return IMVU.BaseClass.extend("StringManager",{dependencies:["cookieManager","dictionary","window"],initialize:function(b){this.__cookieManager=b.cookieManager;this.__dictionary=b.dictionary;this.__window=b.window;if(!this.__dictionary)throw Error("StringManager requires a dictionary");this.__appMonitor=null;this.serviceProvider=b.serviceProvider},__getAppMonitor:function(){if(!this.__appMonitor&&this.serviceProvider.has("appMonitor")){var b=this.serviceProvider.get("appMonitor");b&&(this.__appMonitor=b)}return this.__appMonitor},__process_placeholders:function(b,a){_.each(a,function(d,e){b=b.replace(new RegExp("{{\\s*"+e+"\\s*}}","g"),d)});return b},isImvuese:function(){return"1"===this.__cookieManager.get("imvuese")},get:function(b,a){if(this.isImvuese())return"{"+b+"}";var d=this.__dictionary[b];if(!_.isString(d))throw a='Unable to find text: "'+b+'" in translation dictionary. Use getWithDefault to set default value.',this.__getAppMonitor()?this.__appMonitor.reportCustomError("StringManager","get","web_perm_0018",a,["Suspect CID["+this.__myCid+"]","this.__mySelf...",JSON.stringify(this.__myself)]):this.__window.appMonitorPending.push(["UIContextExtension","initialize","web_perm_0018",a,["Bad key["+b+"]"]]),Error(a);return this.__process_placeholders(d,a)},getWithDefault:function(b,a,d){if(this.isImvuese())return"{"+b+"}";if("string"!==typeof a)throw Error("defaultText must be a string, but got "+IMVU.repr(a));b=this.__dictionary[b];return _.isString(b)?this.__process_placeholders(b,d):a},getPluralized:function(b,a){if(this.isImvuese())return"{"+b+"}";var d=parseInt(a.howMany,10);return 0===d?this.get(b+"_none",a):this.get(b+(2>d?"_singular":"_plural"),a)},handlebarsHelper:function(b,a){return this.get(b,a.hash)},handlebarsHelperWithDefault:function(b,a,d){return this.getWithDefault(b,a,d)}})}({}),wa=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("TwoFactorChangeEmail",{uiContextName:"two_factor_change_email_dialog",className:"two-factor-change-email-dialog dialog-type-B",dependencies:"dialogManager globalStartupModel globalStringManager loginManager rest serviceProvider".split(" "),trackedEvents:function(){return[{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack},{type:"keyup",selector:".two-factor-email",name:"typing_email",handler:this.__onTypingEmail},{type:"click",selector:".btn-primary",name:"send_code",handler:this.__sendCode}]},initialize:function(a){b.prototype.initialize.call(this,a);this.shouldFocusOnPrimaryButton=!1;this.title=this.__globalStringManager.get("TwoFactorChangeEmail.title");this.__myself=a.loginManager.getCurrentUser();this.__settingsDict=this.__serviceProvider.create(k.StringManager,{dictionary:k.settingsDict});this.addToDOM()},delete:function(){b.prototype.delete.call(this)},close:function(){this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.setContent("body",k.template,{});this.$("input.two-factor-email").focus()},__goBack:function(){this.hide();this.promiseResolver.reject()},__onTypingEmail:function(){var a=this.$("input.two-factor-email").val();/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,3}$/.test(String(a).toLowerCase())?this.$(".btn-primary").removeClass("disabled"):this.$(".btn-primary").hasClass("disabled")||this.$(".btn-primary").addClass("disabled")},__sendCode:function(){var a=this.__globalStartupModel.get("changeEmailUrl");this.$(".error-message").addClass("hidden");this.__rest.post(a,{new_email:this.$("input.two-factor-email").val(),password:this.$("input.two-factor-password").val()}).then(function(d){202===d.xhr.status?this.promiseResolver.resolve({code:"change_email_challenge",new_email:this.$("input.two-factor-email").val(),password:this.$("input.two-factor-password").val(),email_url:this.__globalStartupModel.get("changeEmailUrl")}):(this.trigger("new_email_address_saved"),this.promiseResolver.resolve({code:"new_email_saved",new_email:this.$("input.two-factor-email").val()}))}.bind(this)).catch(function(d){var e="",c=!1;switch(d.error.error){case"CHANGE_EMAIL-001":d=this.__settingsDict.get("CHANGE_EMAIL_SAME_AS_OLD");e=".email-error";break;case"CHANGE_EMAIL-002":d=this.__settingsDict.get("CHANGE_EMAIL_ALREADY_IN_USE");e=".email-error";break;case"CHANGE_EMAIL-003":d=this.__settingsDict.get("CHANGE_EMAIL_INVALID_FORMAT");e=".email-error";break;case"CHANGE_EMAIL-004":d=this.__settingsDict.get("CHANGE_EMAIL_WRONG_PASSWORD");e=".password-error";break;case"CHANGE_EMAIL-005":d=this.__settingsDict.get("CHANGE_EMAIL_CHANGED_RECENTLY");c=!0;break;case"CHANGE_EMAIL-006":d=this.__settingsDict.get("CHANGE_EMAIL_ACCOUNT_ON_HOLD");e=".email-error";break;default:d=d.error.message}c?this.__dialogManager.alert({title:this.__globalStringManager.get("oops"),text:d,ok:this.__globalStringManager.get("OK")}):(this.$(e+" .error-message").text(d),this.$(e+" .error-message").removeClass("hidden"))}.bind(this))}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],settingsDict:m["json!/common/withme/i18n/settings.json"],StringManager:G,template:va}),xa=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("TwoFactorEnrollment",{uiContextName:"two_factor_enrollment_dialog",className:"two-factor-enrollment-dialog dialog-type-B",dependencies:["dialogManager","globalStringManager","loginManager","securitySettingsManager","window"],trackedEvents:function(){return[{type:"click",selector:".btn-primary",name:"continue",handler:this.__clickContinue},{type:"input",selector:".two-factor-code",name:"typing_code",handler:this.__onTypingCode},{type:"keyup",selector:".two-factor-code",name:"typing_code",handler:this.__onKeyUp},{type:"click",selector:"span.change-email",name:"change_email",handler:this.__clickChangeEmail},{type:"click",selector:"span.new-code",name:"new_code",handler:this.__clickSendNewCode}]},initialize:function(a){b.prototype.initialize.call(this,a);this.shouldFocusOnPrimaryButton=!1;this.title=this.__globalStringManager.get("TwoFactorEnrollment.title");this.__myself=this.__loginManager.getCurrentUser();this.__isEnabling=IMVU.optionalProperty(a,"isEnabling",!0);this.__regex_not_allowed=/[ ]/gi;this.__securitySettingsManager.toggle2FA({enabling:this.__isEnabling}).then(function(d){if(d.error&&"failure"===d.error.status||d.error&&"NetworkFailure"===d.error.error){var e=d.error.message;"SECURITY_SETTINGS-003"===d.error.error&&(e=this.__globalStringManager.get("TwoFactorEnrollment.apple_signed_in"));this.__dialogManager.showDialog(k.Dialogs.AlloyAlertDialog,{title:this.__globalStringManager.get("Error"),text:e,ok:this.__globalStringManager.get("OKAY")}).finished.then(function(){this.addToDOM()}.bind(this)).catch(function(){this.close()}.bind(this))}else{this.__email_msg=null;if(d.response&&d.response.message&&d.response.details)try{this.__email_addr=d.response.details.email_address,this.__email_msg=d.response.message.replace("%email_address",this.__email_addr)}catch(c){this.__window.console.error(c)}this.addToDOM()}}.bind(this))},close:function(){this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},postRender:function(){this.setContent("body",k.template,{email_msg:this.__email_msg,placeholder:this.__globalStringManager.get("TwoFactorEnrollment.code_placeholder")});!1===this.__isEnabling&&this.$(".change-email").addClass("hidden")},__onKeyUp:function(a){a.keyCode===k.NextUtil.Keys.VK_ENTER&&(this.$(".btn-primary").hasClass("disabled")||this.__clickContinue())},__onTypingCode:function(){var a=this.$("input.two-factor-code").val();-1<a.search(this.__regex_not_allowed)&&(a=a.replace(this.__regex_not_allowed,""),this.$("input.two-factor-code").val(a));a&&a.length===this.$("input.two-factor-code")[0].maxLength?this.$(".btn-primary").removeClass("disabled"):this.$(".btn-primary").hasClass("disabled")||(this.$(".btn-primary").addClass("disabled"),this.$(".enrollment-error").removeClass("error-visible"),this.$(".two-factor-code").removeClass("error-visible"))},__clickContinue:function(){this.__securitySettingsManager.toggle2FA({enabling:this.__isEnabling,code:this.$("input.two-factor-code").val()}).then(function(a){200===a.xhr.status?this.promiseResolver.resolve("valid_code"):(a&&a.error?(this.$(".enrollment-error").addClass("error-visible"),"SECURITY_SETTINGS-002"===a.error.error?this.$(".enrollment-error").text(this.__globalStringManager.get("TwoFactorEnrollment.incorrect_code")):this.$(".enrollment-error").text(a.error.message)):(this.$(".enrollment-error").addClass("error-visible"),this.$(".enrollment-error").text(this.__globalStringManager.get("message_error.generic_title"))),this.$(".two-factor-code").addClass("error-visible"))}.bind(this)).catch(function(){this.$(".enrollment-error").addClass("error-visible");this.$(".enrollment-error").text(this.__globalStringManager.get("message_error.generic_title"))}.bind(this))},__clickChangeEmail:function(){this.__dialogManager.showDialog(k.TwoFactorChangeEmail,{}).finished.then(function(a){"new_email_saved"===a.code?(a=this.__obfuscateEmail(a.new_email),this.__email_msg=this.__email_msg.replace(this.__email_addr,a),this.__email_addr=a,this.$(".content-block p.desc").text(this.__email_msg)):this.__window.console.log("Unexpected error, resp:",a)}.bind(this)).catch(function(){}.bind(this))},__obfuscateEmail:function(a){a=a.split("@");var d=a[0].length,e=3<d?a[0].substr(d-3):"";e=e.padStart(d,"*");return[e,"@",a[1]].join("")},__clickSendNewCode:function(){this.__securitySettingsManager.toggle2FA({enabling:this.__isEnabling}).then(function(a){var d=this.__globalStringManager.get("message_error.generic_title"),e=this.__globalStringManager.get("TwoFactorNewCode.title");a.response?d="SECURITY_SETTINGS-001"===a.response.error?this.__globalStringManager.get("TwoFactorNewCode.desc"):a.response.message:a.error&&(d=a.error.message,e=this.__globalStringManager.get("oops"));this.__dialogManager.showDialog(k.Dialogs.AlloyAlertDialog,{title:e,text:d,ok:this.__globalStringManager.get("OKAY"),postToParent:!1})}.bind(this))}})}({Dialogs:m["@Dialogs"],NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],TwoFactorChangeEmail:wa,template:ua}),x=function(k){var b=k.Dialogs.AlloyConfirmDialog;return b.extend("TwoFactorSetupAlert",{uiContextName:"two_factor_setup_alert_dialog",className:"two-factor-setup-alert-dialog",dependencies:["dialogManager","globalStringManager","loginManager","securitySettingsManager"],initialize:function(a){this.__dialogManager=a.dialogManager;this.__stringManager=a.globalStringManager;this.__requireSetup=IMVU.optionalProperty(a,"requireSetup",!0);var d=a.text?a.text:this.__requireSetup?this.__stringManager.get("TwoFactorSetupAlert.text"):this.__stringManager.get("TwoFactorSetupAlert.optional_text");a=_.extend({title:this.__stringManager.get("TwoFactorSetupAlert.title"),html:d,yes:this.__stringManager.get("TwoFactorSetupAlert.setup"),no:this.__requireSetup?this.__stringManager.get("CANCEL"):this.__stringManager.get("TwoFactorSetupAlert.skip")},a);b.prototype.initialize.call(this,a);this.$el.removeClass("can-dismiss")},__onConfirm:function(){this.__dialogManager.showDialog(k.TwoFactorEnrollment,{isEnabling:!0}).finished.then(function(){this.promiseResolver.resolve()}.bind(this)).catch(function(){this.promiseResolver.reject()}.bind(this))}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],TwoFactorEnrollment:xa}),ya=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("TooltipDialog",{uiContextName:"tooltip_dialog",className:"tooltip-dialog dialog-type-B text-close",trackedEvents:function(){return this.__customTrackedEvents},initialize:function(a){this.__customTrackedEvents=a.trackedEvents||[];b.prototype.initialize.call(this,a);this.title=a.title;this.__tooltipContent=a.tooltipContent;this.addToDOM()},postRender:function(){this.setContent("body",this.__tooltipContent)}})}({Dialogs:m["@Dialogs"]}),r=function(k){var b=k.UiCore.UiContext;return b.extend("Tooltip",{className:"tooltip",uiContextName:"tooltip",dependencies:["dialogManager","timer","tooltipLayer","window"],trackedEvents:function(){return[{type:"click",selector:"a",name:"link_click",handler:"__clickedLink",allowBubble:!0}].concat(this.__customTrackedEvents)},__installTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.on("mouseenter.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.$target.off("mouseleave.tooltip")}.bind(this));this.__tooltipLayer.$el.on("mouseleave.tooltip",".tooltip",function(){this.__timer.clearTimeout(this.__tooltipTimeout);this.__tooltipTimeout=this.__timer.setTimeout(function(){this.setVisible(!1);this.__timer.clearTimeout(this.__tooltipTimeout);this.__tooltipTimeout=this.__timer.setTimeout(function(){this.__hide();this.__installTargetMouseleave()}.bind(this),125)}.bind(this),250)}.bind(this))},__removeTooltipLayerEventHandlers:function(){this.__tooltipLayer.$el.off(".tooltip")},initialize:function(a){this.$tooltip=IMVU.requireProperty(a,"$replaceElement");this.$target=IMVU.requireProperty(a,"$tooltipTarget");this.tooltipTitle=IMVU.optionalProperty(a,"title",!1);this.__tooltipStyle=IMVU.optionalProperty(a,"tooltipStyle","default");this.__tooltipPosition=IMVU.optionalProperty(a,"tooltipPosition","default");this.__positionDelta=IMVU.optionalProperty(a,"positionDelta",0);this.__forceTargetToUseOuterWidth=IMVU.optionalProperty(a,"forceTargetToUseOuterWidth",!1);this.__customTrackedEvents=a.trackedEvents||[];b.prototype.initialize.call(this,a);this.$body=$("body");this.$globalNav=$("nav.global-nav:visible");if("mobile"===this.__serviceProvider.get("platform"))this.$target.on("click.tooltip",function(d){d.stopPropagation();this.__openTooltipDialog()}.bind(this));else this.$target.on("mouseenter.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.__timer.clearTimeout(this.__targetFadeinTimeout);this.__installTargetMouseleave();this.__targetFadeinTimeout=this.__timer.setTimeout(function(){this.setVisible(!0);this.__show()}.bind(this),250)}.bind(this));"snug"===this.__tooltipStyle&&this.$el.addClass("tooltip-snug");this.$el.append(this.$tooltip);this.setParentUiContext(this.__tooltipLayer);this.__tooltipLayer.$el.append(this.$el);this.__setAsRendered()},setVisible:function(a){this.$el.toggleClass("tooltip-open",!!a)},__installTargetMouseleave:function(){this.$target.on("mouseleave.tooltip",function(){this.__timer.clearTimeout(this.__targetTimeout);this.__targetTimeout=this.__timer.setTimeout(function(){this.setVisible(!1);this.__timer.clearTimeout(this.__targetTimeout);this.__targetTimeout=this.__timer.setTimeout(function(){this.__hide()}.bind(this),125)}.bind(this),250)}.bind(this))},__show:function(){this.__installTooltipLayerEventHandlers();this.__trackTooltip();$(this.__window).on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this));this.$body.find(".transparent-overlay").on("scroll.tooltip",function(){this.__trackTooltip()}.bind(this))},trackTooltip:function(){this.__trackTooltip()},__trackTooltip:function(){var a=this.$globalNav.height()||0,d=this.$target[0].getBoundingClientRect().top,e=this.$target[0].getBoundingClientRect().left,c=$(window).width()-(e+this.$target.outerWidth()/2),g=this.$el[0].offsetWidth;0<this.$target.parents(".dialog-manager").length&&(a=0);var f=this.$target.width();this.__forceTargetToUseOuterWidth&&(f=this.$target.outerWidth());c=c>g?e+f/2:e+f/2-g;"bottom"===this.__tooltipPosition?(c=e-this.$tooltip.outerWidth()/2,d=this.$target[0].getBoundingClientRect().bottom-this.__positionDelta):"above"===this.__tooltipPosition?(c=e+f/2-g,d=this.$target[0].getBoundingClientRect().top-this.$el[0].offsetHeight):"left"===this.__tooltipPosition?(c=e-f-g-this.__positionDelta,d=this.$target[0].getBoundingClientRect().top):"bottom-left-edge"===this.__tooltipPosition&&(c=e,d=0);this.$el.css({"margin-top":Math.max(d,a),"margin-left":c})},__hide:function(){this.__removeTooltipLayerEventHandlers();this.setVisible(!1)},__openTooltipDialog:function(){return this.__dialogManager.showDialog(k.TooltipDialog,{title:this.tooltipTitle||this.$target.text(),tooltipContent:this.$tooltip.html(),trackedEvents:this.__customTrackedEvents})},delete:function(){this.$el.removeAttr("style");this.__timer.clearTimeout(this.__targetFadeinTimeout);this.__timer.clearTimeout(this.__targetTimeout);this.__timer.clearTimeout(this.__tooltipTimeout);this.$target.off(".tooltip");this.__removeTooltipLayerEventHandlers();$(this.__window).off("scroll.tooltip");this.$body.find(".transparent-overlay").off("scroll.tooltip");b.prototype.delete.call(this)},__clickedLink:function(a){this.__hide()}})}({UiCore:m["@UiCore"],TooltipDialog:ya}),H=function(k){var b=k.Dialogs.AlloyConfirmDialog;return b.extend("LinkUpholdDialog",{uiContextName:"link_uphold_dialog",className:"link-uphold-dialog",dependencies:["globalStringManager","loginManager"],trackedEvents:function(){return[{type:"click",name:"link_uphold_account",selector:"[data-confirm=yes]",handler:this.__onLink},{type:"click",name:"cancel_linking_uphold_account",selector:"[data-confirm=no]",handler:this.__onCancel}]},initialize:function(a){this.__globalStringManager=a.globalStringManager;this.__loginManager=a.loginManager;this.__wallet=IMVU.optionalProperty(a,"wallet",null);null===this.__wallet&&(this.__myself=this.__loginManager.getCurrentUser(),this.__myself.populated().then(function(){this.__wallet=this.__myself.getSingleEdge("wallet")}.bind(this)));a.title=this.__globalStringManager.get("vcoin_link_uphold_account");a.text=this.__globalStringManager.get("vcoin_link_uphold_text");a.yes=this.__globalStringManager.get("Continue");a.no=this.__globalStringManager.get("Cancel");this.hasCloseButton=!1;b.prototype.initialize.call(this,a)},postRender:function(){b.prototype.postRender.call(this)},__onCancel:function(){this.close()},__onLink:function(){this.__wallet.populated().then(function(){this.__upholdLink=this.__wallet.get("uphold_url");this.__window.open(this.__upholdLink,"_blank");this.close()}.bind(this))}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"]}),za=function(k){var b=k.UiCore.UiContext;return b.extend("MultiProductItem",{uiContextName:"multi_product_item",tagName:"article",className:"multi-product-item",dependencies:"dialogManager dollarStoreManager featureAccessManager globalStringManager googleAnalytics iconManager imageManager leanplum loginManager model securitySettingsManager urlManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".wrapper:not(.is-active) .item-info",name:"choose_product_item",handler:"__userClickedUpper"},{type:"click",selector:".wrapper:not(.is-active) .item-price",name:"choose_product_item",handler:"__userClickedLower"},{type:"click",selector:".wrapper:not(.is-active).upsell",name:"choose_product_item",handler:"__userClickedLower"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__viewType=IMVU.optionalProperty(a,"viewType","row");this.__category=IMVU.optionalProperty(a,"category",null);this.__cartCollection=this.__parentUiContext.getCartCollection?this.__parentUiContext.getCartCollection():null;this.__isMobile=this.__featureAccessManager.isMobile();this.__isUpsell=IMVU.optionalProperty(a,"isUpsell",!1);this.__specialCase=null;this.__userClicked=!1;this.__upsellDialog=IMVU.optionalProperty(a,"upsellDialog",null);this.addToDOM()},render:function(){b.prototype.render.call(this);this.__model.populated().then(function(){this.__category=this.__model.node.get("category");this.__isTieredVIP="vip"===this.__category&&"dlg_tiered_vip"===this.__model.node.get("dlg_name");this.__isActive=-1!==this.__model.edge.get("rules").indexOf("active");this.__renderTemplate();this.$el.data("id",this.__model.node.get("product_packages_id"));this.__isActive?(this.__isTieredVIP&&this.__upsellDialog&&this.__upsellDialog.switchDescription&&this.__upsellDialog.switchDescription(this.__model.node.get("code_name")),this.$el.addClass("is-active"),this.$(".wrapper").addClass("is-active")):(this.listenTo(this.__model,"removed_from_cart",this.__onRemoveFromCart),this.listenTo(this.__model,"select_and_add_item_to_cart",this.__selectAndAddItemToCart),this.listenTo(this.__model,"add_pending_item_to_cart",this.__addPendingItemToCart));this.createChildContext(k.Tooltip,{$replaceElement:this.$(".pend-tooltip"),$tooltipTarget:this.$(".pend-multiplier"),tooltipPosition:"bottom"});this.__isUpsell&&(this.$el.addClass("upsell"),this.$(".wrapper").addClass("upsell"),this.__isActive&&this.$(".label-active").removeClass("hidden"));this.__window.addEventListener("message",this.__receiveMessage.bind(this),!0);this.$el.addClass(this.__viewType+"-view");this.$el.addClass("category-"+this.__category);"vip"===this.__category&&"dlg_tiered_vip"===this.__model.node.get("dlg_name")&&(this.$el.addClass(this.__model.node.get("code_name")),this.$el.addClass("tiered_vip"))}.bind(this))},__selectAndAddItemToCart:function(){this.__selectItem()},__addPendingItemToCart:function(){this.__selectItem({pended:!0})},__confirmVIPDowngrade:function(a){var d=["","gold","platinum","diamond"],e=this.__model.edge.get("metadata.tier"),c=this.__model.node.get("code_name").substr(-1);d=this.__globalStringManager.get("vip_downgrade_"+d[e]+"_to_"+d[c]+"_body");this.__dialogManager.confirm({title:this.__globalStringManager.get("common_subscription_cancel_confirm_dialog_title"),text:d,no:this.__globalStringManager.get("CANCEL"),yes:this.__globalStringManager.get("OKAY")}).finished.then(function(){a()})},__vcoinErrorCheck:function(a,d){d=void 0===d?{}:d;d=d.rules_hit?d.rules_hit:this.__dollarStoreManager.validateMultiCartShoppingRules(this.__model,this.__cartCollection);var e=this.__model.edge.get("metadata.available_for_purchase"),c=this.__dollarStoreManager.getCartVcoinTotal(),g=this.__model.node.attributes.vcoin;if(d.includes("region_blocked")&&!this.__ignoreRegionBlockedRule)this.__upsellDialog?(this.__upsellDialog.trigger("vcoin_product_selected_in_blocked_region"),a()):this.__showVcoinUnavailableDialog(a);else if(d.includes("purchase_limit")&&d.includes("unavailable")||c+g>e)d='<a href="'+this.__urlManager.get("vcoin_limits")+'" target="_blank">'+this.__globalStringManager.get("vcoin_unavailable_limit_reached_error_message_link")+"</a>",d="<p>"+this.__globalStringManager.get("vcoin_unavailable_limit_reached_error_message")+" "+d+".</p>",this.__dialogManager.alert({title:this.__globalStringManager.get("vcoin_unavailable_limit_reached_error_title"),html:d,ok:this.__globalStringManager.get("OKAY"),dark_text:!0}).finished.then(function(){this.__upsellDialog&&this.__upsellDialog.upsellAfterGift&&this.__dialogManager.closeAll()}.bind(this));else{if(d.includes("requires_kyc")&&d.includes("unavailable"))return this.__dialogManager.showDialog(k.LinkUpholdDialog,{}).finished.then(function(){this.$el.removeClass("is-selected")}.bind(this));d.includes("require_2FA")?this.__dollarStoreManager.userHasTwoFactorAuth()?(this.__canBuyVcoinWithRules=!0,a()):this.__securitySettingsManager.get("2fa_enabled").then(function(f){this.__dollarStoreManager.setUserTwoFactorAuthStatus(f["2fa_enabled"]);if(f["2fa_enabled"])this.__canBuyVcoinWithRules=!0,a();else return this.__dialogManager.showDialog(k.TwoFactorSetupAlertDialog,{requireSetup:!0}).finished.then(function(){this.__dollarStoreManager.setUserTwoFactorAuthStatus(!0);this.__canBuyVcoinWithRules=!0;a()}.bind(this))}.bind(this)):a()}},__showVcoinUnavailableDialog:function(a){var d='<a href="'+this.__urlManager.get("unavailable_vcoin")+'" target="_blank">'+this.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_link")+"</a>";d="<p>"+this.__globalStringManager.get("vcoin_unavailable_error_text")+" "+d+"</p>";this.__dialogManager.showDialog(k.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("vcoin_unavailable_error_title"),text:this.__globalStringManager.get("vcoin_unavailable_error_text"),html:d,yes:this.__globalStringManager.get("Continue"),no:this.__globalStringManager.get("CANCEL"),dark_text:!0}).finished.then(function(){this.__ignoreRegionBlockedRule=!0;this.__vcoinErrorCheck(a)}.bind(this))},__userClickedUpper:function(){if(this.__upsellDialog)this.__userClickedLower();else{this.__userClicked=!0;var a=function(){this.__dollarStoreManager.validateAccountStatus(this.__model).then(function(){return this.__dialogManager.showDialog(k.MultiCartUpgrade,{model:this.__model,cartCollection:this.__cartCollection}).finished.then(function(){}.bind(this))}.bind(this))}.bind(this);"vcoin"===this.__category?this.__vcoinErrorCheck(a):a()}},__selectItem:function(a){var d=this;a=void 0===a?{pended:!1}:a;"vip"===this.__category&&this.__productSwap(this.__model,this.__category);var e=this.__dollarStoreManager.validateMultiCartShoppingRules(this.__model,this.__cartCollection);-1!==e.indexOf("require_2FA")&&"vcoin"!==this.__category?this.__dollarStoreManager.userHasTwoFactorAuth()?(e=_.without(e,"require_2FA"),this.__handleSelection(a,e)):this.__securitySettingsManager.get("2fa_enabled").then(function(c){d.__dollarStoreManager.setUserTwoFactorAuthStatus(c["2fa_enabled"]);if(c["2fa_enabled"])e=_.without(e,"require_2FA"),d.__handleSelection(a,e);else return d.__dialogManager.showDialog(k.TwoFactorSetupAlertDialog,{requireSetup:!0}).finished.then(function(){d.__dollarStoreManager.setUserTwoFactorAuthStatus(!0);e=_.without(e,"require_2FA");d.__handleSelection(a,e)})}):"vcoin"===this.__category?e.includes("purchase_limit")||(e=_.without(e,"region_blocked"),this.__vcoinErrorCheck(function(){return d.__handleSelection(a,e)},{rules_hit:e})):-1!==e.indexOf("downgrade")&&"vip"===this.__category?(e=_.without(e,"downgrade"),this.__userClicked?this.__confirmVIPDowngrade(function(){return d.__handleSelection(a,e)}):this.__handleSelection(a,e)):this.__handleSelection(a,e)},__handleSelection:function(a,d){if(_.isEmpty(d)||"vcoin"===this.__category&&this.__canBuyVcoinWithRules){d=parseInt(this.$(".multiplier").attr("cart-count"),10);var e=parseInt(this.$(".pend-multiplier").attr("pend-count"),10);a.pended?this.$(".pend-multiplier").attr("pend-count",++e):(this.__dollarStoreManager.trigger("select_multicart_item",this.__model),this.$el.hasClass("is-selected")||this.$el.addClass("is-selected"),this.$(".multiplier").attr("cart-count",++d));!this.__dollarStoreManager.isLoading()&&this.__userClicked&&this.__dollarStoreManager.trigger("update_persistent_cart",this.__model,d)}else if(this.__userClicked){var c=[];a="";_.each(d,function(g){try{c.push(this.__globalStringManager.get(g))}catch(f){c.push(g)}}.bind(this));c=c.join(" ");a=this.__globalStringManager.get("rules_dialog_title");["apple","google_play"].includes(this.__model.edge.attributes["metadata.provider"])?(c=this.__globalStringManager.get("vip_upsell_previous_subscription_mobile_body",{company:this.__globalStringManager.get("vip_upsell_company_3"),platform:this.__globalStringManager.get("vip_upsell_platform_3")}),a=this.__globalStringManager.get("vip_upsell_previous_subscription_title")):"unavailable"===c&&(c=this.__globalStringManager.get("add_to_cart_error_unavailable_text"));return this.__dialogManager.showDialog(k.Dialogs.AlloyAlertDialog,{title:a,text:c,ok:this.__globalStringManager.get("add_to_cart_error_ok")})}this.__userClicked=!1},__userClickedLower:function(){var a=this,d=null;this.__wasSelected=this.$el.hasClass("is-selected");this.__upsellDialog?d=function(){a.__isTieredVIP&&a.__upsellDialog&&a.__upsellDialog.switchDescription&&a.__upsellDialog.switchDescription(a.__model.node.get("code_name"));a.$el.siblings().removeClass("is-selected");a.$el.toggleClass("is-selected",!a.__wasSelected);a.__upsellDialog.aProductClicked(a.__wasSelected?null:a.__model,a.__category)}:(this.__userClicked=!0,d=function(){this.__selectItem()}.bind(this));"vcoin"===this.__category?this.__vcoinErrorCheck(d):d()},__receiveMessage:function(a){a.data.showDialog&&(this.codeName=a.data.showDialog,this.codeName===this.__model.node.attributes.code_name&&this.__userClickedLower())},__refreshProduct:function(){this.__model.invalidate();this.render()},__renderTemplate:function(){var a=this.__model.edge.get("normal_price")>this.__model.edge.get("sale_price"),d="1"===this.__model.node.get("most_popular"),e=this.__model.node.get("is_best"),c=this.__model.node.get("name"),g=this.__model.node.get("initial_selection");"vip"===this.__category&&(c=this.__model.node.get("name"));this.$el.html(k.template({image:this.__model.node.get("img160x160"),price:this.__model.edge.get("normal_price_formatted"),sale_price:this.__model.edge.get("sale_price_formatted"),title:c,title2:"",title3:"",has_discount:a,is_popular:d,is_best:e,sale_copy:this.__globalStringManager.get("SALE"),isRow:"row"===this.__viewType,isActive:this.__isActive,isMobileAndUpsell:this.__isMobile&&this.__isUpsell,line2_text:"",isVIP:"vip"===this.__category}));""!==this.__model.node.get("svgicon")&&(a=this.__model.node.get("svgicon"),this.$(".icon-wrapper").html(this.__iconManager.iconHtml(a)));this.__isMobile&&this.__isUpsell&&"vip"===this.__category&&this.$(".line2").addClass("hidden");!this.__isUpsell||this.__upsellDialog&&this.__upsellDialog.upsellAfterGift||g&&this.__userClickedLower();g=this.__model.node.get("should_disable");a=this.__model.node.get("disabled");!0===g?(this.$el.addClass("disabled"),this.__model.node.set("should_disable",null)):this.$el.toggleClass("disabled",void 0===a?!1:a)},__onRemoveFromCart:function(a,d){d=void 0!==d?d:!0;a=_.map(a.models,function(e){return e.attributes.node.product_packages_id});-1===_.indexOf(a,this.__model.node.attributes.product_packages_id)?(this.$el.removeClass("is-selected"),a=0):a=this.$(".multiplier").attr("cart-count")-1;this.$(".multiplier").attr("cart-count",a);d&&this.__dollarStoreManager.trigger("update_persistent_cart",this.__model,a)},__productSwap:function(a,d){_.each(this.__cartCollection.models,function(e){if(e&&e.attributes.node.category===d&&a.node.attributes.product_packages_id!==e.attributes.node.product_packages_id)return this.__cartCollection.remove(e),0===this.__cartCollection.length&&this.__dollarStoreManager.trigger("empty_multi_cart"),this.__dollarStoreManager.trigger("update_cart_total_price"),e.attributes.productModel.trigger("removed_from_cart",this.__cartCollection),!1}.bind(this))},_setCartCollection:function(a){this.__cartCollection=a}})}({Dialogs:m["@Dialogs"],NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],AlloyConfirmDialog:ra,LinkUpholdDialog:H,MultiCartUpgrade:ta,Tooltip:r,TwoFactorSetupAlertDialog:x,template:ma}),Aa=function(k){var b=k.UiCore.ListPresenter;return b.extend("MultiProductList",{className:"multi-product-list",uiContextName:"multi_product_list",tagName:"section",dependencies:["category","featureAccessManager","globalStringManager","platform"],trackedEvents:function(){return[{type:"click",selector:".more-items",name:"more_items",handler:"__onToggleMoreItems"}]},initialize:function(a){this.itemFactory=a.itemFactory||k.MultiProductItem;var d=!a.collection||0===a.collection.length;this.__cartCollection=IMVU.optionalProperty(a,"cartCollection",null);this.__isUpsell=IMVU.optionalProperty(a,"isUpsell",!1);this.__noInitialUpsellSelection=IMVU.optionalProperty(a,"noInitialUpsellSelection",!1);this.__headerText=IMVU.optionalProperty(a,"headerText","");this.__disabledProducts=IMVU.optionalProperty(a,"disabledProducts",[]);this.__selectedProduct=IMVU.optionalProperty(a,"selectedProduct",!1);this.__featureAccessManager=a.featureAccessManager;this.__isUpsell&&!d&&(this.__noInitialUpsellSelection?this.__unsetInitialUpsellSelection(a.collection.models):this.__setInitialUpsellSelection(a.collection.models));b.prototype.initialize.call(this,a);this.__isMobile=this.__featureAccessManager.isMobile();this.$el.prepend(k.template({category:this.__globalStringManager.get(this.__category),header_text:this.__headerText,no_products:d}));this.__isUpsell&&(this.$el.addClass("upsell"),this.__headerText||this.$(".system-info-header").remove());if("credits"===this.__category||"vcoin"===this.__category)"credits"===this.__category?(this.__moreOptionsText=this.__globalStringManager.get("MORE CREDIT OPTIONS"),this.__lessOptionsText=this.__globalStringManager.get("Less Credit Options")):"vcoin"===this.__category&&(this.__moreOptionsText=this.__globalStringManager.get("More VCOIN Options"),this.__lessOptionsText=this.__globalStringManager.get("Less VCOIN Options")),this.$(".system-info-header .more-items .description").text(this.__moreOptionsText),this.$(".system-info-header .more-items").removeClass("hidden"),this.__childSelector="article:nth-of-type(n+4)",this.__isUpsell||this.$(this.__childSelector).addClass("is-collapsed")},getCartCollection:function(){return this.__cartCollection},__setInitialUpsellSelection:function(a){var d=this;if(void 0!==a&&0!==a.length){var e=-1,c=-1;e=a.findIndex(function(g){return"1"===g.node.get("most_popular")});c=a.findIndex(function(g){return(g=g.edge.get("rules"))&&-1!==g.indexOf("active")});a.forEach(function(g,f){g.node.set("should_disable",d.__disabledProducts.includes(f))});!1!==this.__selectedProduct?a[Math.max(0,Math.min(a.length-1,this.__selectedProduct))].node.set("initial_selection",!0):-1!==e&&e>c?a[e].node.set("initial_selection",!0):this.__unsetInitialUpsellSelection(a)}},__unsetInitialUpsellSelection:function(a){void 0!==a&&0!==a.length&&a.forEach(function(d){d.node&&d.node.get("initial_selection")&&d.node.set("initial_selection",!1)})},__onToggleMoreItems:function(){this.$(this.__childSelector).toggleClass("is-collapsed");this.$(this.__childSelector).hasClass("is-collapsed")?(this.$(".more-items .indicator").text("+ "),this.$(".system-info-header .more-items .description").text(this.__moreOptionsText)):(this.$(this.__childSelector).css({transition:"height 0.25s ease"}),this.$(".more-items .indicator").text("- "),this.$(".system-info-header .more-items .description").text(this.__lessOptionsText))}})}({UiCore:m["@UiCore"],MultiProductItem:za,template:la}),Ba=function(k){return IMVU.NamedCollection.extend("CartCollection",{markSelectedProducts:function(){this.each(function(b){b.set("is_selected",!0)}.bind(this))}})}({}),Ca=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c,g=a.helperMissing;d="\n    <div class='alert-message title'>";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"payment_processing_error_text_2",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</div>\n"},3:function(b,a,d,e){a=this.escapeExpression;return"\n        <div class='alert-message'>"+a("function"===typeof b?b.apply(b):b)+"</div>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="content-container">\n\n',f=a.unless.call(b,b&&b.isNoHope,{name:"unless",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(f||0===f)g+=f;g+="\n\n    ";if((f=a.each.call(b,b&&b.messages,{name:"each",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n\n    <div class='alert-message summary'>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"payment_processing_error_text_3",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"\n        <a target='_blank' href='https://help.imvu.com/'>help.imvu.com</a>.\n    </div>\n</div>\n"},useData:!0})}({}),Da=function(k){var b=k.Dialogs.AlloyAlertDialog;return b.extend("MultiCartErrorDialog",{uiContextName:"multicart_error_dialog",className:"multicart-error-dialog dialog-type-B",dependencies:["globalStringManager","window"],initialize:function(a){this.__stringManager=a.globalStringManager;this.__keys=IMVU.requireProperty(a,"keys");a.title=this.__stringManager.get("payment_processing_status_title");a.ok=this.__stringManager.get("payment_processing_error_button");this.__storeDictionary=a.serviceProvider.create(k.StringManager,{dictionary:k.storeDictionary});a.serviceProvider.register("storeDictionary",this.__storeDictionary);Handlebars.registerHelper("storeDict_i18n",this.__storeDictionary.handlebarsHelper.bind(this.__storeDictionary));b.prototype.initialize.call(this,a)},postRender:function(){b.prototype.postRender.call(this);var a=[],d=!1,e=!1;_.each(this.__keys,function(c,g,f){try{a.push(this.__storeDictionary.get(c))}catch(h){this.__window.console.error("Error key not found in dict: %s\n%s",c,h),d||(a.push(this.__storeDictionary.get("FCM_default")),d=!0)}"co_blocked"===c&&(e=!0)}.bind(this));this.$(".id-body-contents").html(k.template({messages:a,isNoHope:e}));this.$(".content-container").scrollbar()}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],storeDictionary:m["json!@StoreModeDictionary"],StringManager:G,template:Ca}),Ea=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;return"<iframe class='frame-base' src='"+d((c=a.src||b&&b.src,"function"===typeof c?c.call(b,{name:"src",hash:{},data:e}):c))+"'></iframe>\n"},useData:!0})}({}),Fa=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("IframeDialog",{uiContextName:"iframe_dialog",className:"iframe-dialog dialog-type-B",dependencies:"dialogManager globalStartupModel globalStringManager platform rest window".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.__platform=a.platform;this.title="undefined"===typeof a.titleID?"":this.__globalStringManager.get(a.titleID);this.__src=a.src;this.__hideHeader="undefined"===typeof a.hideHeader?!0:!0===a.hideHeader;this.__hideFooter="undefined"===typeof a.hideFooter?!0:!0===a.hideFooter;this.addToDOM();a.isCreatorLanding||this.__window.addEventListener("message",this.__receiveMessage.bind(this),!0)},makeSeamless:function(){this.$(".frame-base").hasClass("seamless")||this.$(".frame-base").addClass("seamless")},postRender:function(){this.setContent("body",k.template,{src:this.__src});this.makeSeamless();this.__hideHeader&&(this.$(".dialog-header").addClass("hide"),this.$(".aux-header").addClass("hide"));this.__hideFooter&&this.$(".dialog-footer").addClass("hide")},setClasses:function(a,d){a.removeClass("dialog-type-B");a.removeClass("can-dismiss");a.removeClass("iframe-dialog");a.removeClass(d);a.addClass("iframe-dialog");a.addClass(d);a.addClass("dialog-type-B");a.addClass("can-dismiss")},close:function(){this.__window.removeEventListener("message",this.__receiveMessage.bind(this),!0);b.prototype.close.call(this)},__receiveMessage:function(a){"no_dialog_in_iframe"===a.data.message?b.prototype.close.call(this):"close_iframe_dialog"===a.data.message?b.prototype.close.call(this):("opening_modal_dialog"===a.data.message&&("alert_dialog_alloy"===a.data.type||"confirm_dialog_alloy"===a.data.type||"two_factor_setup_alert_dialog"===a.data.type||"link_uphold_dialog"===a.data.type?this.$(".dialog-x").addClass("hidden"):"payment_wall_dialog"===a.data.type?(this.isUncancellableDialog=!0,this.$el.addClass("payment-wall-open")):this.$(".dialog-x").removeClass("hidden")),"deleting_modal_dialog"===a.data.message?"confirm_dialog_alloy"===a.data.type?this.$(".dialog-x").removeClass("hidden"):"alert_dialog_alloy"===a.data.type?(this.$(".dialog-x").removeClass("hidden"),this.close()):"payment_wall_dialog"===a.data.type&&(this.isUncancellableDialog=!1,this.$el.removeClass("payment-wall-open")):"iframe_open_new_window"===a.data.message&&this.__window.open(a.data.params.url,a.data.params.name?a.data.params.name:"_blank"))},delete:function(){this.__window.removeEventListener("message",this.__receiveMessage.bind(this),!0);b.prototype.delete.call(this)}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],template:Ea}),Ga=function(k){var b=k.IframeBase;return b.extend("PaymentWallDialog",{uiContextName:"payment_wall_dialog",className:"payment-wall-dialog text-close",dependencies:["dialogManager"],trackedEvents:function(){return[]},initialize:function(a){a=_.extend({titleID:"payment_dialog_title",hideHeader:!1,hideFooter:!0},a);b.prototype.initialize.call(this,a);this.makeSeamless();this.addToDOM();this.$el.addClass(a.paymentWallChan)},postRender:function(){b.prototype.postRender.call(this);b.prototype.setClasses(this.$el,this.className);this.__contextualClassRemoved=this.__dialogManager.toggleTransparentOverlaySize(!1)},hide:function(){this.__contextualClassRemoved&&this.__dialogManager.toggleTransparentOverlaySize(!0);b.prototype.hide.call(this)}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],IframeBase:Fa}),Ha=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;return'\n        <div class="title">'+d((c=a.status_prompt||b&&b.status_prompt,"function"===typeof c?c.call(b,{name:"status_prompt",hash:{},data:e}):c))+"</div>\n        "},3:function(b,a,d,e){return"\n            <div class='other-payment-channel-list'>\n                <span class='name'>PAY WITH VCOIN</span>\n                <img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'>\n            </div>            \n    "},5:function(b,a,d,e){d="\n        ";if((b=a["if"].call(b,b&&b.billingInfo,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===b)d+=b;return d+"            \n    "},6:function(b,a,d,e){var c,g=a.helperMissing;d='\n            <legend class="system-info-header">\n                ';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"BILLED TO",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+'\n            </legend>\n            <div class="billing-info"></div>\n        '},8:function(b,a,d,e){d="\n        ";if((b=a["if"].call(b,b&&b.isCheckedoutModel,{name:"if",hash:{},fn:this.program(9,e),inverse:this.noop,data:e}))||0===b)d+=b;return d+"\n        "},9:function(b,a,d,e){var c;d=this.escapeExpression;var g='\n            <div class="order-row">\n                <div class="order-item">\n                    <div class="image-container"><img src="'+d((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.node),null==c||!1===c?c:c.img160x160),"function"===typeof c?c.apply(b):c))+'"></div>\n                    <div class="item-info">\n                        <div class="item-name">'+d((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.node),null==c||!1===c?c:c.name),"function"===typeof c?c.apply(b):c))+"</div>\n                        ";if((c=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(10,e),inverse:this.program(12,e),data:e}))||0===c)g+=c;return g+"\n                    </div>\n                </div>\n            </div>\n        "},10:function(b,a,d,e){var c;a=this.escapeExpression;return'\n                            <div class="product-price"><img src=\'https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg\'><span class="item-info-price">'+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.vcoin_sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</span></div>\n                        "},12:function(b,a,d,e){var c;a=this.escapeExpression;return'\n                            <div class="product-price">'+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</div>\n                        "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;var g=a.helperMissing,f='<div class="payment-content-container">\n    <div class="info-block message">\n        ',h=a["if"].call(b,b&&b.notPaymentWall,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(h||0===h)f+=h;f+='\n        <div class="text">'+d((c=a.status_message||b&&b.status_message,"function"===typeof c?c.call(b,{name:"status_message",hash:{},data:e}):c))+"</div>\n    </div>\n    ";if((h=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(3,e),inverse:this.program(5,e),data:e}))||0===h)f+=h;f+='\n    <legend class="system-info-header">\n        ';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"YOUR ORDER",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='\n    </legend>\n    <div class="order-block">\n        ';if((h=a.each.call(b,b&&b.cart,{name:"each",hash:{},fn:this.program(8,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n    </div>\n    <div class="summary-block">\n        <div>';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"Order",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+=" #"+d((c=a.order_id||b&&b.order_id,"function"===typeof c?c.call(b,{name:"order_id",hash:{},data:e}):c))+"</div>\n        <div>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"Purchase date",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+=": "+d((c=a.order_date||b&&b.order_date,"function"===typeof c?c.call(b,{name:"order_date",hash:{},data:e}):c))+'</div>\n\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-dark btn-primary">\n        ';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"payment_success_button",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"\n    </button>\n<\/script>\n"},useData:!0})}({}),y=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;var g='\n<div class="info-line address">'+d((c=a.address||b&&b.address,"function"===typeof c?c.call(b,{name:"address",hash:{},data:e}):c))+'</div>\n<div class="info-line">'+d((c=a.city||b&&b.city,"function"===typeof c?c.call(b,{name:"city",hash:{},data:e}):c))+", ",f=a["if"].call(b,b&&b.state,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e});if(f||0===f)g+=f;g+=" ";if((f=a["if"].call(b,b&&b.postal_code,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===f)g+=f;return g+d((c=a.country||b&&b.country,"function"===typeof c?c.call(b,{name:"country",hash:{},data:e}):c))+"</div>\n"},2:function(b,a,d,e){var c;d=this.escapeExpression;return" "+d((c=a.state||b&&b.state,"function"===typeof c?c.call(b,{name:"state",hash:{},data:e}):c))+" "},4:function(b,a,d,e){var c;d=this.escapeExpression;return" "+d((c=a.postal_code||b&&b.postal_code,"function"===typeof c?c.call(b,{name:"postal_code",hash:{},data:e}):c))+", "},6:function(b,a,d,e){var c;d=this.escapeExpression;var g=a.helperMissing,f='\n<div class="info-line card-type">'+d((c=a.card_type||b&&b.card_type,"function"===typeof c?c.call(b,{name:"card_type",hash:{},data:e}):c))+" ";if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"ending in",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+" -"+d((c=a.last_four_digits||b&&b.last_four_digits,"function"===typeof c?c.call(b,{name:"last_four_digits",hash:{},data:e}):c))+"</div>\n"},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;d='<div class="info-line name-on-card">'+d((c=a.name||b&&b.name,"function"===typeof c?c.call(b,{name:"name",hash:{},data:e}):c))+"</div>\n";if((c=a["if"].call(b,b&&b.address,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===c)d+=c;d+="\n";if((c=a["if"].call(b,b&&b.last_four_digits,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===c)d+=c;return d},useData:!0})}({}),I=function(k){var b=[{name:"americanexpress",pattern:/^3[47]/},{name:"jcb",pattern:/^35(2[89]|[3-8][0-9])/},{name:"visa",pattern:/^4/},{name:"mastercard",pattern:/^5[1-5]/},{name:"discover",pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/}];return{getType:function(a){for(var d=$jscomp.makeIterator(b),e=d.next();!e.done;e=d.next())if(e=e.value,a.match(e.pattern))return e.name;return null},passesChecksum:function(a){for(var d=0,e=!1,c=a.length-1;0<=c;c--){var g=a.charAt(c);g=parseInt(g,10);e&&(g*=2,9<g&&(g-=9));d+=g;e=!e}return 0===d%10}}}({}),J=function(k){var b=k.UiCore.UiContext;return b.extend("BillingInfo",{className:"billing-info",uiContextName:"billing_info",dependencies:["globalStringManager"],initialize:function(a){b.prototype.initialize.call(this,a);this.__billingInfo=IMVU.requireProperty(a,"billingInfo");this.__CCValidator=k.CCValidator;this.addToDOM()},render:function(){var a="",d="";this.__billingInfo.credit_card&&(a=this.__CCValidator.getType(this.__billingInfo.credit_card),d=this.__billingInfo.credit_card.substring(this.__billingInfo.credit_card.length-4));this.$el.html(k.template({name:this.__billingInfo.name,address:this.__billingInfo.address,city:this.__billingInfo.city,state:this.__billingInfo.state,postal_code:this.__billingInfo.postal_code,country:this.__billingInfo.country,card_type:this.__globalStringManager.get("card_type_"+(a?a:"other")),last_four_digits:d}))}})}({UiCore:m["@UiCore"],CCValidator:I,template:y}),K=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("MultiCartSuccessDialog",{uiContextName:"multicart_success_dialog",className:"multicart-success-dialog dialog-type-B text-none",dependencies:"cart dialogManager dollarStoreManager featureAccessManager globalStartupModel globalStringManager loginManager modeManager onboardingGamificationManager orderResponse prefsManager securitySettingsManager timestampHelper window".split(" "),trackedEvents:function(){return[{type:"click",selector:".btn.btn-primary",name:"multicart_success_done",handler:"__done"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__coreDollarstoreProductOfferingData=IMVU.optionalProperty(a,"coreDollarstoreProductOfferingData",null);this.$el.removeClass("can-dismiss");this.__prefsManager=a.prefsManager;this.__hideCalled=!1;this.__origin=IMVU.optionalProperty(a,"origin",null);this.__billingInfo=IMVU.optionalProperty(a,"billingInfo",null);this.__altTitle=IMVU.optionalProperty(a,"altTitle",null);this.__vipModel=IMVU.optionalProperty(a,"vipModel",null);this.__channel=IMVU.optionalProperty(a,"channel",null);this.isVcoinAsAPaymentMethod=!1;this.title=this.__altTitle?this.__altTitle:this.__globalStringManager.get("payment_success_title");this.ok=this.__globalStringManager.get("payment_success_button");this.__creditsPurchased=this.__vipSubscriptionPurchased=!1;a=IMVU.optionalProperty(a,"cart",[]);this.isVcoinAsAPaymentMethod=a.isVcoinAsAPaymentMethod?!0:!1;for(var d=0;d<a.length;d++){var e=a[d].get("node");var c=e.category;var g=e.code_name;this.__setBadgeLocalStorage(c,g);"credits"===c?this.__creditsPurchased=e.credits:"vip"===c?(this.__vipSubscriptionPurchased=!0,["vip_web_tier_1","vip_web_tier_2","vip_web_tier_3"].includes(g)?this.__vipTierPurchased=g:this.__vipTierPurchased="legacy"):"vcoin"===c&&(this.__vcoinPurchased=!0)}this.addToDOM()},postRender:function(){var a=!1,d=this.__timestampHelper.orderDate(this.__orderResponse.get("order_date")),e=this.__globalStringManager.get("order_thankyou");this.__billingInfo&&(a=this.__billingInfo.name?!0:!1);var c=this.__globalStringManager.get("order_status_message");null!==this.__coreDollarstoreProductOfferingData&&this.__coreDollarstoreProductOfferingData.isAGift&&(e=this.__globalStringManager.get("order_thankyou_gifting"),c=this.__globalStringManager.get("order_status_message_gifting_1")+" "+this.__coreDollarstoreProductOfferingData.recipientDisplayName+" "+this.__globalStringManager.get("order_status_message_gifting_2"));"paypal"===this.__channel?null===this.__vipModel&&(c=this.__globalStringManager.get("paypal_order_status_message")):"paymentwall"===this.__channel&&(c=this.__globalStringManager.get("paymentwall_order_status_message"));var g=parseFloat(this.__orderResponse.attributes["order.price"]).toFixed(2);this.setContent("body",k.template({status_prompt:e,cart:this.__cart,has_name:a,billingInfo:this.__billingInfo,order_date:d,order_id:this.__orderResponse.attributes["order.cash_orders_id"],order_total:g,status_message:c,notPaymentWall:"paymentwall"!==this.__channel}));a?this.createChildContext(k.BillingInfo,{$replaceElement:this.$(".billing-info"),billingInfo:this.__billingInfo}):this.__billingInfo&&!0===this.__billingInfo.saved_card&&this.$(".billing-info").html(k.billingTemplate({last_four_digits:this.__billingInfo.last_four_digits,card_type:this.__globalStringManager.get("card_type_"+this.__billingInfo.card_type)}));this.setContent("footer",this.$(".dialog-footer-template").text());if(this.__window._qevents)for(a=0;a<this.__cart.length;a++)d={qacct:"p-EAkvGxbXCcR77",uid:this.__myCid.toString(),orderid:this.__orderResponse.attributes["order.cash_orders_id"],revenue:this.__cart[a].attributes.edge.sale_price.toString(),event:"refresh"},"vip"==this.__cart[a].attributes.node.category?(d.labels="_fp.event.VIP Confirmation Page,_fp.pcat.vip",this.__window._qevents.push(d)):"upgrade"==this.__cart[a].attributes.node.category&&"access_pass"==this.__cart[a].attributes.node.code_name&&(d.labels="_fp.event.AP Confirmation Page,_fp.pcat.upgrade",this.__window._qevents.push(d));if("creatorlanding"===this.__modeManager.uiApplication){var f=[],h=0;_.each(this.__cart,function(l){f.push({product_name:l.attributes.node.code_name,product_id:l.attributes.node.product_packages_id.toString(),product_category:l.attributes.node.category,product_price:l.attributes.edge.sale_price,product_quantity:1});h+=l.attributes.edge.sale_price});try{h=parseFloat(h.toFixed(2)),this.__window.pintrk("track","checkout",{value:h,order_quantity:this.__cart.length,currency:"USD",order_id:this.__orderResponse.attributes["order.cash_orders_id"],line_items:f},function(l,n){l||this.__appMonitor.reportCustomError("MultiCartSuccess","postRender","web_perm_0005l","Error returned from pintrk callback",["Reported Error: "+n])}.bind(this))}catch(l){this.__appMonitor.reportCustomError("MultiCartSuccess","postRender","web_perm_0005e","Error thrown in call to window.pintrk",["Reported Error: "+l.message])}}},__onClose:function(a){a.preventDefault();this.__done();this.hide()},__done:function(){var a=this;this.__recordEvent("click",{name:"dialog_close"});!1===this.__creditsPurchased||this.__myself.get("is_vip")?this.__vipSubscriptionPurchased?(this.__prefsManager.setBool("next.subscriptions.has_active_vip",!0),this.__prefsManager.set("next.subscriptions.active_tier_vip",this.__vipTierPurchased),this.promiseResolver.resolve("clear_cart"),this.hide(),"store"===this.__modeManager.getCurrentMode().id&&(this.__window.location="/next/store/cart")):this.__vcoinPurchased?(this.__featureAccessManager.canSeeOnboardingGamification()&&this.__recordEvent("onboarding",{name:"grant_reward",event_type:"vcoin_purchase",cid:this.__myself.get("legacy_cid"),record:!0}),this.hide(),this.__securitySettingsManager.get("2fa_enabled").then(function(d){d["2fa_enabled"]?a.promiseResolver.resolve():a.__dialogManager.showDialog(k.TwoFactorSetupAlertDialog,{requireSetup:!1}).finished.then(function(){return a.promiseResolver.resolve()}).catch(function(){return a.promiseResolver.resolve()})}).catch(function(d){a.__window.console.log("Something went wrong:",d);a.promiseResolver.resolve()})):(this.promiseResolver.resolve("clear_cart"),this.hide(),this.__modeManager.getCurrentMode()&&"store"===this.__modeManager.getCurrentMode().id&&(this.__window.location="/next/store/cart")):this.__dialogManager.confirm({title:this.__globalStringManager.get("vip_credit_upsell_title"),text:this.__globalStringManager.get("vip_credit_upsell_body",{credits:this.__creditsPurchased}),yes:this.__globalStringManager.get("vip_credit_upsell_yes"),no:this.__globalStringManager.get("vip_credit_upsell_no")}).finished.then(function(){a.__dialogManager.closeAll();a.__dollarStoreManager.makeVIPUpsell()}).catch(function(){a.promiseResolver.resolve("clear_cart");a.hide();a.__dialogManager.closeAll();"store"===a.__modeManager.getCurrentMode().id&&(a.__window.location="/next/store/cart")})},__handleHostSubRedirectMessageLinkClick:function(){this.__modeManager.openMode({mode:{id:"chat"},submode:{id:"my_rooms"}})},__setBadgeLocalStorage:function(a,d){"vip"===a?this.__setBadgeLocalStorageHelper("is_vip"):"upgrade"===a&&"access_pass"===d&&this.__setBadgeLocalStorageHelper("is_ap")},__setBadgeLocalStorageHelper:function(a){var d={value:!0,expiry:(new Date).getTime()+3e5};localStorage.setItem(a,JSON.stringify(d))},hide:function(){this.__hideCalled||(this.__hideCalled=!0,b.prototype.hide.call(this))}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],BillingInfo:J,TwoFactorSetupAlertDialog:x,billingTemplate:y,template:Ha}),L=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("MultiCartAbstractBaseDialog",{dependencies:"dollarStoreManager featureAccessManager loginManager Promise rest restModelFactory".split(" "),initialize:function(a){b.prototype.initialize.call(this,a);this.restModelFactory=a.restModelFactory;this.__eProtectResponse=null},_test_getPoid:function(){return this.__productOfferingID},_testSetBillingInfo:function(a){this.__billingInfo=a},__processingOldDollarstoreProductOffering:function(){return this.__window.location.href.includes("/checkout/")},__getCoreDollarstoreProductOfferingUrlAndId:function(){if(!this.__processingOldDollarstoreProductOffering())return{url:null,id:null};var a=this.__globalStartupModel.get("oldDollarstoreBypassProductOfferingUrl"),d=null;a&&(d=a.split("-"),d=d[d.length-1]);return{url:a,id:d}},__getProductOfferingDataFromCoreDS:function(){var a=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=a.url;this.__coreDollarstoreProductOfferingId=a.id;this.__coreDollarstoreProductOfferingPromise=this.__coreDollarstoreProductOfferingRecipient=this.__coreDollarstoreProductOfferingPurchaser=this.__coreDollarstoreProductOfferingData=null;null!==this.__coreDollarstoreProductOfferingUrl&&(this.__coreDollarstoreProductOfferingPromise=this.__rest.get(this.__coreDollarstoreProductOfferingUrl),this.__coreDollarstoreProductOfferingPromise.then(function(d){this.__coreDollarstoreProductOfferingResponse=d.response;this.__coreDollarstoreProductOfferingPurchaser=this.track(this.restModelFactory.readModel(this.__coreDollarstoreProductOfferingResponse.relations.purchaser,k.UiCore.NodeModel));this.__coreDollarstoreProductOfferingRecipient=this.track(this.restModelFactory.readModel(this.__coreDollarstoreProductOfferingResponse.relations.recipient,k.UiCore.NodeModel));this.__coreDollarstoreProductOfferingPurchaserPromise=this.__coreDollarstoreProductOfferingPurchaser.populated();this.__coreDollarstoreProductOfferingRecipientPromise=this.__coreDollarstoreProductOfferingRecipient.populated();this.__Promise.every([this.__coreDollarstoreProductOfferingPurchaserPromise,this.__coreDollarstoreProductOfferingRecipientPromise]).then(function(){this.__purchaserID=this.__coreDollarstoreProductOfferingPurchaser.get("legacy_cid");this.__purchaserDisplayName=this.__coreDollarstoreProductOfferingPurchaser.get("display_name");this.__recipientID=this.__coreDollarstoreProductOfferingRecipient.get("legacy_cid");this.__recipientDisplayName=this.__coreDollarstoreProductOfferingRecipient.get("display_name");this.__coreDollarstoreProductOfferingData={isAGift:this.__purchaserID!==this.__recipientID,purchaserID:this.__purchaserID,purchaserDisplayName:this.__purchaserDisplayName,recipientID:this.__recipientID,recipientDisplayName:this.__recipientDisplayName}}.bind(this))}.bind(this)).catch(function(d){this.__window.console.error("MultiCartAbstractDialog::__getProductOfferingDataFromCoreDS - error - failed to get product offering",d)}.bind(this)));return this.__coreDollarstoreProductOfferingPromise},creditCardCheckout:function(a){this.__productOfferingID=null;return new this.__Promise(function(d){var e={cart:a.models,cc_payment:this.__billingInfo};!0===this.__billingInfo.saved_card?(e.payment_method="saved_cc_payment",e.card_id=this.__billingInfo.card_id):(e.eprotect=this.__eProtectResponse,e.payment_method="cc_payment");this.__productOfferingID=a.models[0].attributes.edge.product_offering_id;var c=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=c.url;this.__coreDollarstoreProductOfferingId=c.id;this.__coreDollarstoreProductOfferingUrl&&(this.__productOfferingID=this.__coreDollarstoreProductOfferingId);this.__submitVantivOrder(e,this.__productOfferingID).then(function(g){this.__setProcessing(!1);if("delivered"===g.attributes["order.status"]&&"success"===g.attributes["transaction.status"]){var f={expiry:(new Date).getTime()+3e5};localStorage.setItem("successfulVantivOrder",JSON.stringify(f));this.__hostSubscriptionChanged&&(f=parseInt(g.get("order.date_purchased").substring(8,10)),this.__hostSubscriptionChangedText=this.__globalStringManager.get("subscription_changed_text_part_1")+String(f),this.__hostSubscriptionChangedText=1===f||21===f||31===f?this.__hostSubscriptionChangedText+"st, ":2===f||22===f?this.__hostSubscriptionChangedText+"nd, ":3===f||23===f?this.__hostSubscriptionChangedText+"rd, ":this.__hostSubscriptionChangedText+"th, ",this.__hostSubscriptionChangedText+=this.__globalStringManager.get("subscription_changed_text_part_2"));g={billingInfo:this.__billingInfo,cart:a.models,orderResponse:g,channel:"vantiv"};this.__hostSubscriptionChanged&&(g.hostSubscriptionChangedText=this.__hostSubscriptionChangedText);this.__origin&&(g.origin=this.__origin);g.coreDollarstoreProductOfferingData=this.__coreDollarstoreProductOfferingData;this.__dialogManager.showDialog(k.MultiCartSuccess,g).finished.then(function(){return d.accept()}.bind(this)).catch(function(){return d.reject()}.bind(this))}else this.__dialogManager.showDialog(k.MultiCartError,{response:g,keys:g.attributes["transaction.customer_messages"]}).finished.then(function(h){return d.reject("order_fail")}.bind(this)).catch(function(){return d.reject("order_fail")}.bind(this))}.bind(this)).catch(function(g){this.__setProcessing(!1);return this.__displayExceptionDialog(g)}.bind(this))}.bind(this))},vcoinCheckout:function(a){this.__productOfferingID=null;return new this.__Promise(function(d){var e={cart:a.models};this.__productOfferingID=a.models[0].attributes.edge.product_offering_id;var c=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=c.url;this.__coreDollarstoreProductOfferingId=c.id;this.__coreDollarstoreProductOfferingUrl&&(this.__productOfferingID=this.__coreDollarstoreProductOfferingId);this.__submitVcoinOrder(e,this.__productOfferingID).then(function(g){this.__setProcessing(!1);if("delivered"===g.attributes["order.status"]&&"success"===g.attributes["transaction.status"]){var f={value:!0,expiry:(new Date).getTime()+3e5};localStorage.setItem("successfulVcoinOrder",JSON.stringify(f));this.__hostSubscriptionChanged&&(f=parseInt(g.get("order.date_purchased").substring(8,10)),this.__hostSubscriptionChangedText=this.__globalStringManager.get("subscription_changed_text_part_1")+String(f),this.__hostSubscriptionChangedText=1===f||21===f||31===f?this.__hostSubscriptionChangedText+"st, ":2===f||22===f?this.__hostSubscriptionChangedText+"nd, ":3===f||23===f?this.__hostSubscriptionChangedText+"rd, ":this.__hostSubscriptionChangedText+"th, ",this.__hostSubscriptionChangedText+=this.__globalStringManager.get("subscription_changed_text_part_2"));g={cart:a.models,orderResponse:g,channel:"vcoin"};this.__hostSubscriptionChanged&&(g.hostSubscriptionChangedText=this.__hostSubscriptionChangedText);this.__origin&&(g.origin=this.__origin);g.coreDollarstoreProductOfferingData=this.__coreDollarstoreProductOfferingData;this.__dialogManager.showDialog(k.MultiCartSuccess,g).finished.then(function(){return d.accept()}.bind(this)).catch(function(){return d.reject()}.bind(this))}else this.__dialogManager.showDialog(k.MultiCartError,{response:g,keys:g.attributes["transaction.customer_messages"]}).finished.then(function(h){this.promiseResolver.resolve("clear_cart");return d.reject("order_fail")}.bind(this)).catch(function(){this.promiseResolver.resolve("clear_cart");return d.reject("order_fail")}.bind(this))}.bind(this)).catch(function(g){this.__setProcessing(!1);return this.__displayExceptionDialog(g)}.bind(this))}.bind(this))},__setProcessing:function(a){this.$el.toggleClass("loading",a);a?(this.$el.removeClass("can-dismiss"),this.isUncancellableDialog=!0,this.__window.$("body").addClass("waiting")):(this.$el.addClass("can-dismiss"),this.isUncancellableDialog=!1,this.__window.$("body").removeClass("waiting"));this.$(".payment-input").prop("disabled",a);this.$(".dialog-x").prop("disabled",a);this.$("button.checkout").prop("disabled",a)},__openPaypalWindow:function(){var a=!0;this.__closePaypalWindow();this.__paypalUrl=this.__externalNextRoot.replace("next/","paypal/loading/");this.__paypalWindow=this.__window.open(this.__paypalUrl,"_blank");if(!this.__paypalWindow||this.__paypalWindow.closed||"undefined"===typeof this.__paypalWindow.closed)a=!1;return a},__closePaypalWindow:function(){this.__paypalWindow&&(this.__paypalWindow.close(),this.__paypalWindow=null)},__calculateTotal:function(a){var d=0;_.each(a,function(e){e.isCheckedoutModel&&(d+=parseFloat(e.attributes.edge.sale_price))}.bind(this));return d.toFixed(2)},__displayExceptionDialog:function(a){return this.__dialogManager.alert({title:this.__globalStringManager.get("payment_failed_title"),text:this.__globalStringManager.get("payment_failed_text"),ok:this.__globalStringManager.get("payment_failed_button")}).finished.then(function(d){this.promiseResolver.resolve("clear_cart")}.bind(this)).catch(function(d){this.promiseResolver.resolve("clear_cart")}.bind(this))},__displayMultiErrorDialog:function(a,d){return this.__dialogManager.showDialog(k.MultiCartError,{response:a,keys:d}).finished.then(function(e){this.promiseResolver.resolve("clear_cart")}.bind(this)).catch(function(e){this.promiseResolver.resolve("clear_cart")}.bind(this))},__displayPaypalWindowErrorDialog:function(){return this.__dialogManager.alert({title:this.__globalStringManager.get("Error"),text:this.__globalStringManager.get("PAYPAL ERROR OPENING WINDOW"),ok:this.__globalStringManager.get("checkout_error_button")}).finished.then(function(a){this.promiseResolver.reject()}.bind(this))},__buildOrderSelection:function(a){var d=[];_.each(a,function(e){if(e.isCheckedoutModel){var c=_.indexOf(_.pluck(d,"product_packages_id"),e.attributes.node.product_packages_id);-1===c?d.push({product_packages_id:e.attributes.node.product_packages_id,count:e.attributes.edge.selected_count?e.attributes.edge.selected_count:1}):d[c].count+=1}}.bind(this));return d},_testSetChannel:function(a){this.__channel=a},__submitVantivOrder:function(a,d){var e=this.serviceProvider.get("vantiv_threat_metrics_id"),c=this.__globalStartupModel.get("cashOrderTrans"),g=this.__calculateTotal(a.cart),f=this.__buildOrderSelection(a.cart);d={total:g,product_offering_id:d,selected:f};d.payment_authorization_info={tmxsid:e,payment_method:this.__channel.attributes.payment_method,channel:this.__channel.attributes.channel_key,eprotect:a.eprotect};"cc_payment"===a.payment_method?(d.payment_authorization_info.card_name=a.cc_payment.name,d.payment_authorization_info.card_address=a.cc_payment.address,d.payment_authorization_info.card_city=a.cc_payment.city,d.payment_authorization_info.card_state=a.cc_payment.state,d.payment_authorization_info.card_country=a.cc_payment.country,d.payment_authorization_info.card_zipcode=a.cc_payment.postal_code,d.payment_authorization_info.save_card=!0===a.cc_payment.save_card?1:0):"saved_cc_payment"===a.payment_method&&(d.payment_authorization_info.use_saved_card=1,d.payment_authorization_info.saved_card_id=a.card_id);return this.__restModelFactory.createModel(c,k.UiCore.NodeModel,d)},__submitVcoinOrder:function(a,d){var e=this.__globalStartupModel.get("cashOrderTrans"),c=this.__calculateTotal(a.cart);a=this.__buildOrderSelection(a.cart);d={total:c,product_offering_id:d,selected:a};d.payment_authorization_info={payment_method:this.__channel.attributes.payment_method,channel:this.__channel.attributes.channel_key};return this.__restModelFactory.createModel(e,k.UiCore.NodeModel,d)},__paypalCheckout:function(a,d){return new this.__Promise(function(e){if(this.__openPaypalWindow()){this.__setProcessing(!0);var c=d.models[0].attributes.edge.product_offering_id,g=this.__globalStartupModel.get("cashOrderTrans"),f=this.__buildOrderSelection(d.models);c={total:this.__calculateTotal(d.models),product_offering_id:c,selected:f};c.payment_authorization_info={payment_method:a.attributes.payment_method,channel:a.attributes.channel_key};this.__restModelFactory.createModel(g,k.UiCore.NodeModel,c).then(function(h){this.__paypalWindow&&!this.__paypalWindow.closed?(this.__paypalWindow.location=h.get("transaction.auth_url"),this.__showWaitStatusForPaypal(),this.__waitForPaypalResponse(h).then(function(){this.__setProcessing(!1);this.__dialogManager.showDialog(k.MultiCartSuccess,{cart:d.models,vipModel:this.__vipModel,orderResponse:h,altTitle:this.__globalStringManager.get("PAYPAL PROCESS PENDING TITLE"),channel:"paypal",origin:this.__origin}).finished.then(function(l){return e.accept("finished_order_success")}.bind(this)).catch(function(l){return e.accept("finished_order_fail")}.bind(this))}.bind(this)).catch(function(l){this.__displayMultiErrorDialog(h,["paypal_tab_pending"]);return e.accept("finished_order_fail")}.bind(this))):(this.__displayMultiErrorDialog(h,["paypal_tab_error"]),this.__closePaypalWindow())}.bind(this)).catch(function(h){this.__setProcessing(!1);return this.__displayExceptionDialog(h)}.bind(this))}else this.__displayPaypalWindowErrorDialog().then(function(){return e.reject("fail to load paypal window tab")}.bind(this))}.bind(this))},__showWaitStatusForPaypal:function(){this.$(".dialog-container .dialog-header .dialog-title").text(this.__globalStringManager.get("PayPal"));this.$(".checkout-container").addClass("hidden");this.$(".other-checkout-container").addClass("hidden");this.$(".pending-panel").removeClass("hidden");this.$(".dialog-footer .checkout").prop("disabled",!1);this.$(".dialog-footer .checkout").addClass("paypalpending");this.$(".dialog-footer .checkout.paypalpending").text(this.__globalStringManager.get("CANCEL"));this.$(".dialog-footer .checkout.paypalpending").on("click",function(){this.__setProcessing(!1);this.__closePaypalWindow();this.close()}.bind(this))},__waitForPaypalResponse:function(a){this.__response=a;return new this.__Promise(function(d){this.track(this.__response);return this.listenTo(this.__response,"change",function(){this.untrack(this.__response);this.stopListening(this.__response,"change");this.__response.populated().then(function(e){return"delivered"===e.get("order.status")||"need_ipn"===e.get("order.status")||"authorized"===e.get("order.status")||"pended"===e.get("order.status")||"paid"===e.get("order.status")?d.accept("delivered"):d.reject("failed")}.bind(this))}.bind(this))}.bind(this))},__paymentWallCheckout:function(a,d){return new this.__Promise(function(e){var c=d.models[0].attributes.edge.product_offering_id,g=this.__buildOrderSelection(d.models);c={total:this.__calculateTotal(d.models),product_offering_id:c,selected:g};c.payment_authorization_info={payment_method:a.attributes.payment_method,channel:a.attributes.channel_key};g=this.__globalStartupModel.get("cashOrderTrans");this.__restModelFactory.createModel(g,k.UiCore.NodeModel,c).then(function(f){"need_auth"===f.attributes["transaction.status"]?this.__dialogManager.showDialog(k.PaymentWallDialog,{src:f.attributes["transaction.auth_url"],paymentWallChan:a.attributes.channel_key}).finished.then(function(){this.__paymentWallPendingDialog(d,f).then(function(h){return e.accept("delivered")}.bind(this))}.bind(this)).catch(function(){this.__paymentWallPendingDialog(d,f).then(function(h){return e.accept("delivered")}.bind(this))}.bind(this)):this.__displayMultiErrorDialog(f,f.attributes["transaction.customer_messages"])}.bind(this)).catch(function(f){this.__displayExceptionDialog(f)}.bind(this))}.bind(this))},__paymentWallPendingDialog:function(a,d){return new this.__Promise(function(e){this.__dialogManager.showDialog(k.MultiCartSuccess,{cart:a.models,orderResponse:d,altTitle:this.__globalStringManager.get("PAYMENTWALL_PURCHASE_INFO_TITLE"),channel:"paymentwall"}).finished.then(function(){return e.accept("finished_order_success")}.bind(this)).catch(function(){return e.accept("finished_order_success")}.bind(this))}.bind(this))}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],MultiCartError:Da,MultiCartSuccess:K,PaymentWallDialog:Ga}),Ia=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){d="\n        ";var c=a.unless.call(b,(c=b&&b.attributes,null==c||!1===c?c:c.saved_card),{name:"unless",hash:{},fn:this.program(2,e),inverse:this.program(4,e),data:e});if(c||0===c)d+=c;return d+"\n    "},2:function(b,a,d,e){var c;a=this.escapeExpression;return"\n            <li id='"+a((c=b&&b.id,"function"===typeof c?c.apply(b):c))+"'>\n                    <span class='name'>\n                        "+a((c=(c=b&&b.attributes,null==c||!1===c?c:c.display_name),"function"===typeof c?c.apply(b):c))+"\n                    </span>\n                <img src='"+a((c=(c=b&&b.attributes,null==c||!1===c?c:c.icon_url),"function"===typeof c?c.apply(b):c))+"'>\n            </li>\n        "},4:function(b,a,d,e){var c,g;d=this.escapeExpression;var f=a.helperMissing,h="\n            <li id='"+d((c=b&&b.id,"function"===typeof c?c.apply(b):c))+"'>\n                <div class='card-info'>\n                    <p class='card-num'>\n                        XXXX-XXXX-XXXX-"+d((c=(c=b&&b.attributes,null==c||!1===c?c:c.card_last_digits),"function"===typeof c?c.apply(b):c))+"\n                    </p>\n                    <p class='expires'>\n                        <span class='card-type'>"+d((c=(c=b&&b.attributes,null==c||!1===c?c:c.card_type),"function"===typeof c?c.apply(b):c))+"</span>\n                        <span class='card-expire'>";if((c=(g=a["i18n-g"]||b&&b["i18n-g"]||f,g.call(b,"CARD EXPIRY",{name:"i18n-g",hash:{},data:e})))||0===c)h+=c;return h+" "+d((c=(c=b&&b.attributes,null==c||!1===c?c:c.expiry),"function"===typeof c?c.apply(b):c))+"</span>\n                    </p>\n                </div>\n            </li>\n        "},6:function(b,a,d,e){var c,g=a.helperMissing;d="\n        <li id='other-payment-type'>\n            <span class='name'>";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"OTHER PAYMENT TYPE PLURAL",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\n                <span class='right-arrow'></span>\n            </span>\n        </li>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d="<ul class='payment-channel-list'>\n    ";var c=a.each.call(b,b&&b.channels,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(c||0===c)d+=c;d+="\n    ";if((c=a["if"].call(b,b&&b.hasOtherChannels,{name:"if",hash:{},fn:this.program(6,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"\n</ul>"},useData:!0})}({}),Ja=function(k){var b=k.UiCore.UiContext;return b.extend("PaymentChannels",{className:"payment-channels",uiContextName:"payment_channels",dependencies:[],initialize:function(a){b.prototype.initialize.call(this,a);this.__channels=IMVU.requireProperty(a,"channels");this.__hasOtherChannels=IMVU.requireProperty(a,"hasOtherChannels");this.addToDOM()},delete:function(){b.prototype.delete.call(this)},render:function(){this.$el.html(k.template({channels:this.__channels,hasOtherChannels:this.__hasOtherChannels}))}})}({UiCore:m["@UiCore"],template:Ia}),Ka=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=a.helperMissing;var g='\n            <div class=\'vcoin-terms-and-conditions\'>\n                <input type="checkbox" class="checkbox vcoin-checkbox" data-name="has_accepted_vcoin_terms_and_conditions" id=\'vcoin_terms_and_conditions_checkbox\'>\n                <label class="toggle-label" for=\'vcoin_terms_and_conditions_checkbox\'>\n                    <span class="vcoin_terms_and_conditions_checkbox_text">',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin_terms_and_conditions_text",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+=' </span><a class="vcoin-terms-and-conditions-link">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vcoin_terms_and_conditions_link",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</a>\n                </label>\n            </div>\n            "},3:function(b,a,d,e){var c;d=a.helperMissing;var g='\n                <p><a href="https://help.imvu.com/s/article/How-do-the-VIP-5000-Credits-Work" target="_blank">',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_terms_and_conditions_loyalty_credits_link_title",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+="</a> ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_terms_and_conditions_loyalty_credits_text",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</p>\n            "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='\n<div class="status-block">\n    <ul>\n        <li class="error-message vip-checkbox-missing">',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_vip_checkbox_unchecked",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+='</li>\n        <li class="error-message vcoin-checkbox-missing">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_vcoin_checkbox_unchecked",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</li>\n        <li class="error-message vcoin-no-payment-methods">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"VCOIN NO PAYMENT METHODS NOTICE",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</li>\n        <li class="error-message items-unavailable-for-purchase">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"ITEMS UNAVAILBLE FOR PURCHASE",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</li>\n        <li class="notice-message notice-subscription-message hidden">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"SUBSCRIPTION ORDERS PROCESSED SEPARATELY",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</li>\n        <li class="notice-message notice-vcoin-in-cart-message hidden">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"VCOIN PAYMENT METHODS NOTICE",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</li>\n        <li class="notice-message notice-credit-card-only-message hidden">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"CREDIT CARD ONLY PAYMENT METHODS NOTICE",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</li>\n    </ul>\n</div>\n<div class=\"checkout-container\">\n    <p class='title'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"CART",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</p>\n    <div class="multi-cart-list-placehoder">\n        <div class="cart-list"></div>\n    </div>\n    <div class="checkout-bottom-container">\n        <div class=\'vip-status-widget\'></div>\n        <div class=\'price-summary\'>\n            <span>';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"TODAYS TOTAL",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="&nbsp;</span><span class='price'>"+g((c=a.total||b&&b.total,"function"===typeof c?c.call(b,{name:"total",hash:{},data:e}):c))+"</span>\n        </div>\n    </div>\n\n    <div class='agreement'>\n        <div class='vip-panel hidden'>\n            <input type=\"checkbox\" class=\"checkbox\" data-name=\"has_accepted_vip_agreement\" id='vip_checkbox'>\n            <label class=\"toggle-label\" for='vip_checkbox'>\n                <span>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"VIP_AGREEMENT",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</span>\n                <span class="vip-terms-link vip-toc-link tooltip-target bold">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"VIP_AGREEMENT_LINK",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</span>\n            </label>\n            <div class="vip-toc-tooltip">\n                <div class="tooltip-header"><a class="vip-terms-and-conditions-link" href="'+g((c=a.vipTermsURL||b&&b.vipTermsURL,"function"===typeof c?c.call(b,{name:"vipTermsURL",hash:{},data:e}):c))+'" target="_blank">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_dialog_title",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</a></div>\n                <div class="tooltip-body">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_tool_tip_text_part_1",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+=' <a class="vip-terms-and-conditions-link" href="'+g((c=a.subscriptionURL||b&&b.subscriptionURL,"function"===typeof c?c.call(b,{name:"subscriptionURL",hash:{},data:e}):c))+'" target="_blank">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_tool_tip_subscription_label",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</a>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_tool_tip_text_part_2",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+=' <a class="vip-terms-and-conditions-link" href="'+g((c=a.helpCenterURL||b&&b.helpCenterURL,"function"===typeof c?c.call(b,{name:"helpCenterURL",hash:{},data:e}):c))+'" target="_blank">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_tool_tip_help_center_label",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</a>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"vip_tool_tip_text_part_3",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</div>\n            </div>\n        </div>\n        <div class='terms'>\n            ";if((h=a["if"].call(b,b&&b.vcoinInCart,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===h)f+=h;f+="\n            ";if((h=a["if"].call(b,b&&b.tieredVIPInCart,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===h)f+=h;f+="\n            <p class='imvu-terms-and-conditions'>\n                ";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Clicking Checkout",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+=" <span class='bold link'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"IMVU TERMS AND CONDITIONS",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</span>\n            </p>\n        </div>\n    </div>\n    <p class='title payment-method'>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"CHOOSE PAYMENT METHOD",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</p>\n    <div class="payment-channels-wrapper"></div>\n</div>\n\n<div class="other-checkout-container"></div>\n\n<div class=\'pending-panel hidden\'>\n    <h2>\n        ';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"PAYPAL STATUS MESG",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='\n    </h2>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary checkout">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"CHECKOUT",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"</button>\n<\/script>\n"},useData:!0})}({}),La=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c,g;d=this.escapeExpression;var f=a.helperMissing,h="\n            <li class='saved-card-item' id='"+d((c=(c=b&&b.attributes,null==c||!1===c?c:c.id),"function"===typeof c?c.apply(b):c))+"'>\n                <div class='card-info'>\n                    <p class='card-num'>\n                        XXXX-XXXX-XXXX-"+d((c=(c=b&&b.attributes,null==c||!1===c?c:c.card_last_digits),"function"===typeof c?c.apply(b):c))+"\n                    </p>\n                    <p class='expires'>\n                        <span class='card-type'>"+d((c=(c=b&&b.attributes,null==c||!1===c?c:c.card_type),"function"===typeof c?c.apply(b):c))+"</span>\n                        <span class='card-expire'>";if((c=(g=a["i18n-g"]||b&&b["i18n-g"]||f,g.call(b,"CARD EXPIRY",{name:"i18n-g",hash:{},data:e})))||0===c)h+=c;h+=" "+d((c=(c=b&&b.attributes,null==c||!1===c?c:c.expiry),"function"===typeof c?c.apply(b):c))+"</span>\n                    </p>\n                    ";if((c=a["if"].call(b,(c=b&&b.attributes,null==c||!1===c?c:c.is_primary),{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===c)h+=c;return h+"\n                </div>\n            </li>\n        "},2:function(b,a,d,e){var c,g=a.helperMissing;d="\n                        <span class='primary'>";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"Primary",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</span>\n                    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g="\n<div class=\"credit-card-container\">\n    <p class='title saved-cards'>",f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"NEW CREDIT CARD",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+="</p>\n    <li class='add-new-credit-card'>\n        <span class='name'>\n            ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Add a New Credit Card",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n        </span>\n        <img src='/common/withme/img/store/payment/payment-creditcard.png'>\n    </li>\n\n    <p class='title saved-cards'>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"SAVED CREDIT CARDS",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</p>\n    <ul class='saved-card-list'>\n        ";if((f=a.each.call(b,b&&b.saved_cards,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===f)g+=f;g+='\n    </ul>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary use">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"USE THIS CARD",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</button>\n<\/script>\n"},useData:!0})}({}),Ma=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return"\n                    <div class='other-payment-channel-list'>\n                        <span class='name'>PAY WITH VCOIN</span>\n                        <img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'>\n                    </div>\n                "},3:function(b,a,d,e){d="\n            ";if((b=a["if"].call(b,b&&b.isCheckedoutModel,{name:"if",hash:{},fn:this.program(4,e),inverse:this.noop,data:e}))||0===b)d+=b;return d+"\n            "},4:function(b,a,d,e){var c;d=this.escapeExpression;var g='\n                <div class="order-row">\n                    <div class="order-item">\n                        <div class="image-container"><img src="'+d((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.node),null==c||!1===c?c:c.img160x160),"function"===typeof c?c.apply(b):c))+'"></div>\n                        <div class="item-info">\n                            <div class="item-name">'+d((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.node),null==c||!1===c?c:c.name),"function"===typeof c?c.apply(b):c))+"</div>\n                            ";if((c=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(5,e),inverse:this.program(10,e),data:e}))||0===c)g+=c;g+="\n                        </div>\n                        ";if((c=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(15,e),inverse:this.noop,data:e}))||0===c)g+=c;g+="\n                    </div>\n                </div>\n                ";if((c=a["if"].call(b,b&&b.hasSupportingText,{name:"if",hash:{},fn:this.program(17,e),inverse:this.noop,data:e}))||0===c)g+=c;return g+"\n            "},5:function(b,a,d,e){d="\n                                ";if((b=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(6,e),inverse:this.program(8,e),data:e}))||0===b)d+=b;return d+"\n                            "},6:function(b,a,d,e){var c;a=this.escapeExpression;return"\n                                    <div class=\"product-price\">\n                                        <span class='normal-price img-position'><img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'><span class=\"item-info-price\">"+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.vcoin_normal_price_formatted),"function"===typeof c?c.apply(b):c))+"</span></span>\n                                        <span class='sale-price' img-position><img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'><span class=\"item-info-price\">"+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.vcoin_sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</span></span>\n                                    </div>\n                                "},8:function(b,a,d,e){var c;a=this.escapeExpression;return"\n                                    <div class='product-price img-position'><img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'><span class=\"item-info-price\">"+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.vcoin_sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</span></div>\n                                "},10:function(b,a,d,e){d="\n                                ";if((b=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(11,e),inverse:this.program(13,e),data:e}))||0===b)d+=b;return d+"\n                            "},11:function(b,a,d,e){var c;a=this.escapeExpression;return"\n                                    <div class=\"product-price\">\n                                        <span class='normal-price'>"+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.normal_price_formatted),"function"===typeof c?c.apply(b):c))+"</span>\n                                        <span class='sale-price'>"+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</span>\n                                    </div>\n                                "},13:function(b,a,d,e){var c;a=this.escapeExpression;return'\n                                    <div class="product-price">'+a((c=(c=(c=b&&b.attributes,null==c||!1===c?c:c.edge),null==c||!1===c?c:c.sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</div>\n                                "},15:function(b,a,d,e){var c,g=a.helperMissing;d="\n                            <div class='product-sale'>\n                                <span>";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"SALE",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"4</span>\n                            </div>\n                        "},17:function(b,a,d,e){var c;a=this.escapeExpression;return'\n                    <div class="supporting-text">\n                        '+a((c=b&&b.supportingText,"function"===typeof c?c.apply(b):c))+"\n                    </div>\n                "},19:function(b,a,d,e){return"\n            <img src='https://static-akm.imvu.com/imvufiles/vcoin_logo_15x15.svg'>\n            <span class=\"order-total-converted\"></span>\n        "},21:function(b,a,d,e){return'\n            <span class="order-total"></span>\n        '},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="content-container">\n    <div class="content-container-content">\n        <legend class="system-info-header">\n            ',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Payment Method",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='\n        </legend>\n            <div class="info-block">\n                ';if((f=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===f)g+=f;g+='\n                <div class="billing-info"></div>\n            </div>\n\n        <legend class="system-info-header">\n            ';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Cart",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='\n        </legend>\n        <div class="multicart-order-list">\n            ';if((f=a.each.call(b,b&&b.cart,{name:"each",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===f)g+=f;g+='\n        </div>\n    </div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary buy-now">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"BUY",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n        <span class=\"item-count\"></span>\n        <span class='items-for'></span>\n        ";if((f=a["if"].call(b,b&&b.isVcoinAsAPaymentMethod,{name:"if",hash:{},fn:this.program(19,e),inverse:this.program(21,e),data:e}))||0===f)g+=f;return g+"\n    </button>\n<\/script>\n"},useData:!0})}({}),z=function(k){var b=k.MultiCartAbstractDialog;return b.extend("MultiCartCreditReviewDialog",{uiContextName:"multicart_credit_card_review_dialog",className:"multicart-credit-card-review-dialog dialog-type-B",dependencies:"cart channel dialogManager featureAccessManager globalStartupModel globalStringManager loginManager restModelFactory serviceProvider window".split(" "),trackedEvents:function(){return[{type:"click",selector:".buy-now.standard-purchase",name:"buy_now",handler:this.__onCheckout},{type:"click",selector:".buy-now.in-bypass-experiment",name:"buy_now_bypass_experiment",handler:this.__onCheckout},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(a){b.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.__isCoreDollarStoreBypassPurchase=null!==this.__getCoreDollarstoreProductOfferingUrlAndId().url;this.__getProductOfferingDataFromCoreDS();this.__eProtectResponse=IMVU.optionalProperty(a,"eProtectResponse",null);this.$el.removeClass("can-dismiss");this.__origin=IMVU.optionalProperty(a,"origin",null);this.__channel=IMVU.optionalProperty(a,"channel",null);this.__source=IMVU.optionalProperty(a,"source",null);this.__billingInfo=IMVU.optionalProperty(a,"billingInfo",null);this.title=this.__globalStringManager.get("credit_card_review_title");this.isVcoinAsAPaymentMethod=!1;this.__myself=this.__loginManager.getCurrentUser();this.addToDOM()},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&"pay_with_vcoin_cta"!==this.__source&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.__hostSubscriptionChanged=!1;var a=0,d=0;_.each(this.__cart.models,function(c){c.isCheckedoutModel&&(a+=c.attributes.edge.sale_price,c.hasDiscount=c.attributes.edge.normal_price>c.attributes.edge.sale_price,d++)}.bind(this));"vcoin"===this.__channel.attributes.channel_key?(a=parseFloat(250*a).toFixed(2),this.isVcoinAsAPaymentMethod=!0,this.setContent("body",k.template({cart:this.__cart.models,channel:this.__channel,isVcoinAsAPaymentMethod:this.isVcoinAsAPaymentMethod}))):(a="$"+parseFloat(a).toFixed(2),this.setContent("body",k.template({cart:this.__cart.models})),this.$(".billing-info").html(k.billingTemplate({last_four_digits:this.__billingInfo.last_four_digits,card_type:this.__globalStringManager.get("card_type_"+this.__billingInfo.card_type)})));var e=1===d?this.__stringManager.get("BUY FOR SINGULAR"):this.__stringManager.get("BUY FOR PLURAL");this.setContent("footer",this.$(".dialog-footer-template").text());this.$(".items-for").text(e);this.$(".item-count").text(d);"vcoin"===this.__channel.attributes.channel_key?this.$(".order-total-converted").text(a):this.$(".order-total").text(a);this.__isCoreDollarStoreBypassPurchase?this.$(".buy-now").addClass("in-bypass-experiment"):this.$(".buy-now").addClass("standard-purchase")},__onCheckout:function(){this.__channel.attributes.channel_key&&"vcoin"===this.__channel.attributes.channel_key?(this.__cart.isVcoinAsAPaymentMethod=!0,this.$(".buy-now").addClass("disabled"),this.vcoinCheckout(this.__cart).then(function(){this.promiseResolver.resolve();this.close()}.bind(this)).catch(function(){this.promiseResolver.resolve();this.close()}.bind(this))):(this.$(".buy-now").addClass("disabled"),this.creditCardCheckout(this.__cart).then(function(){this.promiseResolver.resolve();this.close()}.bind(this)).catch(function(){this.promiseResolver.resolve();this.close()}.bind(this)))},__goBack:function(){this.hide();this.promiseResolver.reject()}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],BillingInfo:J,MultiCartAbstractDialog:L,billingTemplate:y,template:Ma}),Na=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return'\n            <iframe id="eProtect-iframe" name="eProtect-iframe" frameborder="0" src="https://localhost.imvu.com/third_party/worldpay/eProtect_iframe/nextBig.html" height="150" width="100%"></iframe>\n        '},3:function(b,a,d,e){return'\n            <div class="input-row worldpay-eprotect-iframe" id="eProtectiframe"></div>\n        '},5:function(b,a,d,e){return' checked="checked" '},7:function(b,a,d,e){var c;a=this.escapeExpression;return'\n                    <option value="'+a((c=null==e||!1===e?e:e.key,"function"===typeof c?c.apply(b):c))+'">'+a("function"===typeof b?b.apply(b):b)+"</option>\n                    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="content-container">\n    <div class="error-block">\n        <ul>\n            <li class="error-message field-missing">',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_field_missing",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='</li>\n            <li class="error-message cardnumber-invalid">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_card_number_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message exp-date-expired">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_exp_date_expired",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message security-code-invalid">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_security_code_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message zip-invalid">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_zip_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message postal-invalid">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_postal_invalid",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message vip-checkbox-missing">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_vip_checkbox_unchecked",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            <li class="error-message cardname-invalid">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"error_invalid_cc_name",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</li>\n        </ul>\n    </div>\n    <div class="payment-block">\n        <legend class="system-info-header">\n            ';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Payment Method",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n        </legend>\n\n        ";if((f=a["if"].call(b,b&&b.canSeeEprotectCss,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===f)g+=f;g+='\n\n        <div class="input-row save-cc-for-later">\n            <input id=\'save-for-later-checkbox\' class="save-for-later checkbox" tabindex=\'13\' type="checkbox"\n                ';if((f=a["if"].call(b,b&&b.saveCard,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===f)g+=f;g+=">\n            <label for='save-for-later-checkbox'>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Save For Later",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</label>\n        </div>\n    </div>\n    <div class="billing-address-block">\n        <legend class="system-info-header">\n            ';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Billing Information",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n        </legend>\n        <div class=\"input-row\">\n            <input class='name-on-card' maxlength='50' tabindex='5' required placeholder='";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Name on Card",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n        </div>\n        <div class=\"input-row\">\n            <input class='address' maxlength='50' tabindex='6' required placeholder='";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Address",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n        </div>\n        <div class=\"input-row\">\n            <input class='city' maxlength='20' tabindex='7' required placeholder='";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"City",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n            <div class='us-fields state-province-container input-container'>\n                <select class='state' tabindex='8' >\n                    <option selected value=\"\">";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"State",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</option>\n                    ";if((f=a.each.call(b,b&&b.states,{name:"each",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n                </select>\n            </div>\n            <div class='non-us-fields ca-province state-province-container input-container'>\n                <select class='province' tabindex='10'>\n                    <option selected value=\"\">";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Province",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</option>\n                    ";if((f=a.each.call(b,b&&b.provinces,{name:"each",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)g+=f;g+="\n                </select>\n            </div>\n            <input class='us-fields zip' maxlength='5' tabindex='9' placeholder='";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Zipcode",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n            <input class='non-us-fields postal' maxlength='12' tabindex='11' placeholder='";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Postal Code",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="'>\n            <div class='country-container input-container us'>\n                <select class='country' tabindex='12' required>\n                    <option value=''>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Country",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</option>\n                    ";if((f=a.each.call(b,b&&b.countries,{name:"each",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===f)g+=f;g+='\n                </select>\n            </div>\n        </div>\n    </div>\n</div>\n\n<footer class="dialog-footer">\n    <button class="btn btn-primary continue-checkout">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Continue to Checkout",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</button>\n</footer>\n"},useData:!0})}({}),M=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("MultiCartAddCreditCard",{uiContextName:"multicart_add_credit_card_dialog",className:"multicart-add-credit-card-dialog dialog-type-B",dependencies:"appMonitor cart channel currentLocale dialogManager featureAccessManager globalStringManager loginManager moment orderTotal prefsManager timer window".split(" "),trackedEvents:function(){return[{type:"click",selector:".continue-checkout",name:"continue_checkout",handler:this.__continueCheckout},{type:"keyup",selector:".name-on-card",name:"changing_name",handler:this.__isBlankNameOnCard},{type:"blur",selector:".name-on-card",name:"changed_name",handler:this.__validateNameOnCard},{type:"keyup",selector:".address",name:"changing_address",handler:this.__isBlankAddress},{type:"blur",selector:".address",name:"changed_address",handler:this.__validateAddress},{type:"keyup",selector:".city",name:"change_city",handler:this.__isBlankCity},{type:"blur",selector:".city",name:"change_city",handler:this.__validateCity},{type:"change",selector:".state",name:"change_state_select",handler:this.__validateState},{type:"keyup",selector:".zip",name:"changing_zip",handler:this.__isBlankZip},{type:"blur",selector:".zip",name:"changed_zip",handler:this.__validateZip},{type:"change",selector:".province",name:"change_province_select",handler:this.__validateProvince},{type:"keyup",selector:".postal",name:"changing_postal",handler:this.__isBlankPostal},{type:"blur",selector:".postal",name:"changed_postal",handler:this.__validatePostal},{type:"change",selector:".country",name:"change_country_select",handler:this.__validateCountry},{type:"click",selector:".back-button",name:"back_button",handler:this.__goBack}]},initialize:function(a){b.prototype.initialize.call(this,a);this.shouldFocusOnPrimaryButton=!1;a.loginManager.isLoggedIn()||(this.__window.onbeforeunload=null,this.__window.location.href=this.__siteRoot);this.title=this.__globalStringManager.get("Add New Credit Card");this.__monthRange="01 02 03 04 05 06 07 08 09 10 11 12".split(" ");this.__getYearRange();this.__states=k.StateMap;this.__provinces=k.ProvinceMap;this.__countries=k.CountryMap;this.__CCValidator=k.CCValidator;this.__missingFields=[];this.__myself=a.loginManager.getCurrentUser();this.__origin=IMVU.optionalProperty(a,"origin",null);this.__isMobile=this.__featureAccessManager.isMobile();this.__eProtectData=this.__serviceProvider.get("worldpayEprotectData");this.__eProtectFailureCodesAccountNumber=this.__eProtectData.eProtectFailureCodesAccountNumber;this.__eProtectFailureCodesCCV=this.__eProtectData.eProtectFailureCodesCCV;this.__canSeeEprotectCss=!1;this.__currentLocale=this.__currentLocale||"en";this.__currentLocale="www"===this.__currentLocale?"en":this.__currentLocale;this.addToDOM()},delete:function(){b.prototype.delete.call(this);this.__tooltip&&this.__tooltip.delete()},close:function(){this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.__prefsManager.populated().then(function(){this.setContent("body",k.template,{monthRange:this.__monthRange,yearRange:this.__yearRange,states:this.__states,provinces:this.__provinces,countries:this.__countries,saveCard:!this.__prefsManager.getBool("next.payment.creditcard.save_card.disable"),canSeeEprotectCss:this.__canSeeEprotectCss});this.$(".non-us-fields").hide();this.$('.country option[value="US"]').prop("selected",!0);this.__stateWidget=this.createChildContext(k.Dropdown,{$replaceElement:this.$(".state")});this.createChildContext(k.Dropdown,{$replaceElement:this.$(".province")});this.createChildContext(k.Dropdown,{$replaceElement:this.$(".country")});this.$(".content-container").scrollbar();this.__tooltip=this.serviceProvider.create(k.Tooltip,{$replaceElement:this.$(".security-code-tooltip"),$tooltipTarget:this.$(".security-code-help-link")});this.__myself.get("is_adult")||this.$(".content-container .save-cc-for-later").addClass("hidden");try{$(document).ready(function(){var a=this.__currentLocale+"NextBig20201012b",d=this.__currentLocale+"NextSmall20201012b";a={paypageId:this.__eProtectData.payPageID,style:this.__isMobile?d:a,reportGroup:this.__eProtectData.reportGroup,timeout:this.__eProtectData.timeout,div:"eProtectiframe",callback:this.__eProtectIframeClientCallback.bind(this),checkoutIdMode:!0,showCvv:!0,months:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},numYears:20,tooltipText:this.__globalStringManager.get("worldpay_eProtext_ccv_tool_tip"),tabIndex:{cvv:1,accountNumber:2,expMonth:3,expYear:4},placeholderText:{cvv:this.__globalStringManager.get("worldpay_eProtext_ccv_text"),accountNumber:this.__globalStringManager.get("worldpay_eProtext_ccv_acc_num")},inputsEmptyCallback:this.__eProtectInputsEmptyCallback.bind(this),enhancedUxFeatures:{inlineFieldValidations:!0}};"undefined"===typeof EprotectIframeClient?(this.__eProtectIframeClient=null,this.__dialogManager.showDialog(k.Dialogs.AlloyAlertDialog,{title:this.__stringManager.get("worldpay_eProtext_alert_title"),text:this.__stringManager.get("worldpay_eProtext_alert_text"),ok:this.__stringManager.get("OK")}).finished.then(function(){this.close()}.bind(this)).catch(function(){this.close()}.bind(this))):(this.__eProtectIframeClient=new EprotectIframeClient(a),this.__isMobile?this.$("#eProtect-iframe").attr("height","195"):this.__eProtectIframeClient.autoAdjustHeight())}.bind(this))}catch(a){this.__window.console.error("MultiCartAddCreditCard::postRender - Failed to initialize eprotect",a),this.__appMonitor.reportCustomError("MultiCartAddCreditCard","postRender","web_perm_0011","MultiCartAddCreditCard::postRender - Failed to initialize eprotect",this.__appMonitor.buildErrorArray(a))}}.bind(this))},_test_getEProtectIframeClient:function(){return this.__eProtectIframeClient},__eProtectIframeClientCallback:function(a){var d=parseInt(a.response),e=!1;870!=d&&(this.__eProtectFailureCodesAccountNumber.includes(d)||this.__eProtectFailureCodesCCV.includes(d)||this.__window.console.error("MultiCartAddCreditCard::__eProtectIframeClientCallback - Unrecognized response code ("+String(d)+")"));this.$(".cardnumber-invalid").removeClass("error-visible");this.__eProtectFailureCodesAccountNumber.includes(d)&&(this.$(".cardnumber-invalid").addClass("error-visible"),e=!0);this.$(".security-code-invalid").removeClass("error-visible");this.__eProtectFailureCodesCCV.includes(d)&&(this.$(".security-code-invalid").addClass("error-visible"),e=!0);this.__updateErrorStatus();this.__ccLastFour=a.lastFour;this.__ccType=a.type;this.__eProtectResponse=JSON.stringify(a);0!==this.$(".error-visible").length||e||this.__dialogManager.showDialog(k.MultiCartReview,{billingInfo:this.__getBillingInfo(),channel:this.__channel,cart:this.__cart,origin:this.__origin,eProtectResponse:this.__eProtectResponse}).finished.then(function(c){this.promiseResolver.resolve(c);this.close()}.bind(this)).catch(function(c){"closing_all"===c&&this.close()}.bind(this))},__eProtectInputsEmptyCallback:function(a){this.$(".cardnumber-invalid").addClass("error-visible");this.$(".security-code-invalid").addClass("error-visible");this.$(".exp-date-expired").addClass("error-visible")},__getYearRange:function(){this.__yearRange=[];for(var a=this.__timer.getDate().getFullYear(),d=0;20>d;d++)this.__yearRange.push(d+a)},__validateInputs:function(){this.__billingInfoErrorDetected=!1;this.__validateNameOnCard();this.__validateCardName();this.__validateAddress();this.__validateCity();this.__validateCountry();"US"===this.$(".country select").val()?(this.__validateZip(),this.__validateState()):"CA"===this.$(".country select").val()&&(this.__validatePostal(),this.__validateProvince())},__errorIfBlank:function(a,d){d=d?""===this.$("."+a+" select").val():""===this.$("."+a).val().trim();this.__updateMissingFields(a,d);d&&(this.__billingInfoErrorDetected=!0);return d},__updateMissingFields:function(a,d){this.$("."+a).toggleClass("payment-error",d);var e=this.__missingFields.indexOf(a);d&&0>e?this.__missingFields.push(a):!d&&-1<e&&this.__missingFields.splice(e,1);this.$(".field-missing").toggleClass("error-visible",0!==this.__missingFields.length)},__validateCardName:function(){var a=this.$(".name-on-card").val().trim(),d=a.trim().split(/\s+/).length;/\d/.test(a)||2>d?(this.$(".cardname-invalid").addClass("error-visible"),this.$(".name-on-card").addClass("payment-error")):(this.$(".cardname-invalid").removeClass("error-visible"),this.$(".name-on-card").removeClass("payment-error"));this.__updateErrorStatus()},__isBlankNameOnCard:function(){-1<this.__missingFields.indexOf("name-on-card")&&this.__errorIfBlank("name-on-card");this.__updateErrorStatus()},__validateNameOnCard:function(){this.__errorIfBlank("name-on-card");this.__updateErrorStatus()},__isBlankAddress:function(){-1<this.__missingFields.indexOf("address")&&this.__errorIfBlank("address");this.__updateErrorStatus()},__validateAddress:function(){this.__errorIfBlank("address");this.__updateErrorStatus()},__isBlankCity:function(){-1<this.__missingFields.indexOf("city")&&this.__errorIfBlank("city");this.__updateErrorStatus()},__validateCity:function(){this.__errorIfBlank("city");this.__updateErrorStatus()},__validateState:function(){this.__errorIfBlank("state",!0);this.__updateErrorStatus()},__validateProvince:function(){this.__errorIfBlank("province",!0);this.__updateErrorStatus()},__isBlankZip:function(){-1<this.__missingFields.indexOf("zip")&&this.__errorIfBlank("zip");this.__updateErrorStatus()},__validateZip:function(){this.__errorIfBlank("zip")?this.$(".zip-invalid").removeClass("error-visible"):this.$(".zip").val().trim().match(/^\d\d\d\d\d$/)?(this.$(".zip-invalid").removeClass("error-visible"),this.$(".zip").removeClass("payment-error")):(this.$(".zip-invalid").addClass("error-visible"),this.$(".zip").addClass("payment-error"),this.__billingInfoErrorDetected=!0);this.__updateErrorStatus()},__isBlankPostal:function(){"CA"===this.$(".country select").val()&&-1<this.__missingFields.indexOf("postal")&&this.__errorIfBlank("postal");this.__updateErrorStatus()},__validatePostal:function(){"CA"===this.$(".country select").val()&&(this.__errorIfBlank("postal")?this.$(".postal-invalid").removeClass("error-visible"):this.$(".postal").val().trim().match(/^[A-Za-z]\d[A-Za-z]\s*\d[A-Za-z]\d$/)?(this.$(".postal-invalid").removeClass("error-visible"),this.$(".postal").removeClass("payment-error")):(this.$(".postal-invalid").addClass("error-visible"),this.$(".postal").addClass("payment-error"),this.__billingInfoErrorDetected=!0));this.__updateErrorStatus()},__validateCountry:function(){this.$(".zip-invalid").removeClass("error-visible");this.$(".postal-invalid").removeClass("error-visible");this.__updateMissingFields("zip",!1);this.__updateMissingFields("state",!1);this.__updateMissingFields("postal",!1);this.__updateMissingFields("province",!1);this.__errorIfBlank("country",!0);"US"===this.$(".country select").val()?(this.$(".us-fields").show(),this.$(".non-us-fields").hide(),this.$(".country-container").addClass("us"),this.$(".postal").val(""),this.$('.ca-province option[value=""]').prop("selected",!0)):(this.$(".country-container").removeClass("us"),this.$(".us-fields").hide(),this.$(".zip").val(""),this.$('.state option[value=""]').prop("selected",!0),this.$(".non-us-fields").show(),"CA"===this.$(".country select").val()?(this.$(".ca-province").show(),this.$(".country-container").addClass("canada"),this.$(".postal").removeClass("intl")):(this.$(".postal").addClass("intl"),this.$(".ca-province").hide(),this.$('.ca-province option[value=""]').prop("selected",!0),this.$(".country-container").removeClass("canada")));this.__updateErrorStatus()},__updateErrorStatus:function(){this.$(".error-block").toggleClass("has-error",0<this.$(".error-visible").length)},__continueCheckout:function(){this.__validateInputs();if(!this.__billingInfoErrorDetected&&!this.__missingFields.length){var a=this.__moment(new Date).format("YYYYMMDDhhmmss");a={id:String(this.__myself.get("legacy_cid"))+"e"+a,pciNonSensitive:!1};this.__eProtectIframeClient.getPaypageRegistrationId(a)}},__getBillingInfo:function(){var a=this.$(".country select").val(),d=this.$(".state select").val(),e=this.$(".zip").val().trim();"CA"===a?(d=this.$(".province select").val(),e=this.$(".postal").val().trim()):"US"!==a&&(d="",e=this.$(".postal").val().trim());var c=this.__eProtectResponse,g=this.__ccLastFour,f=this.__ccType;return{name:this.$(".name-on-card").val().trim(),address:this.$(".address").val().trim(),city:this.$(".city").val().trim(),state:d,postal_code:e,country:a,save_card:this.$("#save-for-later-checkbox").prop("checked"),eProtectResponse:c,last_four_digits:g,card_type:f}},__goBack:function(){this.hide();this.promiseResolver.reject()},__destroy:function(){this.hide();this.delete()}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],CCValidator:I,CountryMap:m["json!/common/js/JSON/Countries.json"],Dropdown:w,MultiCartReview:z,ProvinceMap:m["json!/common/js/JSON/Provinces.json"],StateMap:m["json!/common/js/JSON/States.json"],Tooltip:r,template:Na}),Oa=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("MultiCartSavedCardsDialog",{uiContextName:"multicart_saved_cards_dialog",className:"multicart-saved-cards-dialog dialog-type-B",dependencies:"cart channel dialogManager globalStartupModel globalStringManager restModelFactory".split(" "),trackedEvents:function(){return[{type:"click",selector:".back-button",name:"back_button",handler:"__goBack"},{type:"click",selector:".add-new-credit-card",name:"add_new",handler:"__addNewCard"},{type:"click",selector:"li.saved-card-item",name:"select_saved_card",handler:"__selectSavedCard"},{type:"click",selector:".btn.btn-primary",name:"use_card",handler:"__useThisCard"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.$el.removeClass("can-dismiss");this.title=this.__globalStringManager.get("SAVED CREDIT CARDS");this.__origin=IMVU.optionalProperty(a,"origin",null);a=this.__globalStartupModel.get("savedCreditCardUrl");this.__saved_cards=this.track(this.__restModelFactory.readCollection(a,k.UiCore.NodeCollection));this.__saved_cards.populated().then(function(){this.addToDOM()}.bind(this))},postRender:function(){"desktop"===this.serviceProvider.get("platform")&&this.$(".dialog-header").prepend('<div class="back-button"></div>');this.setContent("body",k.template,{saved_cards:this.__saved_cards.models});this.$(".saved-card-list li:nth-of-type(1)").addClass("is-selected");this.__selectedCard=this.$(".saved-card-list li:nth-of-type(1)").prop("id");this.setContent("footer",this.$(".dialog-footer-template").text())},__addNewCard:function(){this.__dialogManager.showDialog(k.MultiCartAddCreditCard,{cart:this.__cart,channel:this.__channel,itemCount:this.__cart.length,orderTotal:this.__total,origin:this.__origin}).finished.then(function(a){"clear_cart"===a&&this.__window.location.reload();this.promiseResolver.resolve(a);this.close()}.bind(this)).catch(function(a){"closing_all"===a&&this.close()}.bind(this))},__useThisCard:function(){var a=this.__getCardFromId(this.__selectedCard);this.__dialogManager.showDialog(k.MultiCartReview,{billingInfo:{card_type:a.attributes.card_type,name:a.attributes.name,last_four_digits:a.attributes.card_last_digits,card_id:a.attributes.id,saved_card:!0},channel:this.__channel,cart:this.__cart,origin:this.__origin}).finished.then(function(d){"clear_cart"===d&&this.__window.location.reload();this.promiseResolver.resolve(d);this.close()}.bind(this)).catch(function(d){"closing_all"===d&&this.close()}.bind(this))},__onClose:function(a){a.preventDefault();this.__recordEvent("click",{name:"dialog_close"});this.hide();this.promiseResolver.reject("closing_all")},__goBack:function(){this.hide();this.promiseResolver.reject()},__selectSavedCard:function(a){this.__selectedCard=a.target.id;this.$(".saved-card-list li").removeClass("is-selected");this.$('.saved-card-list li[id="'+this.__selectedCard+'"]').addClass("is-selected")},__getCardFromId:function(a){return _.find(this.__saved_cards.models,function(d){if(a===d.attributes.id)return d})}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],MultiCartAddCreditCard:M,MultiCartReview:z,template:La}),Pa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c,g=a.helperMissing;d=this.escapeExpression;var f="\r\n";if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"VIP RENEWS ON",{name:"i18n-g",hash:{},data:e})))||0===g)f+=g;return f+"&nbsp;<span class='date'>"+d((c=a.renew_date||b&&b.renew_date,"function"===typeof c?c.call(b,{name:"renew_date",hash:{},data:e}):c))+"</span><span class='price'>"+d((c=a.price||b&&b.price,"function"===typeof c?c.call(b,{name:"price",hash:{},data:e}):c))+"</span>\r\n"},useData:!0})}({}),Qa=function(k){var b=k.UiCore.UiContext;return b.extend("MultiCartVipStatus",{className:"multi-cart-vip-status",uiContextName:"multi_cart_vip_status",tagName:"p",dependencies:["globalStringManager","loginManager","model"],trackedEvents:function(){return[]},VIP_ONE_MONTH:12,VIP_THREE_MONTHS:13,VIP_ONE_YEAR:14,initialize:function(a){b.prototype.initialize.call(this,a);this.__myself=this.__loginManager.getCurrentUser();this.__months_to_add={};this.__months_to_add[this.VIP_ONE_MONTH]=1;this.__months_to_add[this.VIP_THREE_MONTHS]=3;this.__months_to_add[this.VIP_ONE_YEAR]=12;this.addToDOM()},render:function(){b.prototype.render.call(this);var a=this.__months_to_add[this.__model.attributes.node.product_packages_id];a||(a=1);a=(this.__myself.get("is_vip")?k.moment(this.__myself.get("vip_expires")):k.moment()).add("months",a);this.$el.html(k.template({price:this.__model.attributes.edge.sale_price_formatted,renew_date:a.format("MM/DD/YYYY")}))}})}({moment:m["@moment"],UiCore:m["@UiCore"],template:Pa}),Ra=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return"disabled"},3:function(b,a,d,e){var c,g;d=this.escapeExpression;return"\r\n            <div class='product-price'>\r\n                <span class='normal-price'>"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.edge),null==c||!1===c?c:c.normal_price_formatted),"function"===typeof c?c.apply(b):c))+"</span>\r\n                <span class='sale-price'>"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.edge),null==c||!1===c?c:c.sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</span>\r\n                <span class='renewal-period'> "+d((g=a.renewalPeriodText||b&&b.renewalPeriodText,"function"===typeof g?g.call(b,{name:"renewalPeriodText",hash:{},data:e}):g))+"</span>\r\n            </div>\r\n        "},5:function(b,a,d,e){var c,g;d=this.escapeExpression;return"\r\n            <div class='product-price'>\r\n                "+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.edge),null==c||!1===c?c:c.sale_price_formatted),"function"===typeof c?c.apply(b):c))+"<span class='renews-monthly'> "+d((g=a.renewalPeriodText||b&&b.renewalPeriodText,"function"===typeof g?g.call(b,{name:"renewalPeriodText",hash:{},data:e}):g))+"</span>\r\n            </div>\r\n        "},7:function(b,a,d,e){var c,g=a.helperMissing;d="\r\n        <div class='product-sale'>\r\n            ";if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"SALE",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"\r\n        </div>\r\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;var g="<div class='multi-cart-item-info'>\r\n\r\n    <input id='multi-cart-item-"+d((c=(c=b&&b.model,null==c||!1===c?c:c.cid),"function"===typeof c?c.apply(b):c))+"' class='checkbox product-select' type='checkbox' ";if((c=a["if"].call(b,(c=b&&b.model,null==c||!1===c?c:c.isDisabledModel),{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===c)g+=c;g+="/>\r\n    <label class='product-label' for='multi-cart-item-"+d((c=(c=b&&b.model,null==c||!1===c?c:c.cid),"function"===typeof c?c.apply(b):c))+"'>\r\n    </label>\r\n\r\n    <div class='product-img'>\r\n        <img src='"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.node),null==c||!1===c?c:c.img160x160),"function"===typeof c?c.apply(b):c))+"'>\r\n    </div>\r\n    <div class='product-info'>\r\n        <div class='product-name'>"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.node),null==c||!1===c?c:c.name),"function"===typeof c?c.apply(b):c))+"</div>\r\n        ";if((c=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(3,e),inverse:this.program(5,e),data:e}))||0===c)g+=c;g+="\r\n\r\n    </div>\r\n    ";if((c=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===c)g+=c;return g+"\r\n</div>\r\n"},useData:!0})}({}),Sa=function(k){var b=k.UiCore.UiContext;return k.UiCore.UiContext.extend("MultiCartCheckoutItem",{className:"multi-cart-checkout-item",uiContextName:"multi_cart_checkout_item",tagName:"li",dependencies:["contextMenuManager","dollarStoreManager","globalStringManager","window"],trackedEvents:function(){return[{type:"click",selector:".checkbox.product-select",name:"product_toggle",handler:"__productToggle"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.model.isCheckedoutModel=!0;this.model.isDisabledModel=!1;this.model.listenTo(this.model,"cart_model_price_update",this.__updatePrice.bind(this));this.addToDOM()},render:function(){b.prototype.render.call(this);var a="",d=this.model.get("node");if(d){var e=d.category;e&&"hosting"===e?a=this.__globalStringManager.get("renews_monthly"):e&&"vip"===e&&(d=d.code_name,"vip_1_month_subscription"===d?a=this.__globalStringManager.get("renews_monthly"):"vip_3_month_subscription"===d?a=this.__globalStringManager.get("renews_quarterly"):"vip_1_year_subscription"===d&&(a=this.__globalStringManager.get("renews_yearly")))}this.$el.html(k.template({model:this.model,hasDiscount:this.model.attributes.edge.normal_price>this.model.attributes.edge.sale_price,renewalPeriodText:a}));this.$(".multi-cart-item-info").addClass(this.model.attributes.node.category);this.model.isCheckedoutModel?this.$(".product-select").attr("checked","checked"):this.$(".product-select").removeAttr("checked");this.model.get("node").disableCheckbox&&this.$(".product-label").expect(1).attr("disabled","disabled")},__productToggle:function(a){this.model.isCheckedoutModel=this.$(a.target).prop("checked");this.__dollarStoreManager.trigger("update_checkout_total_price")},__updatePrice:function(){this.render()}})}({Model:m["@Model"],UiCore:m["@UiCore"],template:Ra}),Ta=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;a=this.escapeExpression;return"\n        <li id='"+a((c=b&&b.id,"function"===typeof c?c.apply(b):c))+"'>\n        <span class='name'>\n            "+a((c=(c=b&&b.attributes,null==c||!1===c?c:c.display_name),"function"===typeof c?c.apply(b):c))+"\n        </span>\n            <img src='"+a((c=(c=b&&b.attributes,null==c||!1===c?c:c.icon_url),"function"===typeof c?c.apply(b):c))+"'>\n        </li>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c,g=a.helperMissing;d="<ul class='other-payment-channel-list'>\n    <li id='other-payment-type'>\n    <span class='name'>";if((g=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"OTHER PAYMENT TYPE PLURAL",{name:"i18n-g",hash:{},data:e})))||0===g)d+=g;d+="\n        <span class='down-arrow'></span>\n    </span>\n    </li>\n    ";if((g=a.each.call(b,b&&b.otherChannels,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===g)d+=g;return d+"\n</ul>\n\n"},useData:!0})}({}),Ua=function(k){var b=k.UiCore.UiContext;return b.extend("OtherPaymentChannels",{className:"other-payment-channels",uiContextName:"other_payment_channels",dependencies:[],trackedEvents:function(){return[]},initialize:function(a){b.prototype.initialize.call(this,a);this.__otherChannels=IMVU.requireProperty(a,"otherChannels");this.addToDOM()},delete:function(){b.prototype.delete.call(this)},render:function(){this.$el.html(k.template({otherChannels:this.__otherChannels}))}})}({UiCore:m["@UiCore"],template:Ta}),Va=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){return"\r\n"},useData:!0})}({}),Wa=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;var g="\r\n        <div class=\"product-price\">\r\n            <span class='normal-price'>"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.edge),null==c||!1===c?c:c.normal_price_formatted),"function"===typeof c?c.apply(b):c))+"</span>\r\n            <span class='sale-price'>"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.edge),null==c||!1===c?c:c.sale_price_formatted),"function"===typeof c?c.apply(b):c))+"</span>\r\n            ";if((c=a["if"].call(b,b&&b.hasRenews,{name:"if",hash:{},fn:this.program(2,e),inverse:this.noop,data:e}))||0===c)g+=c;return g+"\r\n    </div>\r\n    "},2:function(b,a,d,e){var c;d=this.escapeExpression;return"\r\n            <span class='renews-text'> "+d((c=a.renewsText||b&&b.renewsText,"function"===typeof c?c.call(b,{name:"renewsText",hash:{},data:e}):c))+"</div>\r\n        "},4:function(b,a,d,e){var c;d=this.escapeExpression;d="\r\n    <div class='product-price'>"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.edge),null==c||!1===c?c:c.sale_price_formatted),"function"===typeof c?c.apply(b):c));if((c=a["if"].call(b,b&&b.hasRenews,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"</div>\r\n    "},5:function(b,a,d,e){var c;d=this.escapeExpression;return"<span class='renews-text'> "+d((c=a.renewsText||b&&b.renewsText,"function"===typeof c?c.call(b,{name:"renewsText",hash:{},data:e}):c))+"</span>"},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c,g;d=this.escapeExpression;var f=a.helperMissing,h="<div class='multi-cart-item-info'>\r\n    <div class='product-img'>\r\n        <img src='"+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.node),null==c||!1===c?c:c.img160x160),"function"===typeof c?c.apply(b):c))+"'>\r\n    </div>\r\n    <div class='product-info'>\r\n        <div class='product-name'>\r\n            "+d((c=(c=(c=(c=b&&b.model,null==c||!1===c?c:c.attributes),null==c||!1===c?c:c.node),null==c||!1===c?c:c.name),"function"===typeof c?c.apply(b):c))+"\r\n        </div>\r\n\r\n        ";if((c=a["if"].call(b,b&&b.hasDiscount,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(4,e),data:e}))||0===c)h+=c;h+="\r\n</div>\r\n<div class='product-remove'>\r\n    ";if((c=(g=a.icon||b&&b.icon||f,g.call(b,"icon-trash2",{name:"icon",hash:{},data:e})))||0===c)h+=c;return h+"\r\n</div>\r\n</div>"},useData:!0})}({}),Xa=function(k){var b=k.UiCore.UiContext;return k.UiCore.UiContext.extend("MultiCartItem",{className:"multi-cart-item",uiContextName:"multi_cart_item",tagName:"li",dependencies:"contextMenuManager dialogManager dollarStoreManager featureAccessManager globalStringManager Promise".split(" "),trackedEvents:function(){return[{type:"click",selector:".product-remove",name:"multi_cart_remove",handler:"__onRemoveItem"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.model.listenTo(this.model,"cart_model_price_update",this.__updatePrice.bind(this));this.addToDOM()},render:function(){b.prototype.render.call(this);var a=this.model.attributes.edge.normal_price>this.model.attributes.edge.sale_price,d=this.model.get("node").category,e="hosting"===d||"vip"===d;a={model:this.model,hasDiscount:a,hasRenews:e};e&&(e=this.__globalStringManager.get("renews_monthly"),"vip"===d&&(d=this.model.get("node").code_name,"vip_3_month_subscription"===d?e=this.__globalStringManager.get("renews_quarterly"):"vip_1_year_subscription"===d&&(e=this.__globalStringManager.get("renews_yearly"))),a.renewsText=e);this.$el.html(k.template(a));this.$(".product-info").addClass(this.model.attributes.node.category)},__onRemoveItem:function(){this.collection.remove(this.model);0===this.collection.length&&this.__dollarStoreManager.trigger("empty_multi_cart");this.__dollarStoreManager.trigger("update_cart_total_price");this.model.attributes.productModel.trigger("removed_from_cart",this.collection);this.model.get("edge").rules.includes("is_vcoin")&&this.__dollarStoreManager.trigger("update_cart_vcoin_total")},__updatePrice:function(){this.render()}})}({Model:m["@Model"],UiCore:m["@UiCore"],template:Wa}),N=function(k){var b=k.UiCore.ListPresenter;return b.extend("MultiCartList",{className:"multi-cart-list",uiContextName:"multi_cart_list",tagName:"ul",dependencies:["dollarStoreManager","globalStringManager","modeManager"],trackedEvents:function(){return[]},initialize:function(a){this.itemFactory=a.itemFactory||k.MultiCartItem;b.prototype.initialize.call(this,a)},render:function(){b.prototype.render.call(this);this.$el.html(k.template())}})}({UiCore:m["@UiCore"],MultiCartItem:Xa,template:Va}),Ya=function(k){var b=k.MultiCartAbstractDialog;return b.extend("MultiCartCheckout",{uiContextName:"multicart_checkout_dialog",className:"multicart-checkout-dialog dialog-type-B",dependencies:"cart defaultChannel dialogManager dollarStoreManager externalNextRoot featureAccessManager globalStartupModel globalStringManager loginManager modeManager nextRoot paymentChannels prefsManager Promise restModelFactory urlManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".btn-primary.checkout",name:"checkout",handler:"__checkout",attributes:this.__getAttributes.bind(this)},{type:"click",selector:"input[id=vip_checkbox]",name:"vip_checkbox",handler:"__vipCheckbox"},{type:"click",selector:".terms .link",name:"general_tos",handler:"__generalTOS"},{type:"click",selector:".payment-channel-list li",name:"select_payment",handler:"__selectPayment"},{type:"click",selector:".other-checkout-container.active .other-payment-channel-list li",name:"select_extended_payment",handler:"__selectPaymentExtended"},{type:"click",selector:".back-button",name:"back_to_primary_channels",handler:this.__backToPrimaries},{type:"click",selector:".vcoin-terms-and-conditions-link",name:"vcoin_terms_and_conditions_link",handler:"__vcoinTOS"},{type:"click",selector:"input[id=vcoin_terms_and_conditions_checkbox]",name:"vcoin_terms_and_conditions_checkbox",handler:"__vcoinTermsCheckbox"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.restModelFactory=a.restModelFactory;var d=this.__getCoreDollarstoreProductOfferingUrlAndId();this.__coreDollarstoreProductOfferingUrl=d.url;this.__coreDollarstoreProductOfferingId=d.id;this.__getProductOfferingDataFromCoreDS();this.__prefsManager=a.prefsManager;this.__featureAccessManager=a.featureAccessManager;this.__paymentChannels=IMVU.requireProperty(a,"paymentChannels");this.__origin=IMVU.optionalProperty(a,"origin",null);this.__afterAction=IMVU.optionalProperty(a,"afterAction",null);this.title=this.__globalStringManager.get("CART SUMMARY");this.__vipModel=IMVU.optionalProperty(a,"vipModel",null);this.__hostModel=IMVU.optionalProperty(a,"hostModel",null);this.__which=IMVU.optionalProperty(a,"which",null);this.__hostModel&&(this.__afterAction="close");this.__addRoomTile=a.addRoomTile;this.__hostingSelfCancel=this.__hasTieredVipInCart=this.__hasVIPInCart=!1;this.__total=0;_.each(this.__cart.models,function(e){this.__total+=e.attributes.edge.sale_price;e.attributes.edge.rules.includes("is_vcoin")&&(this.__hasVcoinInCart=!0);e.attributes.edge.rules.includes("hosting_self_cancel")&&(this.__hostingSelfCancel=!0);"vip"==e.attributes.node.category&&(this.__vipModel=e,this.__hasVIPInCart=!0,e=this.__vipModel.get("node"),this.__hasTieredVipInCart=["vip_web_tier_1","vip_web_tier_2","vip_web_tier_3"].includes(e.code_name))}.bind(this));this.__cartTotalInVcoin=(250*this.__total).toFixed(2);this.__total="$"+parseFloat(this.__total).toFixed(2);this.listenTo(this.__dollarStoreManager,"update_checkout_total_price",this.__updateCheckoutTotal);d=[];this.__defaultChannel&&d.push(this.__defaultChannel.populated());d.push(this.__paymentChannels.populated());this.__Promise.every(d).then(function(){this.addToDOM()}.bind(this));this.__autoLaunchReview=IMVU.optionalProperty(a,"autoLaunchReview",!1)},postRender:function(){var a=this;this.__saved_card=null;this.$(".dialog-header").prepend('<div class="back-button hidden"></div>');this.__vantiv_ch=this.__getVantivChannel();var d=this.__globalStartupModel.get("savedCreditCardUrl"),e=this.track(this.__restModelFactory.readCollection(d,k.UiCore.NodeCollection));e.invalidate();e.populated().then(function(){a.__hasVIPInCart&&4===a.__myself.get("vip_platform")&&a.__dialogManager.confirm({title:a.__globalStringManager.get("vip_upsell_previous_subscription_title"),text:a.__globalStringManager.get("vip_upsell_previous_subscription_body"),no:a.__globalStringManager.get("CANCEL"),yes:a.__globalStringManager.get("OKAY")}).finished.catch(function(){a.close()})}).then(function(){if(a.__hasVIPInCart&&[2,3].includes(a.__myself.get("vip_platform"))){var c=[a.__globalStringManager.get("vip_upsell_company_1"),a.__globalStringManager.get("vip_upsell_company_2")][a.__myself.get("vip_platform")],g=[a.__globalStringManager.get("vip_upsell_platform_1"),a.__globalStringManager.get("vip_upsell_platform_2")][a.__myself.get("vip_platform")];c=a.__globalStringManager.get("vip_upsell_previous_subscription_mobile_body",{company:c?c:a.__globalStringManager.get("vip_upsell_company_3"),platform:g?g:a.__globalStringManager.get("vip_upsell_platform_3")});a.__dialogManager.alert({title:a.__globalStringManager.get("vip_upsell_previous_subscription_title"),text:c,ok:a.__globalStringManager.get("OKAY")}).finished.then(function(){a.__dialogManager.closeAll()}).catch(function(){a.__dialogManager.closeAll()})}}).then(function(){a.__hasVIPInCart&&a.__myself.get("is_host")&&(a.__hostingSelfCancel?a.__dialogManager.alert({title:a.__globalStringManager.get("vip_upsell_previous_host_subscription_title"),text:a.__globalStringManager.get("vip_upsell_previous_host_subscription_mobile_body"),ok:a.__globalStringManager.get("OKAY")}):a.__dialogManager.confirm({title:a.__globalStringManager.get("vip_upsell_previous_host_subscription_title"),html:a.__globalStringManager.get("vip_upsell_previous_host_subscription_desktop_body"),yes:a.__globalStringManager.get("OKAY"),no:a.__globalStringManager.get("CANCEL")}).finished.catch(function(){a.close()}))}).then(function(){var c=_.filter(e.models,function(h){return!0===h.attributes.is_primary&&"co"===h.attributes.system}.bind(this));_.isEmpty(c)&&(c=_.filter(e.models,function(h){return"co"===h.attributes.system}.bind(this)));!_.isEmpty(c)&&this.__vantiv_ch&&(this.__saved_card=c[0]);if(this.__saved_card){this.__saved_card.attributes.saved_card=!0;this.__saved_card.attributes.channel_key="saved_card";this.__saved_card.attributes.payment_method="vantiv";this.__saved_card.attributes["metadata.credit_card"]=1;c={id:"different_card",attributes:{display_name:this.__globalStringManager.get("USE DIFFERENT CARD"),icon_url:"/common/withme/img/store/payment/payment-creditcard.png",channel_key:"different_card",payment_method:"vantiv"},populated:function(){return new this.__Promise(function(h){h.accept(!0)}.bind(this))}.bind(this)};c.attributes["metadata.credit_card"]=1;var g=_.filter(this.__paymentChannels.models,function(h){return"saved_card"===h.attributes.channel_key});_.isEmpty(g)?(this.__paymentChannels.models.splice(0,0,c),this.__paymentChannels.models.splice(0,0,this.__saved_card)):this.__paymentChannels.models.splice(0,1,this.__saved_card)}c={total:this.__total,vcoinInCart:this.__hasVcoinInCart,tieredVIPInCart:this.__hasTieredVipInCart,helpCenterURL:this.__urlManager.get("imvu_help_privacy_policy"),subscriptionURL:this.__urlManager.get("manage_subscription"),vipTermsURL:this.__urlManager.get("policy_hub_vip")};this.setContent("body",k.template,c);var f=!1;_.each(this.__cart.models,function(h){0===h.get("edge").normal_price&&"credits"===h.get("node").code_name&&1===h.get("node").credits&&(f=!0)}.bind(this));_.each(this.__cart.models,function(h){h.attributes.node.disableCheckbox=f}.bind(this));this.__cartList=this.createChildContext(k.MultiCartList,{$replaceElement:this.$(".multi-cart-list-placehoder"),itemFactory:k.MultiCartCheckoutItem,collection:this.__cart});this.__updateAvailablePaymentMethods();this.setContent("footer",this.$(".dialog-footer-template").text());this.__vipModel&&(this.__vipWidget=this.createChildContext(k.MultiCartVipStatus,{$parentElement:this.$(".vip-status-widget"),model:this.__vipModel}),this.$(".agreement .vip-panel").removeClass("hidden"),this.$(".btn-primary.checkout").addClass("disabled"),this.createChildContext(k.Tooltip,{$replaceElement:this.$(".vip-toc-tooltip"),$tooltipTarget:this.$(".vip-toc-link"),tooltipPosition:"bottom"}));this.__hasVcoinInCart&&this.__availablePaymentChannels.length&&(c=1===this.__prefsManager.getInt("next.user_accepted_vcoin_tc"),this.$(".btn-primary.checkout").prop("disabled",!c),c&&this.$(".vcoin-checkbox").attr("checked","checked"));this.__selectPayment({target:{id:this.__availablePaymentChannels[0].id}});this.__autoLaunchReview&&this.__validateChannelPayoutPromise.then(function(){this.__checkout()}.bind(this))}.bind(this))},__destroy:function(){this.hide();this.delete()},__getAttributes:function(){return{which:this.__which}},__updateAvailablePaymentMethods:function(){var a=this;this.__availablePaymentChannels=this.__paymentChannels.models;var d=!1;_.each(this.__cart.models,function(e){e.attributes.edge.rules.includes("credit_card_only")&&e.isCheckedoutModel&&(d=!0)});d?(this.__creditCardPayemntChannels=_.filter(this.__availablePaymentChannels,function(e){if(1===e.attributes["metadata.credit_card"])return e}),this.__creditCardPayemntChannels.length?(this.$(".notice-credit-card-only-message").removeClass("hidden"),this.__availablePaymentChannels=this.__creditCardPayemntChannels):(this.$(".notice-credit-card-only-message").addClass("hidden"),this.$(".items-unavailable-for-purchase").addClass("error-visible"),_.each(this.__cartList.collection.models,function(e){e.attributes.edge.rules.includes("credit_card_only")&&(e.isCheckedoutModel=!1,e.isDisabledModel=!0,a.$(".multi-cart-item-info input[id=multi-cart-item-"+e.cid+"].checkbox").prop({checked:!1,disabled:!0}));e.isCheckedoutModel&&(a.__total+=e.attributes.edge.sale_price)}))):this.$(".notice-credit-card-only-message").addClass("hidden");this.__hasVcoinInCart&&(this.__vcoinPayemntChannels=_.filter(this.__availablePaymentChannels,function(e){if(1===e.attributes["metadata.sells_vcoin"])return e}),this.__vcoinPayemntChannels.length?(this.__availablePaymentChannels=this.__vcoinPayemntChannels,this.$(".notice-credit-card-only-message").removeClass("hidden")):(this.$(".notice-credit-card-only-message").addClass("hidden"),this.$(".items-unavailable-for-purchase").addClass("error-visible"),_.each(this.__cartList.collection.models,function(e){e.attributes.edge.rules.includes("is_vcoin")&&(e.isCheckedoutModel=!1,e.isDisabledModel=!0,a.$(".multi-cart-item-info input[id=multi-cart-item-"+e.cid+"].checkbox").prop({checked:!1,disabled:!0}));e.isCheckedoutModel&&(a.__total+=e.attributes.edge.sale_price)})));this.__checkForPaymentsOverride().then(function(e){a.$(".payment-channels-wrapper").empty();a.$(".other-checkout-container").empty();a.__paymentChannelsList=a.createChildContext(k.PaymentChannels,{$parentElement:a.$(".payment-channels-wrapper"),channels:e.slice(0,3),otherchannels:e.slice(3),hasOtherChannels:0<e.slice(3).length});0<e.slice(3).length&&(a.__otherPaymentChannelsList=a.createChildContext(k.OtherPaymentChannels,{$parentElement:a.$(".other-checkout-container"),otherChannels:e.slice(3)}));a.$('.payment-channel-list li[id="'+e[0].id+'"]').addClass("is-selected");a._currentPaymentChannels=e})},__updateCheckoutTotal:function(){var a=this;this.__total=0;this.__hostModel=this.__vipModel=null;this.__hasAtLeastOneSubscription=this.__hasVcoinInCart=!1;_.each(this.__cartList.collection.models,function(d){d.isCheckedoutModel&&("vip"===d.attributes.node.category?this.__vipModel=d:"hosting"===d.attributes.node.category&&(this.__hostModel=d),!0===d.attributes.edge.rules.includes("is_subscription")&&1<this.__cartList.collection.models.length&&!1===this.__hasAtLeastOneSubscription&&(this.__hasAtLeastOneSubscription=!0),d.attributes.edge.rules.includes("is_vcoin")&&(this.__hasVcoinInCart=!0))}.bind(this));this.__total=0;this.$("notice-credit-card-only-message").addClass("hidden");this.$(".notice-subscription-message").addClass("hidden");this.__hasVcoinInCart&&this.$(".notice-credit-card-only-message").removeClass("hidden");this.__hasVcoinInCart?_.each(this.__cartList.collection.models,function(d){d.isDisabledModel=!1;a.$(".multi-cart-item-info input[id=multi-cart-item-"+d.cid+"].checkbox").prop({disabled:!1});d.isCheckedoutModel&&(a.__total+=d.attributes.edge.sale_price)}):!1===this.__hasAtLeastOneSubscription?(_.each(this.__cartList.collection.models,function(d){!0!==d.attributes.edge.rules.includes("is_subscription")&&(!d.attributes.edge.rules.includes("is_vcoin")||d.attributes.edge.rules.includes("is_vcoin")&&1<=a.__vcoinPayemntChannels.length)&&(!d.attributes.edge.rules.includes("credit_card_only")||d.attributes.edge.rules.includes("credit_card_only")&&1<=a.__creditCardPayemntChannels.length)&&(d.isDisabledModel=!1,a.$(".multi-cart-item-info input[id=multi-cart-item-"+d.cid+"].checkbox").prop({disabled:!1}));d.isCheckedoutModel&&(a.__total+=d.attributes.edge.sale_price)}),this.$(".notice-subscription-message").addClass("hidden")):(this.__hasAtLeastOneSubscription=!1,_.each(this.__cart.models,function(d){!0===d.attributes.edge.rules.includes("is_subscription")&&!1===a.__hasAtLeastOneSubscription?(a.__hasAtLeastOneSubscription=!0,a.$(".notice-subscription-message").removeClass("hidden")):d.attributes.edge.rules.includes("is_vcoin")?d.isCheckedoutModel=!1:(d.isCheckedoutModel=!1,d.isDisabledModel=!0,a.$(".multi-cart-item-info input[id=multi-cart-item-"+d.cid+"].checkbox").prop({checked:!1,disabled:!0}));d.isCheckedoutModel&&(a.__total+=d.attributes.edge.sale_price)}));this.__updateAvailablePaymentMethods();0===this.__total?this.$(".btn.btn-primary.checkout").addClass("disabled"):this.$(".btn.btn-primary.checkout").removeClass("disabled");this.__vipWidget&&this.__vipWidget.delete();this.__vipModel?(this.__vipWidget=this.createChildContext(k.MultiCartVipStatus,{$parentElement:this.$(".vip-status-widget"),model:this.__vipModel}),this.$(".agreement .vip-panel").removeClass("hidden"),this.$("input[id=vip_checkbox]").prop("checked")?this.$(".btn-primary.checkout").removeClass("disabled"):this.$(".btn-primary.checkout").addClass("disabled")):this.$(".agreement .vip-panel").addClass("hidden");this.__cartTotalInVcoin=(250*this.__total).toFixed(2);this.__total="$"+parseFloat(this.__total).toFixed(2);this.$(".checkout-bottom-container .price-summary .price").text(this.__total)},__selectPayment:function(a){var d=a.target.id;"other-payment-type"===d?this.__vipModel&&!this.$("input[id=vip_checkbox]").prop("checked")?this.$(".vip-checkbox-missing").addClass("error-visible"):this.__hasVcoinInCart&&!this.$("input[id=vcoin_terms_and_conditions_checkbox]").prop("checked")?this.$(".vcoin-checkbox-missing").addClass("error-visible"):this.__showExtendedPaymentOptions():this.__validateChannelPayoutPromise=this.__validateChannelPayout(this.__getChannel(d),this.__defaultChannel,this.__vantiv_ch).then(function(){this.$(".other-payment-channel-list li").removeClass("is-selected");this.__updateCheckoutTotal();this.$(".payment-channel-list li").removeClass("is-selected");this.$('.payment-channel-list li[id="'+d+'"]').addClass("is-selected")}.bind(this))},__showExtendedPaymentOptions:function(){this.$(".vip-checkbox-missing").removeClass("error-visible");this.$(".vcoin-checkbox-missing").removeClass("error-visible");this.$(".checkout-container").addClass("hidden");this.$(".other-checkout-container").addClass("active");this.$(".dialog-header .back-button").removeClass("hidden")},__showPrimaryPaymentOptions:function(){this.$(".checkout-container").removeClass("hidden");this.$(".other-checkout-container").removeClass("active");this.$(".dialog-header .back-button").addClass("hidden")},__selectPaymentExtended:function(a){var d=a.target.id;"other-payment-type"===d?this.__showPrimaryPaymentOptions():this.__validateChannelPayout(this.__getChannel(d),this.__defaultChannel,this.__vantiv_ch).then(function(){this.__updateCheckoutTotal();this.$(".payment-channel-list li").removeClass("is-selected");this.$(".other-payment-channel-list li").removeClass("is-selected");this.$('.other-payment-channel-list li[id="'+d+'"]').addClass("is-selected")}.bind(this))},__backToPrimaries:function(){this.__showPrimaryPaymentOptions()},__generalTOS:function(){var a=this.__urlManager.get("policy_hub_terms");this.__featureAccessManager.isElectronClient()?(this.__electron=this.__window.electronRequire("electron"),this.__electron.shell.openExternal(a)):this.__window.open(a,"_blank")},__vcoinTOS:function(a){this.__generalTOS();a.stopImmediatePropagation()},__vipCheckbox:function(){this.$("input[id=vip_checkbox]").prop("checked")?(this.$(".vip-checkbox-missing").removeClass("error-visible"),this.$(".btn-primary.checkout").removeClass("disabled")):this.$(".btn-primary.checkout").addClass("disabled")},__vcoinTermsCheckbox:function(){this.$("input[id=vcoin_terms_and_conditions_checkbox]").prop("checked")?(this.__prefsManager.setInt("next.user_accepted_vcoin_tc",1),this.$(".vcoin-checkbox-missing").removeClass("error-visible"),this.$(".btn-primary.checkout").prop("disabled",!1)):(this.__prefsManager.setInt("next.user_accepted_vcoin_tc",0),this.$(".btn-primary.checkout").prop("disabled",!0))},__getVantivChannel:function(){return _.find(this.__paymentChannels.models,function(a){if("vantiv"===a.attributes.channel_key)return a})},__getChannel:function(a){return _.find(this.__paymentChannels.models,function(d){if(a===d.id)return d})},__checkout:function(){var a=".checkout-container";this.$(".vip-checkbox-missing").removeClass("error-visible");this.$(".vcoin-checkbox-missing").removeClass("error-visible");this.$(".checkout-container").hasClass("hidden")&&(a=".other-checkout-container");var d=this.$(a+" li.is-selected").prop("id");d||(".other-checkout-container"===a?d=this.$(".checkout-container li.is-selected").prop("id"):".checkout-container"===a&&(d=this.$(".other-checkout-container li.is-selected").prop("id")));d=this.__getChannel(d);var e=this.__dollarStoreManager.validateMultiCartCheckoutRules(d,this.__cart);if(_.isEmpty(e))this.__checkoutValidCart(d);else{var c=_.filter(e,function(g){return"credit_card_only"===g.type});_.isEmpty(c)||this.__dialogManager.showDialog(k.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("CART CONTENTS WILL CHANGE"),text:this.__globalStringManager.get("CART CONTENTS WILL CHANGE DESC"),yes:this.__globalStringManager.get("OK"),no:this.__globalStringManager.get("CANCEL")}).finished.then(function(){_.each(c,function(g){var f="multi-cart-item-"+g.target.cid;this.$("input[id="+f+"]").prop("checked",!1);g.target.isCheckedoutModel=!1;this.__dollarStoreManager.trigger("update_checkout_total_price");this.$('label[for="'+f+'"]').addClass("removed")}.bind(this));".other-checkout-container"===a&&this.__showPrimaryPaymentOptions()}.bind(this)).catch(function(){}.bind(this))}},__checkoutValidCart:function(a){"vantiv"===a.attributes.payment_method?"vantiv"===a.attributes.channel_key?this.__checkoutVantivNewCard(a):"saved_card"===a.attributes.channel_key?this.__checkoutVantivSavedCard(a):"different_card"===a.attributes.channel_key&&this.__checkoutVantivManageCards(a):"paypal"===a.attributes.payment_method?this.__checkoutPaypal(a):"paymentwall"===a.attributes.payment_method?this.__checkoutPaymentWall(a):"test"===a.attributes.payment_method?this.__checkoutTestChannel(a,this.__cart):"vcoin"===a.attributes.payment_method&&(this.__wallet=this.track(this.__myself.getSingleEdge("wallet")),this.__dollarStoreManager.storeCheckoutWithVcoin({cartCollection:this.__cart,cartTotalInVcoin:this.__cartTotalInVcoin,paymentChannels:this.__paymentChannels,source:"multicart_checkout",wallet:this.__wallet}))},__validateChannelPayout:function(a,d,e){return new this.__Promise(function(c){var g=!1,f=a.attributes.payout,h=d.attributes.payout,l=this.__dollarStoreManager.getDefaultCategories();f||(f=e.attributes.payout,g=!0);h||(h=e.attributes.payout);f<h&&70>f?this.__dialogManager.showDialog(k.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("PRICE ADJUSTMENT TITLE"),text:this.__globalStringManager.get("PRICE ADJUSTMENT DESC"),yes:this.__globalStringManager.get("OK"),no:this.__globalStringManager.get("CANCEL")}).finished.then(function(){this.__window.$("body").addClass("waiting");this.__dollarStoreManager.getProductsOffered(l,a).then(function(n){this.__updateCartModels(this.__cart.models,n.models);this.__window.$("body").removeClass("waiting");return c.accept()}.bind(this))}.bind(this)).catch(function(){return c.reject()}.bind(this)):f>h&&70>h?this.__dialogManager.showDialog(k.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("PRICE ADJUSTMENT TITLE"),text:this.__globalStringManager.get("PRICE ADJUSTMENT LOWER DESC"),yes:this.__globalStringManager.get("OK"),no:this.__globalStringManager.get("CANCEL")}).finished.then(function(){this.__window.$("body").addClass("waiting");g&&(a=e);this.__dollarStoreManager.getProductsOffered(l,a).then(function(n){this.__updateCartModels(this.__cart.models,n.models);this.__window.$("body").removeClass("waiting");return c.accept()}.bind(this))}.bind(this)).catch(function(){return c.reject()}.bind(this)):(this.__window.$("body").addClass("waiting"),g&&(a=e),this.__dollarStoreManager.getProductsOffered(l,a).then(function(n){this.__updateCartModels(this.__cart.models,n.models);this.__window.$("body").removeClass("waiting");return c.accept()}.bind(this)))}.bind(this))},__updateCartModels:function(a,d){_.each(a,function(e){_.each(d,function(c){var g=this.__coreDollarstoreProductOfferingId?this.__coreDollarstoreProductOfferingId:c.edge.attributes.product_offering_id,f=c.edge.attributes.sale_price,h=c.edge.attributes.sale_price_formatted;this.__oldDollarstoreProductOfferingUrl&&(e.attributes.edge.normal_price<c.edge.attributes.normal_price||e.attributes.edge.normal_price<e.attributes.edge.sale_price)&&(f=e.attributes.edge.normal_price,h=e.attributes.edge.normal_price_formatted);e.attributes.node.id===c.node.id&&(e.productModel=c,e.attributes.edge.normal_price=c.edge.attributes.normal_price,e.attributes.edge.normal_price_formatted=c.edge.attributes.normal_price_formatted,e.attributes.edge.product_offering_id=g,e.attributes.edge.sale_price=f,e.attributes.edge.sale_price_formatted=h,e.trigger("cart_model_price_update"))}.bind(this))}.bind(this))},__getReloadURL:function(){for(var a=this.__window.location.href,d=this.__serviceProvider.get("acceptedDollarStorePermaLinkProducts"),e=0;e<d.length;e++)if(a.endsWith("/store/"+d[e]+"/")){a=this.__window.location.origin+"/next/store/";break}return a},__handleAfterAction:function(a){"close"===this.__afterAction?this.close():"closeAll"===this.__afterAction?this.__dialogManager.closeAll():"reload"===this.__afterAction?this.__window.location=this.__getReloadURL():"closeToEditRoomSettings"===this.__afterAction?this.__dialogManager.closeTo("edit-room-settings"):"restWebGiftingDialog"===this.__afterAction?this.__dialogManager.closeTo("rest-web-gifting-dialog"):"upsellShell"===this.__afterAction?this.__modeManager.openMode({mode:{id:"shop"},submode:{id:"rooms"}}):"selectPrivateRoom"===this.__afterAction?this.__addRoomTile&&this.__addRoomTile.callOpenSelectRoomDialog({isPublicOverride:!0}):"clear_cart"===a?this.__window.location.reload():this.close()},__checkoutVantivNewCard:function(a){this.__dialogManager.showDialog(k.MultiCartAddCreditCard,{cart:this.__cart,channel:a,orderTotal:this.__total,origin:this.__origin}).finished.then(function(d){this.promiseResolver.resolve();this.__handleAfterAction(d)}.bind(this)).catch(function(d){"closing_all"===d&&this.close()}.bind(this))},__checkoutVantivSavedCard:function(a){this.__dialogManager.showDialog(k.MultiCartReview,{billingInfo:{card_type:this.__saved_card.attributes.card_type,name:this.__saved_card.attributes.name,last_four_digits:this.__saved_card.attributes.card_last_digits,card_id:this.__saved_card.id,saved_card:!0},channel:this.__vantiv_ch,cart:this.__cart,origin:this.__origin}).finished.then(function(d){this.promiseResolver.resolve();this.__handleAfterAction(d)}.bind(this)).catch(function(d){"closing_all"===d&&(this.promiseResolver.resolve(d),this.close())}.bind(this))},__checkoutVantivManageCards:function(a){this.__dialogManager.showDialog(k.MultiCartSavedCards,{billingInfo:{card_type:this.__saved_card.attributes.card_type,name:this.__saved_card.attributes.name,last_four_digits:this.__saved_card.attributes.card_last_digits,card_id:this.__saved_card.id,saved_card:!0},channel:this.__vantiv_ch,cart:this.__cart,origin:this.__origin}).finished.then(function(d){this.promiseResolver.resolve();this.__handleAfterAction(d)}.bind(this)).catch(function(d){"closing_all"===d&&this.close()}.bind(this))},__checkoutPaypal:function(a){this.__paypalCheckout(a,this.__cart).then(function(d){"finished_order_success"===d?this.promiseResolver.resolve("clear_cart"):this.promiseResolver.reject("clear_cart")}.bind(this)).catch(function(d){this.close()}.bind(this))},__checkoutPaymentWall:function(a){this.__paymentWallCheckout(a,this.__cart).then(function(d){this.close()}.bind(this))},__checkoutTestChannel:function(a,d){a=this.__buildOrderSelection(d.models);a={total:this.__calculateTotal(d.models),product_offering_id:d.models[0].attributes.edge.product_offering_id,selected:a};var e=this.__globalStartupModel.get("cashOrderTrans");this.__restModelFactory.createModel(e,k.UiCore.NodeModel,a).then(function(c){this.__dialogManager.showDialog(k.MultiCartSuccess,{cart:d.models,orderResponse:c,channel:"test",origin:this.__origin}).finished.then(function(g){this.promiseResolver.resolve("clear_cart")}.bind(this))}.bind(this)).catch(function(c){this.promiseResolver.reject()}.bind(this))},__checkForPaymentsOverride:function(){var a=this;return new this.__Promise(function(d){d.resolve(_.reject(a.__availablePaymentChannels,function(e,c){var g=e.attributes.override_with;return void 0!==g&&_.find(a.__availablePaymentChannels,function(f){return f.attributes.channel_key===g})?!0:!1}))})}})}({Dialogs:m["@Dialogs"],Model:m["@Model"],UiCore:m["@UiCore"],MultiCartAbstractDialog:L,MultiCartAddCreditCard:M,MultiCartCheckoutItem:Sa,MultiCartList:N,MultiCartReview:z,MultiCartSavedCards:Oa,MultiCartSuccess:K,MultiCartVipStatus:Qa,OtherPaymentChannels:Ua,PaymentChannels:Ja,Tooltip:r,template:Ka}),Za=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("MultiCartUpsellDialog",{className:"multicart-upsell-dialog dialog-type-B",uiContextName:"multicart_upsell_dialog",dependencies:"dialogManager featureAccessManager globalStartupModel globalStringManager loginManager urlManager window".split(" "),trackedEvents:function(){return[{type:"click",selector:".checkout-cta:not(.disabled)",name:"add_to_cart",handler:"__handleCheckout"},{type:"click",selector:".greeter-cta",name:"greeter_cta",handler:"__handleGreeterCTA"},{type:"click",selector:".learn",name:"learn_more",handler:this.__handleLearnMore}]},initialize:function(a){b.prototype.initialize.call(this,a);this.canCloseWithOverlayClick=!1;this.__singleItemCart=new k.CartCollection([]);if(this.__isLoggedIn=this.__loginManager.isLoggedIn())this.__dollarStoreManager=this.__serviceProvider.get("dollarStoreManager"),this.__myself=this.__loginManager.getCurrentUser();this.__upsellProduct=IMVU.requireProperty(a,"upsellProduct","credits");this.__isCreatorLanding=IMVU.optionalProperty(a,"isCreatorLanding",!1);this.__customSubtitle=IMVU.optionalProperty(a,"customSubtitle",!1);this.__customDlg_name=IMVU.optionalProperty(a,"customDlg_name",!1);this.__customDescription=IMVU.optionalProperty(a,"customDescription",!1);this.upsellAfterGift=IMVU.optionalProperty(a,"upsellAfterGift",!1);this.__customProductAdUrl=IMVU.optionalProperty(a,"customProductAdUrl",!1);this.__giftRecipient=IMVU.optionalProperty(a,"giftRecipient",!1);this.__isContextual=IMVU.optionalProperty(a,"contextual",!1);this.__afterAction=IMVU.optionalProperty(a,"afterAction",null);this.__vipForWhisper=IMVU.optionalProperty(a,"vipForWhisper",!1);this.__vipTrigger=IMVU.optionalProperty(a,"vipTrigger",null);this.__vipTriggerLocation=IMVU.optionalProperty(a,"vipTriggerLocation",null);this.__model=null;this.__simulated=!1;this.__packageMap=this.__getPackageMap();this.__categories=this.__getCategories().categories;this.__storeType=this.__getCategories().storeType;this.__disabledProducts=IMVU.optionalProperty(a,"disabledProducts",[]);this.__selectedProduct=IMVU.optionalProperty(a,"selectedProduct",!1);this.__isTieredVIP="vip"===this.__upsellProduct;this.addToDOM()},postRender:function(){var a=this;this.$el.addClass("product-"+this.__upsellProduct);if(this.__isLoggedIn&&"greeter"!==this.__upsellProduct)this.__dollarStoreManager.getPaymentChannels(this.__categories,this.__storeType).then(function(e){a.__paymentChannels=e;if(e.at(0)&&"vantiv"===e.at(0).attributes.payment_method){var c=_.find(e.models,function(g){if("vantiv"===g.attributes.channel_key)return g});a.__defaultPaymentChannel=c?c:e.at(0)}else a.__defaultPaymentChannel=e.at(0)}).then(function(){"vcoin"===a.__upsellProduct&&a.listenTo(a,"vcoin_product_selected_in_blocked_region",function(){this.__showVcoinUnavailableOnCheckout=!0});if(void 0===a.__defaultPaymentChannel&&"vcoin"==a.__upsellProduct){var e='<a href="'+a.__urlManager.get("unavailable_vcoin")+'" target="_blank">'+a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_link")+"</a>";e="<p>"+a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_part1")+" "+e+". "+a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_part2")+"</p>";a.__dialogManager.alert({title:a.__globalStringManager.get("vcoin_unavailable_region_blocked_error_title"),html:e,ok:a.__globalStringManager.get("OKAY"),dark_text:!0}).finished.then(function(){a.hide()})}else a.__dollarStoreManager.getProductsOffered(a.__categories,a.__defaultPaymentChannel,void 0,!0).then(function(c){var g=!1;a.__upsellProductModel=null;a.__upsellProductCollection=c;for(var f=c.models,h=f.length,l,n=0;n<h;n++)if(l=f[n],"access_pass"===l.node.get("code_name")&&"ap"===a.__upsellProduct||"marriage_license"===l.node.get("code_name")&&"marriage_package"===a.__upsellProduct||"age_verification"===l.node.get("code_name")&&"age_verification"===a.__upsellProduct||"shared_room"===l.node.get("code_name")&&"shared_room"===a.__upsellProduct||"name_change_tokens"===l.node.get("code_name")&&"name_change"===a.__upsellProduct||"name_change_and_registration"===l.node.get("code_name")&&"name_change"===a.__upsellProduct||"chat_room_slot"===l.node.get("code_name")&&"room_slot"===a.__upsellProduct){a.__upsellProductModel=l;break}a.__upsellProductModel?g=!0:("host_subscription"===a.__upsellProduct||"credits"===a.__upsellProduct||"vcoin"===a.__upsellProduct)&&0<f.length?(a.__upsellProductModel=c.models[0],g=!0):"vip"===a.__upsellProduct&&0<f.length?(a.__upsellProductModel=c.models[0],g=!0):"vip"===a.__upsellProduct&&0===f.length&&(g=!1);a.__model=a.__upsellProductModel;a.__model&&g?a.__getPackageMapOverrides():a.__getSimulatedModel()}).catch(function(c){}).then(function(){a.title=a.__model.node.attributes.name;a.__getPackageMapOverrides();a.__isTieredVIP&&(a.__isCreatorLanding?(a.title=a.__globalStringManager.get("vip_upsell_creator_landing_title"),a.__subtitle=a.__globalStringManager.get("vip_upsell_creator_landing_subtitle")):(a.title=a.__globalStringManager.get("vip_upsell_title"),a.__subtitle=a.__globalStringManager.get("vip_upsell_subtitle")));a.__renderTitle();a.upsellAfterGift&&a.__adjustDialogSize();a.setContent("body",k.template,{product_ad_url:a.__customProductAdUrl?a.__customProductAdUrl:a.__model.node.attributes.dlg_background_url,subtitle:a.__subtitle,loggedIn:a.__isLoggedIn,greeter:"greeter"===a.__upsellProduct,sale_price:a.__model.edge.attributes.sale_price_formatted,upsellAfterGift:a.upsellAfterGift,giftRecipient:a.__giftRecipient,simulated:a.__simulated});if("vip"===a.__upsellProduct&&a.__vipTrigger&&a.__vipTriggerLocation){var c={vipTriggerLocation:a.__vipTriggerLocation,vipTrigger:a.__vipTrigger,clientIp:a.__globalStartupModel.get("clientIPAddress")};a.recordShowTieredVipUpsell(c)}a.$(".description").html(a.__isTieredVIP?k.multiProductUpsellVipTiers({vip_web_tier_1:1,vip_web_tier_2:1,vip_web_tier_3:1,isCreatorLanding:a.__isCreatorLanding,canSeeYouTube:a.__featureAccessManager.canSeeYouTubePreRecorded()}):a.__description);a.setContent("footer",a.$(".dialog-footer-template").text());a.__isLoggedIn&&("credits"===a.__upsellProduct||"host_subscription"===a.__upsellProduct||"vip"===a.__upsellProduct)||"vcoin"===a.__upsellProduct?(a.__disableCheckoutButton(),a.upsellAfterGift&&a.__enableCheckoutButton(),c=a.$(".product-selectors").expect(1),c.addClass("go-link"),c.html(""),a.__simulated?a.__enableSimulatedCheckoutButton():a.productsList=a.createChildContext(k.MultiProductList,{$parentElement:c,collection:a.__upsellProductCollection,cartCollection:a.__singleItemCart,category:a.__upsellProduct,upsellDialog:a,isUpsell:!0,disabledProducts:a.__disabledProducts,selectedProduct:a.__selectedProduct})):a.__simulated?a.__enableSimulatedCheckoutButton():a.__enableCheckoutButton();a.$el.is(".dialog-type-B, .dialog-type-B-flexible")&&a.$el.closest("body").is(".mobile")&&a.__adjustTitlePosition();a.$(".dialog-body-scroller").scrollbar()}).catch(function(c){a.__window.console.error("HostSubUpsellDialog::render - Failed to render BuyUpgradeHostSubList",c)})}).catch(function(){a.__window.console.error("HostSubUpsellDialog::render - Failed to get payment channels")});else{var d="vcoin"===this.__upsellProduct;this.__getSimulatedModel();this.setContent("body",k.template,{product_ad_url:this.__customProductAdUrl?this.__customProductAdUrl:this.__model.node.attributes.dlg_background_url,subtitle:this.__subtitle,loggedIn:this.__isLoggedIn,greeter:"greeter"===this.__upsellProduct,sale_price:this.__model.edge.attributes.sale_price_formatted,simulated:!0,vcoinUpsell:d,upsellAfterGift:this.upsellAfterGift,giftRecipient:this.__giftRecipient});d&&this.$(".dialog-body").addClass("vcoin-logged-out");"vip"===this.__upsellProduct&&(!1===this.__selectedProduct&&(this.__selectedProduct=1),d={},this.__description=k.multiProductUpsellVipTiers((d["vip_web_tier_"+(1+this.__selectedProduct)]=1,d.canSeeYouTube=this.__featureAccessManager.canSeeYouTubePreRecorded(),d)));this.$(".description").html(this.__description);this.setContent("footer",this.$(".dialog-footer-template").text());this.__enableSimulatedCheckoutButton();this.$(".dialog-body-scroller").scrollbar()}},__directToLogin:function(){this.__loginManager.setLoginDestination(this.__nextRoot+"store/"+this.__upsellProduct);this.__window.location="/welcome/login/";this.forwardedToLogin=!0},aProductClicked:function(a){this.__model=a;null===a?this.__disableCheckoutButton():(this.__enableCheckoutButton(),this.upsellAfterGift&&this.__addToCart(!0))},switchDescription:function(a){this.$("."+a+"-description").show().siblings().hide()},__getErrorString:function(){var a="",d=!1===this.__myself.get("is_adult");switch(this.__upsellProduct){case"ap":a=d?this.__globalStringManager.get("oops_minor_ap"):this.__globalStringManager.get("oops_already_have_ap");break;case"marriage_package":a=d?this.__globalStringManager.get("oops_minor_marriage_package"):this.__globalStringManager.get("oops_already_have_this_upgrade");break;case"age_verification":a=d?this.__globalStringManager.get("oops_minor_age_verification"):this.__globalStringManager.get("oops_already_have_this_upgrade");break;case"vip":a=this.__globalStringManager.get("oops_already_have_vip");break;default:this.__window.console.error("MultiCartUpsellDialog::__getErrorString - __upsellProduct not accepted",this.__upsellProduct)}return a},__handleCheckout:function(){this.__isLoggedIn&&"vcoin"===this.__upsellProduct&&this.__showVcoinUnavailableOnCheckout?this.__showVcoinUnavailableDialog():this.__addToCart()},__showVcoinUnavailableDialog:function(){var a=this,d='<a href="'+this.__urlManager.get("unavailable_vcoin")+'" target="_blank">'+this.__globalStringManager.get("vcoin_unavailable_region_blocked_error_message_link")+"</a>";d="<p>"+this.__globalStringManager.get("vcoin_unavailable_error_text")+" "+d+"</p>";this.__dialogManager.showDialog(k.Dialogs.AlloyConfirmDialog,{title:this.__globalStringManager.get("vcoin_unavailable_error_title"),text:this.__globalStringManager.get("vcoin_unavailable_error_text"),html:d,yes:this.__globalStringManager.get("Continue"),no:this.__globalStringManager.get("CANCEL"),dark_text:!0}).finished.then(function(){a.__addToCart()}).catch(function(e){})},__determineAfterAction:function(){var a=this.__afterAction;if(null===a)switch(this.__upsellProduct){case"ap":case"marriage_package":case"age_verification":case"vip":a=this.__isContextual?this.__vipForWhisper?"close":"closeAll":"reload";break;default:a="closeAll"}return a},__addToCart:function(a){var d=this;if(this.__isLoggedIn)if(!this.__simulated||"ap"!==this.__upsellProduct&&"marriage_package"!==this.__upsellProduct&&"age_verification"!==this.__upsellProduct&&"vip"!==this.__upsellProduct)if(this.__upsellProduct){this.$(".checkout-cta").addClass("disabled");var e=new IMVU.NamedModel({node:this.__model.node.attributes,edge:this.__model.edge.attributes,productModel:this.__model});this.__singleItemCart.add(e);if(this.__isCreatorLanding){e=[];e.push({product_name:this.__model.node.attributes.code_name,product_id:this.__model.node.attributes.product_packages_id.toString(),product_category:this.__model.node.attributes.category,product_price:this.__model.edge.attributes.sale_price,product_quantity:1});try{this.__window.pintrk("track","AddToCart",{value:this.__model.edge.attributes.sale_price,order_quantity:1,currency:"USD",line_items:e},function(c,g){c||this.__appMonitor.reportCustomError("MultiCartUpsellDialog","__addToCart","web_perm_0005k","Error returned from pintrk callback",["Reported Error: "+g])}.bind(this))}catch(c){this.__appMonitor.reportCustomError("MultiCartUpsellDialog","__addToCart","web_perm_0005d","Error thrown in call to window.pintrk",["Reported Error: "+c.message])}}this.__dollarStoreManager.validateAccountStatus().then(function(){this.__dialogManager.showDialog(k.MultiCartCheckout,{cart:this.__singleItemCart,paymentChannels:this.__paymentChannels,defaultChannel:this.__defaultPaymentChannel,origin:"dollar",which:this.__vipTrigger,afterAction:this.__determineAfterAction()}).finished.then(function(){this.close()}.bind(this)).catch(function(){this.close()}.bind(this))}.bind(this)).then(function(){this.$(".checkout-cta").removeClass("disabled");this.upsellAfterGift&&!a&&this.__dialogManager.closeAll()}.bind(this))}else this.close();else this.__myself.populated().then(function(){var c=d.__getErrorString();d.__dialogManager.showDialog(k.Dialogs.AlloyAlertDialog,{title:d.__globalStringManager.get("oops"),text:c,ok:d.__globalStringManager.get("OKAY")}).finished.then(function(){d.__dialogManager.closeAll()})});else this.__directToLogin()},__enableCheckoutButton:function(){this.$(".checkout-cta").removeClass("disabled");this.upsellAfterGift?this.$(".checkout-cta").html(this.__globalStringManager.get("upsell_after_gift_cta")):this.$(".checkout-cta").html(this.__globalStringManager.get("buy_now_for")+" "+this.__model.edge.attributes.sale_price_formatted)},__enableSimulatedCheckoutButton:function(){this.$(".checkout-cta").removeClass("disabled");this.$(".checkout-cta").html(this.__globalStringManager.get("buy_now"))},__disableCheckoutButton:function(){this.$(".checkout-cta").addClass("disabled");this.$(".checkout-cta").html(this.__globalStringManager.get("buy_now"))},__clearCart:function(){this.__singleItemCart=new k.CartCollection([])},show:function(){this.__clearCart();b.prototype.show.call(this)},hide:function(){if(this.__isLoggedIn){b.prototype.hide.call(this);var a=new CustomEvent("multiCartUpsellDialog:closed");this.__window.dispatchEvent(a)}else this.__directToLogin()},close:function(){if(this.__isLoggedIn){var a=new CustomEvent("multiCartUpsellDialog:clickedCancel");this.__window.dispatchEvent(a);b.prototype.close.call(this)}else this.__directToLogin()},__handleLearnMore:function(){this.$(".description-short").addClass("hidden");this.$(".learn").addClass("hidden");this.$(".description-long").removeClass("hidden");this.$(".lines").removeClass("hidden")},__handleGreeterCTA:function(){this.__featureAccessManager.isElectronClient()?this.__serviceProvider.get("externalWindow").open(this.__urlManager.get("greeter_program_info")):this.__window.location=this.__urlManager.get("greeter_program_info")},__renderTitle:function(){this.$(".dialog-header .dialog-title").text(this.title)},__adjustDialogSize:function(){this.$(".dialog-container").removeClass(this.title);this.$(".dialog-container").addClass("upsell_after_gift_"+this.__upsellProduct)},__getSimulatedModel:function(){this.__simulated=!0;var a={node:{}};a.node.attributes={dlg_name:"",name:"",dlg_background_url:"",sale_price_formatted:""};a.edge={};a.edge.attributes={sale_price_formatted:null};switch(this.__upsellProduct){case"ap":a.node.attributes.dlg_name="dlg_accesspass";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_ap");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-access-pass-2021-01-15.jpg";break;case"marriage_package":a.node.attributes.dlg_name="dlg_marriagepackage";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_marriage_package");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-marriage-package-2021-01-15.jpg";break;case"age_verification":a.node.attributes.dlg_name="dlg_ageverify";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_age_verification");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-age-verification-2021-01-15.jpg";break;case"shared_room":a.node.attributes.dlg_name="dlg_sharedroom";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_shared_room");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-shared-room-2021-01-15.jpg";break;case"name_change":a.node.attributes.dlg_name="dlg_namechange";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_name_change");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-name-change-token-2021-01-15.jpg";break;case"room_slot":a.node.attributes.dlg_name="dlg_chatroomslot";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_room_slot");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-chat-room-slot-2021-01-15.jpg";break;case"credits":a.node.attributes.dlg_name="dlg_credits";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_credits");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-buy-credits-2021-01-15.jpg";break;case"vip":a.node.attributes.dlg_name="dlg_vip";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_vip");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/vip/products/upsell_large_art.png";break;case"host_subscription":a.node.attributes.dlg_name="dlg_host_subscription";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_host_subscription");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-become-a-host-2021-01-15.jpg";break;case"greeter":a.node.attributes.dlg_name="dlg_greeter";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_greeter");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-greeter-program-2021-01-15.jpg";break;case"vcoin":a.node.attributes.dlg_name="vcoin";a.node.attributes.name=this.__globalStringManager.get("MCS_Simulated_Model_Name_vcoin");a.node.attributes.dlg_background_url="https://static-akm.imvu.com/imvufiles/multicart-upsell-dialog-buy-vcoin-2021-01-15.jpg";break;default:a=null,this.__window.console.error("MultiCartSubmode::__getSimulatedModel - Unknown product",this.__upsellProduct)}a.on=function(){};this.__model=a;this.title=this.__model.node.attributes.name;this.__getPackageMapOverrides();this.__renderTitle();this.upsellAfterGift&&this.__adjustDialogSize()},__getPackageMap:function(){return{dlg_namechange:{subtitle_key:"UPGRADE_NAME_CHANGE_TOKEN_TITLE",desc_key:"UPGRADE_NAME_CHANGE_TOKEN_DESC",dlg_title:"MCS_Simulated_Model_Name_name_change"},dlg_accesspass:{subtitle_key:"UPGRADE_ACCESS_PASS_TITLE",desc_key:"UPGRADE_ACCESS_PASS_DESC"},dlg_namereg:{subtitle_key:"UPGRADE_NAME_REGISTRATION_TITLE",desc_key:"UPGRADE_NAME_REGISTRATION_DESC"},dlg_ageverify:{subtitle_key:"UPGRADE_AGE_VERIFICATION_TITLE",desc_key:"UPGRADE_AGE_VERIFICATION_DESC"},dlg_sharedroom:{subtitle_key:"UPGRADE_SHARED_ROOM_TITLE",desc_key:"UPGRADE_SHARED_ROOM_DESC"},dlg_chatroomslot:{subtitle_key:"UPGRADE_CHATROOM_SLOT_TITLE",desc_key:"UPGRADE_CHATROOM_SLOT_DESC"},dlg_marriagepackage:{subtitle_key:"UPGRADE_MARRIAGE_LICENSE_TITLE",desc_key:"UPGRADE_MARRIAGE_LICENSE_DESC"},dlg_vip:{subtitle_key:"UPGRADE_VIP_TITLE",desc_key:"UPGRADE_VIP_DESC",dlg_title:"MCS_Simulated_Model_Name_vip"},dlg_host_subscription:{subtitle_key:"UPGRADE_HOST_SUB_TITLE",desc_key:"UPGRADE_HOST_SUB_DESC",dlg_title:"UPGRADE_HOST_SUB_DLG_TITLE"},dlg_credits:{subtitle_key:"UPGRADE_CREDITS_TITLE",desc_key:"UPGRADE_CREDITS_DESC",dlg_title:"MCS_Simulated_Model_Name_credits"},dlg_greeter:{subtitle_key:"UPGRADE_GREETER_TITLE",desc_key:"UPGRADE_GREETER_DESC",dlg_title:"MCS_Simulated_Model_Name_greeter"},vcoin:{subtitle_key:"UPGRADE_VCOIN_TITLE",desc_key:"UPGRADE_VCOIN_DESC",dlg_title:"MCS_Simulated_Model_Name_vcoin"},upsell_after_gift_subtitle_credits:{subtitle_key:"upsell_after_gift_subtitle_credits",desc_key:"UPGRADE_CREDITS_DESC",dlg_title:"upsell_after_gift_title"},upsell_after_gift_subtitle_vcoin:{subtitle_key:"upsell_after_gift_subtitle_vcoin",desc_key:"UPGRADE_VCOIN_DESC",dlg_title:"upsell_after_gift_title"},upsell_after_gift_subtitle_product:{subtitle_key:"upsell_after_gift_subtitle_product",desc_key:"UPGRADE_CREDITS_DESC",dlg_title:"upsell_after_gift_title"}}},__getCategories:function(){switch(this.__upsellProduct){case"ap":case"marriage_package":case"age_verification":case"shared_room":case"name_change":case"room_slot":var a=["upgrade"],d="next";break;case"credits":a=["credits"];d="next";break;case"vip":a=["vip"];d="next";break;case"host_subscription":a=["hosting"];d="next";break;case"greeter":break;case"vcoin":a=["vcoin"];d="vcoin";break;case"product":this.__upsellProduct="credits";a=["credits"];d="next";break;default:this.__window.console.error("MultiCartUpsellDialog::getCategories - Unknown product",this.__upsellProduct,". Setting default to credits."),this.__upsellProduct="credits",a=["credits"],d="next"}return{categories:a,storeType:d}},__setDialogText:function(a){this.__subtitle=this.__isCreatorLanding||this.__customDlg_name?this.__customSubtitle:this.__globalStringManager.get(a.subtitle_key);this.__description=this.__isCreatorLanding?this.__customDescription:this.__globalStringManager.get(a.desc_key)},__getPackageMapOverrides:function(){this.__dlgName=this.__model.node.attributes.dlg_name;this.$(".dialog-container").addClass(this.__dlgName);this.__customDlg_name&&(this.__dlgName=this.__customDlg_name);var a=this.__packageMap[this.__dlgName];a?(this.__setDialogText(a),this.__isLoggedIn?"host_subscription"===this.__upsellProduct&&(this.__description='<p class="description">'+this.__globalStringManager.get("host_subscription_upsell_dialog_description")+'</p><ul class="lines"><li class="line1 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line1")+'</li><li class="line2 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line2")+'</li><li class="line3 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line3")+'</li><li class="line4 aLine">'+this.__globalStringManager.get("host_subscription_upsell_dialog_line4")+"</li></ul>"):"host_subscription"===this.__upsellProduct?this.__description+='<div class="spacer"></div><div class="spacer"></div>'+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_prompt")+'<br><div class="spacer"></div><ul><li>'+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_line1")+"</li><li>"+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_line2")+"</li><li>"+this.__globalStringManager.get("host_subscription_upsell_dialog_extension_line3")+"</li></ul>":"vip"===this.__upsellProduct&&(this.__description+='<div class="spacer"></div><div class="spacer"></div>'+this.__globalStringManager.get("vip_upsell_dialog_extension_prompt")+'<br><div class="spacer"></div><ul><li>'+this.__globalStringManager.get("vip_upsell_dialog_extension_line1")+"</li><li>"+this.__globalStringManager.get("vip_upsell_dialog_extension_line2")+"</li><li>"+this.__globalStringManager.get("vip_upsell_dialog_extension_line3")+"</li></ul>"),a.dlg_title&&(this.title=this.__isCreatorLanding?this.__globalStringManager.get("buyupgrade_creator_title"):this.__globalStringManager.get(a.dlg_title))):(this.__subtitle=this.__globalStringManager.get("UPGRADE_CREDITS_TITLE"),this.__description=this.__globalStringManager.get("UPGRADE_CREDITS_DESC"))},_testGetCart:function(){return this.__singleItemCart},_testGetErrorString:function(){return this.__getErrorString()},_testGetDeterminedAfterAction:function(){return this.__determineAfterAction()}})}({Dialogs:m["@Dialogs"],Model:m["@Model"],UiCore:m["@UiCore"],CartCollection:Ba,MultiCartCheckout:Ya,MultiCartList:N,MultiProductList:Aa,multiProductUpsellVipTiers:E,template:ka}),$a=function(k){return{NAG_WINDOW_THRESHOLD:864e6,GOLD_BAR_THRESHOLD:864e6,NEW_USER_GOLD_BAR_THRESHOLD:1,NEW_USER_NAG_WINDOW_THRESHOLD:1,CP:{flags:{EVER_OPTED_IN:"next.notifications.has_ever_opted_in",FRIEND_REQUESTS:"next.notifications.friend_requests",NEW_CHAT_INVITE_FRIENDS:"next.notifications.new_chat_invites_from_friends",NEW_CHAT_INVITE_ALL:"next.notifications.new_chat_invites_from_anyone",NEW_MESSAGES:"next.notifications.new_messages",NEW_FEED_COMMENTS:"next.notifications.new_feed_comments",NEW_FEED_LIKES:"next.notifications.new_feed_likes",NEW_VCOIN_GIFTS:"next.notifications.new_vcoin_gift_received",NEW_CREDIT_GIFTS:"next.notifications.new_credit_gift_received",NEW_PRODUCT_GIFTS:"next.notifications.new_product_gift_received",NEW_PAYME:"next.notifications.new_payme_received",DAILY_SPIN:"next.notifications.daily_spin",EARNED_CREDITS:"next.notifications.earned_credits",SCHEDULED_EVENTS:"next.notifications.scheduled_events"},TIMESTAMP_SAW_GOLD_BAR:"next.notifications.timestamp_saw_gold_bar",TIMESTAMP_DISMISSED_NAG_WINDOW:"next.notifications.timestamp_dismissed_nag_window",CUSTOMIZED_NAG_WINDOW_THRESHOLD:"next.notifications.customized_nag_window_threshold"},SD_DAYS_SINCE_REGISTRATION:"daysSinceRegistration",saveTimestamp:function(b,a){var d=(new Date).toISOString();b.set(a,d)},saveTimestampSawGoldBar:function(b){this.saveTimestamp(b,this.CP.TIMESTAMP_SAW_GOLD_BAR)},saveTimestampDismissedNagWindow:function(b){this.saveTimestamp(b,this.CP.TIMESTAMP_DISMISSED_NAG_WINDOW)},isoTimestampToMilliseconds:function(b){return+new Date(b)},getTimestampSawGoldBar:function(b){return this.isoTimestampToMilliseconds(b.get(this.CP.TIMESTAMP_SAW_GOLD_BAR))},getTimestampDismissedNagWindow:function(b){return this.isoTimestampToMilliseconds(b.get(this.CP.TIMESTAMP_DISMISSED_NAG_WINDOW))},getDaysSinceRegistration:function(b){return b.get(this.SD_DAYS_SINCE_REGISTRATION)},optIn:function(b){for(var a=$jscomp.makeIterator(_.values(this.CP.flags)),d=a.next();!d.done;d=a.next())b.setBool(d.value,!0)},validatePrefName:function(b){if(!_.values(this.CP.flags).includes(b)){var a=_.values(this.CP.flags).join(", ");throw Error("unrecognized pref name: "+IMVU.repr(b)+". valid prefs are: "+a)}},setBool:function(b,a,d){if("boolean"!==typeof d)throw Error("setBool value must be a boolean. got "+typeof d+": "+IMVU.repr(d));this.validatePrefName(a);window.console.log("Set DARN pref",a,d);b.setBool(a,d)},getBool:function(b,a){this.validatePrefName(a);b=b.getBool(a);window.console.log("Get DARN pref",a,b);return b},getInt:function(b,a){return b.getInt(a)},isTimeToShowGoldBar:function(b){var a=b.timestampDismissedNagWindow,d=b.timestampSawGoldBar,e=b.timestampNow;return b.hasEverOptedIn||a&&e-a<this.NAG_WINDOW_THRESHOLD||d&&e-d<this.GOLD_BAR_THRESHOLD?!1:b.daysSinceRegistration>=this.NEW_USER_GOLD_BAR_THRESHOLD},isTimeToShowNagWindow:function(b){var a=b.timestampDismissedNagWindow,d=b.timestampNow,e=b.customizedNagWindowThreshold;return b.hasEverOptedIn||a&&d-a<(864e5*e||this.NAG_WINDOW_THRESHOLD)?!1:b.daysSinceRegistration>=this.NEW_USER_NAG_WINDOW_THRESHOLD}}}({}),ab=function(k){var b=k.NotificationsHelper,a=k.Dialogs.AlloyModalDialog;return a.extend("OnboardingDiscoverDialog",{uiContextName:"onboarding_discover_dialog",className:"onboarding-discover-dialog dialog-type-B",dependencies:"dialogManager externalWindow globalStringManager iconManager loginManager modeManager onboardingGamificationManager prefsManager securitySettingsManager urlManager".split(" "),trackedEvents:function(){return[{type:"click",selector:".btn",name:"onboarding_discover_dialog_button",handler:this.__handleClick},{type:"click",selector:"[data-task]:not(.is-completed)",name:"onboarding_discover_dialog_button",handler:this.__handleTaskClick},{type:"click",selector:".onboarding-discover-dialog__progress",name:"onboarding_discover_progress",handler:this.__handleProgressClick}]},initialize:function(d){var e=this;a.prototype.initialize.call(this,d);this.title=this.__globalStringManager.get("onboarding_discover_heading");this.__wallet=this.__progressEl=this.__p1ListEl=this.__allListEl=null;this.__myself=this.__loginManager.getCurrentUser();this.__prefsManager.populated().then(function(){return e.__myself.populated().then(function(){e.__wallet=e.track(e.__myself.getSingleEdge("wallet"));e.addToDOM()})})},postRender:function(){var d=this;this.setContent("body",k.template());this.__allListEl=this.el.querySelector(".onboarding-discover-dialog__all-tasks");this.__p1ListEl=this.el.querySelector(".onboarding-discover-dialog__p1-tasks");this.__progressEl=this.el.querySelector(".onboarding-discover-dialog__progress");this.__progressLabel=this.__progressEl.querySelector(".onboarding-discover-dialog__progress-label");this.__onboardingGamificationManager.updateCompletedTasks().then(function(){return d.__updateTaskList()});this.listenTo(this.__onboardingGamificationManager,"task:complete",this.__updateTaskList)},__handleClick:function(){this.hide()},__handleTaskClick:function(d){var e=this,c=function(){return e.__recordEvent("onboarding",{name:"grant_reward",event_type:"account_greeter",cid:e.__myself.get("legacy_cid"),record:!0})},g=function(){return e.__recordEvent("onboarding",{name:"grant_reward",event_type:"shop_free_credits",cid:e.__myself.get("legacy_cid"),record:!0})},f=function(){return e.__recordEvent("onboarding",{name:"grant_reward",event_type:"store_offer",cid:e.__myself.get("legacy_cid"),record:!0})},h=function(){return e.__recordEvent("onboarding",{name:"grant_reward",event_type:"store_survey",cid:e.__myself.get("legacy_cid"),record:!0})},l=function(){return e.__recordEvent("onboarding",{name:"grant_reward",event_type:"store_video",cid:e.__myself.get("legacy_cid"),record:!0})},n=function(){return e.__recordEvent("onboarding",{name:"grant_reward",event_type:"vcoin_visit",cid:e.__myself.get("legacy_cid"),record:!0})};switch(d.target.closest("[data-task]").dataset.task){case"account_2fa":this.hide();this.__handle2faClick();break;case"account_creator":this.__handleCreatorClick();break;case"account_enable_darn":this.hide();this.__handleDarnClick();break;case"account_greeter":this.__onboardingGamificationManager.handleTaskCompletion("account_greeter",c);this.__externalWindow.open("http://im.vu/help727","_blank");break;case"account_verify_email":this.__myself.get("is_email_verified")||(this.hide(),this.__dialogManager.showVerifyEmail());break;case"bridge_download":this.__modeManager.openMode({mode:{id:"download"},submode:{id:"applaunch"}});break;case"chat_decorate":this.__modeManager.openMode({mode:{id:"chat"},submode:{id:"my_rooms"}});break;case"chat_message":this.__modeManager.openMode({mode:{id:"chat"}});break;case"chat_recommends":this.__modeManager.openMode({mode:{id:"chat"},submode:{id:"recommended"}});break;case"chat_visit":this.__modeManager.openMode({mode:{id:"chat"}});break;case"dashboard_complete":this.__modeManager.openMode({mode:{id:"home"}});break;case"dressup_visit":this.__modeManager.openMode({mode:{id:"dressup"}});break;case"shop_free_credits":this.__onboardingGamificationManager.handleTaskCompletion("shop_free_credits",g);this.__modeManager.openMode({mode:{id:"earn_credits"}});break;case"shop_visit":this.__modeManager.openMode({mode:{id:"shop"}});break;case"social_feed":this.__modeManager.openMode({mode:{id:"feed"},submode:{id:"following"}});break;case"social_follow":this.__modeManager.openMode({mode:{id:"friends"},submode:{id:"search"}});break;case"social_friend":this.__modeManager.openMode({mode:{id:"friends"},submode:{id:"search"}});break;case"social_gift":this.__modeManager.openMode({mode:{id:"friends"},submode:{id:"search"}});break;case"store_offer":this.__onboardingGamificationManager.handleTaskCompletion("store_offer",f);this.__modeManager.openMode({mode:{id:"earn_credits"},submode:{id:"offers"}});break;case"store_purchase":this.__modeManager.openMode({mode:{id:"shop"},submode:{id:"featured"}});break;case"store_survey":this.__onboardingGamificationManager.handleTaskCompletion("store_survey",h);this.__modeManager.openMode({mode:{id:"earn_credits"},submode:{id:"surveys"}});break;case"store_upgraded":this.__modeManager.openMode({mode:{id:"store"}});break;case"store_video":this.__onboardingGamificationManager.handleTaskCompletion("store_video",l);this.__modeManager.openMode({mode:{id:"earn_credits"},submode:{id:"videos"}});break;case"vcoin_purchase":this.hide();this.__handleBuyVcoinClick();break;case"vcoin_send":this.hide();this.__handleSendVcoinClick();break;case"vcoin_visit":this.__onboardingGamificationManager.handleTaskCompletion("vcoin_visit",n),this.__externalWindow.open(this.__urlManager.get("vcoin_marketplace"),"_blank")}this.hide()},__handleProgressClick:function(){var d=this.__onboardingGamificationManager.getPhaseOneStep();d&&(this.__modeManager.openMode({mode:{id:d}}),this.hide())},__collateList:function(d){return d.filter(function(e){return 0<=e.order}).sort(function(e,c){return e.order-c.order})},__generateTaskItem:function(d,e,c){d=document.createRange().createContextualFragment('\n                <li class="onboarding-discover-dialog__task'+(e?" is-completed":"")+'">\n                    '+this.__iconManager.iconHtml("icon-checkmark",{hash:{class:"onboarding-discover-dialog__check"}})+'\n                    <a class="onboarding-discover-dialog__task-link" data-task="'+d.name+'">\n                        '+this.__iconManager.iconHtml("icon-onboarding_"+d.name,{hash:{class:"onboarding-discover-dialog__task-icon"}})+'\n                        <span class="onboarding-discover-dialog__task-text">\n                            '+this.__globalStringManager.get("onboarding_discover_"+d.name)+'\n                        </span>\n                        <span class="shine-effect shine-effect--gold"></span>\n                        <span class="shine-effect shine-effect--white"></span>\n                    </a>\n                </li>\n            ');"all"===c?this.__allListEl.appendChild(d):this.__p1ListEl.appendChild(d)},__updateTaskList:function(){var d=this;this.__allListEl.innerHTML="";this.__p1ListEl.innerHTML="";var e=this.__collateList(this.__onboardingGamificationManager.getTasks()),c=this.__onboardingGamificationManager.getCompletedTasks(),g=e.filter(function(p){return!0===p.phase_one}),f=this.__onboardingGamificationManager.getCompletedPhaseOneTasks(),h=f.length/g.length*100;this.el.classList.toggle("is-phase-one",100>h);if(100>h){var l=g.filter(function(p){return!c.includes(p.name)}),n=e.filter(function(p){return!c.includes(p.name)&&!p.phase_one});e=e.filter(function(p){return c.includes(p.name)&&!p.phase_one});l.forEach(function(p){return d.__generateTaskItem(p,!1,"p1")});f.forEach(function(p){return d.__generateTaskItem(p,!0,"p1")});n.forEach(function(p){return d.__generateTaskItem(p,!1,"all")});e.forEach(function(p){return d.__generateTaskItem(p,!0,"all")});this.__progressEl.style.setProperty("--phase-one-percent",100>h?h+"%":"100%");this.__progressLabel.textContent=this.__globalStringManager.get("onboarding_discover_step",{step:f.length,total:g.length})}else g=e.filter(function(p){return!c.includes(p.name)}),e=e.filter(function(p){return c.includes(p.name)}),g.forEach(function(p){return d.__generateTaskItem(p,!1,"all")}),e.forEach(function(p){return d.__generateTaskItem(p,!0,"all")})},__handleSendVcoinClick:function(){this.__wallet.get("verification_required")&&3!==this.__wallet.get("verification_status")?this.__dialogManager.showDialog(k.LinkUpholdDialog,{wallet:this.__wallet}):this.__dialogManager.showGiftingDialog({type:"vcoin",source:this.uiContextName})},__handleBuyVcoinClick:function(){var d=this;this.__wallet.get("verification_required")&&3!==this.__wallet.get("verification_status")?this.__dialogManager.showDialog(k.LinkUpholdDialog,{wallet:this.__wallet}):this.__securitySettingsManager.requireVcoin2FACheck(this.__wallet).then(function(){return d.__dialogManager.showDialog(k.MultiCartUpsellDialog,{upsellProduct:"vcoin",contextual:!0})})},__handleCreatorClick:function(){var d=this;this.__onboardingGamificationManager.handleTaskCompletion("account_creator",function(){return d.__recordEvent("onboarding",{name:"grant_reward",event_type:"account_creator",cid:d.__myself.get("legacy_cid"),record:!0})});this.__featureAccessManager.isCreator()?this.__externalWindow.open("https://create.imvu.com/","_blank"):this.__externalWindow.open("https://www.imvu.com/creatorlanding/explore/","_blank")},__handleDarnClick:function(){var d=this;b.getBool(this.__prefsManager,b.CP.flags.EVER_OPTED_IN)?this.__onboardingGamificationManager.handleTaskCompletion("account_enable_darn",function(){return d.__recordEvent("onboarding",{name:"grant_reward",event_type:"account_enable_darn",cid:d.__myself.get("legacy_cid"),record:!0})}):this.__dialogManager.confirm({title:this.__globalStringManager.get("enable_darn_prompt_title"),html:this.__globalStringManager.get("enable_darn_prompt_text"),yes:this.__globalStringManager.get("enable_darn_prompt_yes"),no:this.__globalStringManager.get("enable_darn_prompt_no")}).finished.then(function(){b.optIn(d.__prefsManager);d.__onboardingGamificationManager.handleTaskCompletion("account_enable_darn",function(){return d.__recordEvent("onboarding",{name:"grant_reward",event_type:"account_enable_darn",cid:d.__myself.get("legacy_cid"),record:!0})})})},__handle2faClick:function(){var d=this;this.__securitySettingsManager.get("2fa_enabled").then(function(e){e["2fa_enabled"]?d.__onboardingGamificationManager.handleTaskCompletion("account_2fa",function(){return d.__recordEvent("onboarding",{name:"grant_reward",event_type:"account_2fa",cid:d.__myself.get("legacy_cid"),record:!0})}):d.__dialogManager.showDialog(k.TwoFactorSetupAlert,{requireSetup:!1}).finished.then(function(){d.__onboardingGamificationManager.handleTaskCompletion("account_2fa",function(){return d.__recordEvent("onboarding",{name:"grant_reward",event_type:"account_2fa",cid:d.__myself.get("legacy_cid"),record:!0})})})})}})}({Dialogs:m["@Dialogs"],Model:m["@Model"],UiCore:m["@UiCore"],LinkUpholdDialog:H,MultiCartUpsellDialog:Za,NotificationsHelper:$a,TwoFactorSetupAlert:x,template:ja}),bb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){return'<div class="shiny-tooltip__content">\n    <div class="shiny-tooltip__shape">\n        <span class="shiny-tooltip__icon"></span>\n        <span class="shiny-tooltip__text"></span>\n    </div>\n</div>\n'},useData:!0})}({}),cb=function(k){var b=k.UiCore.UiContext;return b.extend("ShinyTooltip",{className:"shiny-tooltip",uiContextName:"shiny_tooltip",dependencies:[],trackedEvents:function(){return[]},initialize:function(a){b.prototype.initialize.call(this,a);this.__side=IMVU.optionalProperty(a,"side","left");this.addToDOM()},render:function(){this.$el.html(k.template());this.el.classList.add("shiny-tooltip--"+this.__side+"-side");this.__icon=this.el.querySelector(".shiny-tooltip__icon");this.__text=this.el.querySelector(".shiny-tooltip__text")},setContent:function(a,d){this.__text.innerHTML=a?a:"";if(""!==d){for(;this.__icon.firstChild;)this.__icon.removeChild(this.__icon.firstChild);this.__icon.appendChild(document.createRange().createContextualFragment(d))}else this.__icon.innerHtml=""},showTooltip:function(a){this.el.classList.toggle("is-active",a)}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],template:bb}),A=function(k){var b=k.UiCore.UiContext;return b.extend("OnboardingProgressWidget",{className:"onboarding-progress",uiContextName:"onboarding_progress",dependencies:"dialogManager featureAccessManager globalStringManager iconManager loginManager modeManager onboardingGamificationManager prefsManager".split(" "),trackedEvents:function(){return[{type:"click",selector:".onboarding-progress__button",name:"onboarding_progress_button_click",handler:this.__handleButtonClick},{type:"mouseenter",selector:".onboarding-progress__button",name:"onboarding_progress_button_click",handler:this.__handleMouseEnter},{type:"mouseleave",selector:".onboarding-progress__button",name:"onboarding_progress_button_click",handler:this.__handleMouseLeave},{type:"click",selector:".shiny-tooltip",name:"onboarding_progress_learn_more",handler:this.__handleButtonClick},{type:"click",selector:".shiny-tooltip a",name:"onboarding_progress_learn_more",handler:this.__handleLearnMore}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__phaseOneTasks=[];this.__completedTasks=[];this.__completedPhaseOneTasks=[];this.__button=null;this.__hasTooltip=!1;this.addToDOM()},render:function(){var a=this;this.$el.html(k.template());this.__button=this.el.querySelector(".onboarding-progress__button-text");this.__tooltip=this.createChildContext(k.ShinyTooltip,{$replaceElement:this.$(".onboarding-progress-tooltip-placeholder"),side:"left"});this.__updateState();this.__loginManager.isLoggedIn()&&(this.__myself=this.__loginManager.getCurrentUser(),this.__prefsManager.populated().then(function(){return a.__myself.populated().then(function(){return a.__updateState()})}));this.listenTo(this.__onboardingGamificationManager,"tasks:updated task:complete mode:set",this.__updateState);this.listenTo(this.__modeManager,"mode:change",this.__handleModeChange)},setTooltip:function(a,d){this.__tooltip.setContent(a,d);this.__hasTooltip=""===a?!1:!0;this.el.classList.toggle("has-tooltip",this.__hasTooltip)},__handleModeChange:function(){this.__modeManager.getCurrentMode()&&"home"===this.__modeManager.getCurrentMode().id&&this.__updateState()},__updateState:function(){this.__phaseOneTasks=this.__onboardingGamificationManager.getTasks().filter(function(e){return!0===e.phase_one});this.__completedTasks=this.__onboardingGamificationManager.getCompletedTasks();this.__completedPhaseOneTasks=this.__onboardingGamificationManager.getCompletedPhaseOneTasks();var a=this.__completedPhaseOneTasks.length/this.__phaseOneTasks.length*100;this.__button.innerText=100>a?this.__completedPhaseOneTasks.length+"/"+this.__phaseOneTasks.length+" "+this.__globalStringManager.get("onboarding_rewards"):this.__globalStringManager.get("onboarding_discover_rewards");this.el.classList.toggle("is-phase-one",100>a);this.el.style.setProperty("--phase-one-percent",100<a?"100%":a+"%");this.el.classList.toggle("has-action",this.__loginManager.isLoggedIn());var d=null;this.__modeManager.getCurrentMode()&&(d=this.__modeManager.getCurrentMode().id);if(!["ftux"].includes(d))if(100>a&&"home"===d)this.setTooltip(this.__globalStringManager.get("onboarding_tooltip_learn_more"),this.__iconManager.iconHtml("icon-credits_tooltip")),this.el.classList.add("is-home"),this.__tooltip.showTooltip(!0);else if(100===a)this.setTooltip(this.__globalStringManager.get("onboarding_tooltip_learn_more"),this.__iconManager.iconHtml("icon-credits_tooltip"));else if("ftux"!==d)switch(this.el.classList.remove("is-home"),this.__tooltip.showTooltip(!1),this.__onboardingGamificationManager.getPhaseOneStep()){case"shop":this.setTooltip(this.__globalStringManager.get("onboarding_tooltip_shop"),this.__iconManager.iconHtml("icon-onboarding_shop_tooltip"));break;case"dressup":this.setTooltip(this.__globalStringManager.get("onboarding_tooltip_dressup"),this.__iconManager.iconHtml("icon-onboarding_tooltip_dressup"));break;case"chat":this.setTooltip(this.__globalStringManager.get("onboarding_tooltip_chat"),this.__iconManager.iconHtml("icon-onboarding_tooltip_chat"));break;default:this.setTooltip("","")}},__handleButtonClick:function(){if(this.__loginManager.isLoggedIn()&&"ftux"!==this.__modeManager.getCurrentMode().id){var a=this.__onboardingGamificationManager.getPhaseOneStep();a?this.__modeManager.openMode({mode:{id:a}}):this.__dialogManager.showDialog(k.OnboardingDiscoverDialog)}},__handleLearnMore:function(){this.__dialogManager.showDialog(k.OnboardingDiscoverDialog)},__handleMouseEnter:function(){this.__hasTooltip&&this.__tooltip.showTooltip(!0)},__handleMouseLeave:function(){this.__tooltip.showTooltip(!1)}})}({Dialogs:m["@Dialogs"],UiCore:m["@UiCore"],OnboardingDiscoverDialog:ab,ShinyTooltip:cb,template:ia}),db=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c,g=a.helperMissing;d="\n";if((a=(c=a.icon||b&&b.icon||g,c.call(b,"icon-credits",{name:"icon",hash:{class:"coin-animation__icon"},data:e})))||0===a)d+=a;return d+"\n"},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d='<div class="coin-animation__starburst"></div>\n<div class="coin-animation__sparkles"></div>\n<div class="coin-animation__coin"></div>\n';if((b=a["if"].call(b,b&&b.showIcon,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)d+=b;return d+"\n"},useData:!0})}({}),O=function(k){var b=k.UiCore.UiContext;return b.extend("CoinAnimation",{className:"coin-animation",uiContextName:"coin_animation",dependencies:["featureAccessManager"],trackedEvents:function(){return[]},initialize:function(a){b.prototype.initialize.call(this,a);this.__isAnimating=!1;this.__showIcon=IMVU.optionalProperty(a,"showIcon",!1);this.__coin=null;this.addToDOM()},render:function(){this.$el.html(k.template({showIcon:this.__showIcon}));this.__coin=this.__showIcon?this.$el.find(".coin-animation__icon"):this.$el.find(".coin-animation__coin")},delete:function(){this.__coin.off("animationend");b.prototype.delete.call(this)},animate:function(){var a=this;this.__isAnimating||(this.__isAnimating=!0,this.el.classList.add("is-animating"),this.__coin.on("animationend",function(){a.el.classList.remove("is-animating");a.__isAnimating=!1}))}})}({UiCore:m["@UiCore"],template:db}),eb=function(k){var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;return function(a,d,e){var c=+new Date,g=c+a;(function h(){var l=+new Date;l>g?e():(d(c,l,g),b(h))})()}}({}),fb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;d=this.escapeExpression;return'\n\n\n<div id="DigiCertClickID_cZTnkGZI"></div>\n<script type="text/javascript">\n    var __dcid = __dcid || [];\n    __dcid.push({"cid":"DigiCertClickID_cZTnkGZI","tag":"cZTnkGZI"});\n    (function(){\n        var cid=document.createElement("script");\n        cid.async=true;\n        cid.src="'+d((c=a.extJSUrl||b&&b.extJSUrl,"function"===typeof c?c.call(b,{name:"extJSUrl",hash:{},data:e}):c))+'";\n        var s = document.getElementsByTagName("script");\n        var ls = s[(s.length - 1)];\n        ls.parentNode.insertBefore(cid, ls.nextSibling);\n    }());\n<\/script>\n\n'},3:function(b,a,d,e){var c;d=this.escapeExpression;return'\n\n\n<div id="DigiCertClickID_eL8Uzm3l"></div>\n<script type="text/javascript">\n    var __dcid = __dcid || [];\n    __dcid.push({"cid":"DigiCertClickID_eL8Uzm3l","tag":"eL8Uzm3l"});\n    (function(){\n        var cid=document.createElement("script");\n        cid.async=true;\n        cid.src="'+d((c=a.extJSUrl||b&&b.extJSUrl,"function"===typeof c?c.call(b,{name:"extJSUrl",hash:{},data:e}):c))+'";\n        var s = document.getElementsByTagName("script");\n        var ls = s[(s.length - 1)];\n        ls.parentNode.insertBefore(cid, ls.nextSibling);\n    }());\n<\/script>\n\n'},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d="";if((b=a["if"].call(b,b&&b.isSecure,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e}))||0===b)d+=b;return d+"\n"},useData:!0})}({}),gb=function(k){var b=k.UiCore.UiContext;return b.extend("DigiCertSeals",{className:"digicert-seals",uiContextName:"digicert_seals",dependencies:["globalStartupModel","window"],trackedEvents:function(){return[]},initialize:function(a){b.prototype.initialize.call(this,a);this.__isSecure=a.window.location.hostname.includes("secure");this.__extJSUrl=a.globalStartupModel.get("digiCertURL")||"//seal.digicert.com/seals/cascade/seal.min.js";this.addToDOM()},render:function(){this.$el.html(k.template({isSecure:this.__isSecure,extJSUrl:this.__extJSUrl}))}})}({UiCore:m["@UiCore"],template:fb}),hb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c,g=a.helperMissing;d='\n        <div class="download-widget-icon">';if((a=(c=a.icon||b&&b.icon||g,c.call(b,"icon-windows",{name:"icon",hash:{id:"imvu_windows",class:"bg-logo"},data:e})))||0===a)d+=a;return d+"</div>\n    "},3:function(b,a,d,e){var c,g=a.helperMissing;d='\n        <div class="download-widget-icon">';if((a=(c=a.icon||b&&b.icon||g,c.call(b,"icon-imvu-beta",{name:"icon",hash:{id:"imvu_beta",class:"bg-logo"},data:e})))||0===a)d+=a;return d+"</div>\n    "},5:function(b,a,d,e){return"shimmer-button-bg-gold"},7:function(b,a,d,e){return"is-onboarding"},9:function(b,a,d,e){return'\n        <span class="shine-effect"></span>\n        '},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='<div class="download-widget-container bridge">\n    ',h=a["if"].call(b,b&&b.classicDownload,{name:"if",hash:{},fn:this.program(1,e),inverse:this.program(3,e),data:e});if(h||0===h)f+=h;f+='\n    <div class="download-widget-title">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,b&&b.downloadTitle,{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n    <div class="download-widget-body">';if((h=(c=a.bodyText||b&&b.bodyText,"function"===typeof c?c.call(b,{name:"bodyText",hash:{},data:e}):c))||0===h)f+=h;f+='</div>\n    <a href="'+g((c=a.clientUrl||b&&b.clientUrl,"function"===typeof c?c.call(b,{name:"clientUrl",hash:{},data:e}):c))+'" class="\n        download-widget-client-button\n        windows\n        ';if((h=a.unless.call(b,b&&b.classicDownload,{name:"unless",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===h)f+=h;f+="\n        ";if((h=a["if"].call(b,b&&b.canSeeOnboardingProgress,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n    ">\n        ';if((h=a["if"].call(b,b&&b.canSeeOnboardingProgress,{name:"if",hash:{},fn:this.program(9,e),inverse:this.noop,data:e}))||0===h)f+=h;f+="\n        ";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"download_widget_button_1",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"\n    </a>\n</div>\n"},useData:!0})}({}),ib=function(k){var b=k.UiCore.UiContext;return b.extend("DownloadBridgeWidget",{className:"download",uiContextName:"download",dependencies:"browserInfo globalStartupModel globalStringManager googleAnalytics loginManager onboardingGamificationManager".split(" "),trackedEvents:function(){return[{type:"click",selector:".download-widget-client-button.windows",name:"download_client",handler:"__downloadClient",attributes:function(){return{which:this.__classicDownload?"classic":"client3"}}.bind(this)}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__classicDownload=!0;this.__browserInfo=a.browserInfo;this.__canSeeOnboardingProgress=a.canSeeOnboardingProgress;this.addToDOM()},render:function(){if("mac"===this.__browserInfo.getOS()){this.__downloadTitle="beta";this.__clientUrl=this.__globalStartupModel.get("macClientBetaUrl");var a=this.__globalStringManager.get("download_widget_mac_beta_reqs_1");this.__classicDownload=!1}else this.__canSeeOnboardingProgress?(this.__downloadTitle="windowsBeta",this.__clientUrl=this.__globalStartupModel.get("windowsClientBetaUrl"),this.__classicDownload=!1):(this.__downloadTitle="windows",this.__clientUrl=this.__globalStartupModel.get("windowsClientUrl")),a=this.__globalStringManager.get("download_widget_windows_reqs_1");this.$el.html(k.template({downloadTitle:"download_widget_title_"+this.__downloadTitle,bodyText:a,classicDownload:this.__classicDownload,clientUrl:this.__clientUrl,canSeeOnboardingProgress:this.__canSeeOnboardingProgress}))},__downloadClient:function(a){var d=this;this.__googleAnalytics.recordClick("download_widget","client");this.__canSeeOnboardingProgress&&setTimeout(function(){d.__loginManager.isLoggedIn()&&(d.__myself=d.__loginManager.getCurrentUser(),d.__myself.populated().then(function(){d.__onboardingGamificationManager.handleTaskCompletion("bridge_download",function(){return d.__recordEvent("onboarding",{name:"grant_reward",event_type:"bridge_download",cid:d.__myself.get("legacy_cid"),record:!0})})}))},100);this.trigger("downloadClientClicked")}})}({UiCore:m["@UiCore"],template:hb}),jb=function(k){var b=k.Submode;return b.extend("FtuxBridgeSubmode",{uiContextName:"ftux_bridge_submode",className:"submode submode-ftux-bridge ftux-layout",dependencies:"browserInfo counterHelper featureAccessManager ftuxState globalNav globalStringManager googleAnalytics iconManager leanplum loginManager onboardingGamificationManager perfReportManager startupModel uiEventReporter urlManager webGL window".split(" "),trackedEvents:function(){return[{type:"click",selector:".social-link",name:"social_network_links",handler:$.noop,attributes:function(a){return{which:a.data("social")}}},{type:"click",selector:".privacy-policy a",name:"privacy_policy",handler:$.noop},{type:"click",selector:".security-badges a",name:"security_badges",handler:$.noop,attributes:function(a){return{which:a.data("badge")}}}]},hide:function(){b.prototype.hide.call(this);this.__globalNav.clearText()},initialize:function(a){b.prototype.initialize.call(this,a);this.__formatNumber=k.FormatNumber;this.__globalNav=a.globalNav;this.__window=a.window;this.__urlManager=a.urlManager;this.__unloadHandlerEnabled=!0;this.__browserInfo=a.browserInfo;this.__walletBalance=0;"mac"===this.__browserInfo.getOS()?this.__mainDownloadContainerId="desktop-container":this.__mainDownloadContainerId="classic-container";this.__globalNav.setBridgeOn(!0);this.listenTo(this.__globalNav,"bridgeRedirect",this.__disableUnloadEvent.bind(this));this.__window.addEventListener("beforeunload",this.beforeUnloadHandler.bind(this));this.__googleAnalytics.recordSubModeChange("welcome-download");this.__loginManager=a.loginManager;this.__myself=this.__loginManager.getCurrentUser();this.addToDOM();this.__recordEvent("wasreallyshown",{record:!0});$(this.__window).on("beforeunload",function(){this.__serviceProvider.get("uiEventReporter").flush()}.bind(this))},delete:function(){$(this.__window).off("beforeunload");this.__window.removeEventListener("beforeunload",this.beforeUnloadHandler.bind(this));b.prototype.delete.call(this)},beforeUnloadHandler:function(a){this.__unloadHandlerEnabled?this.__showDefaultBrowserConfirmDialog(a):this.__unloadHandlerEnabled=!0},_getUnloadHandlerEnabled:function(){return this.__unloadHandlerEnabled},__showDefaultBrowserConfirmDialog:function(a){a.preventDefault();a.returnValue=""},render:function(){this.$el.html(k.template({mainDownloadContainerId:this.__mainDownloadContainerId,privacyPolicyUrl:this.__urlManager.get("privacy_policy"),facebookUrl:this.__urlManager.get("imvu_social_facebook"),instagramUrl:this.__urlManager.get("imvu_social_instagram"),twitterUrl:this.__urlManager.get("imvu_social_twitter"),youtubeUrl:this.__urlManager.get("imvu_social_youtube")}));this.__downloadClient=this.createChildContext(k.DownloadBridgeWidget,{$parentElement:this.$("#"+this.__mainDownloadContainerId),canSeeOnboardingProgress:this.__featureAccessManager.canSeeOnboardingGamification()});this.listenTo(this.__downloadClient,"downloadClientClicked",this.__disableUnloadEvent.bind(this));this.__featureAccessManager.canSeeOnboardingGamification()&&(this.__digiCertSeals=this.createChildContext(k.DigiCertSeals,{$parentElement:this.$el.find(".security-badges")}))},_getDownloadClient:function(){return this.__downloadClient},__disableUnloadEvent:function(){this.__unloadHandlerEnabled=!1},show:function(){b.prototype.show.call(this);this.__globalNav.setText(this.__globalStringManager.get("GET IMVU DESKTOP APP"));this.__myself.populated().then(function(){this.__userName=this.__myself.get("username").replace("Guest_","");this.__updateIntro()}.bind(this));this.__startupModel.populated().then(function(a){return a.getSingleEdge("dress_up_ftux").populated()}.bind(this)).then(function(a){var d=a.get(this.__ftuxState.getGender()+"_reg");this.__clothingProductUrl=a.get("dress_up_reg");var e=function(){this.setLoading(!1);this.__show2dAvatar(this.__ftuxState.getGender(),d)}.bind(this);this.__webGL.use3d()&&(this.__ftuxModel=a,this.__show3DScene(this.__ftuxState.getGender()));e();this.__featureAccessManager.canSeeOnboardingGamification()&&(this.__onboardingProgressWidget=this.createChildContext(k.OnboardingProgressWidget,{$parentElement:this.$(".fixed-position-ghost-layout")}),this.__onboardingProgressWidget.setTooltip(this.__globalStringManager.get("onboarding_tooltip_bridge"),this.__iconManager.iconHtml("icon-credits_tooltip")),this.__onboardingProgressWidget.el.classList.add("is-visible"));return this.__serviceProvider.get("rest").get(d)}.bind(this)).catch(function(a){this.__window.console.error(a)}.bind(this));this.__counterHelper.increment("welcome_ftux_bridge")},__updateIntro:function(){this.__wallet=this.track(this.__myself.getSingleEdge("wallet"));this.__wallet.populated().then(function(){var a=this;this.oldCredits=this.__wallet.get("credits");this.oldPromoCredits=this.__wallet.get("promo_credits");this.__walletBalance=this.totalCredits=this.oldCredits+this.oldPromoCredits;if(this.__featureAccessManager.canSeeOnboardingGamification()){this.__coinAnimation=this.createChildContext(k.CoinAnimation,{$replaceElement:this.$(".download-intro-credits-icon"),showIcon:!0});if(0<!this.__walletBalance){var d=this.__onboardingGamificationManager.getFTUXRewards();Object.keys(d).forEach(function(e){a.__onboardingGamificationManager.handleTaskCompletion(e,function(){return a.__recordEvent("onboarding",{name:"grant_reward",event_type:e,cid:a.__myself.get("legacy_cid"),record:!0})})});this.__walletBalance=Object.keys(d).reduce(function(e,c){return e+parseInt(d[c]||0)},0)}this.listenTo(this.__onboardingGamificationManager,"task:complete",function(e){return a.__handleDownloadTask(e)})}this.$(".download-intro-credits-container").removeClass("hidden");this.$(".download-intro-credits").text(this.__formatNumber.addComma(this.__walletBalance))}.bind(this));this.__profileIcon=this.createChildContext(k.WAFWidgets.ProfileIcon,{$replaceElement:this.$(".profile-icon-placeholder"),user:this.__myself,ignoreClicks:!0,useExtraLargeProfile:!0});$(".download-intro .username").text("@"+this.__userName)},__show3DScene:function(a){var d=this.__ftuxState.getAssetUrl();d||(d=this.__ftuxModel.get(a+"_asset_url"));(d=this.__ftuxState.getGenderState().lookUrl)||(d=this.__ftuxModel.get(a+"_reg"));(d=this.__ftuxState.getGenderState().avatarImage)||(d=this.__ftuxModel.get(a+"_image"));this.__parentMode.show3dScene({$parentElement:this.$(".avatar-container"),parentContext:this,genders:[a]}).then(function(e){return e.loadedEverything().then(function(){this.$(".ftux-module").css("right","-75%");$(this.__window).resize();k.rafUtil(610,e.noJQResizeToContainer.bind(e),function(){e.noJQResizeToContainer();this.$(".download-container").css("opacity",1);$(this.__window).resize()}.bind(this))}.bind(this))}.bind(this)).then(this.__on3dLoaded.bind(this)).catch(function(e){this.__window.console.error(e)}.bind(this))},__on3dLoaded:function(){this.setLoading(!1);this.__mediaLoaded()},__show2dAvatar:function(a){this.__parentMode.show2dAvatar({gender:a,$parentElement:this.$(".avatar-container-2d"),parentContext:this,keepLookModel:!0}).then(function(d){this.__2dAvatar=window._avatar=d;this.__mediaLoaded();"rtl"===document.querySelector("html").getAttribute("dir")?this.$(".avatar-container-2d").css("right","35%"):this.$(".avatar-container-2d").css("left","35%");this.$(".download-container").css("opacity",1)}.bind(this)).catch(function(d){this.__window.console.error(d)}.bind(this))},__mediaLoaded:function(){this.__loadedMedias++;0<this.__totalMedias&&this.__loadedMedias===this.__totalMedias&&this.__onFinishedLoading()},__onFinishedLoading:function(){var a=this.uiContextName+"_"+(this.__webGL.use3d()?"3d":"2d")+"_load_time",d=(this.__timer.getTime()-this.__initTime)/1e3;this.__recordEvent(a,{time:d,record:!0});this.__uiEventReporter.flush()},setLoading:function(a){this.$(".ftux-body").toggleClass("loading",a)},__handleDownloadTask:function(a){if("bridge_download"===a.task){var d=this.__walletBalance;this.__countUp(d,d+a.response.predits);this.__coinAnimation.animate()}},__countUp:function(a,d){var e=this,c=a+1;a=c>=d?d:c;this.el.querySelector(".download-intro-credits").textContent=a;this.__window.requestAnimationFrame(function(){e.el.querySelector(".download-intro-credits").textContent=d;e.__countUp(a,d)})},_testTriggerDownload:function(){this.__downloadClient.trigger("downloadClientClicked")}})}({UiCore:m["@UiCore"],WAFWidgets:m["@WAFWidgets"],CoinAnimation:O,DigiCertSeals:gb,DownloadBridgeWidget:ib,FormatNumber:ea,OnboardingProgressWidget:A,rafUtil:eb,Submode:u,template:da}),kb=function(k){var b=IMVU.NamedModel,a={};return b.extend("LookModelManager",_.extend({dependencies:"featureAccessManager fetchResponseHandler lookModelId modelCache Promise rest window".split(" "),initialize:function(d){this.__serviceProvider=d.serviceProvider;_.each(this.dependencies,function(e){this["__"+e]=d[e]}.bind(this));a[this.__lookModelId]=this;b.prototype.initialize.call(this,{pending_adds:[],pending_removes:[]});this.__changeNum=0;this.__changeToPendingSet={};this.__changeToPendingSet[this.__changeNum]={pending_adds:[],pending_removes:[]};this.__lastShownRequest=this.__requestCount=0;this.__initialRequestSent=this.__populated=!1;this.__outstandingRequests=0},resetLookModelId:function(d){a[d]=this;delete a[this.__lookModelId];this.__lookModelId=d},isSyncing:function(){return 0<this.__outstandingRequests},fetch:function(d){d=d||{};var e=d.add||[],c=d.remove||[];d=d.baseProductList||[];e=_(this.get("pending_adds")).concat(e);var g=_(this.get("pending_removes")).concat(c);_.each([e,g,d],function(h){_.each(h,function(l,n){_.isString(h[n])&&(h[n]=parseInt(h[n].replace(/^(.*\/product[\-\/])*(\d+)$/,"$2"),10))}.bind(this))}.bind(this));e=_.uniq(e);g=_.uniq(g);var f=_.intersection(e,g);c=_(e).difference(f);e=_(g).difference(f);d=this.__buildLookModelUrl(this.__lookModelId,c,e,d);g=++this.__changeNum;this.__changeToPendingSet[g]={pending_adds:c,pending_removes:e,url:d};this.set({pending_adds:c,pending_removes:e});return this.__fetch(d)},__buildLookModelUrl:function(d,e,c,g){var f={};0<e.length&&(f.add=e.join(","));0<c.length&&(f.remove=c.join(","));0<g.length&&(f.base_product_list=g.join(","));return IMVU.URI.build(d,f,{prune:!0})},__fetch:function(d){this.__modelCache.invalidate(d);var e=++this.__requestCount;this.__outstandingRequests++;this.trigger("syncing",this.isSyncing());return this.__rest.get(d).then(function(c){this.__outstandingRequests--;this.trigger("syncing",this.isSyncing());c=c.response.data;e>this.__lastShownRequest&&(this.__lastShownRequest=e,this.__fetchResponseHandler(c),this.__modelCache.invalidate(d),e===this.__requestCount&&this.set({pending_adds:[],pending_removes:[]}));return this.__Promise.resolve()}.bind(this)).catch(function(c){this.__window.console.log(c);this.__outstandingRequests--;this.trigger("syncing",this.isSyncing());return this.__Promise.reject(c)}.bind(this))},post:function(d){this.set({pending_adds:[],pending_removes:[]});var e=++this.__requestCount;this.__outstandingRequests++;this.trigger("syncing",this.isSyncing());this.__featureAccessManager.failLookModelPost()&&(d={look_url:"justfail"});return this.__rest.post(this.__lookModelId,d).then(function(c){this.__outstandingRequests--;this.trigger("syncing",this.isSyncing());c=c.response.data;e>this.__lastShownRequest&&(this.__lastShownRequest=e,this.__fetchResponseHandler(c))}.bind(this)).catch(function(c){this.__window.console.log(c);this.__outstandingRequests--;this.trigger("syncing",this.isSyncing());return this.__Promise.reject(c)}.bind(this))}},Backbone.events),{getManager:function(d){return a[d]}})}({Model:m["@Model"],UiCore:m["@UiCore"]}),P=function(k){var b=IMVU.NamedModel;return b.extend("LookModel",{dependencies:["globalStartupModel","Promise","typeId"],initialize:function(a){this.__serviceProvider=a.serviceProvider;_.each(this.dependencies,function(d){this["__"+d]=a[d]}.bind(this));this.__Promise=a.Promise;this.__globalStartupModel=a.globalStartupModel;this.__typeId=this.parseTypeId(a.typeId);this.__populatedResolver=null;this.__populatedPromise=new this.__Promise(function(d){this.__populatedResolver=d}.bind(this));this.__lookModelBase=this.__globalStartupModel.get("lookModelUrl");this.id=this.__globalStartupModel.get("starterAvatars."+this.__typeId);if(_.isNull(this.id)||_.isUndefined(this.id))this.id=this.__lookModelBase+"/look_model-"+this.__typeId;b.prototype.initialize.call(this,{url:this.id});this.__managerClass=IMVU.optionalProperty(a,"managerClass",k.LookModelManager);this.__manager=this.__serviceProvider.create(this.__managerClass,{lookModelId:this.id,fetchResponseHandler:this.__fetchResponseHandler.bind(this)});this.fetch()},parseTypeId:function(a){return a.split(/\//).pop()},setLookModelId:function(a){this.__typeId=this.parseTypeId(a);this.id=this.__globalStartupModel.get("starterAvatars."+this.__typeId);if(_.isNull(this.id)||_.isUndefined(this.id))this.id=this.__lookModelBase+"/look_model-"+this.__typeId;this.set({url:this.id});this.__manager.resetLookModelId(this.id)},setChatTypeId:function(a,d){a=a.id.split("/").pop();d=d.id.split("/").pop();this.setLookModelId(a+":participants:"+d)},setShopTogetherTypeId:function(a,d){a=a.id.split("/").pop();d=d.id.split("/").pop();a="shop_together-"+a.replace("chat-","");this.setLookModelId(a+":participants:"+d)},populated:function(){return this.__populatedPromise},isSyncing:function(){return this.__manager.isSyncing()},getProducts:function(){return this.get("products")},getGender:function(){var a=this.get("body_pattern_ids");return null===a||void 0===a?null:_.contains(a,80)?"female":_.contains(a,191)?"male":null},getLookUrl:function(){return decodeURIComponent(this.get("look_url"))},getLookPids:function(a){return a?_.map(decodeURIComponent(a.split("/").pop()).split(","),function(d){return parseInt(d,10)}.bind(this)):_.pluck(this.get("products"),"product_id")},getTypeId:function(){return this.__typeId},__fetchResponseHandler:function(a){var d=["look_url","asset_url","avatar_image"];this.__lastResponse=a=_.mapObject(a,function(e,c){return _.isNull(e)||_.isUndefined(e)||!_.contains(d,c)?e:decodeURIComponent(e)}.bind(this));this.set(a)},getChangePromise:function(){return this.__changePromise},fetch:function(a){this.__changeResolver=null;this.__changePromise=new this.__Promise(function(d){this.__changeResolver=d}.bind(this));return this.__manager.fetch(a).then(function(){"accepted"!==this.__populatedPromise.state&&this.__populatedResolver.resolve();this.__changeResolver.resolve(this.__lastResponse);this.trigger("change");return this.__Promise.accept()}.bind(this)).catch(function(d){"accepted"!==this.__populatedPromise.state&&"rejected"!==this.__populatedPromise.state&&this.__populatedResolver.reject(d);this.__changeResolver.reject(d);this.trigger("change");return this.__Promise.reject(d)}.bind(this))},save:function(a){return this.__manager.post(a).then(function(){this.trigger("change");return this.__Promise.accept()}.bind(this)).catch(function(d){window.console.log(d);return this.fetch().then(function(){return this.__Promise.reject(d)}.bind(this)).catch(function(e){return this.__Promise.reject({message:"LookModel failed to refetch after POST failure",originalError:d,newError:e})}.bind(this))}.bind(this))}})}({UiCore:m["@UiCore"],LookModelManager:kb}),Q=function(k){return IMVU.BaseClass.extend("FtuxState",_.extend({dependencies:["localStorage"],initialize:function(b){b=void 0===b?{}:b;this.__localStorage=b.localStorage;this.getState()},saveState:function(b){this.__localStorage.setItem("ftux-state",JSON.stringify(b))},getDefaultState:function(){return{gender:"female",male:{equippedItems:[],products:[],avatarImage:null,lookUrl:null,assetUrl:null},female:{equippedItems:[],products:[],avatarImage:null,lookUrl:null,assetUrl:null}}},getStateString:function(){return JSON.stringify(this.getState(),null,2)},getState:function(){var b=this.__localStorage.getItem("ftux-state");b?b=JSON.parse(b):(b=this.getDefaultState(),this.saveState(b));return b},getGender:function(){return this.getState().gender},getGenderState:function(){var b=this.getState();return b[b.gender]},clearAssets:function(){this.saveState(this.getDefaultState())},updateFromLookModel:function(b){var a=_.extend(this.getState(),{}),d=a[this.getGender()];d.avatarImage=b.get("avatar_image");d.lookUrl=b.get("look_url");d.products=b.get("products");this.saveState(a)},setGender:function(b){b=_.extend(this.getState(),{gender:b});this.saveState(b);this.trigger("setGender")},isNothingEquipped:function(){return 0===this.getEquippedItems().length},createEquippedItemIds:function(b){if(b){var a=_.extend(this.getState(),{});a[this.getGender()].equippedItems=_.pluck(b,"product_id").map(Number);this.saveState(a)}},getEquippedItems:function(){return this.getGenderState().equippedItems},getAssetUrl:function(){return this.getGenderState().assetUrl},setAssetUrl:function(b){var a=_.extend(this.getState(),{});a[this.getGender()].assetUrl=b;this.saveState(a)}},Backbone.Events))}({}),lb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return'\n<nav class="mode-nav bar magic-line-menu disable-text-selection">\n    <div class="center-nav-container">\n        <ul class="center-nav"></ul>\n        <div class="magic-line"></div>\n    </div>\n    <div class="simple-scroller-placeholder"></div>\n    <div class=\'nav-label\'>\n        <span class=\'label\'></span>\n        <div class=\'dismiss\'></div>\n    </div>\n    <ul class="aux-nav"></ul>\n</nav>\n<header></header>\n'},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d="";if((b=a["if"].call(b,b&&b.canSeeHeaderNav,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===b)d+=b;return d+'\n<div class="submodes"></div>\n'},useData:!0})}({}),mb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return" disabled"},3:function(b,a,d,e){var c;d=this.escapeExpression;return'<button class="btn btn-primary">'+d((c=a.text||b&&b.text,"function"===typeof c?c.call(b,{name:"text",hash:{},data:e}):c))+"</button>"},5:function(b,a,d,e){return'<div class="name-widget-goes-here"></div>'},7:function(b,a,d,e){var c;d="<a>";if((a=(c=a.text||b&&b.text,"function"===typeof c?c.call(b,{name:"text",hash:{},data:e}):c))||0===a)d+=a;return d+"</a>"},9:function(b,a,d,e){var c;d=a.helperMissing;return(a=(c=a.icon||b&&b.icon||d,c.call(b,b&&b.svgIcon,{name:"icon",hash:{},data:e})))||0===a?a:""},11:function(b,a,d,e){return'<span class="icon"></span>'},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;d='<li data-nav="'+d((c=a.name||b&&b.name,"function"===typeof c?c.call(b,{name:"name",hash:{},data:e}):c));if((c=a["if"].call(b,b&&b.disabled,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===c)d+=c;d+='">';if((c=a["if"].call(b,b&&b.is_button,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===c)d+=c;if((c=a["if"].call(b,b&&b.is_name_widget,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===c)d+=c;if((c=a["if"].call(b,b&&b.is_text,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===c)d+=c;if((c=a["if"].call(b,b&&b.is_svg_icon,{name:"if",hash:{},fn:this.program(9,e),inverse:this.noop,data:e}))||0===c)d+=c;if((c=a["if"].call(b,b&&b.is_default,{name:"if",hash:{},fn:this.program(11,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"</li>"},useData:!0})}({}),nb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="simple-scroller-viewport"></div>\n<button class="btn btn-tertiary simple-scroller-right flex items-center justify-center" disabled>\n    ',f=(c=a.icon||b&&b.icon||d,c.call(b,"icon-page-right",{name:"icon",hash:{class:"wh-15 block"},data:e}));if(f||0===f)g+=f;g+='\n</button>\n<button class="btn btn-tertiary simple-scroller-left flex items-center justify-center" disabled>\n    ';if((f=(c=a.icon||b&&b.icon||d,c.call(b,"icon-page-left",{name:"icon",hash:{class:"wh-15 block"},data:e})))||0===f)g+=f;return g+"\n</button>"},useData:!0})}({}),R=function(k){var b=0,a=k.UiCore.UiContext;return k.UiCore.UiContext.extend("SimpleScroller",{className:"simple-scroller disable-text-selection",uiContextName:"simple_scroller",keepGoingThreshold:50,dependencies:["$target","timer","window"],initialize:function(d){a.prototype.initialize.call(this,d);this.__instanceNumber=b++;this.__absoluteScrollBy=d.scrollBy||!1;this.__window=d.window;this.__autoRefresh=!!d.autoRefresh;this.__timer=d.timer;this.__scrollEntireWidth=d.scrollEntireWidth;this.__responsiveTiles=d.responsiveTiles;this.__extraTileHeight=d.extraTileHeight||0;this.__$target=d.$target;this.__$target.parent(".simple-scroller-viewport").length||(this.template=d.template||k.template,this.addToDOM(),this._refreshScrollabilityCount=0,this.$(".simple-scroller-viewport").on("scroll.simple-scroller",this.refreshScrollability.bind(this)),this.$(".simple-scroller-left").on("click",this.scrollLeft.bind(this)),this.$(".simple-scroller-right").on("click",this.scrollRight.bind(this)),$(this.__window).on(this.__getEventNamespaceForThisInstance("resize"),this.refreshScrollability.bind(this)))},__getEventNamespaceForThisInstance:function(d){return d+".ss-"+this.__instanceNumber},delete:function(){$(this.__window).off(this.__getEventNamespaceForThisInstance("resize"));this.$(".simple-scroller-viewport").off(".simple-scroller");this.__refreshTimer&&this.__timer.clearInterval(this.__refreshTimer);a.prototype.delete.call(this)},render:function(){this.$el.html(this.template);this.$(".simple-scroller-viewport").append(this.__$target);this.__$target.addClass("simple-scroller-target");this.refreshScrollability();this.__autoRefresh&&(this.__refreshTimer=this.__timer.setInterval(function(){this.$el.is(":visible")&&this.refreshScrollability()}.bind(this),300));this.__setAsRendered()},viewportWidth:function(){return this.$(".simple-scroller-viewport").outerWidth()},leftEdge:function(){return this.$(".simple-scroller-viewport").scrollLeft()},rightEdge:function(){return this.scrollWidth()-this.viewportWidth()-1},scrollWidth:function(){return this.$(".simple-scroller-viewport")[0].scrollWidth},scrollBy:function(){return this.__absoluteScrollBy||this.viewportWidth()/2},scrollByEntireWidth:function(){return this.__absoluteScrollBy||this.viewportWidth()},resizeResponsiveTiles:function(){var d=this.viewportWidth(),e="."+this.__$target[0].firstChild.className;this.$(e).css("width",d);d=this.$(e);for(e=0;e<d.length;e++)if(d[e].offsetLeft===this.$(".simple-scroller-viewport")[0].scrollLeft){var c=d[e].firstChild.offsetHeight;break}c&&this.$(".simple-scroller-viewport").css("height",c+this.__extraTileHeight)},refreshLeftScrollability:function(){this.$(".simple-scroller-left").prop("disabled",0>=this.leftEdge())},refreshRightScrollability:function(){this.$(".simple-scroller-right").prop("disabled",this.leftEdge()>=this.rightEdge())},refreshScrollability:function(){this.__responsiveTiles&&this.resizeResponsiveTiles();this._refreshScrollabilityCount++;this.refreshLeftScrollability();this.refreshRightScrollability()},scroll:function(d){this.$(".simple-scroller-viewport").animate({scrollLeft:"+="+d},150,this.refreshScrollability.bind(this))},scrollLeft:function(d){d=this.scrollBy();this.__scrollEntireWidth&&(d=this.scrollByEntireWidth());this.leftEdge()-d<this.keepGoingThreshold&&(d*=2);this.scroll(-d)},scrollRight:function(d){d=this.scrollBy();this.__scrollEntireWidth&&(d=this.scrollByEntireWidth());this.leftEdge()+d>this.rightEdge()-this.keepGoingThreshold&&(d*=2);this.scroll(d)},resetPosition:function(){this.$(".simple-scroller-viewport").scrollLeft(0);this.refreshScrollability()}})}({UiCore:m["@UiCore"],template:nb}),ob=function(k){function b(d,e){var c=d.get("bootstrapParams").is_app;d.get("window").open(e,c?"_system":"_blank")}function a(d){return-1!==d.indexOf("iPad")||-1!==d.indexOf("iPhone")||-1!==d.indexOf("iPod")}return{openExternal:b,externalizeA:function(d,e){e=$(e);var c=e.attr("href");e.attr("href","");e.click(function(){b(d,c);return!1})},isAndroid:function(d){return-1!==d.get("window").navigator.userAgent.indexOf("Android")},isAndroidChrome:function(d){d=d.get("window").navigator.userAgent;return-1!==d.indexOf("Android")&&-1!==d.indexOf("Chrome/")&&-1===d.indexOf("Version/")},isAndroidWebApp:function(d){d=d.get("window");return-1!==d.navigator.userAgent.indexOf("Android")&&d.navigator.standalone?!0:!1},isIOS:function(d){d=d.get("window").navigator.userAgent;return a(d)},isIOSSafari:function(d){d=d.get("window").navigator.userAgent;return a(d)&&-1===d.indexOf("CriOS/")?-1!==d.indexOf("Safari/")?!0:-1!==d.indexOf("AppleWebKit/")&&-1===d.indexOf("Chrome/"):!1},getVersionIOS:function(d){d=d.get("window").navigator.userAgent;return a(d)?(d=/(iphone|ipad)(; CPU)? OS ((\d+)_(\d+)(_(\d+))?)/i.exec(d),null===d?null:{raw:d[3],major:parseInt(d[4],10),minor:parseInt(d[5],10),revision:d[7]?parseInt(d[7],10):null}):null}}}({}),pb=function(k){var b=k.UiCore.UiContext;return b.extend("Mode",{uiContextName:"generic_mode",className:"mode",navId:null,submodes:{},dependencies:"appMonitor dialogManager featureAccessManager globalNav globalStringManager googleAnalytics historyManager id loginManager perfReportManager platform restCacheManager restModelFactory root siteRoot stringManager timer window".split(" "),__recordShown:!0,trackedEvents:function(){var a=function(d){return{which:d.attr("data-nav")}};return[{type:"click",selector:".mode-nav .center-nav > li",name:"mode_nav",handler:"__onClickNavButton",allowBubble:!0,attributes:a},{type:"click",selector:".mode-nav .aux-nav > li",name:"aux_nav",handler:"__onClickNavButton",allowBubble:!0,attributes:a},{type:"click",selector:".right-column .back-bar .icon",name:"collapse_right_column",handler:function(){this.toggleRightColumn(!0)}.bind(this)},{type:"click",selector:".left-column .back-bar .icon",name:"collapse_left_column",handler:function(){this.toggleLeftColumn()}.bind(this)},{type:"click",selector:".mode-nav .nav-label .dismiss",name:"dismiss_nav_label",handler:"__dismissNavLabel"}]},mainNav:function(){var a=this;return this.__vcoinPay?this.__serviceProvider.create(IMVU.NamedModel,{buttons:[{name:"VCOINPay",text:this.__paymeNavText,handler:function(){a.__window.location.reload()}}]}):null},auxNav:function(){return null},navLabel:function(){return null},initialize:function(a){b.prototype.initialize.call(this,a);this.className+=" mode";this.modeId=a.id;this.__serviceProvider=a.serviceProvider;this.__globalNav=a.globalNav;this.__historyManager=a.historyManager;this.__submodeInstances={};this.__currentSubmode=this.__submodeDefs=null;this.__window=a.window;this.__navHandlers={};this.__currentNavLabelModel=this.__currentAuxNavModel=this.__currentMainNavModel=null;this.__serviceProvider.register("mode",this);this.__stringManager=a.stringManager;this.__platform=a.platform;this.__googleAnalytics=a.googleAnalytics;this.__restModelFactory=a.restModelFactory;this.__submodeIdHistory=[null,null];this.__canSeeHeaderNav=IMVU.optionalProperty(a,"canSeeHeaderNav",!0);this.__myself=(this.__isLoggedIn=this.__loginManager.isLoggedIn())?this.__loginManager.getCurrentUser():null;this.__vcoinPay=!1},render:function(){this.$el.html(k.template({canSeeHeaderNav:this.__canSeeHeaderNav}))},getModeUrl:function(){return this.__siteRoot+this.modeId+"/"},getSubmodeUrl:function(a){return this.getModeUrl()+a+"/"},getTitle:function(){return this.__stringManager.getWithDefault("mode_name","")},updateTitle:function(){var a=this.getTitle();if(this.__currentSubmode){var d=this.__currentSubmode.getTitle();void 0!==d&&(a=d)}this.__serviceProvider.get("modeManager").setTitle(a)},show:function(a){$("html").removeAttr("data-modifier");this.$el.parents("body").find(".loading-facade .loading").remove();a=a||{};b.prototype.show.call(this,a);this.updateTitle();a.submode?this.__submodeInstances[a.submode.id]?this.__showSubmode(this.__submodeInstances[a.submode.id],a.submode):this.openSubmode(a.submode):this.__currentSubmode&&(this.refreshNav(),this.__currentSubmode.show(a),a.poppingHistory||this.__historyManager.setState({fragment:"__default__"===this.__currentSubmodeId?"":this.__urlId(this.__currentSubmodeId),mode:{id:this.modeId},submode:{id:this.__currentSubmodeId,summary:this.__currentSubmode.summarize()}}));this.__serviceProvider.get("globalNav").markActiveMode(this);this.__googleAnalytics.recordModeChange(this.modeId)},hide:function(){this.__currentSubmode&&this.__currentSubmode.hide();b.prototype.hide.call(this)},openDefaultView:function(a){this.openSubmode(_.extend({id:"__default__"},a||{}))},refreshNav:function(){this.$(".mode-nav .magic-line").hide();this.__globalNav.setVisibility(!0);this.collapseLeftAndRightColumns();if(this.__currentSubmode){var a=this.__currentSubmode.overrideMainNav?this.__currentSubmode.overrideMainNav():this.mainNav();this.__setupModeNav(a,this.__currentSubmode.overrideAuxNav?this.__currentSubmode.overrideAuxNav():this.auxNav(),this.__currentSubmode.overrideNavLabel?this.__currentSubmode.overrideNavLabel():this.navLabel());this.__globalNav.drillDown(!!this.__currentSubmode.drillDownFrom)}},markActiveNav:function(a){("all"===a||a&&-1!==a.indexOf("user-"))&&"inventory"!==this.modeId&&(a="featured");var d=this.$('.mode-nav li[data-nav="'+a+'"]');if("shop"===this.modeId||"inventory"===this.modeId)d=this.$('.mode-nav .product-navigation-main li[data-nav="'+a+'"]');d.length&&("shop"===this.modeId||"inventory"==this.modeId?(this.$(".mode-nav .product-navigation-main li.active").removeClass("active"),d.parents("li.has-children").length?(d.parents("li.has-children").addClass("active"),this.$(".mode-nav .magic-line").show().css({"margin-left":d.parents("li.has-children.nav-level-1").position().left+"px",width:d.parents("li.has-children.nav-level-1").outerWidth()}),d.parents("li.has-children.nav-level-1")[0].scrollIntoView(!1)):(d.addClass("active"),this.$(".mode-nav .magic-line").show().css({"margin-left":d.position().left+"px",width:d.outerWidth()}),d[0].scrollIntoView(!1))):(this.$(".mode-nav li.active").removeClass("active"),d.addClass("active"),this.$(".mode-nav .magic-line").show().css({"margin-left":d.find("a").position().left+"px",width:d.find("a").outerWidth()}),d[0].scrollIntoView(!1)))},refreshMagicLine:function(){var a=this.$(".mode-nav li.active");a.length&&this.$(".mode-nav .magic-line").show().css({"margin-left":a.find("a").position().left+"px",width:a.find("a").outerWidth()})},markActiveAuxNav:function(a){k.NextUtil.DomHelper.radioClass(this.$('.aux-nav li[data-nav="'+a+'"]'),"active")},getActiveAuxNav:function(){return this.$(".aux-nav [data-nav].active")},getCurrentSubmode:function(){return this.__currentSubmode},getPreviousSubmodeId:function(){if(this.__currentSubmode){var a=this.__currentSubmode.id;for("true"===localStorage.getItem("forceProduction")&&(a=a.replace("localhost.",""));this.__submodeIdHistory&&0<this.__submodeIdHistory.length&&a===this.__submodeIdHistory[0];)this.__submodeIdHistory.shift()}return this.__submodeIdHistory[0]},__handleUserDoesNotExist:function(){this.__dialogManager.showUserDoesNotExistAlert()},openSubmode:function(a){var d=this.__perfReportManager.getTime();this.__restCacheManager.saveFromModelCache();this.__restCacheManager.resetAutoSaveTimer();var e=this.__serviceProvider.get("modeManager");0<e.submodesOpened++&&e.dismissAllDismissibles();a=a||{id:"__default__"};e=a.id||"__default__";a.perfStartTime=d;this.__submodeDefs=this.submodes(e);"true"===localStorage.getItem("forceProduction")&&(e=e.replace("localhost.",""));e=e.trim();this.__submodeIdHistory[1]!==e&&(this.__submodeIdHistory.shift(),this.__submodeIdHistory.push(e));var c=this.__submodeInstances[e];this.__appMonitor.logNav(this.modeId,e);if(!c||c.isDeleted()){d=this.__submodeDefs[e];if("av"!=this.modeId||""!==e&&"__default__"!==e)if(d){var g="function"===typeof d[1]?d[1](e):d[1];c=this.createChildContext(d[0],_.extend({$parentElement:this.$(".submodes")},g,a))}else if(this.__submodeDefs.__id__&&-1!==e.indexOf("/"))d=this.__submodeDefs.__id__,g="function"===typeof d[1]?d[1](e):d[1],c=this.createChildContext(d[0],_.extend({$parentElement:this.$(".submodes"),model:this.__restModelFactory.readModel(e,d[0].CustomModelClass||k.UiCore.NodeModel)},g,a));else if("av"==this.modeId&&this.__submodeDefs.__id__&&-1==e.indexOf("-")){d=this.__submodeDefs.__id__;g="function"===typeof d[1]?d[1](e):d[1];var f=this.__restModelFactory.searchCollection("https://api.imvu.com/user",{username:e},k.UiCore.NodeCollection);try{c=this.createChildContext(d[0],_.extend({$parentElement:this.$(".submodes"),userCollection:f,model:null},g,a))}catch(h){a="Failed to open av mode with unknown user name ("+e+")";e=["MODE ID",this.modeId,"CURRENT SUBMODE",this.getCurrentSubmodeId(),"SUBMODE ID",e];this.__appMonitor.reportCustomError("Mode","openSubmode","web_perm_0001b",a,e);this.__handleUserDoesNotExist();return}}else if("vcoin"==this.modeId&&this.__submodeDefs.withdrawTicket&&-1!==e.indexOf("withdraw_ticket-"))d=this.__submodeDefs.withdrawTicket,g="function"===typeof d[1]?d[1](e):d[1],c=e.split("-")[1],c=this.createChildContext(d[0],_.extend({$parentElement:this.$(".submodes"),ticketId:c},g,a));else{if("vcoin"!=this.modeId||!this.__submodeDefs.__id__||-1!==e.indexOf("-")&&-1===e.indexOf("user-"))return this.__submodeDefs.__default__?this.openSubmode():this.openDefaultView();this.__vcoinPay=!0;this.__paymeNavText="vcoin.me/"+e;a.__canSeeHeaderNav=this.__canSeeHeaderNav;a.__canSeeVcoinPay=this.__featureAccessManager.canSeeVcoinPay();d=this.__submodeDefs.__id__;f=this.__restModelFactory.searchCollection(this.__root+"/user",{username:e},k.UiCore.NodeCollection);if(this.__featureAccessManager.canSeeVcoinPay())try{c=this.createChildContext(d[0],_.extend({$parentElement:this.$(".submodes"),userCollection:f,model:null},g,a))}catch(h){a="Failed to open vcoin mode with unknown user name ("+e+")";e=["MODE ID",this.modeId,"CURRENT SUBMODE",this.getCurrentSubmodeId(),"SUBMODE ID",e];this.__appMonitor.reportCustomError("Mode","openSubmode","desktop_perm_0002",a,e);this.__handleUserDoesNotExist();return}else this.__window.location="/home"}else{e=["MODE ID",this.modeId,"CURRENT SUBMODE",this.getCurrentSubmodeId(),"SUBMODE ID",e];this.__appMonitor.reportCustomError("Mode","openSubmode","web_perm_0001a","Failed to open av mode with no user name (submode ID)",e);this.__handleUserDoesNotExist();return}this.__submodeInstances[e]=c}return this.__currentSubmode===c?(a.showAlways&&this.__currentSubmode.show(a),c):this.__showSubmode(c,a)},updateSubmodeId:function(a,d){if(this.__submodeInstances[a]){this.__submodeInstances[d]=this.__submodeInstances[a];delete this.__submodeInstances[a];var e=this.__submodeIdHistory.indexOf(a);-1!==e&&(this.__submodeIdHistory[e]=d);this.__currentSubmodeId===a&&(this.__currentSubmodeId=d)}},getCurrentSubmodeId:function(){return"featured"===this.__submodeIdHistory[0]?"featured":this.__currentSubmodeId},isCurrentSubmode:function(a){return this.__currentSubmode===this.__submodeInstances[a]&&this.__currentSubmode},__showSubmode:function(a,d){this.__currentSubmode&&(this.__currentSubmode.hide(),this.__currentSubmode.stopListening(this.__currentSubmode,"change:title"));this.__currentSubmode=a;this.__currentSubmodeId=d.id;this.listenTo(this.__currentSubmode,"change:title",this.updateTitle.bind(this));this.__canSeeHeaderNav&&this.refreshNav();this.setLayout(a.layout);this.__currentSubmode.show(d);d.poppingHistory||this.__historyManager.setState({fragment:"__default__"===this.__currentSubmodeId?"":this.__urlId(this.__currentSubmodeId),mode:{id:this.modeId},submode:{id:this.__currentSubmodeId,summary:a.summarize()}});this.__globalNav.revealSubmodeSpecificItems();return this.__currentSubmode},setLayout:function(a){this.$el.attr("data-layout",a)},__doNothing:function(){},addOnboardingProgressButton:function(a){a=void 0===a?!1:a;this.__featureAccessManager.canSeeOnboardingGamification()&&"mobile"!==this.__platform&&!["ui","policyhub","confirmemail","vcoin"].includes(this.modeId)&&(0===this.$(".mode-nav ul.aux-nav").find(".onboarding-progress").length&&(this.__onboardingProgressWidget=this.createChildContext(k.OnboardingProgressWidget,{$parentElement:this.$(".mode-nav ul.aux-nav")})),a||!this.__currentSubmodeId.includes("room/room")&&"chat_now"!==this.__currentSubmodeId?(this.__onboardingProgressWidget.el.classList.remove("hidden"),this.__onboardingProgressWidget.el.classList.add("is-visible")):(this.__onboardingProgressWidget.el.classList.add("hidden"),this.__onboardingProgressWidget.el.classList.remove("is-visible")))},__buildNav:function(a,d){d.parent(".center-nav-container").removeClass("has-subnav-with-title");d.empty();this.addOnboardingProgressButton();a.get("buttons")?_.each(a.get("buttons"),function(e,c){var g="button"===e.type;c=!1===g&&"undefined"!==typeof e.nameNode;var f=!1===g&&!1===c&&"string"===typeof e.text&&""!==e.text,h=!1===g&&!1===c&&!1===f&&"undefined"!==typeof e.svgIcon;g=_.extend({is_button:g,is_name_widget:c,is_text:f,is_svg_icon:h,is_default:!1===g&&!1===c&&!1===f&&!1===h},e);d.append(k.templateModeNavItem(g));c&&(this.__displayName=this.createChildContext(k.WAFWidgets.DisplayName,{$replaceElement:this.$(".name-widget-goes-here"),user:e.nameNode,size:"small",color:"dark",showVipBadge:!1}));this.__vcoinPay&&(d.append('<span class="payme-nav-tooltip icon icon-tooltip-icon"></span>'),d.append('<div class="vcoin-payme-nav-tooltip">'+this.__globalStringManager.get("vcoin_payme_nav_tooltip")+"</div>"),this.createChildContext(k.Tooltip,{$replaceElement:this.$(".vcoin-payme-nav-tooltip"),$tooltipTarget:this.$(".payme-nav-tooltip"),title:""}));this.__navHandlers[e.name]={cb:e.handler,arg:e.args}}.bind(this)):a.get("text")&&(d.parent(".center-nav-container").addClass("has-subnav-with-title"),d.append('<li class="center-nav-text">'+a.get("text")+"</li>"))},__updateNavLabel:function(a,d){d.html(a.get("label")||"");this.$el.toggleClass("has-nav-label",!!a.get("label"))},__setupModeNavMain:function(a,d){var e=a.main;a=a.hasSubMenu;if(e){var c=this.$(".mode-nav ul.center-nav");if(void 0!==e.get("buttons")||a){for(a=this.$(".simple-scroller-placeholder");1<a.length;)a[1].remove(),a=this.$(".simple-scroller-placeholder");e&&void 0!==e.get("buttons")&&(this.modeNavSimpleScroller=this.createChildContext(k.SimpleScroller,_.extend({$replaceElement:this.$(".simple-scroller-placeholder"),$target:this.$(".mode-nav .center-nav-container")})))}this.__buildNav(e,c);this.__currentMainNavModel=e;this.__currentMainNavModel.on("change",function(){this.__buildNav(this.__currentMainNavModel,c)},this);d&&d.accept()}},__setupModeNav:function(a,d,e,c){var g=this,f="shop"===this.modeId||"inventory"===this.modeId;null!==this.__currentMainNavModel&&this.__currentMainNavModel.off(void 0,void 0,this);null!==this.__currentAuxNavModel&&this.__currentAuxNavModel.off(void 0,void 0,this);null!==this.__currentNavLabelModel&&this.__currentNavLabelModel.off(void 0,void 0,this);var h=this.$(".mode-nav ul.aux-nav"),l=this.$(".mode-nav .nav-label .label");this.$el.parent().removeClass("no-subnav");this.__navHandlers={};a&&"function"===typeof a.then?a.then(function(n){g.__setupModeNavMain({main:n,hasSubMenu:f},c)}):this.__setupModeNavMain({main:a,hasSubMenu:f});d&&(this.__buildNav(d,h),this.__currentAuxNavModel=d,this.__currentAuxNavModel.on("change",function(){this.__buildNav(this.__currentAuxNavModel,h)},this));e&&(this.__updateNavLabel(e,l),this.__currentNavLabelModel=e,this.__currentNavLabelModel.on("change",function(){this.__updateNavLabel(e,l)},this));d||a?this.$(".mode-nav").show():(this.$(".mode-nav").hide(),this.$el.parent().addClass("no-subnav"))},__onClickNavButton:function(a){var d=$(a.currentTarget).data("nav"),e=this.__navHandlers[d];e&&e.cb(d,e.args,a)},collapseLeftAndRightColumns:function(){this.$el.removeClass("expand-left-column");this.$el.removeClass("expand-right-column")},isLeftColumnExpanded:function(){return this.$el.hasClass("expand-left-column")},isRightColumnExpanded:function(){return this.$el.hasClass("expand-right-column")},toggleLeftColumn:function(){"mobile"===this.__platform&&(this.$el.toggleClass("expand-left-column"),this.__globalNav.setVisibility(!this.isLeftColumnExpanded()))},toggleRightColumn:function(){"mobile"===this.__platform&&(this.$el.toggleClass("expand-right-column"),this.__globalNav.setVisibility(!this.isRightColumnExpanded()))},__leftColumnToggleButton:function(){return{name:"toggle_left_column",svgIcon:"icon-filter",handler:this.toggleLeftColumn.bind(this)}},__dismissNavLabel:function(){this.__currentNavLabelModel.set({label:""});this.__currentNavLabelModel.trigger("dismissed")},_getSubmodeById:function(a){return this.__submodeInstances[a]}})}({NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],WAFWidgets:m["@WAFWidgets"],MobileBrowser:ob,OnboardingProgressWidget:A,SimpleScroller:R,Tooltip:r,template:lb,templateModeNavItem:mb}),qb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="copy-body">\n    ',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_adult_dialog_body_1",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='\n    <a href="https://secure.imvu.com/next/policyhub/gdprconsent/" class="tooltip-target">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_adult_dialog_body_2",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</a>\n    ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_adult_dialog_body_3",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='\n    <a href="https://secure.imvu.com/next/policyhub/privacypolicy/" target="_blank">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_adult_dialog_body_4",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="</a>\n    ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_adult_dialog_body_5",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n    <br>\n    ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_adult_dialog_body_6",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='\n\n    <div class="accept-button">\n        <button class="btn btn-primary accept-cookies">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"accept all cookies",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+'</button>\n    </div> \n</div>\n\n\n<div class="tooltip-content cookie-tooltip">\n    <div class="tooltip-body">\n        To give you the best possible experience,personalize content and ads, this site usesCookies. Continuing to use the site you agree we may place thesecookieson your device. You can view our Privacy Policy for more details.\n\n        <div class="tooltip-header">Strictly Necessary Cookies:</div>\n            <div>These cookies are necessary for the website to function and cannot be switched off in our systems. </div>\n            <ul>\n                <li>prefer_alloy - Used to determine if you see IMVU Next or Core.</li>\n                <li>alloy_landing_cookie - Used to determine if you see IMVU Next or Core.</li>\n                <li>in_ux - Assigned to a "unique user" experiment.</li>\n                <li>osCsid - Session cookie; required for login to function.</li>\n            </ul>\n        <div class="tooltip-header">Performance Cookies:</div>\n            <div>These cookies allow us to count visits and traffic sources, so we can measure and improve the performance of our site. They help us know which pages are the most and least popular and see how visitors move around the site.</div>\n            <ul>\n                <li>browser_session - Tracks statistics about your IMVU session.</li>\n                <li>window_session - Tracks statistics about a specific IMVU window.</li>\n                <li>Targeting Cookies</li>\n                <li>These cookies are set through our site by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant ads on other sites. They work by uniquely identifying your browser and device.</li>\n                <li>login_interstitial_seen - tracks the last time you saw an interstitial, for aggregate analytics purposes.</li>\n                <li>sncd - Tracks CIDs you have logged into, for detecting if a new account is an alt.</li>\n                <li>nunu - Tracks if we believe you are a new new user.</li>\n                <li>preLogID - Used to connect incoming users with their subsequent login or registration.</li>\n                <li>imvua - Tracks which acquisition partner you came from.</li>\n                <li>datetime_entered - Tracks when you first landed on our site.</li>\n                <li>linkshare_site_id - If acquired through a specific partner, tracks which ad you followed.</li>\n                <li>lpip - Stores the IP you hit a landing page with.</li>\n            </ul>\n        <div class="tooltip-header">Presentation Cookies:</div>\n            <div>These cookies are set to help enhance your experience and for example, allow us to show you IMVU in the language of your choice.</div>\n            <ul>\n                <li>imvu_avnm - stores your avatarname for display purposes.</li>\n                <li>saved_locale - stores which language you prefer to see IMVU in.</li>\n            </ul>\n        <div class="tooltip-header">Third Party Partners:</div>\n            <div>We also have third party partners who may set cookies including this list below:</div>\n            <ul>\n                <li>Amazon</li>\n                <li>Doubleverify</li>\n                <li>Facebook</li>\n                <li>Google</li>\n                <li>Peanutlabs</li>\n                <li>Revenue Universe</li>\n                <li>AppNexus</li>\n                <li>Google Analytics</li>\n                <li>Threat Metrix</li>\n            </ul>\n    </div>\n</div>'},useData:!0})}({}),S=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("PrivacyPolicyAdultDialog",{uiContextName:"privacy_policy_adult_dialog",className:"privacy-policy-adult-dialog dialog-type-B",dependencies:["cookieManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:".accept-button",name:"submit_privacy_policy_adult_okay",handler:"__onClose"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("privacy_policy_adult_dialog_title");this.isUncancellableDialog=!0;this.addToDOM();this.$(".dialog-x").remove()},postRender:function(){this.setContent("body",k.template,{});this.tooltip=this.createChildContext(k.Tooltip,{$replaceElement:this.$(".tooltip-content"),$tooltipTarget:this.$(".tooltip-target")});this.tooltip.$el.addClass("tooltip-wide")},__onClose:function(a){this.__cookieManager.set("accepted_all_cookies","true");b.prototype.__onClose.call(this,a)}})}({Dialogs:m["@Dialogs"],Tooltip:r,template:qb}),rb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){return"<img class='silhouette' src='/common/withme/img/loading_avatar.png'>"},useData:!0})}({}),sb=function(k){var b=k.UiCore.UiContext;return b.extend("Avatar2d",{uiContextName:"avatar_2d",className:"avatar-2d",dependencies:["dialogManager","globalStringManager","model","timer"],initialize:function(a){b.prototype.initialize.call(this,a);this.__width=IMVU.optionalProperty(a,"width",800);this.__height=IMVU.optionalProperty(a,"height",800);this.__vanishDelay=IMVU.optionalProperty(a,"vanishDelay",800);this.__imageError=IMVU.optionalProperty(a,"imageError","error");this.__imageFactory=IMVU.optionalProperty(a,"imageFactory",function(){return new Image});this.__lookModel=this.__model;this.addToDOM();this.__lookModel.on("syncing",this.__refreshLoading,this);this.__refreshLoading();a.filterModel?(this.__filterModel=a.filterModel,this.listenTo(this.__filterModel,"change:category",this.__updateAvatarImage.bind(this))):a.view&&(this.__view=a.view);this.listenTo(this.__lookModel,"change",this.__updateAvatarImage.bind(this));this.__lookModel.populated().then(this.__updateAvatarImage.bind(this))},getSceneLoadedPromise:function(){return this.__lookModel.populated()},delete:function(){this.__destroyInFlightImage();this.$(".avatar-image").off();this.__timer.clearTimeout(this.__vanishTimer);b.prototype.delete.call(this)},__refreshLoading:function(){this.$el.toggleClass("loading",this.__lookModel.isSyncing()||!!this.__$inFlightImage)},__destroyInFlightImage:function(){this.__$inFlightImage&&(this.__$inFlightImage.off(),this.__$inFlightImage=null)},__vanishCurrentImage:function(){if(this.__$currentImage){var a=this.__$currentImage;a.addClass("vanishing");this.__$currentImage=null;this.__vanishTimer=this.__timer.setTimeout(function(){a.remove()},this.__vanishDelay)}},__maybeFadeIn:function(a){this.$el.is(":visible")&&a.addClass("fade-in")},__onImageLoad:function(){this.__setAsRendered();this.__vanishCurrentImage();this.__$currentImage=this.__$inFlightImage;this.__maybeFadeIn(this.__$inFlightImage);this.$el.addClass("populated").removeClass("error").append(this.__$inFlightImage);this.__$inFlightImage=null;this.__refreshLoading()},__onImageFail:function(){this.__setAsRenderFailed();this.trigger("avatar_load_fail");this.__destroyInFlightImage();this.__recordEvent("avatar_image_load_error",{url:this.__lookModel.get("avatar_image"),record:!0});this.$el.addClass("error");this.__refreshLoading();this.__dialogManager.alert({title:this.__globalStringManager.get("dialog_avatar_error_title"),text:this.__globalStringManager.get("dialog_avatar_error_text"),ok:this.__globalStringManager.get("dialog_avatar_error_button")})},__buildFilterView:function(){var a=this.__filterModel.get("category");return"dressup_front_"+(_.contains("wearing all accessories skins avatars outfits".split(" "),a)?"all":a)},__buildImageSrc:function(){return IMVU.URI.build(this.__lookModel.get("avatar_image"),{width:this.__width,height:this.__height,view:this.__filterModel?this.__buildFilterView():this.__view})},__updateAvatarImage:function(){if(void 0!==this.__lookModel.get("avatar_image")&&null!==this.__lookModel.get("avatar_image")){var a=this.__buildImageSrc();a!==this.__currentImageSrc&&(this.__currentImageSrc=a,this.__destroyInFlightImage(),this.__$inFlightImage=$(this.__imageFactory()),this.__$inFlightImage.attr("src",a).addClass("avatar-image avatar-2d-ie11-fix").on("load",this.__onImageLoad.bind(this)).on(this.__imageError,this.__onImageFail.bind(this)),this.__refreshLoading())}},isRendering:function(){return!0},render:function(){this.$el.html(k.template());this.__maybeFadeIn(this.$(".silhouette"))}})}({UiCore:m["@UiCore"],template:rb}),tb=function(k){var b=k.Avatar2d;return b.extend("FtuxAvatar2d",{uiContextName:"ftux_avatar_2d",className:"avatar-2d ftux-avatar-2d",dependencies:["dialogManager","globalStringManager","Promise","timer"],initialize:function(a){this.__category=a.category||"all";this.__loadedPromise=new a.Promise(function(d){this.__loadedResolver=d}.bind(this));b.prototype.initialize.call(this,a);this.setAttachedToBottom(a.attachedToBottom)},setAttachedToBottom:function(a){this.$el.toggleClass("is-attached-to-bottom",!!a)},setCategory:function(a){this.__category!==a&&(this.__category=a,this.__updateAvatarImage())},getCategory:function(){return this.__category},getLookModel:function(){return this.__lookModel},vanishCurrentImage:function(){if(this.__$currentImage){var a=this.__$currentImage;this.__$currentImage=null;a.addClass("vanishing");this.__vanishTimer=this.__timer.setTimeout(function(){a.remove()},this.__vanishDelay)}},__onImageLoad:function(){b.prototype.__onImageLoad.call(this);"pending"===this.__loadedPromise.state&&this.__loadedResolver.accept(this);this.trigger("loaded")},__buildImageSrc:function(){var a=_.contains(["accessories","skins"],this.__category)?"all":this.__category;a=$.param({width:945,height:945,view:"dressup_front_"+a});return this.__lookModel.get("avatar_image")+"?"+a},loaded:function(){return this.__loadedPromise}})}({UiCore:m["@UiCore"],Avatar2d:sb}),ub=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c,g=a.helperMissing;d='\n                        <button class="btn btn-fb id-fb">';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"continue_with_facebook",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</button>\n                    "},3:function(b,a,d,e){var c;a=this.escapeExpression;return"\n                        <a class='px-5 language language-"+a((c=b&&b.code,"function"===typeof c?c.apply(b):c))+"' data-code='"+a((c=b&&b.code,"function"===typeof c?c.apply(b):c))+"' href=\""+a((c=b&&b.url,"function"===typeof c?c.apply(b):c))+'">'+a((c=b&&b.name,"function"===typeof c?c.apply(b):c))+"</a>\n                        "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='<div class="ftux-body">\n    <div class="bg-container">\n    </div>\n    <div class="ftux-body-overlay">\n        <div class="flex-layout">\n            <div class="flex-cell">\n                ',h=(c=a.icon||b&&b.icon||d,c.call(b,"icon-imvu-logo",{name:"icon",hash:{class:"bg-logo"},data:e}));if(h||0===h)f+=h;f+='\n            </div>\n            <div class="flex-cell">\n                <div class="content">\n                    <p class="id-title">';if((h=(c=a.i18n||b&&b.i18n||d,c.call(b,"welcome_frontpage_title",{name:"i18n",hash:{},data:e})))||0===h)f+=h;f+='</p>\n                    <p class="id-text">';if((h=(c=a.i18n||b&&b.i18n||d,c.call(b,"welcome_frontpage_text",{name:"i18n",hash:{},data:e})))||0===h)f+=h;f+='</p>\n                    <button class="btn btn-primary-dark id-continue">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"get_started_for_free",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</button>\n                        <div class="label label-or">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_or",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n                        <button class="btn btn-primary-dark btn-apple id-apple">Continue with Apple</button>\n                    ';if((h=a["if"].call(b,b&&b.showFBButton,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n                    <ul class="ftux-bottom-nav">\n                        <div class="have-an-account">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_have_an_account",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div> <a class="login">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_login_link",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</a>\n                    </ul>\n                    <div class="label languages">\n                        <a class=\'px-5 language current_language language-'+g((h=(h=b&&b.currentLocale,null==h||!1===h?h:h.code),"function"===typeof h?h.apply(b):h))+"' data-code='"+g((h=b&&b.code,"function"===typeof h?h.apply(b):h))+"' href=\""+g((h=(h=b&&b.currentLocale,null==h||!1===h?h:h.url),"function"===typeof h?h.apply(b):h))+'">'+g((h=(h=b&&b.currentLocale,null==h||!1===h?h:h.name),"function"===typeof h?h.apply(b):h))+"</a>\n                        ";if((h=a.each.call(b,b&&b.otherLocales,{name:"each",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n                        <button class="px-5 btn btn-secondary more-locales right">\n                            <span class="icon">\n                            ';if((h=(c=a.icon||b&&b.icon||d,c.call(b,"icon-action_more",{name:"icon",hash:{},data:e})))||0===h)f+=h;f+='\n                            </span>\n                        </button>\n                    </div>\n                    <nav class="footer">\n                        <ul class="footer-items">\n                            <li><a data-external href="https://about.imvu.com/">';if((h=(c=a.i18n||b&&b.i18n||d,c.call(b,"welcome_frontpage_about",{name:"i18n",hash:{},data:e})))||0===h)f+=h;f+='</a></li>\n                            <li><a data-external href="https://blog.imvu.com/">';if((h=(c=a.i18n||b&&b.i18n||d,c.call(b,"welcome_frontpage_blog",{name:"i18n",hash:{},data:e})))||0===h)f+=h;f+='</a></li>\n                            <li><a data-external href="https://about.imvu.com/careers">';if((h=(c=a.i18n||b&&b.i18n||d,c.call(b,"welcome_frontpage_jobs",{name:"i18n",hash:{},data:e})))||0===h)f+=h;f+='</a></li>\n                            <li><a data-external href="https://www.imvu.com/next/policyhub/">';if((h=(c=a.i18n||b&&b.i18n||d,c.call(b,"welcome_frontpage_policies",{name:"i18n",hash:{},data:e})))||0===h)f+=h;f+='</a></li>\n                            <li><a data-external href="https://help.imvu.com/">';if((h=(c=a.i18n||b&&b.i18n||d,c.call(b,"welcome_frontpage_help",{name:"i18n",hash:{},data:e})))||0===h)f+=h;f+='</a></li>\n                            <li><a data-external href="https://about.imvu.com/contact">';if((h=(c=a.i18n||b&&b.i18n||d,c.call(b,"welcome_frontpage_contact",{name:"i18n",hash:{},data:e})))||0===h)f+=h;f+='</a></li>\n                            <li><a data-external href="https://www.imvu.com/creatorlanding/explore/" class="uppercase-text">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Become Creator",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</a></li>\n                        </ul>\n                        <a class=\'personal-info\' data-external href="https://www.imvu.com/next/policyhub/ccpa/" target="_blank">\n                            ';if((h=(c=a.i18n||b&&b.i18n||d,c.call(b,"welcome_frontpage_personal_info",{name:"i18n",hash:{},data:e})))||0===h)f+=h;f+="\n                        </a>\n                        <a class='opt-out-adchoices' data-external href=\""+g((c=a.adchoicesUrl||b&&b.adchoicesUrl,"function"===typeof c?c.call(b,{name:"adchoicesUrl",hash:{},data:e}):c))+'" target="_blank" rel="noopener noreferrer">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"adchoices",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+'</a>\n                    </nav>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<div class="ftux-avatar-cache"></div>\n'},useData:!0})}({}),T=function(k){var b=k.UiCore.UiContext;return b.extend("ContextMenu",{uiContextName:"context_menu",tagName:"ul",className:"context-menu",trackedEvents:function(){return[{type:"click",selector:"li",name:"context_menu_item",handler:"__chooseMenuItem",attributes:function(a){return{which:a.attr("data-menu-item")}}}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__items=IMVU.requireProperty(a,"items");this.location=IMVU.requireProperty(a,"location");this.mouseMargin=IMVU.optionalProperty(a,"mouseMargin","");this.__showCaret=IMVU.optionalProperty(a,"showCaret",!1);this.__isChatStreamProfileMenu=IMVU.optionalProperty(a,"chatStreamProfile",null);this.__closeOnScroll=void 0!==a.closeOnScroll?a.closeOnScroll:!0;this.addToDOM()},render:function(){_.each(this.__items,function(a){var d=$("<li />");d.attr("data-menu-item",a.name).text(a.text).addClass(a.classNames).toggleClass("divider",!!a.divider);_.has(a,"title")&&_.isString(a.title)&&d.attr("title",a.title);this.$el.append(d)}.bind(this));this.__showCaret&&(this.__isChatStreamProfileMenu?($('<div class="caret"></div>').insertAfter(".context-menu li:first-of-type"),this.$(".caret").css({bottom:82,left:-16})):this.$el.append('<div class="caret"></div>'))},__chooseMenuItem:function(a){var d=$(a.currentTarget).data("menu-item"),e=_.find(this.__items,function(c){return c.name===d}).handler;e&&e.call(this,a);this.trigger("item-chosen")},shouldCloseOnScroll:function(){return!this.__closeOnScroll}})}({UiCore:m["@UiCore"]}),vb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c,g=a.helperMissing;d='\n    <div class="label label-fb">\n        <a class="btn btn-fb id-fb">';if((a=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"continue_with_facebook",{name:"i18n-g",hash:{},data:e})))||0===a)d+=a;return d+"</a>\n    </div>\n"},3:function(b,a,d,e){var c;a=this.escapeExpression;return"\n        <a class='px-5 language language-"+a((c=b&&b.code,"function"===typeof c?c.apply(b):c))+"' data-code='"+a((c=b&&b.code,"function"===typeof c?c.apply(b):c))+"' href=\""+a((c=b&&b.url,"function"===typeof c?c.apply(b):c))+'">'+a((c=b&&b.name,"function"===typeof c?c.apply(b):c))+"</a>\n        "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g=this.escapeExpression,f='<form name="login_form" method="GET" action="#" class="login">\n    <div class="label login_avatarname label-first" data-holder="',h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"welcome_dialog_username_placeholder",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+='">\n        <input type="text" tabindex="1" name="avatarname" placeholder=\'';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"welcome_dialog_username_placeholder",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='\'  autocapitalize="none" autocorrect="off" autocomplete="off" spellcheck="false" value="'+g((c=a.username||b&&b.username,"function"===typeof c?c.call(b,{name:"username",hash:{},data:e}):c))+'" />\n    </div>\n    <div class="label login_password label-second" data-holder="';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"welcome_dialog_password_placeholder",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='">\n        <div style="position:relative">\n            <input tabindex="1" type="password" name="password" placeholder=\'';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"welcome_dialog_password_placeholder",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='\'/>\n            <div class="toggle-password-visibility icon icon-password-show"></div>\n        </div>\n    </div>\n\n    <label class="submit">\n        <div class="error-message-container">\n            <div class="error-message try-again-later">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_try_again_later_error",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message try-again-later-server-load">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_try_again_later_error_server_load",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message client-2fa-not-supported">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_client_2fa_not_supported",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message credentials">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_credentials_error",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message disabled">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_disabled_error",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message unknown">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_unknown_login_error",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message 2fa-email-sent-rate-limit">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_2fa_email_sent_rate_limit",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message wrong-code-rate-limit">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_wrong_code_rate_limit",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n        </div>\n    </label>\n\n    <div class="label label-forgot">\n        <a data-external class="forgot-password-link" href="'+g((c=a.forgotPasswordUrl||b&&b.forgotPasswordUrl,"function"===typeof c?c.call(b,{name:"forgotPasswordUrl",hash:{},data:e}):c))+'">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_forgot_credentials",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</a>\n    </div>\n    <div class="label label-log-in">\n        <button class="btn btn-primary" >';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_signin_button",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</button>\n    </div>\n    <div class="label label-or">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_or",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n        <div class="label label-apple">\n            <a class="btn btn-apple id-apple">Continue with Apple</a>\n        </div>\n';if((h=a["if"].call(b,b&&b.showFBButton,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n\n    <div class="label signup">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"welcome_dialog_no_account",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='&nbsp;<a class="id-signup">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"welcome_dialog_signup",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</a></div>\n    <div class="label need-help">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_need_help",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='<a data-external href="https://help.imvu.com/">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_help_center",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</a></div>\n\n    <div class="label languages flex items-center justify-center">\n        <a class=\'px-5 language current_language language-'+g((h=(h=b&&b.currentLocale,null==h||!1===h?h:h.code),"function"===typeof h?h.apply(b):h))+"' data-code='"+g((h=b&&b.code,"function"===typeof h?h.apply(b):h))+"' href=\""+g((h=(h=b&&b.currentLocale,null==h||!1===h?h:h.url),"function"===typeof h?h.apply(b):h))+'">'+g((h=(h=b&&b.currentLocale,null==h||!1===h?h:h.name),"function"===typeof h?h.apply(b):h))+"</a>\n        ";if((h=a.each.call(b,b&&b.otherLocales,{name:"each",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n        <div class="px-5 inline-block more-locales right text-charcoal cursor-pointer">\n            <div class="w-25 h-18">\n                ';if((h=(c=a.icon||b&&b.icon||d,c.call(b,"icon-action_more",{name:"icon",hash:{class:"wh-full"},data:e})))||0===h)f+=h;f+='\n            </div>\n        </div>\n    </div>\n\n    <p class="app-store-buttons text-spacing">\n        <a data-external href="https://itunes.apple.com/us/app/imvu-mobile/id919745844?mt=8" class="ios-button" target="_blank">\n            ';if((h=(c=a.icon||b&&b.icon||d,c.call(b,"icon-app-store",{name:"icon",hash:{},data:e})))||0===h)f+=h;f+='\n        </a>\n        <a data-external href="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova" class="last android-button" target="_blank">\n            ';if((h=(c=a.icon||b&&b.icon||d,c.call(b,"icon-google-play",{name:"icon",hash:{},data:e})))||0===h)f+=h;f+='\n        </a>\n    </p>\n\n    <p class="privacy-agreements">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_privacy_agreements_description",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='<a target="_blank" href="'+g((c=a.policyHubUrl||b&&b.policyHubUrl,"function"===typeof c?c.call(b,{name:"policyHubUrl",hash:{},data:e}):c))+'">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_terms_of_conditions",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</a><a target="_blank" href="'+g((c=a.arbitrationAgreementUrl||b&&b.arbitrationAgreementUrl,"function"===typeof c?c.call(b,{name:"arbitrationAgreementUrl",hash:{},data:e}):c))+'">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_arbitration_agreement",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</a>";if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login__dialog_privacy_agreements_and",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='<a target="_blank" href="'+g((c=a.privacyPolicyUrl||b&&b.privacyPolicyUrl,"function"===typeof c?c.call(b,{name:"privacyPolicyUrl",hash:{},data:e}):c))+'">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"login_dialog_privacy_policy",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;return f+"</a></p>\n</form>\n"},useData:!0})}({}),wb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return"show-label"},3:function(b,a,d,e){var c;return(a=(c=a.defaultLabel||b&&b.defaultLabel,"function"===typeof c?c.call(b,{name:"defaultLabel",hash:{},data:e}):c))||0===a?a:""},5:function(b,a,d,e){return"&nbsp"},7:function(b,a,d,e){var c;return(a=(c=a.content||b&&b.content,"function"===typeof c?c.call(b,{name:"content",hash:{},data:e}):c))||0===a?a:""},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){d='<div class="holder-label">\n    <div class="info ';var c=a["if"].call(b,b&&b.defaultLabel,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(c||0===c)d+=c;d+='">';if((c=a["if"].call(b,b&&b.defaultLabel,{name:"if",hash:{},fn:this.program(3,e),inverse:this.program(5,e),data:e}))||0===c)d+=c;d+='</div>\n    <div class="content">';if((c=a["if"].call(b,b&&b.content,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===c)d+=c;return d+"</div>\n</div>\n"},useData:!0})}({}),U=function(k){Handlebars.registerPartial("InputMixinHolderLabel",k.HolderLabelTemplate);return{dependencies:[],trackedEvents:function(){return[{type:"focus",selector:".label[data-holder] input",name:"focus_input",handler:"__onHolderInputFocus"},{type:"blur",selector:".label[data-holder] input",name:"blur_input",handler:"__onHolderInputBlur"}]},initialize:function(){this.render=function(b){return function(){b.apply(this,arguments);this.__insertLabelTemplate(this.$(".label[data-holder]"))}}(this.render)},__insertLabelTemplate:function(b){b=(b instanceof $?b:this.$(b)).not(":has(>.holder-label)");b.prepend(k.HolderLabelTemplate());b.filter("[data-dropdown]").each(function(a,d){this.__setInputLabelMsg(d,$(d).attr("data-holder"))}.bind(this))},__onHolderInputFocus:function(b){b=$(b.currentTarget);b.attr("placeholder","");b=b.closest(".label[data-holder]").removeClass("error");this.__insertLabelTemplate(b);b.find(">.holder-label >.info").html(b.attr("data-holder")).addClass("show-label")},__onHolderInputBlur:function(b){b=$(b.currentTarget);if(!b.val()){var a=b.closest(".label[data-holder]");b.attr("placeholder",a.attr("data-holder"));a.hasClass("error")||a.find(">.holder-label >.info").html("&nbsp;").removeClass("show-label")}},__clearError:function(b){b=$(b).closest(".label[data-holder]").removeClass("error");var a=b.find("input");!a[0]||a.val()?this.__setInputLabelMsg(b,b.attr("data-holder")):(a.attr("placeholder",b.attr("data-holder")),b.find(">.holder-label >.info").html("&nbsp;").removeClass("show-label"))},__setInputLabelMsg:function(b,a){b=b instanceof $?b:this.$(b);b.find(">.holder-label >.info").html(a).toggleClass("show-label",!!b.attr("data-holder")||b.hasClass("error"))},__setInputErrorLabelMsg:function(b,a){this.__setInputLabelMsg(this.$(b).addClass("error"),a)}}}({UiCore:m["@UiCore"],HolderLabelTemplate:wb}),xb=function(k){return k.UiCore.RestCollection.extend("PrefCollection",{model:k.UiCore.EdgeModel})}({UiCore:m["@UiCore"]}),V=function(k){return IMVU.BaseClass.extend("PrefsManager",{dependencies:["loginManager","Promise","rest"],initialize:function(b){this.Promise=b.Promise;this.rest=b.rest;this.__pendingSets={};var a=b.userModel||b.loginManager.getCurrent().getSingleEdge("user");this.__populated=a.populated().then(function(){var d=this.Promise.resolve();a.relations&&a.relations.preferences||(a.invalidate(),d=a.populated());return d.then(function(){return a.getEdgeCollection("preferences",k.PrefCollection)})}.bind(this)).then(function(d){this.collection=d;return d.populated()}.bind(this)).then(function(){this.collection.on("change",this.__cleanPendingSet.bind(this))}.bind(this))},__cleanPendingSet:function(b){var a=b.get("name");b=b.get("value");this.__pendingSets[a]===b&&delete this.__pendingSets[a]},populated:function(){return this.__populated},__ensurePopulated:function(){if("pending"===this.__populated.state)throw Error("Cannot perform preference operation until preferences are populated")},get:function(b,a){this.__ensurePopulated();if(this.__pendingSets[b])return this.__pendingSets[b];for(var d=0;d<this.collection.length;d++){var e=this.collection.at(d);if(e.get("name")===b)return e.get("value")}return a},getBool:function(b,a){b=this.get(b,null);return _.isNull(b)?a:!!parseInt(b,10)},getInt:function(b,a){b=this.get(b,null);return _.isNull(b)?a:parseInt(b,10)},setBool:function(b,a){return this.set(b,a?"1":"0")},setInt:function(b,a){return this.set(b,String(a))},set:function(b,a){this.__ensurePopulated();if("string"!==typeof a)throw Error("Tried to set pref with non-string value: "+typeof a);if(this.get(b)===a)return new this.Promise(function(d){d.accept()});this.__pendingSets[b]=a;a=this.rest.post(this.collection.url,{id:"/preferences/preference-"+b,data:{value:a}});a.catch(function(){delete this.__pendingSets[b]}.bind(this));return a}})}({UiCore:m["@UiCore"],PrefCollection:xb}),yb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="copy-body">\n    ',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_pending_guardian_approval_1",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+="\n    ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_pending_guardian_approval_2",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="\n    ";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_pending_guardian_approval_3",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='\n    <a href="https://help.imvu.com" target="_blank">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Help Center",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='.</a></div>\n</div>\n<div class="privacy-policy-link"><a href="https://secure.imvu.com/next/policyhub/privacypolicy/">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"view_privacy_policy",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</a></div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary full-width">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"close pending policy",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</button>\n<\/script>\n\n"},useData:!0})}({}),zb=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("PrivacyPolicyMinorsPendingDialog",{uiContextName:"privacy_policy_minors_pending_dialog",className:"privacy-policy-minors-pending-dialog dialog-type-B",dependencies:["cookieManager","globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_adult_okay",handler:"__onClose"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("privacy_pending_guardian_approval_title");this.addToDOM();this.$(".dialog-x").remove()},postRender:function(){this.setContent("body",k.template,{});this.setContent("footer",this.$(".dialog-footer-template").text())},__onClose:function(a){b.prototype.__onClose.call(this,a)}})}({Dialogs:m["@Dialogs"],Tooltip:r,template:yb}),Ab=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="content">\n    <div class="privacy-policy-minors-body">',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_dialog_body",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='</div>\n    <div class="privacy-policy-minors-form">\n        <div class="privacy-policy-minors-form-title">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_dialog_form_title",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</div>\n        <div class="fieldset">\n            <label>';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Name",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</label>\n            <input type="text" class="privacy-policy-minors-avatarname full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"your name",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</label>\n            <input type="text" class="privacy-policy-minors-name full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"email address",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+="<span> (";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_email_note",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+=')</span></label>\n            <input type="text" class="privacy-policy-minors-email full-width"></input>\n            <div class="input-error"></div>\n        </div>\n        <div class="fieldset">\n            <label>';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_guardian_name",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</label>\n            <input type="text" class="privacy-policy-minors-guardian-name full-width"></input>\n        </div>\n        <div class="fieldset">\n            <label>';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_guardian_email",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</label>\n            <input type="text" class="privacy-policy-minors-guardian-email full-width"></input>\n            <div class="input-note">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_guardian_email_note",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</div>\n            <div class="input-error"></div>\n        </div>\n    </div>\n    <div class="privacy-policy-link"><a href="https://secure.imvu.com/next/policyhub/privacypolicy/">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"view_privacy_policy",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</a></div>\n</div>\n\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary minors-guardian-form-submit full-width disabled">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"submit",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</button>\n<\/script>"},useData:!0})}({}),Bb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g="<div>\n    <p>",f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_guardian_dialog_body_1",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+="</p>\n    <p>";if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"privacy_policy_minors_guardian_dialog_body_2",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</p>\n</div>\n<div class="privacy-policy-link"><a href="https://secure.imvu.com/next/policyhub/privacypolicy/">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"view_privacy_policy",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</a></div>\n<script type="text/template" class="dialog-footer-template">\n    <button class="btn btn-primary ok full-width">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"OK",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</button>\n<\/script>"},useData:!0})}({}),Cb=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("PrivacyPolicyMinorsGuardianDialog",{uiContextName:"privacy_policy_minors_guardian_dialog",className:"privacy-policy-minors-guardian-dialog dialog-type-B",dependencies:["globalStringManager"],trackedEvents:function(){return[{type:"click",selector:"button",name:"submit_privacy_policy_minors_okay",handler:"__onClose"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.title=this.__globalStringManager.get("privacy_policy_minors_guardian_dialog_title");this.addToDOM()},postRender:function(){this.setContent("body",k.template,{});this.setContent("footer",this.$(".dialog-footer-template").text())}})}({Dialogs:m["@Dialogs"],template:Bb}),Db=function(k){return{validateEmail:function(b){return/[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,3}$/.test(b)}}}({}),Eb=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("PrivacyPolicyMinorsDialog",{uiContextName:"privacy_policy_minors_dialog",className:"privacy-policy-minors-dialog dialog-type-B",dependencies:["dialogManager","globalStringManager","rest"],trackedEvents:function(){return[{type:"keyup",selector:"input.privacy-policy-minors-avatarname",name:"change_avatarname",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-name",name:"change_username",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-email",name:"change_email",handler:"__validateMinorsEmail"},{type:"keyup",selector:"input.privacy-policy-minors-guardian-name",name:"change_guardian_name",handler:"__toggleButton"},{type:"keyup",selector:"input.privacy-policy-minors-guardian-email",name:"change_guardian_email",handler:"__validateGuardiansEmail"},{type:"click",selector:"button",name:"submit_privacy_policy_minors_form",handler:"__submit"}]},initialize:function(a){b.prototype.initialize.call(this,a);this.__GUARDIAN_VERIFICATION_URL=this.__serviceProvider.get("root")+"/guardian_verification";this.title=this.__globalStringManager.get("privacy_policy_minors_dialog_title");this.__formValidator=k.FormValidator;this.addToDOM();this.$(".dialog-x").remove();this.__hasError=!1},postRender:function(){this.setContent("body",k.template,{});this.setContent("footer",this.$(".dialog-footer-template").text());this.$(".content").scrollbar()},__toggleButton:function(){var a=!1;this.$("input").each(function(e){$(this).val()||(a=!0)});var d=this.__minorsEmailError||this.__guardiansEmailError;this.$(".minors-guardian-form-submit").toggleClass("disabled",a||d)},__validateMinorsEmail:function(a){this.__minorsEmailError=!1;var d=$(a.currentTarget);a=d.siblings(".input-error");a.text("");d=this.__validateEmail(d.val());null!==d&&(this.__minorsEmailError=!0,a.text(d));this.__toggleButton()},__validateGuardiansEmail:function(a){this.__guardiansEmailError=!1;a=$(a.currentTarget);a.siblings(".input-note").toggleClass("hidden",!1);var d=a.siblings(".input-error");d.text("");var e=this.__validateEmail(a.val());null===e&&this.$("input.privacy-policy-minors-email").val()===this.$("input.privacy-policy-minors-guardian-email").val()&&(e=this.__globalStringManager.get("privacy_policy_minors_guardian_email_note"));null!==e&&(this.__guardiansEmailError=!0,d.text(e),a.siblings(".input-note").toggleClass("hidden",!0));this.__toggleButton()},__validateEmail:function(a){return a?this.__formValidator.validateEmail(a)?null:this.__globalStringManager.get("error_message_email_invalide_format"):this.__globalStringManager.get("error_message_email_empty")},__submit:function(a){this.__rest.post(this.__GUARDIAN_VERIFICATION_URL,{avatarname:this.$("input.privacy-policy-minors-avatarname").val(),user_name:this.$("input.privacy-policy-minors-name").val(),user_email:this.$("input.privacy-policy-minors-email").val(),guardian_name:this.$("input.privacy-policy-minors-guardian-name").val(),guardian_email:this.$("input.privacy-policy-minors-guardian-email").val()}).then(function(d){});this.__onClose(a);this.__dialogManager.showDialog(k.PrivacyPolicyMinorsGuardianDialog)}})}({Dialogs:m["@Dialogs"],FormValidator:Db,PrivacyPolicyMinorsGuardianDialog:Cb,template:Ab}),W=function(k){return{mixin:function(){var b=$jscomp.getRestArguments.apply(0,arguments),a=b[0],d=[],e=function(){for(var f=$jscomp.getRestArguments.apply(0,arguments),h=d.length;0<h--;)d[h].apply(this,f)},c=[],g=function(){for(var f=$jscomp.getRestArguments.apply(0,arguments),h=[],l=c.length;0<l--;)h=h.concat(c[l].apply(this,f));return h};_.each(b,function(f){f.initialize&&d.push(f.initialize);f.trackedEvents&&c.push(f.trackedEvents);if(f!==a){var h=a.dependencies||[];_.each(f.dependencies,function(l){-1===_.indexOf(h,l)&&h.push(l)});h.sort();_.extend(a,f,{dependencies:h})}});d.length&&(a.initialize=1<d.length?e:d[0]);c.length&&(a.trackedEvents=1<c.length?g:c[0]);return a}}}({}),Fb=function(k){var b=k.Dialogs.AlloyModalDialog;return b.extend("LoginDialog",k.Mixin.mixin({uiContextName:"login_dialog",className:"login-dialog dialog-type-B-flexible",dependencies:"browserInfo contextMenuManager cookieManager counterHelper dialogManager featureAccessManager globalStringManager googleAnalytics localStorage loginManager modeManager prefsManager Promise restModelFactory urlManager window".split(" "),trackedEvents:function(){return[{type:"submit",selector:"form.login",name:"login",handler:"__onLogin"},{type:"click",selector:".id-signup",name:"signup",handler:"__onClickSignup"},{type:"click",selector:".id-fb",name:"fb_login",handler:this.__onClickFB},{type:"click",selector:".id-apple",name:"apple_login",handler:"__onClickApple"},{type:"click",selector:".toggle-password-visibility",name:"toggle_password_visibility",handler:"__togglePasswordVisibility"},{type:"click",selector:".forgot-password-link",name:"forgot_password",handler:"__forgotPassword"},{type:"click",selector:".language",name:"language",handler:this.__changeLanguage},{type:"click",selector:".more-locales",name:"more_locales",handler:this.__showMoreLocalesMenu}]},initialize:function(a){this.__browserInfo=a.browserInfo;this.title=a.globalStringManager.get("welcome_login_dialog_signin");"undefined"!==typeof a.globalStringManager&&(this.__globalStringManager=a.globalStringManager);this.hasCloseButton=_.isUndefined(a.hasCloseButton)?!0:a.hasCloseButton;this.__loginMode=a.loginMode;b.prototype.initialize.call(this,a);this.__loginCookieName=this.__serviceProvider.get("loginCookieName");this.__cookieManager=this.__serviceProvider.get("cookieManager");this.__hasSignupButton=_.isUndefined(a.hasSignupButton)?!0:a.hasSignupButton;this.__loginUsername=this.__cookieManager.get("login_username")?this.__cookieManager.get("login_username"):"";this.__refreshOnLogin=a.refreshOnLogin||"mobile"===this.__serviceProvider.get("platform");this.__loginDestination=a.loginDestination?this.__getLoginDestination(a.loginDestination):null;this.__contextMenuManager=a.contextMenuManager;this.shouldFocusOnPrimaryButton=!1;this.__socialLogin=this.__loginManager.getSocialLogin();this.__socialLogin.checkLoginState();(this.__hadSocialLogin=this.__socialLogin.hadEverLoggedIn())&&this.__socialLogin.logout();(a=this.__serviceProvider.get("currentLocale"))&&"en"!=a||(a="www");var d=this.__serviceProvider.get("locales");this.__currentLocaleInfo=void 0;this.__otherLocaleInfo=[];this.__remainderLocaleInfo=[];var e=0;d=$jscomp.makeIterator(d);for(var c=d.next();!c.done;c=d.next())(c=c.value)&&c.url&&(c.url=decodeURIComponent(c.url)),c.code==a?this.__currentLocaleInfo=c:2>e&&-1!=["es","pt","www"].indexOf(c.code)?(this.__otherLocaleInfo.push(c),++e):this.__remainderLocaleInfo.push(c);a=this.__serviceProvider.get("siteRoot").replace("welcome/","").replace("next/","");this.__featureAccessManager.isElectronClient()&&(a="https://secure.imvu.com/");this.__forgotPasswordUrl=a+"welcome/forgotpassword/";this.addToDOM()},postRender:function(){this.__loginUsername="undefined"===typeof this.__loginUsername?"":this.__loginUsername;this.__loginUsername="undefined"===this.__loginUsername?"":this.__loginUsername;this.__loginUsername=null===this.__loginUsername?"":this.__loginUsername;this.__showFBButton=this.__featureAccessManager.canSeeFacebookLogin();this.setContent("body",k.template,{username:this.__loginUsername,forgotPasswordUrl:this.__forgotPasswordUrl,currentLocale:this.__currentLocaleInfo,otherLocales:this.__otherLocaleInfo,canSeeAppleSignIn:this.__featureAccessManager.canSeeAppleSignIn(),policyHubUrl:this.__urlManager.get("policy_hub"),arbitrationAgreementUrl:this.__urlManager.get("arbitration_agreement"),privacyPolicyUrl:this.__urlManager.get("privacy_policy"),showFBButton:this.__showFBButton});this.$(".login_avatarname input").focus();this.__loginUsername&&this.$(".login_password input").focus();this.$(".login").toggleClass("can-signup",this.__hasSignupButton);if(this.__loginUsername){var a=this.$('input[name="avatarname"]').closest(".label[data-holder]");this.__insertLabelTemplate(a);if(a.hasClass("ignore-placeholder-behavior"))return;a.find(">.holder-label >.info").html(a.attr("data-holder"))}this.__counterHelper.increment("welcome_login_dialog")},__showMoreLocalesMenu:function(a){a.preventDefault();for(var d=[],e={},c=$jscomp.makeIterator(this.__remainderLocaleInfo),g=c.next();!g.done;e={$jscomp$loop$prop$localeInfo$3:e.$jscomp$loop$prop$localeInfo$3},g=c.next())e.$jscomp$loop$prop$localeInfo$3=g.value,d.push({name:e.$jscomp$loop$prop$localeInfo$3.code,text:e.$jscomp$loop$prop$localeInfo$3.name,handler:function(f){return function(){var h=f.$jscomp$loop$prop$localeInfo$3.code;if(this.__featureAccessManager.isElectronClient())this.__localStorage.setItem("lang",h),this.__window.location.reload();else{""===h?this.__cookieManager.clear("saved_locale"):this.__cookieManager.set("saved_locale",h);var l=new URL(this.__window.location.href);3<l.host.split(".").length&&(l.host=l.host.split(".").splice(1).join("."));l.host=[h,l.host].join(".");this.__window.location.href=l}}}(e).bind(this)});this.__contextMenuManager.showMenu(a,k.ContextMenu,{items:d,displayOptions:{above:!0,right:!0}})},__changeLanguage:function(a){a.preventDefault();var d=a.target.getAttribute("data-code");this.__featureAccessManager.isElectronClient()?(this.__localStorage.setItem("lang",d),this.__window.location.reload()):(""===d?this.__cookieManager.clear("saved_locale"):this.__cookieManager.set("saved_locale",d),this.__window.location.href=a.target.getAttribute("href"))},__onLogin:function(a){null!==a&&a.preventDefault();a="true"===this.__cookieManager.get("accepted_all_cookies")?!0:!1;var d={username:this.$('[name="avatarname"]').val(),password:this.$('[name="password"]').val(),gdpr_cookie_acceptance:a};this.$("label.submit").addClass("loading");this.__loginManager.performLoginFromCredentials(this.__serviceProvider,d).then(function(e){this.__googleAnalytics.recordSuccessfulAuthentication("true");this.$("label.submit").removeClass("loading");this.$(".error-message").removeClass("active").css("height","");this.__cookieManager.set(this.__loginCookieName,"true");this.__cookieManager.set("prefer_alloy","1");this.__cookieManager.set("login_username",d.username);this.__cookieManager.set("password_changed","0");var c=this.__restModelFactory.readModel(e.relations.user,k.UiCore.NodeModel);c.relations&&c.relations.preferences||c.invalidate();c.populated().then(function(){c.get("is_on_hold")?this.__dialogManager.alert({title:this.__globalStringManager.get("welcome_login_banned_user_title"),text:this.__globalStringManager.get("welcome_login_banned_user_text")}).finished.then(function(){this.hide();this.__featureAccessManager.isElectronClient()?(this.__externalWindow=this.__serviceProvider.get("externalWindow"),this.__externalWindow.newElectronWindow({width:1024,height:768}).loadURL("https://help.imvu.com/s/contactus"),this.__onLoginContinue(c)):this.__window.location="https://help.imvu.com/s/contactus"}.bind(this)):this.__onLoginContinue(c)}.bind(this))}.bind(this),function(e){var c="credentials";e===this.__loginManager.ERROR_TRY_AGAIN_LATER?c="try-again-later":e===this.__loginManager.ERROR_DISABLED?c="disabled":e===this.__loginManager.ERROR_UNDERAGE||e===this.__loginManager.ERROR_COOKIE_UNACCEPT||e===this.__loginManager.ERROR_UNDERAGE_PENDING_CONSENT?(c="disabled",this.__showPrivacyPolicyDialog(e)):e===this.__loginManager.ERROR_EXCESSIVE_SERVER_LOAD?c="try-again-later-server-load":e===this.__loginManager.ERROR_CODE_EMAIL_RATE_LIMIT?c="2fa-email-sent-rate-limit":e===this.__loginManager.ERROR_WRONG_CODE_RATE_LIMIT?c="wrong-code-rate-limit":e===this.__loginManager.ERROR_CLIENT_2FA_NOT_SUPPORTED&&(c="client-2fa-not-supported");k.NextUtil.DomHelper.radioClass(this.$(".error-message."+c),"active");e=this.$(".error-message.active").height();this.$(".error-message.active").css("height",0);this.$("label.submit").removeClass("loading");this.$(".error-message.active").height();this.$(".error-message.active").css("height",e)}.bind(this))},__onLoginContinue:function(a){var d=this,e=this.__Promise.resolve();this.__featureAccessManager.isElectronClient()&&(e=new this.__Promise(function(c){d.__LoggedInPrefsManager=d.__serviceProvider.create(k.LoggedInPrefsManager,{userModel:a});d.__LoggedInPrefsManager.populated().then(function(){this.__LoggedInPrefsManager.setBool("next.has_signed_onto_client",!0);c.resolve()}.bind(d)).catch(function(g){window.console.error("Unable to save next.has_signed_onto_client",g);c.resolve()})}));e.then(function(){var c=new URL(d.__window.location.href).searchParams;c&&c.get("next")?(c=c.get("next"),d.__window.location.href=decodeURIComponent(c)):d.__loginDestination?d.__window.location.href=decodeURIComponent(d.__loginDestination):d.__loginManager.getLoginDestination()?d.__window.location.href=d.__loginManager.getLoginDestination():d.__serviceProvider.services.overrideMode&&"ftux"!==d.__serviceProvider.services.overrideMode?(c=d.__serviceProvider.get("siteRoot"),c+=d.__serviceProvider.get("startMode")+"/",d.__serviceProvider.services.startSubmode&&(c+=d.__urlId(d.serviceProvider.get("startSubmode"))+"/"),d.__window.location.href=c):d.__refreshOnLogin?d.__window.location.reload():a.populated().then(function(){return a.getEdgeCollection("preferences",k.UiCore.RestCollection)}.bind(d)).then(function(g){this.__prefs=g;return this.__prefs.populated()}.bind(d)).then(function(){for(var g=!1,f=0;f<this.__prefs.length;f++){var h=this.__prefs.at(f);"registered_through_alloy"!==h.get("name")&&"registered_through_mobile"!==h.get("name")&&"pure_mobile_access"!==h.get("name")||!h.get("value")||(g=!0,this.__window.location.reload())}g||(this.__window.location.href="/switch_to/classic/")}.bind(d))})},__onClickSignup:function(a){a.preventDefault();this.__googleAnalytics.recordSignUpClick("login");this.promiseResolver.resolve("signup");if("iOS"===this.__browserInfo.getMobileOS())this.__window.location="itms-apps://itunes.apple.com/us/app/imvu/id919745844?mt=8";else if("Android"===this.__browserInfo.getMobileOS())this.__window.location="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova";else if((a=new URL(this.__window.location.href).searchParams)&&a.get("next")){var d=a.get("next");a=null!==this.__window.location.host.match(/localhost\.imvu\.com$/)===!0?new URL("https://localhost.imvu.com/welcome/ftux/gender/"):new URL("https://secure.imvu.com/welcome/ftux/gender/");a.searchParams.append("next",d);this.__window.open(a,"_self")}else this.__window.location="/welcome/ftux/gender/"},__redirectToFtux:function(){this.$el.fadeOut(300,function(){this.__modeManager.openMode({mode:{id:"ftux"},submode:{id:"gender"}})}.bind(this))},__onClickCta:function(){"mobile"===this.__serviceProvider.get("platform")?"iOS"===this.__browserInfo.getMobileOS()?this.__window.location="itms-apps://itunes.apple.com/us/app/imvu/id919745844?mt=8":"Android"===this.__browserInfo.getMobileOS()?this.__window.location="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova":this.__window.location="https://about.imvu.com/mobile/":this.__redirectToFtux()},__onClickFB:function(){var a=this;"mobile"===this.__serviceProvider.get("platform")?this.__socialLogin.fbSDKLogin(this.__imvuLoginCallback.bind(this),function(){a.__dialogManager.confirm({title:a.__globalStringManager.get("ftux_frontpage_get_the_app"),text:a.__globalStringManager.get("ftux_frontpage_best_mobile_experience"),yes:a.__globalStringManager.get("ftux_frontpage_get_the_app_yes_btn"),no:a.__globalStringManager.get("ftux_frontpage_get_the_app_cancel_btn")}).finished.then(function(){this.__onClickCta()}.bind(a))}):this.__featureAccessManager.isElectronClient()?this.__window.navigator.onLine?this.__socialLogin.fbOauthLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this)):this.__dialogManager.alert({title:this.__globalStringManager.get("generic_offline_error_title"),text:this.__globalStringManager.get("generic_offline_error_message")}):this.__socialLogin.fbSDKLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this))},__onClickApple:function(){var a=this;"mobile"===this.__serviceProvider.get("platform")?this.__socialLogin.appleSDKLogin(this.__imvuLoginCallback.bind(this),function(){a.__dialogManager.confirm({title:a.__globalStringManager.get("ftux_frontpage_get_the_app"),text:a.__globalStringManager.get("ftux_frontpage_best_mobile_experience"),yes:a.__globalStringManager.get("ftux_frontpage_get_the_app_yes_btn"),no:a.__globalStringManager.get("ftux_frontpage_get_the_app_cancel_btn")}).finished.then(function(){this.__onClickCta()}.bind(a))},this.__appleErrorCallback.bind(this)):this.__featureAccessManager.isElectronClient()?this.__window.navigator.onLine?this.__socialLogin.appleOauthLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this),this.__appleErrorCallback.bind(this)):this.__dialogManager.alert({title:this.__globalStringManager.get("generic_offline_error_title"),text:this.__globalStringManager.get("generic_offline_error_message")}):this.__socialLogin.appleSDKLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this),this.__appleErrorCallback.bind(this))},__imvuLoginCallback:function(){var a=new URL(this.__window.location.href).searchParams;a&&a.get("next")?(a=a.get("next"),this.__window.location.href=decodeURIComponent(a)):this.__loginDestination?this.__window.location.href=decodeURIComponent(this.__loginDestination):this.__loginManager.getLoginDestination()?this.__window.location.href=this.__loginManager.getLoginDestination():this.__serviceProvider.services.overrideMode&&"ftux"!==this.__serviceProvider.services.overrideMode?(a=this.__serviceProvider.get("siteRoot"),a+=this.__serviceProvider.get("startMode")+"/",this.__serviceProvider.services.startSubmode&&(a+=this.__urlId(this.serviceProvider.get("startSubmode"))+"/"),this.__window.location.href=a):this.__window.location.reload()},__appleErrorCallback:function(a){var d=this.__globalStringManager.get("Error"),e=this.__globalStringManager.get("login_dialog_unknown_login_error");"user-disabled"===a?e=this.__globalStringManager.get("login_dialog_disabled_error"):"user-velocity"===a?e=this.__globalStringManager.get("login_dialog_try_again_later_error"):"user-service"===a&&(e=this.__globalStringManager.get("login_dialog_try_again_later_error_server_load"));this.__dialogManager.alert({title:d,text:e})},__togglePasswordVisibility:function(){var a=this.$(".login_password input"),d="password"==a.attr("type");a[0].setAttribute("type",d?"text":"password");this.$(".toggle-password-visibility").toggleClass("icon-password-show",!d).toggleClass("icon-password-hide",d);a.focus()},__forgotPassword:function(){this.__featureAccessManager.isElectronClient()||(this.__window.location=this.__forgotPasswordUrl)},__showPrivacyPolicyDialog:function(a){var d=k.PrivacyPolicyAdultDialog;a===this.__loginManager.ERROR_UNDERAGE?d=k.PrivacyPolicyMinorsDialog:a===this.__loginManager.ERROR_UNDERAGE_PENDING_CONSENT&&(d=k.PrivacyPolicyMinorsPendingDialog);return this.__dialogManager.showDialog(d)},__getLoginDestination:function(a){for(var d=["logoff"],e=0;e<d.length;e++)if(-1<a.indexOf(d[e])){a="/next";break}return a}},k.InputMixin))}({Dialogs:m["@Dialogs"],NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],ContextMenu:T,InputMixin:U,LoggedInPrefsManager:V,Mixin:W,PrivacyPolicyAdultDialog:S,PrivacyPolicyMinorsDialog:Eb,PrivacyPolicyMinorsPendingDialog:zb,template:vb}),Gb=function(k){var b=k.Submode;return b.extend("FtuxFrontpageSubmode",{uiContextName:"ftux_frontpage_submode",className:"submode submode-ftux-frontpage ftux-layout",dependencies:"browserInfo contextMenuManager cookieManager dialogManager featureAccessManager globalNav globalStringManager googleAnalytics leanplum localStorage loginManager modeManager perfReportManager Promise startupModel stringManager timer uiEventReporter urlManager webGL window".split(" "),trackedEvents:function(){return[{type:"click",selector:".id-continue",name:"lets_start",handler:this.__onClickCta},{type:"click",selector:".id-login",name:"login",handler:this.__showLogin.bind(this,!0,"ftux")},{type:"click",selector:".id-fb",name:"lets_start",handler:this.__onClickFB},{type:"click",selector:".id-apple",name:"apple_signin",handler:this.__onClickApple},{type:"click",selector:".id-apple-sdk",name:"apple_login",handler:"__onClickAppleSDK"},{type:"click",selector:".login",name:"login",handler:this.__onClickBottomLogIn},{type:"click",selector:".language",name:"language",handler:this.__changeLanguage},{type:"click",selector:".more-locales",name:"more_locales",handler:this.__showMoreLocalesMenu}]},show:function(){IMVU.loadLandingVideo();$(this.__window.landingVideoInfo.container).show();this.__window.landingVideoInfo.video&&this.__window.landingVideoInfo.video.play();b.prototype.show.call(this);this.refreshVideoSize()},hide:function(){b.prototype.hide.call(this)},hasPreviouslyLoggedIn:function(){var a=this.__serviceProvider.get("loginCookieName");a=this.__cookieManager.get(a);return null===a?!1:"undefined"!==typeof a},initialize:function(a){a.leanplum.recordEvent("user_landed");b.prototype.initialize.call(this,a);this.__perfStartTime=IMVU.optionalProperty(a,"perfStartTime",null);this.__serviceProvider=a.serviceProvider;this.__dialogManager=a.dialogManager;$(this.__window).on("resize.ftux-frontpage",this.refreshVideoSize.bind(this));this.__loadedMedia=0;this.__passwordChanged=IMVU.optionalProperty(a,"passwordChanged",!1)||"1"==this.__cookieManager.get("password_changed")?!0:!1;var d=this.__serviceProvider.get("currentLocale");d&&"en"!=d||(d="www");var e=this.__serviceProvider.get("locales");this.__currentLocaleInfo=void 0;this.__otherLocaleInfo=[];this.__remainderLocaleInfo=[];var c=0;e=$jscomp.makeIterator(e);for(var g=e.next();!g.done;g=e.next())(g=g.value)&&g.url&&(g.url=decodeURI(g.url.replace(/\+/g," ").replace(/%2F/gi,"/").replace(/%3A/gi,":"))),g.code==d?this.__currentLocaleInfo=g:2>c&&-1!=["es","pt","www"].indexOf(g.code)?(this.__otherLocaleInfo.push(g),++c):this.__remainderLocaleInfo.push(g);this.__parentMode.hasOwnProperty("getConnectionTier")?this.__parentMode.getConnectionTier().then(function(){this.addToDOM()}.bind(this)):this.addToDOM();(d=document.querySelectorAll("#landing-video source"))&&d.length&&(this.__recordEvent("next_video_branch",{record:!0,branch:this.__cookieManager.get("next_video"),webmVideo:d[0].getAttribute("src"),mp4Video:d[1].getAttribute("src")}),this.__uiEventReporter.flush());this.__socialLogin=this.__loginManager.getSocialLogin();this.__browserInfo=a.browserInfo;this.hasPreviouslyLoggedIn()&&this.__showLogin()},delete:function(){$(this.__window).off("resize.ftux-frontpage");this.__loadedMedia=0;_.each(this.__waitingImgs,function(a){$(a).off("load")}.bind(this));_.each(this.__waitingVideos,function(a){$(a).off("loadeddata")}.bind(this));this.__window.landingVideoInfo.video&&$(this.__window.landingVideoInfo.video).off("loadeddata");b.prototype.delete.call(this)},isAllMediaLoaded:function(){var a=this.__waitingImgs.length+this.__waitingVideos.length+1;this.__window.landingVideoInfo.isAlreadyLoaded&&a++;return this.__loadedMedia>=a},__showMoreLocalesMenu:function(a){a.preventDefault();for(var d=[],e={},c=$jscomp.makeIterator(this.__remainderLocaleInfo),g=c.next();!g.done;e={$jscomp$loop$prop$localeInfo$3:e.$jscomp$loop$prop$localeInfo$3},g=c.next())e.$jscomp$loop$prop$localeInfo$3=g.value,d.push({name:e.$jscomp$loop$prop$localeInfo$3.code,text:e.$jscomp$loop$prop$localeInfo$3.name,handler:function(f){return function(){var h=f.$jscomp$loop$prop$localeInfo$3.code;this.__featureAccessManager.isElectronClient()?(this.__localStorage.setItem("lang",h),this.__window.location.reload()):(""===h?this.__cookieManager.clear("saved_locale"):this.__cookieManager.set("saved_locale",h),this.__window.location.href=a.target.getAttribute("href"))}}(e).bind(this)});this.__contextMenuManager.showMenu(a,k.ContextMenu,{items:d,displayOptions:{above:!0,right:!0}})},__changeLanguage:function(a){a.preventDefault();var d=a.target.getAttribute("data-code");this.__featureAccessManager.isElectronClient()?(this.__localStorage.setItem("lang",d),this.__window.location.reload()):(""===d?this.__cookieManager.clear("saved_locale"):this.__cookieManager.set("saved_locale",d),this.__window.location.href=a.target.getAttribute("href"))},__onLandingVideoLoaded:function(){$(this.__window).trigger("resize")},__onAnyMediaLoaded:function(){this.__loadedMedia++;this.isAllMediaLoaded()&&(this.__recordEvent("ftux_front_page_load_time",{record:!0,time:(Date.now()-this.__window.loadStartTime)/1e3}),this.__modeManager.recordPageReady(),this.__uiEventReporter.flush(),"function"===typeof this.__parentMode.maybeShowGDPRDialog&&this.__parentMode.maybeShowGDPRDialog())},render:function(){b.prototype.render.call(this);this.__globalNav.setText(this.__globalStringManager.get("WELCOME TO IMVU"));this.__showFBButton=this.__featureAccessManager.canSeeFacebookLogin();this.$el.html(k.template({currentLocale:this.__currentLocaleInfo,otherLocales:this.__otherLocaleInfo,canSeeAppleSignIn:this.__featureAccessManager.canSeeAppleSignIn(),adchoicesUrl:this.__urlManager.get("opt_out_third_party"),showFBButton:this.__showFBButton}));this.__waitingImgs=this.$("img");this.__waitingVideos=this.$("video");_.each(this.__waitingImgs,function(a){$(a).on("load",this.__onAnyMediaLoaded.bind(this))}.bind(this));_.each(this.__waitingVideos,function(a){$(a).on("loadeddata",this.__onAnyMediaLoaded.bind(this))}.bind(this));$(this.__window.landingVideoInfo.video).on("loadeddata",this.__onLandingVideoLoaded.bind(this));this.__onAnyMediaLoaded();this.__window.landingVideoInfo.isAlreadyLoaded&&(this.__onAnyMediaLoaded(),this.__onLandingVideoLoaded());this.__parentMode.show2dAvatar&&!this.__webGL.use3d()&&(this.__parentMode.show2dAvatar({gender:"female",$parentElement:this.$(".ftux-avatar-cache"),parentContext:this,allowDuplicates:!0}),this.__parentMode.show2dAvatar({gender:"male",$parentElement:this.$(".ftux-avatar-cache"),parentContext:this,allowDuplicates:!0}));this.__perfReportManager.record(this.__perfReportManager.tags.SUBMODE_WELCOME_LOGIN,"nav",this.__perfStartTime)},refreshVideoSize:function(){var a=$(this.__window.landingVideoInfo.container),d=$(this.__window.landingVideoInfo.video);d.addClass("is-refreshed");!d.hasClass("is-full-height")&&d.height()<a.height()&&d.addClass("is-full-height");d.hasClass("is-full-height")&&d.width()<a.width()&&d.removeClass("is-full-height")},__onClickCta:function(){IMVU.removeLandingVideo();this.__globalNav.toggleLogo(!0);this.__googleAnalytics.recordClick("welcome","get started");"mobile"===this.__serviceProvider.get("platform")?"iOS"===this.__browserInfo.getMobileOS()?this.__window.location="itms-apps://itunes.apple.com/us/app/imvu/id919745844?mt=8":"Android"===this.__browserInfo.getMobileOS()?this.__window.location="https://play.google.com/store/apps/details?id=com.imvu.mobilecordova":this.__window.location="https://about.imvu.com/mobile/":this.__redirectToFtux()},__redirectToFtux:function(){this.$el.fadeOut(300,function(){this.__modeManager.openMode({mode:{id:"ftux"},submode:{id:"gender"}})}.bind(this))},__onClickFB:function(){var a=this;"mobile"===this.__serviceProvider.get("platform")?this.__socialLogin.fbSDKLogin(this.__imvuLoginCallback.bind(this),function(){a.__dialogManager.confirm({title:a.__globalStringManager.get("ftux_frontpage_get_the_app"),text:a.__globalStringManager.get("ftux_frontpage_best_mobile_experience"),yes:a.__globalStringManager.get("ftux_frontpage_get_the_app_yes_btn"),no:a.__globalStringManager.get("ftux_frontpage_get_the_app_cancel_btn")}).finished.then(function(){this.__onClickCta()}.bind(a))}):this.__featureAccessManager.isElectronClient()?this.__window.navigator.onLine?this.__socialLogin.fbOauthLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this)):this.__dialogManager.alert({title:this.__globalStringManager.get("generic_offline_error_title"),text:this.__globalStringManager.get("generic_offline_error_message")}):this.__socialLogin.fbSDKLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this))},__onClickApple:function(){var a=this;"mobile"===this.__serviceProvider.get("platform")?this.__socialLogin.appleSDKLogin(this.__imvuLoginCallback.bind(this),function(){a.__dialogManager.confirm({title:a.__globalStringManager.get("ftux_frontpage_get_the_app"),text:a.__globalStringManager.get("ftux_frontpage_best_mobile_experience"),yes:a.__globalStringManager.get("ftux_frontpage_get_the_app_yes_btn"),no:a.__globalStringManager.get("ftux_frontpage_get_the_app_cancel_btn")}).finished.then(function(){this.__onClickCta()}.bind(a))},this.__appleErrorCallback.bind(this)):this.__featureAccessManager.isElectronClient()?this.__window.navigator.onLine?this.__socialLogin.appleOauthLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this),this.__appleErrorCallback.bind(this)):this.__dialogManager.alert({title:this.__globalStringManager.get("generic_offline_error_title"),text:this.__globalStringManager.get("generic_offline_error_message")}):this.__socialLogin.appleSDKLogin(this.__imvuLoginCallback.bind(this),this.__redirectToFtux.bind(this),this.__appleErrorCallback.bind(this))},__appleErrorCallback:function(a){var d=this.__globalStringManager.get("Error"),e=this.__globalStringManager.get("login_dialog_unknown_login_error");"user-disabled"===a?e=this.__globalStringManager.get("login_dialog_disabled_error"):"user-velocity"===a?e=this.__globalStringManager.get("login_dialog_try_again_later_error"):"user-service"===a&&(e=this.__globalStringManager.get("login_dialog_try_again_later_error_server_load"));this.__dialogManager.alert({title:d,text:e})},__imvuLoginCallback:function(){var a=new URL(this.__window.location.href).searchParams;a&&a.get("next")?(a=a.get("next"),this.__window.location.href=decodeURIComponent(a)):this.__loginDestination?this.__window.location.href=decodeURIComponent(this.__loginDestination):this.__loginManager.getLoginDestination()?this.__window.location.href=this.__loginManager.getLoginDestination():this.__serviceProvider.services.overrideMode&&"ftux"!==this.__serviceProvider.services.overrideMode?(a=this.__serviceProvider.get("siteRoot"),a+=this.__serviceProvider.get("startMode")+"/",this.__serviceProvider.services.startSubmode&&(a+=this.__urlId(this.serviceProvider.get("startSubmode"))+"/"),this.__window.location.href=a):this.__window.location.reload()},__showLogin:function(a,d){d=d||"ftux";a&&this.__googleAnalytics.recordClick("welcome","show login");this.__loginDialog=this.__globalNav.showLoginDialog({loginMode:d}).then(function(e){"signup"==e&&this.__onClickCta()}.bind(this))},__onClickBottomLogIn:function(){var a=this.__serviceProvider.get("loginDestination")||this.__serviceProvider.get("siteRoot").replace("welcome","next");this.__loginDialog=this.__dialogManager.showDialog(k.LoginDialog,{loginDestination:a,isFrontpage:!0})}})}({UiCore:m["@UiCore"],ContextMenu:T,LoginDialog:Fb,Submode:u,template:ub}),Hb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="ftux-body loading">\n    <div class="gender">\n        <div class="avatar-container">\n            <div class="gender-wrapper">\n                <div class="female-wrapper">\n                    <div class="dgf" data-gender="female"></div>\n                </div>\n                <div class="male-wrapper">\n                    <div class="dgm" data-gender="male"></div>\n                </div>\n            </div>\n            <div class="gender-buttons">\n                <div class="gender-buttons-inner">\n                    <button class="btn btn-ghost female">',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"gender_f",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='</button>\n                    <button class="btn btn-ghost male">';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"gender_m",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;g+='</button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="dca hidden" data-gender>\n        <div class="avatar-container"></div>\n        <button class="go-back-button">';if((f=(c=a.icon||b&&b.icon||d,c.call(b,"icon-ftux-back-arrow",{name:"icon",hash:{},data:e})))||0===f)g+=f;return g+' <span>back</span></button>\n    </div>\n    <div class="slide-in main-content" data-gender></div>\n</div>\n'},useData:!0})}({}),B=function(k){var b=IMVU.BaseClass,a={registration:"arkoseApiRegistration",resetPassword:"arkoseApiResetPassword"};return b.extend("CaptchaManager",_.extend({dependencies:"globalStartupModel globalStringManager Promise timer urlManager window".split(" "),initialize:function(d){var e=this;b.prototype.initialize.call(this,d);this.__globalStartupModel=d.globalStartupModel;this.__chatManager=d.chatManager;this.__window=d.window;this.__globalStringManager=d.globalStringManager;this.__serviceProvider=d.serviceProvider;this.__Promise=d.Promise;this.__timer=d.timer;this.__urlManager=d.urlManager;this.__apiContext=IMVU.requireProperty(d,"apiContext");(this.__skipApiSetup=IMVU.optionalProperty(d,"skipApiSetup",!1))||this.__setupApi();this.__captchaApiPromise=this.__getCaptchaApiPromise();this.__onReadyResolver=void 0;this.__onReadyPromise=new this.__Promise(function(c){e.__onReadyResolver=c});this.__captchaApiPromise.then(function(c){e.__captchaEnforcement=c;c={onReady:function(){e.__onReadyResolver.resolve()},onCompleted:function(g){e.trigger("captcha:completed",g)},onShow:function(){e.trigger("captcha:show")},onHide:function(){e.trigger("captcha:hide")},onError:function(g){e.trigger("captcha:error",g)},language:e.__serviceProvider.get("language")};e.setConfig(c)}).catch(function(c){e.__onReadyResolver.reject(c)})},__setupApi:function(){var d=this,e=a[this.__apiContext];if(!e)throw Error('no registered api context for "'+this.__apiContext+'"');this.__window.setupArkoseEnforcement=function(g){d.__window.arkoseEnforcement=g};var c=document.createElement("script");c.src=this.__urlManager.get(e);c.dataset.callback="setupArkoseEnforcement";document.head.append(c)},setConfig:function(d){this.__captchaEnforcement.setConfig(d)},getConfig:function(){return this.__captchaEnforcement.getConfig()},getOnReadyPromise:function(){return this.__onReadyPromise},run:function(){this.__captchaEnforcement.run()},reset:function(){this.__captchaEnforcement.reset()},__getCaptchaApiPromise:function(){var d=this;return new this.__Promise(function(e){if(d.__window.arkoseEnforcement)e.resolve(d.__window.arkoseEnforcement);else var c=d.__timer.getTime(),g=d.__timer.setInterval(function(){d.__window.arkoseEnforcement?(d.__timer.clearInterval(g),e.resolve(d.__window.arkoseEnforcement)):3e4<=d.__timer.getTime()-c&&!d.__window.arkoseEnforcement&&(d.__timer.clearInterval(g),e.reject(Error("Arkose Captcha script import took too long or does not exist")))},1e3)})}},Backbone.Events),{canShowCaptcha:function(d){return d?d.get("showFuncaptcha"):!1}})}({UiCore:m["@UiCore"]}),Ib=function(k){return IMVU.BaseClass.extend("InventoryManager",{dependencies:"ftuxState Promise random rest restModelFactory startupModel window".split(" "),initialize:function(b){this.__Promise=b.Promise;this.__rest=b.rest;this.__restModelFactory=b.restModelFactory;this.__startupModel=b.startupModel;this.__ftuxState=b.ftuxState;this.__random=b.random;this.__window=b.window;this.__ftuxState.on("setGender",this.__fetchProducts,this);this.__fetchProducts()},__fetchProducts:function(){this.__gender=this.__ftuxState.getGender();this.__productCollectionResolver=void 0;this.__productCollectionPromise=new this.__Promise(function(b){this.__productCollectionResolver=b}.bind(this));this.__initialGenderProductsResolver=void 0;this.__initialGenderProductsPromise=new this.__Promise(function(b){this.__initialGenderProductsResolver=b}.bind(this));this.__ftuxModelResolver=void 0;this.__ftuxModelPromise=new this.__Promise(function(b){this.__ftuxModelResolver=b}.bind(this));this.__startupModel.populated().then(function(b){return b.getSingleEdge("dress_up_ftux").populated()}.bind(this)).then(function(b){this.__ftuxModelResolver.resolve(b);this.__collection=this.__restModelFactory.searchCollection(b.get("dress_up_reg"),{gender:this.__gender},k.UiCore.NodeCollection);this.__collection.populated().then(function(){this.__productCollectionResolver.resolve(this.__collection)}.bind(this)).catch(function(a){this.__window.console.error(a);this.__productCollectionResolver.reject()}.bind(this));this.genderInitialLookUrl=b.get(this.__gender+"_reg");this.__rest.get(this.genderInitialLookUrl).then(function(a){this.__initialGenderProductsResolver.resolve(a.response.products)}.bind(this)).catch(function(a){this.__window.console.error(a);this.__initialGenderProductsResolver.reject()}.bind(this))}.bind(this)).catch(function(b){this.__window.console.error(b);this.__ftuxModelResolver.reject()}.bind(this))},getProductCollectionPromise:function(){return this.__productCollectionPromise},getInitialGenderProductsPromise:function(){return this.__initialGenderProductsPromise},getFtuxModelPromise:function(){return this.__ftuxModelPromise},randomize:function(){var b,a=new this.__Promise(function(c){b=c}.bind(this)),d=[];"male"===this.__gender?d.push(191):d.push(80);var e={};this.__productCollectionPromise.then(function(c){c.each(function(g){g=this.__random.choice(g.get("items"));d.push(g.product_id)}.bind(this));c=this.__ftuxState.getEquippedItems();e.remove=_.difference(c,d);e.add=_.difference(d,c);e.add.push(13759128);b.resolve({randomizedProductIds:d,changes:e})}.bind(this)).catch(function(c){this.__window.console.error(c);b.reject()}.bind(this));return a}})}({UiCore:m["@UiCore"],FtuxState:Q}),Jb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class="undo-redo_menu">\n    <a href="javascript:;" class="undo-btn disabled" title="Undo">',f=(c=a.icon||b&&b.icon||d,c.call(b,"icon-undo",{name:"icon",hash:{},data:e}));if(f||0===f)g+=f;g+='</a>\n    <a href="javascript:;" class="redo-btn disabled" title="Redo">';if((f=(c=a.icon||b&&b.icon||d,c.call(b,"icon-redo",{name:"icon",hash:{},data:e})))||0===f)g+=f;g+='</a>\n</div>\n<div class="has-menu">\n    <nav class="magic-line-menu bar disable-text-selection">\n        <div class="product-category ftux-category-container center-nav-container">\n            <ul class="center-nav dna-categories">\n                <li data-category="hair">';if((f=(c=a.i18n||b&&b.i18n||d,c.call(b,"Hair",{name:"i18n",hash:{},data:e})))||0===f)g+=f;g+='</li>\n                <li data-category="facial_hair">';if((f=(c=a.i18n||b&&b.i18n||d,c.call(b,"Facial Hair",{name:"i18n",hash:{},data:e})))||0===f)g+=f;g+='</li>\n                <li data-category="eyes">';if((f=(c=a.i18n||b&&b.i18n||d,c.call(b,"Eyes",{name:"i18n",hash:{},data:e})))||0===f)g+=f;g+='</li>\n                <li data-category="heads">';if((f=(c=a.i18n||b&&b.i18n||d,c.call(b,"Heads",{name:"i18n",hash:{},data:e})))||0===f)g+=f;g+='</li>\n                <li data-category="skins">';if((f=(c=a.i18n||b&&b.i18n||d,c.call(b,"Skins",{name:"i18n",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            </ul>\n            <ul class="center-nav clothing-categories hidden">\n                <li data-category="tops">';if((f=(c=a.i18n||b&&b.i18n||d,c.call(b,"Tops",{name:"i18n",hash:{},data:e})))||0===f)g+=f;g+='</li>\n                <li data-category="bottoms">';if((f=(c=a.i18n||b&&b.i18n||d,c.call(b,"Bottoms",{name:"i18n",hash:{},data:e})))||0===f)g+=f;g+='</li>\n                <li data-category="shoes">';if((f=(c=a.i18n||b&&b.i18n||d,c.call(b,"Shoes",{name:"i18n",hash:{},data:e})))||0===f)g+=f;g+='</li>\n                <li data-category="accessories">';if((f=(c=a.i18n||b&&b.i18n||d,c.call(b,"Accessories",{name:"i18n",hash:{},data:e})))||0===f)g+=f;g+='</li>\n            </ul>\n            <div class="magic-line"></div>\n        </div>\n        <div class="ftux-category-simple-scroller-placeholder"></div>\n    </nav>\n\n    <div class="ftux-product ftux-product-list">\n        <section class="is-list">\n            <article class="tile product-tile template"><img src></article>\n        </section>\n    </div>\n\n</div>\n\n\n<div class="ftux-footer">\n    <button class="btn btn-primary btn-select-clothing">';if((f=(c=a.i18n||b&&b.i18n||d,c.call(b,"select_clothing",{name:"i18n",hash:{},data:e})))||0===f)g+=f;g+='</button>\n    <button class="btn btn-primary complete-avatar hidden">';if((f=(c=a.i18n||b&&b.i18n||d,c.call(b,"save_this_look",{name:"i18n",hash:{},data:e})))||0===f)g+=f;return g+"</button>\n</div>"},useData:!0})}({}),Kb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){return'<div class="slidein-body">\n    <div class="slidein-main"></div>\n</div>\n'},useData:!0})}({}),X=function(k){var b=k.UiCore.UiContext;return b.extend("SlideIn",{uiContextName:"slidein",className:"slidein",dependencies:["featureAccessManager","mode"],trackedEvents:function(){return[]},initialize:function(a){b.prototype.initialize.call(this,a);this.__whichSide=IMVU.optionalProperty(a,"whichSide","right");this.$el.addClass(this.__whichSide);this.addToDOM()},render:function(){this.$el.html(k.template({whichSide:this.__whichSide}));this.renderBody(this.$(".slidein-main"))},toggle:function(){this.$el.hasClass("shown")?this.hide():this.show();this.trigger("toggle")},show:function(a){!0===a&&this.$(".slidein-body").addClass("no-animation");this.$el.hasClass("shown")||((a=this.__mode.getCurrentSubmode())&&a.hideSlideInsOnSide(this.__whichSide),this.$(".slidein-body").removeClass("side-slide-out"),this.$(".slidein-body").addClass("side-slide-in"),this.$el.addClass("shown"),a&&a.trigger("slidein:show"),this.trigger("show"))},hide:function(a){this.$el.hasClass("shown")&&(a&&this.$(".slidein-body").addClass("no-animation"),this.$(".slidein-body").removeClass("side-slide-in"),this.$(".slidein-body").addClass("side-slide-out"),this.$el.removeClass("shown"),(a=this.__mode.getCurrentSubmode())&&a.trigger("slidein:hide"),this.trigger("hide"))}})}({UiCore:m["@UiCore"],template:Kb}),Lb=function(k){var b=k.SlideIn;return b.extend("FtuxProductSlideIn",{uiContextName:"ftux_product_slidein",className:"slidein ftux-product-slidein light-theme",dependencies:"appMonitor featureAccessManager ftuxState globalNav googleAnalytics imageManager inventoryManager mode restModelFactory startupModel stringManager timer undoRedo window".split(" "),trackedEvents:function(){return b.prototype.trackedEvents.call(this).concat([{type:"click",selector:".product-category li",name:"change_category",handler:this.__onChangeBodyCategory},{type:"click",selector:".ftux-product article",name:"toggle_product",handler:this.__toggleProduct},{type:"click",selector:".btn-select-clothing",name:"select_clothing",handler:this.showClothingProducts},{type:"click",selector:".complete-avatar",name:"complete_avatar",handler:this.__onClickCompleteAvatar},{type:"click",selector:".undo-btn",name:"undo",handler:this.__undo},{type:"click",selector:".redo-btn",name:"redo",handler:this.__redo}])},initialize:function(a){this.__totalMedias=this.__loadedMedias=0;this.__initialDefaultProducts=[];this.__timer=a.timer;this.__inventoryManager=a.inventoryManager;this.__step=a.step;this.__landedOnClothing="clothing"===this.__step?!0:!1;b.prototype.initialize.call(this,a);this.el.dataset.lock=0;this.refreshUndoRedo();this.listenTo(this.__undoRedo,"change add remove",this.refreshUndoRedo)},delete:function(){b.prototype.delete.call(this);_.each(this.__initialDefaultProducts,function(a){a.find("img").off("load")})},renderBody:function(a){a.html(k.template({}));this.$productTileTemplate=this.$("article.template");this.$productTileTemplate.remove()},show:function(a){b.prototype.show.call(this,a);this.__lastGender=this.__ftuxState.getGender();this.__inventoryManager.getFtuxModelPromise().then(function(d){this.trigger("show:scene",d);return this.__inventoryManager.getProductCollectionPromise()}.bind(this)).then(function(d){this.__collection=d;return this.__inventoryManager.getInitialGenderProductsPromise()}.bind(this)).then(function(d){this.__ftuxState.isNothingEquipped()&&this.__ftuxState.createEquippedItemIds(d);this.$el.parents(".slide-in").attr("data-gender",this.__lastGender);this.__landedOnClothing?(this.showClothingProducts(),this.__landedOnClothing=!1):this.showDnaProducts();this.__isInitialDefaultProducts=!0;this.__scrollerRefreshScrollability();this.__isInitialDefaultProducts=!1}.bind(this)).catch(function(d){this.__window.console.error(d)}.bind(this))},hide:function(){b.prototype.hide.call(this,!1)},setupScroller:function(){this.__categoryScroller?this.__categoryScroller.resetPosition():this.__categoryScroller=this.createChildContext(k.SimpleScroller,{$replaceElement:this.$(".ftux-category-simple-scroller-placeholder"),$target:this.$(".ftux-category-container.center-nav-container")})},getProductImageUrl:function(a){var d=a.swatch_image;d||(d=a.preview_image+"?width=150&height=150");return d},disableProductEquip:function(){this.$("section article").addClass("disabled")},enableProductEquip:function(){this.$("section article").removeClass("disabled");++this.el.dataset.lock},refreshUndoRedo:function(){this.$(".undo-btn").toggleClass("disabled",!this.__undoRedo.get("canUndo"));this.$(".redo-btn").toggleClass("disabled",!this.__undoRedo.get("canRedo"))},__undo:function(){this.__googleAnalytics.recordClick("ftux_productSlidein","undo");this.trigger("undo:look")},__redo:function(){this.__googleAnalytics.recordClick("ftux_productSlidein","redo");this.trigger("redo:look")},__showBodyCategory:function(a){this.__bodyCategory=a;var d=this.$('.product-category li[data-category="'+a+'"]');k.NextUtil.DomHelper.radioClass(d,"active");this.$(".magic-line").css({"margin-left":d.position().left+"px",width:d.outerWidth()});this.__populateCarousel(a);this.$(".ftux-product-list").scrollbar().scrollTop(0);this.__2dAvatar&&this.trigger("change:2dAvatar",a);this.trigger("show:body",a)},__scrollerRefreshScrollability:function(){this.__categoryScroller&&this.__categoryScroller.refreshScrollability()},__onChangeBodyCategory:function(a){this.__showBodyCategory($(a.currentTarget).attr("data-category"))},__populateProductTile:function(a){var d=this.$productTileTemplate.clone();d.removeClass("template");d.toggleClass("added",_.contains(this.__ftuxState.getEquippedItems(),a.product_id));d.attr("data-pid",a.product_id);this.__isInitialDefaultProducts&&(this.__initialDefaultProducts.push(d),d.find("img").on("load",function(){this.__mediaLoaded()}.bind(this)));this.__imageManager.load(d.find("img"),this.getProductImageUrl(a),{container:d});this.$(".ftux-product section").append(d)},__populateProductTileList:function(a){_.each(a,function(d){this.__populateProductTile(d)}.bind(this));this.$(".ftux-product-list").scrollbar();++this.el.dataset.lock},__populateCarousel:function(a){this.$(".ftux-product section").html("");this.__collection.each(function(d){d.get("name")===a&&(this.__isInitialDefaultProducts&&(this.__totalMedias=d.get("items").length+1,this.__totalMedias===this.__loadedMedias&&this.__onFinishedLoading()),this.__populateProductTileList(d.get("items")))}.bind(this))},__toggleProduct:function(a){a=$(a.currentTarget);var d=this.__bodyCategory,e=a.attr("data-pid"),c={};"accessories"!==d&&"facial_hair"!==d&&a.hasClass("added")||a.hasClass("disabled")||(this.disableProductEquip(),"accessories"===d?(a.toggleClass("added"),a.hasClass("added")?c.add=e:c.remove=e):"facial_hair"===d?a.hasClass("added")?(c.remove=e,a.removeClass("added")):(c.add=e,k.NextUtil.DomHelper.radioClass(a,"added")):(k.NextUtil.DomHelper.radioClass(a,"added"),c.add=e),this.trigger("change:look",c))},showDnaProducts:function(){this.__inventoryManager.getProductCollectionPromise().then(function(){this.__inventoryManager.getInitialGenderProductsPromise().then(function(){this.__collection&&this.__collection.length&&(this.$(".dna-categories").removeClass("hidden"),this.$(".clothing-categories").addClass("hidden"),this.$(".btn-select-clothing").removeClass("hidden"),this.$(".complete-avatar").addClass("hidden"),this.__showBodyCategory("hair"),this.setupScroller())}.bind(this)).catch(function(a){this.__window.console.error(a)}.bind(this))}.bind(this)).catch(function(a){this.__window.console.error(a)}.bind(this))},showClothingProducts:function(){this.__inventoryManager.getProductCollectionPromise().then(function(){this.__inventoryManager.getInitialGenderProductsPromise().then(function(){this.__collection&&this.__collection.length&&(this.trigger("show:clothing"),this.$(".dna-categories").addClass("hidden"),this.$(".clothing-categories").removeClass("hidden"),this.$(".btn-select-clothing").addClass("hidden"),this.$(".complete-avatar").removeClass("hidden"),this.__showBodyCategory("tops"),this.setupScroller())}.bind(this)).catch(function(a){this.__window.console.error(a)}.bind(this))}.bind(this)).catch(function(a){this.__window.console.error(a)}.bind(this))},markEquippedProducts:function(a){this.$("article.product-tile").toggleClass("added",!1);a.forEach(function(d){this.$('article.product-tile[data-pid="'+d+'"]').toggleClass("added",!0)}.bind(this))},__onClickCompleteAvatar:function(){this.__globalNav.setText(this.__stringManager.get("save_this_look_nav"));this.hide();this.__slideOuttime=this.__timer.setTimeout(function(){this.trigger("show:body","tops");this.trigger("show:registration")}.bind(this),300);if("creatorlanding"===this.__serviceProvider.get("modeManager").uiApplication)try{this.__window.pintrk("track","signup",{lead_type:"click_create_account"})}catch(a){this.__appMonitor.reportCustomError("FtuxProductSlideIn","__onClickCompleteAvatar","web_perm_0005g","Error thrown in call to window.pintrk",["Reported Error: "+a.message])}}})}({NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],SimpleScroller:R,SlideIn:X,template:Jb}),Mb=function(k){k={yawRate:15,zoomRate:10};return{dressUp:{zoomDistanceMin:2,zoomDistanceMax:10,zoomInitial:5,zoomSensitivity:{mousemove:.2,mousewheel:-.05},zoomRate:k.zoomRate,lookAtHeightNearHeadOffset:0,camHeightFar:.9,pathSegments:[[3,8,.05,.003],[3,9,.1,.007],[null,11,.2,.01]],pitch:8,yawRate:k.yawRate,panSensitivity:{x:0,y:1},headInterpolate:{horzRatio:.3,vertRatio:.3}},room:{zoomDistanceMin:.1,firstPersonViewSwitchDistance:1.6,zoomDistanceMax:100,zoomInitial:5,zoomSensitivity:{mousemove:.2,mousewheel:-.01},zoomRate:k.zoomRate,lookAtHeightNearHeadOffset:.17,camHeightFar:2,pathSegments:[[1,-2,.1,.001],[.7,0,.02,.001],[3,6,.2,.002],[4,8,.5,.005],[7,9,1,.008],[15,10,2,.015],[40,11,3,.02],[null,10,4,.07]],pitch:10,yawRate:k.yawRate,panSensitivity:{x:1,y:1},headInterpolate:{horzRatio:.14,vertRatio:.08}},universal:k}}({}),Nb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){return"ftux-registration-form--onboarding"},3:function(b,a,d,e){return'\n            <div class="ftux-wallet">\n                <div class="coin-animation-placeholder"></div>\n                <div class="ftux-wallet__text">0</div>\n            </div>\n            '},5:function(b,a,d,e){var c,g=a.helperMissing;d="\n            ";if((a=(c=a.icon||b&&b.icon||g,c.call(b,"icon-checkmark",{name:"icon",hash:{class:"checkmark"},data:e})))||0===a)d+=a;return d+"\n            "},7:function(b,a,d,e){var c,g=a.helperMissing;d="\n                ";if((a=(c=a.icon||b&&b.icon||g,c.call(b,"icon-checkmark",{name:"icon",hash:{class:"checkmark"},data:e})))||0===a)d+=a;return d+"\n                "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c,g=a.helperMissing,f='<div class="ftux-registration-form ',h=a["if"].call(b,b&&b.showOnboarding,{name:"if",hash:{},fn:this.program(1,e),inverse:this.noop,data:e});if(h||0===h)f+=h;f+='">\n    <form method="GET" action="#" accept-charset="utf-8">\n        <div class="avatar-name-container">\n            <div class="avatar">\n                <img src="" />\n            </div>\n            <h2 class="welcome">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"signup_welcome_to_imvu",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</h2>\n            <div class="label signup_avatarname" data-holder="';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"signup_dialog_avatar_name_placeholder",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='">\n                <label class="avatar-name">\n                    <input type="text" name="signup_avatarname" placeholder="';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"signup_dialog_avatar_name_placeholder",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='" autocapitalize="none" autocorrect="off" autocomplete="off" spellcheck="false" max="20" maxlength="20" min="1"/>\n                </label>\n            </div>\n            ';if((h=a["if"].call(b,b&&b.showOnboarding,{name:"if",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n        </div>\n        <div class="label signup_displayname" data-holder="';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"signup_dialog_display_name_cover",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='">\n            <input class="signup_displayname_input" tabindex="1" type="text" name="signup_displayname" placeholder="';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"signup_dialog_display_name_cover",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='" autocapitalize="none" autocorrect="off" autocomplete="off" spellcheck="false" max="30" maxlength="30" min="3"/>\n            ';if((h=a["if"].call(b,b&&b.showOnboarding,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n        </div>\n        <div class="label signup_email" data-holder="';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"signup_dialog_email_cover",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='">\n            <input class="signup_email_input" tabindex="2" type="email" name="signup_email" placeholder="';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"signup_dialog_email_cover",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='" autocapitalize="none" autocorrect="off" spellcheck="false" autocomplete="off" />\n            ';if((h=a["if"].call(b,b&&b.showOnboarding,{name:"if",hash:{},fn:this.program(5,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n        </div>\n\n        <fake_fields>\n            \x3c!-- fake fields are a workaround for chrome autofill getting the wrong fields --\x3e\n            <input type="text" name="fakeusernameremembered"  autocomplete="off" />\n            <input type="password" name="fakepasswordremembered"/>\n        </fake_fields>\n\n        <div class="label signup_password" data-holder="';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"signup_dialog_email_password",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='">\n            ';if((h=this.invokePartial(d.InputMixinHolderLabel,"InputMixinHolderLabel",b,{content:b&&b.passwordTooltipContent},a,d,e))||0===h)f+=h;f+='\n            <div style="position:relative">\n                <input tabindex="3" type="password" name="signup_password" placeholder="';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"signup_dialog_email_password",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='" min="6" />\n                <div class="toggle-password-visibility icon icon-password-show"></div>\n                ';if((h=a["if"].call(b,b&&b.showOnboarding,{name:"if",hash:{},fn:this.program(7,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n            </div>\n        </div>\n        <div class="label signup_dob" data-dropdown data-holder="';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"signup_dialog_birthday_cover",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='">\n            ';if((h=this.invokePartial(d.InputMixinHolderLabel,"InputMixinHolderLabel",b,{content:b&&b.dobTooltipContent,defaultLabel:b&&b.dobDefaultLabel},a,d,e))||0===h)f+=h;f+='\n            <div class="date-picker"></div>\n        </div>\n\n        <div class=\'funcaptcha-wrapper\'>\n        </div>\n\n        <div class="error-message-container">\n            <div class="error-message error-message-left funcaptcha">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"signup_dialog_error_funcaptcha",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message error-message-left unknown">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"signup_dialog_error_unknown",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n            <div class="error-message error-message-left underage">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"signup_dialog_error_underage",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</div>\n        </div>\n    </form>\n</div>\n\n<footer class="ftux-reg-footer">\n    <button disabled id="registration-submit" class="btn btn-primary submit">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"signup_slidein_submit_button_ftux",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+='</button>\n    <p class="tos small-tos">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"register_TOS",{name:"i18n-g",hash:{arbitrationTag:'<a href="https://secure.imvu.com/next/policyhub/termsofservice#arbitrationagreement" target="_blank">',linkEndTag:"</a>",privacyStartTag:'<a data-external href="https://secure.imvu.com/next/policyhub/privacypolicy/" target="_blank">',termsStartTag:'<a class="reg-tos" data-external href="https://secure.imvu.com/next/policyhub/" target="_blank">'},data:e})))||0===h)f+=h;return f+"</p>\n</footer>\n"},usePartial:!0,useData:!0})}({}),Ob=function(k){function b(a){return 26>a?a+65:52>a?a+71:62>a?a-4:62===a?43:63===a?47:65}return{decode:function(a,d){a=a.replace(/[^A-Za-z0-9\+\/]/g,"");var e=a.length;d=d?Math.ceil((3*e+1>>2)/d)*d:3*e+1>>2;for(var c=new Uint8Array(d),g,f=0,h=0,l=0;l<e;l++){g=l&3;var n=a.charCodeAt(l);f|=(64<n&&91>n?n-65:96<n&&123>n?n-71:47<n&&58>n?n+4:43===n?62:47===n?63:0)<<18-6*g;if(3===g||1===e-l){for(g=0;3>g&&h<d;g++,h++)c[h]=f>>>(16>>>g&24)&255;f=0}}return c},encode:function(a){for(var d=2,e="",c=a.length,g=0,f=0;f<c;f++)if(d=f%3,0<f&&0===4*f/3%76&&(e+="\r\n"),g|=a[f]<<(16>>>d&24),2===d||1===a.length-f)e+=String.fromCharCode(b(g>>>18&63),b(g>>>12&63),b(g>>>6&63),b(g&63)),g=0;return e.substr(0,e.length-2+d)+(2===d?"":1===d?"=":"==")}}}({}),Pb=function(k){function b(e){return void 0!==e?decodeURIComponent(e.replace(/\+/g,"%20")):""}function a(e){var c={};0<e.length&&(e=e.substring(1),e=e.split("&"),_.each(e,function(g){var f=g.split("=");g=b(f[0]);f=b(f[1]);if(d.test(g))if(d.exec(g)[1]){var h=g.replace(d,"");h in c||(c[h]={});c[h][d.exec(g)[1]]=f}else g=g.replace(d,""),g in c||(c[g]=[]),c[g].push(f);else c[g]=f}));return c}var d=/\[(.*?)\]/;return{fetch:function(e,c){var g=a(e.location.search),f=_.pick(g,c);c=_.omit(g,c);g=e.location.pathname;_.size(c)&&(g+="?"+$.param(c));e.history.replaceState(e.history.state,document.title,g);return f},get:function(e,c){return a(e.location.search)[c]},getAllParams:a}}({}),Qb=function(k){function b(a,d){d=k.Base64.decode(d);for(var e=k.Base64.decode("V25kKzVxQS81SSE+M3VCfnkjO300WlFHWTZQQXtWLiUlJChFMnUsdg=="),c=new Uint8Array(d.length+e.length),g=0;g<d.length;++g)c[g]=d[g];for(g=0;g<e.length;++g)c[d.length+g]=e[g];d=k.Base64.encode(c);return new a(d,"B64").getHash("SHA-512","B64")}return IMVU.BaseClass.extend("RegistrationManager",{dependencies:"campaign globalStartupModel localStorage loginManager Promise registrationFlow rest root Sha512".split(" "),initialize:function(a){this.__Promise=a.Promise;this.__rest=a.rest;this.__localStorage=a.localStorage;this.__challengeUrl=a.root+"/challenge";this.__accountUrl=a.root+"/"+(null!==this.__localStorage.getItem("accountEndpoint")?this.__localStorage.getItem("accountEndpoint"):"account");this.__validateUrl=a.root+"/validate_account";this.__suggestedAvatarnameUrl=a.root+"/generated_avatarname";this.__globalStartupModel=a.globalStartupModel;this.__sha512=a.Sha512;this.__registrationFlow=a.registrationFlow;this.__serviceProvider=new k.UiCore.ServiceProvider;this.__window=this.__serviceProvider.get("window");this.__setCab(this.__window.location.search,a);this.__loginManager=a.loginManager;this.__socialLogin=this.__loginManager.getSocialLogin()},__setCab:function(a,d){a=k.QueryParams.getAllParams(a);var e=[];void 0!==a.affid&&e.push(a.affid);void 0!==a.subid1&&e.push(a.subid1);void 0!==a.subid2&&e.push(a.subid2);0===e.length&&""!==d.campaign&&e.push(d.campaign);this.customers_acquired_by=e.join("_")},getChallenge:function(){return this.__rest.post(this.__challengeUrl,{type:"alloy"}).then(function(a){return this.__Promise.resolve(a.response.data.challenge)}.bind(this))},register:function(a,d){var e=this,c=IMVU.requireProperty(d,"dob"),g=IMVU.requireProperty(d,"fc_token"),f=IMVU.requireProperty(d,"locale"),h={avatarname:IMVU.requireProperty(d,"avatarname"),device_id:IMVU.requireProperty(d,"device_id"),email:IMVU.requireProperty(d,"email"),location:{country:"US",region:""},profile_info:{dob:c.toISOString()},reg_token:{challenge:a,response:b(this.__sha512,a),type:"alloy"},customers_acquired_by:this.customers_acquired_by,fc_token:g,registration_flow:this.__registrationFlow};if(a=IMVU.optionalProperty(d,"experiment"))h.experiment_pick={experiment_name:a.name,branch_name:a.branch};return this.__socialLogin.getAuth().then(function(){e.__socialLogin.isLoggedIn()||null!==e.__socialLogin.getAppleRefreshToken()?h.social_registration=IMVU.requireProperty(d,"social_registration"):h.password=IMVU.requireProperty(d,"password");var l=d.displayname;l&&(h.display_name=l);d.pids&&0<d.pids.length&&(h.products=d.pids.map(function(n){return n+""}));return e.__rest.post(e.__accountUrl,h,{headers:{"Accept-Language":f}}).catch(function(n){return this.__Promise.reject(n.error)}.bind(e))})},validate:function(a){return this.__rest.post(this.__validateUrl,a).then(function(d){return this.__Promise.resolve(d.response.data)}.bind(this))},getSuggestedAvatarname:function(a){var d=IMVU.requireProperty(a,"displayname");a=IMVU.requireProperty(a,"email");return this.__rest.get(this.__buildSuggestedAvatarnameUrl(d,a)).then(function(e){return this.__Promise.resolve(e.response.data)}.bind(this))},__buildSuggestedAvatarnameUrl:function(a,d){return this.__suggestedAvatarnameUrl+"?display_name="+encodeURIComponent(a)+"&email_address="+encodeURIComponent(d)}})}({UiCore:m["@UiCore"],Base64:Ob,QueryParams:Pb}),Rb=function(k){return IMVU.BaseClass.extend("AvatarName",{dependencies:["Promise","restModelFactory","root"],initialize:function(b){this.__url=b.root+"/avatar_name";this.__restModelFactory=b.restModelFactory;this.__Promise=b.Promise},getAvailable:function(b){var a=this.__restModelFactory.searchCollection(this.__url,{avatar:b},k.UiCore.NodeCollection);return a.populated().then(function(){return 1===a.length&&a.at(0).get("avatar")===b?this.__Promise.resolve({available:!0,suggestions:[]}):this.__Promise.resolve({available:!1,suggestions:a.pluck("avatar")})}.bind(this),function(){return this.__Promise.reject({error:!0})}.bind(this))}})}({UiCore:m["@UiCore"]}),Sb=function(){return{dependencies:["appMonitor","globalStartupModel"],processArgs:function(k){"undefined"!==typeof k&&(this.__serviceProvider="undefined"!==typeof k.serviceProvider?k.serviceProvider:null,this.__globalStartupModel=null!==this.__serviceProvider?this.__serviceProvider.get("globalStartupModel"):null,this.__window="undefined"!==typeof k.window?k.window:null)},showRegistrationPixel:function(k){try{this.processArgs(k);var b=document.createElement("iframe");b.classList.add("SL_norewrite");b.setAttribute("id","registration_pixel");b.setAttribute("style","position:absolute;top:0;left:0;pointer-events:none;visiblity:hidden");b.setAttribute("width",1);b.setAttribute("height",1);b.setAttribute("frameborder",0);b.setAttribute("src",this.__globalStartupModel.get("baseHostURI")+"/pixel_iframe.php?location=registration");document.body.appendChild(b)}catch(a){this.__appMonitor.reportCustomError("TrackingPixel","showRegistrationPixel","web_perm_0006a","Error thrown in call to showRegistrationPixel",["Reported Error: "+a.message])}},showSignupPixel:function(k){try{this.processArgs(k);var b=document.createElement("iframe");b.classList.add("SL_norewrite");b.setAttribute("id","registration_pixel");b.setAttribute("style","position:absolute;top:0;left:0;pointer-events:none;visiblity:hidden");b.setAttribute("width",1);b.setAttribute("height",1);b.setAttribute("frameborder",0);b.setAttribute("src",this.__globalStartupModel.get("baseHostURI")+"/pixel_iframe.php?location=signup");document.body.appendChild(b)}catch(a){this.__appMonitor.reportCustomError("TrackingPixel","showSignupPixel","web_perm_0006b","Error thrown in call to showSignupPixel",["Reported Error: "+a.message])}}}}({}),Tb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g="<div class='id-dob-tooltip tooltip-target icon icon-tooltip-icon'></div>\n<div class='tooltip-content'>\n    <div class=\"tooltip-header\">",f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"signup_dialog_dob_tooltip_title",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='</div>\n    <div class="tooltip-body">\n        <div>';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"signup_dialog_dob_tooltip_text",{name:"i18n-g",hash:{privacy_policy_link:b&&b.privacy_policy_link},data:e})))||0===f)g+=f;return g+"</div>\n    </div>\n</div>\n"},useData:!0})}({}),Ub=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=a.helperMissing;var g='<div class=\'id-password-tooltip tooltip-target icon icon-tooltip-icon\'></div>\n<div class="password-requirement-tooltip tooltip-content">\n    <div class="tooltip-header">',f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"Password Tips",{name:"i18n-g",hash:{},data:e}));if(f||0===f)g+=f;g+='</div>\n    <div class="tooltip-body">\n        <div>';if((f=(c=a["i18n-g"]||b&&b["i18n-g"]||d,c.call(b,"password_requirement",{name:"i18n-g",hash:{},data:e})))||0===f)g+=f;return g+"</div>\n    </div>\n</div>\n"},useData:!0})}({}),Vb=function(k){var b=IMVU.NamedModel;return b.extend("RegisterModeModel",{dependencies:"cookieManager featureAccessManager leanplum localStorage loginManager passwordStrength Promise timer window".split(" "),initialize:function(a){b.prototype.initialize.call(this,{});this.__serviceProvider=a.serviceProvider;this.__Promise=a.Promise;this.__timer=a.timer;this.__registrationManager=a.registrationManager;this.__passwordStrength=a.passwordStrength;this.__leanplum=a.leanplum;this.__localStorage=a.localStorage;this.__loginManager=a.loginManager;this.__cookieManager=a.cookieManager;this.useSuggestedAvatarname=!0;this.__generateAvatarnameDelay=500;this.__prefsManager=IMVU.optionalProperty(a,"prefsManager",k.PrefsManager);this.__window=a.window;this.__featureAccessManager=a.featureAccessManager;this.set({avatarname:"",displayname:"",email:"",password:"",dob:null,pids:[]});this.validity=new Backbone.Model({avatarname:"pending",displayname:"pending",email:"pending",password:"pending",dob:"pending",fc_token:k.CaptchaManager.canShowCaptcha(this.__serviceProvider)?"pending":"valid"});this.error=new Backbone.Model({avatarname_invalid:!1,avatarname_taken:!1,displayname_invalid:!1,challenge:!1,dob_invalid:!1,email_invalid:!1,email_taken:!1,email_banned:!1,email_imvu:!1,login:!1,password_fair:!1,password_too_long:!1,password_too_short:!1,password_weak:!1,fc_token_invalid:!1,unknown:!1});this.errorMessage=new Backbone.Model({displayname_invalid:""});this.state=new Backbone.Model({form:"invalid"});this.listenTo(this,"change:avatarname",this.__checkAvatarname.bind(this));this.listenTo(this,"change:displayname",this.__checkDisplayname.bind(this));this.listenTo(this,"change:email",this.__checkEmail.bind(this));this.listenTo(this,"change:password",this.__checkPasswordStrength.bind(this));this.listenTo(this,"change:dob",this.__checkDob.bind(this));this.listenTo(this.validity,"change",this.__updateValidity.bind(this));this.__socialLogin=this.__loginManager.getSocialLogin()},submitRegistration:function(){this.state.set({form:"loading"});return new this.__Promise(function(a){if(!this.__checkAge(this.get("dob")))return a.reject({temporary:!1,type:"dob_invalid"});this.__registrationManager.getChallenge().catch(function(){a.reject({temporary:!0,type:"challenge"});return this.__Promise.reject()}.bind(this)).then(function(d){var e=this.get("fc_token"),c="";c=this.__featureAccessManager.isElectronClient()?this.__localStorage.getItem("lang"):this.__cookieManager.get("saved_locale");e={avatarname:this.get("avatarname"),displayname:this.get("displayname"),email:this.get("email"),device_id:"",dob:this.get("dob"),pids:this.get("pids"),fc_token:e,locale:c};this.get("experiment")&&(e.experiment=this.get("experiment"));this.__socialLogin.isLoggedIn()?e.social_registration={platform:this.__socialLogin.getPlatform(),platform_token:this.__socialLogin.getAccessToken(),platform_uid:this.__socialLogin.getProfileItem("id")}:null!==this.__socialLogin.getAppleRefreshToken()?e.social_registration={platform:this.__socialLogin.getPlatform(),platform_token:this.__socialLogin.getAppleRefreshToken(),platform_uid:this.__socialLogin.getAppleUserId()}:e.password=this.get("password");return this.__registrationManager.register(d,e).catch(function(g){if(g){var f={"ERROR_ACCOUNT-2":"challenge_error","ERROR_ACCOUNT-3":"avatarname_invalid","ERROR_ACCOUNT-4":"avatarname_taken","ERROR_ACCOUNT-5":"email_invalid","ERROR_ACCOUNT-6":"email_taken","ERROR_ACCOUNT-7":"birthday_error","ERROR_ACCOUNT-8":"fc_token_invalid","ERROR_ACCOUNT-9":"display_name_blank","ERROR_ACCOUNT-10":"display_name_invalid_string","ERROR_ACCOUNT-11":"display_name_invalid_length","ERROR_ACCOUNT-12":"display_name_inappropriate","ERROR_ACCOUNT-13":"display_name_inappropriate","ERROR_ACCOUNT-14":"display_name_wrapping_spaces","ERROR_ACCOUNT-15":"display_name_at_sign","ERROR_ACCOUNT-16":"display_name_persona","ERROR_ACCOUNT-17":"display_name_multiple_spaces","ERROR_ACCOUNT-18":"fun_captcha_answer_wrong","ERROR_ACCOUNT-22":"social_credentials_already_in_use"}[g.error]||"unknown";a.reject({temporary:"unknown"===f,type:f,code:g.error})}return this.__Promise.reject(g)}.bind(this))}.bind(this)).then(function(d){d={username:this.get("avatarname")||d.response.data.avatarname,password:this.get("password"),gdpr_cookie_acceptance:"true"===this.__cookieManager.get("accepted_all_cookies")?!0:!1};this.__socialLogin.isLoggedIn()?d={platform:this.__socialLogin.getPlatform(),platform_token:this.__socialLogin.getAccessToken(),platform_uid:this.__socialLogin.getProfileItem("id")}:null!==this.__socialLogin.getAppleRefreshToken()&&(d={platform:this.__socialLogin.getPlatform(),platform_token:this.__socialLogin.getAppleRefreshToken(),platform_uid:this.__socialLogin.getAppleUserId()});return this.__loginManager.performLoginFromCredentials(this.__serviceProvider,d).catch(function(){a.reject({temporary:!0,type:"login"});return this.__Promise.reject()}.bind(this))}.bind(this)).then(function(){this.__cookieManager.set("login_username",this.get("email"));this.__prefsManager=this.__serviceProvider.create(this.__prefsManager);this.__prefsManager.populated().then(function(){null!==this.__localStorage.getItem("__leanplum_device_id")?this.__prefsManager.set("next.leanplum_device_id",this.__localStorage.getItem("__leanplum_device_id")):this.__window.console.log("no __leanplum_device_id found");this.__prefsManager.setBool("next.should_show_sticky_daily_spin_toaster",!0)}.bind(this));a.resolve()}.bind(this))}.bind(this)).catch(function(a){var d={};d[a.type]=!0;this.error.set(d);this.state.set({form:a.temporary?"valid":"invalid"});"avatarname_invalid"===a.type||"avatarname_taken"===a.type?this.validity.set({avatarname:"invalid"}):"email_invalid"===a.type||"email_taken"===a.type||"email_banned"===a.type||"email_imvu"===a.type?this.validity.set({email:"invalid"}):"dob_invalid"===a.type?this.validity.set({dob:"invalid"}):("fc_token_invalid"===a.type||"fun_captcha_answer_wrong"===a.type)&&this.validity.set({fc_token:"invalid"});return this.__Promise.reject(a)}.bind(this))},__updateValidity:function(){this.state.set({form:this.__allDataValid()?"valid":"invalid"})},__allDataValid:function(){var a="valid"===this.validity.get("avatarname")&&"valid"===this.validity.get("displayname")&&"valid"===this.validity.get("email")&&"valid"===this.validity.get("dob")&&("pending"===this.validity.get("fc_token")||"valid"===this.validity.get("fc_token"));"undefined"===typeof this.__socialLogin||this.__socialLogin.isLoggedIn()||null!==this.__socialLogin.getAppleRefreshToken()||(a=a&&"valid"===this.validity.get("password"));return a},getDataForCaptcha:function(){var a=this;return new this.__Promise(function(d){return a.__allDataValid()?a.__registrationManager.validate({avatarname:a.get("avatarname"),display_name:a.get("displayname"),email_address:a.get("email"),dob:a.get("dob")}).then(function(e){return e.valid?(a.validity.set("arkoseData",e.arkose_data),d.resolve(e.arkose_data)):d.reject("Data was not valid to send to captcha")}):d.reject("Data was not valid to send to captcha")})},__checkAvatarname:function(){this.error.set({avatarname_taken:!1,avatarname_invalid:!1});if(this.useSuggestedAvatarname)this.validity.set({avatarname:"valid"});else{var a=this.get("avatarname");""===a?this.validity.set({avatarname:"pending"}):3>a.length||20<a.length||!/^[a-z0-9]*$/i.test(a)?(this.validity.set({avatarname:"invalid"}),this.error.set({avatarname_taken:!1,avatarname_invalid:!0})):(this.validity.set({avatarname:"loading"}),this.__registrationManager.validate({avatarname:this.get("avatarname")}).then(function(d){d.valid?(this.validity.set({avatarname:"valid"}),this.error.set({avatarname_taken:!1,avatarname_invalid:!1})):"msg_avname_taken"===d.errors.avatarname.error_code?(this.validity.set({avatarname:"invalid"}),this.errorMessage.set({avatarname_invalid:d.errors.avatarname.error_message}),this.error.set({avatarname_taken:!0})):d.errors.avatarname.error_code&&(this.validity.set({avatarname:"invalid"}),this.errorMessage.set({avatarname_invalid:d.errors.avatarname.error_message}),this.error.set({avatarname_invalid:!0}))}.bind(this),function(d){this.validity.set({avatarname_invalid:!0})}.bind(this)))}},__checkDisplayname:function(){""===this.get("displayname")?(this.validity.set({displayname:"invalid"}),this.error.set({displayname_blank:!0})):(this.validity.set({avatarname:"valid"}),this.error.set({displayname_invalid:!1,displayname_blank:!1}),this.__registrationManager.validate({display_name:this.get("displayname")}).then(function(a){a.valid?(this.validity.set({displayname:"valid"}),this.error.set({displayname_invalid:!1}),this.__generateAvatarname()):a.errors.display_name.error_code&&(this.validity.set({displayname:"invalid"}),this.errorMessage.set({displayname_invalid:a.errors.display_name.error_message}),this.error.set({displayname_invalid:!0}))}.bind(this),function(a){this.validity.set({displayname_invalid:"invalid"})}.bind(this)))},__checkPasswordStrength:function(){var a=this.get("password"),d=this.get("avatarname");""===a?(this.validity.set({password:"pending"}),this.error.set({password_too_long:!1,password_too_short:!1,password_weak:!1,password_fair:!1})):(d=this.__passwordStrength.passwordStrength(a,d),"weak"===d&&a.length<this.__passwordStrength.passwordMinLength&&(d="too_short"),a.length>this.__passwordStrength.passwordMaxLength&&(d="too_long"),"good"===d||"strong"===d?(this.validity.set({password:"valid"}),this.error.set({password_too_long:!1,password_too_short:!1,password_weak:!1,password_fair:!1})):""!==d&&(this.validity.set({password:"invalid"}),"too_short"===d?this.error.set({password_too_long:!1,password_too_short:!0,password_weak:!1,password_fair:!1}):"too_long"===d?this.error.set({password_too_long:!0,password_too_short:!1,password_weak:!1,password_fair:!0}):"weak"!==d?this.error.set({password_too_long:!1,password_too_short:!1,password_weak:!1,password_fair:!0}):"fair"!==d&&this.error.set({password_too_long:!1,password_too_short:!1,password_weak:!0,password_fair:!1})))},__checkEmail:function(){var a=this.get("email");this.validity.set({email:"pending"});this.error.set({email_invalid:!1,email_taken:!1,email_banned:!1,email_imvu:!1});""!==a&&this.__registrationManager.validate({email_address:a}).then(function(d){d.valid?(this.validity.set({email:"valid"}),this.error.set({email_taken:!1,email_invalid:!1,email_banned:!1,email_imvu:!1}),this.__generateAvatarname()):"msg_invalid_email"===d.errors.email_address.error_code?(this.validity.set({email:"invalid"}),this.error.set({email_taken:!1,email_invalid:!0,email_banned:!1,email_imvu:!1})):"msg_email_exists"===d.errors.email_address.error_code?(this.validity.set({email:"invalid"}),this.error.set({email_taken:!0,email_invalid:!1,email_banned:!1,email_imvu:!1})):"msg_email_banned"===d.errors.email_address.error_code?(this.validity.set({email:"invalid"}),this.error.set({email_taken:!1,email_invalid:!1,email_banned:!0,email_imvu:!1})):"msg_imvu_email_external_ip"===d.errors.email_address.error_code&&(this.validity.set({email:"invalid"}),this.error.set({email_taken:!1,email_invalid:!1,email_banned:!1,email_imvu:!0}))}.bind(this),function(d){this.validity.set({email:"invalid"})}.bind(this))},__checkAge:function(a){var d=this.__timer.getDate();d=new Date(d.getFullYear(),d.getMonth(),d.getDate());d=new Date(d.getFullYear()-13,d.getMonth(),d.getDate(),d.getHours(),d.getMinutes(),d.getMilliseconds());return a<=d},__checkDob:function(){var a="pending",d=this.get("dob");null!==d&&(a=isNaN(d)||!this.__checkAge(d)?"invalid":"valid");this.validity.set({dob:a});this.error.set({dob_invalid:"invalid"===a})},__generateAvatarname:function(){"valid"===this.validity.get("displayname")&&"valid"===this.validity.get("email")&&this.useSuggestedAvatarname&&this.__registrationManager.getSuggestedAvatarname({displayname:this.get("displayname"),email:this.get("email")}).then(function(a){this.set("avatarname",a.generated_avatarname);this.trigger("generated:avatarname")}.bind(this))}})}({CaptchaManager:B,PrefsManager:V}),Wb=function(){var k=Handlebars.template;Handlebars.templates=Handlebars.templates||{};return k({1:function(b,a,d,e){var c;a=this.escapeExpression;return'\n    <option value="'+a((c=b&&b.value,"function"===typeof c?c.apply(b):c))+'">'+a((c=b&&b.label,"function"===typeof c?c.apply(b):c))+"</option>\n    "},3:function(b,a,d,e){a=this.escapeExpression;return'\n    <option value="'+a("function"===typeof b?b.apply(b):b)+'">'+a("function"===typeof b?b.apply(b):b)+"</option>\n    "},compiler:[5,">= 2.0.0"],main:function(b,a,d,e){var c;d=this.escapeExpression;var g=a.helperMissing,f='<div class="selector">\n    <select tabindex="'+d((c=a.tabIndex1||b&&b.tabIndex1,"function"===typeof c?c.call(b,{name:"tabIndex1",hash:{},data:e}):c))+'" class="date-picker-dropdown month">\n    <option selected value="">',h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"datepicker_unselected_month",{name:"i18n-g",hash:{},data:e}));if(h||0===h)f+=h;f+="</option>\n    ";if((h=a.each.call(b,b&&b.monthRange,{name:"each",hash:{},fn:this.program(1,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n    </select>\n</div>\n<div class="selector">\n    <select tabindex="'+d((c=a.tabIndex2||b&&b.tabIndex2,"function"===typeof c?c.call(b,{name:"tabIndex2",hash:{},data:e}):c))+'" class="date-picker-dropdown day">\n    <option selected value="">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"datepicker_unselected_day",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</option>\n    ";if((h=a.each.call(b,b&&b.dayRange,{name:"each",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===h)f+=h;f+='\n    </select>\n</div>\n<div class="selector">\n    <select tabindex="'+d((c=a.tabIndex3||b&&b.tabIndex3,"function"===typeof c?c.call(b,{name:"tabIndex3",hash:{},data:e}):c))+'" class="date-picker-dropdown year">\n    <option selected value="">';if((h=(c=a["i18n-g"]||b&&b["i18n-g"]||g,c.call(b,"datepicker_unselected_year",{name:"i18n-g",hash:{},data:e})))||0===h)f+=h;f+="</option>\n    ";if((h=a.each.call(b,b&&b.yearRange,{name:"each",hash:{},fn:this.program(3,e),inverse:this.noop,data:e}))||0===h)f+=h;return f+"\n    </select>\n</div>\n"},useData:!0})}({}),Xb=function(k){var b=k.UiCore.UiContext;return b.extend("DatePicker",{uiContextName:"date_picker",className:"date-picker",dependencies:["tabIndex"],trackedEvents:function(){return[{type:"change",name:"change_year",selector:".year select",handler:"__onChangeYear"},{type:"change",name:"change_month",selector:".month select",handler:"__onChangeMonth"},{type:"change",name:"change_day",selector:".day select",handler:"__onChangeDay"}]},initialize:function(a){this.__serviceProvider=a.serviceProvider;this.__globalStringManager=this.__serviceProvider.get("globalStringManager");this.__timer=this.__serviceProvider.get("timer");this.__now=this.__timer.getDate();this.__current=a.current||null;this.__tabIndex=a.tabIndex;b.prototype.initialize.call(this,a);this.addToDOM()},render:function(){this.__currentYear=this.year();this.__currentMonth=this.month();this.__currentDay=this.day();this.__yearRange=_.range(this.__now.getFullYear()-100,this.__now.getFullYear()+1).reverse();this.__monthRange=[{value:"1",label:this.__globalStringManager.get("datepicker_month_january")},{value:"2",label:this.__globalStringManager.get("datepicker_month_february")},{value:"3",label:this.__globalStringManager.get("datepicker_month_march")},{value:"4",label:this.__globalStringManager.get("datepicker_month_april")},{value:"5",label:this.__globalStringManager.get("datepicker_month_may")},{value:"6",label:this.__globalStringManager.get("datepicker_month_june")},{value:"7",label:this.__globalStringManager.get("datepicker_month_july")},{value:"8",label:this.__globalStringManager.get("datepicker_month_august")},{value:"9",label:this.__globalStringManager.get("datepicker_month_september")},{value:"10",label:this.__globalStringManager.get("datepicker_month_october")},{value:"11",label:this.__globalStringManager.get("datepicker_month_november")},{value:"12",label:this.__globalStringManager.get("datepicker_month_december")}];this.__dayRange=_.range(1,32);this.$el.html(k.template({currentYear:this.__currentYear,currentMonth:this.__currentMonth,currentDay:this.__currentDay,yearRange:this.__yearRange,monthRange:this.__monthRange,dayRange:this.__dayRange,tabIndex1:this.__tabIndex,tabIndex2:this.__tabIndex+1,tabIndex3:this.__tabIndex+2}));this.yearDropdown=this.createChildContext(k.Dropdown,{$replaceElement:this.$(".year")});this.monthDropdown=this.createChildContext(k.Dropdown,{$replaceElement:this.$(".month")});this.dayDropdown=this.createChildContext(k.Dropdown,{$replaceElement:this.$(".day")});$(".year .dropdown-label").addClass("noValue");$(".month .dropdown-label").addClass("noValue");$(".day .dropdown-label").addClass("noValue");this.$(".year select").val(this.__currentYear).change();this.$(".month select").val(this.__currentMonth).change();this.$(".day select").val(this.__currentDay).change()},cleanup:function(){this.yearDropdown.__hide();this.monthDropdown.__hide();this.dayDropdown.__hide()},__daysInMonth:function(){if(!this.__currentMonth||!this.__currentYear)return 31;var a=this.__current?new Date(this.__current):new Date;a.setDate(1);a.setMonth(this.__currentMonth);a.setYear(this.__currentYear);a.setDate(0);return a.getDate()},__ensureValue:function(){var a=this.__daysInMonth(),d=this.$(".day select option"),e=this.$(".day .dropdown-option");d.removeClass("hidden");e.removeClass("hidden");if(null!==this.__currentMonth){for(var c=31;28<c;c--)parseInt(d[c].value,10)>a&&($(d[c]).addClass("hidden"),$(e[c]).addClass("hidden"));this.__currentDay&&this.__currentDay>a&&(this.__currentDay=a.toString(),this.dayDropdown.selectByValue(this.__currentDay))}null===this.__currentYear||null===this.__currentMonth||null===this.__currentDay?this.__current=null:(null===this.__current&&(this.__current=new Date),this.__current.setDate(1),this.__current.setFullYear(this.__currentYear),this.__current.setMonth(this.__currentMonth-1),this.__current.setDate(this.__currentDay),this.__current.setHours(0),this.__current.setMinutes(0),this.__current.setSeconds(0),this.__current.setMilliseconds(0));this.trigger("change")},value:function(){return null===this.__current?null:new Date(this.__current)},year:function(){return null===this.__current?null:this.__current.getFullYear()},month:function(){return null===this.__current?null:this.__current.getMonth()+1},day:function(){return null===this.__current?null:this.__current.getDate()},__onChangeYear:function(){var a=this.$(".year select").val();if(""===a||-1===a)a=null;$(".year .dropdown-label").toggleClass("noValue",null===a);this.__currentYear=null!==a?a.toString():null;this.__ensureValue()},__onChangeMonth:function(){var a=this.$(".month select").val();if(""===a||-1===a)a=null;$(".month .dropdown-label").toggleClass("noValue",null===a);this.__currentMonth=null!==a?a.toString():a;this.__ensureValue()},__onChangeDay:function(){var a=this.$(".day select").val();if(""===a||-1===a)a=null;$(".day .dropdown-label").toggleClass("noValue",null===a);this.__currentDay=null!==a?a.toString():a;this.__ensureValue()},setDate:function(a,d,e){"undefined"!==typeof a&&"undefined"!==typeof d&&"undefined"!==typeof e&&(this.__currentYear=a,this.__currentMonth="0"==d.substring(0,1)?d.substring(1):d,this.__currentDay="0"==e.substring(0,1)?e.substring(1):e,this.$(".year select").val(this.__currentYear).change(),this.$(".month select").val(this.__currentMonth).change(),this.$(".day select").val(this.__currentDay).change(),this.__ensureValue())}})}({UiCore:m["@UiCore"],Dropdown:w,template:Wb}),Yb=function(k){var b=function(){var e={avatarname_invalid:{selector:".signup_avatarname",string:"signup_dialog_error_avatarname_invalid"},avatarname_taken:{selector:".signup_avatarname",string:"signup_dialog_error_avatarname_taken"},email_invalid:{selector:".signup_email",string:"signup_dialog_error_email_invalid"},email_taken:{selector:".signup_email",string:"signup_dialog_error_email_taken"},email_banned:{selector:".signup_email",string:"signup_dialog_error_email_banned"},email_imvu:{selector:".signup_email",string:"signup_dialog_error_email_imvu"},displayname_invalid:{selector:".signup_displayname",string:"signup_dialog_error_displayname_invalid"},displayname_blank:{selector:".signup_displayname",string:"signup_dialog_error_blank_field"},password_too_long:{selector:".signup_password",string:"signup_dialog_error_password_short"},password_too_short:{selector:".signup_password",string:"signup_dialog_error_password_short"},password_weak:{selector:".signup_password",string:"signup_dialog_error_weak"},password_fair:{selector:".signup_password",string:"signup_dialog_error_fair"},dob_invalid:{selector:".signup_dob",string:"signup_dialog_error_date_invalid"},unknown:{selector:".noop",string:"signup_dialog_error_unknown"}},c=function(g,f){this.__model=g;this.__globalStringManager=f};_.extend(c.prototype,{getSelector:function(g){return(e[g]||e.unknown).selector},getTranslatedString:function(g){return this.__globalStringManager.get((e[g]||e.unknown).string)},getError:function(g){for(var f in e)if((e[f]||e.unknown).selector===g&&this.__model.get(f))return f}});return c}(),a=function(e,c,g){g=g||"";c=c||{};c=this.__getUiAttributes(c);if("string"!==typeof g)throw Error("subContext ("+IMVU.repr(g)+") must be a string.");_.isUndefined(this.__parentUiContext)?(c.name&&this.__validateName(c.name),this.__serviceProvider.get("uiEventReporter").recordEvent(this.__getUiApplication(),this.__getUiPlatform(),this.__getUiContext(g),e,c)):a.call(this.__parentUiContext,e,c,this.__getUiContext(g))},d=k.SlideIn;return d.extend("FtuxAccountSlideIn",k.Mixin.mixin({uiContextName:"ftux_account_slidein",className:"slidein ftux-account-slidein light-theme",dependencies:"appMonitor captchaManager cookieManager dialogManager featureAccessManager ftuxState globalStartupModel globalStringManager googleAnalytics imageManager inventoryManager leanplum localStorage loginManager nextPageCallback onboardingGamificationManager Promise restModelFactory startupModel timer window".split(" "),trackedEvents:function(){return d.prototype.trackedEvents.call(this).concat([{name:"blur",type:"blur",selector:"input",handler:"__onInputBlur"},{name:"avatarname",type:"focus",selector:'input[name="signup_avatarname"]',handler:"__onFocusAvatarField"},{name:"avatarname",type:"blur",selector:'input[name="signup_avatarname"]',handler:"__onBlurAvatarField"},{name:"avatarname",type:"change",selector:'input[name="signup_avatarname"]',handler:"__onAvatarNameChange"},{name:"avatarnamepencil",type:"click",selector:"label.avatar-name",handler:"__onFocusAvatarFieldLabel"},{name:"displayname",type:"change",selector:'input[name="signup_displayname"]',handler:"__onDisplayNameChange"},{name:"email",type:"change",selector:'input[name="signup_email"]',handler:"__onEmailChange"},{name:"password",type:"change",selector:'input[name="signup_password"]',handler:"__onPasswordChange"},{name:"submit",type:"click",selector:".ftux-reg-footer button",handler:"__onSubmit"},{type:"click",selector:".toggle-password-visibility",name:"toggle_password_visibility",handler:"__togglePasswordVisibility"}])},initialize:function(e){var c=this;this.__window=e.window;this.__localStorage=e.localStorage;this.__globalStringManager=e.globalStringManager;this.__showCaptcha=k.CaptchaManager.canShowCaptcha(e.serviceProvider);this.__globalStartupModel=e.globalStartupModel;this.__parentMode=e.mode;this.__appMonitor=e.appMonitor;this.__Promise=e.Promise;this.__userClickedOnCreateAccount=e.userClickedOnCreateAccount;this.className+=" ftux-registration-desktop";d.prototype.initialize.call(this,e);this.__socialLogin=this.__loginManager.getSocialLogin();this.__socialLogin.getAuth().then(function(){if(c.__socialLogin.isLoggedIn()){var g=c.$(".signup_displayname_input"),f=c.__socialLogin.getProfileItem("name");f="undefined"===typeof f?"":f;g[0].setAttribute("value",f);c.__onDisplayNameChange();g=c.$(".signup_email_input");var h=c.__socialLogin.getProfileItem("email");g[0].setAttribute("value","undefined"===typeof f?"":h);c.__onEmailChange();c.$(".signup_password").addClass("hidden")}else null!==c.__socialLogin.getAppleRefreshToken()&&(c.$(".signup_email_input")[0].setAttribute("value",c.__socialLogin.getAppleEmail()),c.__onEmailChange(),c.$(".signup_password").addClass("hidden"))});this.__loginCookieName=this.__serviceProvider.get("loginCookieName");this.__lookModel=this.__parentMode.getLookModel()||e.serviceProvider.create(k.LookModel,{typeId:this.__ftuxState.getGender()});this.__featureAccessManager.canSeeOnboardingGamification()&&(this.__walletBalance=0,this.__onboardingGamificationGroup=this.__onboardingGamificationManager.getGroup(),this.__onboardingGamificationFTUXRewards=this.__onboardingGamificationManager.getFTUXRewards());this.__showCaptcha&&this.__setupCaptchaHandlers()},__setupCaptchaHandlers:function(){var e=this;this.__captchaManager.getOnReadyPromise().then(function(){e.listenTo(e.__captchaManager,"captcha:show",function(){e.__leanplum.recordEvent("welcome_funcaptcha_added_to_dom");e.$("input").prop("disabled",!0);e.$(".selector").addClass("disabled");e.$(".submit").prop("disabled",!0);e.$(".slidein-body").addClass("loading")});e.listenTo(e.__captchaManager,"captcha:hide",function(){e.__captchaCompleted||(e.$("input").prop("disabled",!1),e.$(".selector").removeClass("disabled"),e.$(".submit").prop("disabled",!1),e.$(".slidein-body").removeClass("loading"))});e.listenTo(e.__captchaManager,"captcha:completed",function(c){e.__captchaCompleted=!0;e.__captchaSuccess();e.__registrationSetupAndSubmit(c.token)})}).catch(function(c){a.call(e,"funcaptcha_took_over_30");e.__window.console.error("FtuxAccountSlideIn::__setupCaptchaHandlers - Failed to initialize captcha",c);e.__appMonitor.reportCustomError("FtuxAccountSlideIn","__setupCaptchaHandlers","web_perm_0010e","FtuxAccountSlideIn::__setupCaptchaHandlers - Failed to initialize captcha",e.__appMonitor.buildErrorArray(c))})},__setupModel:function(){this.__model=this.__serviceProvider.create(k.RegisterModeModel,{avatarNameManager:this.__serviceProvider.create(k.AvatarName),registrationManager:this.__serviceProvider.create(k.RegistrationManager),passwordStrength:{passwordStrength:window.password_strength,passwordMaxLength:window.password_max_length,passwordMinLength:window.password_min_length}});this.__Errors=new b(this.__model.error,this.__globalStringManager);this.__model.state.on("change",this.__updateState,this);this.__updateState();this.listenTo(this.__model.error,"change",this.__updateChangedErrors);this.listenTo(this.__model,"change",this.__updateState);this.listenTo(this.__model,"generated:avatarname",this.__updateAvatarName.bind(this));this.__featureAccessManager.canSeeOnboardingGamification()&&(this.listenTo(this.__model.validity,"change:displayname",this.__handleNameChange),this.listenTo(this.__model.validity,"change:email",this.__handleEmailChange),this.listenTo(this.__model.validity,"change:dob",this.__handleBirthdayChange),this.listenTo(this.__model.validity,"change:password",this.__handlePasswordChange))},renderBody:function(e){k.TrackingPixel.showSignupPixel({serviceProvider:this.__serviceProvider,window:this.__window,globalStartupModel:this.__globalStartupModel});this.__setupModel();this.__renderForm(e);this.__onboardingProgressWidget=null;this.__featureAccessManager.canSeeOnboardingGamification()&&(this.__onboardingProgressWidget=this.createChildContext(k.OnboardingProgressWidget,{$parentElement:this.$el}),this.__onboardingProgressWidget.el.classList.add("is-visible"))},__renderForm:function(e){e.html(k.template({dobDefaultLabel:this.__globalStringManager.get("signup_dialog_birthday_cover"),dobTooltipContent:k.dobTooltipTemplate({privacy_policy_link:'<a target="_blank" href="https://secure.imvu.com/next/policyhub/privacypolicy/">'+this.__globalStringManager.get("signup_dialog_dob_tooltip_pp")+"</a>"}),passwordTooltipContent:k.passwordTooltipTemplate(),showOnboarding:this.__featureAccessManager.canSeeOnboardingGamification()}));this.__insertLabelTemplate(".signup_dob");e={$replaceElement:this.$(".date-picker"),tabIndex:4};this.__datePicker=this.createChildContext(k.DatePicker,e);this.listenTo(this.__datePicker,"change",this.__onDateChange);this.createChildContext(k.Tooltip,{$replaceElement:this.$(".signup_dob .tooltip-content"),$tooltipTarget:this.$(".signup_dob .tooltip-target")});this.createChildContext(k.Tooltip,{$replaceElement:this.$(".signup_password .tooltip-content"),$tooltipTarget:this.$(".signup_password .tooltip-target")});this.__featureAccessManager.canSeeOnboardingGamification()&&(this.__coinAnimation=this.createChildContext(k.CoinAnimation,{$replaceElement:this.$(".coin-animation-placeholder"),showIcon:!0}))},delete:function(){this.__animationTimeout&&this.__timer.clearTimeout(this.__animationTimeout)},hide:function(){this.__onboardingProgressWidget&&this.__onboardingProgressWidget.el.classList.remove("is-visible","no-animation");d.prototype.hide.call(this,!0);$(this.__window).off("beforeunload")},show:function(e){d.prototype.show.call(this,e);this.__onboardingProgressWidget&&this.__onboardingProgressWidget.el.classList.add("is-visible","no-animation");this.__lookModel=this.__parentMode.getLookModel();if(this.__model){if(this.__ftuxState.isNothingEquipped()||this.__userClickedOnCreateAccount)this.__ftuxState.setGender(this.__lookModel.getTypeId()),this.__ftuxState.updateFromLookModel(this.__lookModel),this.__ftuxState.createEquippedItemIds(this.__lookModel.get("products"));this.__model.set({pids:this.__ftuxState.getEquippedItems()})}this.__inventoryManager.getFtuxModelPromise().then(function(c){var g=c.get(this.__ftuxState.getGender()+"_reg");this.__clothingProductUrl=c.get("dress_up_reg");this.trigger("show:scene",c);this.__ftuxModel=c;this.__showAvatarImage(this.__ftuxModel);return this.__serviceProvider.get("rest").get(g)}.bind(this)).then(function(){this.__showCaptcha?this.__leanplum.recordEvent("welcome_funcaptcha_should_show"):this.__leanplum.recordEvent("welcome_funcaptcha_should_not_show")}.bind(this))},__showAvatarImage:function(e){var c=this.__ftuxState.getGenderState().avatarImage||this.__lookModel.get("avatar_image");c||(c=e.get(this.__ftuxState.getGender()+"_image"));this.setAvatarImage(c)},setAvatarImage:function(e){this.$(".avatar img").attr("src",e)},__onEmailChange:function(){this.__leanplum.recordEvent("welcome_email_change");var e=this.$('input[name="signup_email"]').val();this.__model.set({email:e})},__onPasswordChange:function(){this.__leanplum.recordEvent("welcome_password_change");this.__model.set({password:this.$('input[name="signup_password"]').val()})},__onDateChange:function(){this.__leanplum.recordEvent("welcome_date_change");this.__model.set({dob:this.__datePicker.value()})},__onAvatarNameChange:function(){this.__leanplum.recordEvent("welcome_avatar_name_change");var e=this.__removeExtraWhitespace(this.$('input[name="signup_avatarname"]').val(),!0);this.$('input[name="signup_avatarname"]').val(e);this.__model.useSuggestedAvatarname=!1;this.__model.set({avatarname:e})},__onDisplayNameChange:function(){this.__leanplum.recordEvent("welcome_display_name_change");var e=this.__removeExtraWhitespace(this.$('input[name="signup_displayname"]').val(),!1);this.$('input[name="signup_displayname"]').val(e);this.__model.set({displayname:e})},__removeExtraWhitespace:function(e,c){return e=e.replace(/\s+/g,c?"":" ").replace(/^\s|\s$/g,"")},__onInputBlur:function(e){if("signup_email"!==$(e.currentTarget).attr("name")||"pending"!==this.__model.validity.get("email")){e="."+$(e.currentTarget).attr("name");var c=this.__Errors.getError(e);c?this.__setInputErrorLabelMsg(e,this.__Errors.getTranslatedString(c)):this.__clearError(e)}},__failedSubmit:function(e){this.__leanplum.recordEvent("welcome_registration_failure",{error:e});this.__recordEvent("registration_error",{error_log:e,record:!0});if(this.__captchaManager)try{this.__captchaManager.reset()}catch(c){this.__window.console.error("FtuxAccountSlideIn::__failedSubmit - Failed to refresh_session on Captcha",c),this.__appMonitor.reportCustomError("FtuxAccountSlideIn","__failedSubmit","web_perm_0010f","FtuxAccountSlideIn::__failedSubmit - Failed to refresh_session on Captcha",this.__appMonitor.buildErrorArray(c))}this.__updateAllErrors();this.$("select").prop("disabled",!1);this.$("input").prop("disabled",!1);this.$(".selector").removeClass("disabled");this.$(".submit").removeClass("clicked");this.$(".submit").prop("disabled",!1);this.$(".ftux-account-slidein").removeClass("loading");this.__updateState()},__registrationSetupAndSubmit:function(e){var c=this;e=void 0===e?"":e;this.__leanplum.recordEvent("welcome_create_account_click");this.__serviceProvider.get("uiEventReporter").flush();this.$("button").prop("disabled",!0);this.$("select").prop("disabled",!0);this.$(".selector").addClass("disabled");this.$("input").prop("disabled",!0);this.$(".ftux-account-slidein").addClass("loading");this.__model.set({fc_token:e});this.__onDateChange();if("valid"===this.__model.state.get("form"))if(e=this.__timer.getDate(),e=new Date(e.getFullYear()-13,e.getMonth(),e.getDate(),0,0,0,0),this.__featureAccessManager.canSeeOnboardingGamification()&&this.__model.set({experiment:{name:"WEB:onboarding_gamification_rollout.experiment",branch:this.__onboardingGamificationGroup}}),this.__model.get("dob").getTime()<=e.getTime())if(this.__googleAnalytics.recordClick("welcome","create account"),this.__featureAccessManager.canSeeOnboardingGamification()){e=this.__walletBalance+parseInt(this.__onboardingGamificationFTUXRewards.welcome_create);this.__countUp(this.__walletBalance,e);this.__coinAnimation.animate();this.__onboardingGamificationManager.handleTaskCompletion("welcome_create");var g=this.$el.find(".coin-animation__icon");this.__animationTimeout=this.__timer.setTimeout(function(){g.off("animationend");c.__submitRegistration()},5e3);g.on("animationend",function(){c.__timer.clearTimeout(c.__animationTimeout);c.__animationTimeout=null;g.off("animationend");c.__submitRegistration()})}else this.__submitRegistration();else this.__failedSubmit({temporary:!1,type:"unknown_frontend_error"})},__onSubmit:function(e){var c=this;e.preventDefault();this.__showCaptcha?this.__model.getDataForCaptcha().then(function(g){c.__captchaManager.setConfig({data:{blob:g}});return c.__captchaManager.getOnReadyPromise()}).then(function(){try{c.__captchaManager.run()}catch(g){return c.__Promise.reject(g)}}).catch(function(g){c.__failedSubmit(g);c.$(".error-message.unknown").addClass("active")}):this.__registrationSetupAndSubmit()},__submitRegistration:function(){var e=this;this.__model.submitRegistration().then(function(){e.__leanplum.recordEvent("welcome_registration_success");e.__googleAnalytics.recordRegistrationComplete(e.__googleAnalyticsLabel);e.__recordEvent("registration_success",{record:!0});a.call(e,"secret_registration_success");k.TrackingPixel.showRegistrationPixel({serviceProvider:e.__serviceProvider,window:e.__window,globalStartupModel:e.__globalStartupModel});e.__cookieManager.set(e.__loginCookieName,"true");e.__serviceProvider.get("uiEventReporter").flush().then(e.__nextPageCallback,e.__nextPageCallback);e.__localStorage.setItem("account-just-created",1)}).catch(function(c){return e.__failedSubmit(c)})},__updateChangedErrors:function(e,c){for(var g in e.changed)if(e.changed[g]){this.__setInputErrorLabelMsg(this.__Errors.getSelector(g),this.__Errors.getTranslatedString(g));break}else this.__clearError(this.__Errors.getSelector(g))},__updateAllErrors:function(){this.$(".error-message").removeClass("active");_.each({unknown:"unknown",challenge:"unknown",login:"unknown",fc_token_invalid:"funcaptcha",fun_captcha_answer_wrong:"funcaptcha",birthday_error:"underage"},function(e,c){this.__model.error.get(c)&&this.$(".error-message."+e).addClass("active")}.bind(this))},__updateState:function(){switch(this.__model.state.get("form")){case"invalid":this.$("input").prop("disabled",!1);this.$(".submit").prop("disabled",!0);break;case"valid":this.$("input").prop("disabled",!1);this.$(".submit").prop("disabled",!1);break;case"loading":this.$("input").prop("disabled",!0),this.$(".selector").addClass("disabled"),this.$(".submit").prop("disabled",!0)}},__togglePasswordVisibility:function(){var e=this.$(".signup_password input"),c="password"==e.attr("type");e[0].setAttribute("type",c?"text":"password");this.$(".toggle-password-visibility").toggleClass("icon-password-show",!c).toggleClass("icon-password-hide",c);e.focus()},__updateAvatarName:function(){this.$(".avatar-name-container input[name=signup_avatarname]").val(this.__model.get("avatarname"));this.__onBlurAvatarField();this.__showAvatarname||(this.__showAvatarname=!0,this.$(".avatar-name-container").addClass("show-avatarname-field"))},__onFocusAvatarFieldLabel:$.noop,__onFocusAvatarField:function(){this.$(".avatar-name").addClass("active");this.__leanplum.recordEvent("welcome_avatar_name_focus");this.__googleAnalytics.recordClick("welcome","modify avatarname field")},__onBlurAvatarField:function(){this.$(".avatar-name").removeClass("active");var e=this.__featureAccessManager.canSeeOnboardingGamification()?"12px":"15px",c=this.$(".avatar-name-container input[name=signup_avatarname]").val();e=$("<div />").css({margin:0,padding:0,display:"none","font-size":e}).text(c);this.$(".avatar-name-container").append(e);c=0!==c.length?e.width():85;this.$(".avatar-name-container input[name=signup_avatarname]").width(c);e.remove()},__captchaSuccess:function(){this.__leanplum.recordEvent("welcome_funcaptcha_success");this.__model.validity.set({fc_token:"valid"});this.$(".error-message.funcaptcha").removeClass("active")},__handleBirthdayChange:function(){var e="valid"===this.__model.validity.get("dob");this.el.querySelector(".signup_dob").classList.toggle("is-valid",e);e&&!this.__onboardingGamificationManager.isTaskCompleted("welcome_dob")&&(e=this.__walletBalance+parseInt(this.__onboardingGamificationFTUXRewards.welcome_dob),this.__countUp(this.__walletBalance,e),this.__coinAnimation.animate(),this.__onboardingGamificationManager.handleTaskCompletion("welcome_dob"))},__handleEmailChange:function(){var e="valid"===this.__model.validity.get("email");this.el.querySelector(".signup_email").classList.toggle("is-valid",e);e&&!this.__onboardingGamificationManager.isTaskCompleted("welcome_email")&&(e=this.__walletBalance+parseInt(this.__onboardingGamificationFTUXRewards.welcome_email),this.__countUp(this.__walletBalance,e),this.__coinAnimation.animate(),this.__onboardingGamificationManager.handleTaskCompletion("welcome_email"))},__handleNameChange:function(){var e="valid"===this.__model.validity.get("displayname");this.el.querySelector(".signup_displayname").classList.toggle("is-valid",e)},__handlePasswordChange:function(){var e="valid"===this.__model.validity.get("password");this.el.querySelector(".signup_password").classList.toggle("is-valid",e)},__countUp:function(e,c){var g=this;if(c>e){var f=e+1;e=f>=c?c:f;this.el.querySelector(".ftux-wallet__text").textContent=e;this.__window.requestAnimationFrame(function(){g.el.querySelector(".ftux-wallet__text").textContent=c;g.__countUp(e,c)})}else this.__walletBalance=c},_updateLookModel:function(e){this.__lookModel.set(e)},_getRegistrationModelPids:function(){return this.__model.get("pids")}},k.InputMixin))}({Model:m["@Model"],NextUtil:m["@NextUtil"],PasswordStrength:m["@PasswordStrength"],UiCore:m["@UiCore"],AvatarName:Rb,CaptchaManager:B,CoinAnimation:O,DatePicker:Xb,InputMixin:U,LookModel:P,Mixin:W,OnboardingProgressWidget:A,RegisterModeModel:Vb,RegistrationManager:Qb,SlideIn:X,Tooltip:r,TrackingPixel:Sb,dobTooltipTemplate:Tb,passwordTooltipTemplate:Ub,template:Nb}),Zb=function(k){var b=k.Submode;return b.extend("FtuxSubmode",{uiContextName:"ftux_submode",className:"submode ftux-submode ftux-layout",dependencies:"appMonitor browserInfo counterHelper dialogManager featureAccessManager ftuxState globalNav globalStartupModel globalStringManager googleAnalytics historyManager localStorage loginManager perfReportManager Promise restModelFactory startupModel stringManager uiEventReporter webGL window".split(" "),trackedEvents:function(){return b.prototype.trackedEvents.call(this).concat([{type:"click",selector:".gender button",name:"change_gender",handler:this.__onGenderButtonClick},{type:"click",selector:".gender .avatar-container .female-wrapper .avatar-2d .avatar-image",name:"2d_female_avatar_click",handler:this.__onFemaleAvatarClick},{type:"click",selector:".gender .avatar-container .male-wrapper .avatar-2d .avatar-image",name:"2d_male_avatar_click",handler:this.__onMaleAvatarClick},{type:"click",selector:".go-back-button",name:"go_back",handler:this.__goBackViaButtonClick}])},initialize:function(a){var d=this;b.prototype.initialize.call(this,a);this.__perfStartTime=IMVU.optionalProperty(a,"perfStartTime",null);this.__Promise=a.Promise;this.__serviceProvider=a.serviceProvider;this.__startupModel=a.startupModel;this.__Promise=a.Promise;this.__globalStartupModel=a.globalStartupModel;this.__globalStringManager=a.globalStringManager;this.__restModelFactory=a.restModelFactory;this.__webGL=a.webGL;this.__timer=a.timer;this.__initTime=this.__timer.getTime();this.__undoRedo=a.undoRedo;this.__window=a.window;this.__uiEventReporter=a.uiEventReporter;this.__globalNav=a.globalNav;this.__modeManager=a.modeManager;this.__localStorage=a.localStorage;this.__loadedMedias=0;this.__eleBody=null;this.__regShown=!1;this.__selectedGender=null;this.__3DSceneDCAShown=!1;this.__step=this.__previousStep=this.ftuxModule=null;this.__initialStep="undefined"===typeof a.initialStep?"gender":a.initialStep;this.__genderChanged=!1;this.__2dAvatar=null;this.__userClickedOnCreateAccount=this.__slideInListensSetup=!1;this.__connectionResolver=void 0;this.__connectionPromise=new this.__Promise(function(e){this.__connectionResolver=e}.bind(this));this.__connectionPromise.then(function(){this.__totalMedias=this.__webGL.use3d()&&0!==this.__connectionTier?1:2}.bind(this)).catch(function(e){this.__window.console.error(e)}.bind(this));this.ftuxState=a.ftuxState;this.__currentLook=JSON.stringify({trackedAdds:this.__parentMode.trackedAdds,trackedRemoves:this.__parentMode.trackedRemoves,change:{}});this.addToDOM();this.__startupModel.populated().then(function(){return this.__startupModel.getSingleEdge("dress_up_ftux").populated()}.bind(this)).then(function(){this.__onResize()}.bind(this)).catch(function(e){this.__window.console.error(e)}.bind(this));this.__historyManager.noHistory()&&"gender"!==this.__step&&(null===this.__step&&null!==this.__initialStep&&(this.__step=this.__initialStep),"dna"!==this.__step&&"clothing"!==this.__step&&"account"!==this.__step||this.__setHistoryState("gender"),"clothing"!==this.__step&&"account"!==this.__step||this.__setHistoryState("dna"),"account"===this.__step&&this.__setHistoryState("clothing"));this.__undoRedo=a.undoRedo;k.CaptchaManager.canShowCaptcha(a.serviceProvider)&&(this.__captchaManager=a.captchaManager||this.__serviceProvider.create(k.CaptchaManager,{apiContext:"registration"}));this.__supported_redirects=["/creatorlanding/"];this.__serviceProvider.get("acceptedDollarStorePermaLinkProducts").forEach(function(e){return d.__supported_redirects.push("/store/"+e+"/")})},delete:function(){$(this.__window).off("resize.ftux");b.prototype.delete.call(this);this.__2dAvatar&&this.__2dAvatar.off("loaded");_.each(this.__initialDefaultProducts,function(a){a.find("img").off("load")})},__switchToGender:function(){this.__eleLoginNav.addClass("hidden");this.__eleBody.removeClass("fixed-position-ghost-layout");this.__eleGender.removeClass("hidden");this.__eleDCA.addClass("hidden");this.__eleSlidein.addClass("hidden");this.__undoRedo.clearHistory();this.__parentMode.resetTrackedIds();this.__currentLook=JSON.stringify({trackedAdds:this.__parentMode.trackedAdds,trackedRemoves:this.__parentMode.trackedRemoves,change:{}});this.__showGender()},__switchToDCA:function(){this.__eleLoginNav.removeClass("hidden");this.__eleBody.addClass("fixed-position-ghost-layout");this.__eleGender.addClass("hidden");this.__eleDCA.removeClass("hidden");this.__eleSlidein.removeClass("hidden");this.__globalNav.setText(this.__stringManager.get("customize_dna_nav"));this.__showDCA()},__setStep:function(a,d){d="undefined"===typeof d?!1:!!d;this.__previousStep=this.__step;this.__step=a;null===this.__eleBody&&(this.__eleLoginNav=$(".login-nav"),this.__eleBody=this.$(".ftux-body"),this.__eleAvCon=this.__eleBody.find(".avatar-container"),this.__eleGender=this.__eleBody.find(".gender"),this.__eleDGFemale=this.__eleGender.find('[data-gender="female"]'),this.__eleDGMale=this.__eleGender.find('[data-gender="male"]'),this.__eleDCA=this.__eleBody.find(".dca"),this.__eleSlidein=this.__eleBody.find(".slide-in"));this.__setStepSwitch();d||this.__setHistoryState(this.__step);return!0},__setStepSwitch:function(){switch(this.__step){case"gender":this.__switchToGender();this.__globalNav.setText(this.__globalStringManager.get("select_gender_nav"));this.__ftuxState.clearAssets();this.__historyManager.unsetPopInterception();break;case"dna":this.__switchToDCA();this.__globalNav.setText(this.__stringManager.get("customize_dna_nav"));$(".go-back-button > span").text(this.__stringManager.get("back_to_gender"));this.__historyManager.setPopInterception(this.__popStateInterceptForBrowserGoBack.bind(this));"undefined"!==typeof this.__ftuxProductSlideIn&&("clothing"!==this.__previousStep&&this.__ftuxProductSlideIn.show(this.__parentMode.slideInOpen),this.__ftuxProductSlideIn.showDnaProducts());"undefined"!==typeof this.__ftuxAccountSlideIn&&this.__ftuxAccountSlideIn.hide();null!==this.ftuxModule&&this.stopListening(this.ftuxModule,"change:gender");break;case"clothing":this.__switchToDCA();this.__globalNav.setText(this.__stringManager.get("select_clothing_nav"));$(".go-back-button > span").text(this.__stringManager.get("back_to_dna"));this.__historyManager.setPopInterception(this.__popStateInterceptForBrowserGoBack.bind(this));"undefined"!==typeof this.__ftuxProductSlideIn&&("dna"!==this.__previousStep&&this.__ftuxProductSlideIn.show(this.__parentMode.slideInOpen),this.__ftuxProductSlideIn.showClothingProducts());"undefined"!==typeof this.__ftuxAccountSlideIn&&this.__ftuxAccountSlideIn.hide();null!==this.ftuxModule&&this.stopListening(this.ftuxModule,"change:gender");break;case"account":this.__switchToDCA(),this.__globalNav.setText(this.__stringManager.get("save_this_look_nav")),$(".go-back-button > span").text(this.__stringManager.get("back_to_clothing")),this.__historyManager.setPopInterception(this.__popStateInterceptForBrowserGoBack.bind(this)),"undefined"!==typeof this.__ftuxProductSlideIn&&this.__ftuxProductSlideIn.hide(),this.__showRegistrationSlideIn(),this.__ftuxAccountSlideIn.show(),this.__parentMode.getLookModel()&&!this.__3dActive&&this.__ftuxAccountSlideIn.setAvatarImage(this.__parentMode.getLookModel().get("avatar_image")),this.__counterHelper.increment("welcome_ftux_account")}},__getStep:function(){switch(this.__step){case"gender":case"dna":case"clothing":case"account":return this.__step;default:return!1}},__getStage:function(){if(null===this.__step)return"gender";switch(this.__step){case"gender":return"gender";case"dna":case"clothing":case"account":return"dca";default:return!1}},__onResize:function(){"gender"===this.__step&&(k.NextUtil.DomHelper.squarify({me:this.__eleDGFemale,within:this.__eleAvCon,isHalfWidth:!0}),k.NextUtil.DomHelper.squarify({me:this.__eleDGMale,within:this.__eleAvCon,isHalfWidth:!0}))},render:function(){b.prototype.render.call(this);this.$el.html(k.template);this.__connectionPromise.then(function(){this.$el.toggleClass("is2d",!this.__webGL.use3d()&&0!==this.__connectionTier);this.__webGL.use3d()&&0!==this.__connectionTier&&this.__showLoadingProgress()}.bind(this)).catch(function(a){this.__window.console.error(a)}.bind(this));$(this.__window).on("resize.ftux",this.__onResize.bind(this));this.__startupModel.populated().then(function(){return this.__startupModel.getSingleEdge("dress_up_ftux").populated()}.bind(this)).then(function(a){this.ftuxModel=a;this.__categoriesUrl=a.get("dress_up_reg");this.__preloadCategories(this.ftuxState.getGender())}.bind(this)).catch(function(a){this.__window.console.error(a)}.bind(this));this.__webGL.use3d()||this.$("#landing-video-container").css("display","none");this.__featureAccessManager.isMobile()&&this.__dialogManager.confirm({title:this.__globalStringManager.get("ftux_frontpage_get_the_app"),text:this.__globalStringManager.get("ftux_frontpage_best_mobile_experience"),yes:this.__globalStringManager.get("ftux_frontpage_get_the_app_yes_btn"),no:this.__globalStringManager.get("ftux_frontpage_get_the_app_cancel_btn")}).finished.then(function(){"iOS"===this.__browserInfo.getMobileOS()?(this.__window.open("itms-apps://itunes.apple.com/us/app/imvu/id919745844?mt=8"),this.__window.location="/welcome/"):"Android"===this.__browserInfo.getMobileOS()?(this.__window.open("https://play.google.com/store/apps/details?id=com.imvu.mobilecordova"),this.__window.location="/welcome/"):this.__window.location="https://about.imvu.com/mobile/"}.bind(this)).catch(function(a){this.__window.location="/welcome/"}.bind(this))},show:function(){IMVU.removeLandingVideo();this.__loginManager.isLoggedIn()&&(this.__window.location="/next/");b.prototype.show.call(this);this.__parentMode.slideInOpen=!1;this.__setStep(this.__initialStep)},__spawn2dAvatar:function(a,d){return this.__parentMode.show2dAvatar({gender:a,$parentElement:d,parentContext:this,setDefault:!0})},__showGender:function(){this.__3DSceneDCAShown=!1;this.__startupModel.populated().then(function(){return this.__parentMode.getConnectionTier()}.bind(this)).then(function(a){this.__connectionTier=a;return this.__startupModel.getSingleEdge("dress_up_ftux").populated()}.bind(this)).then(function(){this.__connectionResolver.accept();if(this.__webGL.use3d()&&0!==this.__connectionTier){this.__3dActive=!0;this.__moveLoadingProgress("bootstrap");var a=_.extend(_.clone(k.CamParams.room),{pitchForFtux:10,yaw:156,firstPersonViewSwitchDistance:0});this.__parentMode.show3dScene({$parentElement:this.$(".gender .avatar-container").expect(1),parentContext:this,genders:["female","male"],camParams:a,canClickAvatar:!0,allowCameraInteraction:!1,resetGenderLooks:!0}).then(function(d){this.__moveLoadingProgress("northstar");this.ftuxModule=d;this.__parentMode.resetScenePosition();"undefined"===typeof d&&this.__appMonitor.reportCustomError("FtuxSubmode","__showGender","web_error_0008a","ftuxModule unknown",[]);return d.loadedEverything().then(function(){this.__setSelectedGender(this.ftuxState.getGender());var e=this.ftuxState.getAssetUrl();this.ftuxState.setGender(this.__selectedGender);null!==e&&this.ftuxState.setAssetUrl(e);this.ftuxModule.__ftuxMode!==this.ftuxModule.FTUX_MODE_GENDER&&(e=this.ftuxModel.get(this.__selectedGender+"_asset_url"),this.ftuxState.getAssetUrl()&&(e=this.ftuxState.getAssetUrl()),this.ftuxModule.changeAssetsByUrlString(e,function(){}),this.ftuxModule.setModeToGender(),this.__parentMode.resetTrackedIds(),this.ftuxState.setGender(this.__selectedGender));this.__moveLoadingProgress("ftuxModule");this.listenTo(this.ftuxModule,"change:gender",this.__onGenderAvatarClick);$(this.__window).trigger("resize")}.bind(this))}.bind(this)).then(function(){this.__on3dLoaded(a)}.bind(this)).catch(function(d){this.__window.console.error(d)}.bind(this))}else this.setLoading(!1),_.each(["female","male"],function(d){var e=this.$('.gender .avatar-container div[data-gender="'+d+'"]');this.__spawn2dAvatar(d,e).then(function(){this.__mediaLoaded();$(this.__window).trigger("resize")}.bind(this)).catch(function(c){this.__window.console.error(c)}.bind(this))}.bind(this)),this.ftuxState.setGender("female")}.bind(this))},__showDCA:function(){this.__selectedGender||(this.__selectedGender=this.__ftuxState.getGender()?this.__ftuxState.getGender():"female");this.__ftuxProductSlideIn||(this.__inventoryManager=this.__serviceProvider.create(k.InventoryManager,{ftuxState:this.__ftuxState}),this.__ftuxProductSlideIn=this.addSlideIn(k.FtuxProductSlideIn,{$parentElement:this.$(".slide-in"),lookModel:this.__parentMode.getLookModel(),inventoryManager:this.__inventoryManager,undoRedo:this.__undoRedo,step:this.__step}));this.__connectionResolver.accept();"3d"===(this.__webGL.use3d()&&0!==this.__connectionTier?"3d":"2d")?(this.__moveLoadingProgress("bootstrap"),this.__show3DSceneDCA()):(this.setLoading(!1),this.__show2dAvatarDCA());this.__slideInListensSetup||(this.__slideInListensSetup=!0,this.listenTo(this.__ftuxProductSlideIn,"show:body",function(a){this.ftuxModule&&this.ftuxModule.focusOnBodyRegion(a)}),this.listenTo(this.__ftuxProductSlideIn,"change:look",function(a){this.__userChangedLook=!0;this.__webGL.use3d()&&0!==this.__connectionTier&&this.__showPutOnItemProgressBar();this.__changeLook(a)}),this.listenTo(this.__ftuxProductSlideIn,"undo:look",function(){this.__undo()}),this.listenTo(this.__ftuxProductSlideIn,"redo:look",function(){this.__redo()}),this.listenTo(this.__ftuxProductSlideIn,"show:clothing",function(){"clothing"!==this.__step&&this.__setStep("clothing")}),this.listenTo(this.__ftuxProductSlideIn,"show:registration",function(){this.__userClickedOnCreateAccount=!0;this.__setStep("account")}))},hide:function(){b.prototype.hide.call(this);this.__globalNav.clearText()},__on3dLoaded:function(a){this.setLoading(!1);this.__mediaLoaded()},__showLoadingProgress:function(){this.__3dProgressPoints={};_.each(["bootstrap","northstar","ftuxModule"],function(a){new this.__Promise(function(d){this.__3dProgressPoints[a]=d}.bind(this))}.bind(this));this.__loadingProgress=this.createChildContext(k.LoadingProgress,{progressPromises:_.pluck(_.values(this.__3dProgressPoints),"promise"),$parentElement:this.$el});this.__connectionPromise.then(function(a){this.listenTo(this.__loadingProgress,"timeCompleted",this.__googleAnalytics.recordPerformance.bind(this.__googleAnalytics,"welcome","loading progressbar"))}.bind(this))},__moveLoadingProgress:function(a){this.__3dProgressPoints[a].accept()},__preloadCategories:function(a){this.__restModelFactory.readCollection(this.__categoriesUrl+"?gender="+a,k.UiCore.NodeCollection,{withCredentials:!1})},__mediaLoaded:function(){this.__loadedMedias++;0<this.__totalMedias&&this.__loadedMedias===this.__totalMedias&&this.__onFinishedLoading()},__onFinishedLoading:function(){var a=this.uiContextName+"_"+(this.__webGL.use3d()?"3d":"2d")+"_load_time",d=(this.__timer.getTime()-this.__initTime)/1e3;this.__recordEvent(a,{time:d,record:!0});this.__uiEventReporter.flush();this.__connectionPromise.then(function(){this.__googleAnalytics.recordPerformance("mirror","ftux submode "+(this.__webGL.use3d()&&0!==this.__connectionTier?"3d":"2d")+" load time",parseInt(this.__timer.getTime()-this.__initTime));this.__perfReportManager.record(this.__perfReportManager.tags.SUBMODE_WELCOME_FTUX,"nav",this.__perfStartTime)}.bind(this));"function"===typeof this.__parentMode.maybeShowGDPRDialog&&this.__parentMode.maybeShowGDPRDialog()},__snapshotLook:function(a){this.__currentLook=JSON.stringify({trackedAdds:this.__parentMode.trackedAdds,trackedRemoves:this.__parentMode.trackedRemoves,change:a})},__changeLook:function(a){var d=this.__currentLook,e=this.__buildChangeQuery(a);this.__movePutOnItemProgressBar("prepareLook");this.__parentMode.getLookModel().fetch(e).then(function(){this.__movePutOnItemProgressBar("startWearing");this.__snapshotLook(a);this.__setTrackedPids(e);this.__undoRedo.add(d);this.__executeChangeLook()}.bind(this))},__undo:function(){if(this.__undoRedo.get("canUndo")&&this.__undoRedo.get("canProcess")){this.__undoRedo.set("canProcess",!1);var a=this.__undoRedo.undo(this.__currentLook);if(this.__currentLook=a){a=JSON.parse(a);this.__parentMode.trackedAdds=a.trackedAdds;this.__parentMode.trackedRemoves=a.trackedRemoves;var d=this.__buildChangeQuery(a.change);return this.__parentMode.getLookModel().fetch(d).then(function(){this.__setTrackedPids(d);this.__executeChangeLook();this.__undoRedo.set("canProcess",!0)}.bind(this))}}return this.__Promise.accept()},__redo:function(){if(this.__undoRedo.get("canRedo")&&this.__undoRedo.get("canProcess")){this.__undoRedo.set("canProcess",!1);var a=this.__undoRedo.redo(this.__currentLook);this.__currentLook=a;a=JSON.parse(a);this.__parentMode.trackedAdds=a.trackedAdds;this.__parentMode.trackedRemoves=a.trackedRemoves;var d=this.__buildChangeQuery(a.change);return this.__parentMode.getLookModel().fetch(d).then(function(){this.__setTrackedPids(d);this.__executeChangeLook();this.__undoRedo.set("canProcess",!0)}.bind(this))}return this.__Promise.accept()},__extractChangeArray:function(a,d){return!_.has(a,d)||_.isNull(a[d])||_.isUndefined(a[d])?[]:_.isArray(a[d])?a[d]:a[d].split(",")},__setTrackedPids:function(a){var d=this.__extractChangeArray(a,"add");a=this.__extractChangeArray(a,"remove");var e=_.pluck(this.__parentMode.getLookModel().get("products"),"product_id");this.__parentMode.trackedAdds=_.difference(this.__parentMode.trackedAdds,a);this.__parentMode.trackedRemoves=_.difference(this.__parentMode.trackedRemoves,d);d=_.uniq(this.__parentMode.trackedAdds.concat(d));a=_.uniq(this.__parentMode.trackedRemoves.concat(a));var c=_.intersection(d,a);this.__parentMode.trackedAdds=_.intersection(_.difference(d,c),e);this.__parentMode.trackedRemoves=_.difference(a,c)},__buildChangeQuery:function(a){var d=this.__extractChangeArray(a,"add");a=this.__extractChangeArray(a,"remove");_.each([d,a],function(c){_.each(c,function(g,f){_.isString(c[f])&&(c[f]=parseInt(c[f].replace(/^(.*\/product-)*(\d+)$/,"$2"),10))}.bind(this))}.bind(this));d=_.uniq(this.__parentMode.trackedAdds.concat(d));a=_.uniq(this.__parentMode.trackedRemoves.concat(a));var e={};0<d.length&&(e.add=d);0<a.length&&(e.remove=a);return e},__showPutOnItemProgressBar:function(){this.__userChangedLook&&(void 0!==this.__putOnItemProgressBar&&this.__putOnItemProgressBar.delete(),this.__putOnItemProgressPoints={},_.each(["startWearing","prepareLook","putOnOutfit","doneWearing"],function(a){new this.__Promise(function(d){this.__putOnItemProgressPoints[a]=d}.bind(this))}.bind(this)),this.__putOnItemProgressBar=this.createChildContext(k.LoadingProgress,{$parentElement:this.$(".dca .avatar-container"),progressPromises:_.pluck(_.values(this.__putOnItemProgressPoints),"promise")},!0))},__movePutOnItemProgressBar:function(a){this.__userChangedLook&&this.__webGL.use3d()&&0!==this.__connectionTier&&this.__putOnItemProgressPoints[a].accept()},__executeChangeLookFromSlideIn:function(a){a.disableProductEquip();this.__ftuxState.createEquippedItemIds(this.__parentMode.getLookModel().get("products"));this.__connectionPromise.then(function(){this.__webGL.use3d()&&0!==this.__connectionTier?(this.__movePutOnItemProgressBar("putOnOutfit"),this.__parentMode.get3dScenePromise().then(function(){this.ftuxModule=this.__parentMode.getFtuxModule();this.ftuxModule.changeAssetsByUrlString(this.__parentMode.getLookModel().get("asset_url"),function(){this.__movePutOnItemProgressBar("doneWearing");this.__ftuxState.updateFromLookModel(this.__parentMode.getLookModel());a.markEquippedProducts(this.__ftuxState.getEquippedItems());a.enableProductEquip()}.bind(this))}.bind(this))):(a.markEquippedProducts(this.__ftuxState.getEquippedItems()),a.enableProductEquip())}.bind(this))},setLoading:function(a){this.$(".ftux-body").toggleClass("loading",a)},__setFtuxGender:function(){this.ftuxModule?(this.ftuxModule.setGender(this.__selectedGender),"male"===this.ftuxState.getGender()?this.ftuxState.setAssetUrl(this.ftuxModule.__maleUrl):this.ftuxState.setAssetUrl(this.ftuxModule.__femaleUrl)):this.ftuxState.setGender(this.__selectedGender);this.__preloadCategories(this.__selectedGender);this.__genderChanged=!0;if("creatorlanding"===this.__modeManager.uiApplication)try{this.__window.pintrk("track","signup",{lead_type:["Signup choose gender:",this.ftuxState.getGender()].join(" ")},function(a,d){a||this.__appMonitor.reportCustomError("FtuxSubmode","__setFtuxGender","web_perm_0005h","Error returned from pintrk callback",["Reported Error: "+d])}.bind(this))}catch(a){this.__appMonitor.reportCustomError("FtuxSubmode","__setFtuxGender","web_perm_0005a","Error thrown in call to window.pintrk",["Reported Error: "+a.message])}this.__setStep("dna")},__onGenderButtonClick:function(a){a=$(a.currentTarget);var d=a.attr("data-gender"),e=!1;!d&&a.is("button")&&(d=a.hasClass("female")?"female":"male",e=!0);e&&this.ftuxState.clearAssets();this.__setSelectedGender(d);this.__setFtuxGender()},__onGenderAvatarClick:function(){this.__setSelectedGender(this.ftuxState.getGender());this.__setFtuxGender()},__onFemaleAvatarClick:function(){this.__setSelectedGender("female");this.__setFtuxGender()},__onMaleAvatarClick:function(){this.__setSelectedGender("male");this.__setFtuxGender()},__setSelectedGender:function(a){this.__selectedGenderPrevious=this.__selectedGender;this.__selectedGender="undefined"===typeof a?null:a;this.__parentMode.createLookModel(this.__selectedGender)},getSelectedGender:function(){return this.__selectedGender},__show3DSceneDCA:function(){if(!this.__3DSceneDCAShown){this.__3DSceneDCAShown=!0;var a="clothing"===this.__step?"tops":"hair";this.__parentMode.show3dScene({$parentElement:this.$(".dca .avatar-container"),parentContext:this,genders:[this.__selectedGender]}).then(function(d){this.__moveLoadingProgress("northstar");this.__ftuxState.isNothingEquipped()&&this.__ftuxState.createEquippedItemIds(this.__parentMode.getLookModel().get("products"));this.__parentMode.moveScene({left:-340},this.__parentMode.slideInOpen);"undefined"===typeof d&&this.__appMonitor.reportCustomError("FtuxSubmode","__show3DSceneDCA","web_error_0008b","ftuxModule unknown",[]);return d.loadedEverything().then(function(){this.__moveLoadingProgress("ftuxModule");d.setGender(this.__selectedGender);d.setModeToLook(function(){d.focusOnBodyRegion(a);this.__getPreviousProductsSelection();$(this.__window).trigger("resize")}.bind(this))}.bind(this))}.bind(this)).then(this.__on3dLoaded.bind(this))}},__show2dAvatarDCA:function(){var a=null===this.__2dAvatar||this.__genderChanged;this.__genderChanged=!1;a&&(null!==this.__2dAvatar&&(this.__2dAvatar.off("loaded"),this.__2dAvatar.delete(),this.__2dAvatar=null),a=this.$(".dca .avatar-container"),a.empty(),this.__spawn2dAvatar(this.__selectedGender,a).then(function(d){this.__2dAvatar=d;this.__parentMode.setLookModel(d.getLookModel());this.__2dAvatar.setCategory("body"===this.__category?this.__bodyCategory:this.__category);this.__ftuxProductSlideIn.enableProductEquip();this.__2dAvatar.on("loaded",this.__ftuxProductSlideIn.enableProductEquip.bind(this));this.__mediaLoaded();this.__getPreviousProductsSelection()}.bind(this)))},__getPreviousProductsSelection:function(){if(!this.__ftuxState.isNothingEquipped()){var a=this.__ftuxState.getEquippedItems(),d=_.pluck(this.__parentMode.getLookModel().get("products"),"product_id");a=_.difference(a,d);this.__parentMode.trackedAdds=a;this.__3dActive||0===a.length||this.__changeLook(a.toString());this.__ftuxProductSlideIn.markEquippedProducts(this.__ftuxState.getEquippedItems());this.__ftuxProductSlideIn.enableProductEquip()}},__executeChangeLook:function(){this.__executeChangeLookFromSlideIn(this.__ftuxProductSlideIn);!this.__3dActive&&this.__ftuxAccountSlideIn&&this.__ftuxAccountSlideIn.setAvatarImage(this.__parentMode.getLookModel().get("avatar_image"))},__getURLComponents:function(){var a=this.__serviceProvider.get("registrationDestination"),d="",e="";if(a){e=(e=a.substring(0,a.indexOf("?")))?e:a;d=a.split("/");var c=d.pop(),g=d.pop();""===c&&(c=g,g=d.pop());d="store"===g?"/"+g+"/"+c+"/":"/"+c+"/"}return{urlNoParams:e,urlPath:d,url:a}},__showRegistrationSlideIn:function(){if(!this.__regShown){this.__regShown=!0;this.__nextPageCallback=this.__serviceProvider.get("ftuxNextPageCallback");if(!this.__nextPageCallback){var a=this.__getURLComponents(),d=a.urlPath,e=a.url;if(a.urlNoParams&&-1!==_.indexOf(this.__supported_redirects,d))this.__nextPageCallback=function(){if("creatorlanding"===this.__serviceProvider.get("modeManager").uiApplication)try{this.__window.pintrk("track","signup",{lead_type:"account_created"},function(g,f){g||this.__appMonitor.reportCustomError("FtuxSubmode","__showRegistrationSlideIn","web_perm_0005i","Error returned from pintrk callback",["Reported Error: "+f])}.bind(this))}catch(g){this.__appMonitor.reportCustomError("FtuxSubmode","__showRegistrationSlideIn","web_perm_0005b","Error thrown in call to window.pintrk",["Reported Error: "+g.message])}this.__window.location=e}.bind(this);else if((a=new URL(this.__window.location.href).searchParams)&&a.get("next")){var c=a.get("next");this.__nextPageCallback=function(){this.__window.open(decodeURIComponent(c),"_self")}.bind(this)}else this.__nextPageCallback=this.__parentMode.openSubmode.bind(this.__parentMode,{id:"download"})}this.__ftuxAccountSlideIn||(this.__parentMode.getLookModel(),this.__ftuxAccountSlideIn=this.addSlideIn(k.FtuxAccountSlideIn,{$parentElement:this.$(".slide-in"),inventoryManager:this.__inventoryManager,nextPageCallback:this.__nextPageCallback,dressupProducts:this.__ftuxState.getEquippedItems(),captchaManager:this.__captchaManager,userClickedOnCreateAccount:this.__userClickedOnCreateAccount}))}},__setHistoryState:function(a){this.__historyManager.setState({fragment:a,mode:{id:"ftux"},submode:{id:a}})},_setMockParentMode:function(a){this.__parentMode=a},__goBackViaButtonClick:function(){this.__historyManager.silentMoveHistory(-1)},__popStateInterceptForBrowserGoBack:function(){this.__goBackOneStep()},__goBackOneStep:function(){switch(this.__step){case"gender":return!1;case"dna":return this.__setStep("gender",!0),!0;case"clothing":return this.__setStep("dna",!0),!0;case"account":return this.__setStep("clothing",!0),this.__ftuxAccountSlideIn.hide(),!0;default:return!1}}})}({NextUtil:m["@NextUtil"],UiCore:m["@UiCore"],CamParams:Mb,CaptchaManager:B,FtuxAccountSlideIn:Yb,FtuxProductSlideIn:Lb,InventoryManager:Ib,LoadingProgress:C,Submode:u,template:Hb}),$b=function(k){var b=IMVU.NamedModel;return b.extend("UndoRedoModel",{initialize:function(){b.prototype.initialize.apply(this,arguments);this.clearHistory()},add:function(a){0!==this.undoArr.length&&_.isEqual(this.undoArr[this.undoArr.length-1],a)||(this.undoArr.push(a),this.redoArr=[],this.trigger("add",a),this.__updateComputedAttributes())},undo:function(a){this.redoArr.push(a);a=this.undoArr.pop();this.trigger("undo",a);this.__updateComputedAttributes();return a},redo:function(a){this.undoArr.push(a);a=this.redoArr.pop();this.trigger("redo",a);this.__updateComputedAttributes();return a},clearHistory:function(){this.undoArr=[];this.redoArr=[];this.processBool=!0;this.__updateComputedAttributes()},historyFind:function(a){return _.find(this.undoArr,a)||_.find(this.redoArr,a)},isInHistory:function(a){var d=a.get("product_id").toString();a=function(e){e=_.last(e.split("/")).split(",");return _.contains(e,d)};return _.find(this.undoArr,a)||_.find(this.redoArr,a)},__updateComputedAttributes:function(){this.set({canUndo:!!this.undoArr.length,canRedo:!!this.redoArr.length,canProcess:this.processBool})},get:function(a){switch(a){case"lastUndo":return _.last(this.undoArr);default:return b.prototype.get.apply(this,arguments)}}})}({UiCore:m["@UiCore"]});return function(k){(function(){var a=new window.WeakMap;return function(d){a.has(d)||a.add(d,{});return a.get(d)}})();var b=k.Mode;return b.extend("FtuxMode",{uiContextName:"ftux_mode",className:"mode ftux ftux-mode",dependencies:"cookieManager dialogManager featureAccessManager leanplum localStorage loginManager Promise PromiseResolver rest sceneManager startupModel stringManager timer uiEventReporter webGL window".split(" "),submodes:function(){return{__default__:[k.FtuxFrontpageSubmode,{}],gender:[k.FtuxSubmode,{undoRedo:this.__undoRedo,initialStep:"gender"}],dna:[k.FtuxSubmode,{undoRedo:this.__undoRedo,initialStep:"dna"}],clothing:[k.FtuxSubmode,{undoRedo:this.__undoRedo,initialStep:"clothing"}],account:[k.FtuxSubmode,{undoRedo:this.__undoRedo,initialStep:"account"}],download:[k.FtuxBridgeSubmode]}},initialize:function(a){b.prototype.initialize.call(this,a);-1!==location.host.indexOf("localhost.")&&"true"===localStorage.getItem("forceProduction")&&this.__loginManager.isLoggedIn()&&(this.__window.location.href="/next?forceProduction=true");this.__startupModel=a.startupModel;this.__shouldCheckGDPR=IMVU.optionalProperty(a,"shouldCheckGDPR",!0);this.__serviceProvider=a.serviceProvider.nestedProvider();this.__ftuxState=this.__serviceProvider.create(k.FtuxState);this.__serviceProvider.register("ftuxState",this.__ftuxState);this.__cookieManager=a.cookieManager;this.__localStorage=a.localStorage;this.__avatar2dFactory=a.avatar2dFactory||k.Avatar2d;this.__ftuxModuleFactory=a.ftuxModuleFactory||k.FtuxModule;this.__Promise=a.Promise;this.module=a.module||module;this.__window=a.window;this.__timer=a.timer;this.__undoRedo=new k.UndoRedo;this.slideInOpen=!1;this.__avatar2d=[];this.__gaEventSent=[];this.listenTo(this,"shown",a.uiEventReporter.flush.bind(a.uiEventReporter));this.__network=a.network;this.__preciseTimer=a.preciseTimer;this.__frameTimer=a.frameTimer;this.trackedAdds=IMVU.optionalProperty(a,"trackedAdds",[]);this.trackedRemoves=IMVU.optionalProperty(a,"trackedRemoves",[]);this.__ftuxGender=this.__ftuxState.getGender();this.createLookModel(this.__ftuxGender);this.addToDOM();this.__startupModel.populated().then(function(){this.__startupModel.getSingleEdge("dress_up_ftux").populated()}.bind(this)).catch(function(d){this.__window.console.error(d)}.bind(this))},maybeShowGDPRDialog:function(){this.__shouldCheckGDPR&&(this.__isGDPR=!1,this.__consentUrl=this.__startupModel.get("consentUrl"),this.__consentModel=this.__restModelFactory.readModel(this.__consentUrl,k.UiCore.NodeModel),this.__consentModel.populated().then(function(){(this.__isGDPR=this.__consentModel.get("qualifies_for_gdpr")||"1"===this.__cookieManager.get("test_gdpr"))&&"true"!==this.__cookieManager.get("accepted_all_cookies")&&this.__dialogManager.showDialog(k.PrivacyPolicyAdultDialog)}.bind(this)).catch(function(a){this.__window.console.error(a)}.bind(this)))},show2dAvatar:function(a){a=void 0===a?{}:a;var d=IMVU.requireProperty(a,"gender"),e=IMVU.requireProperty(a,"$parentElement");a.allowDuplicates||e.empty();var c=IMVU.requireProperty(a,"parentContext");if(!this.__avatar2d[d]||a.setDefault){var g;return this.__startupModel.populated().then(function(){return this.__startupModel.getSingleEdge("dress_up_ftux").populated()}.bind(this)).then(function(h){h=a.keepLookModel?this.__lookModel:this.__serviceProvider.create(k.LookModel,{typeId:d});g=+new Date;h=c.createChildContext(this.__avatar2dFactory,{category:"all",model:h,$parentElement:e,attachedToBottom:a.attachedToBottom,view:"ftux"});this.__avatar2d[d]={parentContext:c,avatarContext:h};return h.loaded()}.bind(this)).then(function(h){this.__gaEventSent[d]||(this.__googleAnalytics.recordPerformance("load","2dAvatar",+new Date-g),this.__gaEventSent[d]=!0);return h}.bind(this)).catch(function(h){this.__window.console.error(h)}.bind(this))}var f=this.__avatar2d[d].avatarContext;this.__avatar2d[d].parentContext.removeChildContext(f);f.setAttachedToBottom(a.attachedToBottom);f.setParentUiContext(c);c.children().push(f);f.$el.appendTo(e);return f.loaded()},show3dScene:function(a){var d=IMVU.requireProperty(a,"parentContext"),e=IMVU.requireProperty(a,"$parentElement");if(this.__ftuxModule)return d.removeChildContext(this.__ftuxModule),this.__ftuxModule.reparent(e),a=this.__Promise.accept(this.__ftuxModule),"undefined"===typeof a&&this.__appMonitor.reportCustomError("FtuxMode","show3dScene","web_error_0009c","this.__ftuxModule, failed promise accept",[]),a;a=_.extend({context:d,$parentElement:e,lingerTime:0},a);return this.__create3dScene(a).then(function(){"undefined"===typeof this.__show3dScenePromise&&this.__appMonitor.reportCustomError("FtuxMode","show3dScene","web_error_0009a","__show3dScenePromise unknown",[]);return this.__show3dScenePromise}.bind(this)).catch(function(c){this.__appMonitor.reportCustomError("FtuxSubmode","show3dScene","web_error_0009b","Caught throw from __create3dScene:  "+c.message,this.__appMonitor.buildErrorArray(c));this.__window.console.error(c)}.bind(this))},__create3dScene:function(a){var d,e;this.__northstarLoader=this.__serviceProvider.get("northstarLoader");return this.__show3dScenePromise=this.__startupModel.populated().then(function(){return this.__startupModel.getSingleEdge("dress_up_ftux").populated()}.bind(this)).then(function(c){e=c;d=Date.now();return this.__northstarLoader.getNorthstar()}.bind(this)).then(function(c){this.Northstar=c.Northstar;return this.__sceneManager.initFtuxScene(_.extend({context:a.context,roomUrl:e.get("room_asset_url"),femaleUrl:e.get("female_asset_url"),maleUrl:e.get("male_asset_url"),$parentElement:a.$parentElement,Northstar:this.Northstar},a))}.bind(this)).then(function(c){this.__ftuxModule=c;this.__googleAnalytics.recordPerformance("load","3dAvatar",Date.now()-d);return this.__Promise.accept(this.__ftuxModule)}.bind(this)).catch(function(c){this.__window.console.error(c)}.bind(this))},get3dScenePromise:function(){return this.__show3dScenePromise},getFtuxModule:function(){return this.__ftuxModule},createLookModel:function(a){this.__lookModel=this.__serviceProvider.create(k.LookModel,{typeId:a})},setLookModel:function(a){this.__lookModel=a},getLookModel:function(){return this.__lookModel},resetTrackedIds:function(){this.trackedAdds=[];this.trackedRemoves=[]},moveScene:function(a,d){this.$(".ftux-module").addClass("moved");d&&this.$(".ftux-module").addClass("animate");$.each(a,function(e,c){this.$(".ftux-module").css(e,c)}.bind(this));this.$(".ftux-module").removeClass("animate")},resetScenePosition:function(){this.$(".ftux-module").removeClass("moved");this.$(".ftux-module").css({top:0,right:-170,bottom:0,left:-170})},connectionSpeed:null,connectionTier:null,getConnectionSpeed:function(){return new this.__Promise(function(a){return null===this.__localStorage.getItem("northstarSpeedTest")?(this.connectionSpeed=4688,this.connectionTier=3,a.resolve(this.connectionSpeed)):null!==this.connectionSpeed?a.resolve(this.connectionSpeed):this.__testConnectionSpeed().then(function(){return a.resolve(this.connectionSpeed)}.bind(this)).catch(function(d){this.__window.console.error(d)}.bind(this))}.bind(this))},getConnectionTier:function(){return new this.__Promise(function(a){return null===this.__localStorage.getItem("northstarSpeedTest")?(this.connectionSpeed=4688,this.connectionTier=3,a.resolve(this.connectionTier)):null!==this.connectionTier?a.resolve(this.connectionTier):this.__testConnectionSpeed().then(function(){return a.resolve(this.connectionTier)}.bind(this)).catch(function(d){this.__window.console.error(d)}.bind(this))}.bind(this))},__testConnectionSpeed:function(){return new this.__Promise(function(a){if(null!==this.connectionSpeed)return a.resolve(!0);this.promiseResolver=a;this.connectionSpeed=50;var d,e={},c={},g={},f={},h=this.__serviceProvider.get("connectionSpeedTimeout");_.each(this.__serviceProvider.get("speedTestImages"),function(l,n,p){f[n]=new Image;e[n]=(new Date).getTime();d="?_="+e[n];f[n].src=l.url+d;f[n].onload=function(){c[n]=(new Date).getTime();g[n]=c[n]-e[n];if((g[n]>h||n+1===p.length)&&"accepted"!=a.promise.state){var q=Math.round(100*this.connectionSpeed)/100;this.connectionSpeed=8*l.size/g[n];this.connectionTier=n;n+1===p.length&&g[n]<h&&(this.connectionTier=3);this.__window.console.log("Download Duration:",g[n]+"ms","Limit:",h+"ms");this.__window.console.log("Connection Speed:",q+"kbps");this.__window.console.log("Connection Tier:",this.connectionTier);this.__recordEvent("connection_details",{speed_in_kbps:q,tier:this.connectionTier,record:!0});a.resolve()}}.bind(this,a,n,p,f,h);f[n].onerror=function(q,v){this.__window.console.error("Download Error:",q,v);this.connectionTier=this.connectionSpeed=0;a.resolve()}.bind(this)},this,e,c,f,d)}.bind(this))}})}({UiCore:m["@UiCore"],Avatar2d:tb,FtuxBridgeSubmode:jb,FtuxFrontpageSubmode:Gb,FtuxModule:ca,FtuxState:Q,FtuxSubmode:Zb,LookModel:P,Mode:pb,PrivacyPolicyAdultDialog:S,UndoRedo:$b}).extend("DesktopFtuxMode",{})});